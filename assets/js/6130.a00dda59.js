(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[6130],{3905:function(t,e,i){"use strict";i.d(e,{Zo:function(){return d},kt:function(){return m}});var n=i(7294);function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function o(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach((function(e){r(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function s(t,e){if(null==t)return{};var i,n,r=function(t,e){if(null==t)return{};var i,n,r={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(r[i]=t[i]);return r}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(r[i]=t[i])}return r}var c=n.createContext({}),u=function(t){var e=n.useContext(c),i=e;return t&&(i="function"==typeof t?t(e):o(o({},e),t)),i},d=function(t){var e=u(t.components);return n.createElement(c.Provider,{value:e},t.children)},l={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},p=n.forwardRef((function(t,e){var i=t.components,r=t.mdxType,a=t.originalType,c=t.parentName,d=s(t,["components","mdxType","originalType","parentName"]),p=u(i),m=r,f=p["".concat(c,".").concat(m)]||p[m]||l[m]||a;return i?n.createElement(f,o(o({ref:e},d),{},{components:i})):n.createElement(f,o({ref:e},d))}));function m(t,e){var i=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var a=i.length,o=new Array(a);o[0]=p;var s={};for(var c in e)hasOwnProperty.call(e,c)&&(s[c]=e[c]);s.originalType=t,s.mdxType="string"==typeof t?t:r,o[1]=s;for(var u=2;u<a;u++)o[u]=i[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,i)}p.displayName="MDXCreateElement"},5936:function(t,e,i){"use strict";i.d(e,{aX:function(){return ku},y1:function(){return Bl},SX:function(){return Om},C9:function(){return I},QO:function(){return Cm},_3:function(){return Sn},M6:function(){return Jp},hC:function(){return Lm}});const n={S:"normal",F:"final"};function r(t,e){if(t&&"object"==typeof t){if(t.timed&&!isNaN(t.minutes))return o(t);if(t.bestOf&&t.setFormat)return function(t,e){const i=a(t.bestOf),n=i&&`SET${i}`||"",r=s(t.setFormat,e),o=r&&`S:${r}`||"",c=s(t.finalSetFormat,e),u=i>1&&c&&!c.invalid&&r!==c&&`F:${c}`||"";if(n&&r&&!r.invalid&&(!c||!c.invalid))return[n,o,u].filter((t=>t)).join("-")}(t,e)}}function a(t){return!isNaN(Number(t))&&Number(t)}function o(t){return`T${t.minutes}`}function s(t,e){if(t&&"object"==typeof t){if(t.timed)return o(t);if(t.tiebreakSet)return c(t.tiebreakSet);const i=a(t.setTo);if(i){const n=t.NoAD?"NOAD":"",r=c(t.tiebreakFormat),o=r&&!r.invalid&&`/${r}`||"",s=a(t.tiebreakAt),u=s&&(s!==i||e)&&`@${s}`||"";return r&&r.invalid?{invalid:!0}:`${i}${n}${o}${u}`}return{invalid:!0}}}function c(t){if(t)return"object"!=typeof t||t.tiebreakTo?"object"==typeof t&&a(t.tiebreakTo)?`TB${t.tiebreakTo}${t.NoAD?"NOAD":""}`:{invalid:!0}:""}function u(t){if(t&&"string"==typeof t){const e=0===t.indexOf("T")?"timed":0===t.indexOf("SET")?"SET":"";if("timed"===e){const e={bestOf:1,setFormat:p(t)};if(e.setFormat)return e}if("SET"===e)return function(t){const e=t.split("-"),i=f(e[0].slice(3)),n=e&&d(e[1]),r=e&&d(e[2]),a=i&&i<6,o=!e[2]||r&&!r.invalid,s=n&&!n.invalid,c={bestOf:i,setFormat:n};if(r&&(c.finalSetFormat=r),a&&s&&o)return c}(t)}}function d(t){if(t&&":"===t[1]){const e=t.split(":"),i=n[e[0]],r=e[1];if(i&&r){if(0===r.indexOf("TB"))return{tiebreakSet:l(r)};if(0===r.indexOf("T"))return p(r);const e=t.match(/^[FS]{1}:(\d+)([A-Za-z]*)/),i=e&&m(e[2])||!1,n=!e||!e[2]||i,a=e&&f(e[1]),o=function(t){const e=t&&t.indexOf("@")>0&&t.split("@");if(e)return f(e[1])||{invalid:!0}}(r),s=!o||o&&!o.invalid,c=s&&o||a,u=l(r.split("/")[1]),d=!u||!u.invalid,h={setTo:a};return i&&(h.NoAD=!0),u?(h.tiebreakFormat=u,h.tiebreakAt=c):h.noTiebreak=!0,a&&n&&d&&s&&h||{invalid:!0}}}}function l(t){if(t){if(0===t.indexOf("TB")){const e=t.match(/^TB(\d+)([A-Za-z]*)/),i=e&&e[1],n=e&&m(e[2]),r=!e||!e[2]||n,a=f(i);if(a&&r){const t={tiebreakTo:a};return n&&(t.NoAD=!0),t}return{invalid:!0}}return{invalid:!0}}}function p(t){const e=f(t.slice(1));if(e)return{timed:!0,minutes:e}}function m(t){return t&&t.indexOf("NOAD")>=0}function f(t){return!isNaN(Number(t))&&Number(t)}function h(t){var e;if("string"!=typeof t)return!1;const i=u(t);if(null!=i&&null!==(e=i.setFormat)&&void 0!==e&&e.timed&&1===(null==i?void 0:i.bestOf)&&t.indexOf("SET1-S:")<1&&0===t.indexOf("T"))return r(i).slice(7)===t;const n=t.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),a=null==n?void 0:n[0],o=null==n?void 0:n[2],s=t.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),c=null==s?void 0:s[0],d=null==s?void 0:s[2];return r(i,n&&a===o||s&&c===d)===t}const I={isValidMatchUpFormat:h,stringify:r,isValid:h,parse:u};const v="SET3-S:6/TB7",g="ABANDONED",y="BYE",U="CANCELLED",w="COMPLETED",S="DEFAULTED",N="DOUBLE_WALKOVER",P="IN_PROGRESS",D="INCOMPLETE",T="RETIRED",M="SUSPENDED",A="TO_BE_PLAYED",E="WALKOVER",b=["AWAITING_RESULT",w,S,P,D,T,M],R=["AWAITING_RESULT",w,S,N,P,D,T,M,E],C=[g,"AWAITING_RESULT",y,U,w,"DEAD_RUBBER",S,N,P,D,"NOT_PLAYED",T,M,A,E],O=[y,w,S,N,T,E],L=[g,"AWAITING_RESULT",U,"DEAD_RUBBER",P,D,"NOT_PLAYED",M,A,void 0],x=[U,g,w,"DEAD_RUBBER",S,N,T,E],F=[g,w,S,N,P,T,E],k=[P,D,M,A],_={ABANDONED:g,AWAITING_RESULT:"AWAITING_RESULT",BYE:y,CANCELLED:U,COMPLETED:w,DEAD_RUBBER:"DEAD_RUBBER",DEFAULTED:S,DOUBLE_WALKOVER:N,IN_PROGRESS:P,INCOMPLETE:D,NOT_PLAYED:"NOT_PLAYED",RETIRED:T,SUSPENDED:M,TO_BE_PLAYED:A,WALKOVER:E};function j({winningSide:t,matchUpFormat:e=v,matchUpStatus:i,tallyPolicy:n,score:r}){const a=[0,0],{sets:o}=r||{},s=t-1,c=u(e),d=B((null==c?void 0:c.bestOf)||1);return i===S&&null!=n&&n.setsCreditForDefaults||i===E&&null!=n&&n.setsCreditForWalkovers?a[s]=d:o&&o.forEach((t=>{const{winningSide:e}=t;e&&(a[e-1]+=1)})),i===T&&(+a[1-s]===d&&(a[1-s]-=1),a[s]=d),a}function B(t){return t&&Math.ceil(t/2)||1}function G(t){return!isNaN(t)&&t&&0==(t&t-1)}function V(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function H(t){return!isNaN(parseFloat(t))}function q(t){if(isNaN(t))return!1;for(;!G(t);)t++;return t}function W(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function z(t){return Number.isSafeInteger("string"==typeof t?+t:t)}function K(t,e,i,n=2,r){const a=1-Math.random(),o=1-Math.random();let s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=K(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),r&&(s=function(t,e){e||(e=1);var i=1/e;return Math.round(t*i)/i}(s,r)),parseFloat(s.toFixed(n))}function Y(t){if(null===t)return{};const{source:e,template:i}=t||{},n={};return function t(e,i,n){if(!e||!i)return;const r=Object.keys(e),a=Object.keys(i);for(let o=0;o<r.length;o++)if(a.indexOf(r[o])>=0){const a=i[r[o]],s=e[r[o]];a&&"object"==typeof a&&"function"!=typeof s?Array.isArray(s)?n[r[o]]=s.map((e=>{const i={};return t(e,a,i),i})):s&&(n[r[o]]={},t(s,a,n[r[o]])):i[r[o]]&&(n[r[o]]=e[r[o]])}}(e,i,n),n}function $(t=0){const e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function J(t){return t.filter(((t,e,i)=>i.lastIndexOf(t)===e))}function Z(t){return t.map((t=>[Math.random(),t])).sort(((t,e)=>t[0]-e[0])).map((t=>t[1]))}function Q(t){return t.reduce(((t,e)=>(t[e]||(t[e]=0),t[e]++,t)),{})}function X(t,e,i){return i.indexOf(t)===e}function tt(t){return t.filter(X)}function et(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function it(t){return t[Math.floor(Math.random()*t.length)]}function nt(t,e){return Array.from({length:e-t},((e,i)=>i+t))}function rt(t,e){return e.reduce(((e,i,n)=>(i===t&&e.push(n),e)),[])}function at(t,e){return Array.isArray(t)&&Array.isArray(e)?t.filter((t=>-1!==e.indexOf(t))).filter(((t,e,i)=>i.indexOf(t)===e)):0}function ot(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.some((t=>e.includes(t)))}function st(t,e){return t.reduce(((t,i,n)=>{const r=Math.floor(n/e);return t[r]=[].concat(t[r]||[],i),t}),[])}function ct(t,e,i){return t.reduce(((t,n,r)=>{const a=!!i&&!!(Math.floor(r/e)%2),o=r%e,s=a?e-1-o:o;return t[s]||(t[s]=[]),t[s].push(n),t}),[])}const ut={success:!0},dt={SUCCESS:ut,ERROR:"error"},lt="records must be an object with tournamentId keys",pt="Missing tournamentRecord",mt="Missing drawDefinition",ft="drawPosition already assigned",ht="Missing event / eventId",It="Missing value",vt="Invalid Date",gt="Invalid values",yt="Not found",Ut={CANNOT_CHANGE_WINNINGSIDE:"Cannot change winningSide",CANNOT_REMOVE_PARTICIPANTS:"Cannot remove participants",COURT_EXISTS:"Court exists",COURT_NOT_FOUND:"Court not found",DRAW_DEFINITION_NOT_FOUND:"drawDefinition not found",DRAW_ID_EXISTS:"drawId exists",DRAW_POSITION_ACTIVE:"drawPosition is active",DRAW_POSITION_ASSIGNED:"drawPosition already assigned",DRAW_POSITION_NOT_CLEARED:"drawPosition not cleared",DRAW_POSITION_NOT_FOUND:"drawPosition not found",ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:"entryStatus not allowed for event",ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:"entryStatus not allowed in stage",EVENT_EXISTS:"Event exists",EVENT_NOT_FOUND:"Event not found",EXISTING_DRAW_DEFINITIONS:"Existing drawDefinition(s)",EXISTING_END_TIME:"Existing endTime",EXISTING_FLIGHT:"Existing flight",EXISTING_OUTCOME:"Existing outcome",EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:"Existing participant drawPosition assignment",EXISTING_PARTICIPANT:"Existing participant",EXISTING_POLICY_TYPE:"existing policyType",EXISTING_PROFILE:"Existing profile",EXISTING_ROUND:"Existing round",INCOMPATIBLE_MATCHUP_STATUS:"Incompatible matchUpStatus",INCOMPLETE_SOURCE_STRUCTURE:"Incomplete source structure",INVALID_BOOKINGS:"Invalid bookings",INVALID_CONFIGURATION:"Invalid configuration",INVALID_DATE_AVAILABILITY:"Invalid dateAvailability",INVALID_DATE:vt,INVALID_DRAW_DEFINITION:"Invalid drawDefinition",INVALID_DRAW_POSITION_FOR_SEEDING:"Invalid drawPosition for seedAssignment",INVALID_DRAW_POSITION:"Invlid drawPosition",INVALID_DRAW_SIZE:"Invalid drawSize",INVALID_END_TIME:"Invalid endTime",INVALID_ENTRIES:"Invalid entries",INVALID_EVENT_TYPE:"Invalie eventType",INVALID_GAME_SCORES:"Invalid game scores",INVALID_MATCHUP_FORMAT:"Invalid matchUpFormat",INVALID_MATCHUP_STATUS:"Invalid matchUpStatus",INVALID_MATCHUP:"Invalid matchUp",INVALID_OBJECT:"Invalid object",INVALID_PARTICIPANT_ID:"Invalid participantId",INVALID_PARTICIPANT_IDS:"Invalid participantIds",INVALID_PARTICIPANT_ROLE:"Invalid participantRole",INVALID_PARTICIPANT_TYPE:"Invalid participantType",INVALID_PARTICIPANT:"Invalid participant",INVALID_POLICY_DEFINITION:"Invalid policyDefinitions",INVALID_RECORDS:lt,INVALID_SCALE_ITEM:"Invalid scaleItem",INVALID_SEED_NUMBER:"Invalid seedNumber",INVALID_SEED_POSITION:"Invalid seedPosition",INVALID_SET_NUMBER:"Invalid setNumber",INVALID_SIDE_NUMBER:"Invalid sideNumber",INVALID_STAGE:"Invalid stage",INVALID_START_TIME:"Invalid startTime",INVALID_STRUCTURE:"Invalid structure",INVALID_STOP_TIME:"Invalid stopTime",INVALID_TIE_FORMAT:"Invalid tieFormat",INVALID_TIME:"Invalid time",INVALID_TIME_ITEM:"Invalid timeItem",INVALID_TOURNAMENT_DATES:"Invalid tournament dates",INVALID_TOURNAMENT_RECORD:"Invalid tournamentRecord",INVALID_VALUES:gt,INVALID_WINNING_SIDE:"Invalid winningSide",MATCHUP_NOT_FOUND:"matchUp not found",METHOD_NOT_FOUND:"Method not found",MISSING_ASSIGNMENTS:"Missing assignments",MISSING_AVOIDANCE_POLICY:"Missing avoidance policy",MISSING_COLLECTION_DEFINITION:"Missing collectionDefinition",MISSING_COURT_ID:"Missing courtId",MISSING_COURTS_INFO:"Missing courtsCount/courtNames",MISSING_DATE_AVAILABILITY:"Missing dateAvailability",MISSING_DATE:"Missing date",MISSING_DRAW_DEFINITION:mt,MISSING_DRAW_ID:"Missing drawId",MISSING_DRAW_POSITION:"Missing drawPosition",MISSING_DRAW_POSITIONS:"Missing drawPositions",MISSING_DRAW_SIZE:"Missing drawSize",MISSING_ENTRIES:"Missing entries",MISSING_EVENT:ht,MISSING_MATCHUP_FORMAT:"Missing matchUpFormat",MISSING_MATCHUP_ID:"Missing matchUpId",MISSING_MATCHUP_IDS:"Missing matchUpIds",MISSING_MATCHUP:"Missing matchUp",MISSING_MATCHUPS:"Missing matchUps",MISSING_PARTICIPANT_COUNT:"Missing participantCount",MISSING_PARTICIPANT_ID:"Missing participantId",MISSING_PARTICIPANT_IDS:"Missing participantIds",MISSING_PARTICIPANT_ROLE:"Missing participantRole",MISSING_PARTICIPANT:"Missing participant",MISSING_PARTICIPANTS:"Missing participants",MISSING_PENALTY_ID:"Missing penaltyId",MISSING_PENALTY_TYPE:"Missing penaltyType",MISSING_PERSON_DETAILS:"Missing person details",MISSING_POLICY_ATTRIBUTES:"Missing policy attributes",MISSING_POLICY_DEFINITION:"Missing policyDefinitions",MISSING_POLICY_TYPE:"Missing policyType",MISSING_POSITION_ASSIGNMENTS:"Missing positionAssignments",MISSING_ROUND_NUMBER:"Missing roundNumber",MISSING_SCHEDULE:"Missing schedule",MISSING_SCORING_POLICY:"Missing scoring policy / matchUpFormats",MISSING_SEED_ASSIGNMENTS:"Missing seedAssignments",MISSING_SEED_BLOCKS:"Missing seedBlocks",MISSING_SEEDCOUNT_THRESHOLDS:"Missing seedCountThresholds",MISSING_SEEDING_POLICY:"Missing seeding policy",MISSING_SET_NUMBER:"Missing setNumber",MISSING_SET_OBJECT:"Missing setObject",MISSING_SIDE_NUMBER:"Missing sideNumber",MISSING_STAGE:"Missing stage",MISSING_STRUCTURE_ID:"Missing structureId",MISSING_STRUCTURE:"Missing structure",MISSING_STRUCTURES:"Missing structures",MISSING_TARGET_LINK:"Missing targetLink",MISSING_TIE_FORMAT:"Missing tieFormat",MISSING_TIME_ITEM:"Missing timeItem",MISSING_TIME_ITEMS:"Missing timeItems",MISSING_TOURNAMENT_ID:"Missing tournamentId",MISSING_TOURNAMENT_RECORD:pt,MISSING_TOURNAMENT_RECORDS:"Missing tournamentRecords",MISSING_VALUE:It,MISSING_VENUE_ID:"Missing venueId",MODIFICATIONS_FAILED:"Modifications failed",MORE_PARTICIPANTS_THAN_DRAW_POSITIONS:"More Participants than Draw Positions",NO_MODIFICATIONS_APPLIED:"No modifications applied",NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:"No stage space available for entryStatus",NO_PARTICIPANT_REMOVED:"No participant removed",NO_VALID_ACTIONS:"No valid actions",NO_VALID_ATTRIBUTES:"No valid attributes",NO_VALID_DATES:"No valid dates",NOT_FOUND:yt,NOT_IMPLEMENTED:"Not implemented",PARTICIPANT_ASSIGNED_DRAW_POSITION:"Participant has assigned drawPosition",PARTICIPANT_ALREADY_CHECKED_IN:"Participant already checked in",PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:"participantCount exceeds drawSize",PARTICIPANT_ID_EXISTS:"participantId exists",PARTICIPANT_NOT_CHECKED_IN:"Participant not checked in",PARTICIPANT_NOT_FOUND:"Participant Not Found",PARTICIPANT_PAIR_EXISTS:"participant pair exists",PENALTY_NOT_FOUND:"Penalty not found",POLICY_NOT_ATTACHED:"Policy not attached",POLICY_NOT_FOUND:"Policy not found",SCALE_ITEM_NOT_FOUND:"No scaleItem found",SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:"seedsCount greater than drawSize",STAGE_SEQUENCE_LIMIT:"stageSequence limit",STRUCTURE_NOT_FOUND:"structure not found",TEAM_NOT_FOUND:"Team not found",UNRECOGNIZED_DRAW_TYPE:"Unrecognized drawType",UNRECOGNIZED_MATCHUP_FORMAT:"Unrecognized matchUpFormat",UNRECOGNIZED_MATCHUP_STATUS:"Unrecognized matchUpStatus",VALUE_UNCHANGED:"Value unchanged",VENUE_EXISTS:"Venue exists"},wt={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},notices:[]},St={timers:{default:{elapsedTime:0}},devContext:void 0,deepCopyAttributes:{threshold:void 0,stringify:[],ignore:[],toJSON:[]},deepCopy:!0};let Nt={addNotice:function({topic:t,payload:e,key:i}){"string"==typeof t&&"object"==typeof e&&!wt.disableNotifications&&wt.subscriptions[t]&&(i&&(wt.notices=wt.notices.filter((e=>!(e.topic===t&&e.key===i)))),wt.notices.push({topic:t,payload:e,key:i}))},callListener:function({topic:t,notices:e}){const i=wt.subscriptions[t];i&&"function"==typeof i&&i(e)},deleteNotices:function(){wt.notices=[]},disableNotifications:function(){wt.disableNotifications=!0},enableNotifications:function(){wt.disableNotifications=!1},getNotices:function({topic:t}){const e=wt.notices.filter((e=>e.topic===t)).map((t=>t.payload));return e.length&&e},getTopics:function(){return{topics:Object.keys(wt.subscriptions)}},getTournamentId:function(){return wt.tournamentId},getTournamentRecord:function(t){return wt.tournamentRecords[t]},getTournamentRecords:function(){return wt.tournamentRecords},removeTournamentRecord:function(t){if("string"!=typeof t)return{error:gt};if(!wt.tournamentRecords[t])return{error:yt};delete wt.tournamentRecords[t];const e=Object.keys(wt.tournamentRecords);return 1===e.length?wt.tournamentId=e[0]:e.length||(wt.tournamentId=void 0),{success:!0}},setSubscriptions:function({subscriptions:t={}}={}){return"object"!=typeof t?{error:gt}:(Object.keys(t).forEach((e=>{wt.subscriptions[e]=t[e]})),{...ut})},setTournamentId:function(t){return wt.tournamentRecords[t]?(wt.tournamentId=t,{success:!0}):{error:pt}},setTournamentRecord:function(t){const e=null==t?void 0:t.tournamentId;return e?(wt.tournamentRecords[e]=t,{success:!0}):{error:"Invalid tournamentRecord"}},setTournamentRecords:function(t){wt.tournamentRecords=t;const e=Object.keys(t);1===e.length?wt.tournamentId=e[0]:e.length||(wt.tournamentId=void 0)}};function Pt(t){return t&&"object"==typeof t?"object"==typeof St.devContext&&Object.keys(t).every((e=>St.devContext[e]===t[e]))&&St.devContext:St.devContext||!1}function Dt(t){St.devContext=t}function Tt(){Nt.enableNotifications()}function Mt(t,e){"boolean"==typeof t&&(St.deepCopy=t),"object"==typeof e&&(Array.isArray(e.ignore)&&(St.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(St.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(St.deepCopyAttributes.stringify=e.stringify),e.threshold&&(St.deepCopyAttributes.threshold=e.threshold))}function At(t){return Nt.addNotice(t)}function Et(t){return Nt.getNotices(t)}function bt(){return Nt.deleteNotices()}function Rt(){return Nt.getTopics()}async function Ct(t){return Nt.callListener(t)}function Ot(){return Nt.getTournamentId()}function Lt(t){return Nt.getTournamentRecord(t)}function xt(){return Nt.getTournamentRecords()}function Ft(t){return Nt.setTournamentRecord(t)}function kt(t){return Nt.setTournamentRecords(t)}function _t(t){return Nt.setTournamentId(t)}function jt(t){return Nt.removeTournamentRecord(t)}const Bt=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,Gt=/^((0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)([.,][0-9]{3})?$/,Vt=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))([ T](0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/,Ht=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))?([ T]?(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/;function qt(t){return"object"==typeof t&&!Array.isArray(t)&&"[object Date]"===Object.prototype.toString.call(t)}function Wt(t){return Qt(t)||Bt.test(t)}const zt=t=>{const e=$t(t)||Qt(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${de(n)}-${de(e.getUTCDate())}`};function Kt(t,e="-",i="YMD"){if(!t)return"";"string"==typeof t&&t.indexOf("T")<0&&(t+="T00:00");const n=new Date(t);let r=""+(n.getMonth()+1),a=""+n.getDate();const o=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),"DMY"===i?[a,r,o].join(e):"MDY"===i?[r,a,o].join(e):"YDM"===i?[o,a,r].join(e):"DYM"===i?[a,o,r].join(e):"MYD"===i?[r,o,a].join(e):[o,r,a].join(e)}function Yt(t){const e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-60*i*1e3)}function $t(t){if("boolean"==typeof t)return!1;const e=t instanceof Date?t:!isNaN(t)&&new Date(t);return e&&!isNaN(e.valueOf())}function Jt(t,e){const i=new Date(t),n=new Date(e);var r;const a=[];let o=0;if($t(n)&&$t(i)&&(r=n,Yt(i)<=Yt(r))){const t=Yt(i),e=Yt(n);for(;t<=e&&o<300;)o+=1,a.push(new Date(t)),t.setDate(t.getDate()+1)}return a}const Zt=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Qt(t){return"string"==typeof t&&Zt.test(t)}function Xt(t){if("string"!=typeof t)return!1;const e=t.split("Z")[0].split(":"),i=e.every((t=>!isNaN(t)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function te(t){const e=ie(t);if(!e)return 0;const[i,n]=e.split(":").map((t=>parseInt(t)));return 60*i+n}function ee(t){return Xt(t)?t.split(":").slice(0,2).map(de).join(":"):void 0}function ie(t){return Qt(t)&&t.indexOf("T")>0?ee(t.split("T").reverse()[0]):ee(t)}function ne(t){return Qt(t)||Vt.test(t)?t.split("T")[0]:void 0}function re(t,e){const i=new Date(t);return i.setDate(i.getDate()+e),ne(i.toISOString())}function ae(t){t="string"!=typeof t?"00:00":t;const e={},i={};return({0:e.time,1:e.ampm}=t.split(" ")||[]),({0:i.hours,1:i.minutes}=e.time.split(":")||[]),i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function oe(t,e){const[i,n]=(t||"00:00").split(":").map(de),r=Yt(e).setHours(i,n,0,0);return Yt(r)}function se(t,e,i=!0){const n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function ce(t,e){const i=ie(t);if(!i)return"00:00";const n=isNaN(e)?0:e;return ie(ue(oe(i),n).toISOString())}function ue(t,e){const i=new Date(t);return new Date(i.getTime()+6e4*e)}function de(t){return t.toString()[1]?t:"0"+t}function le(t,e){const i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}const pe={addMinutesToTimeString:ce,convertTime:function(t,e){return e?function(t){const e=ae(t);return e.ampm&&e.hours&&("pm"===e.ampm.toLowerCase()&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),"am"===e.ampm.toLowerCase()&&"12"===e.hours&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(de).join(":")}(t):function(t){const e=ae(t);return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):"12"===e.hours?e.ampm="PM":"00"===e.hours?(e.hours="12",e.ampm="AM"):e.ampm="AM","0"===e.hours[0]&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}(t)},getUTCdateString:zt,DateHHMM:function(t){const e=new Date(t);return function(t,e){const i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-3600*n)/60);return(!e||e&&e.displaySeconds?n+":"+r+":"+(i-3600*n-60*r):n+":"+r).split(":").map(de).join(":")}(e.getSeconds()+60*e.getMinutes()+3600*e.getHours(),{displaySeconds:!1})},extractDate:ne,extractTime:ie,formatDate:Kt,getDateByWeek:function(t,e,i,n=!1){let r=new Date(e,0,1+7*(t-1));const a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Kt(r,i)},isISODateString:Qt,isTimeString:Xt,offsetDate:Yt,offsetTime:function(t){return Yt(t).getTime()},sameDay:le,timeStringMinutes:te,timeToDate:oe,timeUTC:function(t){const e=$t(t)||Qt(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}};function me(t,e,i,n,r=0){const a={enabled:St.deepCopy,...St.deepCopyAttributes};if((null==a||!a.enabled)&&!i||"object"!=typeof t||"function"==typeof t||null===t||"number"==typeof(null==a?void 0:a.threshold)&&r>=a.threshold)return t;const o=Pt({makeDeepCopy:!0});o&&r>(o.iterations||15)&&console.log(r,t,{devContext:o});const s=Array.isArray(t)?[]:{},c=Object.keys(t).filter((t=>!i||!(null!=a&&a.ignore.includes(t))));for(const d of c){const o=t[d];if(e&&"extensions"===d&&Array.isArray(o)){const t=null==(u=o)?void 0:u.map((t=>{const{name:e,value:i}=t;return e&&i&&{[`_${e}`]:i}})).filter(Boolean);Object.assign(s,...t)}else n&&"extensions"===d?s[d]=[]:i&&null!=a&&a.stringify.includes(d)?s[d]="function"==typeof(null==o?void 0:o.toString)?o.toString():JSON.stringify(o):i&&null!=a&&a.toJSON.includes(d)&&"function"==typeof(null==o?void 0:o.toJSON)?s[d]=o.toJSON():null===o?s[d]=void 0:qt(o)?s[d]=new Date(o).toISOString():s[d]=me(o,e,i,n,r+1)}var u;return s}function fe(t,e,i){if("object"!=typeof t||null===t)return t;const n=["",void 0,null];e&&n.push(!1);const r=Object.keys(t).filter((e=>!n.includes(t[e])&&(!i||!Array.isArray(t[e])||t[e].length)));return Object.assign({},...r.map((e=>Array.isArray(t[e])?{[e]:t[e].map((t=>fe(t)))}:{[e]:fe(t[e])})))}function he(t){return Array.isArray(t)?t.length+t.map(he).reduce(((t,e)=>t+e),0):"object"==typeof t&&null!==t?Object.keys(t).length+Object.keys(t).map((e=>he(t[e]))).reduce(((t,e)=>t+e),0):0}function Ie(t,e){return t-e}function ve(){const t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);const e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function ge({participantIds:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,matchUps:r}){const a={};function o(t){a[t]||(a[t]={allDefaults:0,defaults:0,retirements:0,walkovers:0,matchUpsWon:0,matchUpsLost:0,victories:[],defeats:[],matchUpsCancelled:0,setsWon:0,setsLost:0,gamesWon:0,gamesLost:0,pointsWon:0,pointsLost:0})}return r.filter((e=>!(null!=t&&t.length)||2===at(t,[ye(e,0),ye(e,1)]).length)).forEach((t=>{const{matchUpStatus:n,score:r,winningSide:s}=t,c=s&&function(t){return ye(t,t.winningSide-1)}(t),d=s&&function(t){return ye(t,1-(t.winningSide-1))}(t);if(!c||!d){const e=ye(t,0),i=ye(t,1);return e&&(o(e),a[e].matchUpsCancelled+=1),void(i&&(o(i),a[i].matchUpsCancelled+=1))}const l=s&&s-1,p=1-l;o(c),o(d),n===E&&(a[d].walkovers+=1),n===S&&(a[d].defaults+=1),n===T&&(a[d].retirements+=1),[S,T,E].includes(n)&&(a[d].allDefaults+=1),a[c].matchUpsWon+=1,a[d].matchUpsLost+=1,a[d].defeats.push(c),a[c].victories.push(d);const m=j({score:r,matchUpStatus:n,matchUpFormat:e,tallyPolicy:i,winningSide:s});a[c].setsWon+=m[l],a[c].setsLost+=m[p],a[d].setsWon+=m[p],a[d].setsLost+=m[l];const f=function({winningSide:t,matchUpFormat:e=v,matchUpStatus:i,tallyPolicy:n,score:r}){var a,o;const{sets:s}=r||{},c=t-1,d=u(e);let l=0,p=0;const m=B((null==d?void 0:d.bestOf)||1),f=(null==d||null===(a=d.setFormat)||void 0===a?void 0:a.setTo)||0,h=(null==d||null===(o=d.setFormat)||void 0===o?void 0:o.tiebreakAt)||0;if(!s)return[l,p];const I=m*f,g=[[],[]];if(i===S&&null!=n&&n.gamesCreditForDefaults||i===E&&null!=n&&n.gamesCreditForWalkovers?g[c].push(I):s&&s.forEach((t=>{({side1Score:l,side2Score:p}=t),g[0].push(parseInt(l||0)),g[1].push(parseInt(p||0))})),i===T){const n=j({winningSide:t,matchUpStatus:i,matchUpFormat:e,sets:s}),r=n.reduce(((t,e)=>t+e),0);if(g.map((t=>t[c]<=t[1-c])).reduce(((t,e)=>t+e),0)>n[1-c]){const t=g[c].length,e=function(t){if(d&&""!==t)return+t==h-1||+t===h?parseInt(h||0)+1:+t<h?f:h}(g[1-c][t-1]);e&&(g[c][t-1]=e)}r>g[c].length&&g[c].push(f)}const y=[g[0].reduce(((t,e)=>t+e),0),g[1].reduce(((t,e)=>t+e),0)];return[T,E,S].includes(i)&&y[c]<I&&(y[c]=I),y}({score:r,matchUpStatus:n,matchUpFormat:e,tallyPolicy:i,winningSide:s});a[c].gamesWon+=f[l],a[c].gamesLost+=f[p],a[d].gamesWon+=f[p],a[d].gamesLost+=f[l];const h=function({score:t}){var e;const i=[0,0];return null==t||null===(e=t.sets)||void 0===e||e.forEach((t=>{t.side1TiebreakScore&&(i[0]+=parseInt(t.side1TiebreakScore)),t.side2TiebreakScore&&(i[1]+=parseInt(t.side2TiebreakScore))})),i}({score:r,tallyPolicy:i});a[c].pointsWon+=h[l],a[c].pointsLost+=h[p],a[d].pointsWon+=h[p],a[d].pointsLost+=h[l]})),function({participantResults:t,matchUpFormat:e,perPlayer:i}){var n;const r=e&&u(e)||{},a=r.bestOf,o=a&&Math.ceil(a/2)||1,s=null===(n=r.setFormat)||void 0===n?void 0:n.setTo;Object.keys(t).forEach((e=>{const n=t[e].setsWon,r=t[e].setsLost,a=i*(o||0)||n;let c=Math.round(n/r*1e3)/1e3;(c===1/0||isNaN(c))&&(c=a);const u=t[e].matchUpsWon,d=t[e].matchUpsLost;let l=Math.round(u/d*1e3)/1e3;(l===1/0||isNaN(l))&&(l=u);const p=t[e].gamesWon||0,m=t[e].gamesLost||0,f=(i||0)*(o||0)*(s||0),h=Math.max(f,p+m);let I=Math.round(p/h*1e3)/1e3;(I===1/0||isNaN(I))&&(I=0);let v=Math.round(t[e].pointsWon/t[e].pointsLost*1e3)/1e3;(v===1/0||isNaN(v))&&(v=0),t[e].setsRatio=c,t[e].matchUpsRatio=l,t[e].gamesRatio=I,t[e].pointsRatio=v,t[e].result=`${t[e].matchUpsWon}/${t[e].matchUpsLost}`,t[e].games=`${t[e].gamesWon}/${t[e].gamesLost}`}))}({participantResults:a,perPlayer:n,matchUpFormat:e}),{participantResults:a}}function ye(t,e){if(!t||!t.sides)return console.log("no sides:",{matchUp:t}),"foo";const i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Ue(t){return x.includes(null==t?void 0:t.matchUpStatus)||(null==t?void 0:t.winningSide)}const we=[{attribute:"matchUpsRatio",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsRatio",idsFilter:!1},{attribute:"gamesRatio",idsFilter:!1},{attribute:"pointsRatio",idsFilter:!1},{attribute:"matchUpsRatio",idsFilter:!0},{attribute:"setsRatio",idsFilter:!0},{attribute:"gamesRatio",idsFilter:!0},{attribute:"pointsRatio",idsFilter:!0}];function Se(t){const{participantResults:e,subOrderMap:i}=t;if(!function({participantResults:t,participantsCount:e}){let i=De({participantResults:t}).filter((t=>e-1===t.results.matchUpsWon+t.results.matchUpsLost+t.results.matchUpsCancelled));return e===i.length}(t))return;const n=Pe({attribute:"matchUpsWon",participantResults:e}),r=Object.keys(n).map((t=>parseFloat(t))).sort(((t,e)=>e-t)).map((t=>n[t])).map((e=>Ne({participantIds:e,...t}))).flat(1/0);let a,o=1;r.forEach(((t,e)=>{e&&(t.resolved||a&&!t.resolved)&&(o+=1),a=t.resolved,t.resolved?(t.position=e+1,o=t.position):t.position=o}));const s=Q(r.map((({position:t})=>t)));return r.forEach((t=>{const n=e[t.participantId],r=s[t.position];void 0!==t&&void 0!==t.position&&(r>1&&(n.ties=r,i&&(n.subOrder=i[t.participantId])),t.groupOrder=t.position+(n.subOrder||1)-1,n.rankOrder=t.position),n.GEMscore=function(t){return t.matchUpsRatio*Math.pow(10,16)+t.setsRatio*Math.pow(10,12)+t.gamesRatio*Math.pow(10,8)+t.pointsRatio*Math.pow(10,3)}(n)})),r}function Ne({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){if(1===i.length)return{resolved:!0,participantId:i[0]};if(2===i.length&&(null==r||!r.headToHead||!r.headToHead.disabled&&!e)){const e=function({participantIds:t,participantResults:e}){return e[t[0]].victories.includes(t[1])?t.map((t=>({resolved:!0,participantId:t}))):e[t[1]].victories.includes(t[0])?t.reverse().map((t=>({resolved:!0,participantId:t}))):void 0}({participantIds:i,participantResults:t});if(e)return e}let o;return((null==r?void 0:r.tallyDirectives)||we).every((({attribute:t,reversed:e,idsFilter:s,disableHeadToHead:c})=>(o=function({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:o,reversed:s}){const{participantResults:c}=ge({participantIds:a&&e,matchUpFormat:i,tallyPolicy:n,matchUps:o}),u=Pe({participantResults:c,participantIds:e,attribute:r});if(Object.keys(u).length>1)return Object.keys(u).map((t=>parseFloat(t))).sort(((t,e)=>s?t-e:e-t)).map((t=>u[t])).map((e=>Ne({participantResults:c,disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,matchUps:o}))).flat(1/0)}({disableHeadToHead:c,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:t,idsFilter:s,matchUps:a,reversed:e}),!o))),o||i.map((t=>({participantId:t})))}function Pe({participantResults:t,participantIds:e,attribute:i}){return De({participantResults:t,participantIds:e}).reduce(((t,e)=>{const{participantId:n,results:r}=e,a=r[i];return t[a]?t[a].push(n):t[a]=[n],t}),{})}function De({participantResults:t,participantIds:e}){return(e=e||Object.keys(t)).reduce(((e,i,n)=>(e.push({participantId:i,i:n,results:t[i]}),e)),[])}function Te({policyDefinitions:t,matchUpFormat:e,matchUps:i=[],subOrderMap:n,perPlayer:r}){if(!Array.isArray(i))return{error:"Missing matchUps"};if(1!==i.reduce(((t,{structureId:e})=>t.includes(e)?t:t.concat(e)),[]).length)return{error:gt};const a=i.filter((t=>t&&t.matchUpStatus!==y)),o=a.length&&J(a.map((({drawPositions:t})=>t)).flat()).length,s=a.filter(Ue).length===a.length;s||(r=0);const c=t&&t.roundRobinTally,u=i.filter(Ue),{participantResults:d}=ge({matchUps:u,matchUpFormat:e,tallyPolicy:c,perPlayer:r}),l=Se({matchUps:u,participantResults:d,participantsCount:o,matchUpFormat:e,tallyPolicy:c,subOrderMap:n});return s&&l&&l.forEach((t=>{d[t.participantId].groupOrder=t.groupOrder})),{participantResults:d}}const Me="CHECK_IN",Ae="CHECK_OUT",Ee="SCHEDULE.ASSIGNMENT.COURT",be="SCHEDULE.ASSIGNMENT.VENUE",Re="SCHEDULE.TIME.START",Ce="SCHEDULE.TIME.STOP",Oe="SCHEDULE.TIME.RESUME",Le="SCHEDULE.TIME.END",xe="SCALE",Fe={ASSIGN_COURT:Ee,ASSIGN_OFFICIAL:"SCHEDULE.ASSIGN.OFFICIAL",ASSIGN_VENUE:be,CHECK_IN:Me,CHECK_OUT:Ae,END_TIME:Le,HIDDEN:"HIDDEN",MEDICAL:"MEDICAL",OTHER:"other",PENALTY:"PENALTY",PUBLIC:"PUBLIC",PUBLISH:"PUBLISH",RANKING:"RANKING",RATING:"RATING",RESUME_TIME:Oe,RETRIEVAL:"RETRIEVAL",SCALE:xe,SCHEDULED_DATE:"SCHEDULE.DATE",SCHEDULED_TIME:"SCHEDULE.TIME.SCHEDULED",SEEDING:"SEEDING",START_TIME:Re,STATUS:"STATUS",STOP_TIME:Ce,SUSPENSION:"SUSPENSION"};function ke(t){if(Gt.test(t)){const e=zt();return new Date(`${e}T${t}`)}return new Date(t)}function _e({matchUp:t}){if(!t)return{error:"Missing matchUp"};if(!t.timeItems)return{error:"Missing timeItems"};const e=t.timeItems.filter((t=>[Re,Ce,Oe,Le].includes(null==t?void 0:t.itemType))).sort(((t,e)=>ke(t.itemValue)-ke(e.itemValue))),i=e.reduce(((t,e)=>{var i,n;let r;const a=null==e||null===(i=e.itemType)||void 0===i?void 0:i.split("."),o=`SCHEDULE.TIME.${(null==e||null===(n=e.itemType)||void 0===n?void 0:n.startsWith("SCHEDULE.TIME"))&&a[2]}`;switch(o){case Re:r=0;break;case Le:if(t.lastValue&&[Re,Oe].includes(t.lastType)){const i=ke(e.itemValue)-ke(t.lastValue);r=t.milliseconds+i}else r=t.milliseconds;break;case Ce:if([Re,"SCHECULE.TIME.RESUME"].includes(t.lastType)){const i=ke(e.itemValue)-ke(t.lastValue);r=t.milliseconds+i}else r=t.milliseconds;break;default:r=t.milliseconds}return{milliseconds:r,lastType:o,lastValue:e.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([Re,Oe].includes(i.lastType)){const t=new Date-ke(i.lastValue);i.milliseconds+=t}return{milliseconds:i.milliseconds,time:je(i.milliseconds),relevantTimeItems:e}}function je(t){const e=(t,e=2)=>("00"+t).slice(-e);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function Be({categoryName:t,categoryType:e,timesBlockArray:i}){return i.filter((t=>Array.isArray(t))).map((i=>i.sort(((t,e)=>{var i,n;return((null===(i=e.categoryNames)||void 0===i?void 0:i.length)||0)-((null===(n=t.categoryNames)||void 0===n?void 0:n.length)||0)})).find((({categoryTypes:i,categoryNames:n})=>!(null!=n&&n.length)&&!(null!=i&&i.length)||(null==n?void 0:n.includes(t))||(null==i?void 0:i.includes(e)))))).find(Boolean)}function Ge({matchUpAverageTimes:t,matchUpFormat:e}={}){const i=(null==t?void 0:t.map((({matchUpFormatCodes:t})=>null==t?void 0:t.filter((t=>t===e)))).flat().filter(Boolean).sort(((t,e)=>((null==t?void 0:t.length)||0)-((null==e?void 0:e.length)||0))))||[],n=i.includes(e)?e:i[0],r=null==t?void 0:t.find((({matchUpFormatCodes:t,averageTimes:e})=>(null==t?void 0:t.find((t=>n===t)))&&e));return null==r?void 0:r.averageTimes}function Ve({matchUpRecoveryTimes:t,averageMinutes:e,matchUpFormat:i}={}){var n;return null==t||null===(n=t.find((({matchUpFormatCodes:t,averageTimes:n,recoveryTimes:r})=>{if(n&&e){const{greaterThan:t=0,lessThan:i=360}=n;if(e>t&&e<i)return!0}return(null==t?void 0:t.find((t=>t===i)))&&r})))||void 0===n?void 0:n.recoveryTimes}const He={APPLIED_POLICIES:"appliedPolicies",DELEGATED_OUTCOME:"delegatedOutcome",DISABLE_LINKS:"disableLinks",DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:"entryProfile",FLIGHT_PROFILE:"flightProfile",GROUPING_ATTRIBUTE:"groupingAttribute",LINEUPS:"lineUps",LINKED_TOURNAMENTS:"linkedTournamentsIds",PARTICIPANT_REPRESENTATIVES:"participantRepresentatives",PERSON_REQUESTS:"personRequests",SCHEDULE_LIMITS:"scheduleLimits",SCHEDULE_TIMING:"scheduleTiming",SCHEDULING_PROFILE:"schedulingProfile",SUB_ORDER:"subOrder",TALLY:"tally"};function qe({tournamentRecord:t}){return ze({extensions:(null==t?void 0:t.extensions)||[]})}function We({event:t}){return t?ze({extensions:t.extensions||[]}):{error:ht}}function ze({extensions:t}){const e=t.find((t=>"appliedPolicies"===t.name));return{appliedPolicies:(null==e?void 0:e.value)||{}}}function Ke({tournamentRecord:t,event:e,policyType:i}){if(!t)return{error:pt};if(e){const{appliedPolicies:t}=We({event:e});if(t&&t[i])return{policy:t[i]}}const{appliedPolicies:n}=qe({tournamentRecord:t});return null!=n&&n[i]?{policy:n[i]}:{error:"Policy not found"}}function Ye({tournamentParticipants:t=[],policyDefinitions:e={},participantId:i,personId:n}){const r=t.find((t=>i&&t.participantId===i||n&&t.person&&t.person.personId===n)),a=null==e?void 0:e.participant;return null!=a&&a.participant?Y({template:a.participant,source:r}):me(r)}function $e({tournamentRecord:t,participantId:e}){return{participant:(t.participants||[]).reduce(((t,i)=>i.participantId===e?i:t),void 0)}}function Je({element:t,name:e}){if(!t||!e)return{error:It};if(!Array.isArray(t.extensions))return{message:yt};const i=t.extensions.find((t=>(null==t?void 0:t.name)===e));return{extension:i,message:i?void 0:yt}}function Ze({tournamentRecord:t,name:e}){return Je({element:t,name:e})}function Qe({event:t,name:e}){return t?Je({element:t,name:e}):{error:ht}}function Xe({drawDefinition:t,name:e}){return t?Je({element:t,name:e}):{error:mt}}function ti({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var r,a,o;e=e||(null==n||null===(r=n.category)||void 0===r?void 0:r.categoryName)||(null==n||null===(a=n.category)||void 0===a?void 0:a.ageCategoryCode),i=i||(null==n||null===(o=n.category)||void 0===o?void 0:o.categoryType);const{policy:s}=Ke({policyType:"scheduling",tournamentRecord:t,event:n}),{extension:c}=Ze({tournamentRecord:t,name:"scheduleTiming"}),u=null==c?void 0:c.value,{extension:d}=Qe({event:n,name:"scheduleTiming"});return{scheduleTiming:{categoryName:e,categoryType:i,eventScheduling:null==d?void 0:d.value,tournamentScheduling:u,policy:s}}}const ei="SINGLES",ii="DOUBLES",ni="TEAM",ri={SINGLES:ei,DOUBLES:ii,TEAM:ni},ai="total",oi={TOTAL:ai,SINGLES_DOUBLES:"SINGLES_DOUBLES",DOUBLES_SINGLES:"DOUBLES_SINGLES"};function si({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:s}){if(!i)return{error:pt};o=o||(null==s?void 0:s.eventType);const c={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=ti({tournamentRecord:i,categoryName:r,categoryType:a,event:s});return ci({eventType:o,timingDetails:{...u,matchUpFormat:n,categoryType:a,defaultTiming:c}})}function ci({eventType:t,timingDetails:e}){const i=function({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:o}){var s;return Be({categoryName:e,categoryType:i,timesBlockArray:[(null==a?void 0:a.matchUpAverageTimes)&&Ge({...a,matchUpFormat:t}),(null==r?void 0:r.matchUpAverageTimes)&&Ge({...r,matchUpFormat:t}),(null==o?void 0:o.matchUpAverageTimes)&&Ge({...o,matchUpFormat:t}),null==o||null===(s=o.defaultTimes)||void 0===s?void 0:s.averageTimes,null==n?void 0:n.averageTimes]})}(e),n=Object.keys((null==i?void 0:i.minutes)||{}),r=(null==i?void 0:i.minutes)&&((null==n?void 0:n.includes(t))&&i.minutes[t]||i.minutes.default),a=function({matchUpFormat:t,categoryName:e,categoryType:i,averageMinutes:n,defaultTiming:r,tournamentScheduling:a,eventScheduling:o,policy:s}){var c;return Be({categoryName:e,categoryType:i,timesBlockArray:[(null==o?void 0:o.matchUpRecoveryTimes)&&Ve({...o,averageMinutes:n,matchUpFormat:t}),(null==a?void 0:a.matchUpRecoveryTimes)&&Ve({...a,averageMinutes:n,matchUpFormat:t}),(null==s?void 0:s.matchUpRecoveryTimes)&&Ve({...s,averageMinutes:n,matchUpFormat:t}),null==s||null===(c=s.defaultTimes)||void 0===c?void 0:c.recoveryTimes,null==r?void 0:r.recoveryTimes]})}({...e,averageMinutes:r}),o=Object.keys((null==a?void 0:a.minutes)||{}),s=(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(t))&&a.minutes[t]||a.minutes.default),c=t===ei?"SINGLES_DOUBLES":"DOUBLES_SINGLES";return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(c))&&a.minutes[c]||s)}}function ui({tournamentRecord:t,eventId:e,drawId:i}){if(!t)return{error:pt};const n=(null==t?void 0:t.events)||[];if(i){let t;const e=n.find((e=>{const n=((null==e?void 0:e.drawDefinitions)||[]).find((t=>t.drawId===i));return n&&(t=n),n}));if(e)return{event:e,drawDefinition:t}}if(e){const t=n.find((t=>t.eventId===e));return t?{event:t}:{error:"Event not found"}}return{error:It}}function di({tournamentRecord:t,drawId:e}){if(!t)return{error:pt};if(!e)return{error:"Missing drawId"};const i=(t.events||[]).reduce(((t,i)=>{const n=(i.drawDefinitions||[]).reduce(((t,i)=>i.drawId===e?i:t),void 0);return n&&n.drawId===e?{event:i,drawDefinition:n}:t}),void 0);return i?{...i,SUCCESS:ut}:{error:"drawDefinition not found"}}function li(t,e,i){const n=t=>t.createdAt?new Date(t.createdAt).getTime():0,r=t.filter((t=>t&&t.itemType===e&&(!i||n(t)<i))).sort(((t,e)=>n(t)-n(e))).pop();return r&&r.itemValue}function pi({matchUp:t,visibilityThreshold:e}){return{scheduledTime:li((null==t?void 0:t.timeItems)||[],"SCHEDULE.TIME.SCHEDULED",e)}}function mi({matchUp:t,visibilityThreshold:e}){return{scheduledDate:li((null==t?void 0:t.timeItems)||[],"SCHEDULE.DATE",e)}}function fi({matchUp:t,visibilityThreshold:e}){return{courtId:li((null==t?void 0:t.timeItems)||[],Ee,e)}}function hi({matchUp:t,visibilityThreshold:e}){return{venueId:li((null==t?void 0:t.timeItems)||[],be,e)}}const Ii="SINGLES",vi="DOUBLES",gi="TEAM",yi={SINGLES:Ii,DOUBLES:vi,TEAM:gi,AGE:"AGE",RATING:"RATING",BOTH:"BOTH"};function Ui({tournamentRecord:t}){if(!t)return{error:pt};const e=me(t.venues||[]),i=e.reduce(((t,e)=>{var i;return null!=e&&null!==(i=e.courts)&&void 0!==i&&i.length?t.concat(e.courts):t}),[]);return{venues:e,courts:i}}function wi({tournamentRecord:t,venueId:e}){if(!t)return{error:pt};if(!e)return{error:"Missing venueId"};const i=(t.venues||[]).reduce(((t,i)=>i.venueId===e?i:t),void 0);return i&&{venue:i}||{error:"Venue not found"}}function Si({tournamentRecord:t,courtId:e}){if(!t)return{error:pt};if(!e)return{error:"Missing courtId"};let i,n;return(t.venues||[]).forEach((t=>{(t.courts||[]).forEach((r=>{r.courtId===e&&(i=r,n=t)}))})),i&&{court:i,venue:n}||{error:"Court not found"}}function Ni({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter((t=>e?t.venueId===e:i?i.includes(t.venueId):!e&&!i)).map((t=>{const{venueId:e}=t,i=me(t.courts||[]);return i.forEach((t=>Object.assign(t,{venueId:e}))),i})).flat()}:{error:pt}}function Pi({tournamentRecord:t,courtId:e}){if(!t)return{error:pt};if(!e)return{error:"Missing courtId"};const{court:i,error:n}=Si({tournamentRecord:t,courtId:e});if(n)return{error:n};const r=(({altitude:t,courtId:e,courtName:i,courtDimensions:n,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfaceDate:c,pace:u,notes:d})=>({altitude:t,courtId:e,courtName:i,courtDimensions:n,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfaceDate:c,pace:u,notes:d}))(i);return{...ut,courtInfo:me(r)}}function Di({tournamentRecord:t,venueId:e}){if(!t)return{error:pt};if(!e)return{error:"Missing venueId"};const{venue:i,error:n}=wi({tournamentRecord:t,venueId:e});if(n)return{error:n};const r=(i.courts||[]).map((e=>(({courtInfo:t})=>({...t}))(Pi({tournamentRecord:t,courtId:e.courtId})))),a={...(({venueId:t,venueName:e,venueAbbreviation:i})=>({venueId:t,venueName:e,venueAbbreviation:i}))(i),courtsInfo:r};return{...ut,venueData:me(a)}}function Ti({scheduleVisibilityFilters:t,afterRecoveryTimes:e=!0,tournamentRecord:i,scheduleTiming:n,matchUpFormat:r,matchUpType:a,matchUp:o,event:s}){if(!o)return{error:"Missing matchUp"};if(!o.matchUpType&&!a&&(s||i)&&o.drawId){var c,u,d,l,p,m;let t=null===(c=s)||void 0===c?void 0:c.drawDefinitions.find((t=>t.drawId===o.drawId));!t&&i&&({drawDefinition:t,event:s}=ui({tournamentRecord:i,drawId:o.drawId}));const e=o.structureId&&(null===(u=t)||void 0===u||null===(d=u.structures)||void 0===d?void 0:d.find((({structureId:t})=>t===o.structureId)));a=(null==e?void 0:e.matchUpType)||(null===(l=t)||void 0===l?void 0:l.matchUpType)||(null===(p=s)||void 0===p?void 0:p.eventType)!==gi&&(null===(m=s)||void 0===m?void 0:m.eventType)}const{milliseconds:f,time:h}=_e({matchUp:o}),{startTime:I}=function({matchUp:t}){const e=(null==t?void 0:t.timeItems)||[],i=t=>t.createdAt?new Date(t.createdAt).getTime():0,n=e.reduce(((t,e)=>{const n=e.itemType===Re&&e;return n&&(!t||i(n)<i(t))?n:t}),void 0);return{startTime:n&&n.itemValue}}({matchUp:o}),{endTime:v}=function({matchUp:t}){const e=(null==t?void 0:t.timeItems)||[],i=t=>t.createdAt?new Date(t.createdAt).getTime():0,n=e.reduce(((t,e)=>{const n=e.itemType===Le&&e;return n&&(!t||i(n)>i(t))?n:t}),void 0);return{endTime:n&&n.itemValue}}({matchUp:o});let g;const{visibilityThreshold:y,eventIds:U,drawIds:w}=t||{};if(U&&!U.includes(o.eventId)||w&&!w.includes(o.drawId))g=fe({time:h,startTime:I,endTime:v,milliseconds:f});else{var S;const t={matchUp:o,visibilityThreshold:y};let{scheduledDate:s}=mi(t);const{scheduledTime:c}=pi(t),{courtId:u}=fi(t),{venueId:d}=hi(t);let l,p,m,U,w;if(null!=n&&n.policy&&c&&e){const t={matchUpFormat:o.matchUpFormat||r,...n};({averageMinutes:p=0,recoveryMinutes:m=0,typeChangeRecoveryMinutes:U=0}=ci({eventType:o.matchUpType||a,timingDetails:t})),(p||m)&&(l=v?ce(ie(v),m):ce(c,p+m)),U&&(w=v?ce(ie(v),U):ce(c,p+U))}!s&&c&&(s=ne(c));const N=ie(c);let P=ne(s);P&&N&&(P+=`T${N}`);const D=(null===(S=i&&d&&Di({tournamentRecord:i,venueId:d}))||void 0===S?void 0:S.venueData)||{},{venueName:T,venueAbbreviation:M,courtsInfo:A}=D,E=u&&(null==A?void 0:A.find((t=>t.courtId===u)));g=fe({typeChangeTimeAfterRecovery:w,timeAfterRecovery:l,scheduledDate:s,scheduledTime:c,isoDateString:P,venueAbbreviation:M,venueName:T,venueId:d,courtName:null==E?void 0:E.courtName,courtId:u,typeChangeRecoveryMinutes:U,recoveryMinutes:m,averageMinutes:p,milliseconds:f,startTime:I,endTime:v,time:h})}const N=x.includes(o.matchUpStatus),{scheduledDate:P}=mi({matchUp:o}),{scheduledTime:D}=pi({matchUp:o});return{schedule:g,endDate:N&&(ne(v)||ne(P)||ne(D))||void 0}}function Mi({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find((t=>t.matchUpId===e))}}function Ai({checkCollectionIds:t=!0,tieFormat:e}={}){var i,n,r,a;const o=[];if("object"!=typeof e)return o.push("tieformat must be an object"),{error:"Invalid tieFormat",errors:o};if("object"!=typeof e.winCriteria)return o.push("tieFormat.winCriteria must be an object"),{error:"Invalid tieFormat",errors:o};if(!Array.isArray(e.collectionDefinitions))return o.push("tieFormat.collectionDefinitiosn must be an array of objects"),{error:"Invalid tieFormat",errors:o};const s="number"==typeof(null===(i=e.winCriteria)||void 0===i?void 0:i.valueGoal)&&(null===(n=e.winCriteria)||void 0===n?void 0:n.valueGoal)>0||(null===(r=e.winCriteria)||void 0===r?void 0:r.aggregateValue);if(!(s||null!==(a=e.winCriteria)&&void 0!==a&&a.aggregateValue))return o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),{error:"Invalid tieFormat",errors:o};const c=e.collectionDefinitions.every((e=>{if("object"!=typeof e)return o.push(`collectionDefinition must be an object: ${e}`),!1;const{collectionValueProfile:i,collectionGroupNumber:n,collectionValue:r,collectionId:a,matchUpCount:s,matchUpFormat:c,matchUpValue:u,matchUpType:d,scoreValue:l,setValue:p}=e;if(t&&"string"!=typeof a)return o.push(`collectionId is not type string: ${a}`),!1;if("number"!=typeof s)return o.push(`matchUpCount is not type number: ${s}`),!1;if(![ei,ii].includes(d))return o.push(`matchUpType must be SINGLES or DOUBLES: ${d}`),!1;if(!(u||r||i||l||p))return o.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfile"),!1;if(u&&"number"!=typeof u)return o.push(`matchUpValue is not type number: ${u}`),!1;if(r&&"number"!=typeof r)return o.push(`collectionValue is not type number: ${r}`),!1;if(i){if(!Array.isArray(i))return o.push(`collectionValueProfile is not an array: ${i}`),!1;if(i.length!==s)return o.push("collectionValueProfile does not align with matchUpsCount"),!1;for(const e of i){if("object"!=typeof e)return o.push(`valueProfile is not type object: ${e}`),!1;const{value:t,collectionPosition:i}=e;if("number"!=typeof t||"number"!=typeof i||i>s||i<1)return o.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),!1}const t=i.map((t=>t.collectionPosition));if(t.length!==J(t).length)return o.push("collectionPositions are not unique"),!1}return n&&"number"!=typeof n?(o.push(`collectionValue is not type number: ${r}`),!1):!(c&&!I.isValid(c)&&(o.push(`Invalid matchUpFormat: ${c}`),1))})),u=e.collectionDefinitions.map((({collectionId:t})=>t)),d=!t||u.length===J(u).length,l=c&&s&&d,p={valid:l,errors:o};return l||(p.error="Invalid tieFormat"),p}function Ei({sideAdjustments:t=[0,0],separator:e="-",tieFormat:i,matchUp:n}){var r,a;if(!Array.isArray(t)||2!==t.length||isNaN(t.reduce(((t,e)=>t+e))))return{error:gt};if(!n)return{error:"Missing matchUp"};if(!(i=n.tieFormat||i))return{error:"Missing tieFormat"};const o=Ai({tieFormat:i});if(!o.valid)return{error:gt,errors:o.errors};const s=[0,0],c=(null==n?void 0:n.tieMatchUps)||[],u=(null===(r=i)||void 0===r?void 0:r.collectionDefinitions)||[];for(const h of u){const t=c.filter((t=>t.collectionId===h.collectionId)),e=[0,0];let i=[0,0];const n=t.every((t=>x.includes(t.matchUpStatus))),{collectionValueProfile:r,collectionValue:a,matchUpValue:o,winCriteria:u,scoreValue:d,setValue:l}=h;if(o?t.forEach((t=>{t.winningSide&&(e[t.winningSide-1]+=o)})):l?t.forEach((t=>{var i,n;null===(i=t.score)||void 0===i||null===(n=i.sets)||void 0===n||n.forEach((t=>{t.winningSide&&(e[t.winningSide-1]+=l)}))})):d?t.forEach((t=>{var i,n;null===(i=t.score)||void 0===i||null===(n=i.sets)||void 0===n||n.forEach((t=>{const{side1Score:i=0,side2Score:n=0}=t;e[0]+=i,e[1]+=n}))})):Array.isArray(r)&&t.forEach((t=>{if(t.winningSide){const i=t.collectionPosition,n=bi({collectionDefinition:h,collectionPosition:i});e[t.winningSide-1]+=n}})),a){const r=[0,0];let o;if(t.forEach((t=>{t.winningSide&&(r[t.winningSide-1]+=1)})),null!=u&&u.aggregateValue)n&&e[0]!==e[1]&&(o=e[0]>e[1]?1:2);else if(null!=u&&u.valueGoal)o=e.reduce(((t,e,i)=>e>=u.valueGoal?i+1:t),void 0);else{const t=Math.floor(h.matchUpCount/2)+1;o=r.reduce(((e,i,n)=>i>=t?n+1:e),void 0)}o&&(i[o-1]+=a)}else i=e;i.forEach(((t,e)=>s[e]+=t))}const d=s.map(((e,i)=>e+t[i])),l={side1Score:d[0],side2Score:d[1]},p=d.join(e),m=d.slice().reverse().join(e);let f;if(null!==(a=i)&&void 0!==a&&a.winCriteria){const{valueGoal:t,aggregateValue:e}=i.winCriteria;if(t){const e=d.map(((t,e)=>({sideNumber:e+1,points:t}))).find((({points:e})=>e>=t));f=null==e?void 0:e.sideNumber}else if(e){c.every((t=>x.includes(t.matchUpStatus)||t.winningSide))&&d[0]!==d[1]&&(f=d[0]>d[1]?1:2)}}return{scoreStringSide1:p,scoreStringSide2:m,winningSide:f,set:l}}function bi({collectionDefinition:t,collectionPosition:e}){const i=t.collectionValueProfile||[],n=null==i?void 0:i.find((t=>t.collectionPosition===e));return null==n?void 0:n.matchUpValue}const Ri="INDIVIDUAL",Ci="TEAM",Oi="PAIR",Li="GROUP",xi={INDIVIDUAL:Ri,TEAM:Ci,PAIR:Oi,GROUP:Li},Fi=t=>{var e;const{isSide1:i,lowValue:n,setTo:r,tiebreakAt:a,NoAD:o}=t;if(void 0===n)return{error:It};let s,c=parseInt(n);return(null===(e=c)||void 0===e?void 0:e.toString().length)>2&&(c=parseInt(c.toString().slice(0,2))),a&&a<r&&c>a&&(c=a),s=o&&!a?c<r?r:r-1:c+1<r||a&&a<r&&c===a?r:a?r+1:c+2,[i?c:s,i?s:c]},ki=t=>{var e;const{isSide1:i,lowValue:n,tiebreakTo:r,tiebreakNoAd:a}=t;if(void 0===n)return{error:It};let o=parseInt(n);(null===(e=o)||void 0===e?void 0:e.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),a&&o>r-1&&(o=r-1);const s=function(t){const{lowValue:e,NoAD:i,tiebreakTo:n}=t;return e+1>=n?e+(i?1:2):n}({lowValue:o,NoAD:a,tiebreakTo:r});return[i?o:s,i?s:o]};function _i({analysis:t,set:e}){const i=Bi({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return ji({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function ji({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:a}){var o;if(!a)return{error:It};e=e||i;const s=r&&e.finalSetFormat||(null===(o=e)||void 0===o?void 0:o.setFormat)||{},{side1Score:c,side2Score:u}=a,{NoAD:d,setTo:l,tiebreakAt:p,tiebreakFormat:m}=s,f=null==m?void 0:m.NoAd,h=Bi({set:a}),I=Math.abs(c-u),v=c>=l||u>=l,g=n||c>=l&&u>=l||p&&p<l&&(c===p||u===p),y=t||g&&(1===h&&a.side1TiebreakScore>a.side2TiebreakScore||2===h&&a.side2TiebreakScore>a.side1TiebreakScore);return(v&&(I>=(d||g&&(p&&!n||n&&f)?1:2)||g)||n)&&(!g||y)}function Bi({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}const Gi=["RET","DEF","WO","WO/WO","ABN","SUS","INT"],Vi="ABANDONED",Hi="SUSPENDED",qi="INTERRUPTED",Wi=["RETIRED","DEFAULTED","WALKOVER"],zi=["up","left","shift+tab"],Ki=["enter","down","tab","right"],Yi="backspace",$i=["r","d","w","a","s","i"],Ji=["[","("],Zi=[...zi,...Ki,"space","]"],Qi="-",Xi="-",tn=["/"],en=["0","1","2","3","4","5","6","7","8","9"].concat($i),nn=en.map((t=>`shift+${t}`)),rn=[Qi,Yi].concat(Zi,tn),an=[en,nn,rn].join(","),on=[an,zi,Ki,["=","+","num_1","num_2","shift+=","shift+-"]].join(",");[].concat(...en,...en,...rn,...en,...en,...en,...en,...en,...en);const sn={SIDE1KEYS:en,SIDE2KEYS:nn,MODIFIERS:rn,PROMPT:"Enter Score",MOVEUP:zi,MOVEDOWN:Ki,HOTKEYS:on};function cn({scoreString:t,lowSide:e,outcome:i}){return({scoreString:t}=un({scoreString:t})),2===e?t+(" "!==(t&&t[t.length-1])?" ":"")+i:i+" "+t}function un({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(const n of Gi){var i;const r=null===(i=t)||void 0===i?void 0:i.indexOf(n);0===r?t=t.slice(n.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t&&t.trim()||(t=""),{scoreString:t,removed:e}}function dn({analysis:t,scoreString:e,sets:i,lowSide:n}){let r,a;if(!e)return{scoreString:e,sets:i};const{scoreString:o,removed:s}=un({scoreString:e});if(e=o,s)return{scoreString:e,sets:i,outcomeRemoved:!0};let c=i[i.length-1]||{};const u=Object.values(c).filter((t=>void 0!==t)).length;c.setNumber&&1===u&&(c=(i=i.slice(0,i.length-1))[i.length-1]||{});const{tiebreakSet:d}=t.setFormat,{tiebreakTo:l,NoAD:p}=d||{},{isTiebreakEntry:m}=ln({scoreString:e,brackets:"[]"}),f=function(t){return t.split("").reduce(((t,e,i)=>(e.match(/\d+/g)&&t.push(i),t)),[]).pop()}(e);if(f>=0){r=e.slice(0,f);const{isTiebreakEntry:o}=ln({scoreString:r,brackets:"()"}),{lastOpenBracketIndex:s,isTiebreakEntry:u}=ln({scoreString:r,brackets:"[]"}),d=r&&r[r.length-1].trim(),S=r&&!isNaN(d);let N=t.isIncompleteSetScore;if(m&&u){const t=r.slice(s+1).split(Xi),i=(null==t?void 0:t.length)>0&&void 0!==t[0]&&!isNaN(parseInt(t[0]))&&parseInt(t[0])||void 0,a=(null==t?void 0:t.length)>1&&void 0!==t[1]&&parseInt(t[1])||void 0,o=[i,a];if(a){const t=1===n?1:0;o[t]=o[1-t]+(p?1:2),o[t]<l&&(o[t]=l),r=e.slice(0,s+1),r+=o.join(Xi)}else void 0!==i?(r=e.slice(0,s+1),r+=i):(r=e.slice(0,s),N=!0);c.side1TiebreakScore=o[0]||0,c.side2TiebreakScore=o[1]||0}if(r.length||(r=void 0),N){var h;const e=null===(h=c.side1Score)||void 0===h?void 0:h.toString();if(e){const t=null==e?void 0:e.slice(0,e.length-1);c.side1Score=!isNaN(t)&&parseInt(t)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}var I,v;t.isTimedSet?(a=c.side1Score?i:(null===(I=i)||void 0===I?void 0:I.slice(0,i.length-1))||[],a[i.length-1]=c):a=(null===(v=i)||void 0===v?void 0:v.slice(0,i.length-1))||[]}else if(S){var g,y;const e=null===(g=c.side2Score)||void 0===g?void 0:g.toString(),n=null===(y=c.side1Score)||void 0===y?void 0:y.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(c.side2Score){const t=null==e?void 0:e.slice(0,e.length-1);c.side2Score=!isNaN(t)&&parseInt(t)||void 0}else{const t=null==n?void 0:n.slice(0,n.length-1);c.side1Score=!isNaN(t)&&parseInt(t)||void 0}var U;t.isTimedSet?c.side1Score?(a=i||[],a[i.length-1]=c):a=(null===(U=i)||void 0===U?void 0:U.slice(0,i.length-1))||[]:(a=i||[],a[i.length-1]=c),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else if(o)a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0});else{var w;m&&!u?a=(null===(w=i)||void 0===w?void 0:w.slice(0,i.length-1))||[]:(a=i,a[i.length-1]=c),m||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0)}return{scoreString:r,sets:a}}return{scoreString:e,sets:i}}function ln({scoreString:t,brackets:e="()"}){if(!t)return!1;const[i,n]=e.split(""),r=t.split(""),a=Math.max(...rt(i,r));return{isTiebreakEntry:a>Math.max(...rt(n,r)),lastOpenBracketIndex:a}}function pn({lowValue:t=0,NoAD:e=!1,tiebreakTo:i}={}){return t+1>=i?t+(e?1:2):parseInt(i)}function mn({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){const r=u(t),{bestOf:a}=r,o=Math.ceil(a/2),s=n&&n.reduce(((t,e)=>{const{winningSide:i}=e;return i&&t[i-1]++,t}),[0,0]);let c=(null==s?void 0:s.indexOf(o))+1||void 0;return Wi.includes(e)&&i&&(c=i),{matchUpWinningSide:c}}function fn({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let o;return"r"===e?n?(o=!0,n=cn({scoreString:n,lowSide:t,outcome:"RET"}),r=2===t?1:2,a="RETIRED"):(o=!0,n=cn({scoreString:n,lowSide:t,outcome:"DEF"}),r=2===t?1:2,a="DEFAULTED"):"d"===e?(o=!0,n=cn({scoreString:n,lowSide:t,outcome:"DEF"}),r=2===t?1:2,a="DEFAULTED"):"w"===e?(o=!0,i=[],n="WO",r=2===t?1:2,a="WALKOVER"):"s"===e&&n?(o=!0,n=cn({scoreString:n,lowSide:t,outcome:"SUS"}),a=Hi,r=void 0):"a"===e?(o=!0,n=cn({scoreString:n,lowSide:t,outcome:"ABN"}),a=Vi,r=void 0):"i"===e&&n&&(o=!0,n=cn({scoreString:n,lowSide:t,outcome:"INT"}),a=qi,r=void 0),{updated:o,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function hn({sets:t,scoreString:e,winningSide:i,matchUpFormat:n,value:r}){var a,o;const s=((null==t||null===(a=t.filter((t=>null==t?void 0:t.winningSide)))||void 0===a?void 0:a.length)||0)+(i?0:1),c=u(n),d=s===(null==c?void 0:c.bestOf),l=d&&c.finalSetFormat||c.setFormat||{},p=(null==l?void 0:l.timed)||c.timed,m=d&&t[(null==c?void 0:c.bestOf)-1],f=m&&m.winningSide,{isTiebreakEntry:h}=ln({scoreString:e,brackets:"()"}),{isTiebreakEntry:I}=ln({scoreString:e,brackets:"[]"}),v=h||I,g=!!l.tiebreakSet,y=e&&e[e.length-1].trim(),U=e&&!isNaN(y),w=!v&&y===Qi,S=h&&Ji.includes(y),N=I&&Ji.includes(y),P=I&&y===Xi,D=e&&e.split(""),[T]="[]".split(""),M=D&&Math.max(...rt(T,D)),A=D&&Math.max(...rt(Xi,D)),E=D&&A>M,b=null===(o=t[t.length-1])||void 0===o?void 0:o.winningSide,R=(null==t?void 0:t.length)&&!b,C=Gi.find((t=>(null==e?void 0:e.indexOf(t))>=0)),O=!isNaN(r),L="space"===r,x=Zi.includes(r),F=null==e?void 0:e.split("").find((t=>Ji.includes(t)));return{isTiebreakSetValue:g&&O,matchUpScoringFormat:c,setNumber:s,setFormat:l,matchTiebreakHasJoiner:E,isGameScoreEntry:R,isSpace:L,isCloser:x,isTiebreakCloser:x&&F&&v&&U,isDecidingSet:d,isTiebreakSet:g,isTimedSet:p,isNumericEnding:U,isNumericValue:O,hasOpener:F,hasOutcome:C,finalSet:m,finalSetIsComplete:f,lastSetIsComplete:b,isInvalidSetTiebreakValue:L&&v&&S,isInvalidMatchTiebreakValue:x&&I&&!N&&(P||!function({scoreString:t}){if(!t)return!1;const e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]="[]".split(""),a=t.split(""),o=Math.max(...rt(n,a)),s=Math.max(...rt(r,a)),c=Math.max(...rt(Xi,a));return i&&o>s&&c>o}({scoreString:e})),isTiebreakEntry:v,isSetTiebreakEntry:h,isMatchTiebreakEntry:I,isIncompleteSetScore:w,isIncompleteSetTiebreak:S,isIncompleteMatchTiebreak:N,isPartialMatchTiebreakValue:P}}function In(t){const{sets:e,winningSide:i,autoComplete:n,matchUpStatus:r,reversed:a=!1,winnerFirst:o=!0,addOutcomeString:s}=t;if(!e)return{error:It};const c=a||!(!o||!i||1===i),u=s?function({matchUpStatus:t}){return t&&{[T]:"RET",[E]:"WO",[N]:"WO/WO",[M]:"SUS",[g]:"ABN",[S]:"DEF",DEAD_RUBBER:"DR"}[t]||""}({matchUpStatus:r}):"",d=(null==e?void 0:e.sort(vn).map((function(t){const e=!(H(null==(d=t)?void 0:d.side1Score)||H(null==d?void 0:d.side2Score))&&(t=>H(null==t?void 0:t.side1TiebreakScore)||H(null==t?void 0:t.side2TiebreakScore))(t),{side1Score:i,side2Score:r,side1TiebreakScore:a,side2TiebreakScore:o}=t,s=a||(H(a)||n?0:""),u=o||(H(o)||n?0:"");var d;if(e)return`[${(c?[u,s]:[s,u]).join("-")}]`;const l=Math.min(s,u),p=l?`(${l})`:"",m=i||(H(i)||n?0:""),f=r||(H(r)||n?0:"");let h=c?`${[f,m].join("-")}${p}`:`${[m,f].join("-")}${p}`;return["-"," "].includes(h)&&(h=""),h})).filter(Boolean).join(" "))||"";return u?2===i?`${u} ${d}`:`${d} ${u}`:d}function vn(t,e){return t.setNumber-e.setNumber}function gn({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,setObject:n}){if(!n)return;const r=yn({set:n});return function({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:a}){var o;if(!a)return{error:It};e=e||i;const s=r&&e.finalSetFormat||(null===(o=e)||void 0===o?void 0:o.setFormat)||{},{side1Score:c,side2Score:u}=a,{setTo:d,tiebreakAt:l,tiebreakFormat:p}=s,m=null==p?void 0:p.NoAd,f=yn({set:a}),h=Math.abs(c-u),I=c>=d||u>=d,v=n||c>=d&&u>=d||l&&l<d&&(c===l||u===l),g=t||v&&(1===f&&a.side1TiebreakScore>a.side2TiebreakScore||2===f&&a.side2TiebreakScore>a.side1TiebreakScore);return(I&&(h>=(v&&(l&&!n||n&&m)?1:2)||v)||n)&&(!v||g)}({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,set:n})&&r||void 0}function yn({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function Un(t){const{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:"Missing setObject"};const{setNumber:n}=e||{},{bestOf:r}=i||{},a=!(!n||!r||n!==r),o=a&&(null==i?void 0:i.finalSetFormat)||(null==i?void 0:i.setFormat),s=!(null==o||!o.tiebreakSet),c=!(null==o||!o.timed),u=!s&&!c,d=!!(n&&r&&n<=r),l=[null==e?void 0:e.side1Score,null==e?void 0:e.side2Score],p=[null==e?void 0:e.side1PointScore,null==e?void 0:e.side2PointScore],m=[null==e?void 0:e.side1TiebreakScore,null==e?void 0:e.side2TiebreakScore],f=l.filter((t=>void 0!==t)).length,h=p.filter((t=>void 0!==t)).length,I=m.filter((t=>void 0!==t)).length,v=null==l?void 0:l.filter((t=>!isNaN(t))).length,g=null==m?void 0:m.filter((t=>!isNaN(t))).length,{tiebreakAt:y}=o||{},U=y&&2===l.filter((t=>t>=y)).length,w=U&&(l[0]>l[1]?1:l[1]>l[0]?2:void 0),S=!(!g||v),N=!(!e||null==e||!e.winningSide),{error:P,result:D}=function({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:"Missing setObject"};const r=!(null==e||!e.tiebreakSet),a=!(null==e||!e.timed);if(!e||r||a)return{result:!1,error:"not standard set"};if(2!==(null==i?void 0:i.filter((t=>!isNaN(t))).length))return{result:!1,error:"Invalid game scores"};const{setTo:o,tiebreakAt:s,tiebreakFormat:c,NoAD:u}=e||{};if(!o||null==i||!i.find((t=>t>=o)))return{result:!1,error:"Invalid game scores"};const d=[1,2].includes(null==t?void 0:t.winningSide);if(!t||!d)return{result:!1,error:"Invalid winningSide"};const l=(null==t?void 0:t.winningSide)-1,p=1-l,m=i[l],f=i[p],h=m-f;if(!(m>f))return{result:!1,error:"winningSide game scoreString is not high"};const I=s&&c,v=2===(null==n?void 0:n.filter((t=>!isNaN(t))).length),g=n&&n[l],y=n&&n[p],U=s&&2===i.filter((t=>t>=s)).length;if(I){const{NoAD:t,tiebreakTo:e}=c;if(U){if(h>1)return{result:!1,error:"invalid winning game scoreString (5)"};if(!v)return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(e))return{result:!1,error:"tiebreakTo error"};if(!e||null==n||!n.find((t=>t>=e)))return{result:!1,error:"invalid tiebreak scores (2)"};if(m>(s<o?o:o+1))return{result:!1,error:"invalid winning game scoreString (1)"};if(!g||!y||g<y)return{result:!1,error:"winningSide tiebreak value is not high"};const i=t?1:2,r=g-y,a=y>=e-1;if(r&&a&&r<i)return{result:!1,error:"invalid tiebreak scores (3)"}}if(m>o&&(!I||!U))return{result:!1,error:"invalid winning game scoreString (2)"}}const w=u?1:2;return h&&f>=o-1&&!U&&h<w?{result:!1,error:"invalid winning game scoreString (3)"}:h>w&&m>o?{result:!1,error:"invalid winning game scoreString (4)"}:{result:!0}}({setObject:e,setFormat:o,sideGameScores:l,sideTiebreakScores:m}),{error:T,result:M}=function({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:"Missing setObject"};const n=!(null==e||!e.tiebreakSet),r=!(null==e||!e.timed);if(!e||!n||r)return{result:!1,error:"not tiebreak set"};const a=[1,2].includes(null==t?void 0:t.winningSide);if(!t||!a)return{result:!1,error:"Invalid winningSide"};const{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:c}=o||{};if(2!==(null==i?void 0:i.filter((t=>!isNaN(t))).length))return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(c))return{result:!1,error:"tiebreakTo error"};if(null==i||!i.find((t=>t>=c)))return{result:!1,error:"invalid tiebreak scores (2)"};const u=(null==t?void 0:t.winningSide)-1,d=1-u,l=i[u],p=i[d];if(!l||!p||l<p)return{result:!1,error:"winningSide tiebreak value is not high"};const m=l-p;return m&&p>=c-1&&m<(s?1:2)?{result:!1,error:"invalid tiebreak scores (3)"}:{result:!0}}({setObject:e,setFormat:o,sideTiebreakScores:m}),A=u&&!S&&D||s&&S&&M,E={expectTiebreakSet:s,expectTimedSet:c,hasTiebreakCondition:U,isCompletedSet:N,isDecidingSet:a,isTiebreakSet:S,isValidSet:d&&!(s&&!S)&&!(u&&S)&&(!N||A),isValidSetNumber:d,isValidSetOutcome:A,leadingSide:w,setFormat:o,sideGameScores:l,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:h,sideTiebreakScores:m,sideTiebreakScoresCount:I,winningSide:gn({isDecidingSet:a,isTiebreakSet:S,matchUpScoringFormat:i,setObject:e})};return void 0!==(null==e?void 0:e.winningSide)&&(S?(E.isValidTiebreakSetOutcome=M,M||(E.tiebreakSetError=T)):(E.isValidStandardSetOutcome=D,D||(E.standardSetError=P))),E}function wn(t){var e;const{matchUp:i,sideNumber:n,setNumber:r,isTiebreakValue:a,isPointValue:o}=t||{};let{matchUpFormat:s}=t||{};if(!i)return{error:"Missing matchUp"};s=s||(null==i?void 0:i.matchUpFormat);const c=u(s),d=!(null==i||!i.winningSide),l=null===(e=i.score)||void 0===e?void 0:e.sets,p=null==l?void 0:l.length,m=r&&r-1,f=!(null==l||!l.find(((t,e)=>t.setNumber===r&&e===m))),h=(null==l?void 0:l.filter((t=>null==t?void 0:t.winningSide)))||[],I=(null==h?void 0:h.length)||0,v=r&&(null==l?void 0:l.slice(r))||[],g=!!(p&&r&&null!=v&&v.reduce(((t,e)=>(!e||!e.side1Score&&!e.side2Score&&!e.side1TiebreakScore&&!e.side2TiebreakScore&&!e.side1PointScore&&!e.side2PointScore)&&t),!0)),y=r<=p&&l.find((t=>t.setNumber===r)),U=y&&Un({setObject:y,matchUpScoringFormat:c}),{isCompletedSet:w,sideGameScores:S,sideTiebreakScores:N}=U||{},P=!!(y&&!w&&g||r&&r===p+1&&!d),D=[1,2].includes(n),T=D?n-1:0,M=y&&D&&(!a&&!o&&void 0!==S[T]&&S[T]||a&&void 0!==N[T]&&N[T]),A=!!M,E=h&&h.map((t=>Un({setObject:t,matchUpScoringFormat:c}).isValidSetOutcome)).reduce(((t,e)=>t&&e),!0),b=h.reduce(((t,e)=>{const{winningSide:i}=e;return t[i-1]++,t}),[0,0]),R=null==i?void 0:i.winningSide,C=R&&R-1,O=1-C,L=b[C],x=b[O],F=Math.max(...b),k=Q(b)[F],{bestOf:_}=c||{},j=F===(_&&Math.ceil(_/2)||1)&&1===k&&b.indexOf(F)+1||void 0,B=L>x&&R===j;return{isActiveSet:P,isExistingSet:f,existingValue:M,hasExistingValue:A,isValidSideNumber:D,completedSetsCount:I,isCompletedMatchUp:d,isLastSetWithValues:g,validMatchUpOutcome:j&&E&&B,matchUpScoringFormat:c,calculatedWinningSide:j,validMatchUpWinningSide:B,completedSetsHaveValidOutcomes:E,...U}}const Sn={stringifyMatchUpFormat:r,isValidMatchUpFormat:h,parseMatchUpFormat:u,generateTieMatchUpScore:Ei,tallyParticipantResults:Te,getTiebreakComplement:ki,generateScoreString:In,checkSetIsComplete:ji,validateTieFormat:Ai,getSetComplement:Fi,analyzeMatchUp:wn,keyValueScore:function(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:o}=t;const{matchUpFormat:s,shiftFirst:c,auto:u=!0}=t;let d,l;const p=c&&2===e||!c&&1===e;if(!an.includes(i))return{updated:!1,message:"invalid key"};c&&(e=3-e);const{matchUpWinningSide:m}=mn({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=m;const f=hn({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:s});if(tn.includes(i)&&(i=Qi),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&0===parseInt(i)&&(f.isTiebreakCloser=!0),Zi.includes(i)&&f.hasOpener&&(i=""),Zi.includes(i)&&(i="space"),f.lastSetIsComplete){var h;const t=(null===(h=n)||void 0===h?void 0:h.length)&&n[n.length-1];n&&" "!==t&&(n+=" ")}if(f.isTimedSet)({message:l,sets:r,scoreString:n,updated:d,matchUpStatus:o,winningSide:a}=function({analysis:t,lowSide:e,scoreString:i,sets:n,winningSide:r,matchUpStatus:a,message:o,value:s}){var c;let u,d;null!==(c=n)&&void 0!==c&&c.length||s===Yi||(n=[{setNumber:1}]);const l=n.length-1;if($i.includes(s)){const c=n[n.length-1]||{},{side1Score:d,side2Score:l}=c;d&&!l?o="missing side2Score":t.finalSetIsComplete||r?o="final set is already complete":t.isIncompleteSetScore?o="incomplete set scoreString":t.isIncompleteSetScore||({sets:n,scoreString:i,winningSide:r,matchUpStatus:a,updated:u}=fn({lowSide:e,value:s,sets:n,scoreString:i,matchUpStatus:a,winningSide:r}))}else if(s===Yi){var p;if(({scoreString:i,sets:n,outcomeRemoved:d}=dn({analysis:t,scoreString:i,sets:n})),""===(null===(p=i)||void 0===p?void 0:p.trim())&&(i=i.trim()),i||(n=[]),d){const t=n[n.length-1]||{},{side1Score:e,side2Score:i}=t;if(e&&i){const r=e>i?1:i>e?2:void 0;r&&(t.winningSide=r,n.push({setNumber:n.length+1}))}}a=void 0,r=void 0,u=!0}else if(t.hasOutcome)o="has outcome";else{if(r)return{sets:n,scoreString:i,winningSide:r,matchUpStatus:a,updated:!1,message:"matchUp is complete"};if("space"===s){const e=n[n.length-1]||{},{side1Score:a,side2Score:o}=e,s=a>o?1:o>a?2:void 0;!s||r||t.isIncompleteSetScore||(n[n.length-1].winningSide=s,n.push({setNumber:n.length+1}),i+=" ",u=!0)}else if(s===Qi&&void 0!==n[l].side1Score&&void 0===n[l].side2Score&&i&&t.isNumericEnding)i+="-",n[l].side2Score=0,a=void 0,r=void 0,u=!0;else if(!isNaN(s)){let t;if(void 0===n[l].side2Score){const e=parseInt((n[l].side1Score||0).toString()+s).toString().slice(0,2);n[l].side1Score=parseInt(e),t=n[l].side1Score.toString(),u=!0}else{const e=parseInt((n[l].side2Score||0).toString()+s).toString().slice(0,2);n[l].side2Score=parseInt(e),t=[n[l].side1Score,n[l].side2Score].join("-"),u=!0}if(u){const e=(n.slice(0,l)||[]).filter((t=>t)).map((t=>{const{side1Score:e,side2Score:i}=t;return[e,i].join("-")})).join(" ");i=e?e+" "+t:t}}}return{sets:n,scoreString:i,winningSide:r,matchUpStatus:a,message:o,updated:u}}({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:o,winningSide:a,value:i}));else if($i.includes(i))f.finalSetIsComplete||a?l="final set is already complete":f.isTiebreakEntry||f.isIncompleteSetScore?f.isTiebreakEntry||f.isIncompleteSetScore?l="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i}):({sets:r,scoreString:n,matchUpStatus:o,winningSide:a,updated:d}=fn({lowSide:e,sets:r,scoreString:n,matchUpStatus:o,winningSide:a,value:i}));else if(i===Yi)d=!0,({scoreString:n,sets:r}=dn({analysis:f,scoreString:n,sets:r,lowSide:e,auto:u})),n||(r=[]),o=void 0,a=void 0;else if(f.hasOutcome)l="has outcome";else if(i!==Qi||f.isMatchTiebreakEntry)if(i===Xi&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?l="existing joiner":f.isNumericEnding&&(d=!0,n+=Xi);else if([Qi,Xi].includes(i))l="invalid location for joiner";else{if(a)return{updated:!1,message:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:d}=function({analysis:t,scoreString:e,sets:i,value:n}){let r;if(null==i||!i.length)return{sets:[]};const a=i[i.length-1];n=parseInt(n);const{validSide2Score:o,requiresTiebreak:s}=function({analysis:t,set:e={},value:i}){const n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:o}=n,{side1Score:s}=e;let c,u;return c=r&&r<a?s===r?i<=a:i<=r:s===a?o?i<a:i<=a+1:s===a-1?o?i<=a:i<=a+1:s===a+1?i===a||i===a-1:i<=a,c&&(u=r&&r<a?s===a&&i===r||s===r&&i===a:s>=a&&i>=a&&s!==i),{validSide2Score:c,requiresTiebreak:u}}({analysis:t,set:a,value:n});if(o){r=!0,e=(e||"")+n,a.side2Score=n;const o=_i({analysis:t,set:i[i.length-1]});a.winningSide=o||void 0,s?e+="()".split("")[0]:t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:r}}({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)l="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)l="invalid set tiebreak character";else if(f.isTiebreakCloser){const t=f.isSetTiebreakEntry?"()":"[]",e=t.split("").reverse()[0],i=t.split("")[0],a=r[r.length-1],{tiebreakFormat:o}=f.setFormat,{tiebreakTo:s,NoAD:c}=o||{},u=Bi({set:a});if(!f.isTiebreakSet){const t=parseInt(n.split(i).reverse()[0]),e=pn({lowValue:t,tiebreakTo:s,NoAD:c});1===u?(a.side1TiebreakScore=e,a.side2TiebreakScore=t):(a.side1TiebreakScore=t,a.side2TiebreakScore=e)}n=(n||"")+e,f.isDecidingSet||(n+=" ");const l=_i({analysis:f,set:a});a.winningSide=l||void 0,d=!0}else if(f.isTiebreakSetValue)({message:l,scoreString:n,sets:r,updated:d}=function({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){let o,s;const{tiebreakSet:{tiebreakTo:c,NoAD:u}}=t.setFormat,[d]="[]".split("");if(t.isMatchTiebreakEntry||(n+=d),r[t.setNumber-1]){var l;const{lastOpenBracketIndex:t}=ln({scoreString:n,brackets:"[]"}),d=(n.slice(t+1)+(e?"":a)).split(Xi);if(((null===(l=d[i-1])||void 0===l?void 0:l.length)||0)>=2)s="tiebreak digit limit";else if(e){1===i&&(d[0]=(d[0]||"")+a),2===i&&(d[1]=(d[1]||"")+a);const e=[d[0]||0,d[1]||0].map((t=>parseInt(t))),s=1===i?1:0;e[s]=e[1-s]+(u?1:2),e[s]<c&&(e[s]=c);const l=r[r.length-1];l.side1TiebreakScore=e[0],l.side2TiebreakScore=e[1],n=n.slice(0,t+1),n+=e.join(Xi),o=!0}else{const t=[d[0]||0,d[1]||0].map((t=>parseInt(t))),e=r[r.length-1];e.side1TiebreakScore=t[0],e.side2TiebreakScore=t[1],n+=a,o=!0}}else{const t=pn({lowValue:parseInt(a||0),tiebreakTo:c,NoAD:u}),e=[parseInt(a),t];2===i&&e.reverse();const s={side1TiebreakScore:e[0],side2TiebreakScore:e[1],setNumber:(null==r?void 0:r.length)+1||1};r.push(s),n+=e.join(Xi),o=!0}return{message:s,scoreString:n,sets:r,updated:o}}({analysis:f,auto:u,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){const[t]="()".split(""),e=Math.max(...rt(t,n.split(""))),r=n.slice(e+1),a=r&&0===parseInt(r),o=parseInt(r?r+i:i),{tiebreakFormat:s}=f.setFormat,{tiebreakTo:c,NoAD:u}=s||{};!a&&r.length<2?u&&o>c-1?l="invalid low value for NoAD tiebreak":(d=!0,n=(n||"")+i):l=a?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)l=`invalid key: ${i}`;else if(f.isGameScoreEntry)l="game scoreString entry";else if(f.lastSetIsComplete||!r.length){var I,v;d=!0;const{scoreString:t,set:a}=function({analysis:t,lowSide:e,scoreString:i,value:n}){const{setTo:r,tiebreakAt:a,NoAD:o}=null==t?void 0:t.setFormat,s=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(o&&n===r||n>r)return{scoreString:i};const c=[n,s?n+1:n+1===r?n+(o?1:2):r];2===e&&c.reverse();const u="()".split("")[0];i=(i||"")+(c.join(Qi)+(s?u:" "));const d={side1Score:c[0],side2Score:c[1]},l=_i({analysis:t,set:d});return d.winningSide=l||void 0,{scoreString:i,set:d}}({analysis:f,lowSide:e,scoreString:n,value:parseInt(i)});a&&(a.setNumber=(null===(I=r)||void 0===I?void 0:I.length)+1||1),r=(null===(v=r)||void 0===v?void 0:v.concat(a).filter(Boolean))||[a],n=t||void 0}else console.log("error: unknown outcome")}else(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(d=!0,({scoreString:n,sets:r}=dn({analysis:f,scoreString:n,sets:r,lowSide:e,auto:u})),o=void 0);if(d){var g;r=null===(g=r)||void 0===g?void 0:g.filter(Boolean);const{matchUpWinningSide:t}=mn({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=t,!t||o&&![A,D].includes(o)?!n||a||[Hi,Vi,qi].includes(o)||(o=void 0):(o="COMPLETED",r=r.filter((t=>{const{side1Score:e,side2Score:i,side1TiebreakScore:n,side2TiebreakScore:r}=t;return e||i||n||r}))),{updated:d,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,message:l}}return{updated:d,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,message:l}},analyzeSet:Un};const Nn=[{ioc:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso:"AD",label:"Andorra",phone:"376"},{ioc:"UAE",iso:"AE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso:"AF",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso:"AG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso:"AI",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso:"AL",label:"Albania",phone:"355"},{ioc:"ARM",iso:"AM",label:"Armenia",phone:"374"},{ioc:"ANG",iso:"AO",label:"Angola",phone:"244"},{ioc:"",iso:"AQ",label:"Antarctica",phone:"672"},{ioc:"ARG",iso:"AR",label:"Argentina",phone:"54"},{ioc:"ASA",iso:"AS",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso:"AT",label:"Austria",phone:"43"},{ioc:"AUS",iso:"AU",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso:"AW",label:"Aruba",phone:"297"},{ioc:"",iso:"AX",label:"Alland Islands",phone:"358"},{ioc:"AZE",iso:"AZ",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso:"BA",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso:"BB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso:"BD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso:"BE",label:"Belgium",phone:"32"},{ioc:"BUR",iso:"BF",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso:"BG",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso:"BH",label:"Bahrain",phone:"973"},{ioc:"BDI",iso:"BI",label:"Burundi",phone:"257"},{ioc:"BEN",iso:"BJ",label:"Benin",phone:"229"},{ioc:"",iso:"BL",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso:"BM",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso:"BN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso:"BO",label:"Bolivia",phone:"591"},{ioc:"BRA",iso:"BR",label:"Brazil",phone:"55"},{ioc:"BAH",iso:"BS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso:"BT",label:"Bhutan",phone:"975"},{ioc:"",iso:"BV",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso:"BW",label:"Botswana",phone:"267"},{ioc:"BLR",iso:"BY",label:"Belarus",phone:"375"},{ioc:"BIZ",iso:"BZ",label:"Belize",phone:"501"},{ioc:"CAN",iso:"CA",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso:"CC",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso:"CD",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso:"CF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso:"CG",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso:"CH",label:"Switzerland",phone:"41"},{ioc:"CIV",iso:"CI",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso:"CK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso:"CL",label:"Chile",phone:"56"},{ioc:"CMR",iso:"CM",label:"Cameroon",phone:"237"},{ioc:"CHN",iso:"CN",label:"China",phone:"86"},{ioc:"COL",iso:"CO",label:"Colombia",phone:"57"},{ioc:"CRC",iso:"CR",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso:"CU",label:"Cuba",phone:"53"},{ioc:"CPV",iso:"CV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso:"CW",label:"Curacao",phone:"599"},{ioc:"CXR",iso:"CX",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso:"CY",label:"Cyprus",phone:"357"},{ioc:"CZE",iso:"CZ",label:"Czech Republic",phone:"420"},{ioc:"GER",iso:"DE",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso:"DJ",label:"Djibouti",phone:"253"},{ioc:"DEN",iso:"DK",label:"Denmark",phone:"45"},{ioc:"DMA",iso:"DM",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso:"DO",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso:"DZ",label:"Algeria",phone:"213"},{ioc:"ECU",iso:"EC",label:"Ecuador",phone:"593"},{ioc:"EST",iso:"EE",label:"Estonia",phone:"372"},{ioc:"EGY",iso:"EG",label:"Egypt",phone:"20"},{ioc:"",iso:"EH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso:"ER",label:"Eritrea",phone:"291"},{ioc:"ESP",iso:"ES",label:"Spain",phone:"34"},{ioc:"ETH",iso:"ET",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso:"FI",label:"Finland",phone:"358"},{ioc:"FIJ",iso:"FJ",label:"Fiji",phone:"679"},{ioc:"FLK",iso:"FK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso:"FM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso:"FO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso:"FR",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso:"GA",label:"Gabon",phone:"241"},{ioc:"GBR",iso:"GB",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso:"GD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso:"GE",label:"Georgia",phone:"995"},{ioc:"FGU",iso:"GF",label:"French Guiana",phone:"594"},{ioc:"",iso:"GG",label:"Guernsey",phone:"44"},{ioc:"",iso:"GH",label:"Ghana",phone:"233"},{ioc:"GIB",iso:"GI",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso:"GL",label:"Greenland",phone:"299"},{ioc:"GAM",iso:"GM",label:"Gambia",phone:"220"},{ioc:"GUI",iso:"GN",label:"Guinea",phone:"224"},{ioc:"GUD",iso:"GP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso:"GQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso:"GR",label:"Greece",phone:"30"},{ioc:"",iso:"GS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso:"GT",label:"Guatemala",phone:"502"},{ioc:"GUM",iso:"GU",label:"Guam",phone:"1-671"},{ioc:"GBS",iso:"GW",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso:"GY",label:"Guyana",phone:"592"},{ioc:"HKG",iso:"HK",label:"Hong Kong",phone:"852"},{ioc:"",iso:"HM",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso:"HN",label:"Honduras",phone:"504"},{ioc:"CRO",iso:"HR",label:"Croatia",phone:"385"},{ioc:"HAI",iso:"HT",label:"Haiti",phone:"509"},{ioc:"HUN",iso:"HU",label:"Hungary",phone:"36"},{ioc:"INA",iso:"ID",label:"Indonesia",phone:"62"},{ioc:"IRL",iso:"IE",label:"Ireland",phone:"353"},{ioc:"ISR",iso:"IL",label:"Israel",phone:"972"},{ioc:"",iso:"IM",label:"Isle of Man",phone:"44"},{ioc:"IND",iso:"IN",label:"India",phone:"91"},{ioc:"",iso:"IO",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso:"IQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso:"IR",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso:"IS",label:"Iceland",phone:"354"},{ioc:"ITA",iso:"IT",label:"Italy",phone:"39"},{ioc:"",iso:"JE",label:"Jersey",phone:"44"},{ioc:"JAM",iso:"JM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso:"JO",label:"Jordan",phone:"962"},{ioc:"JPN",iso:"JP",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso:"KE",label:"Kenya",phone:"254"},{ioc:"KGZ",iso:"KG",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso:"KH",label:"Cambodia",phone:"855"},{ioc:"KIR",iso:"KI",label:"Kiribati",phone:"686"},{ioc:"COM",iso:"KM",label:"Comoros",phone:"269"},{ioc:"SKN",iso:"KN",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso:"KP",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso:"KR",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso:"KW",label:"Kuwait",phone:"965"},{ioc:"CAY",iso:"KY",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso:"KZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso:"LA",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso:"LB",label:"Lebanon",phone:"961"},{ioc:"LCA",iso:"LC",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso:"LI",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso:"LK",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso:"LR",label:"Liberia",phone:"231"},{ioc:"LES",iso:"LS",label:"Lesotho",phone:"266"},{ioc:"LTU",iso:"LT",label:"Lithuania",phone:"370"},{ioc:"LUX",iso:"LU",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso:"LV",label:"Latvia",phone:"371"},{ioc:"LBA",iso:"LY",label:"Libya",phone:"218"},{ioc:"MAR",iso:"MA",label:"Morocco",phone:"212"},{ioc:"MON",iso:"MC",label:"Monaco",phone:"377"},{ioc:"MDA",iso:"MD",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso:"ME",label:"Montenegro",phone:"382"},{ioc:"",iso:"MF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso:"MG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso:"MH",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso:"MK",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso:"ML",label:"Mali",phone:"223"},{ioc:"MYA",iso:"MM",label:"Myanmar",phone:"95"},{ioc:"MGL",iso:"MN",label:"Mongolia",phone:"976"},{ioc:"MAC",iso:"MO",label:"Macao",phone:"853"},{ioc:"NMA",iso:"MP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso:"MQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso:"MR",label:"Mauritania",phone:"222"},{ioc:"MNT",iso:"MS",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso:"MT",label:"Malta",phone:"356"},{ioc:"MRI",iso:"MU",label:"Mauritius",phone:"230"},{ioc:"MDV",iso:"MV",label:"Maldives",phone:"960"},{ioc:"MAW",iso:"MW",label:"Malawi",phone:"265"},{ioc:"MEX",iso:"MX",label:"Mexico",phone:"52"},{ioc:"MAS",iso:"MY",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso:"MZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso:"NA",label:"Namibia",phone:"264"},{ioc:"NCL",iso:"NC",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso:"NE",label:"Niger",phone:"227"},{ioc:"NFI",iso:"NF",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso:"NG",label:"Nigeria",phone:"234"},{ioc:"NCA",iso:"NI",label:"Nicaragua",phone:"505"},{ioc:"NED",iso:"NL",label:"Netherlands",phone:"31"},{ioc:"NOR",iso:"NO",label:"Norway",phone:"47"},{ioc:"NEP",iso:"NP",label:"Nepal",phone:"977"},{ioc:"NRU",iso:"NR",label:"Nauru",phone:"674"},{ioc:"NIU",iso:"NU",label:"Niue",phone:"683"},{ioc:"NZL",iso:"NZ",label:"New Zealand",phone:"64"},{ioc:"OMA",iso:"OM",label:"Oman",phone:"968"},{ioc:"PAN",iso:"PA",label:"Panama",phone:"507"},{ioc:"PER",iso:"PE",label:"Peru",phone:"51"},{ioc:"FPO",iso:"PF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso:"PG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso:"PH",label:"Philippines",phone:"63"},{ioc:"PAK",iso:"PK",label:"Pakistan",phone:"92"},{ioc:"POL",iso:"PL",label:"Poland",phone:"48"},{ioc:"SPM",iso:"PM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso:"PN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso:"PR",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso:"PS",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso:"PT",label:"Portugal",phone:"351"},{ioc:"PlW",iso:"PW",label:"Palau",phone:"680"},{ioc:"PAR",iso:"PY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso:"QA",label:"Qatar",phone:"974"},{ioc:"REU",iso:"RE",label:"Reunion",phone:"262"},{ioc:"ROU",iso:"RO",label:"Romania",phone:"40"},{ioc:"SRB",iso:"RS",label:"Serbia",phone:"381"},{ioc:"RUS",iso:"RU",label:"Russia",phone:"7"},{ioc:"RWA",iso:"RW",label:"Rwanda",phone:"250"},{ioc:"KSA",iso:"SA",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso:"SB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso:"SC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso:"SD",label:"Sudan",phone:"249"},{ioc:"SWE",iso:"SE",label:"Sweden",phone:"46"},{ioc:"SIN",iso:"SG",label:"Singapore",phone:"65"},{ioc:"HEL",iso:"SH",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso:"SI",label:"Slovenia",phone:"386"},{ioc:"",iso:"SJ",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso:"SK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso:"SL",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso:"SM",label:"San Marino",phone:"378"},{ioc:"SEN",iso:"SN",label:"Senegal",phone:"221"},{ioc:"SOM",iso:"SO",label:"Somalia",phone:"252"},{ioc:"SUR",iso:"SR",label:"Suriname",phone:"597"},{ioc:"",iso:"SS",label:"South Sudan",phone:"211"},{ioc:"STP",iso:"ST",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso:"SV",label:"El Salvador",phone:"503"},{ioc:"",iso:"SX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso:"SY",label:"Syria",phone:"963"},{ioc:"",iso:"SZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso:"TC",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso:"TD",label:"Chad",phone:"235"},{ioc:"",iso:"TF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso:"TG",label:"Togo",phone:"228"},{ioc:"THA",iso:"TH",label:"Thailand",phone:"66"},{ioc:"TJK",iso:"TJ",label:"Tajikistan",phone:"992"},{ioc:"",iso:"TK",label:"Tokelau",phone:"690"},{ioc:"TLS",iso:"TL",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso:"TM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso:"TN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso:"TO",label:"Tonga",phone:"676"},{ioc:"TUR",iso:"TR",label:"Turkey",phone:"90"},{ioc:"TTO",iso:"TT",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso:"TV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso:"TW",label:"Taiwan",phone:"886"},{ioc:"TAN",iso:"TZ",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso:"UA",label:"Ukraine",phone:"380"},{ioc:"UGA",iso:"UG",label:"Uganda",phone:"256"},{ioc:"USA",iso:"US",label:"United States",phone:"1",suggested:!0},{ioc:"URU",iso:"UY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso:"UZ",label:"Uzbekistan",phone:"998"},{ioc:"",iso:"VA",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso:"VC",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso:"VE",label:"Venezuela",phone:"58"},{ioc:"IVB",iso:"VG",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso:"VI",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso:"VN",label:"Vietnam",phone:"84"},{ioc:"VAN",iso:"VU",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso:"WF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso:"WS",label:"Samoa",phone:"685"},{ioc:"KOS",iso:"XK",label:"Kosovo",phone:"383"},{ioc:"YEM",iso:"YE",label:"Yemen",phone:"967"},{ioc:"MAY",iso:"YT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso:"ZA",label:"South Africa",phone:"27"},{ioc:"ZAM",iso:"ZM",label:"Zambia",phone:"260"},{ioc:"ZIM",iso:"ZW",label:"Zimbabwe",phone:"263"}];var Pn={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:6/TB10",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Dn={winCriteria:{valueGoal:13},collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}]},Tn={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}};const Mn={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:Pn,LAVER_CUP:Dn,TEAM_DOUBLES_3_AGGREGATION:Tn},An="MAIN",En="QUALIFYING",bn="CONSOLATION",Rn="PLAY_OFF",Cn=[An,En,bn,Rn,"VOLUNTARY_CONSOLATION"],On={[En]:1,[An]:2,[Rn]:3,[bn]:3,VOLUNTARY_CONSOLATION:4},Ln="CONTAINER",xn="TOP_DOWN",Fn="LOSER",kn="AD_HOC",_n="FEED_IN",jn="SINGLE_ELIMINATION",Bn="DOUBLE_ELIMINATION",Gn="LUCKY_DRAW",Vn="CURTIS_CONSOLATION",Hn="FEED_IN_CHAMPIONSHIP_TO_SF",qn="FEED_IN_CHAMPIONSHIP_TO_QF",Wn="FEED_IN_CHAMPIONSHIP_TO_R16",zn="MODIFIED_FEED_IN_CHAMPIONSHIP",Kn="ROUND_ROBIN",Yn="ROUND_ROBIN_WITH_PLAYOFF",$n={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-3":{name:"NORTHEAST",abbreviation:"NE"},"0-1-1":{name:"SOUTH",abbreviation:"S"},"0-1-2":{name:"SOUTHWEST",abbreviation:"SW"},"0-2-1":{name:"NORTHWEST",abbreviation:"NW"},"0-1-1-1":{name:"SOUTHEAST",abbreviation:"SE"}},Jn={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-1-1":{name:"SOUTH",abbreviation:"S"}},Zn=["COMPASS",Vn,"FEED_IN_CHAMPIONSHIP_TO_QF","FEED_IN_CHAMPIONSHIP_TO_R16","FEED_IN_CHAMPIONSHIP_TO_SF","FEED_IN_CHAMPIONSHIP",qn,Wn,Hn,"FIRST_MATCH_LOSER_CONSOLATION","FIRST_ROUND_LOSER_CONSOLATION",Gn,"MODIFIED_FEED_IN_CHAMPIONSHIP","OLYMPIC",Rn,Yn],Qn={MAIN:An,QUALIFYING:En,CONSOLATION:bn,ITEM:"ITEM",CONTAINER:Ln,FIRST_MATCHUP:"FIRST_MATCHUP",WINNER:"WINNER",LOSER:Fn,AD_HOC:kn,FEED_IN:_n,COMPASS:"COMPASS",PLAY_OFF:Rn,OLYMPIC:"OLYMPIC",KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:jn,DOUBLE_ELIMINATION:Bn,CURTIS:Vn,FICSF:Hn,FICQF:qn,FICR16:Wn,MFIC:zn,FIRST_MATCH_LOSER_CONSOLATION:"FIRST_MATCH_LOSER_CONSOLATION",FIRST_ROUND_LOSER_CONSOLATION:"FIRST_ROUND_LOSER_CONSOLATION",MODIFIED_FEED_IN_CHAMPIONSHIP:"MODIFIED_FEED_IN_CHAMPIONSHIP",FEED_IN_CHAMPIONSHIP_TO_R16:"FEED_IN_CHAMPIONSHIP_TO_R16",FEED_IN_CHAMPIONSHIP_TO_QF:"FEED_IN_CHAMPIONSHIP_TO_QF",FEED_IN_CHAMPIONSHIP_TO_SF:"FEED_IN_CHAMPIONSHIP_TO_SF",FEED_IN_CHAMPIONSHIP:"FEED_IN_CHAMPIONSHIP",ROUND_ROBIN_WITH_PLAYOFF:Yn,ROUND_ROBIN:Kn,DECIDER:"DECIDER",BACKDRAW:"BACKDRAW",COMPASS_ATTRIBUTES:$n,OLYMPIC_ATTRIBUTES:Jn,DRAW:"DRAW",RANDOM:"RANDOM",TOP_DOWN:xn,BOTTOM_UP:"BOTTOM_UP",WATERFALL:"WATERFALL",WIN_RATIO:"WIN_RATIO",ROUND_OUTCOME:"ROUND_OUTCOME",MULTI_STRUCTURE_DRAWS:Zn,generatedDrawTypes:[kn,"COMPASS",Vn,Bn,"FEED_IN_CHAMPIONSHIP_TO_QF","FEED_IN_CHAMPIONSHIP_TO_R16","FEED_IN_CHAMPIONSHIP_TO_SF","FEED_IN_CHAMPIONSHIP",_n,"FIRST_MATCH_LOSER_CONSOLATION","FIRST_ROUND_LOSER_CONSOLATION",Gn,"MODIFIED_FEED_IN_CHAMPIONSHIP","OLYMPIC",Rn,Kn,Yn,jn],stageOrder:On},Xn={positionActions:{policyName:"positionActionsDefault",enabledStructures:[{stages:[En,An],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:["SEED_VALUE","NICKNAME","PENALTY"],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1}},tr={roundNaming:{policyName:"Round Naming Default",abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q"},stageConstants:{[An]:"",[Rn]:"P",[En]:"Q",[bn]:"C"}}},er={seeding:{policyName:"USTA",seedingProfile:"SEPARATE",duplicateSeedNumbers:!0,drawSizeProgression:!0,validSeedPositions:{ignore:!0},seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}};function ir({courtDate:t,includeBookingTypes:e=[]}){const i=[];let n=oe(t.startTime);(t.bookings||[]).filter((t=>!t.bookingType||!e.includes(t.bookingType))).sort(((t,e)=>ee(t.startTime).localeCompare(ee(e.startTime)))).forEach((t=>{const e={startTime:ie(n.toISOString()),endTime:t.startTime};oe(t.startTime)>n&&i.push(e),oe(t.endTime)>n&&(n=oe(t.endTime))}));const r={startTime:ie(n.toISOString()),endTime:t.endTime};return oe(t.endTime)>n&&i.push(r),i}function nr({includeBookingTypes:t,averageMatchUpMinutes:e,periodStartTime:i,periodEndTime:n,periodLength:r,date:a}){function o(t){const r=oe(t.startTime),a=oe(t.endTime);return!(r>i)&&(!(a<n)&&se(i,a)>=e)}return{sameDate:t=>!t.date||le(t.date,a),enoughTime:e=>!!ir({courtDate:e,periodLength:r,includeBookingTypes:t}).filter(o).length}}function rr({includeBookingTypes:t,averageMatchUpMinutes:e,periodLength:i,periodStart:n,courts:r,date:a}){const o=oe(n),s=ue(o,e),{sameDate:c,enoughTime:u}=nr({includeBookingTypes:t,averageMatchUpMinutes:e,periodStartTime:o,periodEndTime:s,periodLength:i,date:a});return{availableToScheduleCount:r.filter((t=>!!(Array.isArray(t.dateAvailability)&&t.dateAvailability.filter(c).filter(u)).length)).length}}function ar({remainingScheduleTimes:t=[],clearScheduleDates:e,periodLength:i=30,bookings:n=[],scheduleDate:r,courts:a=[]}){if(!Array.isArray(a)||!a.length)return{error:gt,courts:a};if(!Array.isArray(n))return{error:"Invalid bookings"};if(!Wt(r))return{error:vt};e&&(Array.isArray(e)?e.includes(r)&&(n=[]):n=[]);const{courtBookings:o,unassignedBookings:s}=n.reduce(((t,e)=>{const{courtId:i}=e;return i?t.courtBookings[i]?t.courtBookings[i].push(e):t.courtBookings[i]=[e]:t.unassignedBookings.push(e),t}),{courtBookings:{},unassignedBookings:[]}),{sameDate:c}=nr({date:r}),u=a.map((({courtId:e,dateAvailability:i},n)=>{const r=o[e]||[],a=i.find(c)||{},{date:s,startTime:u,endTime:d,bookings:l=[]}=a;return{courtId:e,dateAvailability:{date:s,startTime:u,endTime:d,bookings:[t[n]&&{startTime:u,endTime:t[n]},...me(l,!1,!0),...r].filter(Boolean)}}}));s.sort(((t,e)=>te(t.startTime)-te(e.startTime)));for(const d of s){const{startTime:t,endTime:e,averageMinutes:n,recoveryMinutes:r,matchUpId:a}=d,o=te(t),s=te(e),c=u.map((t=>{const e=ir({courtDate:t.dateAvailability});return{courtId:t.courtId,timeSlots:e}})).flat().reduce(((t,{courtId:e,timeSlots:n})=>{let r;return n.find((({startTime:e,endTime:n})=>{r=te(e)-o;const a=o>=te(e);return s<=te(n)&&0!==t.startDifference&&((0===r||r+i>=0)&&(void 0===t.startDifference||r<t.startDifference)||a)}))?{courtId:e,startDifference:r}:t}),{courtId:void 0,startDifference:void 0});if(c.courtId){const i={averageMinutes:n,recoveryMinutes:r,matchUpId:a,startTime:t,endTime:e};u.find((({courtId:t})=>t===c.courtId)).dateAvailability.bookings.push(i)}else console.log({unassignedBooking:d})}return{virtualCourts:u.map((({courtId:t,dateAvailability:e})=>({courtId:t,dateAvailability:[e]})))}}function or({startTime:t="8:00",endTime:e="20:30",count:i=10,date:n}={}){return nt(0,i).map((()=>({dateAvailability:[{date:n,startTime:t,endTime:e}]})))}function sr({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,averageMatchUpMinutes:i=90,date:n=zt(),clearScheduleDates:r,periodLength:a=30,startTime:o="08:00",endTime:s="19:00",courtsCount:c,bookings:u,courts:d}={}){n=ne(n),o=ie(o),s=ie(s);let l=0,p=0,m=0,f=0,h=0;!d&&c&&(d=or({startTime:o,endTime:s,count:c,date:n}));const{virtualCourts:I}=ar({remainingScheduleTimes:e,scheduleDate:n,clearScheduleDates:r,periodLength:a,bookings:u,courts:d}),{firstTimeSlotStartTime:v}=function({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){const{sameDate:a}=nr({date:r});let o;if(e&&i){const r=oe(e),s=oe(i);n.every((e=>!!Array.isArray(e.dateAvailability)&&e.dateAvailability.filter(a).find((e=>ir({courtDate:e}).find((e=>{const i=oe(e.startTime),n=oe(e.endTime);if(i>s||i<r)return!1;if(n<r)return!1;const a=se(i,n)>=t;if(a){const t=ie(i.toISOString());(!o||t<o)&&(o=t)}return a}))))))}return{firstTimeSlotStartTime:o}}({averageMinutes:i,courts:I,startTime:o,endTime:s,date:n});t&&v&&(o=v||o);const g=te(o),y=te(s)-g,U=nt(0,Math.floor(y/a)+1).map((t=>{const e=function(t){let e=Math.floor(t/60);const i=t-60*e;return e>23&&(e%=24),[de(e),de(i)].join(":")}(g+t*a),{availableToScheduleCount:r}=rr({courts:I,averageMatchUpMinutes:i,periodLength:a,periodStart:e,period:t,date:n}),o=r>p?r-p:0;h+=t?r:0;const s=t?h/t:r,c=t?a*s/i*(t-1)+s:s,u=r?p?c-l:o:0;l=c,p=r,m+=u;const d=parseInt(m)-f;return f+=d,{periodStart:e,add:d,availableToScheduleCount:r,newCourts:o,totalMatchUps:f}}));return{scheduleTimes:U.reduce(((t,e)=>t.concat(...nt(0,e.add).map((()=>({scheduleTime:e.periodStart}))))),[]).flat(),timingProfile:U,totalMatchUps:f}}const cr={getCourtsAvailableAtPeriodStart:rr,generateTimeSlots:ir,getScheduleTimes:sr,courtGenerator:or};function ur({consideredDate:t,category:e}={}){var i,n,r;const a={error:gt};if("object"!=typeof e||!Wt(t))return a;const o=parseInt(t.split("-")[0]),s=[];let c,{ageCategoryCode:u,categoryName:d,ageMaxDate:l,ageMinDate:p,ageMax:m,ageMin:f}=e;if("string",![u,l,p,d].filter(Boolean).every((t=>"string"==typeof t))||!(t=>t.filter(Boolean).every(H))([m,f]))return a;u=u||d;const h=/^([UO]?)(\d{1,2})([UO]?)$/,I=/^C(\d{1,2})-(\d{1,2})$/,v=(null===(i=u)||void 0===i?void 0:i.indexOf("-"))>0,g=v&&(null===(n=u)||void 0===n?void 0:n.match(I)),y=null===(r=u)||void 0===r?void 0:r.match(h),U=(t,e,i)=>Wt(e)?e:e&&e.match(/^\d{2}-\d{2}$/)?`${t}-${e}`:`${t}-${i}`,w=t=>{const[e,i,n]=(t.match(h)||[]).slice(1),r=parseInt(i);"U"===e&&({ageMinDate:p,ageMax:m}=(t=>(p=U(o-t,p,"01-01"),m&&m!==t-1&&s.push(`Invalid ageMax: ${m}`),m||(m=t-1),{ageMinDate:p,ageMax:m}))(r)),"U"===n&&({ageMinDate:p,ageMax:m}=(t=>(p=U(o-t-1,p,"01-01"),m&&m!==t&&s.push(`Invalid ageMax: ${m}`),m||(m=t),{ageMinDate:p,ageMax:m}))(r)),"O"===e&&({ageMaxDate:l,ageMin:f}=(t=>(l=U(o-t-2,l,"12-31"),f&&f!==t+1&&s.push(`Invalid ageMin: ${f}`),f||(f=t+1),{ageMaxDate:l,ageMin:f}))(r)),"O"===n&&({ageMaxDate:l,ageMin:f}=(t=>(l=U(o-t-1,l,"12-31"),f&&f!==t&&s.push(`Invalid ageMin: ${f}`),f||(f=t),{ageMaxDate:l,ageMin:f}))(r))};if(g){const[t,e]=u.match(I).slice(1).map((t=>parseInt(t)));t<=e?(f=f||t,m=m||e,c=!0):s.push(`Invalid combined age range ${u}`)}else v?u.split("-").forEach(w):y&&w(u);return s.length?{error:s}:fe({combinedAge:c,ageMaxDate:l,ageMinDate:p,ageMax:m,ageMin:f})}function dr(t,e,i=[]){return"object"==typeof t&&Object.keys(t).reduce(((n,r)=>"object"!=typeof t[r]?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,dr(t[r],e,i.concat(r)))),{})}function lr({element:t,itemType:e,itemSubTypes:i,returnPreviousValues:n}){if(!t)return{error:It};if(!Array.isArray(t.timeItems))return{error:"Missing timeItems"};const r=t.timeItems.filter((t=>(null==t?void 0:t.itemType)===e)).filter((t=>{var e;return!(null!=i&&i.length)||(null==t||null===(e=t.itemSubTypes)||void 0===e?void 0:e.includes(i))})).sort(((t,e)=>new Date(t.createdAt||void 0)-new Date(e.createdAt||void 0))),a=r.pop();if(a){const t={timeItem:a,...ut};return n&&Object.assign(t,{previousItems:r}),t}return{message:yt}}function pr({event:t,itemType:e,itemSubTypes:i,returnPreviousValues:n}){if(!t)return{error:ht};if(!t.timeItems)return{message:yt};const{timeItem:r,previousItems:a,message:o}=lr({element:t,itemType:e,itemSubTypes:i,returnPreviousValues:n});return r&&{timeItem:r,previousItems:a}||{message:o}}function mr({element:t,timeItem:e,duplicateValues:i=!0}){if(!t)return{error:It};if(!e)return{error:"Missing timeItem"};const n=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter((t=>n.includes(t))).length!==r.length)return{error:"Invalid timeItem"};if(t.timeItems){const{itemType:n,itemSubTypes:r,itemValue:a}=e,{timeItem:o}=lr({element:t,itemType:n,itemSubTypes:r});if(JSON.stringify(null==o?void 0:o.itemValue)===JSON.stringify(a)&&!i)return ut}else t.timeItems=[];e.itemSubTypes&&!e.itemSubTypes.length&&delete e.itemSubTypes;const a=(new Date).toISOString();return Object.assign(e,{createdAt:a}),t.timeItems.push(e),ut}function fr({tournamentRecord:t,duplicateValues:e,participantId:i,timeItem:n}){if(!t)return{error:pt};if(!i)return{error:"Missing participantId"};const r=$e({tournamentRecord:t,participantId:i});return r.error?r:mr({element:r.participant,duplicateValues:e,timeItem:n})}function hr({tournamentRecord:t,duplicateValues:e,timeItem:i}){return t?mr({element:t,timeItem:i,duplicateValues:e}):{error:pt}}function Ir({event:t,timeItem:e,duplicateValues:i}){return t?mr({element:t,timeItem:e,duplicateValues:i}):{error:"Event not found"}}function vr(t,e){var i;if(!t)return;let n=Date.now();n===t.updatedAt&&(n+=1);const r=null==e?void 0:e.filter(Boolean);t.updatedAt=n,null===(i=t.structures)||void 0===i||i.forEach((t=>{(null==r||!r.length||null!=r&&r.includes(t.structureId))&&(t.updatedAt=n)}))}function gr({drawDefinition:t,matchUps:e}){vr(t),At({topic:"addMatchUps",payload:{matchUps:e}})}function yr({drawDefinition:t,matchUpIds:e,action:i}){vr(t),At({topic:"deletedMatchUpIds",payload:{action:i,matchUpIds:e}})}function Ur({drawDefinition:t,matchUp:e}){Sr({drawDefinition:t,structureIds:[e.structureId]}),At({topic:"modifyMatchUp",payload:{matchUp:e},key:e.matchUpId})}function wr({drawDefinition:t}){vr(t),At({topic:"addDrawDefinition",payload:{drawDefinition:t},key:t.drawId})}function Sr({drawDefinition:t,structureIds:e}){vr(t,e),At({topic:"modifyDrawDefinition",payload:{drawDefinition:t},key:t.drawId})}function Nr({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){if(!t&&!e)return{error:pt};if(!Array.isArray(i)||i.length>2)return{error:"Invalid participantIds"};if(!i.length)return{error:"Missing participantIds"};const n=(t=t||(null==e?void 0:e.participants)||[]).filter((t=>t.participantType===Oi&&at(i,t.individualParticipantIds).length===i.length&&t.individualParticipantIds.length===i.length)),r=n[0];if(!r)return{error:"Participant Not Found"};const a=me(n.slice(1));return{participant:me(r),duplicatedPairParticipants:a,...ut}}function Pr({drawDefinition:t,participantId:e}){if("object"!=typeof t)return{error:mt};if("string"!=typeof e)return{error:"Missing participantId"};const{extension:i}=Je({element:t,name:"lineUps"});return{lineUp:((null==i?void 0:i.value)||{})[e]}}const Dr=t=>e=>t[e],Tr=(t=[])=>t.map(br).filter(Boolean),Mr=(t=[])=>t.map(Ar).filter(Boolean),Ar=(t={})=>Dr(t)("participantId"),Er=(t={})=>Dr(t)("drawPosition"),br=(t={})=>Dr(t)("matchUpId");function Rr({drawDefinition:t}){if(!t)return{error:mt};const e=(t.extensions||[]).find((t=>"appliedPolicies"===t.name));return{appliedPolicies:(null==e?void 0:e.value)||{}}}function Cr({matchUps:t=[]}){if(!Array.isArray(t))return{error:gt};const e=t.reduce(((t,e)=>!e.roundNumber||t.includes(e.roundNumber)?t:t.concat(parseInt(e.roundNumber))),[]).sort(Ie).map((e=>{const i=t.filter((t=>t.roundNumber===e)),n=i.find((({matchUpType:t})=>t===ni))?i.filter((({matchUpType:t})=>t===ni)):i;return{[e]:n.sort(((t,e)=>Ie(t.roundPosition,e.roundPosition)))}})),i=t.reduce(((t,e)=>(t[e.roundNumber]||(t[e.roundNumber]=fe({finishingRound:e.finishingRound,abbreviatedRoundName:e.abbreviatedRoundName,roundName:e.roundName})),t)),{}),n=Object.assign({},...e);let r=0;const a=Object.assign({},...Object.keys(n).map((t=>{var e,i,a;const o=null===(e=n[t])||void 0===e?void 0:e.length,s=null===(i=n[t])||void 0===i||null===(a=i.filter((t=>{var e;return!(x.includes(t.matchUpStatus)||null!==(e=t.score)&&void 0!==e&&e.scoreStringSide1)})))||void 0===a?void 0:a.length,c=o&&o===s;return r=Math.max(r,o),{[t]:{matchUpsCount:o,inactiveCount:s,inactiveRound:c}}})));let o=0,s=0;const c=Object.keys(n).map((t=>parseInt(t))).filter((t=>!isNaN(t)));return c.forEach((t=>{const e=n[t].sort(((t,e)=>t.roundPosition-e.roundPosition)),c=e.map((t=>(null==t?void 0:t.drawPositions)||[])).flat();if(a[t].roundNumber=t,a[t].roundFactor=a[t].matchUpsCount?r/a[t].matchUpsCount:1,a[t].finishingRound=i[t].finishingRound,a[t].roundName=i[t].roundName,a[t].abbreviatedRoundName=i[t].abbreviatedRoundName,a[t].finishingPositionRange=n[t][0].finishingPositionRange,1!==t&&a[t-1]){const i=a[t-1].drawPositions,n=i.length/c.length,r=st(i,n),o=e.map((e=>{const{roundPosition:n,drawPositions:a}=e;if(!n)return a;const o=(null==a?void 0:a.filter(Boolean))||[];if(null==o||!o.length)return[void 0,void 0];if(t<3&&2===(null==o?void 0:o.length))return null==a?void 0:a.slice().sort(Ie);if(null!=o&&o.length&&at(i,o).length!==(null==o?void 0:o.length))return 1===(null==o?void 0:o.length)?[o[0],void 0]:null==a?void 0:a.slice().sort(Ie);const s=2*(n-1);return r.slice(s,s+2).map((t=>null==a?void 0:a.find((e=>t.includes(e)))))}));a[t].drawPositions=null==o?void 0:o.flat(),a[t].pairedDrawPositions=o}else{const e=c.sort(Ie),i=st(e,2);a[t].drawPositions=e,a[t].pairedDrawPositions=i}a[t+1]&&a[t+1].matchUpsCount===a[t].matchUpsCount&&(a[t+1].feedRound=!0,a[t+1].feedRoundIndex=s,a[t].preFeedRound=!0,s+=1),a[t]&&!a[t].feedRound&&(a[t].roundIndex=o,o+=1)})),{hasOddMatchUpsCount:!!Object.values(a).find((({matchUpsCount:t})=>!G(t))),maxMatchUpsCount:r,roundMatchUps:n,roundNumbers:c,roundProfile:a}}function Or({drawDefinition:t,structure:e}){const i={},n=[];return((null==t?void 0:t.structures)||[e]).filter((t=>t&&"object"==typeof t)).forEach((t=>{const{structureId:e,matchUps:r,structures:a}=t,o=Array.isArray(a);if(o)o&&a.forEach((t=>{const{structureName:r}=t,a=t.matchUps;i[t.structureId]={matchUps:a,structureName:r},n.push(...a),a.forEach((t=>{n.push(t),t.tieMatchUps&&n.push(...t.tieMatchUps)})),i[e]||(i[e]={}),i[e].itemStructureIds||(i[e].itemStructureIds=[]),i[e].itemStructureIds.push(t.structureId)}));else{const t=r;i[e]={matchUps:t},t.forEach((t=>{n.push(t),t.tieMatchUps&&n.push(...t.tieMatchUps)}))}})),{mappedMatchUps:i,drawMatchUps:n}}function Lr({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){let r=(t=(null==e?void 0:e.mappedMatchUps)||t)[i];const a=((null==r?void 0:r.itemStructureIds)||[]).map((e=>{const{matchUps:r,structureName:a}=t[e];return n?r.map((t=>Object.assign(me(t,!0,!0),{containerStructureId:i,structureId:e,structureName:a}))):r})).flat();return((null==r?void 0:r.matchUps)||[]).concat(...a)}function xr(t,e){var i,n;return(On[null==t?void 0:t.stage]||0)-(On[null==e?void 0:e.stage]||0)||((null==e||null===(i=e.positionAssignments)||void 0===i?void 0:i.length)||9999)-((null==t||null===(n=t.positionAssignments)||void 0===n?void 0:n.length)||9999)||((null==t?void 0:t.stageSequence)||0)-((null==e?void 0:e.stageSequence)||0)}function Fr({drawDefinition:t,structureId:e}){if(!t)return{error:mt};if(!e)return{error:"Missing structureId"};const{structures:i}=kr({drawDefinition:t}),n=i.map((t=>t.structures?[].concat(...t.structures,t):t)).flat().find((t=>t.structureId===e));return n?{structure:n}:{error:"structure not found"}}function kr({stage:t,stageSequence:e,drawDefinition:i}){var n;const r=i?i.structures?void 0:"Missing structures":mt;return r?{error:r}:{structures:null===(n=i.structures)||void 0===n?void 0:n.filter((function(e){return!t||e.stage===t})).filter((function(t){return!e||t.stageSequence===e})).sort(xr)}}function _r(t){if(!t||"object"!=typeof t)return!1;if("string"!=typeof t.name)return!1;const e=Object.keys(t),i=["name","value"];return i.filter((t=>e.includes(t))).length===i.length}function jr({element:t,extension:e}={}){if(!t)return{error:It};if("object"!=typeof t)return{error:gt};if(!_r(e))return{error:gt};t.extensions||(t.extensions=[]);const i=(new Date).toISOString();Object.assign(e,{createdAt:i});const n=t.extensions.find((({name:t})=>t===e.name));return n?n.value=e.value:e.value&&t.extensions.push(e),{...ut}}function Br({element:t,name:e}={}){return t?"object"!=typeof t?{error:gt}:e?t.extensions?(t.extensions=t.extensions.filter((t=>(null==t?void 0:t.name)!==e)),{...ut}):{...ut,message:yt}:{error:It,message:"Missing name"}:{error:It}}function Gr({tournamentRecord:t,extension:e}={}){return t?jr({element:t,extension:e}):{error:pt}}function Vr({drawDefinition:t,extension:e}={}){return t?jr({element:t,extension:e}):{error:"drawDefinition not found"}}function Hr({event:t,extension:e}={}){return t?jr({element:t,extension:e}):{error:ht}}function qr({tournamentRecord:t,name:e}={}){return t?Br({element:t,name:e}):{error:pt}}function Wr({event:t,name:e}={}){return t?Br({element:t,name:e}):{error:"Event not found"}}function zr({drawDefinition:t,attributes:e}){var i;let{extension:n}=Xe({name:"entryProfile",drawDefinition:t});const r=(null===(i=n)||void 0===i?void 0:i.value)||t.entryProfile||{};return e.forEach((t=>{Object.keys(t).forEach((e=>{r[e]?Object.assign(r[e],t[e]):r[e]=t[e]}))})),n={name:"entryProfile",value:r},Vr({drawDefinition:t,extension:n}),{entryProfile:r}}var Kr;!function(t){t.CONFIRMED="CONFIRMED",t.DIRECT_ACCEPTANCE="DIRECT_ACCEPTANCE",t.ORGANISER_ACCEPTANCE="ORGANISER_ACCEPTANCE",t.ALTERNATE="ALTERNATE",t.WITHDRAWN="WITHDRAWN",t.UNPAIRED="UNPAIRED",t.UNGROUPED="UNGROUPED",t.LUCKY_LOSER="LUCKY_LOSER",t.FEED_IN="FEED_IN",t.QUALIFIER="QUALIFIER",t.WILDCARD="WILDCARD"}(Kr||(Kr={}));var Yr=Kr.ALTERNATE,$r=Kr.FEED_IN,Jr=Kr.QUALIFIER,Zr=Kr.WILDCARD,Qr=Kr.DIRECT_ACCEPTANCE,Xr=Kr.CONFIRMED,ta=Kr.LUCKY_LOSER,ea=Kr.ORGANISER_ACCEPTANCE,ia=Kr.WITHDRAWN,na=Kr.UNPAIRED,ra=Kr.UNGROUPED,aa=[Xr,Qr,ea],oa=[ta,$r,Jr,Zr],sa=[$r,Jr,ta,Zr,Xr,Qr,ea],ca=[Yr,ia,$r,na,ra,Jr,Zr,Qr,Xr,ta,ea],ua={FEED_IN:$r,WILDCARD:Zr,UNPAIRED:na,UNGROUPED:ra,ALTERNATE:Yr,CONFIRMED:Xr,QUALIFIER:Jr,WITHDRAWN:ia,LUCKY_LOSER:ta,DIRECT_ACCEPTANCE:Qr,ORGANISER_ACCEPTANCE:ea,DRAW_SPECIFIC_STATUSES:oa,EQUIVALENT_ACCEPTANCE_STATUSES:aa,VALID_ENTERED_TYPES:ca,VALID_ENTRY_STATUSES:ca,STRUCTURE_ENTERED_TYPES:sa,STRUCTURE_SELECTED_STATUSES:sa};function da({drawDefinition:t}){let{extension:e}=Xe({name:"entryProfile",drawDefinition:t});return{entryProfile:(null==e?void 0:e.value)||t.entryProfile||{}}}function la({stage:t,drawDefinition:e}){return Boolean(pa({stage:t,drawDefinition:e})&&ma({stage:t,drawDefinition:e}))}function pa({stage:t,drawDefinition:e}){const{entryProfile:i}=da({drawDefinition:e}),n=Object.keys(i).includes(t);return!n&&Cn.includes(t)?(zr({drawDefinition:e,attributes:[{[t]:{drawSize:void 0,alternates:!0}}]}),!0):n}function ma({stage:t,drawDefinition:e}){var i;const{entryProfile:n}=da({drawDefinition:e});return n&&(null===(i=n[t])||void 0===i?void 0:i.drawSize)||0}function fa({stage:t,drawDefinition:e}){var i;const{entryProfile:n}=da({drawDefinition:e});return n&&(null===(i=n[t])||void 0===i?void 0:i.qualifiersCount)||0}function ha({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce(((e,n)=>n.entryStage===t&&n.entryStatus===i?e+1:e),0)}function Ia({drawDefinition:t,stageSequence:e,entryStatuses:i,structureId:n,stages:r,stage:a}){var o;const s=(null===(o=t.entries)||void 0===o?void 0:o.reduce(((t,n)=>{const o=a&&n.entryStage===a||(null==r?void 0:r.length)&&r.includes(n.entryStage),s=!i||i.includes(n.entryStatus),c=n.stageSequence||1;return!o||e&&c!==e||!s?t:t.concat(n)}),[]))||[];return n&&!s.length?function({drawDefinition:t,structureId:e}){const i=[],n=(t.links||[]).find((t=>"POSITION"===t.linkType&&t.target.structureId===e));if(n){const{finishingPositions:e,structureId:r}=n.source,{structure:a}=Fr({drawDefinition:t,structureId:r});a.structureType===Ln&&(a.structures||[]).forEach((t=>{const{positionAssignments:n}=t,{structureId:r}=t,a=r,o=Object.assign({},...n.map((t=>{var e;const{participantId:i}=t,n=null===(e=Je({element:t,name:"tally"}).extension)||void 0===e?void 0:e.value;return n?{[i]:n}:void 0})).filter(Boolean));Object.keys(o).filter((t=>{const i=o[t];return e.includes(i.groupOrder)})).forEach((t=>{const n=o[t],{groupOrder:r,GEMscore:s}=n,c=e.sort().indexOf(r)+1;i.push({GEMscore:s,groupingValue:a,participantId:t,placementGroup:c,entryStage:Rn,entryStatus:$r})}))}))}return i}({drawDefinition:t,structureId:n}):s}function va({stage:t,drawDefinition:e}){return ha({entryStatus:Qr,drawDefinition:e,stage:t})}function ga({stage:t,drawDefinition:e}){return ha({entryStatus:Zr,drawDefinition:e,stage:t})}function ya({entryStatus:t=Qr,drawDefinition:e,stage:i}){if(t===Yr)return function({stage:t,drawDefinition:e}){var i;const{entryProfile:n}=da({drawDefinition:e});return(null===(i=n[t])||void 0===i?void 0:i.alternates)||0}({stage:i,drawDefinition:e})?Object.assign({positionsAvailable:1/0},ut):{error:"entryStatus not allowed in stage"};const n=function({stage:t,drawDefinition:e}){const i=ma({stage:t,drawDefinition:e}),n=fa({drawDefinition:e,stage:t});return i&&i-n}({drawDefinition:e,stage:i}),r=function({stage:t,drawDefinition:e}){const{entryProfile:i}=da({drawDefinition:e});return i[t].wildcardsCount||0}({stage:i,drawDefinition:e}),a=ha({entryStatus:Zr,drawDefinition:e,stage:i}),o=a+ha({entryStatus:Qr,drawDefinition:e,stage:i}),s=n-o;return o>=n?{error:"No stage space available for entryStatus"}:t===Zr?a<r?ut:{error:"No stage space available for entryStatus"}:Object.assign({positionsAvailable:s},ut)}function Ua({drawDefinition:t,structureId:e,structure:i}){var n,r;let a,o=[];if(i||({structure:i,error:a}=Fr({drawDefinition:t,structureId:e})),!i)return{seedAssignments:[],error:"structure not found"};e||(e=i.structureId);const{stage:s,stageSequence:c}=i;return a||(s===Rn&&t?o=Ia({drawDefinition:t,stageSequence:c,structureId:e,stage:s}).filter((t=>1===t.placementGroup)).sort(((t,e)=>t.GEMscore<e.GEMscore?1:t.GEMscore>e.GEMscore?-1:0)).map(((t,e)=>({participantId:t.participantId,seedNumber:e+1,seedValue:e+1,seedProxy:!0}))):i.seedAssignments?o=i.seedAssignments:a="Missing seedAssignments"),{seedAssignments:o,seedLimit:i.seedLimit||(null===(n=i)||void 0===n||null===(r=n.positionAssignments)||void 0===r?void 0:r.length),stage:s,stageSequence:c,error:a}}function wa({groupedOrder:t,roundPositionsCount:e}){if(!t||(null==t?void 0:t.length)<=e)return t;const i=st(t,t.length/e).map((t=>t.reduce(((t,e)=>t+e)))),n=i.slice().sort(Ie);return i.map((t=>n.indexOf(t)+1))}function Sa(t){if(!Array.isArray(t))return"";const e=t.filter(H);return e.length?J([Math.min(...e),Math.max(...e)]).join("-"):""}function Na({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:mt};if(({structure:i,error:n}=Fr({drawDefinition:t,structureId:e})),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map((t=>Na({structure:t}).positionAssignments))):i.positionAssignments?r=i.positionAssignments:n="Missing positionAssignments",{positionAssignments:r,error:n}}function Pa({structure:t,drawDefinition:e,structureId:i}){const{positionAssignments:n}=Na({drawDefinition:e,structureId:i,structure:t}),r=n.filter((t=>t.participantId||t.bye||t.qualifier)),a=n.length===r.length,o=n.filter((t=>!t.participantId&&!t.bye&&!t.qualifier));return{byePositions:n.filter((t=>!t.participantId&&t.bye)),assignedPositions:r,qualifierPositions:n.filter((t=>!t.participantId&&t.qualifier)),unassignedPositions:o,positionAssignments:n,allPositionsAssigned:a}}function Da({drawPositions:t,roundProfile:e,roundNumber:i}){const n=[void 0,void 0];if(t.reduce(((t,e)=>isNaN(parseInt(e))&&t),!0))return{orderedDrawPositions:n,displayOrder:n};const r=e[i],a=(null==r?void 0:r.pairedDrawPositions.find((e=>ot(e||[],t.filter(Boolean)))))||n,o=null==r?void 0:r.feedRound;if(function(t){return t.reduce(((t,e)=>!isNaN(parseInt(e))&&t),!0)}(t)){const e=t.sort(Ie);return{orderedDrawPositions:e,displayOrder:o?e:a}}if(o){const e=[t.find((t=>!isNaN(parseInt(t)))),void 0];return{orderedDrawPositions:e,displayOrder:e}}return{orderedDrawPositions:a,displayOrder:a}}function Ta({drawDefinition:t,structure:e}){return!!e&&!(null!=e&&e.structures||null!=t&&t.drawType&&t.drawType!==kn||null!=e&&e.matchUps.find((({roundPosition:t})=>!!t)))}function Ma({matchUp:t}){let e,i=[],n=[],r=[],a=[];if(t||(e="Missing matchUp"),t&&!t.sides&&(e="Invalid matchUp"),t&&!t.hasContext&&(e="Missing context"),!e){i=t.sides.map((t=>t.participantId));const e=t.sides.filter((t=>t.participantType===Ri)).map((t=>t.participantId)).filter(Boolean);a=t.sides.map((t=>t.participant&&t.participant.individualParticipants)).filter(Boolean).map((t=>t.map((t=>null==t?void 0:t.participantId)).filter(Boolean))),n=[].concat(...e,...a.flat()).filter(Boolean),r=J(n.concat(i)).filter(Boolean)}return{error:e,sideParticipantIds:i,individualParticipantIds:n,allRelevantParticipantIds:r,nestedIndividualParticipantIds:a}}function Aa({matchUp:t}){if(!t)return{error:"Missing matchUp"};if(!t.hasContext)return{error:"Missing context"};if(!t.sides||2!==t.sides.filter(Boolean).length)return{error:"Invalid matchUp"};const{sideParticipantIds:e,nestedIndividualParticipantIds:i,allRelevantParticipantIds:n}=Ma({matchUp:t}),r=(t.timeItems||[]).filter((t=>[Me,Ae].includes(null==t?void 0:t.itemType))).sort(((t,e)=>new Date(t.createdAt)-new Date(e.createdAt))),a=r.map((t=>t.itemValue)).filter((t=>r.filter((e=>(null==e?void 0:e.itemValue)===t)).reverse()[0].itemType===Me));return null==i||i.forEach(((t,i)=>{const n=e[i],r=(null==t?void 0:t.length)&&t.reduce(((t,e)=>t&&e&&a.includes(e)),!0);n&&r&&!a.includes(n)&&a.push(n)})),e.forEach(((t,e)=>{a.includes(t)&&(i[e]||[]).forEach((t=>{t&&!a.includes(t)&&a.push(t)}))})),{allParticipantsCheckedIn:e.reduce(((t,e)=>a.includes(e)&&t),!0),checkedInParticipantIds:a,allRelevantParticipantIds:n}}function Ea(t){const{matchUps:e,isCollectionMatchUp:i,matchUpStatuses:n,matchUpFormats:r,roundPositions:a,matchUpFormat:o,collectionIds:s,isMatchUpTie:c,matchUpTypes:u,roundNumbers:d,matchUpIds:l,scheduledDates:p,scheduledDate:m,processContext:f,tournamentIds:h,structureIds:I,courtIds:v,eventIds:g,venueIds:y,drawIds:U,stages:w,filterMatchUpIds:S=!0,filterMatchUpTypes:N=!0}=t,P=Array.isArray(n)?n.filter(Boolean):[],D=Array.isArray(w)?w.filter(Boolean):[],T=Array.isArray(s)?s.filter(Boolean):[],M=Array.isArray(d)?d.filter(Boolean):[],A=Array.isArray(a)?a.filter(Boolean):[],E=Array.isArray(l)&&S?l.filter(Boolean):[],b=Array.isArray(u)&&N?u.filter(Boolean):[],R=Array.isArray(v)?v.filter(Boolean):[],C=Array.isArray(y)?y.filter(Boolean):[],O=Array.isArray(r)?r.filter(Boolean):"string"==typeof o?[o]:[],L=Array.isArray(p)?p.filter(Boolean):"string"==typeof m&&m.length?[m]:[],x=Array.isArray(h)?h.filter(Boolean):[],F=Array.isArray(g)?g.filter(Boolean):[],k=Array.isArray(U)?U.filter(Boolean):[],_=Array.isArray(I)?I.filter(Boolean):[];return e.filter((t=>{if(void 0!==c){if(c&&!t.tieMatchUps)return!1;if(!c&&t.tieMatchUps)return!1}if(void 0!==i){if(i&&!t.collectionId)return!1;if(!i&&t.collectionId)return!1}if(D.length&&!D.includes(t.stage))return!1;if(T.length&&!T.includes(t.collectionId))return!1;if(M.length&&!d.includes(t.roundNumber))return!1;if(A.length&&!a.includes(t.roundPosition))return!1;if(P.length&&!P.includes(t.matchUpStatus))return!1;if(E.length&&!E.includes(t.matchUpId))return!1;if(b.length&&!b.includes(t.matchUpType))return!1;if(O.length&&!O.includes(t.matchUpFormat))return!1;if(null!=L&&L.length){const{scheduledTime:e}=pi({matchUp:t}),{scheduledDate:i}=mi({matchUp:t}),n=ne(e)||i;if(!L.find((t=>le(t,n))))return!1}if(R.length){const{courtId:e}=fi({matchUp:t});if(!v.filter(Boolean).includes(e))return!1}if(C.length){const{venueId:e}=hi({matchUp:t});if(!y.filter(Boolean).includes(e))return!1}if(f){if(x.length&&!x.includes(t.tournamentId))return!1;if(F.length&&!F.includes(t.eventId))return!1;if(k.length&&!k.includes(t.drawId))return!1;if(_.length&&!_.includes(t.structureId))return!1}return!0}))}function ba({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,tournamentParticipants:i,policyDefinitions:n,tournamentRecord:r,seedAssignments:a,drawDefinition:o,contextFilters:s,contextProfile:c,matchUpFilters:u,scheduleTiming:d,context:l={},matchUpsMap:p,roundFilter:m,structure:f,inContext:h,event:I}){var v,g,U,w,S;let N={},P={};if(!f)return{collectionPositionMatchUps:N,error:"Missing structure",roundMatchUps:P,matchUps:[]};const D=Array.isArray(null==u?void 0:u.eventIds)?u.eventIds.filter(Boolean):[],T=Array.isArray(null==u?void 0:u.structureIds)?u.structureIds.filter(Boolean):[],M=Array.isArray(null==u?void 0:u.drawIds)?u.drawIds.filter(Boolean):[],A=!(null!=l&&l.eventId)||!D.length&&!(null!=s&&null!==(v=s.eventIds)&&void 0!==v&&v.filter(Boolean).length)||D.includes(l.eventId)||(null==s||null===(g=s.eventIds)||void 0===g?void 0:g.includes(l.eventId)),E=!T.length||T.includes(f.structureId),b=!o||!M.length||M.includes(o.drawId);if(!A||!E||!b)return{matchUps:[],collectionPositionMatchUps:N,roundMatchUps:P};const{appliedPolicies:R}=Rr({drawDefinition:o}),C=Object.assign({},e,R,n),O=null==C||null===(U=C.scoring)||void 0===U?void 0:U.structures,L=(null==O?void 0:O.stage)&&(null==O?void 0:O.stage[f.stage]),x=(null==L?void 0:L.stageSequence)&&L.stageSequence[f.stageSequence],F=(null==C||null===(w=C.scoring)||void 0===w?void 0:w.requireAllPositionsAssigned)||(null==L?void 0:L.requireAllPositionsAssigned)||(null==x?void 0:x.requireAllPositionsAssigned);p||(p=Or({drawDefinition:o,structure:f}));const{positionAssignments:k,allPositionsAssigned:_}=Pa({structure:f}),j=!F||_,{seedAssignments:B}=Ua({drawDefinition:o,matchUpsMap:p,structure:f});a=a||B;const{structureId:G,structureName:V,stage:H,stageSequence:q,exitProfile:W}=f,{drawId:z,drawName:K}=o||{},Y=!!f.structures;let $=Lr({matchUpsMap:p,structureId:G,inContext:h});const Z=C&&C.roundNaming,{roundNamingProfile:Q,roundProfile:X}=function({roundNamingPolicy:t,structure:e,matchUps:i}){const n={},r=e.structures,a=Ta({structure:e}),o=function({drawDefinition:t,structure:e}){var i,n;if(!e)return!1;const{hasOddMatchUpsCount:r,roundMatchUps:a}=Cr({matchUps:e.matchUps||[]}),o=!(null==a||null===(i=a[1])||void 0===i||!i.find((({drawPositions:t})=>t))),s=!(null!=a&&null!==(n=a[2])&&void 0!==n&&n.find((({drawPositions:t})=>t)));return r&&!(null!=e&&e.structures)&&o&&s&&!(null!=t&&t.drawType&&t.drawType!==Gn)}({structure:e}),{roundProfile:s}=Cr({matchUps:i}),{structureAbbreviation:c,stage:u}=e,d=tr.roundNaming,l=(null==t?void 0:t.roundNamingMap)||d.roundNamingMap||{},p=(null==t?void 0:t.abbreviatedRoundNamingMap)||d.abbreviatedRoundNamingMap||{},m=(null==t?void 0:t.affixes)||d.affixes,f=u&&u!==An&&u[0],h=null==t?void 0:t.stageConstants,I=h&&h[u]||f;return r||a||o?Object.assign(n,...Object.keys(s).map((t=>({[t]:{roundName:`Round ${t}`,abbreviatedRoundName:`R${t}`}})))):Object.assign(n,...Object.keys(s).map((t=>{const{matchUpsCount:e,preFeedRound:i}=s[t],n=2*e,r=l[e]||`${m.roundNumber}${n}`,a=i?`-${m.preFeedRound}`:"",o=[I,c,`${r}${a}`].filter(Boolean).join("-"),u=p[e]||`${m.roundNumber}${n}`;return{[t]:{abbreviatedRoundName:[I,c,`${u}${a}`].filter(Boolean).join("-"),roundName:o}}}))),{roundNamingProfile:n,roundProfile:s}}({roundNamingPolicy:Z,drawDefinition:o,structure:f,matchUps:$});if(u&&($=Ea({matchUps:$,...u,filterMatchUpTypes:!1,filterMatchUpIds:!1})),h){var tt;const{sourceDrawPositionRanges:e}=function({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:mt};if(!e)return{error:"Missing structureId"};const{structure:n}=Fr({drawDefinition:t,structureId:e});if(n.stage!==bn)return{message:"Structure is not CONSOLATION stage"};const{links:r}=t,a=(null==r?void 0:r.filter((t=>t.target.structureId===e)))||[],o=(null==a?void 0:a.reduce(((t,e)=>{const{structureId:i}=e.source;return t.includes(i)?t:t.concat(i)}),[]))||[],s=Object.assign({},...o.map((t=>{const e=Lr({matchUpsMap:i,structureId:t}),{roundProfile:n}=Cr({matchUps:e});return{[t]:n}}))),c=Lr({matchUpsMap:i,structureId:e}),{roundProfile:u}=Cr({matchUps:c}),d={};return null==a||a.forEach((t=>{const{structureId:e,roundNumber:i}=t.source,{feedProfile:n,groupedOrder:r,positionInterleave:a,roundNumber:o}=t.target,c=s[e],l=c[1]&&c[1].drawPositions,p=c[i],m=null==p?void 0:p.matchUpsCount;if(!m)return;const f=m?l.length/m:0,h=l.length/f;let I=l.slice();const v=wa({groupedOrder:r,roundPositionsCount:I.length}),g=(null==v?void 0:v.length)||1;if(g<=h){const t=st(I,l.length/g);"BOTTOM_UP"===n&&t.forEach((t=>t.reverse())),I=(null==v?void 0:v.length)&&(null==v?void 0:v.map((e=>t[e-1])).flat())||I}let y=st(I,f);if(null!=v&&v.length||"BOTTOM_UP"===n&&y.reverse(),a){const t=nt(0,a.interleave).map((()=>{})),e=nt(0,a.offset).map((()=>{}));y=y.map((e=>[e,...t])),y.unshift(e),y=y.flat(1);const i=y.length-a.offset;y=y.slice(0,i)}d[o]||(d[o]={});const U=u[o],w=null!=U&&U.feedRound?2:1;y.forEach(((t,e)=>{const i=1+e*w;d[o][i]||(d[o][i]=Sa(t))}))})),{sourceDrawPositionRanges:d}}({drawDefinition:o,matchUpsMap:p,structureId:G}),{drawPositionsRanges:i}=function({drawDefinition:t,structureId:e,matchUpsMap:i}){var n;if(!t)return{error:mt};if(!e)return{error:"Missing structureId"};const r=Lr({matchUpsMap:i,structureId:e}),{roundProfile:a}=Cr({matchUps:r}),o=(Math.min(...(null===(n=a[1])||void 0===n?void 0:n.drawPositions)||[])||1)-1,s=Object.keys(a);return{drawPositionsRanges:Object.assign({},...(s||[]).map((t=>{var e;const{matchUpsCount:i}=a[t],n=(null===(e=a[1])||void 0===e?void 0:e.drawPositions)||[],r=st(n,n.length/i),c=r.map(Sa),u=r.map((t=>t.map((t=>t-o)))).map(Sa),d=s.map((e=>{if(e>t)return;const{drawPositions:n}=a[e];return st(n,n.length/i)})).filter(Boolean),l=nt(0,i).map((t=>d.map((e=>e[t])).flat().filter(Boolean).sort(Ie))).map((t=>J(t))),p=l.map((t=>{return(e=t,e.reduce(((t,e)=>{const i=t[t.length-1];return i&&i[i.length-1]===e-1||t.push([]),t[t.length-1].push(e),t}),[])).map(Sa).join(", ");var e})),m=Object.assign({},...nt(0,i).map((t=>({[t+1]:{firstRoundDrawPositionsRange:c[t],firstRoundOffsetDrawPositionsRange:u[t],possibleDrawPositions:l[t],drawPositionsRange:p[t]}}))));return{[t]:m}})))}}({drawDefinition:o,matchUpsMap:p,structureId:G});$=$.map((n=>it({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,drawPositionsRanges:i,roundNamingProfile:Q,appliedPolicies:C,isRoundRobin:Y,roundProfile:X,matchUp:n,event:I}))),(null===(tt=$)||void 0===tt?void 0:tt.filter((t=>Array.isArray(t.tieMatchUps)))).forEach((t=>{const e=t.tieMatchUps;$=$.concat(...e)})),s&&($=Ea({processContext:!0,...s,matchUps:$}))}else{var et;(null===(et=$)||void 0===et?void 0:et.filter((t=>Array.isArray(t.tieMatchUps)))).forEach((t=>{const e=t.tieMatchUps;$=$.concat(...e)}))}return(null!=u&&u.matchUpTypes||null!=u&&u.matchUpIds)&&($=Ea({matchUpTypes:u.matchUpTypes,matchUpIds:u.matchUpIds,matchUps:$})),({roundMatchUps:P}=Cr({matchUps:$})),({collectionPositionMatchUps:N}=function({matchUps:t}){const e=t.reduce(((t,e)=>!e.collectionPosition||t.includes(e.collectionPosition)?t:t.concat(e.collectionPosition)),[]).map((e=>({[e]:t.filter((t=>t.collectionPosition===e))})));return{collectionPositionMatchUps:Object.assign({},...e)}}({matchUps:$})),m&&($=null===(S=$)||void 0===S?void 0:S.filter((t=>t.roundNumber===m))),{matchUps:$,roundMatchUps:P,collectionPositionMatchUps:N};function it({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,additionalContext:n={},drawPositionsRanges:s,roundNamingProfile:u,tieDrawPositions:p,appliedPolicies:m,isCollectionBye:h,matchUpTieId:I,isRoundRobin:v,roundProfile:g,sideLineUps:U,matchUp:w,event:S}){var N,P,D,T,M;const A=w.tieFormat||f.tieFormat||(null==o?void 0:o.tieFormat)||(null==S?void 0:S.tieFormat)||void 0,E=null==A?void 0:A.collectionDefinitions,b=w.collectionId&&(null==E?void 0:E.find((t=>t.collectionId===w.collectionId))),R=w.matchUpFormat||w.collectionId?b&&b.matchUpFormat:f.matchUpFormat||(null==o?void 0:o.matchUpFormat)||(null==S?void 0:S.matchUpFormat),C=w.matchUpType||(null==b?void 0:b.matchUpType)||f.matchUpType||(null==o?void 0:o.matchUpType)||(null==S?void 0:S.eventType)!==gi&&(null==S?void 0:S.eventType),O=h?y:w.matchUpStatus,{schedule:L,endDate:x}=Ti({scheduleVisibilityFilters:t,tournamentRecord:r,scheduleTiming:d,matchUpFormat:R,matchUpType:C,matchUp:w,event:S}),F=p||w.drawPositions,{collectionPosition:_,collectionId:B,roundPosition:Y}=w,$=w.roundNumber||n.roundNumber,J=function({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],drawDefinition:r,collectionId:a,sideLineUps:o,matchUpType:s}){if(!a||!i)return;const c=(null==n?void 0:n.map((n=>{var c,u,d;const l=null===(c=e.find((t=>t.drawPosition===n)))||void 0===c?void 0:c.participantId,p=null==o?void 0:o.find((t=>(null==t?void 0:t.drawPosition)===n)),m=(null==p?void 0:p.teamParticipant)||(null==t?void 0:t.find((({participantId:t})=>t===l))),f=(null==p?void 0:p.lineUp)||(null===(u=Pr({participantId:l,drawDefinition:r}))||void 0===u?void 0:u.lineUp),h=null==f?void 0:f.filter((t=>t.collectionAssignments.find((t=>t.collectionId===a&&t.collectionPosition===i))));if(s===ii||2===(null==h?void 0:h.length)){const e=null==h?void 0:h.map(Ar),{participant:i}=Nr({tournamentParticipants:t,participantIds:e}),r=null==i?void 0:i.participantId;return{[n]:{participantId:r,teamParticipant:m}}}const I=null==h||null===(d=h[0])||void 0===d?void 0:d.participantId;return I&&{[n]:{participantId:I,teamParticipant:m}}})).filter(Boolean))||{};return Object.assign({},...c)}({tournamentParticipants:i,positionAssignments:k,collectionPosition:_,drawDefinition:o,drawPositions:F,collectionId:B,sideLineUps:U,matchUpType:C}),Z=u&&(null===(N=u[$])||void 0===N?void 0:N.roundName)||n.roundName,Q=u&&(null===(P=u[$])||void 0===P?void 0:P.abbreviatedRoundName)||n.abbreviatedRoundName,X=null==g||null===(D=g[$])||void 0===D?void 0:D.feedRound,tt=null==g||null===(T=g[$])||void 0===T?void 0:T.preFeedRound,et=null==g||null===(M=g[$])||void 0===M?void 0:M.roundFactor,nt=s&&s[$],rt=nt&&nt[Y],at=e&&e[$],ot=t=>fe(t,void 0,!0),st=Object.assign({},ot(l),ot({matchUpFormat:w.matchUpType===gi?void 0:R,tieFormat:w.matchUpType!==gi?void 0:A,endDate:w.endDate||x,abbreviatedRoundName:Q,drawPositionsRange:rt,structureName:V,stageSequence:q,drawPositions:F,matchUpStatus:O,isRoundRobin:v,matchUpTieId:I,preFeedRound:tt,roundFactor:et,matchUpType:C,exitProfile:W,structureId:G,roundNumber:$,feedRound:X,roundName:Z,drawName:K,schedule:L,drawId:z,stage:H}),me(ot(w),!0,!0));if(Array.isArray(F)){const{orderedDrawPositions:t,displayOrder:e}=Da({drawPositions:F,roundProfile:g,roundPosition:Y,roundNumber:$}),i=g[$]&&g[$].feedRound,n=e[0]!==t[0],r=t.map(((t,e)=>{var r;const o=e+1,s=function({drawPositionCollectionAssignment:t,positionAssignments:e,displaySideNumber:i,seedAssignments:n,drawPosition:r,isFeedRound:a,sideNumber:o}){var s,c,u;const d=e.find((t=>t.drawPosition===r)),l=t?null===(s=t[r])||void 0===s?void 0:s.participantId:null==d?void 0:d.participantId,p=d?function({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){const a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){const t=function({seedAssignments:t,participantId:e}){return t.find((t=>!t.seedProxy&&t.participantId===e))}({seedAssignments:e,participantId:i});Object.assign(a,t,{participantId:i})}else n.bye?Object.assign(a,{bye:!0}):n.qualifier&&Object.assign(a,{qualifier:!0});return a}({displaySideNumber:i,seedAssignments:n,participantId:l,assignment:d,sideNumber:o}):{};a&&(1===o?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0}));const m=null==t||null===(c=t[r])||void 0===c?void 0:c.teamParticipant,f=null==t||null===(u=t[r])||void 0===u?void 0:u.participant;return f&&Object.assign(p,{participant:f}),m&&Object.assign(p,{teamParticipant:m}),p}({drawPositionCollectionAssignment:J,positionAssignments:k,displaySideNumber:n?3-o:o,seedAssignments:a,drawPosition:t,isFeedRound:i,sideNumber:o}),c=null===(r=w.sides)||void 0===r?void 0:r.find((t=>t.sideNumber===o)),u=at&&at[2*(Y-1)+e+1];return ot({sourceDrawPositionRange:u,...c,...s})}));Object.assign(st,me({sides:r},!0,!0))}if(i&&st.sides&&(st.sides.filter(Boolean).forEach((t=>{var e;if(t.participantId){const e=Ye({policyDefinitions:m,participantId:t.participantId,tournamentParticipants:i});if(e){if(null!=o&&o.entries){const i=o.entries.find((e=>e.participantId===t.participantId));null!=i&&i.entryStatus&&(e.entryStatus=i.entryStatus||Yr)}Object.assign(t,{participant:e})}}if(null!=t&&null!==(e=t.participant)&&void 0!==e&&e.individualParticipantIds){const e=t.participant.individualParticipantIds.map((t=>Ye({policyDefinitions:m,tournamentParticipants:i,participantId:t})));Object.assign(t.participant,{individualParticipants:e})}})),!st.matchUpType)){const{matchUpType:t}=function({matchUp:t={}}={}){var e;let i=t.matchUpType;if(!i&&null!==(e=t.sides)&&void 0!==e&&e.length){const e=t.sides.find((({participant:t})=>t)),n=null==e?void 0:e.participant,r=null==n?void 0:n.participantType;i=r===Ri?ei:r===Oi?ii:r===Ci?Ci:void 0}return{matchUpType:i}}({matchUp:st});t&&Object.assign(st,{matchUpType:t})}if(st.tieMatchUps){var ct;const i=st.matchUpStatus===y,n=null===(ct=st.sides)||void 0===ct?void 0:ct.map((({participant:t,drawPosition:e,sideNumber:i,lineUp:n})=>{const r=(null==t?void 0:t.participantType)===gi&&t;return{teamParticipant:r&&fe({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participanOthertName,participantName:r.participantName,participantId:r.participantId,teamId:r.teamId}),drawPosition:e,sideNumber:i,lineUp:n}}));st.tieMatchUps=st.tieMatchUps.map((r=>{const a=st.matchUpId;return it({tieDrawPositions:F,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:n,drawPositionsRanges:s,roundNamingProfile:u,additionalContext:{abbreviatedRoundName:Q,roundNumber:$,roundName:Z},appliedPolicies:m,isCollectionBye:i,matchUpTieId:a,isRoundRobin:v,roundProfile:g,matchUp:r,event:S})}))}const ut=st.sides&&2===st.sides.filter((t=>t&&t.participantId)).length,dt=!st.winningSide,lt=j&&ut&&dt;if(Object.assign(st,{readyToScore:lt,hasContext:!0}),ut){const{allParticipantsCheckedIn:t,checkedInParticipantIds:e}=Aa({matchUp:st});Object.assign(st,{allParticipantsCheckedIn:t,checkedInParticipantIds:e})}return Array.isArray(null==c?void 0:c.exclude),st}}function Ra({tournamentParticipants:t,drawDefinition:e,contextProfile:i,matchUpsMap:n,matchUpId:r,inContext:a,context:o,event:s}){if(!e)return{error:mt};if(!r)return{error:"Missing matchUpId"};if("string"!=typeof r)return{error:gt};const{structures:c}=kr({drawDefinition:e});for(const u of c){const{matchUps:c}=ba({tournamentParticipants:t,drawDefinition:e,contextProfile:i,matchUpsMap:n,inContext:a,structure:u,context:o,event:s}),{matchUp:d}=Mi({matchUps:c,matchUpId:r});if(d)return{matchUp:d,structure:u}}return{error:"matchUp not found"}}function Ca({duplicateValues:t,drawDefinition:e,disableNotice:i,matchUpId:n,timeItem:r,event:a}){const{matchUp:o}=Ra({drawDefinition:e,event:a,matchUpId:n});if(!o)return{error:"matchUp not found"};const s=mr({element:o,timeItem:r,duplicateValues:t});return i||Ur({drawDefinition:e,matchUp:o}),s}function Oa({tournamentRecord:t,drawDefinition:e,matchUpId:i,venueId:n,disableNotice:r}){if(!t)return{error:pt};if(!i)return{error:"Missing matchUpId"};if(n){const{error:e}=wi({tournamentRecord:t,venueId:n});if(e)return{error:e}}return Ca({drawDefinition:e,matchUpId:i,timeItem:{itemType:be,itemValue:n},disableNotice:r,duplicateValues:!1})}function La({tournamentRecord:t,drawDefinition:e,courtDayDate:i,matchUpId:n,courtId:r,disableNotice:a}){if(!t)return{error:pt};if(!n)return{error:"Missing matchUpId"};if(r){const{venue:i,error:o}=Si({tournamentRecord:t,courtId:r});if(o)return{error:o};Oa({tournamentRecord:t,drawDefinition:e,matchUpId:n,venueId:null==i?void 0:i.venueId,disableNotice:a})}return Ca({drawDefinition:e,matchUpId:n,timeItem:{itemType:Ee,itemDate:i,itemValue:r},disableNotice:a,duplicateValues:!1})}function xa(t){if(Gt.test(t)){const e=Kt(new Date);return new Date(`${e}T${t}`)}return new Date(t)}function Fa(t){return!(void 0!==t&&!Ht.test(t))}function ka({tournamentRecord:t,drawDefinition:e,disableNotice:i,matchUpId:n,schedule:r,event:a}){if(!e)return{error:mt};if(!n)return{error:"Missing matchUpId"};if(!r)return{error:It};const{endTime:o,courtId:s,resumeTime:c,scheduledDate:u,scheduledTime:d,startTime:l,stopTime:p,venueId:m}=r;if(void 0!==u){const t=_a({disableNotice:!0,drawDefinition:e,scheduledDate:u,matchUpId:n});if(null!=t&&t.error)return{error:t.error,scheduledDate:u}}if(void 0!==d){const t=ja({disableNotice:!0,drawDefinition:e,scheduledTime:d,matchUpId:n});if(null!=t&&t.error)return{error:t.error,scheduledTime:d}}if(void 0!==l){const t=Ga({disableNotice:!0,drawDefinition:e,matchUpId:n,startTime:l,event:a});if(null!=t&&t.error)return{error:t.error,startTime:l}}if(void 0!==p){const t=Ha({disableNotice:!0,drawDefinition:e,matchUpId:n,stopTime:p,event:a});if(null!=t&&t.error)return{error:t.error,stopTime:p}}if(void 0!==c){const t=qa({disableNotice:!0,drawDefinition:e,resumeTime:c,matchUpId:n,event:a});if(null!=t&&t.error)return{error:t.error,resumeTime:c}}if(void 0!==o){const t=Va({disableNotice:!0,drawDefinition:e,matchUpId:n,endTime:o,event:a});if(null!=t&&t.error)return{error:t.error,endTime:o}}if(void 0!==s&&void 0!==u){const i=La({courtDayDate:u,disableNotice:!0,tournamentRecord:t,drawDefinition:e,matchUpId:n,courtId:s,event:a});if(null!=i&&i.error)return{error:i.error,courtId:s}}else if(void 0!==m){const i=Oa({disableNotice:!0,tournamentRecord:t,drawDefinition:e,matchUpId:n,venueId:m,event:a});if(null!=i&&i.error)return{error:i.error,venueId:m}}if(!i){const{matchUp:t}=Ra({drawDefinition:e,event:a,matchUpId:n});if(!t)return{error:"matchUp not found"};Ur({drawDefinition:e,matchUp:t})}return{...ut}}function _a({drawDefinition:t,disableNotice:e,scheduledDate:i,matchUpId:n}){if(!n)return{error:"Missing matchUpId"};const r=Vt.test(i);return i&&!r?{error:vt}:Ca({duplicateValues:!1,drawDefinition:t,disableNotice:e,matchUpId:n,timeItem:{itemType:"SCHEDULE.DATE",itemValue:i}})}function ja({drawDefinition:t,disableNotice:e,scheduledTime:i,matchUpId:n}){return n?Fa(i)?Ca({duplicateValues:!1,drawDefinition:t,disableNotice:e,matchUpId:n,timeItem:{itemType:"SCHEDULE.TIME.SCHEDULED",itemValue:i}}):{error:"Invalid time"}:{error:"Missing matchUpId"}}function Ba({drawDefinition:t,disableNotice:e,participantId:i,officialType:n,matchUpId:r}){return r?Ca({duplicateValues:!1,drawDefinition:t,disableNotice:e,matchUpId:r,timeItem:{itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemSubTypes:[n],itemValue:i}}):{error:"Missing matchUpId"}}function Ga({drawDefinition:t,disableNotice:e,matchUpId:i,startTime:n,event:r}){if(!i)return{error:"Missing matchUpId"};if(!Fa(n))return{error:"Invalid time"};const{matchUp:a}=Ra({drawDefinition:t,event:r,matchUpId:i}),o=(a.timeItems||[]).filter((t=>[Ce,Oe,Le].includes(null==t?void 0:t.itemType))).map((t=>xa(t.itemValue))).reduce(((t,e)=>!t||e<t?e:t),void 0);return!o||xa(n)<o?(a.timeItems&&(a.timeItems=a.timeItems.filter((t=>t.itemType!==Re))),Ca({duplicateValues:!1,drawDefinition:t,disableNotice:e,matchUpId:i,timeItem:{itemType:Re,itemValue:n}})):{error:"Invalid startTime"}}function Va({drawDefinition:t,disableNotice:e,matchUpId:i,endTime:n,event:r}){if(!i)return{error:"Missing matchUpId"};if(!Fa(n))return{error:"Invalid time"};const{matchUp:a}=Ra({drawDefinition:t,event:r,matchUpId:i}),o=(a.timeItems||[]).filter((t=>[Re,Oe,Ce].includes(null==t?void 0:t.itemType))).map((t=>xa(t.itemValue))).reduce(((t,e)=>!t||e>t?e:t),void 0);return!o||xa(n)>o?(a.timeItems&&(a.timeItems=a.timeItems.filter((t=>t.itemType!==Le))),Ca({duplicateValues:!1,drawDefinition:t,disableNotice:e,matchUpId:i,timeItem:{itemType:Le,itemValue:n}})):{error:"Invalid endTime"}}function Ha({drawDefinition:t,disableNotice:e,matchUpId:i,stopTime:n,event:r}){if(!i)return{error:"Missing matchUpId"};if(!Fa(n))return{error:"Invalid time"};const{matchUp:a}=Ra({drawDefinition:t,event:r,matchUpId:i}),o=a.timeItems||[];if(o.reduce(((t,e)=>e.itemType===Le||t),void 0))return{error:"Existing endTime"};const s=o.filter((t=>[Re,Oe,Ce].includes(null==t?void 0:t.itemType))).sort(((t,e)=>xa(t.itemValue)-xa(e.itemValue))),c=s[s.length-1],u=c&&c.itemType===Ce,d=s.filter((t=>!u||t.createdAt!==c.createdAt)).map((t=>xa(t.itemValue))).reduce(((t,e)=>!t||e>t?e:t),void 0);if(xa(n)>d){if(a.timeItems&&u){const t=c.createdAt;a.timeItems=a.timeItems.filter((e=>e.createdAt!==t))}return Ca({duplicateValues:!0,drawDefinition:t,disableNotice:e,matchUpId:i,timeItem:{itemType:Ce,itemValue:n}})}return{error:"Invalid stopTime"}}function qa({drawDefinition:t,disableNotice:e,resumeTime:i,matchUpId:n,event:r}){if(!n)return{error:"Missing matchUpId"};if(!Fa(i))return{error:"Invalid time"};const{matchUp:a}=Ra({drawDefinition:t,event:r,matchUpId:n}),o=a.timeItems||[];if(o.reduce(((t,e)=>e.itemType===Le||t),void 0))return{error:"Existing endTime"};const s=o.filter((t=>[Re,Oe,Ce].includes(null==t?void 0:t.itemType))).sort(((t,e)=>xa(t.itemValue)-xa(e.itemValue))),c=s[s.length-1],u=c&&c.itemType===Oe,d=s.filter((t=>!u||t.createdAt!==c.createdAt)).map((t=>xa(t.itemValue))).reduce(((t,e)=>!t||e>t?e:t),void 0);if(xa(i)>d){if(a.timeItems&&u){const t=c.createdAt;a.timeItems=a.timeItems.filter((e=>e.createdAt!==t))}return Ca({duplicateValues:!0,drawDefinition:t,disableNotice:e,matchUpId:n,timeItem:{itemType:Oe,itemValue:i}})}return{error:"Invalid resumeTime"}}function Wa(t){const{nationalityCode:e}=t||{};if(e){const i=Nn.find((({ioc:t})=>t===e));null!=i&&i.iso&&!t.isoNationalityCode&&(t.isoNationalityCode=i.iso),null!=i&&i.label&&!t.countryName&&(t.countryName=i.label)}}function za({participant:t}){const{person:e,individualParticipants:i}=t;[e,null==i?void 0:i.map((({person:t})=>t))].flat().filter(Boolean).forEach(Wa)}function Ka({participants:t=[]}){const e=me(t,!0,!0),i=e.filter((t=>t.participantType===Ci)),n=e.filter((t=>t.participantType===Li)),r=e.filter((t=>t.participantType===Oi));return e.forEach((t=>{if(t.participantType===Ri){const{participantId:e}=t;t.groupParticipantIds=[],t.teamParticipantIds=[],t.pairParticipantIds=[],t.groups=[],t.teams=[],i.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((n=>{n!==e||t.teamParticipantIds.includes(i.participantId)||(t.teamParticipantIds.push(i.participantId),t.teams.push({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participantOtherName,participantName:i.participantName,participantId:i.participantId,teamId:i.teamId}))}))})),r.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((n=>{n!==e||t.pairParticipantIds.includes(i.participantId)||t.pairParticipantIds.push(i.participantId)}))})),n.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((n=>{n!==e||t.groupParticipantIds.includes(i.participantId)||(t.groupParticipantIds.push(i.participantId),t.groups.push({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participantOtherName,participantName:i.participantName,participantId:i.participantId}))}))}))}})),e}function Ya({drawDefinition:t,inContextDrawMatchUps:e,targetLink:i,sourceRoundPosition:n,sourceRoundMatchUpCount:r}){if(!i)return{error:"Missing targetLink"};const{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:c,positionInterleave:u}}=i,{structure:d}=Fr({drawDefinition:t,structureId:a}),{positionAssignments:l}=Na({structure:d}),p=(null==e?void 0:e.filter((t=>t.structureId===d.structureId))).filter((t=>t.roundNumber===c)),m=p.length,f=nt(1,m+1),h=m/r;let I=Math.ceil(h*n),v=1-n%2;if(null!=u&&u.interleave&&.5!==h){const t=n+(u.offset+(n-1)*u.interleave);I=Math.ceil(t/2),v=1-t%2}let g=f,y=f[I-1];const U=wa({groupedOrder:s,roundPositionsCount:f.length}),w=(null==U?void 0:U.length)||1;if(w<=f.length){const t=st(f,m/w);"BOTTOM_UP"===o&&t.forEach((t=>t.reverse())),g=(null==U?void 0:U.length)&&(null==U?void 0:U.map((e=>t[e-1])).flat())||g}o===xn?y=g[I-1]:"BOTTOM_UP"===o?((null==U||!U.length||w>f.length)&&(I=p.length+1-I),y=g[I-1]):"RANDOM"===o?Pt()&&console.log("not implemented:",{feedProfile:o}):"DRAW"===o&&Pt()&&console.log("not implemented:",{feedProfile:o});const S=y&&p.reduce(((t,e)=>e.roundPosition===y?e:t),void 0);let N;var P;null!=S&&S.feedRound?(v=0,N=Math.min(...(S.drawPositions||[]).filter(Boolean))):N=2===(null==S||null===(P=S.drawPositions)||void 0===P?void 0:P.length)&&(null==S?void 0:S.drawPositions[v]);const D=l.find((({drawPosition:t})=>t===N));if(D){const{extension:t}=Je({element:D,name:"disableLinks"});if(null!=t&&t.value)return{disabledDrawPosition:N}}return{matchUp:S,targetDrawPosition:N,matchUpDrawPositionIndex:v}}function $a({source:t,linkType:e,finishingPositions:i}){return t.reduce(((t,n)=>{var r,a;return null!==(r=n.source)&&void 0!==r&&r.finishingPositions&&i&&!ot(i,null===(a=n.source)||void 0===a?void 0:a.finishingPositions)||n.linkType!==e?t:n}),void 0)}function Ja({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce(((t,n)=>{var r,a;return(null===(r=n.source)||void 0===r?void 0:r.structureId)!==e||i&&n.source.roundNumber!==i||(t.source=t.source.concat(n)),(null===(a=n.target)||void 0===a?void 0:a.structureId)!==e||i&&n.target.roundNumber!==i||(t.target=t.target.concat(n)),t}),{source:[],target:[]})}:{error:"Missing structureId"}:{error:mt}}function Za({matchUpId:t,drawDefinition:e,inContextDrawMatchUps:i=[],inContextMatchUp:n,useTargetMatchUpIds:r=!1}){let a=n;i.length&&!a&&(a=i.find((e=>e.matchUpId===t)));const{structure:o}=Fr({drawDefinition:e,structureId:a.structureId}),{finishingPosition:s}=o;return"ROUND_OUTCOME"===s?function({matchUp:t,structure:e,drawDefinition:i,inContextDrawMatchUps:n,useTargetMatchUpIds:r}){const{links:{source:a}}=function({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:mt};if(!i)return{error:"Missing structureId"};const{links:n}=Ja({drawDefinition:t,structureId:i});return{links:{source:n.source.reduce(((t,i)=>i.source.roundNumber&&i.source.roundNumber!==e?t:t.concat(i)),[]),target:n.target.reduce(((t,i)=>i.target.roundNumber&&i.target.roundNumber!==e?t:t.concat(i)),[])}}}({drawDefinition:i,roundNumber:t.roundNumber,structureId:e.structureId}),o=$a({source:a,linkType:"WINNER"}),s=$a({source:a,linkType:Fn}),{winnerMatchUpId:c,loserMatchUpId:u}=t;let d,l,p,m,f,h,I;if(r&&(m=c&&n.find((({matchUpId:t})=>t===c)),d=u&&n.find((({matchUpId:t})=>t===u))),o&&!m||s&&!d){const{roundPosition:r}=t;I=I||n.filter((t=>t.structureId===e.structureId));const a=I.reduce(((e,i)=>i.roundNumber===t.roundNumber?e+1:e),0);s&&({matchUp:d,matchUpDrawPositionIndex:p,targetDrawPosition:l}=Ya({drawDefinition:i,inContextDrawMatchUps:n,sourceRoundPosition:r,sourceRoundMatchUpCount:a,targetLink:s})),o&&({matchUp:m,matchUpDrawPositionIndex:h,targetDrawPosition:f}=Ya({drawDefinition:i,inContextDrawMatchUps:n,sourceRoundPosition:r,sourceRoundMatchUpCount:a,targetLink:o}))}return m||(I=I||n.filter((t=>t.structureId===e.structureId)),({matchUp:m}=function({structureMatchUps:t,matchUp:e}){const{roundNumber:i,roundPosition:n}=e,r=t.filter((t=>t.roundNumber===i)),a=t.filter((t=>t.roundNumber===i+1));if(a.length){let t;return a.length===r.length?t=a.find((t=>t.roundPosition===n)):a.length===r.length/2&&(t=a.find((t=>t.roundPosition===Math.ceil(n/2)))),{matchUp:t}}return{error:"no progression found"}}({structureMatchUps:I,matchUp:t}))),{matchUp:t,targetLinks:{loserTargetLink:s,winnerTargetLink:o},targetMatchUps:{loserMatchUp:d,winnerMatchUp:m,loserTargetDrawPosition:l,winnerTargetDrawPosition:f,loserMatchUpDrawPositionIndex:p,winnerMatchUpDrawPositionIndex:h}}}({drawDefinition:e,inContextDrawMatchUps:i,structure:o,matchUp:a,useTargetMatchUpIds:r}):function({matchUp:t}){return{matchUp:t,targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0}}}({drawDefinition:e,matchUp:a,structure:o})}function Qa({drawDefinition:t,inContextDrawMatchUps:e}){const i={};return e.forEach((n=>{const{matchUpId:r,structureId:a,drawPositions:o=[]}=n,{structure:s}=Fr({drawDefinition:t,structureId:a});if("WIN_RATIO"===(null==s?void 0:s.finishingPosition)){const{roundNumber:t}=n,e=t&&parseInt(t)+1,i=s.matchUps||[],{roundMatchUps:r}=Cr({matchUps:i});if(e&&r[e]){const t=o.sort().map(((t,i)=>{const n=r[e].find((e=>{var i;return null===(i=e.drawPositions)||void 0===i?void 0:i.includes(t)}));return{matchUpId:null==n?void 0:n.matchUpId,roundNumber:e,schedule:null==n?void 0:n.schedule,sideNumber:i+1,structureName:s.structureName}}));Object.assign(n,{sidesTo:t})}}else{var c,u;const a=Za({matchUpId:r,drawDefinition:t,inContextMatchUp:n,inContextDrawMatchUps:e,useTargetMatchUpIds:!0}),{winnerMatchUp:o,loserMatchUp:s}=a.targetMatchUps;!n.winnerMatchUpId&&o&&(n.winnerMatchUpId=o.matchUpId),!n.loserMatchUpId&&s&&(n.loserMatchUpId=s.matchUpId);const I=to({upcomingMatchUp:o});let v=to({upcomingMatchUp:s});if(n.matchUpStatus!==y&&(null==s?void 0:s.matchUpStatus)===y){const{matchUp:i}=Xa({matchUp:s,drawDefinition:t,inContextDrawMatchUps:e})||{};v=i&&to({upcomingMatchUp:i})||v}const g=null===(c=n.schedule)||void 0===c?void 0:c.timeAfterRecovery;var d,l,p;if(g)null!=I&&null!==(d=I.schedule)&&void 0!==d&&d.scheduledTime&&te(I.schedule.scheduledTime)<te(g)&&(i[I.matchUpId]=n.matchUpId,I.schedule.scheduleConflict=n.matchUpId),null!==(l=v)&&void 0!==l&&null!==(p=l.schedule)&&void 0!==p&&p.scheduledTime&&te(v.schedule.scheduledTime)<te(g)&&(i[v.matchUpId]=n.matchUpId,v.schedule.scheduleConflict=n.matchUpId);if(Object.assign(n,{winnerTo:I,loserTo:v}),null!==(u=n.drawPositions)&&void 0!==u&&u.filter(Boolean).length){var m;const t=null===(m=a.targetLinks)||void 0===m?void 0:m.loserTargetLink,e="FIRST_MATCHUP"===(null==t?void 0:t.linkCondition),i=(null==(f=n)||null===(h=f.sides)||void 0===h?void 0:h.map((({participant:t,participantId:e,qualifier:i})=>t||e&&{participantId:e}||i&&{qualifier:i})).filter(Boolean))||[];if(i.length){const t=Mr(null==o?void 0:o.sides),n=Mr(null==s?void 0:s.sides),r=i.find((({participantId:e})=>t.includes(e)))?[]:i,a=i.find((({participantId:t})=>n.includes(t)))?[]:i;s&&e&&a.length<2&&a.push({bye:!0,tbd:!0}),null!=r&&r.length&&o&&(o.potentialParticipants||(o.potentialParticipants=[]),o.potentialParticipants.push(r)),null!=a&&a.length&&s&&(s.potentialParticipants||(s.potentialParticipants=[]),s.potentialParticipants.push(a))}}}var f,h})),Object.keys(i).length&&e.forEach((t=>{Object.keys(i).includes(t.matchUpId)&&(t.schedule.scheduleConflict=i[t.matchUpId])})),{scheduleConflictMatchUpIds:i}}function Xa({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){const{matchUpId:n,matchUpStatus:r,structureId:a}=t||{};if(!t||!a||(null==t?void 0:t.matchUpStatus)===A)return{matchUp:t};if(r===y){let r;if(t.winnerMatchUpId)r=i.find((({matchUpId:e})=>e===t.winnerMatchUpId));else{const t=Za({matchUpId:n,drawDefinition:e,inContextDrawMatchUps:i});({winnerMatchUp:r}=(null==t?void 0:t.targetMatchUps)||{})}return Xa({matchUp:r,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function to({upcomingMatchUp:t}={}){if(t)return(({matchUpId:t,structureId:e,schedule:i,roundNumber:n,roundPosition:r,structureName:a})=>({matchUpId:t,structureId:e,schedule:i,roundNumber:n,roundPosition:r,structureName:a}))(t)}function eo({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,policyDefinitions:r,tournamentRecord:a,drawDefinition:o,matchUpFilters:s,contextFilters:c,contextProfile:u,scheduleTiming:d,matchUpsMap:l,roundFilter:p,structureId:m,inContext:f,structure:h,context:I,event:v}){!h&&m&&({structure:h}=Fr({drawDefinition:o,structureId:m}));const{matchUps:y,error:U}=ba({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,policyDefinitions:r,tournamentRecord:a,drawDefinition:o,matchUpFilters:s,contextFilters:c,contextProfile:u,scheduleTiming:d,matchUpsMap:l,structure:h,inContext:f,context:I,event:v});if(U)return{error:U};const{assignedPositions:w}=Pa({structure:h}),S=w.filter((t=>t.participantId)).map((t=>t.drawPosition)),N=[],P=[],D=[],T=[],M=[];return y.filter((t=>{var e;const i=1===(null==s||null===(e=s.matchUpTypes)||void 0===e?void 0:e.length)&&s.matchUpTypes[0]===ni;return t.matchUpType===ni||!i})).forEach((e=>{var i,n,r;if(e.matchUpStatus===g)return void T.push(e);const a=e.collectionId,o=a&&e.sides.every((t=>t.participantId)),s=e.roundNumber===p,c=!a&&2===(null===(i=e.drawPositions)||void 0===i?void 0:i.filter(Boolean).length),u=!a&&(null===(n=e.drawPositions)||void 0===n?void 0:n.every((t=>S.includes(t)))),d=w.filter((t=>t.bye)).map((t=>t.drawPosition)),l=!a&&(null===(r=e.drawPositions)||void 0===r?void 0:r.find((t=>d.includes(t)))),m=k.includes(e.matchUpStatus)&&(o||c&&(!p||s)&&(!t||u));return l?N.push(e):Ue(e)?M.push(e):m?D.push(e):P.push(e)})),{completedMatchUps:M,upcomingMatchUps:D,pendingMatchUps:P,abandonedMatchUps:T,byeMatchUps:N,structure:h}}function io(t){if(!t.drawDefinition)return{error:mt};Object.assign(t,{requireParticipants:!1});const{abandonedMatchUps:e,completedMatchUps:i,upcomingMatchUps:n,pendingMatchUps:r,byeMatchUps:a,matchUpsMap:o}=no(t);return{matchUps:[].concat(...e,...i,...n,...r,...a),matchUpsMap:o}}function no({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,tournamentParticipants:i,requireParticipants:n,participantsProfile:r,includeByeMatchUps:a,policyDefinitions:o,tournamentRecord:s,drawDefinition:c,matchUpFilters:u,contextFilters:d,contextProfile:l,scheduleTiming:p,nextMatchUps:m,roundFilter:f,matchUpsMap:h,inContext:I,context:v,event:g}){var y,U;if(!c)return{error:mt};let w=[],S=[],N=[],P=[],D=[];i=(null===(y=i)||void 0===y?void 0:y.length)&&i||(null==s?void 0:s.participants),(I||null!=r&&r.withGroupings)&&null!==(U=i)&&void 0!==U&&U.length&&(i=Ka({participants:i}));const{structures:T}=kr({drawDefinition:c});h||(h=Or({drawDefinition:c})),T.forEach((r=>{const{byeMatchUps:y=[],pendingMatchUps:U,upcomingMatchUps:T,completedMatchUps:M,abandonedMatchUps:A}=eo({inContext:I||m,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:i,requireParticipants:n,includeByeMatchUps:a,policyDefinitions:o,tournamentRecord:s,drawDefinition:c,matchUpFilters:u,contextFilters:d,contextProfile:l,scheduleTiming:p,matchUpsMap:h,roundFilter:f,structure:r,context:v,event:g});w=w.concat(...A),S=S.concat(...M),N=N.concat(...T),P=P.concat(...U),D=D.concat(...y)}));const M={abandonedMatchUps:w,completedMatchUps:S,upcomingMatchUps:N,pendingMatchUps:P,byeMatchUps:D,matchUpsMap:h,...ut};if(m){const t="object"==typeof m&&m||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:e,completed:i,upcoming:n,pending:r,bye:a}=t,o=[].concat(...e&&M.abandonedMatchUps||[],...i&&M.completedMatchUps||[],...n&&M.upcomingMatchUps||[],...r&&M.pendingMatchUps||[],...a&&M.byeMatchUps||[]);Qa({drawDefinition:c,inContextDrawMatchUps:o})}return M}function ro({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:i,tournamentRecord:n,inContext:r=!0,contextProfile:a,matchUpFilters:o,contextFilters:s,nextMatchUps:c,context:u}){var d;if(!n)return{error:pt};const l=(null===(d=n.unifiedTournamentId)||void 0===d?void 0:d.tournamentId)||n.tournamentId,p=(null==n?void 0:n.events)||[],m=uo({participantsProfile:e,tournamentRecord:n}),{appliedPolicies:f}=qe({tournamentRecord:n}),h={...u,tournamentId:l,indoorOutDoor:n.indoorOutDoor,surfaceCategory:n.surfaceCategory,endDate:n.endDate};return{matchUps:p.map((u=>oo({context:h,scheduleVisibilityFilters:t,tournamentAppliedPolicies:f,participantsProfile:e,policyDefinitions:i,tournamentRecord:n,matchUpFilters:o,contextFilters:s,contextProfile:a,nextMatchUps:c,participants:m,inContext:r,event:u}).matchUps)).flat(1/0).concat(...n.matchUps||[])}}function ao({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:r,matchUpFilters:a,contextFilters:o,drawDefinition:s,contextProfile:c,participants:u,nextMatchUps:d,inContext:l,context:p,event:m}){const{eventId:f,eventName:h,category:I,gender:v,matchUpFormat:g}=m||{};return io({context:{...p,eventId:f,eventName:h,category:I,gender:v,matchUpFormat:g,indoorOutDoor:(null==m?void 0:m.indoorOutDoor)||(null==r?void 0:r.indoorOutDoor),surfaceCategory:(null==m?void 0:m.surfaceCategory)||(null==r?void 0:r.surfaceCategory),endDate:null==m?void 0:m.endDate},tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:u||r&&uo({tournamentRecord:r,participantsProfile:i})||[],participantsProfile:i,policyDefinitions:n,tournamentRecord:r,drawDefinition:s,matchUpFilters:a,contextFilters:o,contextProfile:c,nextMatchUps:d,inContext:l,event:m})}function oo({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,participantsProfile:i,policyDefinitions:n,participants:r=[],tournamentRecord:a,matchUpFilters:o,contextFilters:s,contextProfile:c,nextMatchUps:u,inContext:d,context:l,event:p}){if(!p)return{error:ht};const{eventId:m,eventName:f,endDate:h,category:I,gender:v,matchUpFormat:g}=p,y={...l,...fe({indoorOutDoor:p.indoorOutDoor||(null==a?void 0:a.indoorOutDoor),surfaceCategory:p.surfaceCategory||(null==a?void 0:a.surfaceCategory),endDate:p.endDate||(null==a?void 0:a.endDate),tournamentId:null==a?void 0:a.tournamentId,matchUpFormat:g,eventName:f,category:I,gender:v,eventId:m})};h&&(y.endDate=h),r=r||a&&uo({tournamentRecord:a,participantsProfile:i});const U=p.drawDefinitions||[],w=ti({tournamentRecord:a,event:p}).scheduleTiming;return{matchUps:U.map((l=>{const{matchUps:m}=io({tournamentParticipants:r,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,context:y,participantsProfile:i,policyDefinitions:n,tournamentRecord:a,drawDefinition:l,matchUpFilters:o,contextFilters:s,contextProfile:c,scheduleTiming:w,nextMatchUps:u,inContext:d,event:p});return m})).flat(1/0)}}function so({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:i,tournamentRecord:n,inContext:r=!0,matchUpFilters:a,contextFilters:o,contextProfile:s,nextMatchUps:c,context:u}){var d;if(!n)return{error:pt};const l=(null===(d=n.unifiedTournamentId)||void 0===d?void 0:d.tournamentId)||n.tournamentId,p=n&&n.events||[],m=uo({participantsProfile:e,tournamentRecord:n}),{appliedPolicies:f}=qe({tournamentRecord:n}),h=o&&o.eventIds||[];return p.filter((t=>!h.includes(t.eventId))).map((d=>co({tournamentAppliedPolicies:f,scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:i,tournamentRecord:n,matchUpFilters:a,contextFilters:o,contextProfile:s,participants:m,tournamentId:l,nextMatchUps:c,inContext:r,context:u,event:d}))).reduce(((t,e)=>{const i=e&&Object.keys(e).filter((t=>!["success","matchUpsMap"].includes(t)));return null==i||i.forEach((i=>{t[i]||(t[i]=[]),t[i]=t[i].concat(e[i]),t.matchUpsCount+=e[i].length})),t}),{matchUpsCount:0})}function co({tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:r,matchUpFilters:a,contextFilters:o,contextProfile:s,nextMatchUps:c,participants:u,tournamentId:d,inContext:l,context:p,event:m}){if(!m)return{error:ht};const{eventId:f,eventName:h,endDate:I}=m,v={...p,...fe({eventId:f,eventName:h,endDate:I||(null==r?void 0:r.endDate),tournamentId:d||(null==r?void 0:r.tournamentId),indoorOutDoor:m.indoorOutDoor||(null==r?void 0:r.indoorOutDoor),surfaceCategory:m.surfaceCategory||(null==r?void 0:r.surfaceCategory)})},g=u||r&&uo({tournamentRecord:r,participantsProfile:i});return(m.drawDefinitions||[]).reduce(((u,d)=>{const p=no({context:v,tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,tournamentParticipants:g,participantsProfile:i,policyDefinitions:n,tournamentRecord:r,drawDefinition:d,matchUpFilters:a,contextFilters:o,contextProfile:s,nextMatchUps:c,inContext:l,event:m}),f=Object.keys(p);return null==f||f.forEach((t=>{u[t]||(u[t]=[]),u[t]=u[t].concat(p[t])})),u}),{})}function uo({tournamentRecord:t,participantsProfile:e}){const i=t.participants||[];null!=e&&e.withISO&&i.forEach((t=>za({participant:t})))}function lo({participantsProfile:t,tournamentRecord:e,contextProfile:i,nextMatchUps:n,matchUpId:r,inContext:a}){if(!e)return{error:pt};if("string"!=typeof r)return{error:"Missing matchUpId"};const{matchUps:o}=ro({tournamentRecord:e}),s=o.find((t=>t.matchUpId===r));if(!s)return{error:"matchUp not found"};const{eventId:c,drawId:u}=s,{event:d,drawDefinition:l}=ui({tournamentRecord:e,eventId:c,drawId:u}),p={surfaceCategory:d.surfaceCategory||e.surfaceCategory,indoorOutDoor:d.indoorOutDoor||e.indoorOutDoor,endDate:d.endDate||e.endDate,tournamentId:e.tournamentId,eventId:c,drawId:u},m=e.participants||[],{matchUp:f,structure:h}=Ra({context:a&&p,tournamentParticipants:m,participantsProfile:t,drawDefinition:l,contextProfile:i,nextMatchUps:n,matchUpId:r,inContext:a,event:d});return{matchUp:f,structure:h,drawDefinition:l}}function po({tournamentRecord:t,matchUpIds:e,schedule:i}){if(!t)return{error:pt};if(!e||!Array.isArray(e))return{error:"Missing matchUpIds"};if(!i||"object"!=typeof i)return{error:"Missing schedule"};const{matchUps:n}=ro({tournamentRecord:t}),r=n.reduce(((t,e)=>{const{matchUpId:i,drawId:n}=e;return t[n]?t[n].push(i):t[n]=[i],t}),{});for(const a of Object.keys(r)){const{drawDefinition:n}=di({tournamentRecord:t,drawId:a}),o=r[a].filter((t=>e.includes(t)));for(const e of o){const r=ka({tournamentRecord:t,drawDefinition:n,matchUpId:e,schedule:i});if(r.error)return r}}return{...ut}}function mo({tournamentRecords:t}){return t?Object.keys(t).reduce(((e,i)=>{e.tournamentIdMap[i]=[];const n=t[i].events||[],r=n.map((({eventId:t})=>t)),a=n.map((t=>(t.drawDefinitions||[]).map((({drawId:t})=>t)))).flat();return e.tournamentIdMap[i].push(...r,...a),e.eventIds.push(...r),e.drawIds.push(...a),e}),{eventIds:[],drawIds:[],tournamentIdMap:{}}):{error:"Missing tournamentRecords"}}function fo({drawId:t,eventId:e,tournamentRecords:i}){const{tournamentIdMap:n}=mo({tournamentRecords:i});return Object.keys(n).find((i=>n[i].includes(e)||n[i].includes(t)))}function ho({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if("object"!=typeof r)return{error:gt};const{sets:a,scoreStringSide1:o,scoreStringSide2:s}=r;if(void 0!==o&&"string"!=typeof o)return{error:gt,message:"scoreString must be a string!"};if(void 0!==s&&"string"!=typeof s)return{error:gt,message:"scoreString must be a string!"};if(void 0!==a&&!Array.isArray(a))return{error:gt,message:"sets must be an array"};if(null!=a&&a.length){const o=a.map((t=>null==t?void 0:t.setNumber));if(o.length!==J(o).length)return{error:gt,message:"setNumbers not unique"};for(const t of a){const{side1Score:e,side2Score:i,side1TiebreakScore:n,side2TiebreakScore:r,side1PointScore:a,side2PointScore:o,winningSide:s,setNumber:c}=t;if(![e,i,n,r,a,o,c,s].filter((t=>void 0!==t)).every((t=>z(t))))return{error:gt,message:"non-numeric values"};if(s&&![1,2].includes(s))return{error:gt,message:"winningSide must be 1 or 2"}}if(!function({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){const a=null==r?void 0:r.sets,o=((null==a?void 0:a.filter((t=>null==t?void 0:t.winningSide)))||[]).reduce(((t,e)=>{const{winningSide:i}=e;return t[i-1]++,t}),[0,0]),s=n&&n-1,c=1-s,d=o[s],l=o[c],p=u(e),m=Math.max(...o),f=Q(o)[m],{bestOf:h}=p||{},I=h&&Math.ceil(h/2)||1,v=[S,T,E].includes(i||t),g=(!e||m===I)&&1===f&&o.indexOf(m)+1||void 0;return n&&d>l&&n===g||!n&&!g||v}({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r}))return{error:"Invalid winningSide",message:"winningSide does not match analyzed score"}}return{valid:!0}}function Io({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter((({drawPositions:e})=>t&&(null==e?void 0:e.includes(t)))).map((({roundNumber:t})=>parseInt(t))).sort(Ie)[0]}}function vo({inContextDrawMatchUps:t,positionAssignments:e,targetDrawPosition:i,drawDefinition:n,dualMatchUp:r,matchUp:a}){if(r){var o,s,c;const e=null===(o=t.find((({matchUpId:t})=>a.matchUpId===t)).sides)||void 0===o||null===(s=o.find((t=>t.drawPosition===i)))||void 0===s?void 0:s.sideNumber,n=null===(c=a.sides)||void 0===c?void 0:c.find((t=>t.sideNumber===e));n&&delete n.lineUp}a.drawPositions=(a.drawPositions||[]).map((t=>t===i?void 0:t));const u=e.filter((({drawPosition:t})=>a.drawPositions.includes(t))).filter((t=>t.bye)).length;return a.matchUpStatus=u?y:a.matchUpStatus===E?E:A,a.matchUpStatus===E&&(a.winningSide=void 0),Ur({drawDefinition:n,matchUp:a}),{...ut}}function go({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){return t||({matchUps:t,matchUpsMap:i}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:i})),(t||[]).filter((({collectionId:t})=>!t)).forEach((n=>{const{matchUpId:r,structureId:a}=n,o=Za({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:r}),{winnerMatchUp:s,loserMatchUp:c}=o.targetMatchUps,u=null==s?void 0:s.matchUpId,d=null==c?void 0:c.matchUpId,l=Lr({matchUpsMap:i,structureId:a}).find((t=>t.matchUpId===r));l&&(u&&(Object.assign(l,{winnerMatchUpId:u}),Object.assign(n,{winnerMatchUpId:u})),d&&(Object.assign(l,{loserMatchUpId:d}),Object.assign(n,{loserMatchUpId:d})))})),{inContextDrawMatchUps:t}}function yo(t){var e;const{sides:i,matchUpType:n}=t||{},r=null!==(e=t.potentialParticipants)&&void 0!==e&&e.length?t.potentialParticipants.flat().map((t=>n===ii?(null==t?void 0:t.individualParticipantIds)||[]:t.participantId)).flat():[],a=(i||[]).map((t=>{var e;return n===ii?(null==t||null===(e=t.participant)||void 0===e?void 0:e.individualParticipantIds)||[]:null!=t&&t.participantId?[t.participantId]:[]})).flat();return{individualParticipantIds:a.concat(r).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:r}}function Uo({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:gt};const{venueIds:i,tournamentsMap:n}=function({tournamentRecords:t={}}={}){const e=t&&Object.values(t)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce(((t,e)=>{const{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s,tournamentMap:c}=wo({tournamentRecord:e});return n.forEach((e=>{t.venueIds.includes(e)||t.venueIds.push(e)})),t.tournamentIds.push(...s),t.structureIds.push(...o),t.eventIds.push(...r),t.drawIds.push(...a),Object.assign(i,c),t}),{venueIds:[],eventIds:[],drawIds:[],structureIds:[],tournamentIds:[]});return{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s,tournamentsMap:i}}({tournamentRecords:t});let r,a;const o=e.every((t=>{const{scheduleDate:e,venues:o}=t;return!!Wt(e)&&o.every((t=>{const{venueId:e,rounds:o}=t;if("string"!=typeof e)return a="venueId should be a string",!1;if(!Array.isArray(o))return a="rounds should be an array",!1;if(!i.includes(e))return r="Venue not found",!1;return!!o.every((t=>{if(!t)return a="empty round",!1;const{tournamentId:e,eventId:i,drawId:r,structureId:o,roundNumber:s,roundSegment:c}=t,u=n[e]&&n[e][i]&&n[e][i][r]&&n[e][i][r][o],d=null==u?void 0:u.includes(s);d||(a="Invalid rounds");const{segmentNumber:l,segmentsCount:p}=c||{},m=!c||z(l)&&G(p)&&l<=p;return m||(a="Invalid segment"),d&&m}))}))}));return o||r||(r=gt),{valid:!!o,error:r,message:a}}function wo({tournamentRecord:t={},tournamentMap:e={},requireCourts:i}={}){const n=[],r=[],a=[],o=[],s=((null==t?void 0:t.venues)||[]).map((({venueId:t,courts:e})=>(!i||(null==e?void 0:e.length))&&t)),c=null==t?void 0:t.tournamentId;return c&&(o.push(c),e[c]={},((null==t?void 0:t.events)||[]).forEach((t=>{const i=t.eventId;r.push(i),e[c][i]={},(t.drawDefinitions||[]).forEach((t=>{const r=t.drawId;n.push(r),e[c][i][r]={};const{structures:o}=kr({drawDefinition:t});(o||[]).forEach((t=>{var n;const o=t.structureId,{matchUps:s}=ba({structure:t}),{roundMatchUps:u}=Cr({matchUps:s}),d=u&&Object.keys(u).map((t=>parseInt(t)));e[c][i][r][o]=d,a.push(o),null!==(n=t.structures)&&void 0!==n&&n.length&&t.structures.forEach((t=>{a.push(t.structureId),e[c][i][r][t.structureId]=d}))}))}))}))),{tournamentIds:o,venueIds:s,eventIds:r,drawIds:n,structureIds:a,tournamentMap:e}}function So({tournamentRecord:t}){if(!t)return{error:pt};const e=(({tournamentId:t,tournamentRank:e,formalName:i,tournamentName:n,promotionalName:r,onlineResources:a,localTimeZone:o,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l})=>({tournamentId:t,tournamentRank:e,formalName:i,tournamentName:n,promotionalName:r,onlineResources:a,localTimeZone:o,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l}))(t);return{...ut,tournamentInfo:me(e)}}function No({tournamentRecords:t}){const e=Object.keys(t).reduce(((e,i)=>{const n=t[i],{tournamentInfo:{startDate:r,endDate:a}}=So({tournamentRecord:n}),o=r&&new Date(ne(r));(!e.startDate||o&&o<e.startDate)&&(e.startDate=o);const s=a&&new Date(ne(a));return(!e.endDate||s&&s>e.endDate)&&(e.endDate=s),e}),{startDate:void 0,endDate:void 0}),i=e.startDate&&ne(e.startDate.toISOString()),n=e.endDate&&ne(e.endDate.toISOString());return i&&n?{startDate:i,endDate:n}:{error:"Missing date"}}function Po({tournamentRecords:t,venueIds:e=[]}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const i=[],n=[],r=[],a=[];return Object.keys(t).forEach((o=>{var s;null===(s=t[o].venues)||void 0===s||s.filter((({venueId:t})=>!e.length||e.includes(t))).forEach((t=>{var e;r.includes(t.venueId)||(i.push(me(t)),r.push(t.venueId)),null===(e=t.courts)||void 0===e||e.forEach((e=>{if(!a.includes(e.courtId)){const i={...me(e,!1,!0),venueId:t.venueId};n.push(i),a.push(e.courtId)}}))}))})),{courts:n,venues:i}}function Do({tournamentRecords:t,requireCourts:e}){return"object"==typeof t&&Object.keys(t).length?Object.keys(t).reduce(((i,n)=>{const r=t[n],{venues:a}=Ui({tournamentRecord:r});return a.forEach((t=>{const{venueId:n,courts:r}=t;(!e||(null==r?void 0:r.length))&&!i.venueIds.includes(n)&&(i.venues.push(t),i.venueIds.push(n))})),i}),{venues:[],venueIds:[]}):{error:"Missing tournamentRecords"}}function To({tournamentRecords:t,extension:e}){if(!_r(e))return{error:gt};for(const i of Object.values(t)){const t=Gr({tournamentRecord:i,extension:e});if(t.error)return t}return{...ut}}function Mo({tournamentRecords:t,name:e}){if(!e)return{error:It,message:"Missing name"};let i;return Object.keys(t).find((n=>{const r=t[n],{extension:a}=Ze({tournamentRecord:r,name:e});return i=a,!!a}))?{extension:i}:{error:yt}}function Ao({tournamentRecords:t,name:e}){if(!e)return{error:It,message:"Missing name"};let i=0;for(const n of Object.keys(t)){const r=qr({tournamentRecord:t[n],name:e});if(r.error)return r;r.message!==yt&&i++}return{...ut,removed:i}}function Eo({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const{extension:e}=Mo({tournamentRecords:t,name:"schedulingProfile"});let i=(null==e?void 0:e.value)||[];if(i.length){const{venueIds:e}=Do({tournamentRecords:t,requireCourts:!0}),{eventIds:n,drawIds:r}=mo({tournamentRecords:t}),{updatedSchedulingProfile:a,modifications:o,issues:s}=Co({schedulingProfile:i,venueIds:e,eventIds:n,drawIds:r});if(o){i=a;const e=bo({tournamentRecords:t,schedulingProfile:i});return e.error?e:{schedulingProfile:i,modifications:o,issues:s}}}return{schedulingProfile:i,modifications:0}}function bo({tournamentRecords:t,schedulingProfile:e}){const i=Uo({tournamentRecords:t,schedulingProfile:e});return i.error?i:e?To({tournamentRecords:t,extension:{name:"schedulingProfile",value:e}}):Ao({tournamentRecords:t,name:"schedulingProfile"})}function Ro({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!Wt(e))return{error:vt};const{extension:r}=Mo({tournamentRecords:t,name:"schedulingProfile"}),a=(null==r?void 0:r.value)||[];let o=a.find((t=>le(e,t.scheduleDate)));if(!o){const{startDate:i,endDate:n}=No({tournamentRecords:t}),r=new Date(e);if(r<new Date(i)||r>new Date(n))return{error:vt};o={scheduleDate:e,venues:[]},a.push(o)}let s=o.venues.find((t=>t.venueId===i));s||(s={venueId:i,rounds:[]},o.venues.push(s));const c=["notBeforeTime"],u=t=>Object.keys(t).filter((t=>!c.includes(t))).sort().map((e=>t[e])).join("|");if(s.rounds.find((t=>u(t)===u(n))))return{error:"Existing round"};s.rounds.push(n);const d=bo({tournamentRecords:t,schedulingProfile:a});return d.error?d:ut}function Co({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){const r=[];return{updatedSchedulingProfile:null==t?void 0:t.map((t=>{const a=ne(null==t?void 0:t.scheduleDate);if(!a)return void r.push(`Invalid date: ${null==t?void 0:t.scheduledDate}`);const o=((null==t?void 0:t.venues)||[]).map((t=>{const{rounds:a,venueId:o}=t;if(!e.includes(o))return void r.push(`Missing venueId: ${o}`);const s=a.filter((t=>{const e=i.includes(t.eventId)&&n.includes(t.drawId);return e||r.push(`Invalid eventId: ${t.eventId} or drawId: ${t.drawId}`),e}));return s.length?{venueId:o,rounds:s}:void 0})).filter(Boolean);return o.length&&a&&{...t,venues:o}})).filter(Boolean),modifications:r.length,issues:r}}function Oo({tournamentRecords:t}){const{schedulingProfile:e}=Eo({tournamentRecords:t,requireCourts:!0});if(e){const{venueIds:i}=Do({tournamentRecords:t}),{eventIds:n,drawIds:r}=mo({tournamentRecords:t}),{updatedSchedulingProfile:a,modifications:o}=Co({schedulingProfile:e,venueIds:i,eventIds:n,drawIds:r});if(o)return bo({tournamentRecords:t,schedulingProfile:a})}return ut}function Lo({matchUps:t=[],schedulingProfile:e}){const i={},n=({eventId:t,drawId:e,structureId:i,roundNumber:n})=>`${t}|${e}|${i}${n}`;null!=e&&e.length&&e.map((({venues:t})=>t.map((({rounds:t})=>t)))).flat().forEach((t=>{t.sort(((t,e)=>(t.sortOrder||0)-(e.sortOrder||0))).forEach((({eventId:t,drawId:e,structureId:r,roundNumber:a},o)=>{const s=n({eventId:t,drawId:e,structureId:r,roundNumber:a});i[s]=o}))}));const r=[],a={noScheduledDate:[]};for(const s of t){const t=s.schedule||{},e=t.scheduledDate&&ne(t.scheduledDate)||t.scheduledTime&&ne(t.scheduledTime)||"noScheduledDate";a[e]||(a[e]=[]),a[e].push(s)}const o=Object.keys(a).sort();for(const s of o){const t=a[s],e={noScheduledTime:[]};for(const i of t){const t=i.schedule||{},n=t.scheduledTime&&ie(t.scheduledTime)||"noScheduledTime";e[n]||(e[n]=[]),e[n].push(i)}const o=Object.keys(e).sort();for(const a of o){const t=e[a];t.sort(((t,e)=>(i[n(t)]||0)-(i[n(e)]||0))),r.push(...t)}}return r}function xo({scheduleVisibilityFilters:t,tournamentRecords:e,matchUpFilters:i,contextFilters:n,nextMatchUps:r}){return"object"==typeof e&&Object.keys(e).length?{matchUps:Object.keys(e).map((a=>{const o=e[a],{matchUps:s}=ro({scheduleVisibilityFilters:t,tournamentRecord:o,matchUpFilters:i,contextFilters:n,nextMatchUps:r});return s})).flat()}:{error:"Missing tournamentRecords"}}function Fo(t){if("object"!=typeof(null==t?void 0:t.tournamentRecords)||!Object.keys(null==t?void 0:t.tournamentRecords).length)return{error:"Missing tournamentRecords"};const{courts:e,venues:i}=Po(t),{sortCourtsData:n,sortDateMatchUps:r=!0}=t,a=Eo(t).schedulingProfile,{completedMatchUps:o,upcomingMatchUps:s,pendingMatchUps:c}=ko(t),u=[...s||[],...c||[]],d=r?Lo({matchUps:u,schedulingProfile:a}):u;return{courtsData:e.map((t=>{const e=function({courtId:t}){const e=d.filter((e=>{var i;return(null===(i=e.schedule)||void 0===i?void 0:i.courtId)===t}));return n?Lo({matchUps:e,schedulingProfile:a}):e}(t);return{...t,matchUps:e,surfaceCategory:(null==t?void 0:t.surfaceCategory)||""}})),completedMatchUps:o,dateMatchUps:d,venues:i}}function ko({scheduleVisibilityFilters:t,tournamentRecords:e,matchUpFilters:i,contextFilters:n}){return"object"==typeof e&&Object.keys(e).length?Object.keys(e).map((r=>{const a=e[r];return so({scheduleVisibilityFilters:t,tournamentRecord:a,matchUpFilters:i,contextFilters:n})})).reduce(((t,e)=>(Object.keys(e).forEach((i=>{t[i]||(t[i]=[]),t[i]=t[i].concat(e[i])})),t)),{}):{error:"Missing tournamentRecords"}}function _o(t,e){return function(t,e){return(On[null==t?void 0:t.stage]||0)-(On[null==e?void 0:e.stage]||0)}(t,e)||((null==t?void 0:t.stageSequence)||0)-((null==e?void 0:e.stageSequence)||0)||(null==t?void 0:t.roundNumber)-(null==e?void 0:e.roundNumber)||((null==t?void 0:t.roundPosition)||0)-((null==e?void 0:e.roundPosition)||0)}function jo({includeParticipantDependencies:t,tournamentRecords:e={},drawDefinition:i,matchUps:n=[],drawIds:r=[]}){if(!Array.isArray(n))return{error:"Missing matchUps"};if(!Array.isArray(r))return{error:"Missing drawId"};const a={},o=t=>{a[t]||(a[t]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[]})},s=(e,i)=>{a[e].matchUpIds.forEach((t=>a[i].matchUpIds.push(t))),a[i].matchUpIds.push(e),a[e].dependentMatchUpIds.push(i),t&&a[e].participantIds.forEach((t=>a[i].participantIds.push(t)))},c=e=>{for(const i of e){const{matchUpId:e,winnerMatchUpId:n,loserMatchUpId:r}=i;if(o(e),t){const{individualParticipantIds:t}=yo(i);a[e].participantIds=t}n&&(o(n),s(e,n)),r&&(o(r),s(e,r))}};if(i)go({drawDefinition:i}),n.length||({matchUps:n}=ao({drawDefinition:i})),c(n);else{n.length||({matchUps:n}=xo({tournamentRecords:e,nextMatchUps:!0})),r.length||(r=e?Object.values(e).map((({events:t=[]})=>t.map((({drawDefinitions:t=[]})=>t.map((({drawId:t})=>t)))))).flat(1/0):[]);for(const t of r){let i=n.filter((e=>e.drawId===t)).sort(_o);if(!i.find((({winnerMatchUpId:t,loserMatchUpId:e})=>t||e))&&!i.find((({roundPosition:t})=>t))){const n=i.find((({tournamentId:t})=>t)),{drawDefinition:r}=ui({tournamentRecord:e[n.tournamentId],drawId:t});go({drawDefinition:r})}c(i)}}return{matchUpDependencies:a,...ut}}function Bo({matchUpStatus:t}){return O.includes(t)}function Go({matchUpStatus:t}){return L.includes(t)}function Vo({score:t,winningSide:e,matchUpStatus:i}){return(null==t?void 0:t.scoreStringSide1)||e||function({matchUpStatus:t}){return F.includes(t)}({matchUpStatus:i})}function Ho({drawDefinition:t,structureId:e,structure:i}){if(!i){const n=Fr({drawDefinition:t,structureId:e});if(n.error)return n;i=n.structure}const{matchUps:n}=ba({inContext:!0,drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},structure:i}),r=J([].concat(...n.map((t=>t.drawPositions||[]))).filter(Boolean)).sort(Ie),{matchUpDependencies:a}=jo({matchUps:n,drawIds:[t.drawId],drawDefinition:t}),o=J(n.filter(Vo).map((t=>{var e;return[].concat(...(null===(e=a[t.matchUpId])||void 0===e?void 0:e.matchUpIds)||[],t.matchUpId)})).flat()),s=J(n.map((({matchUpId:t,drawPositions:e})=>o.includes(t)?e:[])).flat().filter(Boolean)).sort(Ie),{positionAssignments:c}=Na({drawDefinition:t,structure:i}),u=c.filter((t=>t.bye)).map((t=>t.drawPosition)),d=(null==r?void 0:r.filter((t=>!s.includes(t))))||[];return{allDrawPositions:r,inContextStructureMatchUps:n,activeDependentMatchUpIds:o,inactiveDrawPositions:d,positionAssignments:c,activeDrawPositions:s,byeDrawPositions:u,structure:i}}function qo({positionAssignments:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){const{matchUps:a}=ba({drawDefinition:e,matchUpsMap:i,structure:n,event:r});a.forEach((i=>{const n=t.filter((({drawPosition:t})=>{var e;return null===(e=i.drawPositions)||void 0===e?void 0:e.includes(t)})).filter((t=>t.bye)).length;if(!i.winningSide){const t=n?y:A;Object.assign(i,{matchUpStatus:t}),Ur({drawDefinition:e,matchUp:i})}}))}function Wo({inContextDrawMatchUps:t,drawDefinition:e,drawPosition:i,matchUpsMap:n,structureId:r,event:a}){const{structure:o}=Fr({drawDefinition:e,structureId:r}),{positionAssignments:s}=Pa({drawDefinition:e,structure:o}),c=s.some((t=>{if(t.drawPosition===i)return delete t.participantId,delete t.qualifier,delete t.bye,!0}));if(o.structureType===Ln)return qo({positionAssignments:s,drawDefinition:e,structure:o,matchUpsMap:n}),{drawPositionCleared:c};const{matchUps:u}=ba({drawDefinition:e,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:o,event:a}),{roundProfile:d,roundMatchUps:l}=Cr({matchUps:u}),p=Object.keys(d).map((t=>parseInt(t)));let m=i;const f=p.map((t=>{const e=d[t].pairedDrawPositions.find((t=>t.includes(m))),i=null==e?void 0:e.find((t=>t!==m)),n=s.find((t=>t.drawPosition===i)),r=d[t+1],a=null==n?void 0:n.bye,o=r&&r.pairedDrawPositions.find((t=>t.includes(i))),c=a&&o&&r&&r.drawPositions.includes(i),u=e&&{roundNumber:t,relevantPair:e,pairedDrawPosition:i,pairedDrawPositionByeAdvancedPair:!c&&o,targetDrawPosition:m};return c&&(m=i),u})).filter((t=>null==t?void 0:t.targetDrawPosition)).reduce(((t,e)=>{const{roundNumber:i,relevantPair:n,targetDrawPosition:r,pairedDrawPosition:a,pairedDrawPositionByeAdvancedPair:o}=e,s=[{roundNumber:i,targetDrawPosition:r,relevantPair:n},o&&{roundNumber:i+1,targetDrawPosition:a,relevantPair:o,subsequentRoundRemoval:!0}].filter(Boolean);return t.concat(...s)}),[]);return f.forEach((({roundNumber:a,targetDrawPosition:c,relevantPair:u})=>{const d=l[a].find((t=>ot(t.drawPositions.filter(Boolean),u.filter(Boolean))));d&&(function({inContextDrawMatchUps:t,targetDrawPosition:e,drawDefinition:i,matchUpsMap:n,roundNumber:r,structureId:a}){var o;const{structure:s}=Fr({drawDefinition:i,structureId:a});if(s.structureType===Ln)return;const c=((null===(o=n=n||Or({drawDefinition:i}))||void 0===o?void 0:o.mappedMatchUps)||{})[a].matchUps,{initialRoundNumber:u}=Io({drawPosition:e,matchUps:c}),d=null==c?void 0:c.filter((t=>t.roundNumber>=r&&t.roundNumber!==u&&t.drawPositions.includes(e))),{positionAssignments:l}=Na({drawDefinition:i,structureId:a});null==d||d.forEach((r=>zo({drawPosition:e,targetMatchUp:r,inContextDrawMatchUps:t,positionAssignments:l,drawDefinition:i,matchUpsMap:n,structure:s})))}({drawDefinition:e,structureId:r,roundNumber:a,targetDrawPosition:c,matchUpsMap:n,inContextDrawMatchUps:t}),zo({drawDefinition:e,structure:o,positionAssignments:s,targetMatchUp:d,drawPosition:i,matchUpsMap:n,inContextDrawMatchUps:t}))})),{tasks:f,drawPositionCleared:c}}function zo({inContextDrawMatchUps:t,positionAssignments:e,drawDefinition:i,targetMatchUp:n,drawPosition:r,matchUpsMap:a,structure:o}){const s=(a=a||Or({drawDefinition:i})).mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:c}=Io({drawPosition:r,matchUps:s});n.roundNumber>c&&(n.drawPositions=(n.drawPositions||[]).map((t=>t===r?void 0:t)));const u=Za({matchUpId:n.matchUpId,structure:o,drawDefinition:i,inContextDrawMatchUps:t}),{targetLinks:{winnerTargetLink:d},targetMatchUps:{loserMatchUp:l,winnerMatchUp:p,loserMatchUpDrawPositionIndex:m,winnerMatchUpDrawPositionIndex:f}}=u,h=e.filter((({drawPosition:t})=>n.drawPositions.includes(t))).filter((t=>t.bye)).length;if(n.matchUpStatus=h?y:n.matchUpStatus===E?E:A,n.matchUpStatus===E&&(n.winningSide=void 0),Ur({drawDefinition:i,matchUp:n}),l&&l.structureId!==u.matchUp.structureId&&!h){const{drawPositions:e,roundNumber:n}=l;if(1===n){const n=e[m];Wo({drawDefinition:i,structureId:l.structureId,drawPosition:n,matchUpsMap:a,inContextDrawMatchUps:t})}else{var I;const r=Math.min(...e.filter(Boolean)),o=((null===(I=a)||void 0===I?void 0:I.mappedMatchUps)||{})[l.structureId].matchUps,{initialRoundNumber:s}=Io({drawPosition:r,matchUps:o});s===n&&Wo({drawDefinition:i,structureId:l.structureId,drawPosition:r,matchUpsMap:a,inContextDrawMatchUps:t})}}p&&p.structureId!==u.matchUp.structureId&&console.log("linked structure winnerMatchUp removal",{winnerTargetLink:d,winnerMatchUpDrawPositionIndex:f})}function Ko({drawDefinition:t,drawPosition:e,participantId:i,structureId:n,matchUpsMap:r,inContextDrawMatchUps:a}){const{structure:o}=Fr({drawDefinition:t,structureId:n}),{positionAssignments:s}=Pa({drawDefinition:t,structure:o}),c=s.find((t=>i&&t.participantId===i||e&&t.drawPosition===e));if(i&&!e&&(e=null==c?void 0:c.drawPosition),!e)return{error:"Missing drawPosition"};i||(i=null==c?void 0:c.participantId);const{activeDrawPositions:u}=Ho({drawDefinition:t,structureId:n});if(u.includes(e))return{error:"drawPosition is active"};a||({matchUps:a}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:r}));const{drawPositionCleared:d,error:l}=Wo({drawDefinition:t,structureId:n,drawPosition:e,matchUpsMap:r,inContextDrawMatchUps:a});return l?{error:l}:d?(Sr({drawDefinition:t,structureIds:[n]}),{...ut,participantId:i}):{error:"drawPosition not cleared"}}function Yo({element:t,notes:e}={}){return"object"!=typeof t?{error:gt}:e?"string"==typeof e||null!=e&&e.testing?(Object.assign(t,{notes:e}),ut):{error:gt}:{error:It}}function $o({tournamentRecord:t,drawDefinition:e,policyTypes:i=[],event:n}){if(!Array.isArray(i))return{error:"Missing policyType"};const r={},a=t=>{for(const e of i){const i=t[e];i&&!r[e]&&(r[e]=i)}};if(e){const{appliedPolicies:t}=Rr({drawDefinition:e})||{};a(t)}if(n){const{appliedPolicies:t}=We({event:n})||{};a(t)}if(t){const{appliedPolicies:e}=qe({tournamentRecord:t})||{};a(e)}return Object.keys(r).length?{policyDefinitions:r}:{error:"Policy not found"}}const Jo=t=>null==t?void 0:t.participantId;function Zo({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!Array.isArray(r))return{error:gt};if(!t)return{error:gt};const{policyDefinitions:o}=$o({tournamentRecord:e,drawDefinition:i,event:a,policyTypes:["roundRobinTally"]}),{subOrderMap:s}=function({positionAssignments:t}){const e=(t||[]).filter(Jo).map((t=>{const{extension:e}=Je({element:t,name:"subOrder"}),i=parseInt(null==e?void 0:e.value),n=!isNaN(i)&&i;return n&&{participantId:t.participantId,subOrder:n}})).filter(Boolean),i=Q(e.map((({subOrder:t})=>t)));return{subOrderMap:Object.assign({},...e.filter((({subOrder:t})=>1===i[t])).map((({participantId:t,subOrder:e})=>({[t]:e}))))}}({positionAssignments:t}),c=Te({policyDefinitions:o,matchUpFormat:n,subOrderMap:s,matchUps:r});if(c.error)return c;const{participantResults:u}=c,d=Object.keys(u);return t.forEach((t=>{const{participantId:e}=t;d.includes(e)?(jr({element:t,extension:{name:"tally",value:u[e]}}),u[e].ties||Br({element:t,name:"subOrder"})):(Br({element:t,name:"tally"}),Br({element:t,name:"subOrder"}))})),Sr({drawDefinition:i}),{...ut,participantResults:u}}function Qo({event:t,eventId:e}){if(!t)return{error:ht};const{extension:i}=Qe({event:t,name:"flightProfile"}),n=e?me(null==i?void 0:i.value,!1,!0):null==i?void 0:i.value;var r;return e&&(null===(r=t.drawDefinitions)||void 0===r||r.forEach((t=>{var e;null==n||null===(e=n.flights)||void 0===e||e.forEach((e=>{e.drawId===t.drawId&&Object.assign(e,{drawDefinition:t})}))}))),{flightProfile:n}}const Xo={matchUpStatus:A,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function ts({matchUpStatusCodes:t,removeWinningSide:e,tournamentRecord:i,drawDefinition:n,matchUpFormat:r,matchUpStatus:a,removeScore:o,winningSide:s,matchUpId:c,matchUp:u,event:d,notes:l,score:p}){var m;let f;const h=u.matchUpType===ni;if(h?c&&u.matchUpId!==c&&({matchUp:u,structure:f}=Ra({drawDefinition:n,matchUpId:c,event:d})):u.matchUpId!==c&&console.log("!!!!!"),o?Object.assign(u,Xo):p&&(u.score=p),a&&(u.matchUpStatus=a),r&&(u.matchUpFormat=r),t&&(u.matchUpStatusCodes=t),s&&(u.winningSide=s),e&&(u.winningSide=void 0),f||({structure:f}=Ra({drawDefinition:n,matchUpId:c,event:d})),(null===(m=f)||void 0===m?void 0:m.structureType)===Ln&&!u.collectionId){var I;r=h?"SET1-S:T100":r||u.matchUpFormat||(null===(I=f)||void 0===I?void 0:I.matchUpFormat)||n.matchUpFormat||(null==d?void 0:d.matchUpFormat);const t=f.structures.find((t=>null==t?void 0:t.matchUps.find((t=>t.matchUpId===c)))),e=h&&{matchUpTypes:[ni]},{matchUps:a}=ba({structure:t,inContext:!0,matchUpFilters:e,event:d}),o=Zo({positionAssignments:t.positionAssignments,tournamentRecord:i,drawDefinition:n,matchUpFormat:r,matchUps:a,event:d});if(o.error)return o}if(s!==u.winningSide){var v;const{flightProfile:t}=Qo({event:d}),e=null==t||null===(v=t.flights)||void 0===v?void 0:v.find((t=>t.drawId===n.drawId));null!=e&&e.matchUpValue&&console.log("recalculate team point tallies")}if(l){const t=Yo({element:u,notes:l});if(t.error)return t}return Ur({drawDefinition:n,matchUp:u}),ut}function es({drawDefinition:t,matchUpId:e,structure:i,event:n}){const r=Ra({drawDefinition:t,event:n,matchUpId:e});if(r.error)return r;const a=r.matchUp,o=a.tieFormat||(null==i?void 0:i.tieFormat)||(null==t?void 0:t.tieFormat)||(null==n?void 0:n.tieFormat)||void 0,{winningSide:s,set:c,scoreStringSide1:u,scoreStringSide2:d}=Ei({matchUp:a,tieFormat:o}),l=[1,2].includes(s),p=l?w:u?P:A,m=a.winningSide&&!l;return ts({score:{scoreStringSide1:u,scoreStringSide2:d,sets:[c]},removeWinningSide:m,drawDefinition:t,matchUpStatus:p,winningSide:s,matchUpId:e,matchUp:a,event:n}),{...ut,removeWinningSide:m}}function is(t){const{dualWinningSideChange:e,inContextDrawMatchUps:i,drawDefinition:n,matchUpStatus:r,matchUpsMap:a,dualMatchUp:o,targetData:s,structure:c,event:u}=t,d=Boolean(t.matchUp.collectionId),l=Ta({drawDefinition:n,structure:c}),{drawPositions:p,winningSide:m}=s.matchUp||{};if(!l&&!p)return{error:"Missing drawPositions"};const{targetLinks:{loserTargetLink:f,winnerTargetLink:h},targetMatchUps:{loserMatchUp:I,winnerMatchUp:v}}=s,g=ts({...t,matchUpStatus:r||A,removeWinningSide:!0});if(g.error)return g;if(d){const{matchUpTieId:i}=t,{removeWinningSide:r}=es({matchUpId:i,drawDefinition:n,structure:c,event:u});if(!e&&!r)return{...ut}}if(l)return{...ut};const{matchUps:U}=ba({inContext:!0,drawDefinition:n,matchUpsMap:a,structure:c}),{positionAssignments:w}=Pa({structure:c}),N=m-1,P=1-N,D=p[N],T=p[P],{winnerParticipantId:M,loserParticipantId:b}=w.reduce(((t,e)=>(e.drawPosition===T&&(t.loserParticipantId=e.participantId),e.drawPosition===D&&(t.winnerParticipantId=e.participantId),t)),{winnerParticipantId:void 0,loserParticipantId:void 0}),R=U.filter((t=>t.drawPositions.includes(T)));if(v){const t=ns({inContextDrawMatchUps:i,winningDrawPosition:D,winnerParticipantId:M,winnerTargetLink:h,drawDefinition:n,winnerMatchUp:v,dualMatchUp:o,matchUpsMap:a});if(t.error)return t}if(I){const{winnerHadMatchUpStatus:t}=function({sourceMatchUps:t,loserDrawPosition:e,drawPositionMatchUps:i,matchUpStatuses:n=[y,E,S]}){var r;const a=null==i?void 0:i.reduce(((t,e)=>!t||e.roundNumber>t.roundNumber?e:t),void 0),o=null==a||null===(r=a.drawPositions)||void 0===r?void 0:r.find((t=>t!==e)),s=t.filter((t=>{var e;return null==t||null===(e=t.drawPositions)||void 0===e?void 0:e.includes(o)})).map((t=>t.matchUpStatus)),c=t.filter((t=>{var i;return null==t||null===(i=t.drawPositions)||void 0===i?void 0:i.includes(e)})).map((t=>t.matchUpStatus));return{sourceMatchUp:a,winnerHadMatchUpStatus:ot(s||[],n),winnerMatchUpStatuses:s,loserHadMatchUpStatus:ot(c||[],n),loserMatchUpStatuses:c}}({drawPositionMatchUps:R,loserDrawPosition:T,sourceMatchUps:U}),e="FIRST_MATCHUP"===f.linkCondition;if(t&&e){const t=rs({targetLink:f,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:Math.min(...I.drawPositions),matchUpsMap:a});if(t.error)return t}const r=function({inContextDrawMatchUps:t,loserParticipantId:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,dualMatchUp:a}){const o=i.target.structureId,{structure:s}=Fr({drawDefinition:n,structureId:o}),{positionAssignments:c}=Pa({structure:s});if(c.forEach((t=>{t.participantId===e&&delete t.participantId})),a){var u,d;const e=a.drawPositions,i=null==r||null===(u=r.sides)||void 0===u?void 0:u.find((t=>e.includes(t.drawPosition))),o=t.find((({matchUpId:t})=>t===r.matchUpId)),s=i&&(null==o||null===(d=o.sides)||void 0===d?void 0:d.find((t=>t.sideNumber===i)));s&&(delete s.lineUp,Ur({drawDefinition:n,matchUp:o}))}return{...ut}}({inContextDrawMatchUps:i,loserParticipantId:b,loserTargetLink:f,drawDefinition:n,loserMatchUp:I,dualMatchUp:o,matchUpsMap:a});if(r)return r}return{...ut}}function ns({inContextDrawMatchUps:t,winningDrawPosition:e,winnerParticipantId:i,winnerTargetLink:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o,dualMatchUp:s,event:c}){const{structureId:u,roundNumber:d}=a;if(n){const t=n.target.structureId,{structure:e}=Fr({drawDefinition:r,structureId:t}),{positionAssignments:a}=Pa({structure:e}),o=a.find((t=>t.participantId===i)),s=null==o?void 0:o.drawPosition,{matchUps:u}=ba({drawDefinition:r,structure:e,event:c});1===Q(u.map((t=>t.drawPositions)).flat(1/0).filter(Boolean))[s]?a.forEach((t=>{t.participantId===i&&delete t.participantId})):console.log("not removing from position assignments since instances > 1")}const l=function({inContextDrawMatchUps:t,targetDrawPosition:e,drawDefinition:i,structureId:n,dualMatchUp:r,roundNumber:a,matchUpsMap:o}){var s;const{structure:c}=Fr({drawDefinition:i,structureId:n});if(c.structureType===Ln)return;const u=((null===(s=o=o||Or({drawDefinition:i}))||void 0===s?void 0:s.mappedMatchUps)||{})[n].matchUps,{initialRoundNumber:d}=Io({drawPosition:e,matchUps:u}),l=null==u?void 0:u.filter((t=>{var i;return t.roundNumber>=a&&t.roundNumber!==d&&(null===(i=t.drawPositions)||void 0===i?void 0:i.includes(e))})),{positionAssignments:p}=Na({drawDefinition:i,structureId:n});for(const m of l){const n=vo({inContextDrawMatchUps:t,positionAssignments:p,targetDrawPosition:e,drawDefinition:i,dualMatchUp:r,matchUpsMap:o,matchUp:m});if(n.error)return n}return{...ut}}({targetDrawPosition:e,inContextDrawMatchUps:t,drawDefinition:r,dualMatchUp:s,matchUpsMap:o,roundNumber:d,structureId:u});return l.error?l:{...ut}}function rs({inContextDrawMatchUps:t,drawDefinition:e,drawPosition:i,matchUpsMap:n,targetLink:r}){return Ko({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:n,drawPosition:i,structureId:r.target.structureId}),{...ut}}function as(t){var e;let{sourceMatchUp:i}=t;const{winnerMatchUp:n,structure:r,matchUpsMap:a,drawPosition:o}=t,s=n.roundNumber>1&&n.roundNumber-1,c=Lr({structureId:r.structureId,matchUpsMap:a});!i&&o&&(i=c.find((({drawPositions:t,roundNumber:e})=>e===s&&(null==t?void 0:t.includes(o)))));const u=null===(e=i)||void 0===e?void 0:e.roundPosition,d=u+(u%2?1:-1),l=s&&c.find((({roundNumber:t,roundPosition:e})=>t===s&&e===d)),p=null==l?void 0:l.matchUpStatus;return{pairedPreviousMatchUp:l,pairedPreviousMatchUpisWOWO:[N].includes(p)}}function os({drawDefinition:t,drawPosition:e,matchUpsMap:i,structureId:n,structure:r}){var a;if(!t)return{error:mt};if(r||({structure:r}=Fr({drawDefinition:t,structureId:n})),!r)return{error:"structure not found"};n||({structureId:n}=r),i||(i=Or({drawDefinition:t}));const{positionAssignments:o}=Na({structure:r}),{activeDrawPositions:s}=Ho({drawDefinition:t,structureId:n});if(o.find((t=>t.drawPosition===e)).bye)return{...ut};if(s.includes(e))return{error:"drawPosition is active"};const c=o.find((t=>t.drawPosition===e));if(!c)return{error:"Invlid drawPosition"};const{filled:u,containsBye:d}=function(t){const e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:n,filled:e||i||n}}(c);if(d)return{...ut};if(u&&!d)return{error:"drawPosition already assigned"};const{matchUps:l}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:i}),{matchUps:p}=ba({drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:r});if(o.forEach((t=>{t.drawPosition===e&&(t.bye=!0)})),r.structureType===Ln)return function({drawDefinition:t,matchUps:e,drawPosition:i}){e.forEach((e=>{e.drawPositions.includes(i)&&ss({drawDefinition:t,matchUp:e})}))}({drawDefinition:t,matchUps:p,drawPosition:e}),{...ut};const{roundProfile:m,roundMatchUps:f}=Cr({matchUps:p}),h=f[Object.keys(m).map((t=>parseInt(t))).reverse().find((t=>m[t].drawPositions.includes(e)))].find((({drawPositions:t})=>t.includes(e)));ss({drawDefinition:t,matchUp:h});const I=null===(a=h.drawPositions)||void 0===a?void 0:a.find((t=>t!==e));if(I){const e=cs({sourceDrawPositions:h.drawPositions,matchUpId:h.matchUpId,inContextDrawMatchUps:l,drawPositionToAdvance:I,drawDefinition:t,matchUpsMap:i});if(e.error)return e}return Sr({drawDefinition:t,structureIds:[n]}),{...ut}}function ss({drawDefinition:t,matchUp:e}){Object.assign(e,{matchUpStatus:y,score:void 0,winningSide:void 0}),Ur({drawDefinition:t,matchUp:e})}function cs({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,drawDefinition:n,matchUpsMap:r,matchUpId:a}){const o=r.drawMatchUps.find((t=>t.matchUpId===a)),s=e.find((t=>t.matchUpId===a)),c=null==s?void 0:s.structureId,{structure:u}=Fr({drawDefinition:n,structureId:c}),{positionAssignments:d}=Na({structure:u}),l=d.filter((t=>t.bye)).map((t=>t.drawPosition)),p=o.drawPositions.find((e=>e!==t)),m=l.includes(p),{targetLinks:{loserTargetLink:f},targetMatchUps:{loserMatchUp:h,winnerMatchUp:I,loserTargetDrawPosition:v}}=Za({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:a,structure:u});if(I&&I.structureId===u.structureId&&function({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,drawDefinition:n,winnerMatchUp:r,matchUpsMap:a}){var o,s,c;const u=a.drawMatchUps.find((t=>t.matchUpId===r.matchUpId)),d=e.find((t=>t.matchUpId===r.matchUpId)),l=null==d?void 0:d.structureId,{structure:p}=Fr({drawDefinition:n,structureId:l}),{positionAssignments:m}=Na({structure:p}),f=m.find((({drawPosition:e})=>e===t)).bye,h=null===(o=u.drawPositions)||void 0===o?void 0:o.filter(Boolean),I=m.filter((t=>null==h?void 0:h.includes(t.drawPosition))),v=m.find((({drawPosition:e})=>e===t)),g=null==i?void 0:i.find((e=>e!==t)),U=g&&I.find((({drawPosition:t})=>t===g)),w=null==U?void 0:U.bye,S=f&&w;if(S&&console.log({isByeAdvancedBye:S}),(null==h?void 0:h.length)>1&&f&&!w)return{error:ft};const N=null==h?void 0:h.find((e=>e!==t));let P=S;const D=[].concat(...(u.drawPositions||[]).filter(Boolean),void 0,void 0).slice(0,2).map((e=>e||P?e===t?(P=!0,t):e:(P=!0,t)));if(!P)return console.log("@@@@@@@",{advancingAssignmentIsBye:v,drawPositionToAdvance:t,existingAssignments:I}),{error:ft};const T=null===(s=m.find((({drawPosition:t})=>t===N)))||void 0===s?void 0:s.bye,M=null===(c=m.find((({drawPosition:e})=>e===t)))||void 0===c?void 0:c.bye,E=M||T?y:A;if(Object.assign(u,{matchUpStatus:E,score:void 0,winningSide:void 0,drawPositions:D}),Ur({drawDefinition:n,matchUp:u}),T||M){const i=T?t:N;if(i)cs({drawPositionToAdvance:i,matchUpId:r.matchUpId,inContextDrawMatchUps:e,drawDefinition:n,iterative:"brightmagenta",matchUpsMap:a});else if(M){const{targetLinks:{loserTargetLink:t},targetMatchUps:{loserMatchUp:i,loserTargetDrawPosition:o}}=Za({matchUpId:r.matchUpId,structure:p,drawDefinition:n,inContextDrawMatchUps:e});if(t&&i)if(i.feedRound)us({drawDefinition:n,loserMatchUp:i,loserTargetLink:t,loserTargetDrawPosition:o,matchUpsMap:a});else{const e=1-r.roundPosition%2,a=i.drawPositions[e];os({drawDefinition:n,structureId:t.target.structureId,drawPosition:a,loserTargetDrawPosition:o,iterative:"brightgreen"}).error}}}}({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,drawDefinition:n,winnerMatchUp:I,matchUpsMap:r}),h&&m&&h.structureId!==u.structureId){const{roundNumber:t}=h;if(1===t){const t=os({drawDefinition:n,structureId:f.target.structureId,drawPosition:v,iterative:"brightyellow"});if(t.error)return t}else us({loserTargetDrawPosition:v,loserTargetLink:f,drawDefinition:n,loserMatchUp:h,matchUpsMap:r})}return{...ut}}function us({drawDefinition:t,loserMatchUp:e,loserTargetLink:i,loserTargetDrawPosition:n,matchUpsMap:r}){const{roundNumber:a}=e,o=((null==r?void 0:r.mappedMatchUps)||{})[e.structureId].matchUps,{initialRoundNumber:s}=Io({drawPosition:n,matchUps:o});if(s===a){const e=os({drawDefinition:t,structureId:i.target.structureId,drawPosition:n,iterative:"red"});if(e.error)return e}}function ds({inContextDrawMatchUps:t,matchUpId:e,drawPosition:i}){const n=t.filter((({winnerMatchUpId:t,loserMatchUpId:i})=>i===e||t===e)).sort(((t,e)=>t.roundPosition-e.roundPosition));return n.find((({feedRound:t})=>t))?1:n.reduce(((t,e,n)=>e.drawPositions.includes(i)?n+1:t),void 0)}function ls({inContextDrawMatchUps:t,drawDefinition:e,matchUpStatus:i,drawPosition:n,matchUpsMap:r,matchUpId:a}){var o,s,c;r||(r=Or({drawDefinition:e})),t||({matchUps:t}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:r}));const u=t.find((t=>t.matchUpId===a)),d=null==u?void 0:u.structureId,l=null==e||null===(o=e.structures)||void 0===o?void 0:o.find((t=>t.structureId===d)),p=null===(s=r)||void 0===s||null===(c=s.drawMatchUps)||void 0===c?void 0:c.find((t=>t.matchUpId===a)),m=p.drawPositions||[],{positionAdded:f,positionAssigned:h,updatedDrawPositions:I}=function({drawPosition:t,drawPositions:e}){let i,n=null==e?void 0:e.includes(t);return{updatedDrawPositions:n?e:[].concat(...e,void 0,void 0).slice(0,2).map((e=>e||n?e:(n=!0,i=!0,t))).sort(Ie),positionAdded:i,positionAssigned:n}}({drawPosition:n,drawPositions:m}),{positionAssignments:v}=Na({drawDefinition:e,structure:l}),g=v.filter((t=>I.includes(t.drawPosition))).find((({bye:t})=>t)),U=p.matchUpStatus===E&&I.filter(Boolean).length<2;if(i=g?y:i||(U?E:p.matchUpStatus===N?N:A),f){({matchUps:t}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:r}));const o=U&&ds({inContextDrawMatchUps:t,drawPosition:n,matchUpId:a})||void 0;Object.assign(p,{drawPositions:I,winningSide:o,matchUpStatus:i}),Ur({drawDefinition:e,matchUp:p})}const S=Za({inContextDrawMatchUps:t,inContextMatchUp:u,drawDefinition:e,matchUpId:a}),{targetMatchUps:{winnerMatchUp:P,loserMatchUp:D,loserTargetDrawPosition:M},targetLinks:{loserTargetLink:b}}=S,R=Lr({structureId:l.structureId,matchUpsMap:r});if(h&&g){if(P)if([y,N].includes(i)){const i=ls({matchUpId:P.matchUpId,iterative:"brightmagenta",inContextDrawMatchUps:t,drawDefinition:e,drawPosition:n,matchUpsMap:r});if(i.error)return i}else{const{structureId:t}=P;t!==l.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(P&&!u.feedRound){const{pairedPreviousMatchUpisWOWO:i}=as({winnerMatchUp:p,drawPosition:n,matchUpsMap:r,structure:l});if(i){const i=ls({matchUpId:P.matchUpId,iterative:"brightred",inContextDrawMatchUps:t,drawDefinition:e,drawPosition:n,matchUpsMap:r});if(i.error)return i}}if("FIRST_MATCHUP"===(null==b?void 0:b.linkCondition)&&2===I.filter(Boolean).length&&!g){if(R.filter((({drawPositions:t,roundNumber:e})=>1===e&&ot(t,I))).every((({matchUpStatus:t})=>[w,T].includes(t)))&&D){const{structureId:t}=D,i=os({drawDefinition:e,structureId:t,drawPosition:M,matchUpsMap:r});if(i.error)return i}}return h?ut:{error:ft,drawPosition:n}}function ps(t){const{drawDefinition:e,matchUpsMap:i,targetData:n,structure:r}=t;if(r.structureType===Ln)return ut;const{matchUp:a,targetMatchUps:o,targetLinks:s}=n,{loserMatchUp:c,winnerMatchUp:u,loserTargetDrawPosition:d}=o;if(c){const{loserTargetLink:t}=s,n=ms({loserTargetDrawPosition:d,loserTargetLink:t,drawDefinition:e,loserMatchUp:c,matchUpsMap:i});if(n.error)return n}if(u){const e=function(t){var e,i,n;const{inContextDrawMatchUps:r,drawDefinition:a,sourceMatchUp:o,winnerMatchUp:s,matchUpsMap:c,structure:u}=t,d=c.drawMatchUps.find((t=>t.matchUpId===s.matchUpId));if(!d)return{error:"Missing matchUp"};const l=(null==o?void 0:o.drawPositions)||[];let p=null===(e=d.drawPositions)||void 0===e?void 0:e.filter(Boolean);if(ot(l,p)&&(p=p.filter((t=>!l.includes(t)))),p.length>1)return{error:ft};const{pairedPreviousMatchUpisWOWO:m}=as(t),f=Za({matchUpId:s.matchUpId,inContextDrawMatchUps:r,drawDefinition:a,structure:u}),{targetMatchUps:h,targetLinks:I}=f,{loserTargetDrawPosition:v,winnerMatchUp:g,loserMatchUp:y}=h;if(y){const{loserTargetLink:t}=I,e=ms({loserTargetDrawPosition:v,loserMatchUp:y,loserTargetLink:t,drawDefinition:a,matchUpsMap:c});if(e.error)return e}const U=(null===(i=d.drawPositions)||void 0===i?void 0:i.filter(Boolean))||[],w=1===U.length&&ds({drawPosition:U[0],matchUpId:s.matchUpId,inContextDrawMatchUps:r})||void 0,S=d.matchUpStatus===E&&!U.length,P=1===d.finishingRound,D=S&&!P?N:E,T=ts({...t,matchUp:d,winningSide:w,matchUpStatus:D});if(T.error)return T;if(S)return ps({...t,targetData:f});if(!g)return{...ut};const M=p[0],{positionAssignments:A}=Na({structure:u}),b=A.find((t=>t.drawPosition===M)),R=c.drawMatchUps.find((t=>t.matchUpId===g.matchUpId)),C=null==R||null===(n=R.drawPositions)||void 0===n?void 0:n.filter(Boolean),O=1===C.length;if(M){if(b.bye){const e=Za({matchUpId:R.matchUpId,inContextDrawMatchUps:r,drawDefinition:a,structure:u});if(O){const t=ts({matchUpId:R.matchUpId,matchUp:R,matchUpStatus:E,removeScore:!0,drawDefinition:a,winningSide:1});return t.error?t:cs({drawPositionToAdvance:C.filter(Boolean)[0],inContextDrawMatchUps:r,drawDefinition:a,matchUpsMap:c,matchUpId:R.matchUpId})}if(g.matchUpStatus===E){const i=ps({...t,targetData:e,matchUpId:R.matchUpId});if(i.error)return i}return{...ut}}return ls({matchUpId:g.matchUpId,drawPosition:M,inContextDrawMatchUps:r,drawDefinition:a})}if(m){if(!R)return{error:"Missing matchUp"};if(O){const t=C[0],e=ds({matchUpId:s.matchUpId,inContextDrawMatchUps:r,drawPosition:t});console.log("existing drawPosition is winningSide",{walkoverWinningSide:e})}const e=R.matchUpStatus===E?E:N,i=ts({matchUpId:R.matchUpId,matchUp:R,removeScore:!0,drawDefinition:a,matchUpStatus:e});if(i.error)return i;if(e===N){const e=ps({...t,targetData:f,matchUpId:s.matchUpId});if(e.error)return e}}return ut}({...t,matchUpId:u.matchUpId,sourceMatchUp:a,winnerMatchUp:u});if(e.error)return e}return ut}function ms(t){var e;const{loserTargetDrawPosition:i,loserTargetLink:n,drawDefinition:r,matchUpsMap:a}=t,o=null==n||null===(e=n.target)||void 0===e?void 0:e.structureId,{structure:s}=Fr({drawDefinition:r,structureId:o});return s?os({drawPosition:i,drawDefinition:r,structureId:o,matchUpsMap:a}):{error:"Missing structure"}}function fs(t){var e;const i=t.isCollectionMatchUp&&(null===(e=t.dualMatchUp)||void 0===e?void 0:e.winningSide)&&t.projectedWinningSide,n=Boolean(t.matchUp.collectionId),r=ts(t);if(n){const{matchUpTieId:e,drawDefinition:n}=t,{removeWinningSide:r}=es({matchUpId:e,drawDefinition:n});console.log("atsms",{removeWinningSide:r,removeDirected:i})}return r}function hs({tournamentRecord:t,drawDefinition:e,event:i}){const n=(null==t?void 0:t.events)||i&&[i],r=(null==n?void 0:n.map((t=>null==t?void 0:t.drawDefinitions)).flat().filter(Boolean))||e&&[e]||[],a={},o={},s=r.map((({structures:t})=>null==t?void 0:t.filter((t=>null==t?void 0:t.structures)))).flat().filter(Boolean);for(const c of s){const{structures:t,structureId:e}=c||{};t&&(a[e]=null==t?void 0:t.map((t=>t.structureId)))&&t.forEach((t=>o[t.structureId]=c.structureId))}return{containedStructures:a,containerStructures:o}}function Is({drawDefinition:t,structureId:e}){if(!t)return{error:mt};const{structure:i}=Fr({drawDefinition:t,structureId:e}),n=((null==t?void 0:t.links)||[]).filter((t=>{var i;return(null===(i=t.source)||void 0===i?void 0:i.structureId)===e})).map((t=>{var e;return null===(e=t.target)||void 0===e?void 0:e.structureId}));return{playoffStructures:((null==t?void 0:t.structures)||[]).filter((t=>n.includes(t.structureId)&&t.stage===Rn)),structure:i}}function vs(t){if(null==t||!t.drawDefinition)return{error:mt};const e=eo(t),{completedMatchUps:i,pendingMatchUps:n,upcomingMatchUps:r}=e||{};return!(!(null==i?void 0:i.length)||null!=n&&n.length||r.length)}function gs(t){var e,i;const{drawDefinition:n,structureId:r}=t;if(!n)return{error:mt};const{playoffStructures:a}=Is({drawDefinition:n,structureId:r});if(null==a||!a.length)return!1;const o=(null==n||null===(e=n.entries)||void 0===e||null===(i=e.filter((t=>sa.includes(null==t?void 0:t.entryStatus))))||void 0===i?void 0:i.length)||0;let s=0;return(a||[]).reduce(((t,e)=>{var i;return!(null!=e&&null!==(i=e.positionAssignments)&&void 0!==i&&i.filter((t=>(t.participantId&&s++,!(null!=t&&t.bye||null!=t&&t.participantId)))).length)&&t}),!0)||s===o}function ys({drawDefinition:t,structure:e,matchUp:i}){const n=[];if("WIN_RATIO"===e.finishingPosition&&vs({drawDefinition:t,structure:e})){const{structureIds:r}=function({drawDefinition:t,structure:e,matchUp:i}){const{drawPositions:n}=i,{positionAssignments:r}=Na({drawDefinition:t,structure:e}),a=r.filter((({drawPosition:t})=>n.includes(t))).map((t=>{var e;const{extension:i}=Je({element:t,name:"tally"});return null==i||null===(e=i.value)||void 0===e?void 0:e.groupOrder})),{containerStructures:o}=hs({drawDefinition:t}),s=o[e.structureId],{links:{source:c}}=Ja({drawDefinition:t,structureId:s});return{structureIds:null==c?void 0:c.filter((t=>{var e;return ot(a,(null===(e=t.source)||void 0===e?void 0:e.finishingPositions)||[])})).map((t=>t.source.structureId))}}({drawDefinition:t,structure:e,matchUp:i});null!=r&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function Us({drawPositions:t,structure:e}){if([En,An].includes(e.stage)&&1===e.stageSequence)return;const{positionAssignments:i}=Na({structure:e});i.filter((({drawPosition:e})=>t.includes(e))).forEach((t=>{jr({element:t,extension:{name:"disableLinks",value:!0}})}))}function ws({drawDefinition:t,positionAction:e}){const{extension:i}=Je({element:t,name:"positionActions"});jr({element:t,extension:{name:"positionActions",value:Array.isArray(null==i?void 0:i.value)?i.value.concat(e):[e]}})}function Ss({participantsCount:t,cluster:e}){const i=q(t),n=nt(1,i+1);let r=[],a=i/2;for(;a>1;){const t=st(n,a),i=t.length;t.forEach(((t,n)=>{let a;const o=n<i/2,s=n%2==0,c=t[0],u=t[t.length-1];a=e&&i>4?8===i?o?u:c:s?c:u:o?c:u,ot(t,r)||r.push(a)})),a/=2}const o=n.filter((t=>!r.includes(t)));for(;o.length;)o.length%2==0?r.push(o.pop()):r.push(o.shift());const s=nt(0,20).map((t=>Math.pow(2,t)));s.unshift(1);const c=s.indexOf(i);let u=0;const d=[];return nt(0,c).forEach((t=>{d.push(r.slice(u,u+s[t])),u+=s[t]})),{seedBlocks:d}}function Ns({appliedPolicies:t,drawDefinition:e,allPositions:i,structure:n}){var r;let a,o,s,c,u,d=0,l=[];if(!n)return{error:"Missing structure"};const{roundMatchUps:p}=ba({roundFilter:1,structure:n}),{seedAssignments:m}=Ua({drawDefinition:e,structure:n}),{positionAssignments:f}=Pa({structure:n}),h=f.length,I=(null==m?void 0:m.length)||0;let v=[];const g=Object.keys(p).sort(((t,e)=>t-e)).map((t=>{const e=p[t].map((t=>t.drawPositions)).flat(1/0).filter(Boolean),i=e.filter((t=>!v.includes(t)));return v=v.concat(...e),i})).filter((t=>t.length)).reverse(),y=g.pop(),U=y&&Math.min(...y)-1||0,w=null==t||null===(r=t.seeding)||void 0===r?void 0:r.seedingProfile,S=(null==y?void 0:y.length)||0,N=g.filter((t=>t.filter((t=>t<=I)).length)),P=i?h:I;if(n.structureType===Ln){if(o=!0,({validSeedBlocks:l,error:u}=function({seedingProfile:t,structure:e,seedBlocks:i}){const n=e.structures||[],r=[];for(const l of n){const{positionAssignments:e}=Pa({structure:l}),n=Math.min(...e.map((t=>t.drawPosition)))-1,a=e.length;let o,s;if(G(a)?({blocks:o,error:s}=Ps({seedBlocks:i,baseDrawSize:a,seedingProfile:t,drawPositionOffset:n,seedCountGoal:a})):({blocks:o,error:s}=Ds({baseDrawSize:a,drawPositionOffset:n,seedCountGoal:a})),s)return{error:s};r.push(o)}const a=r.map((t=>t.map((t=>t.seedNumbers.map(((e,i)=>({seedNumber:e,drawPosition:t.drawPositions[i]}))))))).flat(1/0).sort(((t,e)=>t.seedNumber-e.seedNumber)).reduce(((t,e)=>{const i=e.seedNumber;return t[i]||(t[i]=[]),t[i].push(e.drawPosition),t}),{});let o=1,s=[];a[1]&&a[1].forEach(((t,e)=>{s.push({seedNumbers:[e+1],drawPositions:[t]}),o++})),[[2],[3,4],[5,6,7,8],nt(9,17)].forEach((t=>{const e=[].concat(...t.map((t=>a[t]||[]))),i=e.map(((t,e)=>o+e)),n={seedNumbers:i,drawPositions:e};s.push(n),o+=i.length}));const c=(t,e)=>t-e,u=(t,e)=>e-t,d=Object.keys(a).map(((t,e)=>a[t].sort(e%2?u:c))).flat().map(((t,e)=>({seedNumbers:[e+1],drawPositions:[t]})));return"WATERFALL"===e.seedingProfile&&(s=d),{validSeedBlocks:s}}({seedingProfile:w,structure:n})),u)return{error:u}}else if(g.length){s=!0,l=N.map((t=>({seedNumbers:t,drawPositions:t})));const t=N.flat(1/0);a=t.length<P?P-t.length:0,d=t.length}else y&&!G(S)?(a=0,c=!0):a=P;if(!o&&!c){const{blocks:t,error:e}=Ps({drawPositionOffset:U,seedNumberOffset:d,seedCountGoal:a,seedingProfile:w,baseDrawSize:S});if(e)return{validSeedBlocks:[],isContainer:o,isFeedIn:s,error:e};t.forEach((t=>l.push(t)))}c&&st(y,2).map(((t,e)=>({drawPositions:[t[0]],seedNumbers:[e+1]}))).forEach((t=>l.push(t)));const D=[].concat(...l.map((t=>t.drawPositions))).reduce(((t,e)=>(null==y?void 0:y.includes(e))&&t),!0);return c||s||o||D?{validSeedBlocks:l,isContainer:o,isFeedIn:s,isLucky:c}:{error:"Invalid seedPosition",validSeedBlocks:[],isContainer:o,isFeedIn:s}}function Ps({drawPositionOffset:t=0,seedNumberOffset:e=0,seedingProfile:i,seedCountGoal:n,baseDrawSize:r}){let a=1;const o=[],{seedBlocks:s}=Ss({participantsCount:r,cluster:"CLUSTER"===i});a=0;for(const u of s){if(a+1>n)break;const i=u.map((e=>e+t)),r=c(a+1,u.length).map((t=>+t+e));a+=u.length,o.push({drawPositions:i,seedNumbers:r})}return{blocks:o};function c(t,e){return Array.from(new Array(e),((e,i)=>i+t))}}function Ds({baseDrawSize:t,seedCountGoal:e,drawPositionOffset:i=0}){let n=1;const r=[],a=nt(i+1,i+t+1);return[[1],[2],[3,4],[5,6,7,8],nt(9,17),nt(17,33),nt(33,65)].forEach((t=>{const i=t.map((()=>a.reverse().pop())).filter(Boolean),o={seedNumbers:t=t.slice(0,i.length),drawPositions:i};n<=e&&r.push(o),n+=i.length})),{blocks:r}}function Ts({seedNumber:t,drawDefinition:e,structureId:i,drawPosition:n}){var r,a,o,s;const{structure:c}=Fr({drawDefinition:e,structureId:i}),{appliedPolicies:u}=Rr({drawDefinition:e}),{validSeedBlocks:d}=Ns({structure:c,drawDefinition:e,appliedPolicies:u});if(null!=u&&null!==(r=u.seeding)&&void 0!==r&&null!==(a=r.validSeedPositions)&&void 0!==a&&a.ignore)return!0;if(null!=u&&null!==(o=u.seeding)&&void 0!==o&&null!==(s=o.validSeedPositions)&&void 0!==s&&s.strict){const e=d.find((e=>e.seedNumbers.includes(t)));return((null==e?void 0:e.drawPositions)||[]).includes(n)}return[].concat(...d.map((t=>t.drawPositions))).includes(n)}function Ms({drawDefinition:t,structureId:e,randomize:i}){var n;const{structure:r}=Fr({drawDefinition:t,structureId:e}),{seedAssignments:a}=Ua({drawDefinition:t,structure:r}),{positionAssignments:o}=Pa({structure:r}),s=o.filter((t=>t.participantId||t.bye||t.qualifier)).map((t=>t.drawPosition)).filter(Boolean),{appliedPolicies:c}=Rr({drawDefinition:t}),{validSeedBlocks:u}=Ns({structure:r,drawDefinition:t,appliedPolicies:c}),d=(u||[]).filter((t=>t.drawPositions.filter((t=>!s.includes(t))).length))[0],l=a.map((t=>t.participantId)).filter(Boolean),p=o.map((t=>t.participantId)).filter(Boolean),m=l.filter((t=>p.includes(t))),f=l.filter((t=>!p.includes(t))),h=a.filter((t=>f.includes(t.participantId))),I=a.filter((t=>!t.participantId)),v=(h.length||I.length)&&(null==d?void 0:d.drawPositions.filter((t=>!s.includes(t))))||[],g=i?Z(v):v,y=[],U=g.map((()=>{const t=function(t,e){const i=t.filter((t=>!e.includes(t.participantId))),n=Math.min(...i.map((t=>t.seedValue)));return Z(i.filter((t=>t.seedValue===n))).pop()}(h,y),e=t&&t.participantId;return e&&y.push(e),e})).filter(Boolean),w=a.filter((t=>m.includes(t.participantId))).map((t=>t.seedNumber)),S=(d&&d.seedNumbers||[]).filter((t=>!w.includes(t))),N=a.filter((t=>S.includes(t.seedNumber))).map((t=>t.participantId)),P=null==c||null===(n=c.seeding)||void 0===n?void 0:n.duplicateSeedNumbers;return{nextSeedBlock:d,unplacedSeedParticipantIds:void 0===P||P?U:N,unplacedSeedNumbers:S,unfilledPositions:g,unplacedSeedAssignments:h}}function As({inContextDrawMatchUps:t,automaticPlacement:e,drawDefinition:i,participantId:n,drawPosition:r,matchUpsMap:a,structureId:o,event:s}){a=a||Or({drawDefinition:i}),t||({matchUps:t}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:a}));const{structure:c,error:u}=Fr({drawDefinition:i,structureId:o});if(u)return{error:u};if(Ta({drawDefinition:i,structure:c}))return{error:"Invalid matchUp"};const{positionAssignments:d}=Pa({structure:c}),{seedAssignments:l}=Ua({drawDefinition:i,structure:c}),p=l.find((t=>t.participantId===n)),m=null==p?void 0:p.seedNumber;if(m&&!Ts({structureId:o,drawPosition:r,drawDefinition:i,seedNumber:m}))return{error:"Invalid drawPosition for seedAssignment"};const f=d.find((t=>t.drawPosition===r));if(!f)return{error:"Invlid drawPosition"};if(!n)return{error:"Missing participantId"};if(d.map(Ar).includes(n))return{error:"Existing participant drawPosition assignment"};const{containsParticipant:h,containsBye:I}=function(t){const e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:n,filled:e||i||n}}(f);if(h&&f.participantId!==n){const{activeDrawPositions:t}=Ho({drawDefinition:i,structureId:o});if(t.includes(r))return{error:"drawPosition is active"}}if(I){let e=Ko({drawDefinition:i,drawPosition:r,structureId:o,matchUpsMap:a,inContextDrawMatchUps:t});if(e.error)return e}return f.participantId=n,c.structureType!==Ln?function({inContextDrawMatchUps:t,automaticPlacement:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structure:a,event:o}){const{matchUps:s}=ba({inContextDrawMatchUps:t,drawDefinition:i,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:r,structure:a,event:o}),{roundMatchUps:c}=Cr({matchUps:s}),{initialRoundNumber:u}=Io({drawPosition:n,matchUps:s}),d=c[u].find((t=>t.drawPositions.includes(n)));if(d){ls({drawDefinition:i,drawPosition:n,automaticPlacement:e,matchUpId:d.matchUpId,matchUpsMap:r,inContextDrawMatchUps:t}).error}}({inContextDrawMatchUps:t,positionAssignments:d,automaticPlacement:e,drawDefinition:i,matchUpsMap:a,drawPosition:r,structure:c,event:s}):qo({inContextDrawMatchUps:t,positionAssignments:d,drawDefinition:i,matchUpsMap:a,structure:c}),e||(Us({structure:c,drawPositions:[r]}),ws({drawDefinition:i,positionAction:{name:"positionAssignment",drawPosition:r,structureId:o,participantId:n}})),Sr({drawDefinition:i,structureIds:[o]}),Object.assign({positionAssignments:d},ut)}function Es(t){const{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:n,loserDrawPosition:r,loserTargetLink:a,drawDefinition:o,loserMatchUp:s,dualMatchUp:c,matchUpsMap:u,event:d}=t,l=a.linkCondition,p=s.drawPositions||[],m="FIRST_MATCHUP"===l&&2===s.roundNumber&&Math.min(...p.filter(Boolean)),f=m||p[e],h=m||p[1-e],I=a.source.structureId,{structure:v}=Fr({drawDefinition:o,structureId:I}),{matchUps:g}=ba({inContext:!0,drawDefinition:o,structure:v,event:d}),y=g.filter((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.includes(r)})).filter((t=>{var e;const i=t.sides.find((t=>t.drawPosition===r)),n=t.matchUpStatus===E||t.matchUpStatus===S&&!(null===(e=t.score)||void 0===e||!e.scoreStringSide1);return(null==i?void 0:i.sideNumber)===t.winningSide&&!n})),U="FIRST_MATCHUP"===l&&0===y.length,{positionAssignments:w}=Pa({drawDefinition:o,structureId:I}),N=w.find((t=>t.drawPosition===r)),P=null==N?void 0:N.participantId,D=a.target.structureId,{positionAssignments:T}=Pa({drawDefinition:o,structureId:D}),M=T.filter((({drawPosition:t})=>p.includes(t)));if(M.some((t=>t.participantId===P)))return ut;const A=M.filter((t=>{const e=p.includes(t.drawPosition),i=!t.participantId&&!t.bye&&!t.qualifier;return e&&i})).map((t=>t.drawPosition)),b=A.includes(f),R=a.target.roundNumber>1&&A.length,C=1===a.target.roundNumber&&b;if(m){const t=U?L():os({drawDefinition:o,structureId:D,drawPosition:h});if(t.error)return t}else if(C){const t=L();if(t.error)return t}else{if(!R)return{error:"Invlid drawPosition"};{const t=A.sort(Ie)[0],e=As({participantId:P,structureId:D,drawPosition:t,automaticPlacement:!0,inContextDrawMatchUps:i,drawDefinition:o,matchUpsMap:u});if(e.error)return e}}if(c&&n){var O;const t=null===(O=c.sides)||void 0===O?void 0:O.find((t=>t.sideNumber===3-n));if(null!=t&&t.lineUp){const{roundNumber:e}=s,{roundPosition:i}=c,n=1===e?i%2+1:1,{matchUp:r}=Ra({matchUpId:s.matchUpId,drawDefinition:o,matchUpsMap:u,event:d}),a=[1,2].map((t=>{var e;return{...(null===(e=r.sides)||void 0===e?void 0:e.find((e=>e.sideNumber===t)))||{},sideNumber:t}}));r.sides=a;const l=r.sides.find((t=>t.sideNumber===n));l&&(l.lineUp=t.lineUp,Ur({drawDefinition:o,matchUp:r}))}}return{...ut};function L(){return As({drawDefinition:o,participantId:P,structureId:D,drawPosition:f,automaticPlacement:!0,matchUpsMap:u,inContextDrawMatchUps:i})}}function bs(t){const{dualWinningSideChange:e,projectedWinningSide:i,inContextDrawMatchUps:n,matchUpStatusCodes:r,tournamentRecord:a,drawDefinition:o,matchUpFormat:s,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:l,targetData:p,matchUpId:m,structure:f,matchUp:h,event:I,score:v}=t,g=Boolean(h.collectionId),y=Ta({drawDefinition:o,structure:f});if(!(g||y||function({structure:t,matchUp:e}){const{drawPositions:i}=e,{positionAssignments:n}=Pa({structure:t});return 2===n.filter((t=>i.includes(t.drawPosition)&&t.participantId)).length}({structure:f,matchUp:h})))return{error:"Missing assignments"};const U=Bo({matchUpStatus:c}),S=[E].includes(c),N=ts({matchUpStatusCodes:U&&r||[],matchUpStatus:U&&c||w,tournamentRecord:a,drawDefinition:o,matchUpFormat:s,removeScore:S,winningSide:l,matchUpId:m,matchUp:h,event:I,score:v});if(N.error)return N;let P=h.drawPositions;if(g){const{matchUpTieId:i}=t;es({matchUpId:i,drawDefinition:o,structure:f,event:I});const r=n.find((({matchUpId:t})=>t===i));if(P=null==r?void 0:r.drawPositions,!e)return{...ut}}if(y)return{...ut};if(!P)return{error:"Missing drawPositions"};{const t=l-1,e=1-t,r=P[t],a=P[e],{targetLinks:{loserTargetLink:s,winnerTargetLink:m},targetMatchUps:{winnerMatchUpDrawPositionIndex:f,loserMatchUpDrawPositionIndex:h,winnerMatchUp:v,loserMatchUp:g}}=p;if(v){const t=function({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,winningDrawPosition:n,winnerTargetLink:r,drawDefinition:a,winnerMatchUp:o,dualMatchUp:s,matchUpsMap:c,event:u}){if(r){const i=o.drawPositions||[],s=i[t],u=r.source.structureId,{positionAssignments:d}=Pa({structureId:u,drawDefinition:a}),l=d.find((t=>t.drawPosition===n)),p=null==l?void 0:l.participantId,m=r.target.structureId,{positionAssignments:f}=Pa({structureId:m,drawDefinition:a}),h=f.find((t=>t.participantId===p)),I=null==h?void 0:h.drawPosition,v=f.filter((t=>{const e=i.includes(t.drawPosition),n=!t.participantId&&!t.bye&&!t.qualifier;return e&&n})).map((t=>t.drawPosition)),g=v.includes(s);if(1===r.target.roundNumber&&g)As({drawPosition:s,participantId:p,structureId:m,inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c});else if(v.length){const t=v.pop();As({participantId:p,structureId:m,inContextDrawMatchUps:e,drawDefinition:a,drawPosition:t,matchUpsMap:c})}else{if(!I){const t="winner target position unavaiallble";return console.log(t),{error:t}}{const t=ls({drawPosition:I,matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c});if(t.error)return t}}}else{const t=ls({matchUpId:o.matchUpId,drawPosition:n,inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c});if(t.error)return t}if(s&&i){var d;const t=null===(d=s.sides)||void 0===d?void 0:d.find((t=>t.sideNumber===i));if(null!=t&&t.lineUp){const e=s.roundPosition,i=o.roundPosition,n=e===i&&1!==e||Math.floor(e/2)===i?2:1,{matchUp:r}=Ra({matchUpId:o.matchUpId,drawDefinition:a,matchUpsMap:c,event:u}),d=[1,2].map((t=>{var e;return{...(null===(e=r.sides)||void 0===e?void 0:e.find((e=>e.sideNumber===t)))||{},sideNumber:t}}));r.sides=d;const l=r.sides.find((t=>t.sideNumber===n));l&&(l.lineUp=t.lineUp,Ur({drawDefinition:a,matchUp:r}))}}return{...ut}}({winnerMatchUpDrawPositionIndex:f,inContextDrawMatchUps:n,projectedWinningSide:i,winningDrawPosition:r,winnerTargetLink:m,drawDefinition:o,winnerMatchUp:v,dualMatchUp:u,matchUpsMap:d,event:I});if(t.error)return t}if(g){const t=Es({loserMatchUpDrawPositionIndex:h,inContextDrawMatchUps:n,projectedWinningSide:i,loserDrawPosition:a,loserTargetLink:s,drawDefinition:o,matchUpStatus:c,loserMatchUp:g,winningSide:l,matchUpsMap:d,dualMatchUp:u,event:I});if(t.error)return t}}return ut}function Rs(t){const{inContextDrawMatchUps:e,drawDefinition:i,matchUpsMap:n,targetData:r,structure:a,matchUp:o}=t,{targetLinks:{loserTargetLink:s},targetMatchUps:{loserMatchUp:c,winnerMatchUp:u,loserTargetDrawPosition:d}}=r;if(c){const t=rs({targetLink:s,drawPosition:d,drawDefinition:i,inContextDrawMatchUps:e,matchUpsMap:n});if(t.error)return t}if(u){const r=Za({matchUpId:u.matchUpId,inContextDrawMatchUps:e,drawDefinition:i}),{targetMatchUps:{winnerMatchUp:s}}=r,c=null==n?void 0:n.drawMatchUps.find((t=>t.matchUpId===u.matchUpId));let d,m,f=[];if(u.feedRound){var l;f=null==s||null===(l=s.drawPositions)||void 0===l?void 0:l.filter(Boolean),d=!0}else{var p;const{pairedPreviousMatchUp:t}=function({structureId:t,matchUpsMap:e,matchUp:i}){const n=null==i?void 0:i.roundPosition,r=n+(n%2?1:-1);return{pairedPreviousMatchUp:Lr({matchUpsMap:e,structureId:t}).find((({roundNumber:t,roundPosition:e})=>t===i.roundNumber&&e===r))}}({structureId:a.structureId,matchUpsMap:n,matchUp:o});m=(null==t?void 0:t.matchUpStatus)===N,f=(null==t||null===(p=t.drawPositions)||void 0===p?void 0:p.filter(Boolean))||[],d=[...x,y].includes(null==t?void 0:t.matchUpStatus)||(null==t?void 0:t.winningSide)}if(d){const t=o.drawPositions||[];let r=u.drawPositions.filter(Boolean);ot(t,r)&&(r=r.filter((e=>!t.includes(e))));const a=t.concat(f).find((t=>r.includes(t)));if(s&&a){const t=ns({winningDrawPosition:a,winnerMatchUp:s,inContextDrawMatchUps:e,drawDefinition:i,matchUpsMap:n});if(t.error)return t}}Rs({targetData:r,matchUp:u,inContextDrawMatchUps:e,drawDefinition:i,matchUpsMap:n,structure:a});let h=[E,N].includes(null==c?void 0:c.matchUpStatus)&&m?E:A;const I=!m;let v=ts({...t,matchUpStatus:h,removeScore:I,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},removeWinningSide:!0,matchUp:c,matchUpId:u.matchUpId});if(v.error)return v}return{...ut}}function Cs({score:t}={}){const{sets:e,scoreStringSide1:i,scoreStringSide2:n}=t||{};return!!t&&(!(!i&&!n)||!(null==e||!e.length)&&Object.values(e[0]).some((t=>t)))}function Os(t){const{matchUp:e,matchUpStatus:i,score:n,winningSide:r}=t;if((null==e?void 0:e.matchUpStatus)===N&&i!==N){const e=Rs(t);if(e.error)return e}const a=i===N,o=Cs({score:n})&&!a&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!r),s=![D,g].includes(i||D),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!r&&!Cs({score:n}),u=i&&i!==A,d=({removeScore:i}={})=>{let n;const{structure:r,drawDefinition:a}=t,{connectedStructureIds:o}=ys({drawDefinition:a,structure:r,matchUp:e});o.length&&(console.log({connectedStructureIds:o}),n=!0),Object.assign(t,{removeScore:i});const s=is(t);return s.error?s:{...ut,connectedStructures:n}};return r&&function(t){const{drawDefinition:e,winningSide:i,structure:n,matchUp:r}=t;let a;if(r.winningSide&&r.winningSide!==i){const{connectedStructureIds:i}=ys({drawDefinition:e,structure:n,matchUp:r});i.length&&(console.log({connectedStructureIds:i}),a=!0);const o=is(t);if(o.error)return o}const o=bs(t);return o.error?o:{...ut,connectedStructures:a}}(t)||o&&d({removeScore:s})||u&&function(t){const{drawDefinition:e,matchUp:i,structure:n,matchUpStatus:r}=t,a=r===y,o=i.winningSide,s=r===N,c=Bo({matchUpStatus:r}),u=Go({matchUpStatus:r}),d=o&&s;return!c&&!u&&{error:"Unrecognized matchUpStatus"}||o&&c&&!s&&fs(t)||d&&function(t){let e=is(t);return e.error?e:ps(t)}(t)||o&&is(t)||u&&ts({...t,removeScore:[U,E].includes(r),matchUpStatus:r||A})||a&&function({drawDefinition:t,structure:e,matchUp:i}){var n;if(null!=i&&i.winningSide)return{error:"Invalid matchUpStatus",matchUpStatus:y};const{positionAssignments:r}=Pa({structure:e}),a=r.filter((t=>t.bye)).map((t=>t.drawPosition));return(null===(n=i.drawPositions)||void 0===n?void 0:n.some((t=>a.includes(t))))?(i.matchUpStatus=y,i.matchUpStatusCodes=[],Ur({drawDefinition:t,matchUp:i}),ut):{error:"Cannot Assign BYE status if no assignment: { bye: true }"}}({drawDefinition:e,matchUp:i,structure:n})||!c&&{error:"Unrecognized matchUpStatus"}||s&&function(t){const e=fs({...t,removeScore:!0});return e.error?e:ps(t)}(t)||{error:"Invalid matchUpStatus"}}(t)||c&&d()||e&&function(t){var e;const i=Boolean(t.matchUp.collectionId),n=t.isCollectionMatchUp&&(null===(e=t.dualMatchUp)||void 0===e?void 0:e.winningSide)&&t.projectedWinningSide,r=ts({...t,removeScore:!0});if(i){const{matchUpTieId:e,drawDefinition:i,structure:r,event:a}=t,{removeWinningSide:o}=es({matchUpId:e,drawDefinition:i,structure:r,event:a});console.log("ndd",{removeWinningSide:o,removeDirected:n})}return r}({...t,removeScore:!0})||console.log("unknown condition")&&{...ut}}function Ls(t){var e;const{inContextDrawMatchUps:i,targetData:n,drawDefinition:r}=t,{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o}}=n,s=(null==o||null===(e=o.drawPositions)||void 0===e?void 0:e.filter(Boolean).length)||0;if(null!=a&&a.winningSide||2===s&&null!=o&&o.winningSide)return!0;let c=a&&Za({matchUpId:a.matchUpId,drawDefinition:r,inContextDrawMatchUps:i}),u=o&&Za({matchUpId:o.matchUpId,drawDefinition:r,inContextDrawMatchUps:i});const d=c&&Ls({inContextDrawMatchUps:i,drawDefinition:r,targetData:c});return!!(u&&Ls({inContextDrawMatchUps:i,drawDefinition:r,targetData:u})||d)}function xs(t){var e,i;const{allowChangePropagation:n,tournamentRecord:r,drawDefinition:a,matchUpStatus:o,winningSide:s,matchUpId:c,event:u,score:d}=t;if(!a)return{error:mt};if([U,D,g,A].includes(o)&&s)return{error:gt,winningSide:s,matchUpStatus:o};if(![void 0,...C].includes(o))return{error:"Invalid matchUpStatus"};const l=Or({drawDefinition:a});let{matchUps:p}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:l});p.find((({winnerMatchUpId:t,loserMatchUpId:e})=>t||e))||({inContextDrawMatchUps:p}=go({inContextDrawMatchUps:p,drawDefinition:a,matchUpsMap:l}));const m=l.drawMatchUps.find((t=>t.matchUpId===c)),f=p.find((t=>t.matchUpId===c));if(!m||!p)return{error:"matchUp not found"};if((m.winningSide||s)&&o===y)return{error:"Incompatible matchUpStatus",matchUpStatus:o};const h=null===(e=f.drawPositions)||void 0===e?void 0:e.filter(Boolean);if(m.matchUpType===ni)return{error:"DIRECT SCORING of TEAM matchUp not implemented"};const I=f.matchUpTieId,v=Za({matchUpId:I||c,inContextDrawMatchUps:p,drawDefinition:a}),w=f.structureId,{structure:S}=Fr({drawDefinition:a,structureId:w});if(d&&m.matchUpType!==ni&&!m.collectionId){const t=m.matchUpFormat||(null==S?void 0:S.matchUpFormat)||(null==a?void 0:a.matchUpFormat)||(null==u?void 0:u.matchUpFormat),e=ho({existingMatchUpStatus:m.matchUpStatus,matchUpFormat:t,matchUpStatus:o,winningSide:s,score:d});if(e.error)return e}const N=2===(null===(i=m.sides)||void 0===i?void 0:i.map((t=>t.participantId)).filter(Boolean).length)||2===(null==h?void 0:h.length);if(o&&R.includes(o)&&!N)return{error:"Invalid matchUpStatus"};let P;if(Object.assign(t,{inContextDrawMatchUps:p,inContextMatchUp:f,matchUpTieId:I,matchUpsMap:l,targetData:v,structure:S,matchUp:m}),I){const{matchUp:e}=Ra({matchUpId:I,inContext:!0,drawDefinition:a,matchUpsMap:l,event:u}),i=(null==e?void 0:e.tieFormat)||(null==a?void 0:a.tieFormat)||(null==u?void 0:u.tieFormat)||void 0,{projectedWinningSide:n}=function({drawDefinition:t,winningSide:e,dualMatchUp:i,tieFormat:n,structure:r,matchUp:a,event:o,score:s}){const c=me(i,void 0,!0);for(const d of(null==c?void 0:c.tieMatchUps)||[])d.matchUpId===a.matchUpId&&(d.winningSide=e,d.score=s);n=n||(null==a?void 0:a.tieFormat)||(null==r?void 0:r.tieFormat)||(null==t?void 0:t.tieFormat)||(null==o?void 0:o.tieFormat);const{winningSide:u}=Ei({matchUp:c,tieFormat:n});return{projectedWinningSide:u}}({winningSide:s,dualMatchUp:e,tieFormat:i,structure:S,matchUp:m,event:u,score:d});P=n!==e.winningSide,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:P,projectedWinningSide:n,matchUpTieId:I,dualMatchUp:e,tieFormat:i})}const T=Ls(t),M=Bo({matchUpStatus:o});if(!I){if(T&&!s&&Go({matchUpStatus:o}))return{error:"Incompatible matchUpStatus",activeDownstream:T,winningSide:s};if(s&&s===m.winningSide&&o&&!M)return{error:"Incompatible matchUpStatus",directingMatchUpStatus:M,matchUpStatus:o}}const{schedule:E}=t;if(E){const t=ka({tournamentRecord:r,disableNotice:!0,drawDefinition:a,matchUpId:c,schedule:E});if(t.error)return t}const b=m.matchUpType!==ni&&!P&&s&&m.winningSide&&m.winningSide!==s;if(n&&b&&m.roundPosition)return function(t){var e;const{inContextMatchUp:i,structure:n,drawDefinition:r}=t,a=i.roundNumber,o=i.sides.find((t=>t.sideNumber===i.winningSide)),s=i.sides.find((t=>t.sideNumber!==i.winningSide)),{drawPosition:c,participantId:u}=o,{drawPosition:d,participantId:l}=s,{matchUps:p}=ba(t),m=p.filter((({drawPositions:t,roundNumber:e})=>(null==t?void 0:t.includes(c))&&e>a));Pt({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach((t=>{var e;t.drawPositions=(null===(e=t.drawPositions)||void 0===e?void 0:e.map((t=>t===c?d:t)))||[],Ur({drawDefinition:r,matchUp:t})}));const{stage:f,stageSequence:h}=n,I=r.structures.filter((({stage:t,stageSequence:e})=>t===f&&e>h)).map((({structureId:t})=>t)),{targetLinks:{loserTargetLink:v,winnerTargetLink:g}}=t.targetData,y=[null==v?void 0:v.target.structureId,null==g||null===(e=g.target)||void 0===e?void 0:e.structureId].filter(Boolean);return r.structures.filter((({stage:t,structureId:e})=>t!==f&&y.includes(e))).forEach((({stage:t,stageSequence:e,structureId:i})=>{I.includes(i)||I.push(i),r.structures.filter((({stage:i,stageSequence:n})=>i===t&&n>e)).forEach((({structureId:t})=>{I.includes(t)||I.push(t)}))})),r.structures.filter((({structureId:t})=>I.includes(t))).forEach((t=>{const{positionAssignments:e}=Na({structure:t}),i=e.find((({participantId:t})=>t===u)),n=e.find((({participantId:t})=>t===l));i&&(i.participantId=l),n&&(n.participantId=u)})),ts(t)}(t);const O=s&&!I||t.projectedWinningSide;return!T&&Os(t)||O&&function(t){const{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?Fs(t):{error:"Cannot change winningSide"}}(t)||M&&Fs(t)||{error:"No valid actions"}}function Fs(t){const{matchUp:e,event:i}=t,n=t.isCollectionMatchUp&&e.winningSide&&!t.winningSide&&!Cs({score:t.score}),r=t.isCollectionMatchUp?t.machUpStatus||n&&A:t.matchUpStatus||w,a=[U,E].includes(r)&&![D,g].includes(r),o=ts({...t,matchUpStatus:r,removeWinningSide:n,removeScore:a});if(t.isCollectionMatchUp){const{matchUpTieId:e,drawDefinition:n,structure:r}=t,{removeWinningSide:a}=es({matchUpId:e,drawDefinition:n,structure:r,event:i});console.log("sms",{removeWinningSide:a})}return o}function ks(t){const{drawDefinition:e,event:i,matchUpFormat:n,structureId:r,matchUpId:a}=t;let{tieFormat:o}=t;if(!e)return{error:mt};if(!n&&!o)return{error:"Missing matchUpFormat"};if(n&&!h(n))return{error:"Unrecognized matchUpFormat"};if(o){const t=function(t){const e=Ai({tieFormat:t,checkCollectionIds:!1});if(e.error)return e;for(const i of t.collectionDefinitions)i.collectionId||(i.collectionId=ve());return{tieFormat:t}}(o);if(t.error)return t;o=t.tieFormat}if(a){const{matchUp:t,error:r}=Ra({drawDefinition:e,matchUpId:a,event:i});if(r)return{error:r};if(n&&t.matchUpType!==Ci)t.matchUpFormat=n;else{if(!o||t.matchUpType!==Ci)return{error:gt};t.tieFormat=o}Ur({drawDefinition:e,matchUp:t})}else if(r){const{structure:t,error:i}=Fr({drawDefinition:e,structureId:r});if(i)return{error:i};if(!t)return{error:"structure not found"};n&&t.matchUpType!==Ci?t.matchUpFormat=n:o&&(t.tieFormat=o)}else e&&(n?e.matchUpFormat=n:o&&(e.tieFormat=o));return Sr({drawDefinition:e,structureIds:r?[r]:void 0}),{...ut,tieFormat:o}}function _s({score:t,winningSide:e,matchUpStatus:i}={}){if(!t)return{sets:[]};const n=t.sets||[];let r=In({winnerFirst:!1,matchUpStatus:i,sets:n}),a=In({winnerFirst:!1,matchUpStatus:i,reversed:!0,sets:n}),o=In({winningSide:e,matchUpStatus:i,sets:n}),s=r===o?a:r;return e&&(r=1===e?o:s,a=2===e?o:s),{score:{sets:n,scoreStringSide1:r,scoreStringSide2:a}}}function js(t){var e;const{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,matchUpId:a,schedule:o,event:s,notes:c}=t;if(!n)return{error:"Missing drawId"};if(!a)return{error:"Missing matchUpId"};const{policy:u}=Ke({policyType:"scoring",tournamentRecord:i,event:s}),d=void 0!==t.allowChangePropagation?t.allowChangePropagation:void 0!==(null==u?void 0:u.allowChangePropagation)?u.allowChangePropagation:void 0;let{outcome:l}=t;if(r){const t=ks({drawDefinition:n,matchUpFormat:r,matchUpId:a,event:s});if(t.error)return t}if(null!=l&&null!==(e=l.score)&&void 0!==e&&e.sets&&!l.score.scoreStringSide1){const{score:t}=_s(l);l.score=t,l.score.sets=l.score.sets.filter((t=>t.side1Score||t.side2Score||t.side1TiebreakScore||t.side2TiebreakScore))}return xs({matchUpStatusCodes:null==l?void 0:l.matchUpStatusCodes,matchUpStatus:null==l?void 0:l.matchUpStatus,winningSide:null==l?void 0:l.winningSide,allowChangePropagation:d,score:null==l?void 0:l.score,tournamentRecord:i,drawDefinition:n,matchUpFormat:r,matchUpId:a,schedule:o,event:s,notes:c})}function Bs(t){if(!t.tournamentRecord)return{error:pt};const{tournamentRecord:e,outcomes:i}=t,n={};i.forEach((t=>{const{eventId:e}=t;n[e]||(n[e]=[]),n[e].push(t)}));for(const r of Object.keys(n)){const{event:t}=ui({tournamentRecord:e,eventId:r});for(const i of n[r]){const{drawId:n}=i,r=t.drawDefinitions.find((t=>t.drawId===n));if(r){const{matchUpFormat:a,matchUpId:o}=i,s=js({tournamentRecord:e,drawDefinition:r,event:t,drawId:n,matchUpFormat:a,matchUpId:o,schedule:null==i?void 0:i.schedule,outcome:i});if(s.error)return s}}}return ut}function Gs({tournamentRecord:t}){if(!t)return{error:pt};const e=t.tournamentId,{extension:i}=Ze({tournamentRecord:t,name:"schedulingProfile"});let n=(null==i?void 0:i.value)||[];if(n.length){const i=t.venues.map((({venueId:t,courts:e})=>(null==e?void 0:e.length)&&t)),{eventIds:r,drawIds:a}=mo({tournamentRecords:{[e]:t}}),{updatedSchedulingProfile:o,modifications:s,issues:c}=Co({schedulingProfile:n,venueIds:i,eventIds:r,drawIds:a});if(s){n=o;const e=function({tournamentRecord:t,schedulingProfile:e}){return Gr({tournamentRecord:t,extension:{name:"schedulingProfile",value:e}})}({tournamentRecord:t,schedulingProfile:n});return e.error?e:{schedulingProfile:n,modifications:s,issues:c}}}return{schedulingProfile:n,modifications:0}}function Vs({tournamentRecord:t,schedulingProfile:e,requireCourts:i=!0}){if(!e){const{modifications:e,issues:i}=Gs({tournamentRecord:t});return{success:!e,modifications:e,issues:i}}const{venueIds:n,eventIds:r,drawIds:a}=wo({tournamentRecord:t,requireCourts:i}),{modifications:o,issues:s}=Co({schedulingProfile:e,venueIds:n,eventIds:r,drawIds:a});return{success:!o,modifications:o,issues:s}}function Hs({tournamentRecord:t,courtId:e,scheduleVisibilityFilters:i,matchUpFilters:n}){if(!t)return{error:pt};if(!e)return{error:"Missing courtId"};const{schedulingProfile:r}=Gs({tournamentRecord:t}),{matchUps:a}=ro({tournamentRecord:t,scheduleVisibilityFilters:i,matchUpFilters:n});return{matchUps:function({matchUps:t,courtId:e}){return Lo({matchUps:t.filter((t=>{var i;return(null===(i=t.schedule)||void 0===i?void 0:i.courtId)===e})),schedulingProfile:r})}({matchUps:a,courtId:e})}}function qs({matchUpsCount:t=0}){const e=`Schedule would be deleted from ${t} ${1===t?"matchUp":"matchUps"}; use { force: true }`;return{message:e,error:e}}function Ws({startTime:t,endTime:e}={}){if(!Ht.test(t)||!Ht.test(e))return!1;const[i,n]=t.split(":"),[r,a]=e.split(":");return!(r<i||i===r&&a<n)}function zs({dateAvailability:t}){if(!t)return{error:"Missing dateAvailability"};if(!Array.isArray(t))return{error:"Invalid dateAvailability"};const e="Times must be 24 hour => 00:00";for(const i of t){if("object"!=typeof i)return{error:"Invalid dateAvailability"};const{date:t,startTime:n,endTime:r,bookings:a=[]}=i;if(!n||!r)return{error:"Invalid dateAvailability"};if(t&&!Vt.test(t))return{error:vt,dateAvailability:{date:t},message:"Dates must be formated => YYYY-MM-DD"};if(!Ht.test(n))return{error:"Invalid time",dateAvailability:{startTime:n},message:e};if(!Ht.test(r))return{error:"Invalid time",dateAvailability:{endTime:r},message:e};if(n===r)return{error:"Invalid time",dateAvailability:{startTime:n,endTime:r},message:"startTime and endTime are equivalent"};if(!Ws({startTime:n,endTime:r}))return{error:"Invalid time",dateAvailability:{startTime:n,endTime:r},message:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:"Invalid bookings"};for(const t of a){if("object"!=typeof t)return{error:"Invalid bookings"};const{startTime:i,endTime:n}=t;if(!Ht.test(i))return{error:"Invalid time",booking:{startTime:i},message:e};if(!Ht.test(n))return{error:"Invalid time",booking:{endTime:n},message:e};if(i===n)return{error:"Invalid time",dateAvailability:{startTime:i,endTime:n},message:"startTime and endTime are equivalent"};if(!Ws({startTime:i,endTime:n}))return{error:"Invalid time",dateAvailability:{startTime:i,endTime:n},message:"endTime must be after startTime"}}}}return{valid:!0}}function Ks({tournamentRecord:t,dateAvailability:e,disableNotice:i,courtId:n,force:r}){if(!t)return{error:pt};if(!n)return{error:"Missing courtId"};const a=zs({dateAvailability:e});if(a.error)return a;const{court:o,venue:s,error:c}=Si({tournamentRecord:t,courtId:n});return c?{error:c}:(o.dateAvailability=e,i||At({topic:"modifyVenue",payload:{venue:s},key:s.venueId}),ut)}function Ys({tournamentRecord:t,modifications:e,disableNotice:i,courtId:n,force:r}){if(!t)return{error:pt};if(!n)return{error:"Missing courtId"};if(!e||"object"!=typeof e)return{error:"Invalid object"};const{court:a,venue:o,error:s}=Si({tournamentRecord:t,courtId:n});if(s)return{error:s};const c=Object.keys({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}).filter((t=>"courtId"!==t));if(!Object.keys(e).filter((t=>c.includes(t))).length)return{error:"No valid attributes"};const u=c.filter((t=>!["dateAvailability"].includes(t)));if(Object.keys(e).filter((t=>u.includes(t))).forEach((t=>Object.assign(a,{[t]:e[t]}))),e.dateAvailability){const a=Ks({tournamentRecord:t,dateAvailability:e.dateAvailability,disableNotice:i,courtId:n,force:r});if(a.error)return a}return i||At({topic:"modifyVenue",payload:{venue:o},key:o.venueId}),{...ut,court:me(a)}}function $s({tournamentRecord:t,disableNotice:e,returnDetails:i,venueId:n,courtId:r,court:a}){const{venue:o}=wi({tournamentRecord:t,venueId:n});if(!o)return{error:"Venue not found"};o.courts||(o.courts=[]);const s={altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0,venueId:n,courtId:r};if(s.courtId||(s.courtId=ve()),o.courts.reduce(((t,e)=>t||e.courtId===s.courtId),void 0))return{error:"Court exists"};{const t=((null==a?void 0:a.dateAvailability)||[]).map((t=>{var e;return{...t,date:ne(t.date),startTime:ie(t.startTime),endTime:ie(t.endTime),bookings:null===(e=t.bookings)||void 0===e?void 0:e.map((({startTime:t,endTime:e,bookingType:i})=>({startTime:ie(t),endTime:ie(e),bookingType:i})))}}));for(const e of Object.keys(s))if(a[e])if("dateAvailability"===e){const e=zs({dateAvailability:t}),{valid:i,error:n}=e;if(i)s.dateAvailability=t;else if(n)return{error:n}}else s[e]=a[e];return o.courts.push(s),e||At({topic:"modifyVenue",payload:{venue:o},key:o.venueId}),Pt()||i?{...ut,court:me(s),venueId:n}:{...ut}}}function Js({dateAvailability:t=[],tournamentRecord:e,courtNames:i=[],courtsCount:n,courtIds:r,venueId:a}){if(!a)return{error:"Missing venueId"};if(!H(n)||!i)return{error:"Missing courtsCount/courtNames"};const o=nt(0,n=n||i.length).map((e=>({courtName:i[e]||`Court ${e+1}`,dateAvailability:t}))).map((t=>{const i=null==r?void 0:r.pop();return $s({disableNotice:!0,returnDetails:!0,tournamentRecord:e,courtId:i,venueId:a,court:t})})),s=o.map((t=>t.court)).filter(Boolean);if(s.length===n){const{venue:t}=wi({tournamentRecord:e,venueId:a});return At({topic:"modifyVenue",payload:{venue:t},key:t.venueId}),{...ut,courts:me(s)}}return Object.assign({},{courts:me(s)},{error:o})}function Zs({tournamentRecord:t,modifications:e,venueId:i,force:n}){var r,a;if(!t)return{error:pt};if(!e||"object"!=typeof e)return{error:"Invalid object"};if(!i)return{error:"Missing venueId"};const{venue:o,error:s}=wi({tournamentRecord:t,venueId:i});if(s)return{error:s};const c=Object.keys({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}).filter((t=>"venueId"!==t));if(!Object.keys(e).filter((t=>c.includes(t))).length)return{error:"No valid attributes"};const u=c.filter((t=>!["courts"].includes(t)));Object.keys(e).filter((t=>u.includes(t))).forEach((t=>Object.assign(o,{[t]:e[t]})));const d=(null==o||null===(r=o.courts)||void 0===r?void 0:r.map((t=>t.courtId)))||[],l=(null===(a=e.courts)||void 0===a?void 0:a.map((t=>t.courtId)))||[],p=d.filter((t=>!l.includes(t)));if(p.length){const e=o.courts.filter((t=>p.includes(t.courtId))).map((e=>{const{matchUps:i}=Hs({tournamentRecord:t,courtId:e.courtId});return i.length})).reduce(((t,e)=>t+e));if(e&&!n)return{error:qs({matchUpsCount:e})};o.courts=o.courts.filter((t=>l.includes(t.courtId)))}if(e.courts)for(const m of e.courts){const{courtId:e}=m||{};let r=Ys({tournamentRecord:t,modifications:m,disableNotice:!0,courtId:e,force:n});if("Court not found"===r.error&&(r=$s({tournamentRecord:t,venueId:i,court:m,disableNotice:!0})),r.error)return r}return Vs({tournamentRecord:t}),At({topic:"modifyVenue",payload:{venue:o},key:o.venueId}),{...ut,venue:me(o)}}function Qs({tournamentRecord:t,drawDefinition:e,drawId:i,matchUpId:n}){if(!n)return{error:"Missing matchUpId"};if(!e&&!i)return{error:"Missing drawId"};let r;if(!e){if(!t)return{error:pt};({drawDefinition:e}=ui({tournamentRecord:t,drawId:i}))}if(e)({matchUp:r}=Ra({drawDefinition:e,matchUpId:n}));else{if(!t)return{error:pt};const{matchUps:e}=so({tournamentRecord:t});({matchUp:r}=Mi({matchUps:e,matchUpId:n}))}if(!r)return{error:"matchUp not found"};if(r.timeItems&&r.timeItems.reduce(((t,e)=>e.itemType===Ee||t),void 0)){const t={itemType:Ee,itemValue:"",itemDate:""};r.timeItems.push(t),Ur({drawDefinition:e,matchUp:r})}return ut}function Xs({tournamentRecord:t,venueId:e,force:i}){if(!t)return{error:pt};if("string"!=typeof e)return{error:"Missing venueId"};const{courts:n}=Ni({tournamentRecord:t,venueId:e}),r={courtIds:n.map((t=>t.courtId))},{matchUps:a}=ro({tournamentRecord:t,contextFilters:r});if(a.length&&!i)return qs({matchUpsCount:a.length});for(const s of a){const e=Qs({tournamentRecord:t,drawId:s.drawId,matchUpId:s.matchUpId});if(e.error)return e}let o;return t.venues=(t.venues||[]).filter((t=>{if(t.venueId!==e)return!0;o=!0})),o&&At({topic:"deleteVenue",payload:{venueId:e}}),ut}function tc({flight:t,checkEntryStatus:e=!0,modifyEventEntries:i,existingDrawCount:n,drawDefinition:r,event:a}){var o,s,c,u,d;if(!r)return{error:"Missing drawId"};if(!a)return{error:ht};a.drawDefinitions||(a.drawDefinitions=[]);const{drawId:l,drawName:p,entries:m}=r,{entries:f}=a;let h=0;if(void 0!==n&&n!==a.drawDefinitions.length)return{error:gt,message:"drawDefintions count mismatch"};if(!!a.drawDefinitions.find((t=>t.drawId===l)))return{error:"drawId exists"};const{flightProfile:I}=Qo({event:a}),v=t&&(null==I||null===(o=I.flights)||void 0===o?void 0:o.find((e=>e.flightNumber===t.flightNumber)));if(v&&v.drawId!==r.drawId)return{error:"Invalid drawDefinition",relevantFlight:v};const g=null==v?void 0:v.drawEntries.every((({participantId:t,entryStatus:e})=>{const i=m.find((e=>e&&e.participantId===t));return(null==i?void 0:i.entryStatus)===e})),y=!e||f&&(null==m?void 0:m.every((({participantId:t,entryStatus:e})=>{const i=f.find((e=>e.participantId===t));return(null==i?void 0:i.entryStatus)===e})));if(v&&!g)return{error:"Invalid drawDefinition",relevantFlight:v,matchingEventEntries:y};if(i&&m.filter(Boolean).forEach((t=>{if(sa.includes(null==t?void 0:t.entryStatus)){const e=f.filter(Boolean).find((e=>e.participantId===t.participantId));t.entryStatus&&e.entryStatus!==t.entryStatus&&(e.entryStatus=t.entryStatus,h+=1)}})),f&&!y)return{error:"Invalid drawDefinition",eventEntries:f,matchingEventEntries:y};const U=(null==I||null===(s=I.flights)||void 0===s||null===(c=s.map((({flightNumber:t})=>!isNaN(t)&&parseInt(t))))||void 0===c?void 0:c.filter(Boolean))||[],w=(null===(u=a.drawDefinitions.map((({drawOrder:t})=>!isNaN(t)&&parseInt(t))))||void 0===u?void 0:u.filter(Boolean))||[];let S=Math.max(0,...w,...U)+1;const N=null==I||null===(d=I.flights)||void 0===d?void 0:d.find((t=>t.drawId===l));let P;if(N){N.drawName=r.drawName,P={name:"flightProfile",value:{...I,flights:I.flights}};const t=N.flightNumber;t&&!w.includes(t)?S=t:N.flightNumber=S}else{const t=(null==I?void 0:I.flights)||[];t.push({manuallyAdded:!0,flightNumber:S,drawEntries:m,drawName:p,drawId:l}),P={name:"flightProfile",value:{...I||{},flights:t}}}Hr({event:a,extension:P}),Object.assign(r,{drawOrder:S}),a.drawDefinitions.push(r);const{topics:D}=Rt();if(D.includes("addMatchUps")){const{matchUps:t}=ao({drawDefinition:r,event:a});gr({drawDefinition:r,matchUps:t})}return wr({drawDefinition:r}),{...ut,modifiedEventEntryStatusCount:h}}function ec({tournamentRecord:t,returnDetails:e,disableNotice:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=ve()),t.venues.reduce(((t,e)=>t||e.venueId===n.venueId),void 0)?{error:"Venue exists"}:(t.venues.push(n),i||At({topic:"addVenue",payload:{venue:n}}),Pt({addVenue:!0})?{...ut,venue:me(n)}:e?n:{...ut})):{error:It}:{error:pt}}function ic({allowDuplicateParticipantIdPairs:t,returnParticipant:e,tournamentRecord:i,disableNotice:n,pairOverride:r,participant:a}){if(!i)return{error:pt};if(!a)return{error:"Missing participant"};a.participantId||(a.participantId=ve()),i.participants||(i.participants=[]);const{participantId:o}=a;if(i.participants.reduce(((t,e)=>e.participantId===o||t),!1))return{error:"participantId exists"};const{participantType:s,participantRole:c}=a;if(!Object.keys(xi).includes(s))return{error:"Invalid participantType",participantType:s};if(!c)return{error:"Missing participantRole"};const u=i.participants||[],d=u.filter((t=>t.participantType===Ri)).map((t=>t.participantId));if(s===Oi){if(a.person)return{error:gt,person:a.person};if(!a.individualParticipantIds)return{error:"Missing participantIds"};if(2!==a.individualParticipantIds.length&&!r)return{error:"Invalid participantIds",message:"PAIR must be 2 individualParticipantIds"};{const t=u.filter((t=>t.participantType===Ri)).map((t=>t.participantId));if(!Array.isArray(a.individualParticipantIds))return{error:"Invalid participantIds"};if(!a.individualParticipantIds.reduce(((e,i)=>t.includes(i)&&e),!0))return{error:"Invalid participantIds"}}const i=u.filter((t=>t.participantType===Oi)).map((t=>({participant:t,individualParticipantIds:t.individualParticipantIds}))),n=a.participantType===Oi&&i.find((t=>2===at(t.individualParticipantIds,a.individualParticipantIds).length));if(n&&!t)return{...ut,existingParticipant:!0,participant:e&&me(n.participant)};if(!a.participantName){const t=u.filter((t=>a.individualParticipantIds.includes(t.participantId)));let e=t.map((t=>{var e;return null===(e=t.person)||void 0===e?void 0:e.standardFamilyName})).filter(Boolean).join("/");1===t.length&&(e+="/Unknown"),a.participantName=e}}else if(s===Ri){if(!a.person||!a.person.standardFamilyName||!a.person.standardGivenName)return{error:"Missing person details"};if(!a.participantName){const t=`${a.person.standardFamilyName.toUpperCase()}, ${a.person.standardGivenName}`;a.participantName=t,a.name=t}}else{if(a.person)return{error:gt,person:a.person};const{individualParticipantIds:t}=a;if(null!=t&&t.length)for(const e of t){if("string"!=typeof e)return{error:gt,participantId:e};if(!d.includes(e))return{error:"Participant Not Found",participantId:e}}}return i.participants.push(a),n||At({topic:"addParticipants",payload:{participants:[a]}}),{participant:e&&me(a),...ut}}function nc({allowDuplicateParticipantIdPairs:t,returnParticipants:e,participants:i=[],tournamentRecord:n}){if(!n)return{error:pt};n.participants||(n.participants=[]);const r=n.participants.map((t=>t.participantId))||[];i.forEach((t=>{t.participantId||(t.participantId=ve())}));const a=i.filter((t=>!r.includes(t.participantId))),o=i.filter((t=>r.includes(t.participantId))),s=a.filter((t=>t.participantType===Ri)),c=a.filter((t=>t.participantType!==Ri)),u=s.concat(...c),d=[];if(u.length){for(const e of u){const i=ic({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:n,participant:e});if(i.error)return i;i.success&&!i.existingParticipant&&d.push(i.participant)}d.length&&At({topic:"addParticipants",payload:{participants:d}});const i={participants:e&&me(d),addedCount:d.length,...ut};return o.length&&Object.assign(i,{notAdded:o,message:"Existing participant"}),i}return{message:"No new participants to add",addedCount:0,...ut}}const rc=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e})=>!!Object.keys(e).filter((e=>t.includes(e))).filter((t=>e[t])).length;function ac({matchUps:t=[],scheduleAttributes:e=["scheduledDate","scheduledTime"]}){if(!Array.isArray(t))return{error:"Missing matchUps"};if(!Array.isArray(e))return{error:gt};const i=t.filter((({schedule:t})=>rc({schedule:t,scheduleAttributes:e}))).reduce(((t,e)=>{const{schedule:i}=e,n=ne(null==i?void 0:i.scheduledDate),r=ie(null==i?void 0:i.scheduledTime);return n&&r&&(t[n]?t[n].push(e):t[n]=[e]),t}),{});return Object.keys(i).forEach((t=>{i[t].sort(((t,e)=>{var i,n;return function(t,e){const i=ae(t),n=ae(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}(ie(null===(i=t.schedule)||void 0===i?void 0:i.scheduledTime),ie(null===(n=e.schedule)||void 0===n?void 0:n.scheduledTime))}))})),{scheduledMatchUps:i}}var oc;!function(t){t.INDIVIDUAL="INDIVIDUAL",t.PAIR="PAIR",t.TEAM="TEAM"}(oc||(oc={}));var sc,cc=oc.INDIVIDUAL,uc=oc.PAIR,dc=oc.TEAM;!function(t){t.SIGNED_IN="SIGNED_IN",t.SIGNED_OUT="SIGNED_OUT"}(sc||(sc={}));var lc=sc.SIGNED_IN,pc=sc.SIGNED_OUT,mc={INDIVIDUAL:cc,PAIR:uc,TEAM:dc,SIGNED_IN:lc,SIGNED_OUT:pc,SIGN_IN_STATUS:"SIGN_IN_STATUS"};const fc="SCALE",hc="RATING",Ic="RANKING",vc={SCALE:fc,RATING:hc,RANKING:Ic,SEEDING:"SEEDING"};function gc({element:t,accessor:e}){if("string"!=typeof e)return{values:[]};const i=me(t),n=e.split(".");let r,a=[];!function t({targetElement:e,attributes:i=[],significantCharacters:n}){for(const[r,a]of i.entries())if(e&&e[a])if(Array.isArray(e[a])){const n=e[a],o=i.slice(r);n.forEach((e=>t({targetElement:e,attributes:o})))}else o({targetElement:e=e[a],index:r});function o({targetElement:t,index:e}){if(t&&e===i.length-1&&["string","number"].includes(typeof t)){const e=n?t.slice(0,n):t;r?a.includes(e)||a.push(e):(r=e,a.push(e))}}}({targetElement:i,attributes:n});const o={value:r};return a.length&&(o.values=a),o}function yc({tournamentRecord:t,participantFilters:e,participants:i}){var n,r;let{eventIds:a}=e;const{accessorValues:o,drawEntryStatuses:s,positionedParticipants:c,eventEntryStatuses:u,participantRoles:d,participantRoleResponsibilities:l,participantTypes:p,participantIds:m,signInStatus:f,enableOrFiltering:h}=e,I=Uc(a)&&(null===(n=t.events)||void 0===n?void 0:n.filter((t=>a.includes(t.eventId))))||t.events||[],v=s&&function({drawEntryStatuses:t,tournamentEvents:e}){const i=({entryStatus:e})=>!Array.isArray(t)||t.includes(e);return J(e.reduce(((t,e)=>{var n,r;const{flightProfile:a}=Qo({event:e}),o=(null==a||null===(n=a.flights)||void 0===n?void 0:n.map((({drawEntries:t})=>Array.isArray(t)?t.filter(i).map(Ar):[])).flat())||[],s=(null===(r=e.drawDefinitions)||void 0===r?void 0:r.map((({entries:t})=>t?t.filter(i).map(Ar):[])))||[];return t.concat(...o,...s)}),[]))}({drawEntryStatuses:s,tournamentEvents:I}),g=u&&function({eventEntryStatuses:t,tournamentEvents:e}){return J(e.reduce(((e,i)=>{const n=(i.entries||[]).filter((({entryStatus:e})=>!Array.isArray(t)||t.includes(e))).map(Ar);return e.concat(...n)}),[]))}({eventEntryStatuses:u,tournamentEvents:I}),y=[!0,!1].includes(c)&&I.reduce(((t,e)=>t.concat(...(e.drawDefinitions||[]).map((t=>function({drawDefinition:t}){return t?(t.structures||[]).map((t=>{const{positionAssignments:e}=Na({structure:t});return Mr(e)})).flat():{error:mt}}({drawDefinition:t}))).filter(Boolean))),[]),U=t=>o.reduce(((e,i)=>{const{accessor:n,value:r}=i,{values:a}=gc({element:t,accessor:n});return e&&(null==a?void 0:a.includes(r))}),!0);if(i=null===(r=i)||void 0===r?void 0:r.filter((t=>{const e=lr({element:t,itemType:"SIGN_IN_STATUS"}),{participantId:i,participantType:n,participantRole:r,participantRoleResponsibilities:a}=t;return h?c&&y.includes(i)||!1===c&&!y.includes(i)||v&&v.includes(i)||g&&g.includes(i)||m&&m.includes(i)||f&&e===f||p&&Uc(p)&&p.includes(n)||d&&Uc(d)&&d.includes(r)||l&&Uc(a)&&Uc(l)&&l.find((t=>a.includes(t)))||(null==o?void 0:o.length)&&Uc(o)&&U(t):(void 0===c||c&&y.includes(i)||!1===c&&!y.includes(i))&&(!v||v.includes(i))&&(!g||g.includes(i))&&(!m||m.includes(i))&&(!f||e===f)&&(!p||Uc(p)&&p.includes(n))&&(!d||Uc(d)&&d.includes(r))&&(!l||Uc(a)&&Uc(l)&&l.find((t=>a.includes(t))))&&(!(null!=o&&o.length)||Uc(o)&&U(t))})),I.length&&a){var w;const e=I.filter((t=>a.includes(t.eventId))).map((e=>{const i=(e.entries||[]).map((t=>t.participantId));if(e.eventType===Ii)return i;const n=(t.participants||[]).filter((t=>i.includes(t.participantId))).map((t=>t.individualParticipantIds)).flat(1);return i.concat(...n)})).flat(1);i=null===(w=i)||void 0===w?void 0:w.filter((t=>e.includes(t.participantId)))}return i}function Uc(t){return t&&Array.isArray(t)&&t.length}function wc({participantFilters:t={},convertExtensions:e,policyDefinitions:i,withScheduleItems:n,tournamentRecord:r,scheduleAnalysis:a,withStatistics:o,withGroupings:s,withOpponents:c,withMatchUps:u,withEvents:d,withDraws:l,inContext:p,withISO:m}){if(!r)return{error:pt};if(!r.participants)return{error:"Missing participants"};let f=r.participants.map((t=>me(t,e)));if("object"!=typeof t)return{error:"Invalid object",participantFilters:t};var h;let I;if(p&&(null===(h=f)||void 0===h||h.forEach((t=>{[Oi,Ci,Li].includes(t.participantType)&&(t.individualParticipants=t.individualParticipantIds.map((t=>me(r.participants.find((e=>e.participantId===t)),e,!0))))}))),t&&(f=yc({tournamentRecord:r,participantFilters:t,participants:f})),n||a||o||s||c||u||d||l||m||p){const e=function(t){var e,i;const n=[],r={},a={},{tournamentRecord:o,participantFilters:s}=t,c=(null==o?void 0:o.participants)||[],{relevantParticipantIdsMap:u}=function({tournamentRecord:t,tournamentRecords:e,processParticipantId:i}){if("object"!=typeof t&&"object"!=typeof e)return{error:pt};const n=e?Object.values(e).map((({participants:t=[]})=>t)).flat():t.participants||[];return{relevantParticipantIdsMap:Object.assign({},...n.map((({participantId:t,participantType:e,individualParticipantIds:n})=>("function"==typeof i&&i(t),{[t]:(n||[]).map((t=>({relevantParticipantId:t,participantType:cc}))).concat({relevantParticipantId:t,participantType:e})}))))}}({processParticipantId:t=>{a[t]||(a[t]={groupParticipantIds:[],teamParticipantIds:[],pairParticipantIds:[],potentialMatchUps:{},scheduleItems:[],opponents:{},matchUps:{},events:{},groups:[],teams:[],draws:{},losses:0,wins:0})},tournamentRecord:o}),d=null==s?void 0:s.participantIds,l=t=>{const e=t&&u[t]||[];return e.some((t=>!d||d.includes(t.relevantParticipantId)))?e:[]};return c.forEach((t=>{if(t.participantType===Li){var e;const i=t.participantId;null==t||null===(e=t.individualParticipantIds)||void 0===e||e.forEach((e=>{a[e].groupParticipantIds.includes(i)||(a[e].groupParticipantIds.push(i),a[e].groups.push({participantRoleResponsibilities:t.participantRoleResponsibilities,participantOtherName:t.participantOtherName,participantName:t.participantName,participantId:t.participantId}))}))}if(t.participantType===ni){var i;const e=t.participantId;null==t||null===(i=t.individualParticipantIds)||void 0===i||i.forEach((i=>{a[i].teamParticipantIds.includes(e)||(a[i].teamParticipantIds.push(e),a[i].teams.push({participantRoleResponsibilities:t.participantRoleResponsibilities,participantOtherName:t.participantOtherName,participantName:t.participantName,participantId:t.participantId,teamId:t.teamId}))}))}if(t.participantType===Oi){var n;const e=t.participantId;null==t||null===(n=t.individualParticipantIds)||void 0===n||n.forEach((t=>{a[t].pairParticipantIds.includes(e)||a[t].pairParticipantIds.push(e)}))}})),null===(e=t.tournamentEvents)||void 0===e||e.forEach((t=>{var e,i,n;const s=me(t,!0,!0),{eventId:c,eventName:d,eventType:p,category:m}=s,f={eventId:c,eventName:d,eventType:p,category:m},h=s&&Object.keys(s).filter((t=>"_"===t[0]));null==h||h.forEach((t=>f[t]=s[t]));const I=s.entries||[],v=[].concat(...Object.values(He)).map((t=>`_${t}`)),g=f&&Object.keys(f).filter((t=>!v.includes(t))).reduce(((t,e)=>(t[e]=f[e],t)),{});null==I||I.filter((t=>null==t?void 0:t.participantId)).forEach((t=>{const{participantId:e,entryStage:i,entryStatus:n,entryPosition:r}=t,o=l(e);null==o||o.forEach((({relevantParticipantId:t})=>{a[t].events[c]={...g,partnerParticipantIds:[],entryPosition:r,entryStatus:n,entryStage:i,drawIds:[]}}))}));const y=(null===(e=s.drawDefinitions)||void 0===e?void 0:e.map((({drawId:t})=>t)))||[];null===(i=f._flightProfile)||void 0===i||null===(n=i.flights)||void 0===n||n.forEach((t=>{const{drawId:e,drawEntries:i}=t;y.includes(e)||null==i||i.forEach((t=>(({drawId:t,drawEntry:e,drawName:i,drawType:n})=>{const{participantId:o,entryStage:s,entryStatus:u,entryPosition:d}=e,p=l(o);null==p||p.forEach((({relevantParticipantId:e})=>{var o,l;a[e].events[c]||(a[e].events[c]={...g,partnerParticipantIds:[],entryPosition:d,entryStatus:u,entryStage:s,drawIds:[]}),a[e].draws[t]||(a[e].draws[t]={qualifyingDrawSize:null===(o=r[t])||void 0===o?void 0:o.qualifyingDrawSize,drawSize:null===(l=r[t])||void 0===l?void 0:l.drawSize,partnerParticipantIds:[],entryPosition:d,entryStatus:u,entryStage:s,drawName:i,drawType:n,eventId:c,drawId:t});const p=a[e].events[c].drawIds;!p||null!=p&&p.includes(t)||a[e].events[c].drawIds.push(t)}))})({drawId:e,drawEntry:t})))}));const{matchUps:U}=oo({tournamentRecord:o,nextMatchUps:!0,inContext:!0,event:s}),w=Object.assign({},...(s.drawDefinitions||[]).map((t=>{var e,i,n,a;const o=Object.assign({},...I.filter((t=>t.participantId)).map((t=>({[t.participantId]:t}))),...t.entries.filter((t=>t.participantId)).map((t=>({[t.participantId]:t})))),s=Object.values(o),c=kr({stageSequence:1,drawDefinition:t,stage:An}),u=c&&(null===(e=Na({structure:c}))||void 0===e||null===(i=e.positionAssignments)||void 0===i?void 0:i.length),d=kr({stageSequence:1,drawDefinition:t,stage:En}),l=c&&(null===(n=Na({structure:d}))||void 0===n||null===(a=n.positionAssignments)||void 0===a?void 0:a.length);return r[t.drawId]={drawSize:u,qualifyingDrawSize:l},{[t.drawId]:{drawType:t.drawType,drawEntries:s}}})));null==U||U.forEach((t=>function({matchUp:t,drawDetails:e,eventType:i}){const{drawId:n,drawName:o,eventId:s,eventName:c,finishingPositionRange:d,loserTo:p,matchUpId:m,matchUpType:f,matchUpFormat:h,matchUpStatus:I,roundName:v,roundNumber:g,roundPosition:y,score:U,sides:w,schedule:S,structureName:N,structureId:P,tieFormat:D,tieMatchUps:T,tournamentId:M,winnerTo:A,winningSide:E}=t,{winner:b,loser:R}=d||{},C=(null==T?void 0:T.length)&&T.filter((({matchUpType:t})=>t===ii)).map((({sides:t})=>t.map((({sideNumber:t,participantId:e})=>t&&e&&{sideNumber:t,participantId:e})))).flat().filter(Boolean);if(null==w||w.forEach((({participantId:d,sideNumber:T}={})=>{if(!d)return;const{drawType:O,drawEntries:L}=e[n],x=1===T?null==U?void 0:U.scoreStringSide1:null==U?void 0:U.scoreStringSide2,F=E&&T===E,k=t.sides.find((({sideNumber:t}={})=>t===3-T)),_=null==k?void 0:k.participantId,j=_&&u[_]||[],B=E&&(F?b:R),G=L.find((t=>t.participantId===d)),V=l(d).filter((t=>i!==ni||i===ni&&f===ii||t.participantType!==Oi));null==C||C.filter((t=>t.sideNumber===T)).forEach((({participantId:t})=>{t&&!V.includes(t)&&V.push({relevantParticipantId:t,participantType:Oi})})),null==V||V.forEach((({relevantParticipantId:t,participantType:e})=>{const{entryStage:u,entryStatus:d,entryPosition:l}=G||{};var T,b;a[t].draws[n]||(a[t].draws[n]={qualifyingDrawSize:null===(T=r[n])||void 0===T?void 0:T.qualifyingDrawSize,drawSize:null===(b=r[n])||void 0===b?void 0:b.drawSize,partnerParticipantIds:[],entryPosition:l,entryStatus:d,entryStage:u,drawName:o,drawType:O,eventId:s,drawId:n}),a[t].events[s]||(a[t].events[s]={partnerParticipantIds:[],drawIds:[],eventName:c,eventId:s});const R=a[t].events[s].drawIds;let C;if(!R||null!=R&&R.includes(n)||a[t].events[s].drawIds.push(n),e===Ri&&f===ii){const e=V.find((e=>e.relevantParticipantId!==t&&e.participantType===Ri));C=null==e?void 0:e.relevantParticipantId}null==j||j.filter((t=>e===Ri||t.participantType===e)).forEach((({relevantParticipantId:e,participantType:i})=>{a[t].opponents[e]?a[t].opponents[e].push({eventId:s,drawId:n,matchUpId:m,participantType:i,participantId:e}):a[t].opponents[e]=[{eventId:s,drawId:n,matchUpId:m,participantType:i,participantId:e}]}));const L=j.map((({relevantParticipantId:t,participantType:e})=>({participantId:t,participantType:e})));a[t].matchUps[m]=fe({drawId:n,eventId:s,eventType:i,finishingPositionRange:B,loserTo:p,matchUpId:m,matchUpType:f,matchUpFormat:h,matchUpStatus:I,opponentParticipantInfo:L,participantWon:F,partnerParticipantId:C,perspectiveScoreString:x,roundName:v,roundNumber:g,roundPosition:y,schedule:S,score:U,sides:w,structureName:N,structureId:P,tieFormat:D,tournamentId:M,winnerTo:A,winningSide:E}),C&&(a[t].events[s].partnerParticipantIds.push(C),a[t].draws[n].partnerParticipantIds.push(C),a[t].events[s].partnerParticipantId=C,a[t].draws[n].partnerParticipantId=C),E&&(F?a[t].wins++:a[t].losses++)}))})),Array.isArray(t.potentialParticipants)){const e=Mr(t.potentialParticipants.flat());null==e||e.forEach((t=>{const e=l(t);null==e||e.forEach((({relevantParticipantId:t})=>{a[t].potentialMatchUps[m]=fe({drawId:n,eventId:s,eventType:i,matchUpId:m,matchUpType:f,matchUpFormat:h,roundName:v,roundNumber:g,roundPosition:y,schedule:S,tieFormat:D,structureName:N,potential:!0})}))}))}}({matchUp:t,drawDetails:w,eventType:p})))})),null===(i=t.tournamentParticipants)||void 0===i||i.forEach((e=>{const{scheduleConflicts:i,scheduleItems:r}=function({withEvents:t=!0,withDraws:e=!0,participantIdMap:i,scheduleAnalysis:n,withStatistics:r,withOpponents:a,withMatchUps:o,participant:s,withISO:c}){var u;const d=[],l=[];c&&za({participant:s});const p=null===(u=s.timeItems)||void 0===u?void 0:u.filter((({itemType:t})=>t.startsWith(fc)&&[Ic,hc].includes(t.split(".")[1])));if(null!=p&&p.length){const t=t=>p.filter((e=>(null==e?void 0:e.itemType)===t)).sort(((t,e)=>new Date(t.createdAt||void 0)-new Date(e.createdAt||void 0))).pop();for(const e of J(p.map((({itemType:t})=>t)))){const i=t(e);if(i){const[,t,e,n]=i.itemType.split("."),r=t===Ic?"rankings":"ratings";s[r]||(s[r]={}),s[r][e]||(s[r][e]=[]),s[r][e].push({scaleValue:i.itemValue,scaleName:n})}}}const m=null==s?void 0:s.participantId;if(!m||!i[m])return{};const{wins:f,losses:h,matchUps:I,potentialMatchUps:v,events:g,draws:U,opponents:w}=i[m],S=f+h,N={statCode:"winRatio",numerator:f,denominator:S,statValue:S&&f/S},P=Object.values(U),D=Object.values(g);e&&P&&(s.draws=P),t&&D&&(s.events=D);const T=Object.values(w).flat();a&&null!=T&&T.length&&(s.opponents=T,null==P||P.forEach((t=>{t.opponents=T.filter((e=>e.drawId===t.drawId))})));const M=Object.values(v),A=Object.values(I);o&&(s.potentialMatchUps=M,s.matchUps=A);const E=A.concat(M),{scheduledMatchUps:b}=ac({matchUps:E}),{scheduledMinutesDifference:R}=n||{};return Object.keys(b).forEach((t=>{b[t].forEach(((e,i)=>{const{schedule:{scheduledTime:n,timeAfterRecovery:r,typeChangeTimeAfterRecovery:a},matchUpStatus:o,matchUpId:s,roundNumber:c,roundPosition:u,structureName:p,matchUpType:m,drawId:f}=e;if(d.push({drawId:f,matchUpType:m,matchUpId:s,structureName:p,roundNumber:c,roundPosition:u,...e.schedule,scheduledTime:ie(e.schedule.scheduledTime)}),n&&o!==y){const c=te(n),u=b[t].slice(i+1);for(const t of u){var h;if(o!==y&&null!==(h=t.schedule)&&void 0!==h&&h.scheduledTime){const i=e.matchUpType!==t.matchUpType&&a||r,n=e.drawId===t.drawId,o=e.potential&&t.potential,u=te(t.schedule.scheduledTime)-c;!(R&&!isNaN(R)?u<=R:te(i)>te(t.schedule.scheduledTime))||o&&n||l.push({priorScheduledMatchUpId:t.matchUpId,matchUpIdWithConflict:s})}}}}))})),null==P||P.forEach((t=>{const e=I&&A.filter((e=>e.drawId===t.drawId))||[],i=t=>Math.abs(t[0]-t[1]),n=e.reduce(((t,e)=>t?t&&e.finishingPositionRange&&i(t)>i(e.finishingPositionRange)?e.finishingPositionRange:t:e.finishingPositionRange),void 0);t.finishingPositionRange=n})),r&&(s.statistics=[N]),{scheduleConflicts:l,scheduleItems:d}}({...t,participant:e,participantIdMap:a});if(t.withScheduleItems&&(e.scheduleItems=r),t.scheduleAnalysis&&(e.scheduleConflicts=i,null!=i&&i.length&&(n.includes(e.participantId)||n.push(e.participantId))),!1!==t.withGroupings){const t=a[e.participantId];e.groupParticipantIds=t.groupParticipantIds,e.pairParticipantIds=t.pairParticipantIds,e.teamParticipantIds=t.teamParticipantIds,e.groups=t.groups,e.teams=t.teams}})),{participantIdsWithConflicts:n}}({tournamentEvents:r.events,tournamentParticipants:f,participantFilters:t,withScheduleItems:n,tournamentRecord:r,scheduleAnalysis:a,withStatistics:o,withGroupings:s,withOpponents:c,withMatchUps:u,withEvents:d,withDraws:l,withISO:m});I=null==e?void 0:e.participantIdsWithConflicts}const v=null==i?void 0:i.participant;return null!=v&&v.participant&&(f=f.map((t=>Y({source:t,template:v.participant})))),{tournamentParticipants:f,participantIdsWithConflicts:I}}function Sc(t,e,i){return!t&&e?e:t&&!e||"object"!=typeof t||"object"!=typeof e?t:J(Object.keys(t).concat(Object.keys(e))).reduce(((n,r)=>{if(e[r])if(t[r])if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(!0===i||Array.isArray(i)&&i.includes(r)){const i=J(t[r].map((t=>JSON.stringify(t))).concat(e[r].map((t=>JSON.stringify(t))))).map((t=>JSON.parse(t)));n[r]=i}else n[r]=e[r];else"object"==typeof t[r]?n[r]=Sc(t[r],e[r],i):n[r]=e[r];else n[r]=e[r];else n[r]=t[r];return n}),{})}function Nc(t){return{tournamentIds:Object.keys(t).filter(Boolean)}}const Pc=({penaltyId:t=ve()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t});function Dc({tournamentRecord:t,participantIds:e,penaltyCode:i,penaltyType:n,penaltyId:r,matchUpId:a,notes:o,extensions:s,issuedAt:c,refereeParticipantId:u}){if(!t)return{error:pt};if(!e)return{error:"Missing participantId"};if(!n)return{error:"Missing penaltyType"};const d=((null==t?void 0:t.participants)||[]).filter((t=>e.includes(t.participantId)));if(!d.length)return{error:"Participant Not Found"};const l=(new Date).toISOString(),p=Object.assign(Pc({penaltyId:r}),{refereeParticipantId:u,penaltyCode:i,penaltyType:n,matchUpId:a,notes:o,issuedAt:c,createdAt:l});return Array.isArray(s)&&s.forEach((t=>jr({element:p,extension:t}))),d.forEach((t=>{t.penalties||(t.penalties=[]),t.penalties.push(p)})),At({topic:"modifyParticipants",payload:{participants:d}}),{...ut,penaltyId:p.penaltyId}}function Tc({tournamentRecord:t,penaltyId:e}){if(!t)return{error:pt};if(!e)return{error:"Missing penaltyId"};const i=(null==t?void 0:t.participants)||[],n=[];let r,a=!1;return i.forEach((t=>{let i=!1;t.penalties=(t.penalties||[]).filter((o=>(o.penaltyId===e&&(i=!0,a||(r=o,a=!0)),i&&n.push(t),o.penaltyId!==e)))})),r&&At({topic:"modifyParticipants",payload:{participants:n}}),r?{...ut,penalty:r}:{error:"Penalty not found"}}function Mc({tournamentRecord:t}){if(!t)return{error:pt};const e=((null==t?void 0:t.participants)||[]).reduce(((t,e)=>{const{participantId:i}=e;return(e.penalties||[]).forEach((e=>{const{penaltyId:n}=e||{};t[n]?t[n].participants.push(i):t[n]={...e,participantIds:[i]}})),t}),{});return{penalties:Object.values(e)}}function Ac({tournamentRecord:t,penaltyId:e,modifications:i}){if(!t)return{error:pt};if(!i)return{error:gt,modifications:i};if(!e)return{error:"Missing penaltyId"};const n=(null==t?void 0:t.participants)||[],r=Object.keys(Pc()).filter((t=>"penaltyId"!==t)),a=Object.keys(i).filter((t=>r.includes(t)));if(!a.length)return{error:"No valid attributes"};let o;const s=[];return n.forEach((t=>{let n=!1;t.penalties=(t.penalties||[]).map((t=>(t.penaltyId===e&&(n=!0,a.forEach((e=>Object.assign(t,{[e]:i[e]}))),o||(o=t)),t))),n&&s.push(t)})),o&&At({topic:"modifyParticipants",payload:{participants:s}}),o?{...ut,penalty:o}:{error:"Penalty not found"}}const Ec={addExtension:To,findExtension:Mo,removeExtension:Ao,addEventExtension:function({tournamentRecords:t,eventId:e,extension:i}){if("string"!=typeof e)return{error:ht};if(!_r(i))return{error:gt};for(const n of Object.values(t)){const{event:t}=ui({tournamentRecord:n,eventId:e});if(t)return Hr({event:t,extension:i})}return{error:"Event not found"}},linkTournaments:function({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const{tournamentIds:e,error:i}=Nc(t);return i?{error:i}:(null==e?void 0:e.length)>1?To({tournamentRecords:t,extension:{name:"linkedTournamentsIds",value:{tournamentIds:e}}}):ut},unlinkTournament:function({tournamentRecords:t,tournamentId:e}){if("object"!=typeof t)return{error:gt};if(!e)return{error:"Missing tournamentId"};const{tournamentIds:i,error:n}=Nc(t);if(n)return{error:n};if(!i.includes(e))return{error:"Missing tournamentId"};let r;return i.every((i=>{var n;const a=t[i],{extension:o}=Ze({tournamentRecord:a,name:"linkedTournamentsIds"});if(!o)return!0;let s=(null==o||null===(n=o.value)||void 0===n?void 0:n.tournamentIds)||[];if(null==s||!s.length||1===s.length&&s.includes(e)||i===e){const t=qr({tournamentRecord:a,name:"linkedTournamentsIds"});return t.error&&(r=t.error),t.success}const c=s.filter((t=>t!==e));o.value={tournamentIds:c};const u=Gr({tournamentRecord:a,extension:o});return u.error&&(r=u.error),u.success})),r?{error:r}:{...ut}},unlinkTournaments:function({tournamentRecords:t}){return"object"==typeof t&&Object.keys(t).length?Ao({tournamentRecords:t,name:"linkedTournamentsIds"}):{error:"Missing tournamentRecords"}},getLinkedTournamentIds:function({tournamentRecords:t}){return"object"==typeof t&&Object.keys(t).length?{linkedTournamentIds:Object.assign({},...Object.keys(t).map((e=>{var i;const n=t[e],r=null==n?void 0:n.tournamentId,{extension:a}=Ze({tournamentRecord:n,name:"linkedTournamentsIds"});return{[e]:((null==a||null===(i=a.value)||void 0===i?void 0:i.tournamentIds)||[]).filter((t=>t!==r))}})))}:{error:"Missing tournamentRecords"}},addDrawDefinition:function({tournamentRecords:t,drawDefinition:e,tournamentId:i,eventId:n,flight:r,existingDrawCount:a}){if(!n)return{error:ht};if(!(i=i||fo({tournamentRecords:t,eventId:n})))return{error:"Missing tournamentId"};const o=t[i];if(!o)return{error:pt};const{event:s,error:c}=ui({tournamentRecord:o,eventId:n});return c?{error:c}:tc({drawDefinition:e,event:s,flight:r,existingDrawCount:a})},getCompetitionParticipants:function(t){const{tournamentRecords:e}=t||{};if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};let i=[];const n=[],r=[];for(const a of Object.values(e)){const{tournamentParticipants:e,participantIdsWithConflicts:o}=wc({tournamentRecord:a,...t});for(const t of e){const{participantId:e}=t;n.includes(e)?i=i.map((i=>i.participantId!==e?i:Sc(i,t,!0))):(n.push(e),i.push(t))}o&&o.forEach((t=>{r.includes(t)||r.push(t)}))}return{competitionParticipants:i,participantIdsWithConflicts:r}},addParticipant:function({tournamentRecords:t,returnParticipant:e,pairOverride:i,tournamentId:n,participant:r}){if("string"!=typeof n)return{error:"Missing tournamentId"};const a=t[n];return a?ic({returnParticipant:e,tournamentRecord:a,pairOverride:i,participant:r}):{error:pt}},setMatchUpStatus:function(t){const e=t.tournamentRecords,i=t.tournamentId||fo(t);if("string"!=typeof i)return{error:"Missing tournamentId"};const n=e[i];if(!n)return{error:pt};const{drawDefinition:r,event:a}=ui({eventId:t.eventId,drawId:t.drawId,tournamentRecord:n});return js({tournamentRecord:n,...t,drawDefinition:r,event:a})},bulkMatchUpStatusUpdate:function(t){const{tournamentRecords:e,outcomes:i}=t;if(!Array.isArray(i))return{error:It};const n=i.reduce(((t,e)=>t.includes(e.tournamentId)?t:t.concat(e.tournamentId)),[]);for(const r of n){const t=e[r];if(!t)return{error:pt};const n=i.filter((t=>t.tournamentId===r));if(n.length){const e=Bs({tournamentRecord:t,outcomes:n});if(e.error)return e}}return{...ut}},bulkScheduleMatchUps:function({tournamentRecords:t,matchUpContextIds:e,schedule:i}){if(!t)return{error:"Missing tournamentRecords"};if(!Array.isArray(e))return{error:gt};for(const n of Object.values(t)){const{tournamentId:t}=n,r=e.filter((e=>e.tournamentId===t)).map(br);if(null!=r&&r.length){const t=po({tournamentRecord:n,matchUpIds:r,schedule:i});if(t.error)return t}}return ut},addVenue:function({tournamentRecords:t,venue:e,disableNotice:i}){if("object"!=typeof e)return{error:gt};e.venueId||(e.venueId=ve());for(const n of Object.values(t)){const t=ec({tournamentRecord:n,returnDetails:!0,disableNotice:!0,venue:e});if(null!=t&&t.error)return t}return i||At({topic:"addVenue",payload:{venue:e}}),ut},deleteVenue:function({tournamentRecords:t,venueId:e,force:i}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof e)return{error:"Missing venueId"};let n;for(const r of Object.values(t)){const t=Xs({tournamentRecord:r,venueId:e,force:i});if(t.error&&"Venue not found"!==t.error)return t;n=!0}return Oo({tournamentRecords:t}),n?ut:{error:"Venue not found"}},modifyVenue:function({tournamentRecords:t,modifications:e,venueId:i,force:n}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof i)return{error:"Missing venueId"};let r,a;for(const o of Object.values(t)){const t=Zs({tournamentRecord:o,modifications:e,venueId:i,force:n});if(t.success&&(a=!0),t.error&&(r=t.error),t.error&&"Venue not found"!==t.error)return t}return Oo({tournamentRecords:t}),a?{...ut}:{error:r}},addCourts:function(t){const{tournamentRecords:e,venueId:i}=t;if("string"!=typeof i||!i)return{error:"Missing venueId"};let n;for(const r of Object.values(e)){const{venue:e}=wi({tournamentRecord:r,venueId:i});if(e){const e=Js({tournamentRecord:r,...t});if(e.error)return e;n=!0}}return n?ut:{error:"Venue not found"}},addPenalty:function(t){const{tournamentRecords:e,participantIds:i}=t;let n;for(const r of Object.values(e)){const{tournamentParticipants:e}=wc({tournamentRecord:r}),a=Mr(e).filter((t=>i.includes(t)));a.length&&(n=Dc({...t,penaltyId:t.penaltyId||n,tournamentRecord:r,participantIds:a}).penaltyId)}return n?{...ut,penaltyId:n}:{error:"Participant Not Found"}},removePenalty:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};for(const i of Object.values(e)){const e=Tc({tournamentRecord:i,...t});if(e.error&&"Penalty not found"!==e.error)return e}return{...ut}},modifyPenalty:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};for(const i of Object.values(e)){const e=Ac({tournamentRecord:i,...t});if(e.error&&"Penalty not found"!==e.error)return e}return{...ut}},getCompetitionPenalties:function({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const e=[];for(const i of Object.values(t)){const{penalties:t}=Mc({tournamentRecord:i});e.push(...t)}return{penalties:e}},findParticipant:function({tournamentRecords:t,participantId:e,personId:i,policyDefinitions:n,inContext:r}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof e&&"string"!=typeof i)return{error:It};let a;for(const o of Object.values(t)){const{tournamentParticipants:t}=wc({tournamentRecord:o,policyDefinitions:n,inContext:r});if(a=Ye({tournamentParticipants:t,participantId:e,personId:i,policyDefinitions:n}),a)break}return{participant:me(a,!1,!0)}}};function bc(){const{topics:t}=Rt();for(const e of t){const t=Et({topic:e});t&&Ct({topic:e,notices:t})}}function Rc({tournamentRecord:t,matchUpFormat:e,event:i}){if(!t)return{error:pt};if(!h(e))return{error:"Unrecognized matchUpFormat"};const{extension:n}=Qe({event:i,name:"scheduleTiming"}),r=null==n?void 0:n.value,{extension:a}=Ze({tournamentRecord:t,name:"scheduleTiming"}),o=null==a?void 0:a.value;return{matchUpFormat:e,averageTimes:[(null==r?void 0:r.matchUpAverageTimes)&&Ge({...r,matchUpFormat:e}),(null==o?void 0:o.matchUpAverageTimes)&&Ge({...o,matchUpFormat:e})].find((t=>t)),recoveryTimes:[(null==r?void 0:r.matchUpRecoveryTimes)&&Ve({...r,matchUpFormat:e}),(null==o?void 0:o.matchUpRecoveryTimes)&&Ve({...o,matchUpFormat:e})].find((t=>t))}}function Cc({tournamentRecord:t,matchUpFormat:e,averageTimes:i,recoveryTimes:n,event:r}){if(!t)return{error:pt};if(i&&!Array.isArray(i))return{error:gt};if(n&&!Array.isArray(n))return{error:gt};const a="scheduleTiming";if(r){const{extension:t}=Qe({event:r,name:a});Hr({event:r,extension:{name:a,value:Oc({...(null==t?void 0:t.value)||{},matchUpFormat:e,averageTimes:i,recoveryTimes:n})}})}else{const{extension:r}=Ze({tournamentRecord:t,name:a});Gr({tournamentRecord:t,extension:{name:a,value:Oc({...(null==r?void 0:r.value)||{},matchUpFormat:e,averageTimes:i,recoveryTimes:n})}})}return ut}function Oc({matchUpAverageTimes:t=[],matchUpRecoveryTimes:e=[],averageTimes:i,recoveryTimes:n,matchUpFormat:r}){var a,o;const s=(null===(a=i=(i||[]).filter((t=>{var e,i;return(null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length)||(null==t||null===(i=t.categoryTypes)||void 0===i?void 0:i.length)})))||void 0===a?void 0:a.length)&&t.map((t=>{var e;return null!=t&&t.matchUpFormatCodes.includes(r)?{...t,matchUpFormatCodes:null===(e=t.matchUpFormatCodes)||void 0===e?void 0:e.filter((t=>t!==r))}:t})).filter((({matchUpFormatCodes:t})=>null==t?void 0:t.length)).concat({matchUpFormatCodes:[r],averageTimes:i}),c=(null===(o=n=(n||[]).filter((t=>{var e,i;return(null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length)||(null==t||null===(i=t.categoryTypes)||void 0===i?void 0:i.length)})))||void 0===o?void 0:o.length)&&e.map((t=>{var e;return null!=t&&t.matchUpFormatCodes.includes(r)?{...t,matchUpFormatCodes:null===(e=t.matchUpFormatCodes)||void 0===e?void 0:e.filter((t=>t!==r))}:t})).filter((({matchUpFormatCodes:t,averageTimes:e})=>(null==t?void 0:t.length)||e)).concat({matchUpFormatCodes:[r],recoveryTimes:n});return{matchUpAverageTimes:(null==s?void 0:s.length)&&s||t,matchUpRecoveryTimes:(null==c?void 0:c.length)&&c||e}}function Lc({tournamentRecord:t,event:e,categoryType:i,matchUpFormat:n,averageMinutes:r,recoveryMinutes:a}){if(!t)return{error:pt};if(!h(n))return{error:gt};if(!e)return{error:ht};const{averageTimes:o=[],recoveryTimes:s=[]}=Rc({tournamentRecord:t,matchUpFormat:n,event:e}),c=e.category,u=(null==c?void 0:c.categoryName)||(null==c?void 0:c.ageCategoryCode),d="DOUBLES"===e.eventType;let l={categoryNames:[u],minutes:{}},p={categoryNames:[u],minutes:{}};const m=t=>{var e,n;if(null!==(e=t.categoryTypes)&&void 0!==e&&e.includes(i)&&console.log("encountered:",{categoryType:i}),null===(n=t.categoryNames)||void 0===n||!n.includes(u)||(t.categoryNames=t.categoryNames.filter((t=>t!==u)),l={minutes:t.minutes,categoryNames:[u]},t.categoryNames.length))return t},f=!isNaN(parseInt(r)),I=!isNaN(parseInt(a)),v=o.map(m).filter((t=>{var e;return null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length})),g=s.map(m).filter((t=>{var e;return null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length}));return f&&(Object.assign(l.minutes,{[d?vi:ei]:r}),v.push(l)),I&&(Object.assign(p.minutes,{[d?vi:ei]:a}),g.push(p)),f||I?Cc({tournamentRecord:t,event:e,matchUpFormat:n,averageTimes:f&&v,recoveryTimes:I&&g}):{error:gt}}function xc({tournamentRecords:t,extensionName:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const i=[];let n;for(const r of Object.values(t)){const{extension:t}=Ze({tournamentRecord:r,name:e});t&&!n&&(i.push({method:"addExtension",params:{extension:t}}),n=!0);const a=r.events||[];for(const n of a){const{eventId:t}=n,{extension:r}=Qe({event:n,name:e});r&&i.push({method:"addEventExtension",params:{eventId:t,extension:r}})}}return{methods:i}}function Fc({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!t)return{error:pt};if(!n)return{error:ht};let r=[];if(null!=e&&e.length){const t=[];r=e.map((e=>{let i="string"==typeof e?{matchUpFormat:e}:e;if(!t.includes(null==i?void 0:i.matchUpFormat)&&h(null==i?void 0:i.matchUpFormat))return t.push(i.matchUpFormat),i})).filter(Boolean)}else{const{policy:e}=Ke({policyType:"scoring",tournamentRecord:t,event:n});if(null!=e&&e.matchUpFormats)r=null==e?void 0:e.matchUpFormats;else{const{extension:t}=Qe({name:"scheduleTiming",event:n});if(null==t||!t.value)return{error:"Missing scoring policy / matchUpFormats"};r=J([...(t.value.matchUpAverageTimes||[]).map((t=>t.matchUpFormatCodes)),...(t.value.matchUpRecoveryTimes||[]).map((t=>t.matchUpFormatCodes))].flat()).map((t=>({matchUpFormat:t})))}}const{eventType:a,eventId:o,category:s}=n,c=null==s?void 0:s.categoryName;return o?{eventMatchUpFormatTiming:r.map((({matchUpFormat:e,description:r})=>{const o=si({tournamentRecord:t,matchUpFormat:e,categoryName:c,categoryType:i,eventType:a,event:n});return Object.assign({},{...o,description:r,matchUpFormat:e})}))}:{error:ht}}function kc({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,drawId:r,event:a}){var o,s,c;if(!t)return{error:pt};if(!(r||a||i||n))return{error:It};const u=lo({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:r,event:a});if(n&&null!=u&&u.error)return u;!e&&null!=u&&u.drawDefinition&&(e=null==u?void 0:u.drawDefinition);let d=null==u?void 0:u.structure;if(!d&&i&&!n){if(!e)return{error:"Missing drawId"};const t=Fr({drawDefinition:e,structureId:i});if(t.error)return t;d=t.structure}const l=null===(o=d)||void 0===o?void 0:o.matchUpFormat,p=null===(s=e)||void 0===s?void 0:s.matchUpFormat,m=null==a?void 0:a.matchUpFormat;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:m,drawDefaultMatchUpFormat:p,matchUpFormat:(null==u||null===(c=u.matchUp)||void 0===c?void 0:c.matchUpFormat)||l||p||m}}function _c({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,tournamentId:n,matchUpFormat:r,categoryName:a,categoryType:o,eventType:s,eventId:c}){var u,d,l,p;if(!h(r))return{error:"Unrecognized matchUpFormat"};let m;return Object.keys(i).filter((t=>!n||t===n)).find((t=>{var e,n,u;const d=i[t],l=c&&(null===(e=ui({tournamentRecord:d,eventId:c}))||void 0===e?void 0:e.event);return m=si({tournamentRecord:d,event:l,matchUpFormat:r,categoryName:a,categoryType:o,eventType:s}),(null===(n=m)||void 0===n?void 0:n.averageMinutes)||(null===(u=m)||void 0===u?void 0:u.recoveryMinutes)})),{averageMinutes:(null===(u=m)||void 0===u?void 0:u.averageMinutes)||e,recoveryMinutes:(null===(d=m)||void 0===d?void 0:d.recoveryMinutes)||t,typeChangeRecoveryMinutes:(null===(l=m)||void 0===l?void 0:l.typeChangeRecoveryMinutes)||(null===(p=m)||void 0===p?void 0:p.recoveryMinutes)||t}}function jc({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:i,periodLength:n=30,matchUps:r,rounds:a}){if("object"!=typeof i)return{error:"Missing tournamentRecords"};if(!Array.isArray(a))return{error:It};const o=[],s=a.sort(((t,e)=>(t.sortOrder||0)-(e.sortOrder||0)));e=e||Object.assign({},...Object.values(i).map((t=>hs({tournamentRecord:t}).containedStructures))),r||({matchUps:r}=xo({tournamentRecords:i,nextMatchUps:!0}));const c={},u={},d={};let l=0;return{scheduledRoundsDetails:s.map((a=>{var s,p,m;const f=a.periodLength||n,h=e[a.structureId]||[a.structureId],I={tournamentIds:[a.tournamentId],roundNumbers:[a.roundNumber],matchUpIds:a.matchUpIds,eventIds:[a.eventId],drawIds:[a.drawId],structureIds:h};let v=Ea({matchUps:r,processContext:!0,...I}).sort(_o);const{segmentNumber:g,segmentsCount:U}=a.roundSegment||{};if(z(g)&&G(null===(s=v)||void 0===s?void 0:s.length)&&G(U)&&g>0&&g<=U&&U<(null===(p=v)||void 0===p?void 0:p.length)&&(null===(m=a.matchUpIds)||void 0===m||!m.length)){const t=v.length/U,e=t*(g-1);v=v.slice(e,e+t)}const w=i[a.tournamentId],{drawDefinition:S,event:N}=ui({drawId:a.drawId,tournamentRecord:w}),{matchUpFormat:P}=kc({structureId:a.structureId,tournamentRecord:w,drawDefinition:S,event:N}),{eventType:D,category:T}=N||{},{categoryName:M,ageCategoryCode:A}=T||{},{typeChangeRecoveryMinutes:E,recoveryMinutes:b,averageMinutes:R,error:C}=_c({tournamentRecords:i,categoryName:M||A,tournamentId:a.tournamentId,eventId:a.eventId,matchUpFormat:P,eventType:D});if(C)return{error:C,round:a};const O=v.filter((({matchUpStatus:e})=>(t||!x.includes(e))&&e!==y)).map(br);return O.forEach((t=>{c[t]={typeChangeRecoveryMinutes:E,recoveryMinutes:b,averageMinutes:R},u[t]=b,d[t]=R})),o.push(...O),l=Math.max(R||0,l),{roundPeriodLength:f,recoveryMinutes:b,averageMinutes:R,matchUpIds:O,hash:`${R}|${f}`}})),greatestAverageMinutes:l,recoveryMinutesMap:u,averageMinutesMap:d,orderedMatchUpIds:o,minutesMap:c,...ut}}function Bc({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=60,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,periodLength:a=30,tournamentRecords:o,scheduleDate:s,startTime:c,venueIds:u,endTime:d}){if("object"!=typeof o||!Object.keys(o).length)return{error:"Missing tournamentRecords"};const{courts:l,venues:p}=Po({tournamentRecords:o}),m=l.filter((t=>!u||u.includes(t.venueId)));c||(c=m.reduce(((t,e)=>{var i;const n=null===(i=e.dateAvailability)||void 0===i?void 0:i.find((t=>!t.date||le(s,t.date))),r=(null==n?void 0:n.startTime)||e.startTime;return r&&(!t||te(r)<te(t))?r:t}),void 0)),d||(d=m.reduce(((t,e)=>{var i;const n=null===(i=e.dateAvailability)||void 0===i?void 0:i.find((t=>!t.date||le(s,t.date))),r=(null==n?void 0:n.endTime)||e.endTime;return r&&(!t||te(r)>te(t))?r:t}),void 0));const f=Object.assign({},...Object.values(o).map((t=>(t.events||[]).map((e=>{const{scheduleTiming:i}=ti({tournamentRecord:t,event:e});return{[e.eventId]:{event:e,scheduleTiming:i}}})))).flat()),h=Fo({tournamentRecords:o,sortDateMatchUps:!1,matchUpFilters:{scheduledDate:s,venueIds:u}}),I=[].concat(...h.dateMatchUps||[],...h.completedMatchUps||[]),v={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},g=null==I?void 0:I.map((({eventId:t,schedule:e,matchUpFormat:i})=>{const{event:n,scheduleTiming:r}=f[t],o=null==n?void 0:n.eventType,s={...r,defaultTiming:v,matchUpFormat:i},{averageMinutes:c,recoveryMinutes:u}=ci({eventType:o,timingDetails:s}),{courtId:d,venueId:l}=e,p=ie(e.scheduledTime),m=ce(p,c);return{averageMinutes:c,recoveryMinutes:u,periodLength:a,startTime:p,endTime:m,courtId:d,venueId:l}})),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:a,startTime:c,endTime:d,bookings:g,courts:m},{scheduleTimes:U}=sr(y);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==p?void 0:p.length)?p[0].venueId:void 0,scheduleTimes:U,dateScheduledMatchUpIds:I.map(br)}}function Gc({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function Vc({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){const{matchUpType:r}=i,{individualParticipantIds:a}=yo(i),o=(t[i.matchUpId]||[]).filter((t=>!ot(t,a))).flat();[...a,...o].forEach((t=>{if(Gc({individualParticipantProfiles:e,participantId:t}),!e[t].potentialCounted[i.drawId]){const a=e[t].counters;a[r]?a[r]+=n:n>0&&(a[r]=n),a[ai]?a[ai]+=n:n>0&&(a[ai]=n),o.includes(t)&&(e[t].potentialCounted[i.drawId]=!0)}}))}function Hc({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var r;const a=((null==e||null===(r=e[n.matchUpId])||void 0===r?void 0:r.matchUpIds)||[]).filter((t=>i.includes(t))).filter((e=>!t[e]));return{dependenciesScheduled:!(null!=a&&a.length),remainingDependencies:a}}function qc({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var r,a,o,s;const{individualParticipantIds:c}=yo(n);i=i||(null===(r=n.schedule)||void 0===r?void 0:r.timeAfterRecovery);const u=e=>{t[e]||(t[e]=[]),t[e]=J(t[e].concat(...c))},d=t=>{(!e[t]||i>e[t])&&(e[t]=i)},l=(null===(a=n.winnerTo)||void 0===a?void 0:a.matchUpId)||n.winnerMatchUpId;l&&(i&&d(l),u(l));const p=(null===(o=n.loserTo)||void 0===o?void 0:o.matchUpId)||n.loserMatchUpId;p&&(i&&d(p),u(p)),null!==(s=n.sidesTo)&&void 0!==s&&s.length&&n.sidesTo.forEach((({matchUpId:t})=>{t&&(i&&d(t),u(t))}))}function Wc({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:i,matchUpDependencies:n,averageMatchUpMinutes:r=0,typeChangeRecoveryMinutes:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:c}){var u,d;const l=ie(null==c||null===(u=c.schedule)||void 0===u?void 0:u.endTime),p=l?ce(l,parseInt(o)):ce(s,parseInt(r)+parseInt(o)),m=a&&(l?ce(ie(l),a):ce(s,parseInt(r)+parseInt(a))),f=(null==n||null===(d=n[c.matchUpId])||void 0===d?void 0:d.participantIds)||[],h=(c.roundPosition&&e[c.matchUpId]||[]).flat();f.forEach((e=>{Gc({individualParticipantProfiles:t,participantId:e});const i=t[e].priorMatchUpType!==c.matchUpType&&m||p;h.includes(e)?function({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}({individualParticipantProfiles:t,drawId:c.drawId,recoveryValue:i,participantId:e,scheduleTime:s}):(t[e].timeAfterRecovery=i,t[e].bookings.push({scheduleTime:s,timeAfterRecovery:i}))})),qc({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:i,timeAfterRecovery:p,matchUp:c})}function zc({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var a,o,s,c,u;let d;const l=null===(a=r.minutesMap)||void 0===a||null===(o=a[n])||void 0===o?void 0:o.recoveryMinutes,p=ce(i,((null===(s=r.minutesMap)||void 0===s||null===(c=s[n])||void 0===c?void 0:c.averageMinutes)||0)+(l||0)),m=(null==e||null===(u=e[n])||void 0===u?void 0:u.dependentMatchUpIds)||[];if(m.length){const e=m.reduce(((e,i)=>{const n=t[i];if(!n)return e;const r={scheduleTime:n,matchUpId:i};return n&&!e.matchUpId||te(n)<te(e.scheduleTime)?r:e}),{});e.scheduleTime&&te(p)>te(e.scheduleTime)&&(d=e)}return{scheduledDependent:d}}function Kc({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:o}){const s=function(t){const{sides:e,matchUpType:i}=t||{};return(e||[]).map((t=>{var e;return i===ii?(null==t||null===(e=t.participant)||void 0===e?void 0:e.individualParticipants)||[]:null!=t&&t.participant?[t.participant]:[]})).flat()}(o).map((({person:t})=>null==t?void 0:t.personId));if(i){const t=((null==o?void 0:o.potentialParticipants)||[]).flat().map((({person:t})=>null==t?void 0:t.personId));s.push(...t)}const c=s.map((t=>{var e;return null===(e=n[t])||void 0===e?void 0:e.map((e=>({...e,personId:t})))})).filter(Boolean).flat().filter((t=>"DO_NOT_SCHEDULE"===t.requestType&&le(a,t.date))),u=[],d=null==o?void 0:o.matchUpId,l=oe(ie(r),ne(a)),p=ie(ue(l,t).toISOString());for(const m of c){const{requestId:t,startTime:i,endTime:n}=m;(r>i&&r<n||p>i&&p<n)&&(u.push({matchUpId:d,request:m,scheduleTime:r}),e[t]?(e[t].scheduleTimes.includes(r)||e[t].scheduleTimes.push(r),e[t].matchUpIds.includes(d)||e[t].matchUpIds.push(d)):e[t]={request:m,scheduleTimes:[r],matchUpIds:[d]})}return{conflicts:u}}function Yc({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var o,s,c,u,d;const l=((null==i||null===(o=i[r.matchUpId])||void 0===o?void 0:o.participantIds)||[]).flat(),p=(null==a||null===(s=a.minutesMap)||void 0===s||null===(c=s[r.matchUpId])||void 0===c?void 0:c.averageMinutes)||0,m=(null==a||null===(u=a.minutesMap)||void 0===u||null===(d=u[r.matchUpId])||void 0===d?void 0:d.recoveryMinutes)||0,f=l.every((e=>{var i;Gc({individualParticipantProfiles:t,participantId:e});let a=t[e];if(!a.timeAfterRecovery)return!0;const o=ie(null==r||null===(i=r.schedule)||void 0===i?void 0:i.endTime),s=o?ce(o,parseInt(m)):ce(n,parseInt(p)+parseInt(m));return![...Object.keys(a.potentialBookings).filter((t=>t!==r.drawId)).map((t=>a.potentialBookings[t])).flat(),...a.bookings].find((t=>function(t,e){const i=te(t.scheduleTime),n=te(t.timeAfterRecovery),r=te(e.scheduleTime),a=te(e.timeAfterRecovery),o=i>r&&i<a,s=r>i&&r<n,c=n>r&&n<a,u=a>i&&a<n;return fe({hasOverlap:i===r||n===a||o||c||s||u,startAisContained:o,endAisContained:c,startBisContained:s,endBisContained:u},!0)}({scheduleTime:n,timeAfterRecovery:s},t).hasOverlap))})),h=e[r.matchUpId],I=h?se(oe(h),oe(n),!1):0;return{enoughTime:f&&I>=0}}function $c({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n,r,a,o,s=[],c=[];for(const u of t)n||(n=u.hash),(u.hash===n||i)&&(s=s.concat(u.matchUpIds)),u.hash===n||i||(n=u.hash,c.push({averageMinutes:r,recoveryMinutes:a,roundPeriodLength:o,matchUpIds:s}),s=u.matchUpIds),r=i?e:u.averageMinutes,a=u.recoveryMinutes,o=u.roundPeriodLength;return s.length&&c.push({averageMinutes:r,recoveryMinutes:a,roundPeriodLength:o,matchUpIds:s}),{groupedRounds:c}}function Jc({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:n}){const{matchUpId:r,matchUpType:a}=n,{enteredIndividualParticipantIds:o}=yo(n),s=(n.roundPosition&&e[r]||[]).flat(),c=J(o.concat(...s));return c.forEach((e=>{Gc({individualParticipantProfiles:t,participantId:e})})),{participantIdsAtLimit:c.filter((e=>{const n=t[e];if(n)return[a,ai].find((t=>{const e=n.counters&&n.counters[t]||0,r=i[t]||0;return e&&r&&e>=r}))})),relevantParticipantIds:c}}function Zc({tournamentRecords:t,requestType:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const i={};for(const n of Object.values(t)){const{extension:t}=Ze({tournamentRecord:n,name:"personRequests"}),r=(null==t?void 0:t.value)||[];for(const n of r){const{personId:t,requests:r}=n||{};i[t]||(i[t]=[]);for(const n of r)e&&n.requestType!==e||i[t].push(n)}}return{personRequests:i}}function Qc({tournamentRecords:t,personRequests:e}){if(!t)return{error:"Missing tournamentRecords"};for(const i of Object.values(t)){const{participants:t}=i,n=[];for(const i of Object.keys(e))if(Ye({tournamentParticipants:t,personId:i})){const t=e[i];t.length&&n.push({personId:i,requests:t})}Object.keys(n).length&&Gr({tournamentRecord:i,extension:{name:"personRequests",value:n}})}return ut}function Xc({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);const n=i.filter((({requestType:t})=>t)).map((t=>{let{date:e,requestType:i,startTime:n,endTime:r}=t;return"DO_NOT_SCHEDULE"===i&&(e=ne(e),n=ie(n),r=ie(r),e&&n&&r)?{date:e,startTime:n,endTime:r,requestType:i}:t})).filter(Boolean);for(const r of n)r.requestId=$(),t[e].push(r);return{mergeCount:n.length}}function tu({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=x,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if("object"!=typeof i)return{error:pt};if(!Array.isArray(e)||!Array.isArray(r))return{error:gt};r.length&&t.push("venueId");const{matchUps:a}=ro({matchUpFilters:{scheduledDates:n},tournamentRecord:i});return po({schedule:{venueId:"",scheduledDate:"",scheduledTime:""},matchUpIds:a.filter((i=>!e.includes(i.matchUpStatus)&&rc({schedule:i.schedule,scheduleAttributes:t})&&(!(null!=r&&r.length)||r.includes(i.schedule.venueId)))).map(br),tournamentRecord:i})}function eu({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=x,tournamentRecords:i,scheduledDates:n,venueIds:r}){const a="object"==typeof i&&Object.values(i).map((({tournamentId:t})=>t)).filter(Boolean);if(null==a||!a.length)return{error:"Missing tournamentRecords"};for(const o of a){const a=tu({ignoreMatchUpStatuses:e,scheduleAttributes:t,tournamentRecord:i[o],scheduledDates:n,venueIds:r});if(a.error)return a}return{...ut}}function iu({tournamentRecord:t}){var e;if(!t)return{error:pt};const{policy:i}=Ke({policyType:"scheduling",tournamentRecord:t}),{extension:n}=Ze({tournamentRecord:t,name:"scheduleLimits"}),r=null==n||null===(e=n.value)||void 0===e?void 0:e.dailyLimits,a=null==i?void 0:i.defaultDailyLimits;return{matchUpDailyLimits:r||a}}function nu({tournamentRecords:t,tournamentId:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};let i;return Object.keys(t).filter((t=>!e||t===e)).find((e=>{const n=t[e],{matchUpDailyLimits:r}=iu({tournamentRecord:n});return i=r,!0})),{matchUpDailyLimits:i}}function ru({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,periodLength:i=30,tournamentRecords:n,venueIds:r=[],scheduleDate:a,matchUps:o}){if("object"!=typeof n)return{error:"Missing tournamentRecords"};if(!Array.isArray(o))return{error:"Missing matchUps"};const s=Object.assign({},...Object.values(n).map((t=>(t.events||[]).map((e=>{const{scheduleTiming:i}=ti({tournamentRecord:t,event:e});return{[e.eventId]:{event:e,scheduleTiming:i}}})))).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},u=null==o?void 0:o.filter((t=>rc(t)&&(!a||t.schedule.scheduledDate===a))),d=null==u?void 0:u.filter((t=>!r.length||r.includes(t.schedule.venueId)));return{bookings:null==u?void 0:u.map((({eventId:t,schedule:e,matchUpFormat:n})=>{const{event:r,scheduleTiming:a}=s[t],o=null==r?void 0:r.eventType,u={...a,defaultTiming:c,matchUpFormat:n},{averageMinutes:d,recoveryMinutes:l}=ci({eventType:o,timingDetails:u}),{courtId:p,venueId:m}=e,f=ie(e.scheduledTime),h=ce(f,d);return{averageMinutes:d,recoveryMinutes:l,periodLength:i,startTime:f,endTime:h,courtId:p,venueId:m}})).filter(Boolean),relevantMatchUps:d,dateScheduledMatchUps:u}}function au({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=60,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,periodLength:a=30,tournamentRecords:o,scheduleDate:s,startTime:c,venueIds:u,matchUps:d,endTime:l}){if("object"!=typeof o||!Object.keys(o).length)return{error:"Missing tournamentRecords"};const{courts:p,venues:m}=Po({tournamentRecords:o}),f=p.filter((t=>!u||u.includes(t.venueId)));c||(c=f.reduce(((t,e)=>{var i;const n=null===(i=e.dateAvailability)||void 0===i?void 0:i.find((t=>!t.date||le(s,t.date))),r=(null==n?void 0:n.startTime)||e.startTime;return r&&(!t||te(r)<te(t))?r:t}),void 0)),l||(l=f.reduce(((t,e)=>{var i;const n=null===(i=e.dateAvailability)||void 0===i?void 0:i.find((t=>!t.date||le(s,t.date))),r=(null==n?void 0:n.endTime)||e.endTime;return r&&(!t||te(r)>te(t))?r:t}),void 0));const{bookings:h,dateScheduledMatchUps:I}=ru({defaultRecoveryMinutes:e,averageMatchUpMinutes:i,tournamentRecords:o,scheduleDate:s,periodLength:a,venueIds:u,matchUps:d}),v={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,clearScheduleDates:r,date:s,periodLength:a,startTime:c,endTime:l,bookings:h,courts:f},{scheduleTimes:g}=sr(v);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==m?void 0:m.length)?m[0].venueId:void 0,scheduleTimes:g,dateScheduledMatchUpIds:I.map(br)}}function ou({checkPotentialRequestConflicts:t=!0,scheduleCompletedMatchUps:e,clearScheduleDates:i,scheduleDates:n=[],tournamentRecords:r,periodLength:a,dryRun:o}){return function({checkPotentialRequestConflicts:t=!0,scheduleCompletedMatchUps:e,clearScheduleDates:i,scheduleDates:n=[],tournamentRecords:r,periodLength:a,dryRun:o}){if(!r)return{error:"Missing tournamentRecords"};if(!Array.isArray(n))return{error:gt};const{schedulingProfile:s=[],issues:c=[],modifications:u}=Eo({tournamentRecords:r}),d=Object.assign({},...Object.values(r).map((t=>hs({tournamentRecord:t}).containedStructures))),l=n.map((t=>{if(Wt(t))return ne(t)})).filter(Boolean),p=s.map((t=>t.scheduleDate)).map((t=>Wt(t)&&ne(t))).filter((t=>t&&(!n.length||l.includes(t))));if(!p.length)return{error:"No valid dates"};if(i&&!o){const t=Array.isArray(i)?i:void 0;eu({tournamentRecords:r,scheduledDates:t})}const{courts:m}=Po({tournamentRecords:r}),{matchUps:f}=xo({tournamentRecords:r,nextMatchUps:!0}),{matchUpDependencies:h}=jo({includeParticipantDependencies:!0,tournamentRecords:r,matchUps:f}),{matchUpDailyLimits:I}=nu({tournamentRecords:r}),{personRequests:v}=Zc({requestType:"DO_NOT_SCHEDULE",tournamentRecords:r}),U=s.filter((t=>{const e=ne(null==t?void 0:t.scheduleDate);return p.includes(e)})).sort(((t,e)=>{new Date(t.scheduleDate).getTime(),new Date(e.scheduleDate).getTime()})),N={},P={},D={},M={},A={},b={},R={},C={},O={},L={};for(const K of U){const n=ne(null==K?void 0:K.scheduleDate),s=(null==K?void 0:K.venues)||[],c={},u={},l={},p=(t,e)=>{t.forEach((t=>{const i=l[t].counters;i[e]?i[e]+=1:i[e]=1,i[ai]?i[ai]+=1:i[ai]=1}))};D[n]={},M[n]={},N[n]={},P[n]={},R[n]=[],C[n]=[],O[n]=[],L[n]=[];const U={};f.forEach((t=>{var e;null!==(e=t.schedule)&&void 0!==e&&e.scheduledDate&&le(n,ne(t.schedule.scheduledDate))&&qc({matchUpPotentialParticipantIds:c,matchUpNotBeforeTimes:U,matchUp:t})}));const q=[];for(const t of s){var x;const{rounds:o=[],venueId:s}=t,{scheduledRoundsDetails:p,greatestAverageMinutes:I,orderedMatchUpIds:v,minutesMap:N}=jc({scheduleCompletedMatchUps:e,containedStructureIds:d,tournamentRecords:r,periodLength:a,matchUps:f,rounds:o});q.push(...v);const{groupedRounds:P}=$c({scheduledRoundsDetails:p,greatestAverageMinutes:I,garmanSinglePass:!0}),{scheduleTimes:D,dateScheduledMatchUpIds:M}=au({averageMatchUpMinutes:null===(x=P[0])||void 0===x?void 0:x.averageMinutes,scheduleDate:ne(n),venueIds:[t.venueId],clearScheduleDates:i,tournamentRecords:r,periodLength:a,matchUps:f}),A=Array.isArray(i)?i.includes(n):i,R=A?[]:f.filter((({matchUpId:t})=>M.includes(t)));for(const t of R){var F;Vc({matchUpPotentialParticipantIds:c,individualParticipantProfiles:l,scheduleDate:n,matchUp:t,value:1});const e=null===(F=t.schedule)||void 0===F?void 0:F.scheduledTime;if(e){var k;b[t.matchUpId]=e;const i=null==N||null===(k=N[t.matchUpId])||void 0===k?void 0:k.recoveryMinutes;Wc({individualParticipantProfiles:l,matchUpPotentialParticipantIds:c,matchUpNotBeforeTimes:U,matchUpDependencies:h,recoveryMinutes:i,averageMatchUpMinutes:I,scheduleDate:n,scheduleTime:e,matchUp:t})}}let C=v.map((t=>f.find((e=>e.matchUpId===t)))).filter(Boolean).filter((t=>{const i=!A&&M.includes(t.matchUpId),n=[y,S,w,g,T,E].includes(null==t?void 0:t.matchUpStatus);return e||!i&&!t.winningSide&&!n}));const{matchUpMap:O}=C.reduce(((t,e)=>{const{drawId:i,tournamentId:n}=e;return t.matchUpMap[n]||(t.matchUpMap[n]={}),t.matchUpMap[n][i]?t.matchUpMap[n][i].push(e):t.matchUpMap[n][i]=[e],qc({matchUpPotentialParticipantIds:c,matchUpNotBeforeTimes:U,matchUp:e}),t}),{matchUpMap:{}});u[s]={courtsCount:m.filter((t=>t.venueId===s)).length,previousRemainingScheduleTimes:[],greatestAverageMinutes:I,scheduledRoundsDetails:p,matchUpsToSchedule:C,scheduleTimes:D,groupedRounds:P,minutesMap:N,matchUpMap:O}}const W=10;let z,Y=0,$=10;for(;!z;){for(const{venueId:e}of s){var _,j,B;let i=0;const r=u[e];for(;r.courtsCount&&null!==(G=r.scheduleTimes)&&void 0!==G&&G.length&&null!==(V=r.matchUpsToSchedule)&&void 0!==V&&V.length&&i<=r.courtsCount;){var G,V;const{scheduleTime:a,attempts:o=0}=r.scheduleTimes.shift(),s=r.matchUpsToSchedule.find((e=>{var i,o;const{matchUpId:s,matchUpType:u}=e,{participantIdsAtLimit:d,relevantParticipantIds:m}=Jc({matchUpPotentialParticipantIds:c,individualParticipantProfiles:l,matchUpDailyLimits:I,matchUp:e});if(d.length)return C[n].includes(s)||C[n].push(s),!1;const{scheduledDependent:g}=zc({matchUpScheduleTimes:b,matchUpDependencies:h,scheduleTime:a,matchUpId:s,details:r});if(g)return!1;const{dependenciesScheduled:y,remainingDependencies:w}=Hc({matchUpScheduleTimes:b,matchUpDependencies:h,allDateMatchUpIds:q,matchUps:f,matchUp:e});if(!y)return M[n][s]||(M[n][s]=[]),M[n][s].push({scheduleTime:a,remainingDependencies:w}),!1;const{enoughTime:S}=Yc({individualParticipantProfiles:l,matchUpNotBeforeTimes:U,matchUpDependencies:h,scheduleTime:a,details:r,matchUp:e});if(!S)return D[n][s]||(D[n][s]=[]),D[n][s].push({scheduleTime:a}),!1;const N=r.greatestAverageMinutes,{conflicts:P}=Kc({potentials:t,averageMatchUpMinutes:N,requestConflicts:L,personRequests:v,scheduleTime:a,scheduleDate:n,matchUp:e});if(null!=P&&P.length)return A[n]||(A[n]=[]),A[n].push(...P),!1;p(m,u);const T=null===(i=r.minutesMap)||void 0===i||null===(o=i[s])||void 0===o?void 0:o.recoveryMinutes;return Wc({matchUpPotentialParticipantIds:c,individualParticipantProfiles:l,matchUpNotBeforeTimes:U,averageMatchUpMinutes:N,matchUpDependencies:h,recoveryMinutes:T,scheduleDate:n,scheduleTime:a,matchUp:e}),b[s]=a,!0}));r.matchUpsToSchedule=r.matchUpsToSchedule.filter((({matchUpId:t})=>t!==(null==s?void 0:s.matchUpId))),s?i+=1:(P[n][e]||(P[n][e]=[]),P[n][e].push({scheduleTime:a,attempts:o+1}))}var H;null!==(_=r.matchUpsToSchedule)&&void 0!==_&&_.length&&(P[n][e]=null===(H=P[n][e])||void 0===H?void 0:H.filter((t=>{const e=t.attempts<$;return e&&r.scheduleTimes.push(t),!e}))),null!==(j=r.scheduleTimes)&&void 0!==j&&j.length&&null!==(B=r.matchUpsToSchedule)&&void 0!==B&&B.length||(r.complete=!0)}Y+=1,z=s.every((({venueId:t})=>u[t].complete))||Y===W}for(const{venueId:t}of s){const e=u[t].matchUpMap;Object.keys(e).forEach((i=>{const a=r[i];a&&Object.keys(e[i]).forEach((r=>{const{drawDefinition:s}=di({tournamentRecord:a,drawId:r});s&&e[i][r].forEach((({matchUpId:e})=>{const i=b[e];if(i){const r=i.split(":").map(de).join(":"),c=`${ne(n)}T${r}`;o?R[n].push(e):(ja({drawDefinition:s,scheduledTime:c,matchUpId:e}).success&&R[n].push(e),t&&Oa({tournamentRecord:a,drawDefinition:s,matchUpId:e,venueId:t}))}}))}))})),O[n]=u[t].matchUpsToSchedule.map(br),N[n][t]=u[t].scheduleTimes.sort(((t,e)=>te(t.scheduleTime)-te(e.scheduleTime)))}}const q=U.map((({scheduleDate:t})=>t)),W={timeStamp:Date.now(),schedulingProfile:s,scheduledDates:q,noTimeMatchUpIds:O,scheduledMatchUpIds:R,overLimitMatchUpIds:C,requestConflicts:L},{topics:z}=Rt();if(z.includes("audit"))At({topic:"audit",payload:W});else{const t={itemType:"autoSchedulingAudit",itemValue:W};for(const e of Object.values(r))hr({tournamentRecord:e,timeItem:t})}return{...ut,schedulingProfileModifications:u,schedulingProfileIssues:c,scheduleTimesRemaining:N,dateSchedulingProfiles:U,skippedScheduleTimes:P,recoveryTimeDeferredMatchUpIds:D,dependencyDeferredMatchUpIds:M,matchUpScheduleTimes:b,scheduledMatchUpIds:R,overLimitMatchUpIds:C,noTimeMatchUpIds:O,requestConflicts:L,scheduledDates:q}}({checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:e,clearScheduleDates:i,tournamentRecords:r,scheduleDates:n,periodLength:a,dryRun:o})}function su({event:t}){return t?Wr({event:t,name:"scheduleTiming"}):{error:ht}}function cu({tournamentParticipants:t,drawDefinition:e,participantId:i,matchUpId:n,event:r}){if(!i)return{error:"Missing participantId"};if(!n)return{error:"Missing matchUp"};if(t&&t.length){const{matchUp:a}=Ra({tournamentParticipants:t,inContext:!0,drawDefinition:e,matchUpId:n,event:r});if(!a)return{error:"matchUp not found"};const{error:o,checkedInParticipantIds:s,allRelevantParticipantIds:c}=Aa({matchUp:a});if(!c.includes(i))return{error:"Invalid participantId"};if(o)return{error:o};if(s.includes(i))return{error:"Participant already checked in"}}return Ca({drawDefinition:e,matchUpId:n,timeItem:{itemType:Me,itemValue:i}})}function uu({tournamentParticipants:t,drawDefinition:e,participantId:i,matchUpId:n,event:r}){if(!i)return{error:"Missing participantId"};if(!n)return{error:"Missing matchUpId"};if(t&&t.length){const{matchUp:a}=Ra({tournamentParticipants:t,inContext:!0,drawDefinition:e,matchUpId:n,event:r}),{checkedInParticipantIds:o,allRelevantParticipantIds:s}=Aa({matchUp:a});if(!s.includes(i))return{error:"Invalid participantId"};if(!o.includes(i))return{error:"Participant not checked in"};const{sideParticipantIds:c,nestedIndividualParticipantIds:u}=Ma({matchUp:a}),d=c.indexOf(i);[0,1].includes(d)&&(u[d]||[]).forEach((t=>{Ca({drawDefinition:e,matchUpId:n,timeItem:{itemType:Ae,itemValue:t}})}))}return Ca({drawDefinition:e,matchUpId:n,timeItem:{itemType:Ae,itemValue:i}})}function du(t){if(null==t||!t.tournamentRecord)return{error:pt};const{tournamentRecord:e,participantId:i,matchUpId:n,drawDefinition:r}=t,a=e.participants||[],{matchUp:o}=lo({tournamentRecord:e,drawDefinition:r,matchUpId:n,inContext:!0});if(!o)return{error:"matchUp not found"};const{checkedInParticipantIds:s=[]}=Aa({matchUp:o});return s.includes(i)?uu({drawDefinition:r,tournamentParticipants:a,matchUpId:n,participantId:i}):cu({drawDefinition:r,tournamentParticipants:a,matchUpId:n,participantId:i})}function lu(t){const{tournamentRecords:e}=t;if(!e)return{error:"Missing tournamentRecords"};const{tournamentId:i,drawId:n,matchUpId:r,courtDayDate:a}=t,o=e[i];if(!o)return{error:pt};const{drawDefinition:s}=di({tournamentRecord:o,drawId:n});return La({tournamentRecord:o,drawDefinition:s,matchUpId:r,courtId:"",courtDayDate:a})}const pu="COMPETITOR",mu={OTHER:"OTHER",COACH:"COACH",MEDIA:"MEDIA",CAPTAIN:"CAPTAIN",MEDICAL:"MEDICAL",OFFICIAL:"OFFICIAL",SECURITY:"SECURITY",COMPETITOR:pu,ADMINISTRATION:"ADMINISTRATION"};function fu(t){return ka(t)}function hu({drawDefinition:t,matchUpId:e,disableNotice:i,scheduledDate:n}){return _a({drawDefinition:t,matchUpId:e,disableNotice:i,scheduledDate:n})}function Iu({drawDefinition:t,scheduledTime:e,matchUpId:i,disableNotice:n}){return ja({drawDefinition:t,matchUpId:i,scheduledTime:e,disableNotice:n})}function vu({drawDefinition:t,matchUpId:e,startTime:i,disableNotice:n}){return Ga({drawDefinition:t,matchUpId:e,startTime:i,disableNotice:n})}function gu({drawDefinition:t,matchUpId:e,endTime:i,disableNotice:n}){return Va({drawDefinition:t,matchUpId:e,endTime:i,disableNotice:n})}function yu({drawDefinition:t,matchUpId:e,stopTime:i,disableNotice:n}){return Ha({drawDefinition:t,matchUpId:e,stopTime:i,disableNotice:n})}function Uu({drawDefinition:t,matchUpId:e,resumeTime:i,disableNotice:n}){return qa({drawDefinition:t,matchUpId:e,resumeTime:i,disableNotice:n})}function wu({tournamentRecord:t,drawDefinition:e,participantId:i,officialType:n,matchUpId:r,disableNotice:a}){if(!i)return{error:"Missing participantId"};const{tournamentParticipants:o}=wc({tournamentRecord:t,participantFilters:{participantTypes:[Ri],participantRoles:["OFFICIAL"]}});return Ye({tournamentParticipants:o,participantId:i})?Ba({drawDefinition:e,participantId:i,officialType:n,matchUpId:r,disableNotice:a}):{error:"Participant Not Found"}}function Su({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){if(!t)return{error:pt};if(!i||!Array.isArray(i))return{error:"Missing matchUpIds"};if("object"!=typeof e)return{error:gt};const r=[],a=[],{minutesChange:o,daysChange:s}=e;if(!o&&!s)return{...ut};if(o&&isNaN(o))return{error:gt};if(s&&isNaN(s))return{error:gt};const{matchUps:c}=ro({tournamentRecord:t,matchUpFilters:{matchUpIds:i}}),u=null==c?void 0:c.filter(rc).filter((({matchUpStatus:t})=>!x.includes(t)));if(!u.length)return{...ut};const{tournamentInfo:d}=So({tournamentRecord:t}),{startDate:l,endDate:p}=d,m=u.reduce(((t,e)=>{const{matchUpId:i,drawId:n}=e;return t[n]?t[n].push(i):t[n]=[i],t}),{});for(const h of Object.keys(m)){const{drawDefinition:e,error:c}=di({tournamentRecord:t,drawId:h});if(c)return{error:c};const d=m[h].filter((t=>i.includes(t)));for(const t of d)if(t&&e){const i=u.find((e=>e.matchUpId===t)),c=i.schedule,{scheduledTime:d,scheduledDate:m}=c;let f,h,I;if(o&&d){const t=ne(d),e=te(ie(d))+o;if(f=e<0||e>1440,!f){let e=ce(d,o);h=t?`${t}T${e}`:e}}if(!f&&s&&m&&(I=re(ne(m),s),f=new Date(I)<new Date(l)||new Date(I)>new Date(p)),f)a.push(i);else{if(!n){if(h){const i=Iu({drawDefinition:e,matchUpId:t,scheduledTime:h});if(i.error)return i}if(I){const i=hu({drawDefinition:e,matchUpId:t,scheduledDate:I});if(i.error)return i}}(h||I)&&r.push(i)}}}const f=r.length&&!a.length;return{...ut,rescheduled:r,notRescheduled:a,allRescheduled:f}}function Nu({tournamentRecord:t,dailyLimits:e}){return t?"object"!=typeof e?{error:"Invalid object"}:Gr({tournamentRecord:t,extension:{name:"scheduleLimits",value:{dailyLimits:e}}}):{error:pt}}function Pu({tournamentRecords:t,tournamentId:e,drawId:i}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof e&&!(e=fo({tournamentRecords:t,drawId:i})))return{error:"Missing tournamentId"};const n=t[e];if(!n)return{error:pt};const{drawDefinition:r,error:a}=ui({tournamentRecord:n,drawId:i});return{drawDefinition:r,error:a,tournamentRecord:n}}const Du={scheduleMatchUps:function({tournamentRecords:t,competitionMatchUps:e,matchUpDependencies:i,allDateMatchUpIds:n=[],averageMatchUpMinutes:r=90,recoveryMinutes:a=0,recoveryMinutesMap:o,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:c={},matchUpNotBeforeTimes:u={},matchUpDailyLimits:d={},checkPotentialRequestConflicts:l=!0,remainingScheduleTimes:p,clearScheduleDates:m,periodLength:f=30,scheduleDate:h,matchUpIds:I,venueIds:v,startTime:U,endTime:N,dryRun:P}){if(!t)return{error:"Missing tournamentRecords"};if(!I)return{error:"Missing matchUpIds"};if(!Wt(h))return{error:vt};if(isNaN(f)||isNaN(r)||isNaN(a))return{error:gt};e||({matchUps:e}=xo({tournamentRecords:t,nextMatchUps:!0})),i||({matchUpDependencies:i}=jo({tournamentRecords:t,includeParticipantDependencies:!0,matchUps:e})),e.forEach((t=>{var e;null!==(e=t.schedule)&&void 0!==e&&e.scheduledDate&&le(h,ne(t.schedule.scheduledDate))&&qc({matchUp:t,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s})}));const D=I.map((t=>e.find((e=>e.matchUpId===t)))).filter(Boolean),{venueId:M,scheduleTimes:A,dateScheduledMatchUpIds:b}=Bc({tournamentRecords:t,remainingScheduleTimes:p,startTime:ie(U),endTime:ie(N),scheduleDate:ne(h),averageMatchUpMinutes:r,clearScheduleDates:m,periodLength:f,venueIds:v}),R={},C=[],O={},L={},x={};e.filter((({matchUpId:t})=>b.includes(t))).forEach((t=>{var e;Vc({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,scheduleDate:h,matchUp:t,value:1});const n=null===(e=t.schedule)||void 0===e?void 0:e.scheduledTime;if(n){O[t.matchUpId]=n;const e=null==o?void 0:o[t.matchUpId];Wc({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:u,matchUpDependencies:i,recoveryMinutes:e||a,averageMatchUpMinutes:r,scheduleDate:h,scheduleTime:n,matchUp:t})}}));let F=D.filter((t=>{const e=b.includes(t.matchUpId),i=[y,S,w,g,T,E].includes(null==t?void 0:t.matchUpStatus);return!e&&!t.winningSide&&!i}));const{matchUpMap:k,overLimitMatchUpIds:_,participantIdsAtLimit:j}=F.reduce(((t,e)=>{const{drawId:i,tournamentId:n,matchUpType:r}=e,{participantIdsAtLimit:a,relevantParticipantIds:o}=Jc({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpDailyLimits:d,matchUp:e});return null!=a&&a.length?(t.overLimitMatchUpIds.push(e.matchUpId),t.participantIdsAtLimit.push(...a),t):(o.forEach((t=>{Gc({individualParticipantProfiles:c,participantId:t});const e=c[t].counters;e[r]?e[r]+=1:e[r]=1,e[ai]?e[ai]+=1:e[ai]=1})),t.matchUpMap[n]||(t.matchUpMap[n]={}),t.matchUpMap[n][i]?t.matchUpMap[n][i].push(e):t.matchUpMap[n][i]=[e],qc({matchUp:e,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s}),t)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});F=F.filter((({matchUpId:t})=>!_.includes(t)));let B=0;const G=(null==A?void 0:A.length)||0,{personRequests:V}=Zc({tournamentRecords:t,requestType:"DO_NOT_SCHEDULE"});for(;null!=A&&A.length&&F.length&&B<=G;){B++;const{scheduleTime:t}=A.shift(),d=F.find((d=>{const{matchUpId:p}=d,{dependenciesScheduled:m,remainingDependencies:f}=Hc({matchUps:e,matchUpScheduleTimes:O,matchUpDependencies:i,allDateMatchUpIds:n,matchUp:d});if(!m)return x[p]||(x[p]=[]),x[p].push({scheduleTime:t,remainingDependencies:f}),!1;const{enoughTime:I}=Yc({individualParticipantProfiles:c,matchUpNotBeforeTimes:u,matchUpDependencies:i,scheduleTime:t,matchUp:d});if(!I)return L[p]||(L[p]=[]),L[p].push({scheduleTime:t}),!1;const{conflicts:v}=Kc({potentials:l,averageMatchUpMinutes:r,requestConflicts:R,personRequests:V,scheduleTime:t,scheduleDate:h,matchUp:d});if(null!=v&&v.length)return!1;const g=null==o?void 0:o[d.matchUpId];return Wc({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,matchUpNotBeforeTimes:u,averageMatchUpMinutes:r,matchUpDependencies:i,recoveryMinutes:g||a,scheduleDate:h,scheduleTime:t,matchUp:d}),O[d.matchUpId]=t,!0}));F=F.filter((({matchUpId:t})=>t!==(null==d?void 0:d.matchUpId))),d||C.push(t)}F.forEach((t=>{Vc({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,scheduleDate:h,value:-1,matchUp:t})}));let H=[];Object.keys(k).forEach((e=>{const i=t[e];i?Object.keys(k[e]).forEach((t=>{const{drawDefinition:n}=di({tournamentRecord:i,drawId:t});n&&k[e][t].forEach((({matchUpId:t})=>{const e=O[t];if(e){const r=e.split(":").map(de).join(":"),a=`${ne(h)}T${r}`;P?H.push(t):(ja({drawDefinition:n,matchUpId:t,scheduledTime:a}).success&&H.push(t),M&&Oa({tournamentRecord:i,drawDefinition:n,matchUpId:t,venueId:M}))}}))})):Pt()&&console.log("Missing tournamentId")}));const q=Tr(F);return{...ut,requestConflicts:Object.values(R),remainingScheduleTimes:A.map((({scheduleTime:t})=>t)),individualParticipantProfiles:c,matchUpNotBeforeTimes:u,participantIdsAtLimit:j,skippedScheduleTimes:C,overLimitMatchUpIds:_,scheduledMatchUpIds:H,noTimeMatchUpIds:q,recoveryTimeDeferred:L,dependencyDeferred:x}},scheduleProfileRounds:ou,clearScheduledMatchUps:eu,bulkRescheduleMatchUps:function({tournamentRecords:t,scheduleChange:e,matchUpIds:i,dryRun:n}){if(!i||!Array.isArray(i))return{error:"Missing matchUpIds"};if("object"!=typeof e)return{error:gt};const r=[];let a=[];for(const u of Object.values(t)){var o;const t=Su({tournamentRecord:u,scheduleChange:e,matchUpIds:i,dryRun:n});if(t.error)return t;Array.isArray(t.notRescheduled)&&a.push(...t.notRescheduled);const c=Tr(t.notRescheduled),d=[];var s;null===(o=t.rescheduled)||void 0===o||o.forEach((t=>{const{matchUpId:e}=t;c.includes(e)&&d.push(e),r.push(t)})),d.length&&(a=(null==t||null===(s=t.notRescheduled)||void 0===s?void 0:s.filter((({matchUpId:t})=>!d.includes(t))))||[])}const c=r.length&&!a.length;return{...ut,rescheduled:r,notRescheduled:a,allRescheduled:c}},getScheduledRoundsDetails:jc,getMatchUpDependencies:jo,generateVirtualCourts:ar,generateBookings:ru,matchUpScheduleChange:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const{sourceMatchUpContextIds:i,targetMatchUpContextIds:n,sourceCourtId:r,targetCourtId:a,courtDayDate:o}=t||{},{drawId:s,matchUpId:c,tournamentId:u}=i||{},{drawId:d,matchUpId:l,tournamentId:p}=n||{};if(!c&&!l)return{error:It};let m=0;if(a&&c&&!l){const t=f({tournamentId:u,drawId:s,courtDayDate:o,matchUpId:c,courtId:a});if(null!=t&&t.success&&m++,t.error)return t}else if(r&&a&&c&&l){const t=f({tournamentId:u,drawId:s,courtDayDate:o,matchUpId:c,courtId:a});if(t.success&&m++,t.error)return t;const e=f({tournamentId:p,drawId:d,courtDayDate:o,matchUpId:l,courtId:r});if(e.success&&m++,e.error)return e}return m?ut:{error:"No modifications applied"};function f({tournamentId:t,drawId:i,matchUpId:n,courtDayDate:r,courtId:a}){const o=e[t],{drawDefinition:s}=di({tournamentRecord:o,drawId:i});return La({tournamentRecord:o,drawDefinition:s,matchUpId:n,courtId:a,courtDayDate:r})}},calculateScheduleTimes:Bc,reorderUpcomingMatchUps:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const{matchUpsContextIds:i,firstToLast:n}=t;if(!i)return{error:It};const r=null==i?void 0:i.length;if(!r)return ut;let a=0;return i.forEach(((t,o)=>{const{tournamentId:s,drawId:c,matchUpId:u}=t;let d=o+(n?-1:1);d<0&&(d=r-1),d===r&&(d=0);const l=function({tournamentId:t,drawId:i,matchUpId:n,scheduledTime:r}){const a=e[t],{drawDefinition:o}=di({tournamentRecord:a,drawId:i});return ja({drawDefinition:o,matchUpId:n,scheduledTime:r})}({tournamentId:s,drawId:c,matchUpId:u,scheduledTime:i[d].schedule.scheduledTime});if(!l.success)return l;a++})),a===r?ut:{error:"Modifications failed"}},bulkUpdateCourtAssignments:function({tournamentRecords:t,courtAssignments:e,courtDayDate:i}){if(!t)return{error:"Missing tournamentRecords"};if(!Array.isArray(e))return{error:It};const n=e.reduce(((t,e)=>{const{tournamentId:i}=e;return t[i]||(t[i]=[]),t[i].push(e),t}),{});let r;return Object.keys(n).every((e=>{const a=t[e];if(!a)return r={error:pt},!1;const o=n[e].reduce(((t,e)=>{const{drawId:i}=e;return t[i]||(t[i]=[]),t[i].push(e),t}),{});Object.keys(o).every((t=>{const{drawDefinition:e}=ui({tournamentRecord:a,drawId:t});return e?(o[t].every((t=>{const{matchUpId:n,courtId:o}=t,s=La({tournamentRecord:a,drawDefinition:e,courtDayDate:i,matchUpId:n,courtId:o});if(s.success)return null==s?void 0:s.success;r={error:"Unable to assign court"}})),!0):(r={error:mt},!1)}))})),r||ut},removeMatchUpCourtAssignment:lu,toggleParticipantCheckInState:function(t){const{tournamentRecords:e}=t,{participantId:i,tournamentId:n,matchUpId:r,drawId:a}=t;if(!(e&&n&&i&&r))return{error:It};const o=e[n],{drawDefinition:s}=di({tournamentRecord:o,drawId:a});return Object.assign(t,{drawDefinition:s,tournamentRecord:o}),du(t)},findMatchUpFormatTiming:_c,modifyMatchUpFormatTiming:function({tournamentRecords:t,matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const o=Object.keys(t).filter((t=>!r||r===t));if(r&&!o.includes(r))return{error:gt};let s;for(const c of o){const r=t[c],{event:o}=ui({tournamentRecord:r,eventId:a});a&&o&&(s=!0);const u=Cc({tournamentRecord:r,event:o,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(u.error)return u}return!a||s?{...ut}:{error:"Event not found"}},modifyEventMatchUpFormatTiming:function({tournamentRecords:t,tournamentId:e,eventId:i,categoryType:n,matchUpFormat:r,averageMinutes:a,recoveryMinutes:o}){if(!i)return{error:ht};const s=Object.keys(t).filter((t=>!e||e===t));if(e&&!s.includes(e))return{error:gt};for(const c of s){const e=t[c],{event:s}=ui({tournamentRecord:e,eventId:i});if(s)return Lc({tournamentRecord:e,event:s,categoryType:n,matchUpFormat:r,averageMinutes:a,recoveryMinutes:o})}return{error:"Event not found"}},getMatchUpFormatTimingUpdate:function({tournamentRecords:t}){return xc({tournamentRecords:t,extensionName:"scheduleTiming"})},getEventMatchUpFormatTiming:function({tournamentRecords:t,matchUpFormats:e,categoryType:i,tournamentId:n,eventId:r}){if(!r)return{error:ht};const a=Object.keys(t).filter((t=>!n||t===n));if(n&&!a.length)return{error:gt};let o,s,c;return a.find((n=>{const a=t[n],{event:u}=ui({tournamentRecord:a,eventId:r});if(!u)return!1;c=!0;const{eventMatchUpFormatTiming:d,error:l}=Fc({tournamentRecord:a,matchUpFormats:e,categoryType:i,event:u});return l&&(s=l),o=d,!0})),c?s?{error:s}:{eventMatchUpFormatTiming:o}:{error:"Event not found"}},removeEventMatchUpFormatTiming:function({tournamentRecords:t,eventId:e}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof e)return{error:It};for(const i of Object.values(t)){const{event:t}=ui({tournamentRecord:i,eventId:e});if(t)return su({event:t})}return{error:"Event not found"}},getMatchUpDailyLimits:nu,setMatchUpDailyLimits:function({tournamentRecords:t,tournamentId:e,dailyLimits:i}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const n=Object.keys(t).filter((t=>!e||e===t));if(e&&!n.includes(e))return{error:gt};for(const r of n){const e=Nu({tournamentRecord:t[r],dailyLimits:i});if(e.error)return e}return ut},getMatchUpDailyLimitsUpdate:function({tournamentRecords:t}){return xc({tournamentRecords:t,extensionName:"scheduleLimits"})},assignMatchUpVenue:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Pu(t);if(n)return{error:n};const{matchUpId:r,venueId:a,disableNotice:o}=t;return Oa({tournamentRecord:e,drawDefinition:i,disableNotice:o,matchUpId:r,venueId:a})},assignMatchUpCourt:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Pu(t);if(n)return{error:n};const{matchUpId:r,courtId:a,courtDayDate:o,disableNotice:s}=t;return La({tournamentRecord:e,disableNotice:s,drawDefinition:i,courtDayDate:o,matchUpId:r,courtId:a})},addMatchUpScheduleItems:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Pu(t);return n?{error:n}:fu({...t,tournamentRecord:e,drawDefinition:i})},addMatchUpScheduledDate:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Pu(t);if(n)return{error:n};const{disableNotice:r,scheduledDate:a,matchUpId:o}=t;return hu({tournamentRecord:e,drawDefinition:i,disableNotice:r,scheduledDate:a,matchUpId:o})},addMatchUpScheduledTime:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Pu(t);if(n)return{error:n};const{disableNotice:r,scheduledTime:a,matchUpId:o}=t;return Iu({tournamentRecord:e,drawDefinition:i,disableNotice:r,scheduledTime:a,matchUpId:o})},addMatchUpStartTime:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Pu(t);if(n)return{error:n};const{disableNotice:r,startTime:a,matchUpId:o}=t;return vu({tournamentRecord:e,drawDefinition:i,disableNotice:r,startTime:a,matchUpId:o})},addMatchUpStopTime:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Pu(t);if(n)return{error:n};const{disableNotice:r,stopTime:a,matchUpId:o}=t;return yu({tournamentRecord:e,drawDefinition:i,disableNotice:r,stopTime:a,matchUpId:o})},addMatchUpResumeTime:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Pu(t);if(n)return{error:n};const{disableNotice:r,resumeTime:a,matchUpId:o}=t;return Uu({tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:a,matchUpId:o})},addMatchUpEndTime:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Pu(t);if(n)return{error:n};const{disableNotice:r,endTime:a,matchUpId:o}=t;return gu({tournamentRecord:e,drawDefinition:i,disableNotice:r,endTime:a,matchUpId:o})},addMatchUpOfficial:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Pu(t);if(n)return{error:n};const{disableNotice:r,participantId:a,officialType:o,matchUpId:s}=t;return wu({tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:a,officialType:o,matchUpId:s})},getSchedulingProfile:Eo,setSchedulingProfile:bo,addSchedulingProfileRound:Ro,validateSchedulingProfile:Uo,addPersonRequests:function({tournamentRecords:t,personId:e,requests:i}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof e)return{error:gt};if(!Array.isArray(i))return{error:gt};const{personRequests:n}=Zc({tournamentRecords:t}),{mergeCount:r}=Xc({personRequests:n,personId:e,requests:i});return r?Qc({tournamentRecords:t,personRequests:n}):{error:gt}},getPersonRequests:Zc,modifyPersonRequests:function({tournamentRecords:t,requests:e,personId:i}){if(!t)return{error:"Missing tournamentRecords"};if(!Array.isArray(e))return{error:gt};const n=e.map((({requestId:t})=>t)).filter(Boolean),{personRequests:r}=Zc({tournamentRecords:t}),a=t=>{r[t]=r[t].map((t=>{if(!n.includes(t.requestId))return t;const i=e.find((e=>e.requestId===t.requestId));return i.requestType?Object.assign(t,i):void 0})).filter(Boolean)};if(i&&r[i])a(i);else for(const s of Object.keys(r))a(s);const o=e.filter((t=>!t.requestId));return o.length&&Xc({personRequests:r,personId:i,requests:o}),Qc({tournamentRecords:t,personRequests:r})},removePersonRequests:function({tournamentRecords:t,requestType:e,requestId:i,personId:n,date:r}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const{personRequests:a}=Zc({tournamentRecords:t}),o=t=>{a[t]=a[t].filter((t=>!(e&&t.requestType===e||i&&t.requestId===i||r&&t.date===r))),a[t].length||delete a[t]},s=!(e||i||n||r);if(!s)if(n&&a[n])o(n);else for(const c of Object.keys(a))o(c);return s||!Object.keys(a).length?Ao({tournamentRecords:t,name:"personRequests"}):Qc({tournamentRecords:t,personRequests:a})}};function Tu({tournamentRecord:t,policyDefinitions:e,allowReplacement:i}){if(!t)return{error:pt};if(!e||"object"!=typeof e)return{error:"Missing policyDefinitions"};t.extensions||(t.extensions=[]);const{appliedPolicies:n}=qe({tournamentRecord:t}),r=Object.keys(e).map((t=>{if(!n[t]||i)return n[t]=e[t],t})).filter(Boolean);if(null!=r&&r.length){const e=Gr({tournamentRecord:t,extension:{name:"appliedPolicies",value:n}});if(e.error)return e}return null!=r&&r.length?{...ut,applied:r}:{error:"existing policyType"}}function Mu({policyDefinitions:t,allowReplacement:e,event:i}){if(!i)return{error:ht};if(!t)return{error:"Missing policyDefinitions"};let n=0;i.extensions||(i.extensions=[]);const{appliedPolicies:r}=We({event:i});return Object.keys(t).forEach((i=>{r[i]&&!e||(r[i]=t[i],n++)})),n&&Hr({event:i,extension:{name:"appliedPolicies",value:r}}),n?ut:{error:"Policy not attached"}}const Au={attachPolicies:function({tournamentRecords:t,policyDefinitions:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};for(const i of Object.values(t)){const t=Tu({tournamentRecord:i,policyDefinitions:e,allowReplacement:!0});if(t.error)return t}return ut}};function Eu(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antoina, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and challenging me.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}function bu({tournamentParticipants:t=[],inContextDrawMatchUps:e,drawDefinition:i,matchUpsMap:n,matchUpId:r,event:a}){var o,s,c;if(!i)return{error:mt};if(!r)return{error:"Missing matchUpId"};const{drawId:u}=i,{matchUp:d,structure:l}=Ra({drawDefinition:i,matchUpId:r,event:a}),{assignedPositions:p,allPositionsAssigned:m}=Pa({structure:l}),{drawPositions:f}=d||{},{structureId:h}=l||{},I=[];if(!h)return{validActions:I};if(Ta({drawDefinition:i,structure:l})){const e=(l.matchUps||[]).filter((({roundNumber:t})=>t===d.roundNumber)),n=(null==i?void 0:i.entries.filter((({entryStatus:t})=>[Qr,ea,Zr].includes(t))).map(Ar))||[],a=e.map((t=>(t.sides||[]).map((t=>t.participantId)))).flat().filter(Boolean),o=n.filter((t=>!a.includes(t))),s=null==t?void 0:t.filter((t=>null==o?void 0:o.includes(t.participantId)));null==s||s.forEach((t=>{const e=(i.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),o.length&&I.push({type:"ASSIGN",availableParticipantIds:o,participantsAvailable:s,method:"assignMatchUpSideParticipant",payload:{drawId:u,matchUpId:r,structureId:h}}),I.push({type:"ALTERNATE"})}const v=vs({drawDefinition:i,structure:l}),g=p.filter((t=>t.participantId)).map((t=>t.drawPosition)),U=p.filter((t=>t.bye)).map((t=>t.drawPosition)),w=d.collectionId,S=d.matchUpStatus===y||!w&&(null===(o=d.drawPositions)||void 0===o?void 0:o.reduce(((t,e)=>U.includes(e)||t),!1));if(S)return{validActions:I,isByeMatchUp:S};const P=null==f?void 0:f.reduce(((t,e)=>g.includes(e)&&t),2===(null==f?void 0:f.length));I.push({type:"REFEREE"});const D=!Bo({matchUpStatus:d.matchUpStatus}),{appliedPolicies:T}=Rr({drawDefinition:i}),M=null==T||null===(s=T.scoring)||void 0===s?void 0:s.structures,A=(null==M?void 0:M.stage)&&(null==M?void 0:M.stage[l.stage]),E=(null==A?void 0:A.stageSequence)&&A.stageSequence[l.stageSequence],b=!((null==T||null===(c=T.scoring)||void 0===c?void 0:c.requireAllPositionsAssigned)||(null==A?void 0:A.requireAllPositionsAssigned)||(null==E?void 0:E.requireAllPositionsAssigned))||m,R=d.sides&&2===d.sides.filter((t=>t&&t.participantId)).length;let C;const O=d.matchUpStatus===N;if(O){n=n||Or({drawDefinition:i}),e||({matchUps:e}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:n}));const t=Za({inContextDrawMatchUps:e,drawDefinition:i,matchUpId:r});C=Ls({inContextDrawMatchUps:e,drawDefinition:i,targetData:t})}const L=(P||R)&&!(O&&C),x={type:"PENALTY",method:"addPenalty",payload:{drawId:u,matchUpId:r,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(D&&I.push({type:"SCHEDULE"}),L&&I.push(x),D&&L&&I.push({type:"STATUS"}),b&&L){const{matchUpId:t,matchUpFormat:e}=d,i={drawId:u,matchUpId:t,matchUpFormat:e,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};I.push({type:"SCORE",method:"setMatchUpStatus",message:"set outcome and winningSide",payload:i}),I.push({type:"START"}),I.push({type:"END"})}return{validActions:I,isDoubleWalkover:O,structureIsComplete:v}}function Ru({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){if(!t)return{error:pt};if(!n){const{matchUps:r}=ro({tournamentRecord:t});n=r.reduce(((t,e)=>e.matchUpId===i?e.drawId:t),void 0),e=(t.events||[]).map((t=>t.drawDefinitions||[])).flat().reduce(((t,e)=>e.drawId===n?e:t),void 0)}return n?bu({drawDefinition:e,matchUpId:i}):{error:"drawDefinition not found"}}const Cu={getCompetitionDateRange:No,getTournamentIds:function({tournamentRecords:t}){const e=Object.keys(t);return{...ut,tournamentIds:e}},competitionScheduleMatchUps:Fo,getSchedulingProfileIssues:function({tournamentRecords:t,scheduleDates:e=[]}={}){if("object"!=typeof t)return{error:"Invalid tournamentRecord"};if(!Array.isArray(e))return{error:gt};if(!e.every(Wt))return{error:vt};const i=[];let n=0;const r={},{schedulingProfile:a}=Eo({tournamentRecords:t});if(!a)return{issues:i,...ut};const{matchUps:o}=xo({tournamentRecords:t,nextMatchUps:!0});for(const s of a){const{scheduleDate:a,venues:c=[]}=s;if(null==e||!e.length||e.includes(a))for(const e of c||[])if(e){const{rounds:s}=e,c=[];let{orderedMatchUpIds:u,scheduledRoundsDetails:d}=jc({tournamentRecords:t,periodLength:30,matchUps:o,rounds:s});const{matchUpDependencies:l}=jo({tournamentRecords:t,matchUps:o}),p=t=>{let e;return d.find(((i,n)=>{const r=i.matchUpIds.includes(t);return r&&(e=n),r})),e};if(u.forEach(((t,e)=>{var i;const n=at(u.slice(e+1),(null==l||null===(i=l[t])||void 0===i?void 0:i.matchUpIds)||[]);n.length&&c.push({matchUpId:t,shouldBeAfter:n})})),c.length){n+=c.length;const t=c.map((({matchUpId:t,shouldBeAfter:e})=>{const i=p(t),n=J(e.map(p));return r[a]||(r[a]={}),r[a][i]||(r[a][i]=[]),n.forEach((t=>{r[a][i].includes(t)||r[a][i].push(t)})),{matchUpId:t,matchUpRoundIndex:i,earlierRoundIndices:n,shouldBeAfter:e}}));i.push(...t)}}}return{issuesCount:n,profileIssues:{matchUpIdShouldBeAfter:Object.assign({},...i.map((t=>{const{matchUpId:e,shouldBeAfter:i,earlierRoundIndices:n}=t;return{[e]:{earlierRoundIndices:n,shouldBeAfter:i}}})))},roundIndexShouldBeAfter:r,...ut}},allCompetitionMatchUps:xo,competitionMatchUps:ko,matchUpActions:function({tournamentRecords:t,tournamentId:e,matchUpId:i,eventId:n,drawId:r}={}){if("object"!=typeof t||"string"!=typeof e||"string"!=typeof i||"string"!=typeof r)return{error:gt};const a=t[e];if(!a)return{error:pt};const{drawDefinition:o,error:s}=ui({tournamentRecord:a,eventId:n,drawId:r});return s?{error:s}:Ru({tournamentRecord:a,drawDefinition:o,drawId:r,matchUpId:i})},getCompetitionVenues:Do,getVenuesAndCourts:Po,getVenuesReport:function({tournamentRecords:t,venueIds:e=[],dates:i=[]}){if(!Array.isArray(i))return{error:gt,dates:i};if(!Array.isArray(e))return{error:gt,venueIds:e};if(!i.every(Wt))return{error:vt};const n=Po({tournamentRecords:t});if(n.error)return n;const r=n.venues.filter((({venueId:t})=>!(null!=e&&e.length)||e.includes(t))),a=n.courts.reduce(((t,e)=>(e.dateAvailability.forEach((({date:e})=>{t.includes(e)||t.push(e)})),t)),[]).filter((t=>!i.length||i.includes(t))),o={venueIds:r.map((({venueId:t})=>t))},{matchUps:s}=xo({tournamentRecords:t,matchUpFilters:o});return{venuesReport:r.map((t=>function(t,e,i){const{venueId:n,courts:r,venueName:a}=e,o={};return t.forEach((t=>{let e=0,a=0,s=0;for(const i of r){const n=i.dateAvailability.find((e=>e.date===t)),r=n&&ir({courtDate:n}),a=null==r?void 0:r.reduce(((t,e)=>{const{startTime:i,endTime:n}=e;return t+(te(n)-te(i))}),0);a&&(s+=1),e+=a}const c=i.filter((({schedule:e})=>e.venueId===n&&le(t,e.scheduledDate)));c.forEach((({schedule:t})=>{const e=ie(t.scheduledTime),i=te(ce(e,t.averageMinutes))-te(e);a+=i}));const u=e?(a/e*100).toFixed(2):"100";o[t]={scheduledMatchUpsCount:c.length,availableCourts:s,availableMinutes:e,scheduledMinutes:a,percentUtilization:u}})),{venueId:n,venueName:a,venueReport:o}}(a,t,s)))}},credits:Eu};function Ou({convertExtensions:t,removeExtensions:e}){const i=xt();return{tournamentId:Ot(),tournamentRecords:me(i,t,!1,e)}}function Lu(){var t;const e=xt(),{extension:i}=Mo({tournamentRecords:e,name:"linkedTournamentsIds"}),n=(null==i||null===(t=i.value)||void 0===t?void 0:t.tournamentIds)||[];return Object.keys(e).forEach((t=>{n.includes(t)||delete e[t]})),kt(e)}function xu(t,e=!0){return"object"!=typeof t||Array.isArray(t)?{error:"Invalid object"}:t.tournamentId?Ft(e?me(t):t):{error:gt}}function Fu(t,e=!0){if("object"!=typeof t)return{error:"Invalid object"};if(Array.isArray(t)){if(t.filter((({tournamentId:t})=>t)).length!==t.length)return{error:lt};t=Object.assign({},...t.map((t=>({[t.tournamentId]:t}))))}else if(t.tournamentId)t={[t.tournamentId]:t};else if(!Object.keys(t).every((e=>t[e].tournamentId===e)))return{error:lt};return kt(e?me(t):t)}const ku=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>Ou({convertExtensions:t,removeExtensions:e}),version:()=>"0.74.1",reset:()=>(kt({}),e())};return[Ec,Au,Cu,Du].forEach((e=>{Object.keys(e).forEach((n=>{t[n]=t=>{if(Pt())return i(e[n],t);try{return i(e[n],t)}catch(e){const r=e.toString();console.log("ERROR",{error:r,method:n,params:JSON.stringify(t)}),console.log(e)}}}))})),t.devContext=t=>(Dt(t),e()),t.getDevContext=t=>Pt(t),t.setState=(t,i,n)=>(Mt(i,n),e(Fu(t,i))),t.setTournamentRecord=(t,i,n)=>(Mt(i,n),e(xu(t,i))),t.removeTournamentRecord=t=>e(jt(t)),t.removeUnlinkedTournamentRecords=()=>e(Lu()),t.executionQueue=(e,i)=>function(e,i){if(!Array.isArray(e))return{error:gt};const n=xt(),r=i&&me(n,!1,!0),a=[];for(const o of e){if("object"!=typeof o)return{error:gt};const{method:e,params:i}=o;if(!t[e])return{error:"Method not found"};const s=t[e]({...i,tournamentRecords:n});if(null!=s&&s.error)return r&&Fu(r),{...s,rolledBack:!!r};a.push(s)}return bc(),bt(),{results:a}}(e,i),t;function e(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function i(e,i){delete t.success,delete t.error;const n=xt(),r=(null==i?void 0:i.rollbackOnError)&&me(n,!1,!0),a=e({...i,tournamentRecords:n});null!=a&&a.error&&r&&Fu(r);const o=(null==a?void 0:a.success)&&!0!==(null==i?void 0:i.delayNotify)&&!0!==(null==i?void 0:i.doNotNotify);return o&&bc(),(o||null==a||!a.success||null!=i&&i.doNotNotify)&&bt(),a}}();function _u({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:"Missing policy attributes"};if(!n)return{error:"Missing participant"};const r=[];return t.forEach((t=>{const{directive:o,groupings:s,key:c,significantCharacters:u}=t||{};if(c){const t=c.split(".");a({value:n,keys:t,significantCharacters:u})}else if(o){const a=null==t?void 0:t.includeIds,s=(e&&e[o]||[]).filter((t=>!a||a.includes(t)));null!=s&&s.length&&null!=i&&i.length&&s.forEach((t=>{var e;const a=i.find((e=>e.participantId===t));if(null!=a&&null!==(e=a.individualParticipantIds)&&void 0!==e&&e.includes(n.participantId)){const t=null==a?void 0:a.participantId;r.push(t)}}))}else s&&Object.keys(s).forEach((t=>{s[t].includes(n.participantId)&&r.push(t)}))})),{values:J(r)};function a({value:t,keys:e=[],significantCharacters:i}){for(const[r,o]of e.entries())if(t&&t[o])if(Array.isArray(t[o])){const n=t[o],s=e.slice(r);n.forEach((t=>a({value:t,keys:s,significantCharacters:i})))}else n({value:t=t[o],index:r});function n({value:t,index:n}){if(t&&n===e.length-1&&["string","number"].includes(typeof t)){const e=i?t.slice(0,i):t;r.push(e)}}}}function ju({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){const r=Object.assign({},...e.map((t=>({[t.participantId]:t}))));return t.map((t=>{const a=r[t.participantId],{values:o}=_u({participants:e,policyAttributes:i,idCollections:n,participant:a});return{...t,values:o}}))}function Bu({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter((t=>null==t?void 0:t.participantId)).map((e=>{const{drawPosition:n,participantId:r}=e,a=t&&t[r]||[],o=!!i.some((t=>a.includes(t)));return{[n]:{participantGroups:a,includesGroupsToAvoid:o}}})))}function Gu(t){return t%2?t+1:t-1}function Vu({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){const o=n.map((n=>a?function(t){const{unfilledPositions:e,chunkedDrawPositions:i}=t,n=Bu(t);return i.map((t=>{const i=e.filter((e=>t.includes(e))),r=i.length===t.length?i:[],a=t.filter((t=>{var e;return null===(e=n[t])||void 0===e?void 0:e.includesGroupsToAvoid})).length;return{unassigned:i,unpaired:r,pairedNoConflict:a?[]:i,conflictsCount:a}}))}({groupsToAvoid:t,chunkedDrawPositions:n,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):function(t){const{unfilledPositions:e,chunkedDrawPositions:i}=t,n=Bu(t);return i.map((t=>{const i=e.filter((e=>t.includes(e))),r=function(t){return t.filter((t=>!e(t)));function e(e){const i=Gu(e);return!t.includes(i)}}(i),a=i.filter((t=>!r.includes(t))).filter((t=>{var e;const i=Gu(t);return!(null!==(e=n[i])&&void 0!==e&&e.includesGroupsToAvoid)}));return{unassigned:i,unpaired:r,pairedNoConflict:a}}))}({groupsToAvoid:t,chunkedDrawPositions:n,participantIdGroups:e,positionAssignments:i,unfilledPositions:r})));return a?{unassigned:o.map((t=>t.map((t=>t.unassigned)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)).sort(((t,e)=>(e.length||0)-(t.length||0))),unpaired:o.map((t=>t.map((t=>t.unpaired)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),pairedNoConflict:o.map((t=>t.map((t=>t.pairedNoConflict)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)).sort(((t,e)=>(e.length||0)-(t.length||0)))}:{unassigned:o.map((t=>t.map((t=>t.unassigned)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),unpaired:o.map((t=>t.map((t=>t.unpaired)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),pairedNoConflict:o.map((t=>t.map((t=>t.pairedNoConflict)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length))}}function Hu({participantIds:t,positionAssignments:e}){const i=e.map((t=>t.participantId));return t.filter((t=>!i.includes(t)))}function qu({drawPositions:t}){const e=[].concat(...t.map((e=>t.filter((t=>t!==e)).map((t=>[e,t]))))),i=J(e.map(Wu)).map((t=>t.split("|").map((t=>+t))));return{groupMatchUps:e,uniqueMatchUpGroupings:i}}function Wu(t){return t.sort(Ie).join("|")}function zu({isRoundRobin:t,groupedParticipants:e}){const i=[];return t?e.forEach((t=>{const e=t.map((t=>t.drawPosition)),{uniqueMatchUpGroupings:n}=qu({drawPositions:e}),r=Object.assign({},...t.map((t=>({[t.drawPosition]:t}))));n.forEach((e=>{ot(r[e[0]].values||[],r[e[1]].values||[])&&(i.push(e),t.conflict=!0)}))})):e.forEach((t=>{ot(t[0].values||[],t[1].values||[])&&(i.push(t),t.conflict=!0)})),i}function Ku({isRoundRobin:t,avoidanceConflicts:e,drawPositionGroups:i,positionedParticipants:n,potentialDrawPositions:r}){return e.map((e=>{const a=e.map((t=>t.drawPosition));return e.filter((t=>r.includes(t.drawPosition))).map((e=>{const o=r.filter((t=>!a.includes(t))).filter((r=>{const a=i.find((t=>t.includes(r))).find((t=>t!==r)),o=n.find((t=>t.drawPosition===a)),s=zu({isRoundRobin:t,groupedParticipants:[[e,o]]}),c=n.find((t=>t.drawPosition===r)),u=zu({isRoundRobin:t,groupedParticipants:[[c,o]]});return!s.length&&!u.length}));if(o.length)return{drawPosition:e.drawPosition,possibleDrawPositions:o}})).filter(Boolean)})).flat(1)}function Yu(t){const{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,drawPositionGroups:r,policyAttributes:a,idCollections:o,allGroups:s}=t,c=[];let u;const d=Math.min(...r.map((t=>t.length))),l=d>2,p=me(e,!1,!0),m=e.filter((t=>!t.participantId)).map((t=>t.drawPosition));nt(0,n).forEach((()=>{const{newGroupKey:e,selectedParticipantId:i,targetDrawPosition:n}=function({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){const c=r.reduce(((t,e)=>e.length>t?e.length:t),0),u=!!(c>2),d=Hu({participantIds:e,positionAssignments:t}),l=function({drawPositionGroups:t,positionAssignments:e}){const i=Object.assign({},...e.map((t=>({[t.drawPosition]:t}))));return t.map((t=>t.filter(Boolean).map((t=>i[t])).filter((t=>!t.participantId&&!t.bye)).map((t=>t.drawPosition)))).flat().filter(Boolean)}({drawPositionGroups:r,positionAssignments:t}),{participantId:p,groupKey:m}=function({groupKey:t,allGroups:e,largestFirst:i=!0,targetParticipantIds:n,useSpecifiedGroupKey:r=!1}){var a;const o=Object.assign({},...Object.keys(e).map((t=>[t,e[t].filter((t=>n.includes(t)))])).filter((t=>t[1].length)).map((([t,e])=>({[t]:e})))),s=Object.keys(o).reduce(((t,e)=>o[e].length>t?o[e].length:t),0),c=Object.keys(o).filter((t=>o[t].length===s)),u=it(i?c:Object.keys(o));return{participantId:(t=r&&null!==(a=o[t])&&void 0!==a&&a.length?t:u)&&o[t]?it(o[t]):it(n),groupKey:t}}({groupKey:s,allGroups:o,targetParticipantIds:d,useSpecifiedGroupKey:u}),f=function({allGroups:t,participantId:e}){return Object.keys(t).filter((i=>t[i].includes(e)))}({allGroups:o,participantId:p}),h=Vu({positionAssignments:t,isRoundRobin:u,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:l,largestGroupSize:c,allGroups:o}),{unassigned:I,unpaired:v,pairedNoConflict:g}=h,y=(null==g?void 0:g.length)&&g[0],U=(null==v?void 0:v.length)&&v[0],w=a&&y?y:U,S=a?U:y,N=(null==w?void 0:w.length)&&w||(null==S?void 0:S.length)&&S;let P;if(null!=N&&N.length){const t=et(N);P=et(t)}else{const t=et(I[0]);P=et(t)}return{newGroupKey:m,selectedParticipantId:p,targetDrawPosition:P}}({...t,groupKey:u,allGroups:s,candidatePositionAssignments:p});u=e,p.forEach((t=>{t.drawPosition===n&&(t.participantId=i)}))}));let f=ju({candidatePositionAssignments:p,participantsWithGroupings:i,policyAttributes:a,idCollections:o}),h=st(f,d),I=zu({groupedParticipants:h,isRoundRobin:l}),v=0;for(;v<20&&I.length;){const t=Ku({positionedParticipants:f,potentialDrawPositions:m,avoidanceConflicts:I,drawPositionGroups:r,isRoundRobin:l});t.length?($u({candidatePositionAssignments:p,swapOptions:t}),f=ju({candidatePositionAssignments:p,participantsWithGroupings:i,policyAttributes:a,idCollections:o}),h=st(f,d),I=zu({isRoundRobin:l,groupedParticipants:h}),v++):v=20}return p.forEach((t=>{t.bye&&t.participantId&&c.push({error:"Invalid Assignment",assignment:t})})),{positionAssignments:p,conflicts:I.length,groupedParticipants:h,errors:c}}function $u({candidatePositionAssignments:t,swapOptions:e}){const i=et(e);if(!i)return{error:"No swap options"};const n=i.drawPosition,r=et(i.possibleDrawPositions),a=t.find((t=>t.drawPosition===n)).participantId,o=t.find((t=>t.drawPosition===r)).participantId;return t.forEach((t=>{t.drawPosition===n&&(t.participantId=o),t.drawPosition===r&&(t.participantId=a)})),ut}function Ju({inContextDrawMatchUps:t,drawDefinition:e,candidatesCount:i,participants:n,matchUpsMap:r,structureId:a,structure:o}){o||({structure:o}=Fr({drawDefinition:e,structureId:a})),a||({structureId:a}=o);const{positionAssignments:s}=Pa({structure:o}),{seedAssignments:c}=Ua({drawDefinition:e,structure:o}),u=c.map((t=>t.participantId)).filter(Boolean),{stage:d,stageSequence:l}=o,p=Ia({drawDefinition:e,stageSequence:l,entryStatuses:[Qr,Zr],structureId:a,stage:d}),m=p.filter((t=>!u.includes(t.participantId))).map((t=>t.participantId)),f=s.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));if(m.length>f.length)return{error:"Insufficient drawPositions to accommodate entries"};const{appliedPolicies:h}=Rr({drawDefinition:e});let{avoidance:I}=h||{};if(o.stage===Rn){const t=p.reduce(((t,e)=>(t[e.groupingValue]||(t[e.groupingValue]=[]),t[e.groupingValue].push(e.participantId),t)),{});Object.keys(t).length&&(I||(I={policyName:"Playoff Avoidance"}),I.policyAttributes||(I.policyAttributes=[]),I.policyAttributes.push({groupings:t}))}if(I&&n)return function({unseededParticipantIds:t,inContextDrawMatchUps:e,drawDefinition:i,participants:n,matchUpsMap:r,structureId:a,avoidance:o,entries:s,event:c}){if(!o)return{error:"Missing avoidance policy"};const{policyAttributes:u,roundsToSeparate:d,candidatesCount:l=1}=o,{structure:p}=Fr({drawDefinition:i,structureId:a}),{matchUps:m}=ba({matchUpsMap:r,structure:p,event:c}),{positionAssignments:f}=Pa({structure:p}),h=Ka({participants:n}),I=f.filter((t=>!t.participantId)),v=f.map((t=>t.drawPosition)),g=p.structureType===Ln,y=g?{structure:p,matchUps:m,allDrawPositions:v,roundsToSeparate:d}:{matchUps:m,allDrawPositions:v,roundsToSeparate:d},{drawPositionGroups:U,drawPositionChunks:w}=g?function(t){const{structure:{structures:e}}=t,i=e.map((t=>t.positionAssignments.map((t=>t.drawPosition))));return{drawPositionGroups:i,drawPositionChunks:[i]}}(y):function({matchUps:t,allDrawPositions:e,roundsToSeparate:i}){const n=t.filter((t=>1===t.roundNumber)).map((t=>t.drawPositions)),r=n.flat().sort(Ie),a=Math.max(...r),o=e.filter((t=>t>a)),s=nt(2,r.length).filter((t=>t===V(t))),c=s.slice(0,i||s.length).reverse().map((t=>st(r,t)));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:n,drawPositionChunks:c}}(y),S={};S.groupParticipants=n.filter((t=>t.participantType===Li)).map((t=>t.participantId)),S.teamParticipants=n.filter((t=>t.participantType===Ci)).map((t=>t.participantId)),S.pairParticipants=n.filter((t=>t.participantType===Oi)).map((t=>t.participantId));const N=function({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:"Missing policy attributes"};if(!Array.isArray(n))return{error:"Missing participants"};const r={};return t.forEach((t=>{const a=n.find((e=>e.participantId===t)),{values:o}=_u({policyAttributes:e,idCollections:i,participants:n,participant:a});o&&o.forEach((e=>{r[e]||(r[e]=[]),r[e].includes(t)||r[e].push(t)}))})),r}({targetParticipantIds:t,policyAttributes:u,idCollections:S,participants:n}),P=Object.assign({},...t.map((t=>{const e=Object.keys(N).filter((e=>N[e].includes(t)));return{[t]:e}}))),D=Hu({participantIds:t,positionAssignments:f});if(D.length>I.length)return{error:"More participantIds than unpaired positions"};let T;const M=[],A=D.length,E=nt(0,l).map((()=>Yu({initialPositionAssignments:f,participantsWithGroupings:h,unseededParticipantIds:t,opponentsToPlaceCount:A,pairedPriority:!1,participantIdGroups:P,drawPositionChunks:w,drawPositionGroups:U,policyAttributes:u,idCollections:S,allGroups:N})));if(T=E.reduce(((t,e)=>!t||(e.conflicts||0)<(t.conflicts||0)?e:t),void 0),!T||T.conflicts){const e=nt(0,l).map((()=>Yu({initialPositionAssignments:f,participantsWithGroupings:h,unseededParticipantIds:t,opponentsToPlaceCount:A,pairedPriority:!0,participantIdGroups:P,drawPositionChunks:w,drawPositionGroups:U,policyAttributes:u,idCollections:S,allGroups:N,entries:s})));T=E.concat(...e).filter((t=>{var e;return!(null!==(e=t.errors)&&void 0!==e&&e.length)})).reduce(((t,e)=>!t||(e.conflicts||0)<(t.conflicts||0)?e:t),void 0)}if(!T)return{error:"Could not produce candidate"};const b=(p.positionAssignments||[]).filter((t=>t.participantId)).map((t=>t.participantId));return T.positionAssignments.filter((t=>!b.includes(t.participantId))).forEach((t=>{if(t.participantId&&!t.bye){const n=As({automaticPlacement:!0,drawDefinition:i,structureId:a,matchUpsMap:r,inContextDrawMatchUps:e,...t});null!=n&&n.success||M.push(n)}})),M.length?{error:M,conflicts:T.conflicts}:Object.assign({positionAssignments:T.positionAssignments,conflicts:T.conflicts},ut)}({unseededParticipantIds:m,inContextDrawMatchUps:t,candidatesCount:i,drawDefinition:e,participants:n,matchUpsMap:r,structureId:a,avoidance:I,entries:p});return function({unseededParticipantIds:t,inContextDrawMatchUps:e,unfilledDrawPositions:i,drawDefinition:n,matchUpsMap:r,structureId:a}){const o=Z(i);for(const s of t){const t=As({automaticPlacement:!0,inContextDrawMatchUps:e,drawDefinition:n,participantId:s,drawPosition:o.pop(),matchUpsMap:r,structureId:a});if(t&&t.error)return t}return ut}({unseededParticipantIds:m,inContextDrawMatchUps:t,unfilledDrawPositions:f,drawDefinition:e,structureId:a,matchUpsMap:r})}function Zu({orderedSeedDrawPositions:t,relevantMatchUps:e}){const i=e.map((t=>t.drawPositions)).map((t=>null==t?void 0:t.sort(((t,e)=>t-e)))).filter((t=>(null==t?void 0:t[0])+1===(null==t?void 0:t[1])));return t.map((t=>i.find((e=>null==e?void 0:e.includes(t))))).filter(Boolean).map((e=>null==e?void 0:e.reduce(((e,i)=>t.includes(i)?e:i),void 0))).filter(Boolean)}function Qu({blockOrdered:t=!1,drawDefinition:e,matchUpsMap:i,structureId:n,structure:r,seedsOnly:a,event:o}){r||({structure:r}=Fr({drawDefinition:e,structureId:n})),n||({structureId:n}=r);const{byesCount:s,placedByes:c,relevantMatchUps:u}=function({drawDefinition:t,event:e,matchUpsMap:i,structure:n}){var r;const{matchUps:a,roundMatchUps:o}=ba({drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:n,event:e}),s=o&&o[1]||[],c=(null==n?void 0:n.structureType)===Ln,u=c?a:s,d=c?(null==n||null===(r=n.structures)||void 0===r?void 0:r.length)||0:a.length,{structureId:l,stage:p,stageSequence:m}=n,f=Ia({drawDefinition:t,stageSequence:m,entryStatuses:[Qr,Zr],structureId:l,stage:p}),h=fa({drawDefinition:t,stage:p}),I=f.length+h,{positionAssignments:v,unassignedPositions:g}=Pa({structure:n}),y=g.map((t=>t.drawPosition)),U=v.filter((t=>t.bye)).length,w=v.filter((t=>t.bye)).map((t=>t.drawPosition)),S=u.map((t=>t.drawPositions)).filter((t=>t&&(null==t?void 0:t.reduce(((t,e)=>!w.includes(e)&&t),!0)))).flat(1/0).filter((t=>y.includes(t)));let N=v.length-I;return N>d&&1===n.stageSequence&&n.stage!==bn&&(N=d),{placedByes:U,byesCount:N,relevantMatchUps:u,placedByePositions:w,roundMatchUps:o,positionsToAvoidDoubleBye:S}}({drawDefinition:e,matchUpsMap:i,structure:r,event:o}),d=s-c;if(d<=0)return ut;const{appliedPolicies:l}=Rr({drawDefinition:e}),{strictSeedOrderByePositions:p,blockSeedOrderByePositions:m,isFeedIn:f,isLucky:h}=function({relevantMatchUps:t,appliedPolicies:e,drawDefinition:i,structure:n}){const{validSeedBlocks:r,isFeedIn:a,isLucky:o,isContainer:s}=Ns({appliedPolicies:e,drawDefinition:i,structure:n}),c=function({drawDefinition:t,structure:e}){const{positionAssignments:i}=Pa({structure:e}),{seedAssignments:n}=Ua({drawDefinition:t,structure:e}),r=Object.assign({},...n.filter((t=>t.participantId)).map((t=>({[t.participantId]:t}))));return i.map((t=>r[t.participantId]?{...t,seedNumber:r[t.participantId].seedNumber,seedValue:r[t.participantId].seedValue}:"")).filter(Boolean)}({drawDefinition:i,structure:n}),u=J([].concat(...t.map((t=>t.drawPositions)))),d=c.filter((t=>u.includes(t.drawPosition))),l=[].concat(...r.map((t=>Z(t.drawPositions)))).filter((t=>u.includes(t))),p=(t,e)=>t.seedValue-e.seedValue;return{strictSeedOrderByePositions:Zu({orderedSeedDrawPositions:r.reduce(((t,e)=>{const i=d.filter((t=>{var i;return null===(i=e.drawPositions)||void 0===i?void 0:i.includes(t.drawPosition)})).sort(p);return t.concat(...i)}),[]).map((t=>t.drawPosition)),relevantMatchUps:t}).slice(0,c.length),blockSeedOrderByePositions:Zu({orderedSeedDrawPositions:l,relevantMatchUps:t}).slice(0,c.length),isContainer:s,isFeedIn:a,isLucky:o}}({relevantMatchUps:u,appliedPolicies:l,drawDefinition:e,structure:r}),I=t?m:p,{unseededByePositions:v}=function({appliedPolicies:t,structure:e,isFeedIn:i,isLucky:n}){var r;const a=null==t||null===(r=t.seeding)||void 0===r?void 0:r.seedingProfile,{positionAssignments:o}=Pa({structure:e}),s=o.filter((t=>t.participantId)).map((t=>t.drawPosition)),{matchUps:c,roundMatchUps:u}=ba({matchUpFilters:{isCollectionMatchUp:!1},structure:e}),d=u&&u[1]||[],l=e.structureType===Ln?c:d,p=J([].concat(...l.map((t=>t.drawPositions)))),m=Math.min(...p)-1,f=s.filter((t=>p.includes(t))),h=t=>{const e=Math.ceil(t.length/2),i=[t.slice(0,e),t.slice(e)],n=i.map((t=>[].concat(...t.flat(1/0)).length)),r=Math.min(...n.flat(1/0)),a=Math.max(...n.flat(1/0)),o=n.indexOf(a),s=r!==a,c=Z(i),[u,d]=!r||s?[i[o],i[1-o]]:[c[0],c[1]];return{greaterHalf:u,lesserHalf:d}},I=t=>{const{greaterHalf:e,lesserHalf:i}=h(t),{greaterHalf:n,lesserHalf:r}=h(e),a=Z(n.flat(1/0)).pop();return{newlyFilteredChunks:[...i,...r,n.flat().filter((t=>t!==a))],drawPosition:a}},v=t=>!f.includes(t),g=t=>{let e=st(t.sort(Ie),Math.ceil(t.length/4)).map((t=>t.filter(v)));const i=[].concat(...e.flat(1/0)).length,n=[];for(let r=0;r<i;r++){const{newlyFilteredChunks:t,drawPosition:i}=I(e);n.push(i),e=t}return n},{validSeedBlocks:y}=Ns({allPositions:!0,appliedPolicies:t,structure:e});let U=y.map((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.map((t=>t+m))})).map(g).filter((t=>t.length));if(i){const t=p.length,{seedBlocks:e}=Ss({participantsCount:t,cluster:"CLUSTER"===a});U=e.map((t=>t.map((t=>t+m)))).map(g).filter((t=>t.length))}const w=l.map((t=>t.drawPositions)).map((t=>null==t?void 0:t.sort(((t,e)=>t-e)))).filter((t=>(null==t?void 0:t[0])+1===(null==t?void 0:t[1]))),S=t=>w.reduce(((e,i)=>i.includes(t)?i.reduce(((e,i)=>i!==t?i:e),void 0):e),void 0);return{unseededByePositions:U.map((t=>t.map(S))).flat(1/0).filter(Boolean)}}({appliedPolicies:l,structure:r,isFeedIn:f,isLucky:h}),g=[].concat(...I,...a?[]:v).slice(0,d);for(const y of g){const t=os({drawDefinition:e,drawPosition:y,matchUpsMap:i,structureId:n,structure:r});if(null!=t&&t.error)return t}return ut}function Xu({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=Fr({drawDefinition:t,structureId:i})),i||({structureId:i}=e);const{positionAssignments:n}=Pa({structure:e}),r=n.filter((t=>t.qualifier)).map((t=>t.drawPosition)),{stage:a,stageSequence:o}=e,s=fa({drawDefinition:t,stageSequence:o,stage:a});return{unplacedQualifiersCount:s-r.length,placedQualifiersCount:r.length,positionAssignments:n,qualifiersCount:s}}function td({inContextDrawMatchUps:t,drawDefinition:e,participants:i,groupsCount:n,structureId:r,matchUpsMap:a,structure:o}){const s=[];let c=0;o||({structure:o}=Fr({drawDefinition:e,structureId:r})),r||({structureId:r}=o);const{appliedPolicies:u}=Rr({drawDefinition:e}),{validSeedBlocks:d,error:l}=Ns({structure:o,drawDefinition:e,appliedPolicies:u});return l&&s.push(l),nt(0,n=n||d.length).forEach((()=>{if(c<n){const n=function({drawDefinition:t,structureId:e,participants:i,matchUpsMap:n,inContextDrawMatchUps:r}){const{unplacedSeedParticipantIds:a,unfilledPositions:o}=Ms({drawDefinition:t,structureId:e,randomize:!0}),{appliedPolicies:s}=Rr({drawDefinition:t}),{avoidance:c}=s||{};c&&i&&(null==a||a.length);for(const u of a){const i=o.pop();if(!i)return{error:"Missing drawPosition"};const a=As({automaticPlacement:!0,inContextDrawMatchUps:r,drawDefinition:t,participantId:u,drawPosition:i,matchUpsMap:n,structureId:e});if(!a.success)return a}return ut}({inContextDrawMatchUps:t,drawDefinition:e,participants:i,structureId:r,matchUpsMap:a});n&&n.success&&c++,n.error&&s.push({seedPositionError:n.error})}})),{errors:s}}function ed({applyPositioning:t=!0,inContextDrawMatchUps:e,drawDefinition:i,candidatesCount:n,participants:r,structureId:a,matchUpsMap:o,seedsOnly:s,drawType:c,event:u}){t||(Nt.disableNotifications(),i=me(i,!1,!0));const d=e=>(t||Tt(),e),{structure:l,error:p}=Fr({drawDefinition:i,structureId:a});if(p)return d({error:p});const m=[Qr,Zr],f=Ia({stageSequence:l.stageSequence,stage:l.stage,drawDefinition:i,entryStatuses:m,structureId:a});if(null==f||!f.length)return h={...ut},t||Tt(),h;var h;const{seedingProfile:I}=l;if(o=o||Or({drawDefinition:i}),e||({matchUps:e}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:o})),"WATERFALL"===I){let t=Qu({drawDefinition:i,matchUpsMap:o,structure:l,seedsOnly:s,event:u});if(t.error)return d(t);if(t=td({inContextDrawMatchUps:e,drawDefinition:i,participants:r,matchUpsMap:o,structure:l}),t.error)return d(t)}else{if(c!==Gn){let t=td({inContextDrawMatchUps:e,drawDefinition:i,participants:r,matchUpsMap:o,structure:l});if(t.error)return d(t)}const t=Qu({inContextDrawMatchUps:e,drawDefinition:i,matchUpsMap:o,structure:l,seedsOnly:s,event:u});if(t.error)return d(t)}const v={};if(!s){let t=Ju({inContextDrawMatchUps:e,candidatesCount:n,drawDefinition:i,participants:r,matchUpsMap:o,structure:l});if(t.error)return d(t);if(t.conflicts&&(v.unseededConflicts=t.conflicts),t=function(t){let{structure:e,structureId:i}=t;if(e||({structure:e}=Fr(t)),i||({structureId:i}=e),e.stage===bn)return console.log("Consolation Stage: No Qualifiers"),{error:"Consolation Stage: No Qualifiters"};const{positionAssignments:n,unplacedQualifiersCount:r}=Xu(t),a=n.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));return r>a.length?{error:"Insufficient drawPositions to accommodate qualifiers"}:(nt(0,r).forEach((()=>{const t=a.pop();n.forEach((e=>{e.drawPosition===t&&(e.qualifier=!0,delete e.participantId,delete e.bye)}))})),ut)}({inContextDrawMatchUps:e,drawDefinition:i,participants:r,matchUpsMap:o,structure:l}),t.error)return d(t);t.conflicts&&(v.qualifierConflicts=t.conflicts)}const{positionAssignments:g}=Na({drawDefinition:i,structure:l});return Sr({drawDefinition:i,structureIds:[a]}),t||Tt(),{positionAssignments:g,conflicts:v,...ut}}const id=({finishingPosition:t="ROUND_OUTCOME",structureAbbreviation:e,seedAssignments:i=[],stageSequence:n=1,qualifyingRoundNumber:r,seedingProfile:a,matchUpFormat:o,structureType:s,structureName:c,matchUps:u=[],structureId:d,exitProfile:l,roundOffset:p,roundLimit:m,stageOrder:f,structures:h,stage:I})=>{const v={structureId:d||ve(),structureAbbreviation:e,finishingPosition:t,seedAssignments:i,matchUpFormat:o,stageSequence:n,structureName:c};I&&(v.stage=I),f&&(v.stageOrder=f),m&&(v.roundLimit=m),p&&(v.roundOffset=p),s&&(v.structureType=s),a&&(v.seedingProfile=a),r&&(v.qualifyingRoundNumber=r),l&&(v.exitProfile=l);const g=[].concat(...u.map((t=>t.drawPositions))).filter(Boolean);return h?v.structures=h:(v.matchUps=u,v.positionAssignments=J(g).sort(((t,e)=>t-e)).map((t=>({drawPosition:t})))),v};function nd({finishingPositionOffset:t=0,positionsFed:e,roundsCount:i,roundLimit:n,matchUps:r,lucky:a,fmlc:o}){const{roundProfile:s,roundNumbers:c}=Cr({matchUps:r}),u=Object.values(s).map((({matchUpsCount:t})=>t)),d=t=>[Math.min(...t),Math.max(...t)],l=n?i-n:0,p=Object.assign({},...c.map((n=>{const r=i+1-n-l,c=s[n].matchUpsCount,p={finishingRound:r},m=u.slice(n-1).reduce(((t,e)=>t+e),0),f=1+t+(o&&1!==n?e:0),h=nt(f,a?f+2*c:m+f+1),I=m+1-c,v=d(h.slice(I)),g=d(h.slice(0,I));return p.finishingPositionRange={loser:v,winner:g},{[n]:p}})));return r.forEach((t=>{const e=p[t.roundNumber];t.finishingRound=e.finishingRound,t.finishingPositionRange=e.finishingPositionRange})),r}function rd({idPrefix:t,roundNumber:e,roundPosition:i,uuids:n}){return t?`${t}-${e}-${i}`:(null==n?void 0:n.pop())||ve()}function ad({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:o,nodes:s}){let c=0;const u=[];let d=1;const l=i-1,p=s.length;for(;c<p;){const p=s[c],m=s[c+1];l&&(p.roundNumber=l),m&&l&&(m.roundNumber=l);const f={roundPosition:d,children:[p,m],matchUpId:rd({roundPosition:d,roundNumber:i,idPrefix:r,uuids:o})};u.push(f);const h={matchUpId:f.matchUpId,roundNumber:i,roundPosition:d,matchUpStatus:A,drawPositions:f.children.map((t=>t.drawPosition))};t&&(h.matchUpType=e),a&&(h.isMock=!0),n.push(h),d++,c+=2}return{roundNodes:u,matchUps:n}}function od({qualifyingRoundNumber:t,finishingPositionOffset:e,qualifyingPositions:i,matchUpType:n,roundLimit:r,idPrefix:a,drawSize:o,isMock:s,uuids:c}){if(isNaN(o)||!G(o)||o<2)return{matchUps:[],roundsCount:0};const u=nt(1,parseInt(o)+1).map((t=>({drawPosition:t})));let d,l=[],p=1;for(({roundNodes:d,matchUps:l}=ad({roundNumber:p,matchUpType:n,idPrefix:a,matchUps:l,isMock:s,nodes:u,uuids:c})),p++,r=r||t;d.length>1;)i&&d.length===i&&(r=p-1),({roundNodes:d,matchUps:l}=ad({nodes:d,roundNumber:p,matchUpType:n,idPrefix:a,matchUps:l,isMock:s,uuids:c})),p++;const m=p-1;return l=nd({finishingPositionOffset:e,roundsCount:m,roundLimit:r,matchUps:l}),r&&(l=l.filter((t=>t.roundNumber<=r))),{matchUps:l,roundsCount:m,roundLimit:r}}function sd({structureName:t="VOLUNTARY_CONSOLATION",structureAbbreviation:e,drawDefinition:i,participants:n,matchUpType:r,structureId:a,automated:o,drawSize:s,event:c}){if(!i)return{error:mt};r=r||i.matchUpType;const{matchUps:u}=od({matchUpType:r,drawSize:s}),d=id({stage:"VOLUNTARY_CONSOLATION",matchUps:u,matchUpType:r,structureName:t,structureAbbreviation:e,structureId:a});return i.structures.push(d),o&&ed({structureId:a||d.structureId,drawDefinition:i,participants:n,event:c}),Sr({drawDefinition:i,structureIds:[a]}),{...ut}}function cd({targetEntryRound:t=1,sourceRoundNumber:e,sourceStructureId:i,targetStructureId:n,drawDefinition:r}){if(!r)return{error:mt};const a={linkType:"WINNER",source:{roundNumber:e,structureId:i},target:{feedProfile:"DRAW",roundNumber:t,structureId:n}};r.links.push(a),Sr({drawDefinition:r})}function ud({participantIdPairings:t,matchUpIds:e=[],drawDefinition:i,matchUpsCount:n,roundNumber:r,structureId:a,newRound:o}){var s;if("object"!=typeof i)return{error:mt};if("string"!=typeof a)return{error:"Missing structureId"};if(t&&!Array.isArray(t)||n&&!z(n)||e&&!Array.isArray(e)||!t&&!n)return{error:gt};const c=null==i||null===(s=i.structures)||void 0===s?void 0:s.find((t=>t.structureId===a));let u;const d=(null==c?void 0:c.matchUps).reduce(((t,e)=>(e.roundPosition&&(u=!0),e.roundNumber>t?e.roundNumber:t)),0);if(c.structures||u||"ROUND_OUTCOME"===c.finishingPosition)return{error:"Invalid structure"};if(r&&r-1>d)return{error:gt};const l=r||(o?d+1:d||1),p=(t=t||nt(0,n).map((()=>({participantIds:[]})))).map((t=>{const i=((null==t?void 0:t.participantIds)||[]).concat([void 0,void 0]).slice(0,2).map(((t,e)=>fe({sideNumber:e+1,participantId:t})));return{matchUpId:e.pop()||ve(),roundNumber:l,matchUpStatus:A,sides:i}})),m=function({drawDefinition:t,structureId:e,matchUps:i}){var n;if("object"!=typeof t)return{error:mt};if("string"!=typeof e)return{error:"Missing structureId"};if(!Array.isArray(i))return{error:gt};const r=null===(n=t.structures)||void 0===n?void 0:n.find((t=>t.structureId===e));if(!r)return{error:"structure not found"};const a=(null==r?void 0:r.matchUps).find((t=>!!t.roundPosition));return r.structures||a||"ROUND_OUTCOME"===r.finishingPosition?{error:"Invalid structure"}:(r.matchUps.push(...i),gr({drawDefinition:t,matchUps:i}),Sr({drawDefinition:t,structureIds:[e]}),{...ut})}({drawDefinition:i,structureId:a,matchUps:p});return m.error?m:{matchUpsCount:p.length,...ut}}function dd({event:t,drawId:e,drawDefinition:i,drawName:n}){var r;if(!n||"string"!=typeof n)return{error:gt,drawName:n};const{flightProfile:a}=Qo({event:t}),o=null==a||null===(r=a.flights)||void 0===r?void 0:r.find((t=>t.drawId===e));return o&&(o.drawName=n,Hr({event:t,extension:{name:"flightProfile",value:{...a,flights:a.flights}}})),i&&(i.drawName=n),o||i?ut:{error:mt}}function ld({drawDefinition:t,stage:e,drawSize:i}){if(!t)return{error:mt};if(!pa({drawDefinition:t,stage:e}))return{error:"Invalid stage"};if(i<va({drawDefinition:t,stage:e})+fa({drawDefinition:t,stage:e}))return{error:"Cannot set drawSize to be less than existing entries"};const{entryProfile:n}=zr({attributes:[{[e]:{drawSize:i}}],drawDefinition:t});return Sr({drawDefinition:t}),{...ut,entryProfile:n}}function pd({qualifiersCount:t=0,drawDefinition:e,stage:i}){if(!e)return{error:mt};if(!pa({drawDefinition:e,stage:i}))return{error:"Invalid stage"};if(i!==An)return{error:"qualifiersCount can only be set for main stage"};const n=ma({drawDefinition:e,stage:i}),r=ga({drawDefinition:e,stage:i});return va({drawDefinition:e,stage:i})+r+t>n?{error:"Total stage Entries cannot be greater than drawPositions"}:(zr({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),Sr({drawDefinition:e}),{...ut})}function md({drawDefinition:t,drawSize:e}){if(!t)return{error:mt};const i=ld({drawDefinition:t,stage:"VOLUNTARY_CONSOLATION",drawSize:e});return i.error?i:(dd({drawDefinition:t}),ut)}function fd({drawDefinition:t,structureId:e}){const{structure:i,error:n}=Fr({drawDefinition:t,structureId:e});if(n)return{error:n};const{matchUps:r}=ba({structure:i});return Cr({matchUps:r})}function hd({drawDefinition:t,structureId:e,finishingPositions:i}){const{roundProfile:n}=fd({drawDefinition:t,structureId:e});return Object.keys(n).reduce(((t,e)=>(Id(n[e]).forEach((n=>{i.forEach((i=>{(function({position:t,rangeDefinition:e}){if(!Array.isArray(e))return!1;if(e.reduce(((t,e)=>t||isNaN(e)),!1))return!1;const[i,n]=e;return nt(i,(n||i)+1).includes(t)})({position:i,rangeDefinition:n})&&(t[i]={roundNumber:e})}))})),t)),{})}function Id(t){var e,i;return[J((null==t||null===(e=t.finishingPositionRange)||void 0===e?void 0:e.loser)||[]),J((null==t||null===(i=t.finishingPositionRange)||void 0===i?void 0:i.winner)||[])]}function vd({drawDefinition:t}){if(!t)return{error:mt};const e=(t.structures||[]).filter((t=>t.structureType!==En)).map((({structureId:e})=>{const{roundProfile:i}=fd({drawDefinition:t,structureId:e});return Object.values(i).map(Id).flat()})).flat(),i=e.filter((t=>1===t.length)).sort(Ie).flat(),n=e.flat();return{positionsNotPlayedOff:nt(Math.min(...n),Math.max(...n)+1).filter((t=>!i.includes(t))),positionsPlayedOff:i}}function gd({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:mt};if(!n)return{error:"Missing structureId"};if(!e)return{error:It,message:"missing playoffPositions"};const{positionsPlayedOff:r,error:a}=vd({drawDefinition:i});if(a)return{error:a};const o=hd({finishingPositions:e.filter((t=>!r.includes(t))),drawDefinition:i,structureId:n}),s=Object.values(o).reduce(((t,e)=>t.includes(e.roundNumber)?t:t.concat(e.roundNumber)),[]).map((t=>parseInt(t))).filter((e=>!t.includes(parseInt(e)))),c=hd({drawDefinition:i,structureId:n,finishingPositions:r}),u=Object.values(c).reduce(((t,e)=>t.includes(e.roundNumber)?t:t.concat(e.roundNumber)),[]).map((t=>parseInt(t))),d=s.filter((t=>!u.includes(t))).sort(Ie),{roundProfile:l}=fd({drawDefinition:i,structureId:n}),p=d.map((t=>{const e=l[t].finishingPositionRange.loser,[i,n]=e;return nt(i,(n||i)+1)})).flat().sort(Ie),m=d.map((t=>{const e=l[t].finishingPositionRange.loser,[i,n]=e;return{roundNumber:t,finishingPositions:nt(i,(n||i)+1),finishingPositionRange:e.join("-")}}));return{sourceRounds:[...d,...u],playoffRoundsRanges:m,playoffSourceRounds:d,playedOffSourceRounds:u,playoffPositionsReturned:p}}function yd({drawDefinition:t,structureId:e}){if(!t)return{error:mt};let{structures:i}=kr({stageSeqence:1,drawDefinition:t,stage:An});const{positionsNotPlayedOff:n,positionsPlayedOff:r}=vd({drawDefinition:t});({structures:i}=kr({drawDefinition:t}));const a=i.filter((t=>!e||t.structureId===e)),o={};for(const s of a){const e=null==s?void 0:s.structureId,{playoffSourceRounds:i,playoffRoundsRanges:r,error:a}=Ud({playoffPositions:n,drawDefinition:t,structure:s});if(a)return{error:a};o[e]={playoffRoundsRanges:r,playoffRounds:i,structureId:e}}return e?{positionsPlayedOff:r,...o[e]}:{positionsPlayedOff:r,availablePlayoffRounds:Object.values(o)}}function Ud({playoffPositions:t,drawDefinition:e,structure:i}){var n;if(i.structureType===Ln)return{playoffSourceRounds:[],playoffRoundsRanges:[]};const r=null==i?void 0:i.structureId,{links:a}=Ja({drawDefinition:e,structureId:r});return gd({excludeRoundNumbers:(null==a||null===(n=a.source)||void 0===n?void 0:n.filter((t=>"FIRST_MATCHUP"!==t.linkCondition)).map((t=>{var e;return null===(e=t.source)||void 0===e?void 0:e.roundNumber})))||[],playoffPositions:t,drawDefinition:e,structureId:r})}function wd(t){return t.matchUpStatus===y?t.sides.reduce(((t,e)=>e.participantId||t),void 0):t.winningSide?t.sides.reduce(((e,i)=>i.sideNumber===t.winningSide?i.participantId:e),void 0):void 0}function Sd({tieFormat:t,uuids:e,isMock:i}){const{collectionDefinitions:n}=t||{};return{tieMatchUps:(n||[]).map((t=>{const{matchUpCount:n,matchUpFormat:r,matchUpType:a,collectionId:o}=t||{};return nt(0,n||0).map((t=>({isMock:i,collectionId:o,matchUpType:a,matchUpFormat:r,collectionPosition:t+1,matchUpId:(null==e?void 0:e.pop())||ve(),sides:[{sideNumber:1},{sideNumber:2}]})))})).filter(Boolean).flat()}}function Nd({includeMatchUpType:t,drawPosition:e,matchUpType:i,roundNumber:n,idPrefix:r,matchUps:a,uuids:o,nodes:s,fed:c}){const u=s.length,d=e?e-u:void 0,l=nt(0,u).map((t=>d?d+t:void 0)),p=[];for(let m=0;m<u;m++){const e=l.shift(),u={feed:!0,fed:c+1,drawPosition:e},d=s[m];d.roundNumber=n-1;const f={roundNumber:n,matchUpId:rd({roundPosition:d.roundPosition,roundNumber:n,idPrefix:r,uuids:o}),roundPosition:d.roundPosition,drawPositions:[void 0,e]};t&&(f.matchUpType=i),a.push(f);const h={children:[d,u]};p.push(h)}return{roundNodes:p,matchUps:a,drawPosition:e?e-u:void 0}}function Pd({linkFedFinishingRoundNumbers:t=[],linkFedRoundNumbers:e=[],finishingPositionOffset:i,feedRoundsProfile:n=[],feedRounds:r=0,skipRounds:a=0,feedsFromFinal:o,isConsolation:s,baseDrawSize:c,matchUpType:u,idPrefix:d,drawSize:l,isMock:p,uuids:m,fmlc:f}){const h=function({drawSize:t}){return nt(0,Math.ceil(Math.log(t)/Math.log(2))).reverse().map((t=>Math.pow(2,t)))}({drawSize:c=c||function(t){const e=V(t);return e>t?e/2:e}(l)}),I=h.length;let v=0;if(n.length)v=n.reduce(((t,e)=>t+e),0);else if(l){let t=l-c;n=h.filter((e=>e<=t&&(t-=e,!0))),v=n.reduce(((t,e)=>t+e),0),r=n.length}else a>=I&&(r=0),o&&(r=I-o,a=0),n=h.filter(((t,e)=>o&&!r||r&&e>=a+r||e<a?0:t)),v=n.reduce(((t,e)=>t+e),0),l=c+v,r=n.length;const g=[...h,...n].sort(((t,e)=>e-t)),y=g.length,U=[...e.map((t=>t-1)),...t.map((t=>y-t))].map((t=>g[t])).reduce(((t,e)=>t+e),0);v-=U;let w,S=0,N=[],P=1,D=nt(0,c).map(((t,e)=>({drawPosition:e+1+v}))),T=v+1;for(const A of h){if(({roundNodes:w,matchUps:N}=ad({roundNumber:P,matchUpType:u,idPrefix:d,matchUps:N,isMock:p,nodes:D,uuids:m})),P++,n.includes(A)){const i=nt(0,Q(n)[A]),r=y+1-P,a=t.includes(r)||e.includes(P);for(const t of i){const e=!a&&T||void 0;({roundNodes:w,matchUps:N,drawPosition:T}=Nd({drawPosition:e,nodes:w,roundIteration:t,roundNumber:P,matchUpType:u,idPrefix:d,matchUps:N,uuids:m,fed:S})),P++,S+=1}}D=w}y!==P-1&&console.log("ERROR"),N=nd({finishingPositionOffset:s?c-v:i,positionsFed:v,roundsCount:y,matchUps:N,fmlc:f});const M=w&&w.length?w[0]:w;return M&&(M.roundNumber=P-1,M.matchUps=N),{draw:M,matchUps:N,roundsCount:y}}function Dd(t){const{structure:e,childStructures:i}=Td(t),n=[e.structureId,...i.map((({structureId:t})=>t))];return t.drawDefinition.structures.sort(xr),Sr({drawDefinition:t.drawDefinition,structureIds:n}),Object.assign({structure:e,childStructures:i},ut)}function Td({finishingPositionOffset:t=0,playoffStructureNameBase:e,finishingPositionNaming:i,finishingPositionLimit:n,playoffAttributes:r,stageSequence:a=1,exitProfile:o="0",exitProfileLimit:s,roundOffsetLimit:c,roundOffset:u=0,drawDefinition:d,staggeredEntry:l,sequenceLimit:p,stage:m=An,matchUpType:f,idPrefix:h,drawSize:I,isMock:v,uuids:g}){if(r&&s&&(!r||!r[o])||I<2||p&&a>p)return{};f=f||(null==d?void 0:d.matchUpType);const y=t+1,U=`${y}-${t+I}`,w=r&&r[o],S=e&&`${e} `||"",N=i&&i[U],P=(null==N?void 0:N.name)||(null==w?void 0:w.name)||`${S}${U}`,D=(null==N?void 0:N.abbreviation)||(null==w?void 0:w.abbreviation),T={idPrefix:h&&`${h}-${P}-RP`,finishingPositionOffset:t,matchUpType:f,drawSize:I,isMock:v,uuids:g},{matchUps:M}=l?Pd(T):od(T),A=id({structureId:null==g?void 0:g.pop(),structureAbbreviation:D,stageSequence:a,structureName:P,matchUpType:f,roundOffset:u,exitProfile:o,matchUps:M,stage:m});d.structures.push(A),gr({drawDefinition:d,matchUps:M});const E=Math.ceil(Math.log(I)/Math.log(2)),b=nt(1,(c?Math.min(c-u,E):!n||y<n?E:0)+1).map((function(l){const v=I/Math.pow(2,l);if(v<2)return;const y=I/Math.pow(2,l)+t;if(y+1>n)return;const{structure:U,structureName:w,childStructures:S}=Td({finishingPositionOffset:y,exitProfile:`${o}-${l}`,roundOffset:u+l,stageSequence:a+1,drawSize:v,playoffStructureNameBase:e,finishingPositionNaming:i,finishingPositionLimit:n,playoffAttributes:r,exitProfileLimit:s,roundOffsetLimit:c,drawDefinition:d,sequenceLimit:p,matchUpType:f,idPrefix:h,uuids:g,stage:m}),N={linkType:Fn,source:{roundNumber:l,structureName:P,structureId:null==A?void 0:A.structureId},target:{roundNumber:1,feedProfile:xn,structureName:w,structureId:null==U?void 0:U.structureId}};return A&&U&&d.links.push(N),{structure:U,childStructures:S}})).filter(Boolean);return{structure:A,structureName:P,childStructures:b}}function Md(t){var e;const{playoffRoundsRanges:i,playoffRounds:n,error:r}=yd(t);if(r)return{error:r};const{playoffSourceRounds:a,playoffRoundsRanges:o,playoffPositionsReturned:s,error:c}=gd(t);if(c)return{error:c};const{structureId:u,playoffStructureNameBase:d,playoffAttributes:l,playoffPositions:p,exitProfileLimit:m,drawDefinition:f,roundProfiles:h,roundNumbers:I,idPrefix:v,isMock:g,event:y,uuids:U}=t,w=(null==h?void 0:h.length)&&Object.assign({},...h),S=I||"object"==typeof h&&h.map((t=>Object.keys(t))).flat(),N=S&&S.map((t=>!isNaN(t)&&parseInt(t))).filter(Boolean);if(N){if(!Array.isArray(N))return{error:gt,validRoundNumbers:N};N.forEach((t=>{if(!n.includes(t))return{error:gt,roundNumber:t}}))}p&&p.forEach((t=>{if(!s.includes(t))return{error:gt,playoffPosition:t}}));const{structure:P}=Fr({structureId:u,drawDefinition:f}),D=N||a,T=N?i:o,M=[],A=[];for(const O of D){const t=T.find((t=>t.roundNumber===O));if(!t)return{error:gt,message:{roundNumber:O}};const e=t.finishingPositions.length,i=Math.min(...t.finishingPositions)-1,n=2,r=w&&w[O]&&n+w[O]-1,a=Dd({exitProfile:`0-${O}`,playoffStructureNameBase:d,finishingPositionOffset:i,playoffAttributes:l,exitProfileLimit:m,stage:Rn,drawDefinition:f,roundOffset:0,sequenceLimit:r,stageSequence:n,drawSize:e,idPrefix:v,isMock:g,uuids:U});if(a.error)return a;if(a.structure){A.push(a.structure.structureId);const t={linkType:Fn,source:{structureId:u,roundNumber:O},target:{structureId:a.structure.structureId,feedProfile:xn,roundNumber:1}};M.push(t)}}if(!A.length)return{error:gt};f.links=(f.links||[]).concat(...M);const{matchUps:E,matchUpsMap:b}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:f}),R=E.filter((({structureId:t})=>A.includes(t))).map(br),C=null==b||null===(e=b.drawMatchUps)||void 0===e?void 0:e.filter((({matchUpId:t})=>R.includes(t)));if(C.length){const t=f.tieFormat||(null==y?void 0:y.tieFormat)||void 0;t&&C.forEach((e=>{const{tieMatchUps:i}=Sd({tieFormat:t,isMock:g});Object.assign(e,{tieMatchUps:i,matchUpType:ni})}))}return E.filter((t=>Ue(t)&&t.structureId===u)).forEach((t=>{const{matchUpId:e,score:i,winningSide:n}=t,r=Za({inContextDrawMatchUps:E,drawDefinition:f,matchUpId:e,structure:P}),a=bs({inContextDrawMatchUps:E,drawDefinition:f,matchUpsMap:b,winningSide:n,targetData:r,matchUpId:e,structure:P,matchUp:t,score:i});a.error&&console.log(a.error)})),t.goesTo&&go({inContextDrawMatchUps:E,drawDefinition:f,matchUpsMap:b}),Sr({drawDefinition:f,structureIds:A}),{...ut}}function Ad({drawDefinition:t,structureId:e,matchUpIds:i=[]}){var n;if("object"!=typeof t)return{error:mt};if("string"!=typeof e)return{error:"Missing structureId"};if(!Array.isArray(i))return{error:gt};const r=null===(n=t.structures)||void 0===n?void 0:n.find((t=>t.structureId===e));if(!r)return{error:"structure not found"};const a=null==r?void 0:r.matchUps,o=a.find((t=>!!t.roundPosition));if(r.structures||o||"ROUND_OUTCOME"===r.finishingPosition)return{error:"Invalid structure"};const s=a.filter((({matchUpId:t})=>i.includes(t))),c=Tr(s),u=s.map((({drawPositions:t})=>t)).flat();if(u.length){r.positionAssignments=r.positionAssignments.filter((({drawPosition:t})=>!u.includes(t))).sort(((t,e)=>t.drawPosition-e.drawPosition)),r.matchUps=r.matchUps.filter((({matchUpId:t})=>!c.includes(t)));const i=Object.assign({},...r.positionAssignments.map((({drawPosition:t},e)=>({[t]:e+1}))));r.positionAssignments=r.positionAssignments.map((t=>({...t,drawPosition:i[t.drawPosition]})));const n=t=>{var e;return t.drawPositions=(null===(e=t.drawPositions)||void 0===e?void 0:e.map((t=>i[t])))||[]};r.matchUps.forEach(n),yr({drawDefinition:t,matchUpIds:c,action:"deleteAdHocMatchUps"}),Sr({drawDefinition:t,structureIds:[e]})}return{...ut}}function Ed({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){const o=t.matchUps.reduce(((t,e)=>(e.drawPositions||[]).filter(Boolean).length&&!t.includes(e.roundNumber)?t.concat(e.roundNumber):t),[]),s=(null==r?void 0:r.roundGroupedOrder)||[],c=null==r?void 0:r.roundFeedProfiles;return nt(1+e,n+1+e).map((n=>{const r=c&&c[n-1]?c[n-1]:n%2?xn:"BOTTOM_UP",u=n-e<=2?n-e:2*(n-e-2)+2,d={linkType:Fn,source:{roundNumber:n,structureId:i.structureId},target:{feedProfile:r,roundNumber:u,structureId:t.structureId}},l=s[n-1];return l&&(d.target.groupedOrder=l),Pt()&&(d.source.structureName=i.structureName,d.target.structureName=t.structureName),2===n&&a&&(d.linkCondition="FIRST_MATCHUP",d.target.feedProfile=xn),o.includes(u)?d:void 0})).filter(Boolean)}function bd(t={}){const{finishingPositionOffset:e,stageSequence:i=1,feedsFromFinal:n,staggeredEntry:r,drawDefinition:a,structureName:o,matchUpType:s,feedPolicy:c,feedRounds:u,idPrefix:d,drawSize:l,isMock:p,uuids:m,fmlc:f}=t,h={finishingPositionOffset:e,matchUpType:s,drawSize:l,idPrefix:d,isMock:p,uuids:m},{matchUps:I}=r?Pd(h):od(h),v=id({structureName:o||An,structureId:null==m?void 0:m.pop(),stageSequence:i,stage:An,matchUpType:s,matchUps:I});a.structures.push(v);const g=l/2,{matchUps:y,roundsCount:U}=Pd({finishingPositionOffset:g,idPrefix:d&&`${d}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:g,matchUpType:s,feedRounds:u,isMock:p,uuids:m,fmlc:f}),w=id({matchUps:y,structureId:null==m?void 0:m.pop(),structureName:bn,stage:bn,stageSequence:1,matchUpType:s});a.structures.push(w);const S=Ed({consolationStructure:w,mainStructure:v,roundsCount:U,feedPolicy:c,fmlc:f});return a.links=a.links.concat(...S),Object.assign({structures:[v,w],links:a.links},{...ut})}function Rd({structureName:t=An,stageSequence:e=1,structureOptions:i,seedingProfile:n,drawDefinition:r,stage:a=An,matchUpType:o,drawSize:s,idPrefix:c,uuids:u}){const{groupCount:d,groupSize:l}=function({structureOptions:t,drawSize:e}){let i=null==t?void 0:t.groupSize;const n=function({drawSize:t,groupSizeLimit:e=10}){return nt(3,e+1).filter((e=>Math.ceil(t/e)*e-t<e))}({drawSize:e,groupSizeLimit:(null==t?void 0:t.groupSizeLimit)||8}),r=Math.max(...n);i&&n.includes(i)||(i=i&&i>4||!n.includes(4)?r:4);return{groupSize:i,groupCount:Math.ceil(e/i)}}({structureOptions:i,drawSize:s}),p="WIN_RATIO",m=nt(1,d+1).map((t=>id({structureName:`Group ${t}`,matchUps:Od({groupSize:l,structureOrder:t,matchUpType:o,drawSize:s,idPrefix:c}),structureId:null==u?void 0:u.pop(),structureType:"ITEM",finishingPosition:p,structureOrder:t,matchUpType:o}))),f=id({structureId:null==u?void 0:u.pop(),structureType:Ln,finishingPosition:p,seedingProfile:n,structureName:t,stageSequence:e,matchUpType:o,structures:m,stage:a});return r.structures.push(f),Object.assign({structures:[f],groupCount:d,groupSize:l},{...ut})}function Cd({finishingPositions:t,playoffStructure:e,mainStructure:i}){return{linkType:"POSITION",source:{finishingPositions:t,structureId:i.structureId},target:{roundNumber:1,feedProfile:"DRAW",structureId:e.structureId}}}function Od({structureOrder:t,matchUpType:e,groupSize:i,idPrefix:n,drawSize:r,uuids:a}){const o=(t-1)*i,s=nt(1+o,i+1+o),{uniqueMatchUpGroupings:c}=qu({drawPositions:s}),u=function({groupSize:t,drawPositionOffset:e}){const i=t=>[...Array(t)].map(((t,e)=>e)),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map((()=>[]));let a=n.slice(0,n.length/2),o=n.slice(n.length/2);n.slice(1).forEach(((t,e)=>{a.forEach(((t,i)=>{r[e].push([a[i],o[i]])}));const i=a.shift(),n=a.pop(),s=o.shift();a=[].concat(i,s,...a),o=[].concat(...o,n)}));const s=a.shift(),c=a.pop(),u=o.shift();a=[].concat(s,u,...a),o=[].concat(...o,c);const d=t=>t[0].reduce(((t,e)=>t+e));return r.reverse().sort(((t,e)=>d(t)-d(e))).map((i=>i.filter((e=>e.every((e=>e<=t)))).map((t=>Wu(t.map((t=>t+e)))))))}({groupSize:i,drawPositionOffset:o});return c.map((function(i){const o=function(t){return u.reduce(((e,i,n)=>i.includes(t)?n+1:e),void 0)}(Wu(i)),s=[1,r],c=function({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:(null==r?void 0:r.pop())||ve()}({structureOrder:t,drawPositions:i,roundNumber:o,idPrefix:n,uuids:a});return{matchUpStatus:o?A:y,matchUpType:e,finishingPositionRange:{winner:s,loser:s},drawPositions:i,roundNumber:o,matchUpId:c}})).sort(((t,e)=>(t.roundNumber||9999)-(e.roundNumber||9999)))}function Ld(t={}){var e,i;const{drawType:n=jn,stageSequence:r=1,drawDefinition:a,staggeredEntry:o,structureName:s,goesTo:c=!0,isMock:u,uuids:d}=t;if(!a)return{error:mt};let{tieFormat:l,matchUpType:p}=t;l=l||a.tieFormat||void 0,p=p||a.matchUpType||ei;const m=ma({drawDefinition:a,stage:An});m||ld({drawSize:t.drawSize,drawDefinition:a,stage:An});const f=(null===(e=t.qualifyingProfiles)||void 0===e?void 0:e.length)&&function({qualifyingProfiles:t,drawDefinition:e,matchUpType:i,idPrefix:n,isMock:r,uuids:a}){const o=[],s=(t,e)=>t.stageSequence-e.stageSequence;let c,u,d=0,l=0,p=0;for(const f of t.sort(s)){var m;const{drawSize:s,qualifyingRoundNumber:h,qualifyingPositions:I,structureName:v}=f;if(!s||!z(s))return{error:"Missing drawSize"};const{matchUps:g,roundLimit:y}=od({qualifyingPositions:I,qualifyingRoundNumber:h,idPrefix:n,drawSize:s,isMock:r,uuids:a});p+=1;const U=v||(t.length>1?`${En} ${p}`:En),w=id({structureName:U,qualifyingRoundNumber:y,structureId:null==a?void 0:a.pop(),stage:En,stageSequence:p,matchUpType:i,roundLimit:y,matchUps:g});p>1?(cd({sourceStructureId:u,targetStructureId:w.structureId,sourceRoundNumber:c,drawDefinition:e}),d+=s-l):d+=s,l=null===(m=g.filter((t=>t.roundNumber===y)))||void 0===m?void 0:m.length,u=w.structureId,c=y,o.push(w)}return{qualifyingDrawPositionsCount:d,finalQualifyingRoundNumber:c,finalQualifyingStructureId:u,qualifiersCount:l,structures:o,...ut}}({qualifyingProfiles:t.qualifyingProfiles,idPrefix:t.idPrefix,drawDefinition:a,matchUpType:p,isMock:u,uuids:d});if(null!=f&&f.error)return f;const{qualifiersCount:h=0,qualifyingDrawPositionsCount:I}=f||{};if(I){if(a.structures.push(...f.structures),!ma({stage:En,drawDefinition:a})){const t=ld({drawSize:I,stage:En,drawDefinition:a});if(t.error)return t}const t=pd({drawDefinition:a,qualifiersCount:h,stage:An});if(t.error)return t}const v=t.drawSize||m;Object.assign(t,fe({drawSize:v,matchUpType:p,tieFormat:l}));const g=G(2*v/3);if(v<2||!o&&![_n,kn,Gn].includes(n)&&(n===Kn&&v<3||n===Bn&&!g||![Kn,Bn,Yn].includes(n)&&!G(v)))return{error:"Invalid drawSize",drawSize:v};const y=Zn.includes(n);if(parseInt(v)<4&&y)return{error:"Invalid drawSize"};const U=1===r?1:void 0,{structures:w}=kr({drawDefinition:a,stageSequence:r,stage:An});if(w.length>=U)return{error:"stageSequence limit"};const S={[kn]:()=>{const t=id({structureName:s||An,finishingPosition:"WIN_RATIO",structureId:null==d?void 0:d.pop(),stageSequence:r,matchUps:[],matchUpType:p,stage:An});return a.structures.push(t),Object.assign({structures:[t]},ut)},[Gn]:()=>{const{matchUps:e}=function(t){const{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:o,isMock:s,uuids:c}=t;if(!z(o)||o<2)return{matchUps:[],roundsCount:0};if(G(o))return od(t);const u=function(t){const e=parseInt(t);let i=e%2?e+1:e;const n=[{participantsCount:i,preFeedRound:!!(Math.ceil(i/2)%2)}];for(;i>2;){const t=Math.ceil(i/2),e=1===t,r=!(e||!(t%2));i=!e&&r?t+1:t;const a=!!(2!==i&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:a,feedRound:r})}return n}(o),d=nt(1,u.shift().participantsCount+1).map((t=>({drawPosition:t})));let l=[],p=1;({matchUps:l}=ad({roundNumber:p,matchUpType:r,idPrefix:a,matchUps:l,isMock:s,nodes:d,uuids:c})),p++;let m=t.roundLimit||e;for(const h of u){const t=h.participantsCount/2,e=nt(1,t+1);n&&t===n&&(m=p-1);const i=e.map((t=>{const e=rd({roundPosition:t,roundNumber:p,idPrefix:a,uuids:c});return{roundPosition:t,roundNumber:p,matchUpId:e}}));l.push(...i),p++}const f=p-1;return l=nd({finishingPositionOffset:i,lucky:!0,roundsCount:f,roundLimit:m,matchUps:l}),m&&(l=l.filter((t=>t.roundNumber<=m))),{matchUps:l,roundsCount:f,roundLimit:m}}(t),i=id({structureName:s||An,structureId:null==d?void 0:d.pop(),stageSequence:r,matchUpType:p,stage:An,matchUps:e});return a.structures.push(i),Object.assign({structures:[i]},ut)},[jn]:()=>{const{matchUps:e}=od(t),i=id({structureName:s||An,structureId:null==d?void 0:d.pop(),stageSequence:r,matchUpType:p,stage:An,matchUps:e});return a.structures.push(i),Object.assign({structures:[i]},ut)},[Bn]:()=>function({drawDefinition:t,structureName:e,matchUpType:i,idPrefix:n,drawSize:r,isMock:a,uuids:o}){const{matchUps:s}=Pd({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:i,idPrefix:n,isMock:a}),c=id({structureName:e||An,structureId:null==o?void 0:o.pop(),stageSequence:1,stage:An,matchUpType:i,matchUps:s});t.structures.push(c);const u=r/2,{matchUps:d}=Pd({finishingPositionOffset:u,idPrefix:n&&`${n}-c`,drawSize:r-1,isConsolation:!0,matchUpType:i,isMock:a,uuids:o}),l=id({matchUps:d,structureId:null==o?void 0:o.pop(),structureName:"BACKDRAW",stageSequence:2,matchUpType:i,stage:An});t.structures.push(l);const{matchUps:p}=od({idPrefix:n&&`${n}-p1t2`,drawSize:2,matchUpType:i,isMock:a}),m=id({matchUps:p,structureId:null==o?void 0:o.pop(),structureName:"DECIDER",stageSequence:3,stage:An,matchUpType:i});t.structures.push(m);const f=function({mainStructure:t,consolationStructure:e,deciderStructure:i}){const n=e.matchUps.reduce(((t,e)=>(e.drawPositions||[]).filter(Boolean).length&&!t.includes(e.roundNumber)?t.concat(e.roundNumber):t),[]),r=t.matchUps.reduce(((t,e)=>!t||e.roundNumber>t?e.roundNumber:t),void 0),a=e.matchUps.reduce(((t,e)=>!t||e.roundNumber>t?e.roundNumber:t),void 0);return[...[1,2].map((i=>{const n=i%2?xn:"BOTTOM_UP";return{linkType:Fn,source:{roundNumber:i,structureId:t.structureId},target:{feedProfile:n,roundNumber:1,positionInterleave:{offset:i-1,interleave:1},structureId:e.structureId}}})),...n.slice(1).map(((i,r)=>{const a=n.indexOf(i)%2?xn:"BOTTOM_UP";return{linkType:Fn,source:{roundNumber:3+r,structureId:t.structureId},target:{feedProfile:a,roundNumber:i,structureId:e.structureId}}})),{linkType:"WINNER",source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:xn,roundNumber:r,structureId:t.structureId}},{linkType:"WINNER",source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:xn,roundNumber:1,structureId:i.structureId}},{linkType:Fn,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:xn,roundNumber:1,structureId:i.structureId}}]}({mainStructure:c,consolationStructure:l,deciderStructure:m});return t.links=t.links.concat(...f),Object.assign({structures:t.structures,links:t.links},ut)}(t),COMPASS:()=>Dd(Object.assign(t,{roundOffsetLimit:3,playoffAttributes:$n})),OLYMPIC:()=>Dd(Object.assign(t,{roundOffsetLimit:2,playoffAttributes:Jn})),[Rn]:()=>Dd(t),[_n]:()=>{const{matchUps:t}=Pd({drawSize:v,uuids:d,matchUpType:p}),e=id({structureName:s||An,structureId:null==d?void 0:d.pop(),stageSequence:r,matchUpType:p,stage:An,matchUps:t});return a.structures.push(e),Object.assign({structures:[e]},ut)},FIRST_ROUND_LOSER_CONSOLATION:()=>function(t){const{finishingPositionOffset:e=0,stageSequence:i=1,drawDefinition:n,staggeredEntry:r,structureName:a,stage:o=An,matchUpType:s,idPrefix:c,drawSize:u,isMock:d,uuids:l}=t,p={finishingPositionOffset:e,matchUpType:s,drawSize:u,idPrefix:c,isMock:d,uuids:l},{matchUps:m}=r?Pd(p):od(p),f=id({structureName:a||An,structureId:null==l?void 0:l.pop(),stageSequence:i,matchUpType:s,matchUps:m,stage:o});n&&n.structures.push(f);const h=u/2,{matchUps:I}=od({finishingPositionOffset:e+h,idPrefix:c&&`${c}-c`,drawSize:h,matchUpType:s,isMock:d}),v=t.consolationStructureName||(a?`${a} ${bn}`:bn),g=id({structureName:v,matchUps:I,structureId:null==l?void 0:l.pop(),stage:bn,stageSequence:1,matchUpType:s});n&&n.structures.push(g);const y={linkType:Fn,source:{roundNumber:1,structureId:f.structureId},target:{roundNumber:1,feedProfile:xn,structureId:g.structureId}};return n&&n.links.push(y),Object.assign({structures:[f,g],links:null==n?void 0:n.links},ut)}(t),FIRST_MATCH_LOSER_CONSOLATION:()=>bd(Object.assign(t,{feedRounds:1,fmlc:!0})),[zn]:()=>bd(Object.assign(t,{feedRounds:1})),[qn]:()=>bd(Object.assign(t,{feedsFromFinal:2})),[Hn]:()=>bd(Object.assign(t,{feedsFromFinal:1})),[Wn]:()=>bd(Object.assign(t,{feedsFromFinal:3})),FEED_IN_CHAMPIONSHIP:()=>bd(t),[Vn]:()=>function({finishingPositionOffset:t,structureName:e=An,stageSequence:i=1,staggeredEntry:n,drawDefinition:r,matchUpType:a,idPrefix:o,drawSize:s,isMock:c,uuids:u}){const d={finishingPositionOffset:t,matchUpType:a,drawSize:s,idPrefix:o,isMock:c,uuids:u},{matchUps:l,roundsCount:p}=n?Pd(d):od(d),m=id({matchUps:l,matchUpType:a,stage:An,structureName:e,stageSequence:i,structureId:null==u?void 0:u.pop()});r.structures.push(m);const f=[0,2].slice(0,s/16).map(((t,e)=>{const i=e+1,{consolationStructure:n}=function({stageSequence:t=1,roundOffset:e=0,matchUpType:i,structureId:n,idPrefix:r,drawSize:a,isMock:o,index:s,uuids:c}){const u=a/(2*Math.pow(2,e)),{matchUps:d,roundsCount:l}=Pd({finishingPositionOffset:u,baseDrawSize:u,isConsolation:!0,feedRounds:1,matchUpType:i,idPrefix:r,isMock:o,uuids:c});return{consolationStructure:id({matchUps:d,stage:bn,structureName:`${bn} ${s+1}`,stageSequence:t,matchUpType:i,structureId:n}),consolationRoundsCount:l}}({structureId:null==u?void 0:u.pop(),idPrefix:o&&`${o}-c${e}`,stageSequence:i,roundOffset:t,matchUpType:a,drawSize:s,isMock:c,index:e,uuids:u});return r.structures.push(n),{consolationStructure:n,links:Ed({mainStructure:m,consolationStructure:n,roundsCount:2,roundOffset:t})}})).map((t=>t.links));if(r.links=r.links.concat(...f),s>=4&&s<=16||s>32){const{matchUps:t}=od({finishingPositionOffset:2,idPrefix:o&&`${o}-p3t4`,drawSize:2,matchUpType:a,isMock:c}),e=id({structureId:null==u?void 0:u.pop(),matchUps:t,structureName:Rn,stageSequence:2,matchUpType:a,stage:An}),i={linkType:Fn,source:{roundNumber:p-1,structureId:m.structureId},target:{roundNumber:1,feedProfile:xn,structureId:e.structureId}};r.structures.push(e),r.links.push(i)}return Object.assign({structures:r.structures,links:r.links},ut)}(t),[Kn]:()=>Rd(t),[Yn]:()=>function(t){const{playoffMatchUpFormat:e,stageSequence:i=1,structureOptions:n,drawDefinition:r,matchUpType:a,idPrefix:o,uuids:s}=t,c=Object.assign({structureName:An},t,{stage:An}),{structures:[u],groupCount:d,groupSize:l}=Rd(c);d<1&&console.log("Invalid configuration");const p=n&&n.playoffGroups||[{finishingPositions:[1],structureName:Rn}];let m=0;const f=p.map(((t,n)=>{const c=n+1,p=nt(1,l+1),f=t.finishingPositions;if(!f.reduce(((t,e)=>p.includes(e)&&t),!0))return;const h=t.drawType||jn,I=d*f.length,v=q(I);if(h===jn){const{matchUps:n}=od({idPrefix:o&&`${o}-po`,finishingPositionOffset:m,matchUpType:a,drawSize:v}),d=id({matchUps:n,stageOrder:c,matchUpType:a,stageSequence:i,stage:Rn,structureId:null==s?void 0:s.pop(),structureName:t.structureName,matchUpFormat:e});r.structures.push(d);const l=Cd({mainStructure:u,playoffStructure:d,finishingPositions:f});return r.links.push(l),m+=I,d}if("FIRST_MATCH_LOSER_CONSOLATION"===h){console.log("RRw/PO FIRST_MATCH_LOSER_CONSOLATION");const e=[null==s?void 0:s.pop(),null==s?void 0:s.pop()],{mainStructure:i,consolationStructure:n,link:c}=bd({structureName:t.structureName,idPrefix:o&&`${o}-po`,finishingPositionOffset:m,uuids:e,stage:Rn,feedRounds:1,matchUpType:a,fmlc:!0,drawSize:v}),d=Cd({mainStructure:u,playoffStructure:i,finishingPositions:f});return r.links.push(d),r.structures.push(i),r.structures.push(n),r.links.push(c),m+=I,i}})).filter(Boolean);return Object.assign({structures:[u,...f],links:r.links},{...ut})}(t)}[n],N=S&&S();if(null==N||!N.success)return{error:"Unrecognized drawType"};if(null!=f&&null!==(i=f.structures)&&void 0!==i&&i.length){const{finalQualifyingRoundNumber:t,finalQualifyingStructureId:e}=f;cd({sourceStructureId:e,sourceRoundNumber:t,targetStructureId:N.structures.find((({stage:t,stageSequence:e})=>t===An&&1===e)).structureId,drawDefinition:a})}const{matchUps:P,matchUpsMap:D}=io({drawDefinition:a});let T;return l&&P.forEach((t=>{const{tieMatchUps:e}=Sd({tieFormat:l,isMock:u});Object.assign(t,{tieMatchUps:e,matchUpType:p})})),c&&({inContextDrawMatchUps:T}=go({drawDefinition:a,matchUpsMap:D})),Sr({drawDefinition:a}),{structures:a.structures,links:a.links,inContextDrawMatchUps:T,matchUpsMap:D,...ut,matchUps:P}}function xd({drawDefinition:t,structureId:e}){var i;if(!t)return{error:mt};if(!e)return{error:"Missing structureId"};const n=[],r=[e],a=e=>{var i;return null===(i=t.links)||void 0===i?void 0:i.map((t=>t.source.structureId===e&&t.target.structureId)).filter(Boolean)},o=(null===(i=t.structures)||void 0===i?void 0:i.map((({structureId:t})=>t)))||[],s=Object.assign({},...o.map((t=>({[t]:a(t)}))));for(;r.length;){var c;const e=r.pop(),{structure:i}=Fr({drawDefinition:t,structureId:e}),{matchUps:a}=ba({structure:i}),o=Tr(a);n.push(...o),t.links=(null===(c=t.links)||void 0===c?void 0:c.filter((t=>t.source.structureId!==e&&t.target.structureId!==e)))||[],t.structures=(t.structures||[]).filter((t=>t.structureId!==e));const u=s[e];null!=u&&u.length&&r.push(...u)}const{matchUps:u}=io({drawDefinition:t});return u.forEach((t=>{n.includes(t.winnerMatchUpId)&&delete t.winnerMatchUpId,n.includes(t.loserMatchUpId)&&delete t.loserMatchUpId})),yr({drawDefinition:t,matchUpIds:n,action:"removeStructure"}),Sr({drawDefinition:t}),{...ut,removedMatchUpIds:n}}const Fd={getSourceRounds:gd,getDrawStructures:kr,getPositionsPlayedOff:vd,getStructureQualifiersCount:function({drawDefinition:t,structureId:e,structure:i}){let n,r;if(i||({structure:i,error:n}=Fr({drawDefinition:t,structureId:e})),!n)if(i.stage!==En)n="Structure is not Qualifying";else{const{matchUps:e}=ba({drawDefinition:t,structure:i});r=e.reduce(((t,e)=>t+(1===e.finishingRound?1:0)),0)}return{qualifiersCount:r,error:n}},getAvailablePlayoffRounds:yd,addPlayoffStructures:Md,removeStructure:xd,generateQualifyingLink:cd,generateAdHocMatchUps:ud,deleteAdHocMatchUps:Ad,structureSort:xr,generateDrawType:Ld,addVoluntaryConsolationStage:md,generateVoluntaryConsolationStructure:sd,buildDrawHierarchy:function({matchUps:t,matchUpType:e}){var i;if(!t)return{error:"Missing matchUps"};let n=0,r=[],a=[];e&&(t=t.filter((t=>t.matchUpType===e)));const o=J(t.map((({matchUpType:t})=>t)));if(o.length>1)if(o.includes(ni))t=t.filter((t=>t.matchUpType===ni));else if(o.includes(ei))t=t.filter((t=>t.matchUpType===ei));else{if(!o.includes(ii))return{};t=t.filter((t=>t.matchUpType===ii))}if(!Array.isArray(t)||!t.length)return{};const s=(t,e)=>parseInt(t)-parseInt(e),c=J(t.map((t=>t.drawPositions)).flat().filter(Boolean)).sort(s),u=nt(1,Math.max(...c)+1).filter((t=>!c.includes(t))).sort(s),{roundMatchUps:d}=Cr({matchUps:t}),l=d[1],p=d[2]||[],[m]=l||[{}],f=m.drawId,h=m.structureId,I=Math.max(...Object.keys(d)),v=(null===(i=d[I])||void 0===i?void 0:i.length)||0,g=Math.ceil(Math.log(v)/Math.log(2)),y=nt(1,g+1).map((t=>{const e=Math.pow(2,t-1),i=I+g-t+1;return nt(1,e+1).map((e=>({drawId:f,structureId:h,matchUpId:ve(),drawPositions:[],sides:[],roundNumber:i,roundPosition:e,finishingRound:t})))}));g&&(t=t.concat(...y.flat()));const U=l.map((t=>t.drawPositions)).flat(1/0),w=p.map((t=>t.drawPositions)).flat(1/0).filter((t=>!U.includes(t))).sort(s),S=p.filter((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.reduce(((t,e)=>w.includes(e)||t),void 0)})).map((t=>{var e,i;const n=null===(e=t.drawPositions)||void 0===e?void 0:e.reduce(((t,e)=>w.includes(e)?e:t),void 0),r=null===(i=t.drawPositions)||void 0===i?void 0:i.indexOf(n);return{[n]:t.sides[r]}}));if(null!=u&&u.length&&(null==w?void 0:w.length)===(null==u?void 0:u.length)){const e=w.map(((t,e)=>[t,u[e]].sort(s))),i=Object.assign({},...S),n=me(l[0].finishingRound,!1,!0),r=me(l[0].finishingPositionRange);a=e.map(((t,e)=>{const a=Math.max(...t||[])/2;return{sides:null==t?void 0:t.map((t=>i[t]||{bye:!0,drawPosition:t})),drawId:f,structureId:h,roundPosition:a,drawPositions:t,roundNumber:1,finishingRound:n,matchUpId:ve(),matchUpStatus:"BYE",sideNumber:e+1,finishingPositionRange:r}})),t=t.concat(...a)}const N=I+g;return nt(1,N+1).forEach((e=>{var i,a;const o=[],s=P({matchUps:t,roundNumber:e}),c=P({matchUps:t,roundNumber:e-1}).map(wd).filter(Boolean),u=(null==s?void 0:s.length)===(null===(i=r)||void 0===i?void 0:i.length),d=(null==s?void 0:s.length)===(null===(a=r)||void 0===a?void 0:a.length)/2;1===e&&s.forEach((t=>{const e=t.drawPositions||[],{matchUpId:i,structureId:n}=t,r=[{...t.sides[0],drawPosition:e[0],matchUpId:i,structureId:n},{...t.sides[1],drawPosition:e[1],matchUpId:i,structureId:n}],a={...t,children:r};o.push(a)})),u?(n++,s.forEach(((t,e)=>{const i=t.drawPositions||[],{matchUpId:a,structureId:s}=t,u=i.filter(Boolean).reduce(((t,e)=>U.includes(e)?t:e),void 0),d=[{...t.sides.filter(Boolean).reduce(((t,e)=>e.participantId&&!c.includes(e.participantId)?e:t),void 0),drawPosition:u,feedRoundNumber:n,sides:t.sides,matchUpId:a,structureId:s},r[e]],l={...t,children:d};o.push(l)}))):d&&s.forEach(((t,e)=>{const i={...t,children:[r[2*e],r[2*e+1]]};o.push(i)})),r=o})),{hierarchy:r[0],missingMatchUps:a,maxRound:I,finalRound:N,matchUps:t};function P({matchUps:t,roundNumber:e}){return t.filter((t=>t.roundNumber===e)).sort(((t,e)=>t.roundPosition-e.roundPosition))}}};function kd({participantCount:t}){return isNaN(t)?{error:gt}:{drawSize:[0,2,4,8,16,32,64,128,256,512,1024].find((e=>e>=t))||0}}function _d({tournamentRecord:t,drawDefinition:e,event:i,requireParticipantCount:n=!0,drawSizeProgression:r=!1,policyDefinitions:a,participantCount:o,drawSize:s}={}){if(!a){const n=$o({tournamentRecord:t,drawDefinition:e,event:i});if(n.error)return n;a=n.policyDefinitions}if(o&&isNaN(o))return{error:gt};if(n&&isNaN(o))return{error:"Missing participantCount"};if(!s){if(!o)return{error:"Missing drawSize"};({drawSize:s}=kd({participantCount:o}))}if((n&&o||s)>s)return{error:"participantCount exceeds drawSize"};const c=a.seeding;if(!c)return{error:"Invalid policyDefinitions"};const u=c.seedsCountThresholds;return u?(void 0!==c.drawSizeProgression&&(r=c.drawSizeProgression),{seedsCount:u.filter((t=>r?t.drawSize<=s:s===t.drawSize)).reduce(((t,e)=>o>=e.minimumParticipantCount?e.seedsCount:t),0)}):{error:"Missing seedCountThresholds"}}function jd({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,tournamentRecord:n,participantCount:r,drawDefinition:a,structureId:o,seedsCount:s,event:c}){const{structure:u,error:d}=Fr({drawDefinition:a,structureId:o});if(d)return{error:d};const{positionAssignments:l}=Pa({structure:u}),p=l.length;if(s>p)return{error:"seedsCount greater than drawSize"};const{policyDefinitions:m}=$o({policyTypes:["seeding"],tournamentRecord:n,drawDefinition:a,event:c}),{seedsCount:f}=_d({requireParticipantCount:t,drawSizeProgression:i,policyDefinitions:m,participantCount:r,drawSize:p});return m&&f&&s>f&&e&&(s=f),u.seedLimit=s,u.seedAssignments=nt(1,s+1).map((t=>({seedNumber:t,seedValue:t,participantId:void 0}))),Sr({drawDefinition:a,structureIds:[o]}),{...ut,seedLimit:s}}function Bd({participantPreferences:t,drawPositionResolutions:e={}}){const i=Object.keys(t).reduce(((e,i)=>{const n=t[i].preferences[0];return n&&(e[n]||(e[n]=[]),e[n].push(i)),e}),{}),n=Math.min(...Object.values(i).filter((t=>t.length)).map((t=>t.length))),r=Object.keys(i).filter((t=>i[t].length&&n&&i[t].length===n));let a;return r.forEach((n=>{const r=et(i[n]);e[n]=r,delete t[r]})),Object.values(t).forEach((t=>{t.preferences=t.preferences.filter((t=>{const e=!r.includes(t.toString());return e&&(a=!0),e}))})),{drawPositionResolutions:e,remainingPreferences:a,participantPreferences:t}}function Gd(t){const{participantIdAttributeName:e="participantId",positionActionName:i,drawDefinition:n,participantId:r,drawPosition:a,structureId:o}=t;if(!n)return{error:mt};let{inContextDrawMatchUps:s,matchUpsMap:c}=t;c||(c=Or({drawDefinition:n}),Object.assign(t,{matchUpsMap:c})),s||(({matchUps:s}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:c})),Object.assign(t,{inContextDrawMatchUps:s}));const{positionAssignments:u}=Na({drawDefinition:n,structureId:o}),d=u.find((t=>t.drawPosition===a));if(null!=d&&d.participantId){let t=As({inContextDrawMatchUps:s,drawDefinition:n,participantId:r,drawPosition:a,structureId:o,matchUpsMap:c});return t.success||console.log({result:t}),m({removedParticipantId:d.participantId})}let l=Ko({inContextDrawMatchUps:s,drawDefinition:n,drawPosition:a,structureId:o,matchUpsMap:c});if(l.error)return l;const p=l.participantId;return l=As({inContextDrawMatchUps:s,drawDefinition:n,participantId:r,drawPosition:a,structureId:o,matchUpsMap:c}),l.success?m({removedParticipantId:p}):l;function m({removedParticipantId:t}){const{structure:s}=Fr({drawDefinition:n,structureId:o});return Us({drawPositions:[a],structure:s}),ws({drawDefinition:n,positionAction:{[e]:r,name:i,drawPosition:a,structureId:o}}),{...ut,removedParticipantId:t}}}function Vd({alternateParticipantId:t,drawDefinition:e,drawPosition:i,structureId:n}){return Gd({participantId:t,drawDefinition:e,drawPosition:i,structureId:n,participantIdAttributeName:"alternateParticipantid",positionActionName:"alternateDrawPositionAssignment"})}function Hd({structurePositionAssignments:t,drawDefinition:e}){if(!e)return{error:mt};if(!Array.isArray(t))return{error:gt};for(const n of t){var i;const{structureId:t,positionAssignments:r}=n,a=Fr({drawDefinition:e,structureId:t});if(a.error)return a;const o=a.structure;if(!o)return{error:"structure not found"};if(o.structures)return{error:"Invalid structure",message:"cannot be Round Robin group container"};const s=null===(i=o.positionAssignments)||void 0===i?void 0:i.map((({drawPosition:t})=>t));if(at(s,r.map((({drawPosition:t})=>t))).length!==s.length)return{error:gt,message:"drawPositions do not match"};const c=Or({drawDefinition:e}),{matchUps:u}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:c});for(const i of r){const{drawPosition:n,participantId:a,bye:s,qualifier:d}=i;if(s){const i=os({drawDefinition:e,drawPosition:n,matchUpsMap:c,structureId:t,structure:o});if(null!=i&&i.error)return i}else if(d)r.forEach((t=>{t.drawPosition===n&&(t.qualifier=!0,delete t.participantId,delete t.bye)}));else if(a){const i=As({automaticPlacement:!0,inContextDrawMatchUps:u,drawDefinition:e,participantId:a,drawPosition:n,matchUpsMap:c,structureId:t});if(null!=i&&i.error)return i}}}return Sr({drawDefinition:e,structureIds:t.map((({structureId:t})=>t))}),{...ut}}function qd({drawDefinition:t,stages:e}){return((null==t?void 0:t.structures)||[]).filter((t=>!(null!=e&&e.length)||e.includes(t.stage))).map((t=>{const{positionAssignments:e}=Na({structure:t});return Mr(e)})).flat()}function Wd({entries:t=[]}={}){const e=t.filter(Boolean).reduce(((t,e)=>{const{entryStage:i,entryStatus:n}=e,r=`_${i||An}${n||""}`;return t[r]||(t[r]=[]),t[r].push(e),t}),{}),i=t=>isNaN(t)?9999:t;return Object.keys(e).map((t=>e[t].sort(((t,e)=>i(t.entryPosition)-i(e.entryPosition))).map(((t,e)=>{const i=e;return Object.assign(t,{entryPosition:i})})))).flat()}function zd(t){return[na,ra].includes(t)}function Kd({autoEntryPositions:t=!0,tournamentRecord:e,drawDefinition:i,participantIds:n,entryStatus:r,eventSync:a,drawId:o,stage:s,event:c}){var u,d,l,p,m,f,h,I,v,g;if(!n||!Array.isArray(n))return{error:"Invalid participantId",method:"modifyEntriesStatus",participantIds:n};if(!ca.includes(r))return{error:"Invalid entry status"};if(!i&&!c)return{error:ht};const y=[];null===(u=c.drawDefinitions)||void 0===u||u.forEach((t=>{const e=qd({drawDefinition:t});y.push(...e)}));const U=(null==e?void 0:e.participants)||[];if(!n.every((t=>{const{participantType:e}=Ye({tournamentParticipants:U,participantId:t});return!(e===Oi&&zd(r))})))return{error:"Invalid entry status"};const{flightProfile:w}=Qo({event:c}),S=null==w||null===(d=w.flights)||void 0===d?void 0:d.find((t=>t.drawId===o)),N=(t=[])=>t.filter((t=>!s||!t.entryStage||s===t.entryStage)).filter((({participantId:t})=>n.includes(t))).every((t=>!(t=>y.includes(t.participantId)&&!(aa.includes(t.entryStatus)&&aa.includes(r)))(t)&&(t.entryStatus=r,delete t.entryPosition,!0)))?ut:{error:"Participant has assigned drawPosition"},P=({flight:t,drawDefinition:e})=>{c.entries=Wd({entries:c.entries||[]}),t&&(t.drawEntries=Wd({entries:t.drawEntries})),e&&(e.entries=Wd({entries:e.entries}))},D=({flight:t,drawDefinition:e})=>{if(t){const e=N(t.drawEntries);if(e.error)return e}if(e){const t=N(e.entries);if(t.error)return t}return{...ut}},T=(null===(l=c.entries)||void 0===l?void 0:l.find((({entryPosition:t})=>!isNaN(t))))||(null==S||null===(p=S.drawEntries)||void 0===p?void 0:p.find((({entryPosition:t})=>!isNaN(t))))||(null==i||null===(m=i.entries)||void 0===m?void 0:m.find((({entryPosition:t})=>!isNaN(t))));if(t&&!T&&P({flight:S,drawDefinition:i}),S||i){const t=D({flight:S,drawDefinition:i});if(t.error)return t}const M=(null===(f=c.drawDefinitions)||void 0===f?void 0:f.map((({drawId:t})=>t)))||[],A=(null==w||null===(h=w.flights)||void 0===h?void 0:h.filter((t=>!M.includes(t.drawId))))||[];for(const C of A){const t=D({flight:C});if(t.error)return t}const E=1===(null==w||null===(I=w.flights)||void 0===I?void 0:I.length)&&(null===(v=c.drawDefinitions)||void 0===v?void 0:v.length)<=(null==w||null===(g=w.flights)||void 0===g?void 0:g.length);if(!S&&!i&&oa.includes(r))return{error:"entryStatus not allowed for event"};if(!S&&!i||r===ia||a&&E){const t=N(c.entries);if(t.error)return t;let e;var b,R;if(r===ia&&(null==w||null===(b=w.flights)||void 0===b||b.every((t=>{const i=N(t.drawEntries);return i.error?(e=i.error,!1):(t.drawEntries=t.drawEntries.filter((({participantId:t})=>!n.includes(t))),!0)})),null===(R=c.drawDefinitions)||void 0===R||R.every((t=>{var i;const r=N(t.entries);return r.error?(e=r.error,!1):(t.entries=null===(i=t.entries)||void 0===i?void 0:i.filter((({participantId:t})=>!n.includes(t))),!0)}))),e)return{error:e}}return t&&P({flight:S,drawDefinition:i}),ut}function Yd({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:i}){if(!t)return{error:pt};if(!e||!i)return{error:It};const n=(t.participants||[]).find((t=>t.participantId===e));if(!n)return{error:"Participant Not Found"};if(![Ci,Li].includes(n.participantType))return{error:"Invalid participantType",participantType:n.participantType};const{removed:r,error:a}=$d({groupingParticipant:n,individualParticipantIds:i});return a?{error:a}:(r&&At({topic:"modifyParticipants",payload:{participants:[n]}}),{...ut,removed:r})}function $d({groupingParticipant:t,individualParticipantIds:e=[]}){let i=0,n=[];return t?(t.individualParticipantIds||(t.individualParticipantIds=[]),t.individualParticipantIds=t.individualParticipantIds.filter((t=>{const n=null==e?void 0:e.includes(t);return n&&i++,!n})),n.length?{error:"Participants not removed",notRemoved:n}:{groupingParticipant:t,removed:i}):{removed:i}}function Jd({groupingType:t=Ci,participantRole:e=pu,tournamentRecord:i,individualParticipantIds:n=[]}){if(!i)return{error:pt};const r=i.participants||[];let a=0;return r.filter((i=>(i.participantRole===e||!i.participantRole)&&i.participantType===t)).forEach((t=>{const{removed:e}=$d({groupingParticipant:t,individualParticipantIds:n});e&&a++})),a?ut:{error:"No participant removed"}}function Zd({teamDrawIds:t=[],tournamentRecord:e,participantIds:i}){var n;if(!e)return{error:pt};if(null==i||!i.length)return{error:"Missing participantIds"};const r=(null===(n=e.participants)||void 0===n?void 0:n.length)||0;if(!r)return ut;const{tournamentParticipants:a}=wc({participantFilters:{participantIds:i},withStatistics:!0,tournamentRecord:e}),o=t.length&&(()=>{const{matchUps:n}=ro({tournamentRecord:e,matchUpFilters:{drawIds:t,matchUpTypes:[ii]}});return at(n.map((({sides:t})=>t.map((({participantId:t})=>t)))).flat().filter(Boolean),i)})(),s=a.filter((e=>{var i;return null===(i=e.draws)||void 0===i?void 0:i.filter((({drawId:e})=>!t.length||!t.includes(e))).length}));if(o.length||s.length)return{error:"Participant has assigned drawPosition"};e.participants=e.participants.filter((t=>!i.includes(t.participantId)));const c=r-e.participants.length;return Jd({tournamentRecord:e,individualParticipantIds:i}),c&&At({topic:"deleteParticipants",payload:{participantIds:i}}),c?ut:{error:"Cannot remove participants"}}function Qd({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){let o=r.entries||[];if(n){var s;const{flightProfile:t}=Qo({event:r}),i=null==t||null===(s=t.flights)||void 0===s?void 0:s.find((t=>t.drawId===n));o=i?i.drawEntries:null==e?void 0:e.entries}const c=o.filter((e=>(!(null!=i&&i.length)||!e.entryStatus||i.includes(e.entryStatus))&&(!a||!e.entryStage||e.entryStage===a)&&(!t||sa.includes(e.entryStatus))));return{entries:o,stageEntries:c}}function Xd({autoEntryPositions:t=!0,tournamentRecord:e,participantIds:i,event:n}){var r,a,o,s;if(null==n||!n.eventId)return{error:ht};if(!Array.isArray(i))return{error:"Missing participantIds"};if(null===(a=i=null===(r=i)||void 0===r?void 0:r.filter(Boolean))||void 0===a||!a.length)return{error:"Missing participantIds"};const{eventId:c}=n,{tournamentParticipants:u}=wc({participantFilters:{participantIds:i},withStatistics:!0,tournamentRecord:e});if(null==u?void 0:u.every((t=>{var e;const i=t.events.find((t=>t.eventId===c));return null==i||null===(e=i.drawIds)||void 0===e?void 0:e.length})))return{error:"Existing participant drawPosition assignment"};n.entries=(n.entries||[]).filter((t=>!i.includes(null==t?void 0:t.participantId))),t&&(n.entries=Wd({entries:n.entries}));const{flightProfile:d}=Qo({event:n});return null==d||null===(o=d.flights)||void 0===o||o.forEach((t=>{t.drawEntries=(t.drawEntries||[]).filter((t=>!i.includes(t.participantId)))})),null===(s=n.drawDefinitions)||void 0===s||s.forEach((t=>{t.entries=(t.entries||[]).filter((t=>!i.includes(t.participantId)))})),ut}function tl({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var r;if(!e)return{error:mt};const a=null===(r=e.entries)||void 0===r?void 0:r.find((e=>!(e.participantId!==t||i&&i!==e.entryStatus||n&&n!==e.entryStage)));return t&&a}function el({entryStatus:t=Qr,entryStage:e=An,drawDefinition:i,entryPosition:n,participantId:r,participant:a}){if(!i)return{error:mt};if(!e)return{error:"Missing stage"};if(!la({stage:e,drawDefinition:i}))return{error:"Invalid stage"};const o=ya({stage:e,drawDefinition:i,entryStatus:t});if(!o.success)return{error:o.error};if(!(r=r||(null==a?void 0:a.participantId)))return{error:"Missing participantId"};const s=t===ta&&tl({participantId:r,drawDefinition:i,entryStatus:t}),c="VOLUNTARY_CONSOLATION"===e&&tl({participantId:r,drawDefinition:i,entryStage:e});if(t!==ta&&"VOLUNTARY_CONSOLATION"!==e&&tl({drawDefinition:i,participantId:r})||s||c)return{error:"Existing participant"};const u=fe({...a,participantId:r,entryStage:e,entryStatus:t,entryPosition:n});return i.entries.push(u),Sr({drawDefinition:i}),{...ut}}function il({entryStatus:t=Qr,autoEntryPositions:e=!0,drawDefinition:i,participantIds:n,stage:r=An}){if(!r)return{error:"Missing stage"};if(!i)return{error:mt};if(!Array.isArray(n))return{error:"Invalid participantIds"};if(!la({stage:r,drawDefinition:i}))return{error:"Invalid stage"};const a=ya({stage:r,drawDefinition:i,entryStatus:t});if(!a.success)return{error:a.error};if((a.positionsAvailable||0)<n.length)return{error:"More Participants than Draw Positions"};const o=n.reduce(((e,n)=>{const a=t===ta&&tl({participantId:n,drawDefinition:i,entryStatus:t}),o="VOLUNTARY_CONSOLATION"===r&&tl({participantId:n,drawDefinition:i,entryStage:r});return t!==ta&&"VOLUNTARY_CONSOLATION"!==r&&tl({drawDefinition:i,participantId:n})||a||o?e.concat({participantId:n,error:"Existing participant"}):e}),[]);return o.length?{error:"Invalid entries",invalidParticipantIds:o}:(n.filter(Boolean).forEach((e=>{const n=Object.assign({participantId:e},{entryStage:r,entryStatus:t});i.entries.push(n)})),e&&(i.entries=Wd({entries:i.entries})),Sr({drawDefinition:i}),{...ut})}function nl({autoEntryPositions:t=!0,drawDefinition:e,participantIds:i,entryStatus:n,entryStage:r,drawId:a,event:o}){if(!a)return{error:"Missing drawId"};if(!o)return{error:"Event not found"};const s=(o.entries||[]).map(Ar);if(i.filter((t=>!s.includes(t))).length)return{error:"Missing entries"};if(e){const a=il({drawDefinition:e,participantIds:i,entryStatus:n,stage:r,autoEntryPositions:t});if(a.error)return a}const{flightProfile:c}=Qo({event:o}),u=null==c?void 0:c.flights.find((t=>t.drawId===a));return null!=u&&u.drawEntries&&(i.forEach((t=>{const e=n===ta&&rl({participantId:t,entryStatus:n,flight:u}),i="VOLUNTARY_CONSOLATION"===r&&rl({participantId:t,entryStage:r,flight:u});n!==ta&&"VOLUNTARY_CONSOLATION"!==r&&rl({flight:u,participantId:t})||e||i||u.drawEntries.push({participantId:t,entryStatus:n,entryStage:r})})),t&&(u.drawEntries=Wd({entries:u.drawEntries}))),ut}function rl({participantId:t,entryStatus:e,entryStage:i,flight:n}){var r;const a=null===(r=n.drawEntries)||void 0===r?void 0:r.find((n=>!(n.participantId!==t||e&&e!==n.entryStatus||i&&i!==n.entryStage)));return t&&a}function al(t){var e;const{entryStatus:i=Qr,autoEntryPositions:n=!0,participantIds:r=[],entryStage:a=An,tournamentRecord:o,drawDefinition:s,drawId:c,event:u}=t;if(!u)return{error:ht};if(!r||!r.length)return{error:"Missing participantIds"};if(!u||!u.eventId)return{error:"Event not found"};const d=(null==o||null===(e=o.participants)||void 0===e?void 0:e.filter((t=>u.eventType===ei&&t.participantType===Ri||u.eventType===ii&&t.participantType===Oi||!(u.eventType!==ii||t.participantType!==Ri||!zd(i))||u.eventType===Ci&&(t.participantType===Ci||i===ra&&t.participantType===Ri))).map((t=>t.participantId)))||[],l=r.filter((t=>!d.length||d.includes(t)));u.entries||(u.entries=[]);const p=u.entries.map((t=>t.participantId||t.participant&&t.participant.participantId));let m;if(l.forEach((t=>{p.includes(t)||u.entries.push({participantId:t,entryStatus:i,entryStage:a})})),c&&!zd(a)){const t=nl({participantIds:l,autoEntryPositions:n,drawDefinition:s,entryStatus:i,entryStage:a,drawId:c,event:u});t.error&&(m=t.error)}if(u.eventType===ii){const t=(u.entries||[]).map((t=>t.participantId)),e=(u.entries||[]).filter((t=>zd(t.entryStatus))).map((t=>t.participantId)),i=((null==o?void 0:o.participants)||[]).filter((e=>t.includes(e.participantId)&&e.participantType===Oi)).map((t=>t.individualParticipantIds)).flat(1/0),n=e.filter((t=>i.includes(t)));n.length&&Xd({tournamentRecord:o,participantIds:n,autoEntryPositions:!1,event:u})}const f=!(l.length===r.length);return n&&(u.entries=Wd({entries:u.entries||[]})),f?{error:"Invalid participantIds"}:Object.assign({message:m},ut)}function ol({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,entryStatus:r,drawId:a,event:o}){return function({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,entryStatus:r,drawId:a,stage:o,event:s}){if(!e)return{error:pt};if(!n)return{error:"Missing participantId"};if(!s)return{error:ht};if(![vi,gi].includes(s.eventType))return{error:"Invalie eventType"};const c=e.participants||[],u=c.find((t=>t.participantId===n));if(!u)return{error:"Participant Not Found"};if(![Oi,gi].includes(u.participantType)||u.participantType===gi&&s.eventType!==gi||u.participantType===Oi&&s.eventType!==vi)return{error:"Invalid participantType"};const d=ra,l=(s.entries||[]).find((t=>t.participantId===n));if(!l)return{error:"Participant Entry Not Found"};const{stageEntries:p}=Qd({entryStatusees:[Qr,Yr,Zr],selected:!1,drawDefinition:i,drawId:a,event:s,stage:o}),m=p.map(Ar),f=c.filter((({participantId:t})=>m.includes(t))).map((({individualParticipantIds:t})=>t)).flat().filter(Boolean),h=u.individualParticipantIds.filter((t=>1===rt(t,f).length));let I,v=Xd({event:s,drawId:a,drawDefinition:i,tournamentRecord:e,participantIds:[n]});return v.error||h.length&&(v=al({event:s,drawId:a,drawDefinition:i,tournamentRecord:e,entryStage:l.entryStage,entryStatus:r||d,participantIds:h}),v.error)?v:(t&&Zd({tournamentRecord:e,participantIds:[n]}).success&&(I=!0),{...ut,participantRemoved:I})}({removeGroupParticipant:t,individualEntryStatus:ra,tournamentRecord:e,drawDefinition:i,participantId:n,entryStatus:r,drawId:a,event:o})}function sl(t){const{drawId:e,replaceWithBye:i,destroyPair:n,entryStatus:r,drawDefinition:a,matchUpsMap:o}=t,s=Ko(t);if(s.error)return s;const{participantId:c}=s,{drawPosition:u,event:d,structureId:l}=t;if([Yr,ia].includes(r)&&c){const{tournamentRecord:i}=t,{participant:o}=$e({tournamentRecord:i,participantId:c}),{participantType:s,individualParticipantIds:u}=o||{};if(n&&s===Oi){const t=ol({tournamentRecord:i,drawDefinition:a,participantId:c,event:d});if(t.error)return t;Kd({tournamentRecord:i,participantIds:u,entryStatus:r,drawDefinition:a,drawId:e,event:d})}else Kd({tournamentRecord:i,participantIds:[c],entryStatus:r,drawDefinition:a,drawId:e,event:d})}if(i){const t=os({drawDefinition:a,structureId:l,drawPosition:u,matchUpsMap:o});if(t.error)return t}const{structure:p}=Fr({drawDefinition:a,structureId:l});return Us({structure:p,drawPositions:[u]}),ws({drawDefinition:a,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:u,entryStatus:r,structureId:l}}),s}function cl({drawDefinition:t,drawPositions:e,structureId:i}){if(!t)return{error:mt};if(!i)return{error:"Missing structureId"};if(2!==(null==e?void 0:e.length))return{error:gt,drawPositions:e};const n=Or({drawDefinition:t}),{matchUps:r}=io({includeByeMatchUps:!0,inContext:!0,drawDefinition:t}),{structure:a}=Fr({drawDefinition:t,structureId:i});if(!a)return{error:"structure not found"};let o;return o=a.structureType===Ln?function({drawDefinition:t,drawPositions:e,structure:i,matchUpsMap:n,inContextDrawMatchUps:r}){var a;const o=null===(a=i.structures)||void 0===a?void 0:a.reduce(((t,i)=>{const n=null==i?void 0:i.positionAssignments.filter((t=>e.includes(t.drawPosition)));return n&&t.push(...n),t}),[]);if(2===o.filter((({bye:t})=>t)).length)return{...ut};if(o.some((({bye:t})=>t)))ul({drawDefinition:t,assignments:o,structure:i,matchUpsMap:n,inContextDrawMatchUps:r});else{const t=o.map(Ar);o.forEach(((e,i)=>e.participantId=t[1-i]))}return{...ut}}({drawDefinition:t,structure:a,drawPositions:e,matchUpsMap:n,inContextDrawMatchUps:r}):function({inContextDrawMatchUps:t,drawDefinition:e,drawPositions:i,matchUpsMap:n,structure:r}){const a=null==r?void 0:r.positionAssignments.filter((t=>null==i?void 0:i.includes(t.drawPosition)));return a?2===a.filter((({bye:t})=>t)).length?{...ut}:a.some((({bye:t})=>t))?ul({drawDefinition:e,structure:r,assignments:a,matchUpsMap:n,inContextDrawMatchUps:t}):function({structure:t,assignments:e}){const i=Object.assign({},...e.map(((t,i)=>{const{drawPosition:n}=t;return{[n]:{...e[1-i],drawPosition:n}}})));return t.positionAssignments=t.positionAssignments.map((t=>i[t.drawPosition]||t)),{...ut}}({structure:r,assignments:a,matchUpsMap:n,inContextDrawMatchUps:t}):{error:gt,structure:r,message:"Missing positionAssignments"}}({drawDefinition:t,structure:a,drawPositions:e,matchUpsMap:n,inContextDrawMatchUps:r}),o.error?o:(Us({structure:a,drawPositions:e}),ws({drawDefinition:t,positionAction:{name:"swapDrawPositionAssignments",drawPositions:e,structureId:i}}),Sr({drawDefinition:t,structureIds:[i]}),{...ut})}function ul({drawDefinition:t,structure:e,assignments:i,matchUpsMap:n,inContextDrawMatchUps:r}){const a=i.find((({bye:t})=>t)),o=i.find((({participantId:t})=>t)),s=a.drawPosition,{participantId:c,drawPosition:u}=o,{structureId:d}=e;let l=sl({drawDefinition:t,structureId:d,drawPosition:s,matchUpsMap:n,inContextDrawMatchUps:r});return l.error?l:(l=sl({drawDefinition:t,structureId:d,drawPosition:u,matchUpsMap:n,inContextDrawMatchUps:r}),l.error?l:(l=os({drawDefinition:t,structureId:d,drawPosition:u,matchUpsMap:n,inContextDrawMatchUps:r}),l=As({drawDefinition:t,structureId:d,drawPosition:s,participantId:c,matchUpsMap:n,inContextDrawMatchUps:r}),l.error?l:{...ut}))}function dl({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:a}){if(!e)return{error:mt};if(!n)return{error:"Missing structureId"};if(!i)return{error:"Missing drawPosition"};const{structure:o}=Fr({drawDefinition:e,structureId:n});let s=o;o.structureType===Ln&&(s=o.structures.find((t=>t.positionAssignments.find((t=>t.drawPosition===i)))));const c=s.positionAssignments,u=c.find((t=>t.drawPosition===i));u&&jr({element:u,extension:{name:"subOrder",value:r}});const{matchUps:d}=ba({structure:s,inContext:!0});return Zo({positionAssignments:c,tournamentRecord:t,drawDefinition:e,matchUpFormat:(null==o?void 0:o.matchUpFormat)||e.matchUpFormat,matchUps:d,event:a}),Sr({drawDefinition:e,structureIds:[n]}),{...ut}}const ll={setSubOrder:dl,clearDrawPosition:Ko,assignDrawPosition:As,setPositionAssignments:Hd,automatedPositioning:ed,assignDrawPositionBye:os,swapDrawPositionAssignments:cl,alternateDrawPositionAssignment:Vd,resolveDrawPositions:function({participantFactors:t,positionAssignments:e}){if(!t||!e)return{error:It};let i=me(t,!1,!0);const n=e.map((({drawPosition:t})=>t)),r=e.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map(Er);let a,o=!0;for(;o;)({drawPositionResolutions:a,remainingPreferences:o,participantPreferences:i}=Bd({participantPreferences:i,drawPositionResolutions:a}));const s=Object.keys(a).map((t=>parseInt(t)));let c=r.filter((t=>!s.includes(t))),u=Object.keys(i);const d=nt(1,(2,l=(null==n?void 0:n.length)||0,Math.log(l)/Math.log(2)+1)).map((t=>Math.pow(2,t)));var l;const p={};for(const f of d){const e=st(n,f).filter((t=>ot(t,c))),i={};if(u.forEach((n=>{e.forEach((e=>{const r=e.join("|");ot(e,t[n].preferences)&&(i[r]||(i[r]=[]),i[r].push(n))}))})),Z(Object.keys(i)).forEach((t=>{const e=i[t].filter((t=>u.includes(t)));for(;e.length;){const i=et(e),n=t.split("|").map((t=>parseInt(t))).filter((t=>c.includes(parseInt(t))));if(n.length){const e=et(n);c=c.filter((t=>t!==e)),u=u.filter((t=>t!==i)),a[e]=i;const r=t.split("|").length;p[r]||(p[r]=0),p[r]+=1}}})),!c.length)break}const m={chunkResolution:p};return u.length&&(u.forEach((t=>{const e=et(c);e&&(a[e]=t)})),m.randomAssignment=u.length),{drawPositionResolutions:a,report:m}},initializeStructureSeedAssignments:jd,getNextSeedBlock:Ms};function pl({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:mt};if(!i)return{error:"Missing matchUpId"};const{matchUp:n}=Ra({drawDefinition:t,event:e,matchUpId:i});return n?Br({element:n,name:"delegatedOutcome"}):{error:"matchUp not found"}}function ml({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:"Missing participant"};if("object"!=typeof e)return{error:gt};if(i.timeItems||(i.timeItems=[]),i&&Array.isArray(i.timeItems)){const{accessor:n,scaleType:r,eventType:a,scaleName:o}=e,s=[fc,r,a,o].join("."),c=i.timeItems.filter((t=>(null==t?void 0:t.itemType)===s)).filter((e=>!t||(null==e?void 0:e.itemDate))).sort(((t,e)=>new Date(t.createdAt||void 0)-new Date(e.createdAt||void 0))).pop();if(c){const[t,e,i,r]=c.itemType.split(".");if(t!==fc)return{error:"Invalid scaleItem"};const a=n&&gc({element:c.itemValue,accessor:n}),o=n?a.value:c.itemValue;return{scaleItem:{scaleDate:c.itemDate,scaleName:r,scaleType:e,eventType:i,scaleValue:o}}}return{error:"No scaleItem found"}}return{error:"Missing participant"}}function fl({rankedMatchUpValues:t,valueSortedPairings:e,stipulated:i=[],deltaObjects:n}){const r=[].concat(...i),a=[];let o=0;i.filter(Boolean).forEach((e=>{const i=hl(...e),n=t[i];a.push({participantIds:e,value:n}),o+=t[i]})),e.forEach((t=>{const e=t.pairing.split("|");if(!e.reduce(((t,e)=>r.includes(e)||t),!1)){r.push(...e);let i=t.value;o+=i,a.push({participantIds:e,value:i})}})),a.sort(((t,e)=>t.value-e.value));const s=a.reduce(((t,e)=>{const i=hl(...e.participantIds),r=n[i];return r>t?r:t}),0);return{value:o,participantIdPairings:a,maxDelta:s}}function hl(t,e){return[t,e].sort().join("|")}function Il({participantIds:t}){const e={},i=[];t.forEach((n=>{e[n]=t.filter((t=>t!==n)),e[n].forEach((t=>{const e=hl(t,n);i.includes(e)||i.push(e)}))}));const n=Object.assign({},...i.map((t=>({[t]:0}))));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function vl({tournamentParticipants:t,restrictEntryStatus:e,generateMatchUps:i,drawDefinition:n,participantIds:r,maxIterations:a,structureId:o,matchUpIds:s,scaleName:c,event:u}){var d;if("object"!=typeof n||n.drawType&&n.drawType!==kn)return{error:"Invalid drawDefinition"};if(!Array.isArray(n.entries)||r&&!Array.isArray(r))return{error:gt};const{eventType:l}=u||{},p=n.entries.filter((({entryStatus:t})=>!e||[Qr,ea,Zr].includes(t))).map(Ar);if(r){const t=r.filter((t=>!p.includes(t)));if(null!=t&&t.length)return{error:"Invalid participantId",invalidParticipantIds:t}}else r=p;if(!o){var m,f;const t=null===(m=n.structures)||void 0===m||null===(f=m.filter((t=>1===t.stageSequence)))||void 0===f?void 0:f.reduce(((t,e)=>{const i=On[e.stage];return Ta({drawDefinition:n,structure:e})&&i>(On[null==t?void 0:t.stage]||1)?e:t}),void 0);o=null==t?void 0:t.structureId}const h=null===(d=n.structures)||void 0===d?void 0:d.find((t=>t.structureId===o));if(!h)return{error:"structure not found"};if(!Ta({drawDefinition:n,structure:h}))return{error:"Invalid drawDefinition"};const I={};for(const U of r){const e=null==t?void 0:t.find((t=>t.participantId===U));let i=gl({eventType:l,participant:e});!i&&c&&(i=gl({scaleValue:i,eventType:l,participant:e})),i&&(I[U]=i)}const{candidatesCount:v,iterations:g,participantIdPairings:y}=function({maxIterations:t=5e3,tournamentParticipants:e,generateMatchUps:i,drawDefinition:n,participantIds:r,adHocRatings:a,structureId:o,matchUpIds:s,eventType:c,structure:u}){const{encounters:d}=function({matchUps:t}){let e=[];for(const i of t){const t=i.sides.map(Ar);if(2===t.length){const i=hl(...t);e.includes(i)||e.push(i)}}return{encounters:e}}({matchUps:u.matchUps}),l={};for(const U of d)l[U]||(l[U]=0),l[U]+=50;const p=null==e?void 0:e.filter((({participantType:t})=>t===Ci));if(p)for(const U of p){const t=U.individualParticipantIds||[],{uniquePairings:e}=Il({participantIds:t});for(const i of e)l[i]||(l[i]=0),l[i]+=60}const{uniquePairings:m,possiblePairings:f,deltaObjects:h}=Il({participantIds:r}),I={tournamentParticipants:e,possiblePairings:f,drawDefinition:n,participantIds:r,uniquePairings:m,maxIterations:t,adHocRatings:a,deltaObjects:h,valueObjects:l,eventType:c,structure:u},{candidatesCount:v,participantIdPairings:g,iterations:y}=function({tournamentParticipants:t,adHocRatings:e={},possiblePairings:i,uniquePairings:n,maxIterations:r,deltaObjects:a,valueObjects:o,eventType:s}){n.forEach((i=>{const n=function({tournamentParticipants:t,adHocRatings:e,eventType:i,pairing:n}){return n.split("|").map((n=>{if(i===vi){var r;const i=null==t||null===(r=t.find((t=>t.participantId===n)))||void 0===r?void 0:r.individualParticipantIds;return i?i.map((t=>e[t||0])):0}return e[n]||0}))}({tournamentParticipants:t,adHocRatings:e,eventType:s,pairing:i}),r=Math.abs(n[0]-n[1])+1;a[i]=Math.abs(n[0]-n[1]),o[i]||(o[i]=0),o[i]+=Math.pow(r,2)}));const c=n.map((t=>({pairing:t,value:o[t]}))).sort(((t,e)=>t.value-e.value)),{pairingValues:u}=function({possiblePairings:t,valueObjects:e}){let i={};for(const r of Object.keys(t)){let e=t[r].map((t=>n(r,t)));i[r]=e.sort(((t,e)=>t.value-e.value))}function n(t,i){let n=hl(t,i);return{opponent:i,value:e[n]}}return{pairingValues:i}}({possiblePairings:i,valueObjects:o}),{candidate:d,candidatesCount:l,iterations:p}=function({maxIterations:t=5e3,valueSortedPairings:e,pairingValues:i,deltaObjects:n}){const r=Object.assign({},...e.map((t=>({[t.pairing]:t.value}))));let a=fl({rankedMatchUpValues:r,valueSortedPairings:e,deltaObjects:n}),o=a;const s=Object.keys(i);let c,u=0,d=s.length;do{d-=1,c=s.length*d*e.length/2}while(c>t&&d>2);let l=[];return s.forEach((t=>{i[t].slice(0,d).forEach((i=>{const s=hl(t,i.opponent);if(!l.includes(s)){const c=fl({stipulated:[[t,i.opponent]],rankedMatchUpValues:r,valueSortedPairings:e,deltaObjects:n});c.maxDelta<o.maxDelta&&(o=c),c.value<a.value&&(a=c),l.push(s),u+=1}}))})),{candidate:a,deltaCandidate:o,candidatesCount:u,iterations:c}}({valueSortedPairings:c,maxIterations:r,pairingValues:u,deltaObjects:a}),{participantIdPairings:m}=d;return{candidatesCount:l,participantIdPairings:m,iterations:p}}(I);if(!v)return{error:"No Candidates"};if(i){const t=ud({participantIdPairings:g,drawDefinition:n,newRound:!0,structureId:o,matchUpIds:s});if(t.error)return t}return{...ut,participantIdPairings:g,candidatesCount:v,iterations:y}}({tournamentParticipants:t,generateMatchUps:i,drawDefinition:n,participantIds:r,maxIterations:a,adHocRatings:I,matchUpIds:s,structureId:o,structure:h,eventType:l});return{...ut,candidatesCount:v,iterations:g,participantIdPairings:y}}function gl({scaleName:t="dynamic",eventType:e,participant:i}){var n;const r=i&&ml({scaleAttributes:{eventType:e||Ii,scaleType:hc,scaleName:t},participant:i});return null==r||null===(n=r.scaleItem)||void 0===n?void 0:n.scaleValue}function yl({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,a;if(!n&&!t)return{error:mt};if(!n&&!e)return{error:"Missing matchUp"};if(!i)return{error:It};if(!n){const{error:i,matchUp:r}=Ra({drawDefinition:t,matchUpId:e});if(i)return{error:i};n=r}return"object"==typeof i&&null!==(r=i.score)&&void 0!==r&&r.scoreStringSide1&&null!==(a=i.score)&&void 0!==a&&a.scoreStringSide2?jr({element:n,extension:{name:"delegatedOutcome",value:i}}):{error:gt}}function Ul(t){return null!==t&&(void 0===t||!isNaN(t))}function wl({drawDefinition:t,finishingOrder:e}){if(!t)return{error:mt};if(!Array.isArray(e))return{error:gt,message:"finishingOrder must be an array"};const{completedMatchUps:i,matchUpsMap:n}=no({inContext:!0,drawDefinition:t}),r=i.map(br),a=e.map(br),{matchUpTypes:o,roundNumbers:s,structureIds:c,matchUpTieIds:u}=i.filter((({matchUpId:t})=>a.includes(t))).reduce(((t,e)=>{const{matchUpTieId:i,matchUpType:n,roundNumber:r,structureId:a}=e;return t.matchUpTypes.includes(n)||t.matchUpTypes.push(n),t.roundNumbers.includes(r)||t.roundNumbers.push(r),t.structureIds.includes(a)||t.structureIds.push(a),t.matchUpTieIds.includes(i)||t.matchUpTieIds.push(i),t}),{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(o.length>1||u.length>1||s.length>1||c.length>1)return{error:gt,message:"matchUpType, structureId and roundNumber must be equivalent"};let d,l;const p={},m=[],f=[];if(!e.every((({orderOfFinish:t,matchUpId:e})=>(m.push(e),t&&f.push(t),p[e]=t,d=r.includes(e),l=void 0===t||z(t)&&Math.floor(t)>0,d&&l))))return{error:d?gt:"Invalid matchUpStatus",message:d?l?void 0:"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed"};const h=i.filter((t=>t.structureId===c[0]&&t.roundNumber===s[0]&&t.matchUpType===o[0]&&t.matchUpTieId===u[0]&&!m.includes(t.matchUpId)));for(const v of h){const{orderOfFinish:t}=v||{};if(t){if(!z(t))return{error:gt,message:"Existing value",matchUp:v};f.push(t)}}if(tt(f).length!==f.length||Math.max(...f)>f.length)return{error:gt,message:"Values not unique or greater than expected number of values"};if(c.length){var I;const e=eo({matchUpFilters:{matchUpIds:a},structureId:c[0],drawDefinition:t,matchUpsMap:n});if(e.error)return e;null===(I=e.completedMatchUps)||void 0===I||I.forEach((t=>t.orderOfFinish=p[t.matchUpId]))}return{...ut}}const Sl={setMatchUpStatus:xs,setMatchUpFormat:ks,isValidMatchUpFormat:h,addMatchUpTimeItem:Ca,resetMatchUpTimeItems:function({drawDefinition:t,event:e,matchUpId:i}){const{matchUp:n}=Ra({drawDefinition:t,event:e,matchUpId:i});return n?(n.timeItems=[],Ur({drawDefinition:t,matchUp:n}),{...ut}):{error:"matchUp not found"}},checkInParticipant:cu,checkOutParticipant:uu,getCheckedInParticipantIds:Aa,addMatchUpScheduleItems:ka,addMatchUpScheduledDate:_a,addMatchUpScheduledTime:ja,addMatchUpStartTime:Ga,addMatchUpEndTime:Va,addMatchUpStopTime:Ha,addMatchUpResumeTime:qa,setOrderOfFinish:wl,setDelegatedOutcome:yl,removeDelegatedOutcome:pl,drawMatic:vl,matchUpSort:_o,addMatchUpOfficial:Ba,findMatchUp:function(t){return Object.assign(t,{inContext:!0}),{matchUp:me(Ra(t).matchUp,!1,!0)}},getRoundMatchUps:Cr,validDrawPositions:function({matchUps:t}){if(!t)return{error:"Missing matchUps"};const e=t.map((t=>t.drawPositions)).flat();Pt()&&t.forEach((t=>{var e;Array.isArray(t.drawPositions)?null===(e=t.drawPositions)||void 0===e||e.forEach((e=>{Ul(e)||console.log("invalid drawPosition",t)})):console.log("drawPositions not an array",t)}));const i=null==e?void 0:e.every(Ul),n=t.find((t=>!Array.isArray(t.drawPositions)));return i&&!n}};function Nl({drawDefinition:t,policyDefinitions:e}){if(!t)return{error:mt};if(!e||"object"!=typeof e)return{error:"Missing policyDefinitions"};t.extensions||(t.extensions=[]);const{appliedPolicies:i}=Rr({drawDefinition:t}),n=Object.keys(e).every((t=>!i[t]&&(i[t]=e[t],!0)));if(n){const e=jr({element:t,extension:{name:"appliedPolicies",value:i}});if(e.error)return e}return Sr({drawDefinition:t}),n?{...ut}:{error:"existing policyType"}}const Pl={attachPolicies:Nl};function Dl({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:mt};const n=me(io({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}).matchUps,!1,!0),r=J(n.reduce(((t,e)=>t.concat(...e.sides.map((t=>t.participantId)).filter(Boolean))),[])),a=Object.assign({},...r.map((t=>{const e=n.filter((e=>e.sides.map((t=>t.participantId)).filter(Boolean).includes(t)));return{[t]:e}})));return{participantIds:r,participantIdMatchUps:a}}function Tl({byeAdvancements:t=!1,tournamentParticipants:e,drawDefinition:i}){if(!i)return{error:mt};const{participantIds:n,participantIdMatchUps:r}=Dl({tournamentParticipants:e,drawDefinition:i}),a=n.map((e=>{const i=r[e].filter((t=>[w,y].includes(t.matchUpStatus)||t.winningSide)),n=i.map((i=>{const n=i.sides.find((t=>t.bye)),r=i.sides.find((t=>t.participantId===e)).sideNumber;return(i.winningSide||t&&n&&r)===r?i.finishingPositionRange.winner:i.finishingPositionRange.loser})),a=t=>Math.abs(t[0]-t[1]),o=n.reduce(((t,e)=>t&&a(t)<a(e)?t:e),void 0);return{[e]:{relevantMatchUps:i,finishingPositionRanges:n,finishingPositionRange:o}}}));return Object.assign({},...a)}function Ml(t,e){return t.bye||t.seedValue<e.seedValue||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function Al({action:t,policyActions:e}){var i;const n=!(null!=e&&e.enabledActions)||(null==e||null===(i=e.disabledActions)||void 0===i?void 0:i.length)&&e.disabledActions.includes(t);return!n&&!(0!==(null==e?void 0:e.enabledActions.length)&&!(null==e?void 0:e.enabledActions.includes(t))||n)}function El({policyDefinitions:t,tournamentParticipants:e=[],tournamentRecord:i,drawDefinition:n,drawPosition:r,structureId:a,event:o}){if(!o)return{error:ht};if(!n)return{error:mt};if(void 0===r)return{error:"Missing drawPosition"};if(!a)return{error:"Missing structureId"};const{activeDrawPositions:s,byeDrawPositions:c,inactiveDrawPositions:u,structure:d,error:l}=Ho({tournamentRecord:i,drawDefinition:n,structureId:a});if(l)return{error:l};const{policyDefinitions:p}=$o({policyTypes:["positionActions"],tournamentRecord:i,drawDefinition:n,event:o}),m=t||p,{enabledStructures:f,actionsDisabled:h}=function({policyDefinitions:t,tournamentRecord:e,drawDefinition:i,structure:n,event:r}){const{policyDefinitions:a}=$o({policyTypes:["positionActions"],tournamentRecord:e,drawDefinition:i,event:r}),o=(t=t||a||Xn).positionActions,{enabledStructures:s,disabledStructures:c}=o||{};return{enabledStructures:s,actionsDisabled:null==c?void 0:c.find((t=>{var e,i;return(null===(e=t.stages)||void 0===e?void 0:e.includes(n.stage))&&(!(null!==(i=t.stageSequences)&&void 0!==i&&i.length)||t.stageSequences.includes(n.stageSequence))}))}}({policyDefinitions:m,tournamentRecord:i,drawDefinition:n,structure:d,event:o}),{sourceStructureIds:I}=function({drawDefinition:t,structureId:e,finishingPosition:i,linkType:n}){const{links:r}=Ja({drawDefinition:t,structureId:e})||{};return{sourceStructureIds:((null==r?void 0:r.target)||[]).filter((({linkType:t})=>t===n)).map((({source:t})=>t.structureId)).map((e=>{const{structure:i}=Fr({drawDefinition:t,structureId:e});return{sourceStructureId:e,sourceFinishingPosition:i.finishingPosition}})).filter((({sourceFinishingPosition:t})=>t===i)).map((({sourceStructureId:t})=>t))}}({drawDefinition:n,structureId:a,finishingPosition:"WIN_RATIO",linkType:"POSITION"})||{};let v;null!=I&&I.length&&(v=I.reduce(((t,e)=>vs({drawDefinition:n,structureId:e})&&t),!0));const g=I.length,y=I.length&&!v,{policyActions:U}=function({enabledStructures:t,structure:e}){if(!1===t)return{};if(null==t||!t.length)return{policyActions:{enabledActions:[],disabledActions:[]}};const{stage:i,stageSequence:n}=e||{};return{policyActions:t.find((t=>{var e,r;const a=!(null!==(e=t.stages)&&void 0!==e&&e.length)||t.stages.includes(i),o=!(null!==(r=t.stageSequences)&&void 0!==r&&r.length)||t.stageSequences.includes(n);if(t&&a&&o)return!0}))}}({enabledStructures:f,structure:d}),w=![En,An].includes(d.stage)||1!==d.stageSequence,S=[],{drawId:N}=n,{assignedPositions:P,positionAssignments:D}=Pa({structure:d}),T=P.find((t=>t.drawPosition===r)),M=D.map((t=>t.drawPosition));if(null==M||!M.includes(r))return{error:"Invlid drawPosition"};const{stage:A,stageSequence:E}=d,b=[Qr,Zr],R=[A];A===bn&&R.push(An),A===An&&R.push(bn);const C=Ia({drawDefinition:n,stageSequence:E,entryStatuses:b,structureId:a,stages:R}),O=qd({drawDefinition:n,stages:R}),L=C.filter((t=>!O.includes(t.participantId))).map((t=>t.participantId)),x=c.includes(r),F=s.includes(r);if(h)return{message:"Actions Disabled for structure",isByePosition:x,isActiveDrawPosition:F,isDrawPosition:!0,hasPositionAssigned:!!T,validActions:[]};if(Al({policyActions:U,action:"ASSIGN"})&&!F&&!y&&(!T||x)){const{validAssignmentActions:t}=function({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,tournamentParticipants:n,isWinRatioFedStructure:r,positionAssignments:a,policyDefinitions:o,drawDefinition:s,isByePosition:c,drawPosition:u,structureId:d,structure:l}){var p,m,f;const{drawId:h}=s,I=[];let v,g,y=[];const U=null==o||null===(p=o.seeding)||void 0===p||null===(m=p.validSeedPositions)||void 0===m?void 0:m.ignore;if(!U){const t=Ms({randomize:!0,drawDefinition:s,structureId:d});({unplacedSeedParticipantIds:v,unplacedSeedAssignments:g,unfilledPositions:y}=t)}if(null!==(f=y)&&void 0!==f&&f.length||(y=a.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition))),c||I.push({type:"BYE",method:"assignDrawPositionBye",willDisableLinks:i,payload:{drawId:h,structureId:d,drawPosition:u}}),r&&U){var w;const e=a.map((t=>t.participantId)).filter(Boolean),r={structureIds:t},{completedMatchUps:o}=no({inContext:!0,matchUpFilters:r,drawDefinition:s}),c=J(null===(w=o||[])||void 0===w?void 0:w.map((({sides:t})=>t.map(Ar))).flat().filter((t=>!e.includes(t)))),l=null==n?void 0:n.filter((t=>null==c?void 0:c.includes(t.participantId)));return null==l||l.forEach((t=>{const e=(s.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),null!=l&&l.length&&I.push({type:"ASSIGN",method:"assignDrawPosition",availableParticipantIds:c,participantsAvailable:l,willDisableLinks:i,payload:{drawId:h,structureId:d,drawPosition:u}}),{validAssignmentActions:I}}if(y.includes(u)||c){var S;let t;if(null!==(S=g)&&void 0!==S&&S.length){const e=g.filter((t=>{var e;return null===(e=v)||void 0===e?void 0:e.includes(t.participantId)}));e.sort(Ml),t=e.map((t=>t.participantId))}else{t=e;const{unplacedQualifiersCount:i}=Xu({drawDefinition:s,structureId:d,structure:l});i&&console.log({unplacedQualifiersCount:i})}const r=null==n?void 0:n.filter((e=>t.includes(e.participantId)));null!=r&&r.length&&I.push({type:"ASSIGN",method:"assignDrawPosition",availableParticipantIds:t,participantsAvailable:r,willDisableLinks:i,payload:{drawId:h,structureId:d,drawPosition:u}})}return{validAssignmentActions:I}}({positionSourceStructureIds:I,unassignedParticipantIds:L,possiblyDisablingAction:w,isWinRatioFedStructure:g,tournamentParticipants:e,positionAssignments:D,activeDrawPositions:s,policyDefinitions:m,drawDefinition:n,isByePosition:x,drawPosition:r,structureId:a,structure:d});null==t||t.forEach((t=>S.push(t)))}const{participantId:k}=T||{},_=k&&e.find((t=>t.participantId===k));if(T){Al({policyActions:U,action:"REMOVE"})&&!F&&(S.push({type:"REMOVE",method:"removeDrawPositionAssignment",payload:{drawId:N,structureId:a,drawPosition:r},willDisableLinks:w}),x||S.push({type:"WITHDRAW",method:"withdrawParticipantAtDrawPosition",payload:{drawId:N,structureId:a,drawPosition:r},willDisableLinks:w}),Al({policyActions:U,action:"BYE"})&&!x&&S.push({type:"BYE",method:"removeDrawPositionAssignment",payload:{drawId:N,structureId:a,drawPosition:r,replaceWithBye:!0},willDisableLinks:w}));const t=d.stage===En||d.stage===An&&1===d.stageSequence;if(!x&&Al({policyActions:U,action:"SEED_VALUE"})&&Ts({drawDefinition:n,structureId:a,drawPosition:r})&&t){const{seedAssignments:t}=Ua({drawDefinition:n,structure:d}),{seedNumber:e,seedValue:i}=t.find((t=>t.participantId===k))||{};S.push({type:"SEED_VALUE",method:"modifySeedAssignment",participant:_,seedNumber:e,payload:{drawId:N,structureId:a,participantId:k,seedValue:i}})}if(!x&&k){if(Al({policyActions:U,action:"PENALTY"})){const t={type:"PENALTY",method:"addPenalty",participant:_,payload:{drawId:N,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};S.push(t)}if(Al({policyActions:U,action:"NICKNAME"})){const t={type:"NICKNAME",method:"modifyParticipantOtherName",participant:_,payload:{participantId:k,otherName:void 0}};S.push(t)}}if(Al({policyActions:U,action:"SWAP"})){const{validSwapAction:t}=function({drawDefinition:t,drawPosition:e,structureId:i,structure:n,drawId:r,event:a,isByePosition:o,byeDrawPositions:s,positionAssignments:c,tournamentParticipants:u,onlyAssignedPositions:d=!0,activeDrawPositions:l,inactiveDrawPositions:p,possiblyDisablingAction:m}){if(l.includes(e))return{};const f=null==p?void 0:p.filter((t=>t!==e&&!(o&&s.includes(t)))),h=(null==c?void 0:c.filter((t=>(t=>!d||t.participantId||t.qualifier||t.bye)(t)&&(null==f?void 0:f.includes(t.drawPosition)))))||[],I=h.map((({drawPosition:t})=>t)),{matchUps:v}=ba({inContext:!0,drawDefinition:t,structure:n,event:a}),g=v.filter((({drawPositions:t})=>ot(t,I))),y=Object.assign({},...g.map((t=>{var e;return null===(e=t.sides)||void 0===e?void 0:e.filter((({sourceDrawPositionRange:t})=>t)).map((({drawPosition:t,sourceDrawPositionRange:e})=>({[t]:e})))})).flat()),U=h.map((t=>t.participantId)).filter(Boolean),w=(u||[]).filter((t=>U.includes(t.participantId))),S=Object.assign({},...w.map((t=>({[t.participantId]:t})))),N=h.map((t=>{const e=S&&S[t.participantId],i=y[t.drawPosition];return{...t,participant:me(e,!1,!0),sourceDrawPositionRange:i}}));return N.length?{validSwapAction:{type:"SWAP",method:"swapDrawPositionAssignments",availableAssignments:N,willDisableLinks:m,payload:{drawId:r,structureId:i,drawPositions:[e]}}}:{}}({drawId:N,structure:d,structureId:a,drawPosition:r,isByePosition:x,drawDefinition:n,byeDrawPositions:c,positionAssignments:D,activeDrawPositions:s,inactiveDrawPositions:u,tournamentParticipants:e,possiblyDisablingAction:w});t&&S.push(t)}}if(Al({policyActions:U,action:"ALTERNATE"})&&!y){const{validAlternatesAction:t}=function({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,policyDefinitions:r,drawDefinition:a,drawPosition:o,structureId:s,structure:c,drawId:u,event:d}){var l;if(i.includes(o))return{};const p=null==r||null===(l=r.positionActions)||void 0===l?void 0:l.otherFlightEntries,m=(a.entries||[]).map((({participantId:t})=>t)).filter(Boolean),f=n.map((t=>t.participantId)).filter(Boolean),h=(d.entries||[]).filter((t=>t.entryStatus===Yr&&function({structure:t,entry:e}){const{stage:i}=t;if(!e.entryStage||e.entryStage===i||e.entryStage===An&&i===bn)return!0}({structure:c,entry:t})&&!f.includes(t.participantId))).sort(((t,e)=>(t.entryPosition||9999)-(e.entryPosition||9999))).map((t=>t.participantId));if(p){var I;const{flightProfile:t}=Qo({event:d}),e=null==t||null===(I=t.flights)||void 0===I?void 0:I.filter((t=>t.drawId!==u)).map((t=>t.drawEntries.filter((t=>t.participantId&&!m.includes(t.participantId))).map((({participantId:t})=>t)))).flat().filter(Boolean);null!=e&&e.length&&h.push(...e)}const v=null==t?void 0:t.filter((t=>h.includes(t.participantId)));return v.forEach((t=>{const e=(a.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),v.sort(((t,e)=>(t.entryPosition||9999)-(e.entryPosition||9999))),h.length?{validAlternatesAction:{type:"ALTERNATE",method:"alternateDrawPositionAssignment",availableAlternates:v,availableAlternatesParticipantIds:h,willDisableLinks:e,payload:{drawId:u,structureId:s,drawPosition:o}}}:{}}({possiblyDisablingAction:w,tournamentParticipants:e,positionAssignments:D,activeDrawPositions:s,policyDefinitions:m,drawDefinition:n,drawPosition:r,structureId:a,structure:d,drawId:N,event:o});t&&S.push(t)}if(Al({policyActions:U,action:"LUCKY"})&&!y){const{validLuckyLosersAction:t}=function({tournamentParticipants:t=[],possiblyDisablingAction:e,isWinRatioFedStructure:i,activeDrawPositions:n,positionAssignments:r,drawDefinition:a,drawPosition:o,structureId:s,structure:c,drawId:u,event:d}){var l,p,m,f;if(n.includes(o)||i)return{};const{sourceStructureIds:h,targetStructureIds:I}=(null===(l=a.links)||void 0===l?void 0:l.reduce(((t,e)=>{var i,n;const r=null===(i=e.source)||void 0===i?void 0:i.structureId,a=null===(n=e.target)||void 0===n?void 0:n.structureId;return t.sourceStructureIds.includes(r)||t.sourceStructureIds.push(r),t.targetStructureIds.includes(a)||t.targetStructureIds.push(a),t}),{sourceStructureIds:[],targetStructureIds:[]}))||{};let v=null===(p=a.links)||void 0===p?void 0:p.find((t=>{var e;return(null===(e=t.target)||void 0===e?void 0:e.structureId)===c.structureId}));const g=null===(m=v)||void 0===m||null===(f=m.source)||void 0===f?void 0:f.structureId,{structure:y}=Fr({drawDefinition:a,structureId:g}),U={};if("ROUND_OUTCOME"===(null==y?void 0:y.finishingPosition)&&(1!==(null==h?void 0:h.length)||1!==(null==I?void 0:I.length))){var w,S,N;const{matchUps:t}=ba({drawDefinition:a,structure:c,event:d}),{initialRoundNumber:e}=Io({drawPosition:o,matchUps:t});v=null===(w=a.links)||void 0===w?void 0:w.find((t=>{var i;return(null===(i=t.target)||void 0===i?void 0:i.structureId)===(null==c?void 0:c.structureId)&&t.target.roundNumber===e}));const i=null===(S=v)||void 0===S||null===(N=S.source)||void 0===N?void 0:N.roundNumber;U.roundNumbers=[i]}const{completedMatchUps:P}=eo({structureId:g,inContext:!0,matchUpFilters:U,drawDefinition:a}),D=r.map((t=>t.participantId)).filter(Boolean),T=null==P?void 0:P.map((({winningSide:t,sides:e})=>e[1-(t-1)])).map(Ar).filter((t=>!D.includes(t))),M=null==t?void 0:t.filter((t=>null==T?void 0:T.includes(t.participantId)));return null==M||M.forEach((t=>{const e=(a.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),null!=T&&T.length?{validLuckyLosersAction:{type:"LUCKY",method:"luckyLoserDrawPositionAssignment",availableLuckyLosers:M,availableLuckyLoserParticipantIds:T,willDisableLinks:e,payload:{drawId:u,structureId:s,drawPosition:o}}}:{}}({drawId:N,structure:d,structureId:a,drawPosition:r,drawDefinition:n,activeDrawPositions:s,positionAssignments:D,isWinRatioFedStructure:g,tournamentParticipants:e,possiblyDisablingAction:w});t&&S.push(t)}return{isByePosition:x,isActiveDrawPosition:F,isDrawPosition:!0,hasPositionAssigned:!!T,validActions:S}}const bl={allPlayoffPositionsFilled:gs,isCompletedStructure:vs,getStructureMatchUps:eo,allStructureMatchUps:function(t){const{structure:e}=Fr(t);return Object.assign(t,{structure:e,inContext:!0}),ba(t)},allDrawMatchUps:function(t){return Object.assign(t,{inContext:!0}),io(t)},drawMatchUps:function(t){return Object.assign(t,{inContext:!0}),no(t)},getEliminationDrawSize:kd,getParticipantIdMatchUps:Dl,getParticipantIdFinishingPositions:Tl,structureActions:function(t){return null!=t&&t.drawDefinition?{actions:[],state:{isComplete:vs(t),hasPlayoffPositionsFilled:gs(t)}}:{error:mt}},matchUpActions:bu,positionActions:El,getStructureSeedAssignments:Ua,getNextUnfilledDrawPositions:function({drawDefinition:t,structureId:e}){if(!t)return{error:mt,nextUnfilledDrawPositions:[]};if(!e)return{error:"Missing structureId",nextUnfilledDrawPositions:[]};const{structure:i,error:n}=Fr({drawDefinition:t,structureId:e});if(n)return{error:n};const r=Pa({structure:i}),a=(null==r?void 0:r.positionAssignments)||[],{unfilledPositions:o}=Ms({drawDefinition:t,structureId:e,randomize:!0}),s=a.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));return null!=o&&o.length?{nextUnfilledDrawPositions:o}:{nextUnfilledDrawPositions:s}},getExitProfiles:function({drawDefinition:t}){if("object"!=typeof t)return{error:"Invalid drawDefinition"};const e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce(((t,e)=>{const{stage:i}=e;return t[i]?t[i].push(e):t[i]=[e],t}),{});for(const o of Object.keys(r)){const t=r[o].find((({stageSequence:t})=>1===t)),{structureId:i}=t;a(e,"0",o,i,0)}return{exitProfiles:e};function a(t,e,r,o,s){t[o]||(t[o]=[]),"0"===e&&[bn,Rn].includes(r)||t[o].push(e);const c=n.filter((t=>t.source.structureId===o&&t.source.roundNumber>=s));for(const n of c){const r=n.source.roundNumber,o=n.target.roundNumber,s=n.target.structureId;a(t,`${e}-${r}`,i.find((t=>t.structureId===s)).stage,s,o)}}},getMatchUpContextIds:function({matchUps:t,matchUpId:e}){if(!Array.isArray(t))return{error:gt};const i=t.find((t=>t.matchUpId===e)),{drawId:n,eventId:r,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:o}},getMatchUpParticipantIds:Ma,getMatchUpScheduleDetails:Ti,generateTieMatchUpScore:Ei,matchUpDuration:_e,credits:Eu};function Rl({validation:t=!0,drawDefinition:e,participantId:i,structureId:n,seedValue:r}){if(!e)return{error:mt};if(!n)return{error:"Missing structureId"};const{structure:a}=Fr({drawDefinition:e,structureId:n});if(!a)return{error:"structure not found"};if(!(!t||H(r)||[void 0,""].includes(r)||"string"==typeof r&&r.split("-").every((t=>H(t)&&t>0))))return{error:gt};const{seedAssignments:o}=Ua({drawDefinition:e,structure:a}),s=o.map((t=>t.seedNumber)),c=o.find((t=>t.participantId===i));if(c){const t="string"==typeof r&&r.includes("-")?r.split("-").map((t=>parseInt(t))).join("-"):r>0?parseInt(r):"";c.seedValue=t}else{const t=Math.max(0,...s)+1;a.seedAssignments.push({seedNumber:t,seedValue:r,participantId:i})}return Sr({drawDefinition:e,structureIds:[n]}),ut}function Cl({drawDefinition:t,participantId:e,structureId:i,seedNumber:n,seedValue:r}){const{structure:a}=Fr({drawDefinition:t,structureId:i}),{positionAssignments:o}=Pa({structure:a}),{seedAssignments:s}=Ua({drawDefinition:t,structure:a}),c=s.map((t=>t.seedNumber)),u=tl({drawDefinition:t,participantId:e});if(e&&!u)return{error:"Invalid participantId",participantId:e,method:"assignSeed"};const d=o.find((t=>t.participantId===e)),l=null==d?void 0:d.drawPosition;if(l&&!Ts({seedNumber:n,drawDefinition:t,structureId:i,drawPosition:l}))return{error:"Invalid drawPosition for seedAssignment"};if(c.includes(n)){let a;if(s.forEach((t=>{t.participantId===e&&t.seedNumber!==n&&(t.participantId=void 0),t.seedNumber===n&&(t.participantId=e,t.seedValue=r||n,a=!0)})),a)return Sr({drawDefinition:t,structureIds:[i]}),{...ut}}return{error:"Invalid seedNumber"}}const Ol={addDrawEntry:el,addDrawEntries:il,assignSeed:Cl,removeEntry:function({participantId:t,drawDefinition:e,autoEntryPositions:i=!0}){return e?t?qd({drawDefinition:e}).includes(t)?{error:"Existing participant drawPosition assignment"}:(null!=e&&e.entries&&(e.entries=e.entries.filter((e=>e.participantId!==t))),i&&(e.entries=Wd({entries:e.entries})),Sr({drawDefinition:e}),{...ut}):{error:"Missing participantId"}:{error:mt}},setStageDrawSize:ld,setStageAlternatesCount:function({drawDefinition:t,stage:e,alternatesCount:i}){return t?pa({drawDefinition:t,stage:e})?(zr({attributes:[{[e]:{alternates:i}}],drawDefinition:t}),i||(t.entries=(null===(n=t.entries)||void 0===n?void 0:n.filter((t=>t.entryStatus!==Yr)))||[]),Sr({drawDefinition:t}),{...ut}):{error:"Invalid stage"}:{error:mt};var n},setStageWildcardsCount:function({drawDefinition:t,stage:e,wildcardsCount:i=0}){if(!t)return{error:mt};if(!pa({drawDefinition:t,stage:e}))return{error:"Invalid stage"};const n=ma({drawDefinition:t,stage:e}),r=fa({drawDefinition:t,stage:e}),a=ga({drawDefinition:t,stage:e}),o=va({drawDefinition:t,stage:e});return i<a?{error:"Number of Wildcards cannot be less than number of Wildcards already entered"}:o+i+r>n?{error:"Total stage Entries cannot be greater than drawPositions"}:(zr({attributes:[{[e]:{wildcardsCount:i}}],drawDefinition:t}),Sr({drawDefinition:t}),{...ut})},setStageQualifiersCount:pd,modifySeedAssignment:Rl},Ll={generateQualifyingLink:function({qualifyingStructureId:t,mainStructureId:e,qualifyingRoundNumber:i,mainEntryRound:n=1,drawDefinition:r}){if(!r)return{error:mt};const a={linkType:"WINNER",source:{roundNumber:i,structureId:t},target:{feedProfile:"DRAW",roundNumber:n,structureId:e}};r.links.push(a),Sr({drawDefinition:r})}},xl=["drawId","structures"];function Fl(t,e=!0){return t?"object"!=typeof t?{error:"Invalid object"}:t.drawId?function(t){const e=Object.keys(t);return xl.reduce(((t,i)=>!!e.includes(i)&&t),!0)}(t)?e?me(t):t:{error:"Invalid drawDefinition"}:{error:"Missing drawId",method:"setState"}:{error:mt}}function kl({drawId:t=ve(),matchUpType:e,drawType:i}={}){return Object.assign({drawId:void 0,drawName:void 0,matchUpType:void 0,entries:[],links:[],structures:[]},{drawId:t,drawType:i,matchUpType:e})}let _l,jl=[];const Bl=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>({drawDefinition:me(_l,t,!1,e)}),version:()=>"0.74.1",reset:()=>(_l=void 0,ut),newDrawDefinition:({drawId:t,drawType:e}={})=>(_l=kl({drawId:t,drawType:e}),Object.assign({drawId:_l.drawId,drawDefinition:me(_l)},ut)),setDrawDescription:({description:t}={})=>_l?(_l.description=t,Sr({drawDefinition:_l}),Object.assign({drawId:_l.drawId},ut)):{error:mt}};return[Ll,bl,Sn,Ol,Pl,Sl,ll,Fd].forEach((i=>{Object.keys(i).forEach((n=>{t[n]=t=>{if(Pt())return e({params:t,governor:i,governorMethod:n});try{return e({params:t,governor:i,governorMethod:n})}catch(e){const r=e.toString();console.log("ERROR",{error:r,method:n,params:JSON.stringify(t)}),console.log(e)}}}))})),t.devContext=e=>(Dt(e),t),t.setParticipants=(e=[])=>(jl=e,t),t.setState=(e,i,n)=>(Mt(i,n),function(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0,_l=e,t.drawId=e.drawId),t}(Fl(e))),t;function e({params:e,governor:i,governorMethod:n}){var r,a,o,s;delete t.success,delete t.error;const c=(null===(r=e)||void 0===r?void 0:r.rollbackOnError)&&me(_l,!1,!0);e={...e,tournamentParticipants:jl,drawDefinition:_l};const u=i[n](e);if(null!=u&&u.error)return c&&Fl(c),{...u,rolledBack:!!c};const d=(null==u?void 0:u.success)&&!0!==(null===(a=e)||void 0===a?void 0:a.delayNotify)&&!0!==(null===(o=e)||void 0===o?void 0:o.doNotNotify);return d&&bc(),(d||null==u||!u.success||null!==(s=e)&&void 0!==s&&s.doNotNotify)&&bt(),u}}();function Gl(t,e){var i;if("object"!=typeof t)return{error:"Invalid object"};const n=(null===(i=t.unifiedTournamentId)||void 0===i?void 0:i.tournamentId)||t.tournamentId;if(!n)return{error:"Missing tournamentId"};const r=!1!==e?me(t):t;return kt({[n]:r}),_t(n),r}function Vl({convertExtensions:t,removeExtensions:e,tournamentId:i}={}){return"string"!=typeof i?{}:{tournamentRecord:me(Lt(i),t,!1,e)}}function Hl(t,e){return e&&e.someParam&&(e={...e}),e}const ql={getTournamentPoints:function({tournamentRecord:t,policyDefinition:e}){if(!t)return{error:pt};const{policyDefinitions:i}=$o({policyTypes:["rankingPoints"],tournamentRecord:t}),n=(null==e?void 0:e.rankingPoints)||(null==i?void 0:i.rankingPoints);if(!n)return{error:"Missing policyDefinitions"};const{tournamentParticipants:r}=wc({tournamentRecord:t,withDraws:!0}),a=r.filter((t=>{var e;return null===(e=t.draws)||void 0===e?void 0:e.length})),o={};for(const s of a){const{events:t,draws:e,person:i,individualParticipants:r}=s,a=null==i?void 0:i.personId;r&&console.log("individualParticipants"),e.forEach((e=>{var i,r,s,c;const{drawSize:u,eventId:d,finishingPositionRange:l,drawName:p}=e,m=J(l).join("-"),f=null==t?void 0:t.find((t=>t.eventId===d)),{category:h,eventType:I}=f||{},v=(null===(i=n.categories)||void 0===i||null===(r=i[h])||void 0===r?void 0:r.finishingPositionRanges)||n.finishingPositionRanges,g=null==v?void 0:v[m],y=(null==g?void 0:g.value)||(null==g||null===(s=g.drawSizes)||void 0===s||null===(c=s[u])||void 0===c?void 0:c.value)||g;a&&g&&(o[a]||(o[a]=[]),o[a].push({drawName:p,eventType:I,rangeAccessor:m,points:y}))}))}return{personPoints:o,...ut}}},Wl="ELO",zl={ELO:Wl,NTRP:"NTRP",TRN:"TRN",UTR:"UTR",WTN:"WTN"},Kl={[Wl]:{range:[0,3e3],decimalsCount:0,defaultInitialization:1500},NTRP:{range:[1,7],decimalsCount:1,defaultInitialization:3,accessor:"dntrpRatingHundredths",accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""}},UTR:{range:[1,16],decimalsCount:2,defaultInitialization:6},WTN:{range:[40,1],decimalsCount:2,defaultInitialization:23,accessor:"wtnRating",accessors:["wtnRating"],attributes:{confidence:90}}},Yl={nSpread:400,diffThreshold:.125,kCalc:t=>250/Math.pow(t+5,.4),kMultiplier:function(t=3,e=2){let i=t/e;return isNaN(i)?Yl.kDefault():i},kDefault:()=>1};function $l({ratings:t=Kl,winnerCountables:e=1,loserCountables:i=0,ratingType:n=Wl,maxCountables:r,winnerRating:a,loserRating:o,ratingRange:s,countables:c}={}){const u=null==t?void 0:t[n];if(!u)return{error:It};s=u.range||s,a=a||u.defaultInitialization,o=o||u.defaultInitialization;const d=s[0]>s[1],l=u.decimalsCount||0,p=d?s.slice().reverse():s,m=(t,e)=>parseFloat(e)>=Math.min(...t)&&parseFloat(e)<=Math.max(...t);m(s,a)&&m(s,o)||(m(s,a)||(a=u.defaultInitialization),m(s,o)||(o=u.defaultInitialization));const f=({value:t,sourceRange:e,targetRange:i})=>(t-e[0])*(i[1]-i[0])/(e[1]-e[0])+i[0],h=f({targetRange:Kl.ELO.range,sourceRange:p,value:d?s[0]-a:a}),I=f({targetRange:Kl.ELO.range,sourceRange:p,value:d?s[0]-o:o}),v=(t,e)=>1/(1+Math.pow(10,(e-t)/Yl.nSpread));let g=v(h,I),y=v(I,h),U=Yl.kCalc(e),w=Yl.kCalc(i),S=Yl.kMultiplier(r,c),N=h+S*U*(1-g),P=I+S*w*(0-y),D=f({sourceRange:Kl.ELO.range,value:N,targetRange:p}),T=f({sourceRange:Kl.ELO.range,value:P,targetRange:p});const M=d?s[0]-D:D;let A=parseFloat(M).toFixed(l);const E=d?s[0]-T:T;let b=parseFloat(E).toFixed(l);const R=Math.max(...s)?Math.abs(a-o)/Math.max(...s):0;return(D>T&&R>Yl.diffThreshold||A<0||b<0)&&(A=a,b=o),{newWinnerRating:A,newLoserRating:b}}function Jl({tournamentRecord:t,scaleAttributes:e,participantId:i}){if(!t)return{error:pt};if(!i)return{error:"Missing participantId"};const{participant:n}=$e({tournamentRecord:t,participantId:i});return n?ml({participant:n,scaleAttributes:e}):{error:"Participant Not Found"}}function Zl({tournamentRecord:t,participantId:e,scaleItem:i}){let n,r;const a=i&&Object.keys(i)||[],o=["scaleType","eventType","scaleName"],s=o.filter((t=>a.includes(t))).length===o.length;if(!s)return{error:"Invalid scaleItem"};if(e&&s&&Array.isArray(t.participants)&&(r=t.participants.find((t=>t.participantId===e)),r)){const{valueChanged:t,error:e}=Xl({participant:r,scaleItem:i});if(e)return{error:e};n=!t;const{topics:a}=Rt();a.includes("modifyParticipants")&&At({topic:"modifyParticipants",payload:{participants:[r]}})}return n?{...ut,message:"Value unchanged",existingValue:i.scaleValue}:r?{...ut,newValue:i.scaleValue}:{error:"Participant Not Found"}}function Ql({scaleItem:t}){const e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return!(i.filter((t=>e.includes(t))).length!==i.length)}function Xl({participant:t,scaleItem:e}){if(!t)return{error:"Missing participant"};const i=e&&Object.keys(e),n=["scaleType","eventType","scaleName"];if(n.filter((t=>i.includes(t))).length!==n.length)return{error:"Invalid scaleItem"};const r=(new Date).toISOString();t.timeItems||(t.timeItems=[]);const{scaleItem:a}=ml({participant:t,scaleAttributes:e}),o=t=>[void 0,null,""].includes(t),s=!(o(null==a?void 0:a.scaleValue)&&o(e.scaleValue))&&(null==a?void 0:a.scaleValue)!==e.scaleValue;if(s){const{scaleType:i,eventType:n,scaleName:a}=e,o={itemType:[fc,i,n,a].join("."),itemValue:e.scaleValue,itemDate:e.scaleDate,createdAt:r};e.scaleId&&(o.itemSubTypes=[e.scaleId]),t.timeItems.push(o)}return Object.assign({valueChanged:s,newValue:e.scaleValue},ut)}const tp={calculateNewRatings:$l,processMatchUps:function({tournamentRecord:t,ratingType:e=Wl,considerGames:i,matchUpIds:n,asDynamic:r}){if(!t)return{error:pt};if(!Array.isArray(n))return{error:"Missing matchUps"};if("string"!=typeof e)return{error:gt,ratingType:e};if(!Kl[e])return{error:gt};const a=Kl[e],{accessor:o}=a,s={},{matchUps:c}=ro({matchUpFilters:{matchUpIds:n,matchUpStatuses:x},tournamentRecord:t,inContext:!0});for(const f of c.sort(_o)){const{endDate:n,matchUpFormat:a,matchUpType:c,score:m,sides:h,winningSide:I}=f,v={scaleType:hc,eventType:c,scaleName:e},g=`${e}.DYNAMIC`,y={scaleType:hc,eventType:c,scaleName:g},U=Object.assign({},...h.map((({sideNumber:t,participant:e})=>({[t]:[null==e?void 0:e.participantId,...(null==e?void 0:e.individualParticipantIds)||[]].filter(Boolean).flat()})))),w=r?g:e,S=Object.assign({},...Object.values(U).flat().map((e=>{const{scaleItem:i}=Jl({scaleAttributes:y,tournamentRecord:t,participantId:e}),{scaleItem:r}=Jl({tournamentRecord:t,scaleAttributes:v,participantId:e});return{[e]:i||r||{scaleName:w,scaleType:hc,eventType:c,scaleDate:n,scaleValue:o?{[o]:void 0}:void 0}}}))),N=u(a)||{},P=(null==N?void 0:N.bestOf)||1,D=(null==N?void 0:N.setsTo)||1,T=i?P&D:P,M=null!=m&&m.sets?(null==(p=m.sets)?void 0:p.reduce(((t,e)=>(e.winningSide&&(t[e.winningSide-1]+=1),t)),[0,0]))||[0,0]:1===I?[1,0]:[0,1],A=U[I],E=U[3-I];for(const i of A){var d;const n=null===(d=S[i])||void 0===d?void 0:d.scaleValue,r="object"==typeof n?n[o]:n;for(const a of E){var l;const s=null===(l=S[a])||void 0===l?void 0:l.scaleValue,c="object"==typeof s?s[o]:s,u=M[I],d=M[3-I],{newWinnerRating:p,newLoserRating:m}=$l({winnerCountables:u,loserCountables:d,maxCountables:T,winnerRating:r,loserRating:c,ratingType:e}),f=o?{...n,[o]:p}:p,h=o?{...s,[o]:m}:m;S[i].scaleValue=f,S[a].scaleValue=h;let v=Zl({scaleItem:{...S[i],scaleName:w},participantId:i,tournamentRecord:t});if(v.error)return v;if(v=Zl({scaleItem:{...S[a],scaleName:w},participantId:a,tournamentRecord:t}),v.error)return v}}Object.assign(s,S)}var p;const m=c.map((({matchUpId:t})=>t));return{...ut,modifiedScaleValues:s,processedMatchUpIds:m}}};!function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>Vl({convertExtensions:t,removeExtensions:e,tournamentId:Ot()}),setTournamentId:t=>_t(t)};function e(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}return t.version=()=>"0.74.1",t.reset=()=>e(jt(Ot())),t.setState=(t,i,n)=>(Mt(i,n),e(Gl(t,i))),[ql,tp].forEach((e=>{Object.keys(e).forEach((n=>{t[n]=t=>{if(Pt())return i(e[n],t);try{return i(e[n],t)}catch(e){const r=e.toString();console.log("ERROR",{error:r,method:n,params:JSON.stringify(t)}),console.log(e)}}}))})),t;function i(e,i){const n=(null==i?void 0:i.sandBoxRecord)||(null==i?void 0:i.sandboxRecord)||(null==i?void 0:i.sandboxTournament)||Lt(Ot()),r=(null==i?void 0:i.rollbackOnError)&&me(n,!1,!0),a=function(e,i,n){return delete t.success,delete t.error,i({...Hl(0,n),tournamentRecord:e})}(n,e,i);null!=a&&a.error&&r&&Gl(r);const o=(null==a?void 0:a.success)&&!0!==(null==i?void 0:i.delayNotify)&&!0!==(null==i?void 0:i.doNotNotify);return o&&bc(),(o||null==a||!a.success||null!=i&&i.doNotNotify)&&bt(),a}}();function ep(t={}){return t.tournamentId||Object.assign(t,{tournamentId:ve()}),t.startDate&&!Qt(t.startDate)&&!Bt.test(t.startDate)||t.endDate&&!Qt(t.endDate)&&!Bt.test(t.endDate)?{error:vt}:(t.extensions&&(t.extensions=t.filter(_r)),{...t})}function ip(t,e){var i;if("object"!=typeof t)return{error:"Invalid object"};const n=(null===(i=t.unifiedTournamentId)||void 0===i?void 0:i.tournamentId)||t.tournamentId;if(!n)return{error:"Missing tournamentId"};const r=!1!==e?me(t):t;return kt({[n]:r}),_t(n),r}function np({convertExtensions:t,removeExtensions:e,tournamentId:i}={}){return"string"!=typeof i?{}:{tournamentRecord:me(Lt(i),t,!1,e)}}function rp(t,e,i){if(e){const{drawId:n}=e||e.matchUp&&e.matchUp.drawId;if(n){const{event:r,drawDefinition:a}=ui({tournamentRecord:t,drawId:n});if(e={...e,event:r,drawDefinition:a},i){const t=Or({drawDefinition:a}),{matchUps:i}=io({drawDefinition:a,inContext:!0,includeByeMatchUps:!0,matchUpsMap:t});e.matchUpsMap=t,e.inContextDrawMatchUps=i}}if(e.eventId&&!e.event){const{event:i}=ui({tournamentRecord:t,eventId:e.eventId});i&&(e={...e,event:i})}}return e}function ap({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){if(!n)return{error:pt};if(!e||!t)return{error:It};const r=n.participants||[],a=r.find((t=>t.participantId===e));if(!a)return{error:"Participant Not Found"};if(![Ci,Li].includes(a.participantType))return{error:"Invalid participantType",participantType:a.participantType};const o=t.filter((t=>{const e=r.find((e=>e.participantId===t));return(null==e?void 0:e.participantType)!==Ri}));if(o.length)return{error:"Invalid participantIds",invalidParticipantIds:o};a.individualParticipantIds||(a.individualParticipantIds=[]);const s=a.individualParticipantIds,c=t.filter((t=>!s.includes(t)));c.length&&(i&&Jd({tournamentRecord:n,individualParticipantIds:c}),a.individualParticipantIds=a.individualParticipantIds.concat(...c));const{topics:u}=Rt();return u.includes("modifyParticipants")&&At({topic:"modifyParticipants",payload:{participants:[r.find((({participantId:t})=>t===e))]}}),function({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){const n=(i.events||[]).filter((t=>{var i;return(null==t?void 0:t.eventType)===gi&&(null==t||null===(i=t.entries)||void 0===i?void 0:i.some((t=>t.participantId===e)))})),r=e=>!t.includes(e.participantId);for(const s of n){var a,o;s.entries=(s.entries||[]).filter(r);const{flightProfile:t}=Qo({event:s});null==t||null===(a=t.flights)||void 0===a||a.forEach((t=>{t.drawEntries=(t.drawEntries||[]).filter(r)})),null==s||null===(o=s.drawDefinitions)||void 0===o||o.forEach((t=>{t.entries=(t.entries||[]).filter(r)}))}}({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:me(a),added:c.length,...ut}}function op({participantAttribute:t,tournamentRecord:e,personAttribute:i,teamNames:n,accessor:r,uuids:a}){if(!e)return{error:pt};const o={},s=(e.participants||[]).filter((({participantType:t,participantRole:e})=>t===Ri&&e===pu));let c=0;for(const m of s){const{value:e}=gc({element:m,accessor:r}),s=e||(i?m.person[i]:m[t]);if(s){if(!Object.keys(o).includes(s)){o[s]={participantName:(null==n?void 0:n[c])||s,participantId:(null==a?void 0:a.pop())||ve(),participantType:Ci,participantRole:pu,individualParticipantIds:[]};const e={name:"groupingAttribute",value:i||t};jr({element:o[s],extension:e}),c+=1}o[s].individualParticipantIds.push(m.participantId)}}const u=Object.keys(o),d=(e.participants||[]).map((t=>{if(t.participantType!==Ci)return;if(t.participantRole!==pu)return;const{extension:e}=Je({element:t,name:"groupingAttribute"}),i=null==e?void 0:e.value;return u.includes(i)?t.participantId:void 0})).filter(Boolean),l=[];let p=0;return Object.keys(o).forEach((t=>{const i=o[t],{participantId:n}=i;d.includes(n)||(e.participants.push(i),l.push(i),p++)})),p&&At({topic:"addParticipants",payload:{participants:l}}),p?{...ut,participantsAdded:p}:{error:"No matching participants found"}}const sp="MALE",cp="FEMALE",up={ANY:"ANY",MALE:sp,FEMALE:cp,MIXED:"MIXED",OTHER:"OTHER"};function dp({updateParticipantName:t=!0,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n,pairOverride:r,participant:a}){if(!n)return{error:pt};if(!a)return{error:"Missing participant"};if(!a.participantId)return ic({tournamentRecord:n,participant:a});const{participant:o}=$e({tournamentRecord:n,participantId:a.participantId});if(!o)return ic({tournamentRecord:n,participant:a});const{participantRoleResponsibilties:s,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:l,participantType:p,onlineProfiles:m,contacts:f,person:h}=a,I={};if(f&&(I.contacts=f),m&&(I.onlineProfiles=m),d&&"string"==typeof d&&(I.participantName=d),u&&"string"==typeof u&&(I.participantOtherName=u),Array.isArray(c)){const{tournamentParticipants:e}=wc({tournamentRecord:n,participantFilters:{participantTypes:[xi.INDIVIDUAL]}}),i=null==e?void 0:e.map(Ar);if(i){const n=c.filter((t=>"string"==typeof t&&i.includes(t)));([Li,ni].includes(p)||p===Oi&&(2===n.length||r))&&(I.individualParticipantIds=n),o.participantType===xi.PAIR&&t&&(I.participantName=function({individualParticipants:t,newValues:e}){const i=e.individualParticipantIds;let n=t.filter((({participantId:t})=>i.includes(t))).map((({person:t})=>null==t?void 0:t.standardFamilyName)).filter(Boolean).sort().join("/");return 1===i.length&&(n+="/Unknown"),n}({individualParticipants:e,newValues:I}))}}return Object.keys(mu).includes(l)&&(I.participantRole=l),Object.keys(xi).includes(p)&&(I.participantType=p),Array.isArray(s)&&(I.participantRoleResponsibilties=s),o.participantType===xi.INDIVIDUAL&&h&&function({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){const r={},{sex:a,personId:o,nationalityCode:s,standardFamilyName:c,standardGivenName:u}=n;let d;if(a&&Object.keys(up).includes(a)&&(r.sex=a),o&&"string"==typeof o&&(r.personId=o),s&&"string"==typeof s&&s.length<4&&(r.nationalityCode=s),c&&"string"==typeof c&&c.length>1&&(r.standardFamilyName=c,d=!0),u&&"string"==typeof u&&u.length>1&&(r.standardGivenName=u,d=!0),d&&t){const t=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=t}Object.assign(e.person,r)}({updateParticipantName:t,existingParticipant:o,newValues:I,person:h}),Object.assign(o,fe(I)),e&&ap({tournamentRecord:n,groupingParticipantId:e,individualParticipantIds:[o.participantId],removeFromOtherTeams:i}),At({topic:"modifyParticipants",payload:{participants:[o]}}),Pt()?{...ut,participant:me(o)}:{...ut}}const lp={addPenalty:Dc,modifyPenalty:Ac,removePenalty:Tc,getTournamentPenalties:Mc,addPersons:function({participantRole:t=pu,tournamentRecord:e,persons:i}){var n;if(!e)return{error:pt};if(!Array.isArray(i))return{error:gt};if(!Object.keys(mu).includes(t))return{error:"Invalid participantRole"};const r=(e.participants||[]).map((({person:t})=>null==t?void 0:t.personId)).filter(Boolean),a=[];let o=0,s=0,c=nc({participants:i.filter((t=>t&&(!t.personId||!r.includes(t.personId)))).map((t=>(t.personId||(t.personId=ve()),a.push(t.personId),t))).map((e=>{return fe({extensions:e.participantExtensions,timeItems:e.participantTimeItems,participantType:Ri,participantRole:t,person:(i=e,n=["participantExtensions","participantTimeItems","pairedPersons"],Object.assign({},...Object.keys(i).filter((t=>!n.includes(t))).map((t=>({[t]:i[t]})))))});var i,n})),tournamentRecord:e});if(c.error)return c;s=c.addedCount||0;const u=[],d=(null===(n=wc({participantFilters:{participantTypes:[Ri]},tournamentRecord:e}))||void 0===n?void 0:n.tournamentParticipants)||[];if(t===pu&&i.filter((({pairedPersons:t})=>t)).forEach((({personId:t,pairedPersons:e})=>{Array.isArray(e)&&e.forEach((e=>{const i=[t,e.personId].map((t=>Ye({tournamentParticipants:d,personId:t}))).filter(Boolean);if(2===i.length){const t=i.map(Ar);u.push(fe({extensions:e.participantExtensions,timeItems:e.timeItems,participantRole:pu,individualParticipantIds:t,participantType:Oi}))}}))})),u.length){if(c=nc({participants:u,tournamentRecord:e}),c.error)return c;o=c.addedCount||0}const l=s+o;return{...ut,addedCount:l}},addParticipant:ic,addParticipants:nc,deleteParticipants:Zd,createGroupParticipant:function({tournamentRecord:t,participantId:e,individualParticipantIds:i=[],participantRoleResponsibilities:n,participantRole:r="OTHER",groupName:a}){if(!t)return{error:pt};if(!a)return{error:It,message:"Missing groupName"};if(!Array.isArray(i))return{error:gt,message:"Invalid individualParticipantIds"};const{tournamentParticipants:o}=wc({tournamentRecord:t,participantFilters:{participantTypes:[Ri]}}),s=o.map((t=>t.participantId));for(const l of i)if(!s.includes(l))return{error:"Invalid participantType",participantId:l};const c=fe({participantId:e||ve(),participantType:Li,participantRole:r,participantName:a,individualParticipantIds:i,participantRoleResponsibilities:n}),u=ic({tournamentRecord:t,participant:c});if(u.error)return u;const{topics:d}=Rt();return d.includes("addParticipants")&&At({topic:"addParticipants",payload:{participants:[c]}}),{...ut,participant:me(c)}},addIndividualParticipantIds:ap,removeIndividualParticipantIds:Yd,modifyIndividualParticipantIds:function({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:i}){if(!t)return{error:pt};if(!e||!i)return{error:It};const n=t.participants||[],r=n.find((t=>t.participantId===e));if(!r)return{error:"Participant Not Found"};if(![Ci,Li].includes(r.participantType))return{error:"Invalid participantType",participantType:r.participantType};const a=i.filter((t=>{const e=n.find((e=>e.participantId===t));return(null==e?void 0:e.participantType)!==Ri}));if(a.length)return{error:"Invalid participantIds",invalidParticipantIds:a};const o=r.individualParticipantIds||[],s=i.filter((t=>!o.includes(t))),c=o.filter((t=>!i.includes(t))),u=ap({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:s});if(u.error)return u;const d=Yd({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:c});if(d.error)return d;const{topics:l}=Rt();return l.includes("modifyParticipants")&&At({topic:"modifyParticipants",payload:{participants:[n.find((({participantId:t})=>t===e))]}}),{...u,...d}},removeParticipantIdsFromAllTeams:Jd,getParticipantMembership:function({tournamentRecord:t,participantId:e}){if(!t)return{error:pt};if(!e)return{error:"Missing participantId"};const{tournamentParticipants:i}=wc({tournamentRecord:t,participantFilters:{participantTypes:[Ci,Oi,Li]}});return(i||[]).filter((t=>{var i;return null===(i=t.individualParticipantIds)||void 0===i?void 0:i.includes(e)})).reduce(((t,e)=>{const{participantType:i}=e;return t[i]||(t[i]=[]),t[i].push(e),t}),{})},generateTeamsFromParticipantAttribute:op,getParticipantIdFinishingPositions:function({tournamentRecord:t,drawDefinition:e,byeAdvancements:i=!1}){return t?Tl({tournamentParticipants:t.participants,byeAdvancements:i,drawDefinition:e}):{error:pt}},modifyParticipant:dp,modifyParticipantName:function({tournamentRecord:t,participantId:e,participantName:i}){if(!t)return{error:pt};if(!e)return{error:"Missing participantId"};if(!i)return{error:It,message:"Missing participantName"};const{participant:n}=$e({tournamentRecord:t,participantId:e});if(!n)return{error:"Participant Not Found"};n.participantName=i;const{topics:r}=Rt();return r.includes("modifyParticipants")&&At({topic:"modifyParticipants",payload:{participants:[n]}}),ut},modifyParticipantOtherName:function({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:pt};if(!e)return{error:"Missing participantId"};const{participant:n}=$e({tournamentRecord:t,participantId:e});if(!n)return{error:"Participant Not Found"};n.participantOtherName=i;const{topics:r}=Rt();return r.includes("modifyParticipants")&&At({topic:"modifyParticipants",payload:{participants:[n]}}),ut},mergeParticipants:function({tournamentRecord:t,participants:e=[],arraysToMerge:i}){if(!t)return{error:pt};t.participants||(t.participants=[]);const n=Object.assign(...e.filter(Jo).map((t=>({[t.participantId]:t})))),r=[];t.participants=t.participants.map((t=>{if(n[t.participantId]){const e=Sc(t,n[t.participantId],i);return r.push(e),e}return t}));const a=t.participants.map(Ar),o=e.filter((({participantId:t})=>!a.includes(t))),{topics:s}=Rt();return o.length&&(t.participants=t.participants.concat(...o),s.includes("addParticipants")&&At({topic:"addParticipants",payload:{participants:o}})),r.length&&s.includes("modifyParticipants")&&At({topic:"modifyParticipants",payload:{participants:r}}),o.length||r.length?ut:void 0},getPairedParticipant:Nr,setParticipantScaleItem:Zl,setParticipantScaleItems:function({scaleItemsWithParticipantIds:t=[],tournamentRecord:e}){if(!e)return{error:pt};if(!e.participants)return{error:"Missing participants"};let i=0;const n={},r=[];for(const s of t){const t=null==s?void 0:s.participantId;Array.isArray(null==s?void 0:s.scaleItems)&&s.scaleItems.forEach((e=>{if(!Ql({scaleItem:e}))return{error:"Invalid scaleItem"};Array.isArray(n[t])||(n[t]=[]),n[t].push(e)}))}e.participants.forEach((t=>{const{participantId:e}=t||{};Array.isArray(n[e])&&n[e].forEach((e=>{Xl({participant:t,scaleItem:e}),r.push(t),i++}))}));const a=i?void 0:"No modifications applied",{topics:o}=Rt();return o.includes("modifyParticipants")&&i&&At({topic:"modifyParticipants",payload:{participants:r}}),fe({...ut,modificationsApplied:i,message:a})},modifyParticipantsSignInStatus:function({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:pt};if(!Array.isArray(e))return{error:It};if(![lc,pc].includes(i))return{error:gt,signInState:i};const n=t.participants||[];if(!n.length)return{error:"Missing participants"};const r=[],a=(new Date).toISOString();for(const s of n){const{participantId:n}=s;if(e.includes(n)){const e=fr({tournamentRecord:t,duplicateValues:!1,participantId:n,timeItem:{itemType:"SIGN_IN_STATUS",itemValue:i,createdAt:a}});if(e.error)return e;r.push(s)}}const{topics:o}=Rt();return r.length&&o.includes("modifyParticipants")&&At({topic:"modifyParticipants",payload:{participants:r}}),{...ut}},getParticipantEventDetails:function({tournamentRecord:t,participantId:e}){if(!t)return{error:pt};if(!e)return{error:"Missing participantId"};const i=[e].concat((t.participants||[]).filter((t=>{var i;return[Ci,Oi].includes(t.participantType)&&(null===(i=t.individualParticipantIds)||void 0===i?void 0:i.includes(e))})).map((t=>t.participantId)));return{eventDetails:(t.events||[]).filter((t=>ot(((null==t?void 0:t.entries)||[]).map((t=>t.participantId)),i))).map((t=>({eventName:t.eventName,eventId:t.eventId})))}},findParticipant:function({tournamentRecord:t,policyDefinitions:e,convertExtensions:i,participantId:n,inContext:r,personId:a}){return t?"string"!=typeof n&&"string"!=typeof a?{error:It}:{participant:me(Ye({tournamentParticipants:t.participants||[],policyDefinitions:e,participantId:n,personId:a,inContext:r}),i,!0)}:{error:pt}},getTournamentParticipants:wc,getTournamentPersons:function({tournamentRecord:t,participantFilters:e}){if(!t)return{error:pt};let i=t.participants||[];e&&(i=yc({tournamentRecord:t,participantFilters:e,participants:i}));const n={},r=t=>{if(t.person){const{personId:e}=t.person;n[e]?n[e].participantIds.push(t.participantId):n[e]={...t.person,participantIds:[t.participantId]}}};return i.forEach((t=>{t.person&&r(t),t.individualParticipants&&t.individualParticipants.forEach(r)})),{tournamentPersons:Object.values(n)}}};function pp({tournamentParticipants:t=[],policyDefinitions:e,tournamentRecord:i,inContext:n=!0,drawDefinition:r,context:a,event:o}){if(!r)return{error:mt};const s=(({drawId:t,drawName:e,matchUpFormat:i,updatedAt:n})=>({matchUpFormat:i,updatedAt:n,drawName:e,drawId:t}))(r);let c,u;const{structureGroups:d}=function({drawDefinition:t}){let e=(t.links||[]).map((t=>[t.source.structureId,t.target.structureId]));const i=e.length;nt(0,Math.ceil(i/2)).forEach((()=>{e=nt(0,i).map((t=>{const i=e[t],n=e.reduce(((t,e)=>ot(i,e)?t.concat(...e):t),[])||[];return J(i.concat(...n))}))}));const n=e[0],r=e.slice(1).reduce(((t,e)=>t&&((t,e)=>at(t,e).length===t.length)(e,n)),!0),a=[n].filter(Boolean);(t.structures||[]).forEach((t=>{const{structureId:e}=t;a.find((t=>t.includes(e)))||a.push([e])}));const o=r&&1===a.length;return{structureGroups:a,allStructuresLinked:o}}({drawDefinition:r});let l=!1,p=!1;const m=d.map((d=>{const m=d.map((t=>{const{structure:e}=Fr({drawDefinition:r,structureId:t}),{seedAssignments:i}=Ua({drawDefinition:r,structure:e});return e.stage===An&&1===e.stageSequence&&(c=i),e.stage===En&&1===e.stageSequence&&(u=i),e})).sort(xr).map((d=>{const{structureId:m}=d;let f=[];[An,bn,Rn].includes(d.stage)&&(f=c),d.stage===En&&(f=u);const{matchUps:h,roundMatchUps:I}=ba({context:{drawId:s.drawId,...a},tournamentParticipants:t,policyDefinitions:e,tournamentRecord:i,seedAssignments:f,drawDefinition:r,structure:d,inContext:n,event:o}),{positionAssignments:v}=Na({structure:d}),D=v.filter(Jo).map((t=>{p=!0;const{drawPosition:e,participantId:i}=t,{extension:n}=Je({element:t,name:"tally"});return n&&{drawPosition:e,participantId:i,participantResult:n.value}})).filter((t=>null==t?void 0:t.participantResult)),M=(({stage:t,stageSequence:e,structureName:i,structureType:n,matchUpFormat:r,positionAssignments:a})=>({stage:t,stageSequence:e,structureName:i,structureType:n,matchUpFormat:r,positionAssignments:a}))(d);return M.structureActive=h.reduce(((t,e)=>{var i;const n=[w,U,S,T,E,P,N].includes(e.matchUpStatus);return t||n||!!e.winningSide||!(null===(i=e.score)||void 0===i||!i.scoreStringSide1)}),!1),M.structureCompleted=h.reduce(((t,e)=>t&&[y,w,T,E,S,g].includes(e.matchUpStatus)),!0),M.structureActive&&(l=!0),{...M,structureId:m,roundMatchUps:I,seedAssignments:f,participantResults:D}}));return m.forEach((t=>delete t.positionAssignments)),m}));if(m.length>1){const t={error:"drawDefinition contains unlinked structures"};return Pt()&&console.log(t),t}const f=m.flat();return s.drawActive=l,s.participantPlacements=p,s.drawGenerated=null==f?void 0:f.reduce(((t,e)=>t||!(null==e||!e.roundMatchUps)),!1),s.drawCompleted=null==f?void 0:f.reduce(((t,e)=>t&&e.structureCompleted),!0),{...ut,drawInfo:me(s),structures:me(f)}}function mp({participantsProfile:t,policyDefinitions:e,tournamentRecord:i,event:n}){if(!i)return{error:pt};if(!n)return{error:ht};const{eventId:r}=n,{tournamentId:a,endDate:o}=i,{tournamentParticipants:s}=wc({withGroupings:!0,withEvents:!1,withDraws:!1,withISO:!0,...t,tournamentRecord:i}),c=(n.drawDefinitions||[]).map((t=>(({drawInfo:t,structures:e})=>({...t,structures:e}))(pp({context:{eventId:r,tournamentId:a,endDate:o},tournamentParticipants:s,policyDefinitions:e,tournamentRecord:i,drawDefinition:t,event:n})))),{tournamentInfo:u}=So({tournamentRecord:i}),d=(i.venues||[]).map((t=>(({venueData:t})=>({...t}))(Di({tournamentRecord:i,venueId:t.venueId})))),l={eventInfo:(({eventId:t,eventName:e,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:t,eventName:e,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(n),drawsData:c,venuesData:d,tournamentInfo:u},{timeItem:p}=pr({event:n,itemType:"PUBLISH.STATUS"});return l.eventInfo.publish={state:null==p?void 0:p.itemValue,createdAt:null==p?void 0:p.createdAt},{...ut,eventData:me(l)}}function fp({policyDefinitions:t,structureIds:e=[],tournamentRecord:i,drawIdsToRemove:n,status:r="PUBLIC",drawIdsToAdd:a,drawIds:o,event:s}){var c,u,d;if(!i)return{error:pt};if(!s)return{error:ht};const l="PUBLISH.STATUS",p=(null===(c=s.drawDefinitions)||void 0===c?void 0:c.map((({drawId:t})=>t)))||[];if(o||a||n){if(!o&&(null!=a&&a.length||null!=n&&n.length)){var m,f;const{timeItem:t}=pr({itemType:l,event:s});o=(null==t||null===(m=t.itemValue)||void 0===m||null===(f=m.PUBLIC)||void 0===f?void 0:f.drawIds)||[]}}else o=p;o=(o||[]).filter((t=>!(null!=n&&n.length&&n.includes(t)))),null!=a&&a.length&&(o=J(o.concat(...a.filter((t=>p.includes(t)))))),Ir({event:s,timeItem:{itemType:l,itemValue:{[r]:{drawIds:o,structureIds:e}}}});const{eventData:h}=mp({policyDefinitions:t,tournamentRecord:i,event:s}),I=null==h||null===(u=h.eventInfo)||void 0===u||null===(d=u.publish)||void 0===d?void 0:d.state;return h.drawsData=h.drawsData.filter((({drawId:t})=>{var e;return null==I||null===(e=I.PUBLIC)||void 0===e?void 0:e.drawIds.includes(t)})),At({topic:"publishEvent",payload:{eventData:h}}),{...ut,eventData:h}}const hp={getTournamentInfo:So,getVenueData:Di,getCourtInfo:Pi,getAllEventData:function({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:pt};const i=t.events||[],n=(null==t?void 0:t.participants)||[],{tournamentInfo:r}=So({tournamentRecord:t}),{venues:a}=Ui({tournamentRecord:t});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:i.map((i=>{const{eventId:r}=i,a=(({eventId:t,eventName:e,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:t,eventName:e,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(i),o=ti({tournamentRecord:t,event:i}).scheduleTiming,s=(i.drawDefinitions||[]).map((a=>{const s=(({drawId:t,drawName:e,matchUpFormat:i,updatedAt:n})=>({drawId:t,drawName:e,matchUpFormat:i,updatedAt:n}))(a),{pendingMatchUps:c,completedMatchUps:u,upcomingMatchUps:d,abandonedMatchUps:l}=no({includeByeMatchUps:!1,requireParticipants:!0,tournamentParticipants:n,context:{eventId:r},policyDefinitions:e,tournamentRecord:t,inContext:!0,drawDefinition:a,scheduleTiming:o,event:i});return{drawInfo:s,matchUps:{abandonedMatchUps:l,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:c}}})),{timeItem:c}=pr({event:i,itemType:"PUBLISH.STATUS"});return Object.assign(a,{publish:null==c?void 0:c.itemValue,drawsData:s}),a}))}}},getEventData:mp,getDrawData:pp,publishEvent:fp,unPublishEvent:function({tournamentRecord:t,event:e}){return t?e?(Ir({event:e,timeItem:{itemType:"PUBLISH.STATUS",itemValue:"HIDDEN"}}),At({topic:"unPublishEvent",payload:{eventId:e.eventId}}),Object.assign({eventId:e.eventId},ut)):{error:ht}:{error:pt}}};function Ip(t){var e,i,n,r,a;const o=null===(e=t.participants)||void 0===e?void 0:e.filter((({participantType:t})=>t===Ci)),s=2===(null==o?void 0:o.length),c=1===(null===(i=t.events)||void 0===i?void 0:i.length)&&t.events[0],u=1===(null==c||null===(n=c.drawDefinitions)||void 0===n?void 0:n.length)&&c.drawDefinitions[0],d=1===(null==u||null===(r=u.structures)||void 0===r?void 0:r.length)&&u.structures[0],l=2===(null==d||null===(a=d.positionAssignments)||void 0===a?void 0:a.length);return c.tieFormat&&s&&l}const vp={addNotes:Yo,removeNotes:function({element:t}={}){return"object"!=typeof t?{error:gt}:(t.notes&&delete t.notes,ut)},analyzeTournament:function({tournamentRecord:t}){if(!t)return{error:pt};const{drawsAnalysis:e}=function(t){var e;const i={noPositionsAssigned:0,positionsNoOutcomes:0,matchPlayDraws:0,canBePruned:0,draws:[]};return(null===(e=t.events)||void 0===e?void 0:e.map((t=>null==t?void 0:t.drawDefinitions)).flat().filter(Boolean)).forEach((t=>{const e=((null==t?void 0:t.structures)||[]).map((e=>{const{stage:i,stageSequence:n,structureId:r}=e,a=On[i],{inContextStructureMatchUps:o}=Ho({drawDefinition:t,structure:e}),{positionAssignments:s}=Na({structure:e}),c=null==s?void 0:s.filter((({participantId:t})=>t)),u=((null==s?void 0:s.length)||0)-((null==c?void 0:c.length)||0),{roundMatchUps:d,roundProfile:l,roundNumbers:p,maxMatchUpsCount:m}=Cr({matchUps:o}),f=Object.keys(l).filter((t=>!l[t].inactiveRound)),h=Object.values(l).every((t=>t.inactiveRound));return{positionsAssignedCount:(null==c?void 0:c.length)||0,unassignedPositionsCount:u,inactiveStructure:h,maxMatchUpsCount:m,roundMatchUps:d,activeRounds:f,roundNumbers:p,roundProfile:l,structureId:r,stageSequence:n,orderNumber:a,stage:i}})),n=e.find((t=>2===t.orderNumber&&1===t.stageSequence)),r=1===n.activeRounds.length&&1===parseInt(n.activeRounds[0]),a=n.activeRounds.length&&n.roundProfile[1].inActiveCount;r&&(i.matchPlayDraws+=1),a&&(i.canBePruned+=1),i.draws.push({drawId:t.drawId,structureData:e,isMatchPlay:r})})),{...ut,drawsAnalysis:i}}(t),i={isDual:Ip(t),drawsAnalysis:e};return{...ut,analysis:i}},setTournamentName:function({tournamentRecord:t,tournamentName:e,promotionalName:i,formalName:n}){return t?(e&&(t.tournamentName=e),i&&(t.promotionalName=i),n&&(t.formalName=n),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,ut):{error:pt}},setTournamentNotes:function({tournamentRecord:t,notes:e}){return t?Yo({element:t,notes:e}):{error:pt}},setTournamentEndDate:function({tournamentRecord:t,endDate:e}){return t?Vt.test(e)?(t.endDate&&(new Date(e),new Date(t.endDate)),t.startDate&&new Date(e)<new Date(t.startDate)&&(t.startDate=e),t.endDate=e,ut):{error:vt}:{error:pt}},setTournamentStartDate:function({tournamentRecord:t,startDate:e}){return t?Vt.test(e)?(t.startDate&&(new Date(e),new Date(t.startDate)),t.endDate&&new Date(e)>new Date(t.endDate)&&(t.endDate=e),t.startDate=e,ut):{error:vt}:{error:pt}},setTournamentCategories:function({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter((t=>t.categoryName&&t.type)),t.tournamentCategories=e,ut):{error:pt}},addEventTimeItem:Ir,addTournamentTimeItem:hr,addParticipantTimeItem:fr,addEventExtension:Hr,removeEventExtension:Wr,addTournamentExtension:Gr,removeTournamentExtension:qr,addParticipantExtension:function({tournamentRecord:t,participantId:e,extension:i}={}){if(!e)return{error:"Missing participantId"};const n=Ye({tournamentParticipants:(null==t?void 0:t.participants)||[],participantId:e});return n?jr({element:n,extension:i}):{error:"Participant Not Found"}},removeParticipantExtension:function({tournamentRecord:t,participantId:e,name:i}={}){if(!e)return{error:"Missing participantId"};const n=Ye({tournamentParticipants:(null==t?void 0:t.participants)||[],participantId:e});return n?Br({element:n,name:i}):{error:"Participant Not Found"}},addDrawDefinitionExtension:Vr,removeDrawDefinitionExtension:function({drawDefinition:t,name:e}={}){return t?Br({element:t,name:e}):{error:"drawDefinition not found"}}},gp={assignMatchUpCourt:La,assignMatchUpVenue:Oa,addMatchUpScheduleItems:fu,addMatchUpScheduledDate:hu,addMatchUpScheduledTime:Iu,addMatchUpStartTime:vu,addMatchUpEndTime:gu,addMatchUpStopTime:yu,addMatchUpResumeTime:Uu,addMatchUpOfficial:wu,getMatchUpFormatTiming:si,modifyMatchUpFormatTiming:Cc,getModifiedMatchUpFormatTiming:Rc,getEventMatchUpFormatTiming:Fc,modifyEventMatchUpFormatTiming:Lc,removeEventMatchUpFormatTiming:su,getMatchUpFormatTimingUpdate:function({tournamentRecord:t}){if(!t)return{error:pt};const e=[],{extension:i}=Ze({tournamentRecord:t,name:"scheduleTiming"});i&&e.push({method:"addTournamentExtension",params:{extension:i}});const n=t.events||[];for(const r of n){const{eventId:t}=r,{extension:i}=Qe({event:r,name:"scheduleTiming"});i&&e.push({method:"addEventExtension",params:{eventId:t,extension:i}})}return{methods:e}},getMatchUpDailyLimits:iu,setMatchUpDailyLimits:Nu,getMatchUpDailyLimitsUpdate:function({tournamentRecord:t}){if(!t)return{error:pt};const e=[],{extension:i}=Ze({tournamentRecord:t,name:"scheduleLimits"});i&&e.push({method:"addTournamentExtension",params:{extension:i}});const n=t.events||[];for(const r of n){const{eventId:t}=r,{extension:i}=Qe({event:r,name:"scheduleLimits"});i&&e.push({method:"addEventExtension",params:{eventId:t,extension:i}})}return{methods:e}},validateSchedulingProfile:Uo,setSchedulingProfile:function({tournamentRecord:t,schedulingProfile:e}){return t?Array.isArray(e)?Vs({tournamentRecord:t,schedulingProfile:e}):{error:gt}:{error:pt}},getSchedulingProfile:Gs,removeMatchUpCourtAssignment:function({drawDefinition:t,matchUpId:e,courtDayDate:i}){return lu({drawDefinition:t,matchUpId:e,courtDayDate:i})},clearScheduledMatchUps:tu,bulkScheduleMatchUps:po,bulkRescheduleMatchUps:Su};function yp({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:pt};const{appliedPolicies:n}=qe({tournamentRecord:t}),r=null==n?void 0:n.draws;return((null==r?void 0:r.allowedDrawTypes)||[]).filter((({categoryNames:t,categoryTypes:n})=>!e&&!n||e&&(null==t?void 0:t.includes(e))||i&&(null==n?void 0:n.includes(i))))}function Up({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:ht};const{entries:o,stageEntries:s}=Qd({drawDefinition:e,drawId:n,stage:a,event:r}),c=s.length,{drawSize:u}=kd({participantCount:c}),{seedsCount:d,error:l}=_d({drawSize:i||u,policyDefinitions:t,participantCount:c});return l?{error:l}:{entries:o,seedsCount:d,stageEntries:s}}const wp={attachPolicies:Tu,attachEventPolicies:Mu,removeEventPolicy:function({event:t,policyType:e}){if(!e)return{error:It};if(!t)return{error:ht};let i;if(t.extensions){const{appliedPolicies:n}=We({event:t});n&&n[e]&&(delete n[e],i=!0,Object.keys(n).length?Hr({event:t,extension:{name:"appliedPolicies",value:n}}):Wr({event:t,name:"appliedPolicies"}))}return i?ut:{error:"Policy not found"}},findPolicy:Ke,getSeedsCount:_d,getEntriesAndSeedsCount:Up,getAllowedDrawTypes:yp,getAllowedMatchUpFormats:function({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:pt};const{appliedPolicies:n}=qe({tournamentRecord:t}),r=null==n?void 0:n.scoring;return((null==r?void 0:r.matchUpFormats)||[]).filter((({categoryNames:t,categoryTypes:n})=>!e&&!n||e&&(null==t?void 0:t.includes(e))||i&&(null==n?void 0:n.includes(i))))},getEventAppliedPolicies:We};function Sp({event:t,participants:e,ignoreGender:i}){if(!e)return{error:"Missing participants"};if(!Array.isArray(e))return{error:gt};if(!t)return{error:ht};const{eventType:n,gender:r}=t,a=n===ei?Ri:n===ii?Oi:ni,o=Object.assign({},...(t.entries||[]).map((t=>({[t.participantId]:t.entryStatus})))),s=Object.keys(o),c=e.filter((t=>s.includes(t.participantId))).filter((t=>{const e=o[t.participantId],s=n===ii&&t.participantType===Ri&&(zd(e)||e===ia),c=t.participantType!==a&&!s,u=!i&&n===Ri&&[sp,cp].includes(r)&&t.sex!==r;return c||u}));return c.length?{error:"Invalid entries",invalidParticipantIds:c.map((t=>t.participantId))}:ut}function Np({element:t,participantId:e,stage:i,stageSequence:n}){const r=(t.entries||[]).filter((t=>t.entryStatus===Yr)),a=(t.entries||[]).find((t=>t.participantId===e))||r.reduce(((t,e)=>{const{entryPosition:i}=e;return isNaN(i)?t:!t||i<t.entryPosition?e:t}),void 0);if(!a)return{error:"Participant Entry Not Found"};if(a.entryStatus!==Yr)return{error:"Invalid entry status"};if(a.stage&&a.entryStage!==i)return{error:"Participant not entered in stage"};if(n&&a.stageSequence!==n)return{error:"Participant not found in stageSequence"};a.entryStatus=Qr;const o=null==a?void 0:a.entryPosition;isNaN(o)||t.entries.forEach((t=>{t.entryStatus===Yr&&t.entryPosition>o&&(t.entryPosition=t.entryPosition-1)}));let s=Math.max(...t.entries.filter((t=>t.entryStatus===Qr&&!isNaN(t.entryPosition))).map((({entryPosition:t})=>parseInt(t||0))),0);return a.entryPosition=s||0,ut}const Pp={STANDARD:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},COLLEGE_D3:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_D3",valueGoal:5},COLLEGE_DEFAULT:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:"SET1-S:6/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_DEFAULT",valueGoal:4},COLLEGE_JUCO:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_JUCO",valueGoal:5},LAVER_CUP:Dn,DOMINANT_DUO:Pn,TEAM_DOUBLES_3_AGGREGATION:Tn},Dp=({namedFormat:t,uuids:e=[]}={})=>{var i,n;Object.keys(Pp).includes(t)||(t="STANDARD"),Array.isArray(e)||(e=[]);const r=Pp[t];if(!r.hydrate)return r.collectionDefinitions.forEach((t=>t.collectionId=ve())),r;const a={winCriteria:{valueGoal:r.valueGoal},collectionDefinitions:[{collectionId:(null===(i=e)||void 0===i?void 0:i.pop())||ve(),collectionName:"Doubles",matchUpType:ii,matchUpFormat:"SET3-S:6/TB7-F:TB10",...r.doubles},{collectionId:(null===(n=e)||void 0===n?void 0:n.pop())||ve(),collectionName:"Singles",matchUpType:ei,matchUpFormat:"SET3-S:6/TB7",...r.singles}]};return r.tieFormatName&&(a.tieFormatName=r.tieFormatName),a};function Tp({tournamentRecord:t,event:e}){if(!t)return{error:pt};t.events||(t.events=[]);const{startDate:i,endDate:n}=t,r=Object.assign({},{startDate:i,endDate:n,eventType:Ii},e);e.eventType===gi&&e.tieFormatName&&Mn[e.tieFormatName]&&(r.tieFormat=Dp({namedFormat:e.tieFormatName})),r.eventId||(r.eventId=ve());return t.events.reduce(((t,e)=>t||e.eventId===r.eventId),void 0)?{error:"Event exists"}:(t.events.push(r),{...ut,event:r})}function Mp({applyPositioning:t=!0,candidatesCount:e=1,tournamentRecord:i,drawDefinition:n,structureId:r,seedsOnly:a,event:o}){if(!o)return{error:"Event not found"};if(!n)return{error:"drawDefinition not found"};if(!vs({drawDefinition:n,structureId:r}))return{error:"Incomplete source structure"};const{playoffStructures:s}=Is({drawDefinition:n,structureId:r}),c=[],u=null==i?void 0:i.participants;if(s)for(const d of s){const{structureId:i}=d,r=ed({structureId:i,applyPositioning:t,candidatesCount:e,drawDefinition:n,participants:u,seedsOnly:a});if(r.error)return r;c.push({positionAssignments:r.positionAssignments,structureId:i})}return{...ut,structurePositionAssignments:c}}function Ap({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var o;if(!a||!t||!Array.isArray(r))return{error:gt,modifiedLineUp:(null==i?void 0:i.lineUp)||[]};const s=(null==i?void 0:i.lineUp)||(null===(o=Pr({participantId:e,drawDefinition:n}))||void 0===o?void 0:o.lineUp);return{modifiedLineUp:(null==s?void 0:s.map((e=>{var i;if(!r.includes(e.participantId))return e;const n=null===(i=e.collectionAssignments)||void 0===i?void 0:i.filter((e=>!(e.collectionId===a&&e.collectionPosition===t)));return{participantId:e.participantId,collectionAssignments:n}})).filter(Boolean))||[]}}function Ep({lineUp:t,tieFormat:e}){var i;let n=[];if(!Array.isArray(t))return n.push("lineUp must be an array of objects"),{valid:!1,errors:n,error:gt};const r=(null==e||null===(i=e.collectionDefinitions)||void 0===i?void 0:i.map((({collectionId:t})=>t)))||[],a=t.every((t=>{if("object"!=typeof t)return n.push("lineUp entries must be objects"),!1;const{participantId:e,collectionAssignments:i}=t;return e?"string"!=typeof e?(n.push("participantIds must be strings"),!1):Array.isArray(i)?i.every((t=>{if("object"!=typeof t)return n.push("collectionAssignments must be objects"),!1;const{collectionPosition:e,collectionId:i}=t;return"number"!=typeof e?(n.push("collectionPosition must be a number"),!1):!!r.includes(i)||(n.push("Invalid collectionId"),!1)})):(n.push("collectionAssignments must be an array"),!1):(n.push("Missing participantId"),!1)})),o=J(t.map(Ar)).length===t.length;return o||n.push("Duplicated participantId(s)"),{valid:a&&o,errors:n,error:n.length?gt:void 0}}function bp({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if("object"!=typeof t)return{error:mt};if("string"!=typeof e)return{error:"Missing participantId"};const r=Ep({lineUp:n,tieFormat:i});if(!r.valid)return r;const{extension:a}=Je({element:t,name:"lineUps"}),o=(null==a?void 0:a.value)||{},s=n.map(Ar);return Object.keys(o).filter((t=>t!==e)).find((t=>{const i=o[t],r=at(i.map(Ar),s);return r.length&&console.log({overlap:r,submittedParticipantId:e,submittedLineUp:n,storedParticipantId:t,storedLineUp:i}),r.length}))?{error:"lineUp conflict"}:(o[e]=n,jr({element:t,extension:{name:"lineUps",value:o}}),wr({drawDefinition:t}),{...ut})}function Rp({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){if(!t)return{error:pt};if(!e)return{error:"Missing drawId"};if(!n)return{error:"Event not found"};const r=Or({drawDefinition:e}),{matchUp:a,structure:o}=Ra({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:r,event:n});if(!a)return{error:"matchUp not found"};const{collectionPosition:s,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:l}=a;if(![ei,ii].includes(l))return{error:"Invalid matchUp"};const{positionAssignments:p}=Na({structure:o}),m=null==p?void 0:p.filter((t=>null==c?void 0:c.includes(t.drawPosition))),f=Mr(m),{tournamentParticipants:h}=wc({tournamentRecord:t,participantFilters:{participantTypes:[Ci],participantIds:f}}),{matchUp:I}=Ra({matchUpId:d,drawDefinition:e,matchUpsMap:r});return{relevantAssignments:m,collectionPosition:s,teamParticipants:h,collectionId:u,matchUpType:l,dualMatchUp:I,tieMatchUp:a,tieFormat:I.tieFormat||o.tieFormat||e.tieFormat||n.tieFormat||void 0,structure:o,...ut}}function Cp({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:o}){var s,c;const u=null===(s=Pr({participantId:e,drawDefinition:i}))||void 0===s?void 0:s.lineUp,d=null===(c=n||u)||void 0===c?void 0:c.find((t=>(null==t?void 0:t.participantId)===r)),l={collectionId:a,collectionPosition:t};if(d)d.collectionAssignments.push(l);else{const t={collectionAssignments:[l],participantId:r};n.push(t)}e&&bp({participantId:e,lineUp:n,drawDefinition:i,tieFormat:o})}function Op({drawDefinition:t,participantIds:e}){if("object"!=typeof t)return{error:mt};if(!Array.isArray(e))return{error:"Invalid participantIds"};const{extension:i}=Je({element:t,name:"lineUps"}),n=(null==i?void 0:i.value)||{},r=Object.keys(n).find((t=>n[t].map(Ar).some((t=>e.includes(t)))));return{lineUp:n[r],teamParticipantId:r}}function Lp({tournamentRecord:t,drawIds:e=[],auditData:i,eventId:n}){var r;if(!t)return{error:pt};const a=Array.isArray(e)&&e[0],{event:o,error:s}=ui({tournamentRecord:t,eventId:n,drawId:a});if(s)return{error:s};const c=[],u=[],d=[];if(!o.drawDefinitions)return{error:"drawDefinition not found"};const l=o.drawDefinitions.map((({drawId:t})=>t));e.length||(e=l);if(!(e.length&&e.every((t=>l.includes(t)))))return{error:"drawDefinition not found"};o.drawDefinitions=o.drawDefinitions.filter((t=>{if(e.includes(t.drawId)){const e={action:"deleteDrawDefinitions",payload:{drawDefinitions:[t],eventId:o.eventId,auditData:i}};c.push(e);const{drawId:n,drawType:r,drawName:a}=t;d.push({auditData:i,drawId:n,drawType:r,drawName:a,eventId:o.eventId});const{matchUps:s}=ao({event:o,drawDefinition:t});s.forEach((({matchUpId:t})=>u.push(t)))}return!e.includes(t.drawId)})),Vs({tournamentRecord:t});const{timeItem:p}=lr({element:o,itemType:"PUBLISH.STATUS"}),m=null==p||null===(r=p.itemValue)||void 0===r?void 0:r.PUBLIC;for(const I of e){var f;if(null==m||null===(f=m.drawIds)||void 0===f?void 0:f.includes(I)){var h;const t=(null===(h=m.drawIds)||void 0===h?void 0:h.filter((t=>t!==I)))||[],e=Ir({event:o,timeItem:{itemType:"PUBLISH.STATUS",itemValue:{PUBLIC:{drawIds:t}}}});if(e.error)return{error:e.error}}}if(c.length){At({topic:"audit",payload:c});const t=Ir({event:o,timeItem:{itemType:"deleteDrawDefinitions",itemValue:d}});if(t.error)return t}return u.length&&yr({matchUpIds:u}),function({drawId:t}){At({topic:"deletedDrawIds",payload:{drawId:t}})}({drawId:a}),ut}function xp({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,entries:r,event:a,stage:o}){return e?{scaledEntries:(r=r||(null==a?void 0:a.entries)||[]).filter((t=>(!o||!t.entryStage||t.entryStage===o)&&sa.includes(t.entryStatus))).map((t=>{const{participantId:n}=t,{scaleItem:r}=Jl({tournamentRecord:e,scaleAttributes:i,participantId:n});return{...t,...r}})).filter((t=>{const e=t.scaleValue;return!!(n||!isNaN(e)&&parseFloat(e))&&e})).sort(n||function(e,i){return t?s(i)-s(e):s(e)-s(i)})}:{error:pt};function s(e){return parseFloat(e.scaleValue||(t?-1:1e5))}}function Fp(t){const{drawType:e=jn,enforcePolicyLimits:i=!0,finishingPositionNaming:n,ignoreAllowedDrawTypes:r,seedAssignmentProfile:a,playoffMatchUpFormat:o,seedByRanking:s=!0,qualifyingProfiles:c,seededParticipants:u,policyDefinitions:d,seedingScaleName:l,assignSeedsCount:p,automated:m=!0,seedingProfile:f,tieFormatName:h,drawEntries:I,feedPolicy:v,idPrefix:g,drawId:y,isMock:U,uuids:w}=t,{tournamentRecord:S,event:N}=t;let{drawName:P,matchUpType:D,structureOptions:T}=t;const{tournamentParticipants:M}=wc({tournamentRecord:S,inContext:!0}),A=N&&M&&Sp({event:N,participants:M});if(null!=A&&A.error)return A;const E=!r&&S&&yp({tournamentRecord:S,categoryType:null==N?void 0:N.categoryType,categoryName:null==N?void 0:N.categoryName});if(null!=E&&E.length&&!E.includes(e))return{error:"Invalid drawType"};let{seedsCount:b,drawSize:R=32,tieFormat:C,matchUpFormat:O}=t;"number"!=typeof R&&(R=parseInt(R)),"number"!=typeof b&&(b=parseInt(b||0));const L=null==N?void 0:N.eventType;D=D||L,D===ni&&L===ni?(C=C||null!=N&&N.tieFormat||h?"object"==typeof C?C:h?Dp({namedFormat:h}):"object"==typeof(null==N?void 0:N.tieFormat)&&N.tieFormat:Dp(),O=void 0):O||(C=void 0,O="SET3-S:6/TB7");const x=I||(null==N?void 0:N.entries)||[],F=x.filter((t=>(!t.entryStage||t.entryStage===An)&&sa.includes(t.entryStatus)));[Kn].includes(e)&&(R=F.length||R);const k=kl({drawType:e,drawId:y});if((O||C)&&!(O&&(null==N?void 0:N.matchUpFormat)===O||(null==N?void 0:N.tieFormat)&&C&&JSON.stringify(N.tieFormat)===JSON.stringify(C))){let t=ks({drawDefinition:k,matchUpFormat:O,tieFormat:C,event:N});if(t.error)return{error:t.error,message:"matchUpFormat or tieFormat error"};D&&(k.matchUpType=D),C&&(k.tieFormat=C),t.tieFormat&&(C=t.tieFormat)}C=C||(null==N?void 0:N.tieFormat);let _=Ld({finishingPositionNaming:n,goesTo:t.goesTo,playoffMatchUpFormat:o,qualifyingProfiles:c,structureOptions:T,drawDefinition:k,seedingProfile:f,matchUpFormat:O,matchUpType:D,feedPolicy:v,tieFormat:C,drawSize:R,drawType:e,idPrefix:g,isMock:U,uuids:w});if(_.error)return _;const{matchUpsMap:j,inContextDrawMatchUps:B}=_,{structures:G}=kr({drawDefinition:k,stageSequence:1,stage:An}),[V]=G,{structureId:H}=V||{};if("object"==typeof d)for(const Z of Object.keys(d))Nl({policyDefinitions:{[Z]:d[Z]},drawDefinition:k});const{policyDefinitions:q}=$o({policyTypes:["seeding"],tournamentRecord:S,drawDefinition:k,event:N})||{};null!=d&&d.seeding||null!=q&&q.seeding||Nl({drawDefinition:k,policyDefinitions:er});const{policyDefinitions:W}=$o({policyTypes:["avoidance"],tournamentRecord:S,drawDefinition:k,event:N})||{};null!=d&&d.avoidance||null==W||!W.avoidance||Nl({drawDefinition:k,policyDefinitions:W});for(const Z of x){const t=el({...Z,entryStage:Z.entryStage||An,drawDefinition:k});if(I&&t.error)return t}const z=x.map(Ar);u&&(b=u.length),b>R&&(b=R),b>F.length&&(b=F.length);const{seedLimit:K}=jd({participantCount:F.length,enforcePolicyLimits:i,tournamentRecord:S,drawDefinition:k,structureId:H,seedsCount:b,event:N});if(K&&K<b&&(b=K),e===Gn&&(b=0),u)u.filter((({participantId:t})=>z.includes(t))).filter((t=>!t.seedNumber||t.seedNumber<=u.length)).sort(((t,e)=>t.seedNumber<e.seedNumber?-1:t.seedNumber<e.seedNumber?1:0)).forEach((t=>{const{participantId:e,seedNumber:i,seedValue:n}=t;Cl({drawDefinition:k,participantId:e,structureId:H,seedNumber:i,seedValue:n})}));else if(null!=N&&N.category||l){var Y,$;const{categoryName:t,ageCategoryCode:e}=(null==N?void 0:N.category)||{},i={scaleType:"SEEDING",scaleName:l||t||e,eventType:L};let{scaledEntries:n}=xp({scaleAttributes:i,tournamentRecord:S,stage:An,entries:x});if((null===(Y=n)||void 0===Y||!Y.length)&&s){const i={scaleType:Ic,scaleName:t||e,eventType:L};({scaledEntries:n}=xp({scaleAttributes:i,tournamentRecord:S,stage:An,entries:x}))}const r=(null===($=n)||void 0===$?void 0:$.length)||0;r<b&&(b=r),n&&n.filter((({participantId:t})=>z.includes(t))).slice(0,p||b).forEach(((t,e)=>{const i=e+1,n=(null==a?void 0:a[i])||i,{participantId:r}=t;Cl({drawDefinition:k,participantId:r,structureId:H,seedNumber:i,seedValue:n})}))}let J=[];if(!1!==m){const t="object"==typeof m&&m.seedsOnly;({conflicts:J}=ed({inContextDrawMatchUps:B,drawDefinition:k,participants:M,structureId:H,matchUpsMap:j,seedsOnly:t,drawType:e,event:N}))}return P=P||e,k&&Object.assign(k,{drawName:P}),At({topic:"audit",payload:{action:"generateDrawDefinition",payload:{drawId:k.drawId,category:null==N?void 0:N.category,eventId:null==N?void 0:N.eventId,seedingScaleName:l,matchUpType:D,seedsCount:b,automated:m,tieFormat:C,drawSize:R,drawType:e,drawName:P}}}),{...ut,structureId:H,drawDefinition:k,conflicts:J}}function kp({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,event:r}){return t?i?void 0===n||Number.isSafeInteger(n)?(((null==r?void 0:r.entries)||[]).forEach((t=>{t.participantId===i&&(t.entryPosition=n)})),((null==e?void 0:e.entries)||[]).forEach((t=>{t.participantId===i&&(t.entryPosition=n)})),ut):{error:gt,entryPosition:n}:{error:"Missing participantId"}:{error:pt}}function _p({playoffStructureNameBase:t,playoffAttributes:e,playoffPositions:i,exitProfileLimit:n,tournamentRecord:r,drawDefinition:a,roundProfiles:o,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l}){if(!r)return{error:pt};const p=Md({playoffStructureNameBase:t,playoffAttributes:e,playoffPositions:i,exitProfileLimit:n,drawDefinition:a,roundProfiles:o,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l});return p.error||hr({tournamentRecord:r,timeItem:{itemType:"addPlayoffStructures",itemValue:{playoffStructureNameBase:t,playoffPositions:i,roundNumbers:s,structureId:c}}}),p}function jp({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:It};const a=Object.assign({},...(e||[]).slice(0,n).map((({participantId:t},e)=>({[t]:e+1}))));r=r||t.scaleName;const o=(new Date).toISOString();return{scaleItemsWithParticipantIds:i.map((({participantId:e})=>({participantId:e,scaleItems:[{scaleValue:a[e],eventType:t.eventType,scaleType:"SEEDING",scaleName:r,scaleDate:o}]})))}}function Bp({tournamentRecord:t,drawDefinition:e,scaleAttributes:i,drawId:n,event:r,stage:a}){if(!r)return{error:ht};let o=r.entries;if(n){var s;const{flightProfile:t}=Qo({event:r}),i=null==t||null===(s=t.flights)||void 0===s?void 0:s.find((t=>t.drawId===n));o=i?i.drawEntries:null==e?void 0:e.entries}return function({tournamentRecord:t,participantIds:e,scaleAttributes:i}){var n;if(!t)return{error:pt};if(!e)return{error:"Missing participantIds"};if(!i)return{error:It,message:"scaleAttributes required"};const{scaleType:r,eventType:a,scaleName:o}=i,s=[xe,r,a,o].join(".");return null===(n=t.participants)||void 0===n||n.forEach((t=>{e.includes(t.participantId)&&t.timeItems&&(t.timeItems=t.timeItems.filter((t=>t&&(null==t?void 0:t.itemType)!==s)))})),ut}({tournamentRecord:t,participantIds:(o||[]).filter((t=>(!a||!t.entryStage||t.entryStage===a)&&sa.includes(t.entryStatus))).map(Ar),scaleAttributes:i})}function Gp({deleteExisting:t,event:e,flightProfile:i}){var n;if(!i)return{error:It};if(!e)return{error:ht};const{flightProfile:r}=Qo({event:e});return r&&Gp&&!t?{error:"Existing profile"}:null!==(n=e.drawDefinitions)&&void 0!==n&&n.length?{error:"Existing drawDefinition(s)"}:(Hr({event:e,extension:{name:"flightProfile",value:i}}),{flightProfile:me(i,!1,!0),...ut})}function Vp(t){var e;const i=null===(e=t.tournamentRecord)||void 0===e?void 0:e.participants;return Object.assign(t,{tournamentParticipants:i}),vl(t)}function Hp({qualifyingPositions:t,drawEntries:e=[],matchUpValue:i,drawName:n,drawId:r,event:a,stage:o}){var s,c;if(!a)return{error:ht};if(!n)return{error:It};if(null!=e&&e.length){const t=Mr(a.entries||[]),i=Mr(e);if(at(i,t).length!==i.length)return{error:gt}}const{flightProfile:u}=Qo({event:a}),d=(null==u||null===(s=u.flights)||void 0===s||null===(c=s.map((({flightNumber:t})=>!isNaN(t)&&parseInt(t))))||void 0===c?void 0:c.filter(Boolean))||[],l=Math.max(0,...d)+1,p={drawId:r||ve(),flightNumber:l,matchUpValue:i,drawEntries:e,drawName:n};o&&(p.stage=o),t&&(p.qualifyingPositions=t);return((null==u?void 0:u.flights)||[]).find((({drawId:t})=>t===p.drawId))?{error:"Existing flight"}:Hr({event:a,extension:{name:"flightProfile",value:{...u||{},flights:((null==u?void 0:u.flights)||[]).concat(p)}}})}function qp({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:pt};if(!e)return{error:ht};if(!Vt.test(i))return{error:vt};const{tournamentStartDate:n,tournamentEndDate:r,error:a}=zp(t);if(a)return{error:a};const o=new Date(ne(i));if(o<n||o>r)return{error:vt};const s=e.endDate&&new Date(ne(e.endDate));return s&&o>s&&(e.endDate=i),e.startDate=i,ut}function Wp({tournamentRecord:t,event:e,endDate:i}){if(!t)return{error:pt};if(!e)return{error:ht};if(!Vt.test(i))return{error:vt};const{tournamentStartDate:n,tournamentEndDate:r,error:a}=zp(t);if(a)return{error:a};const o=new Date(ne(i));if(o<n||o>r)return{error:vt};const s=e.startDate&&new Date(ne(e.startDate));return s&&o<s&&(e.startDate=i),e.endDate=i,ut}function zp(t){const{startDate:e,endDate:i}=t;return Vt.test(e)&&Vt.test(i)?{tournamentStartDate:new Date(ne(e)),tournamentEndDate:new Date(ne(i))}:{error:"Invalid tournament dates"}}const Kp={addEvent:Tp,deleteEvents:function({tournamentRecord:t,eventIds:e}){if(!t)return{error:pt};if(!t.events)return{error:"Event not found"};if(!Array.isArray(e))return{error:It};const i=[],n=[];return t.events=(t.events||[]).filter((t=>{if(e.includes(t.eventId)){const e={action:"deleteEvents",payload:{events:[t]}};i.push(e),n.push({eventName:t.eventName,eventType:t.eventType,category:t.category,eventId:t.eventId,gender:t.gender})}return!e.includes(t.eventId)})),Vs({tournamentRecord:t}),i.length&&(At({topic:"audit",payload:i}),hr({tournamentRecord:t,timeItem:{itemType:"deleteEvents",itemValue:n}})),ut},setEventDates:function({tournamentRecord:t,event:e,startDate:i,endDate:n}){if(!t)return{error:pt};if(!e)return{error:ht};if(!i&&!n)return{error:It};if(i&&!Vt.test(i))return{error:vt};if(n&&!Vt.test(n))return{error:vt};if(i&&n&&new Date(ne(i))>new Date(ne(n)))return{error:gt};if(i){const{error:n}=qp({tournamentRecord:t,event:e,startDate:i});if(n)return{error:n}}if(n){const{error:i}=Wp({tournamentRecord:t,event:e,endDate:n});if(i)return{error:i}}return ut},setEventStartDate:qp,setEventEndDate:Wp,autoSeeding:function({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:o,event:s,stage:c,sortDescending:u,scaleSortMethod:d}){const{error:l,entries:p,seedsCount:m,stageEntries:f}=Up({drawDefinition:e,drawId:o,event:s,policyDefinitions:i,drawSize:a,stage:c});if(l)return{error:l};const{scaledEntries:h}=xp({scaleAttributes:n,tournamentRecord:t,scaleSortMethod:d,sortDescending:u,entries:p,stage:c}),{scaleItemsWithParticipantIds:I}=jp({scaledEntries:h,seedsCount:m,scaleAttributes:n,scaleName:r,stageEntries:f});return{scaleItemsWithParticipantIds:I}},removeSeeding:function({tournamentRecord:t,drawDefinition:e,scaleName:i,drawId:n,event:r,stage:a}){var o,s;return t?r?(i=i||(null===(o=r.category)||void 0===o?void 0:o.categoryName)||(null===(s=r.category)||void 0===s?void 0:s.ageCategoryCode),Bp({tournamentRecord:t,scaleAttributes:{eventType:r.eventType,scaleType:"SEEDING",scaleName:i},drawDefinition:e,drawId:n,event:r,stage:a})):{error:ht}:{error:pt}},removeScaleValues:Bp,addDrawEntries:nl,checkValidEntries:Sp,modifyDrawName:dd,addDrawDefinition:tc,addPlayoffStructures:_p,deleteDrawDefinitions:Lp,getAvailablePlayoffRounds:function({drawDefinition:t,structureId:e}){return yd({drawDefinition:t,structureId:e})},removeStructure:xd,generateSeedingScaleItems:jp,setSubOrder:dl,addEventEntries:al,promoteAlternate:function({tournamentRecord:t,drawDefinition:e,event:i,participantId:n,stage:r=An,stageSequence:a}){if(!t)return{error:pt};if(!i)return{error:ht};if(i){const t=Np({element:i,participantId:n,stageSequence:a,stage:r});if(t.error)return t}if(e){const t=Np({element:e,participantId:n,stageSequence:a,stage:r});if(t.error)return t}return ut},destroyPairEntry:ol,setEntryPosition:kp,setEntryPositions:function({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:pt};if(!Array.isArray(e))return{error:gt};for(const r of e){const{participantId:e,entryPosition:a}=r,o=kp({tournamentRecord:t,drawDefinition:i,participantId:e,entryPosition:a,event:n});if(o.error)return o}return{...ut}},addEventEntryPairs:function({allowDuplicateParticipantIdPairs:t,entryStatus:e=Yr,participantIdPairs:i=[],entryStage:n=An,tournamentRecord:r,drawDefinition:a,event:o,uuids:s}){if(!r)return{error:pt};if(!o)return{error:ht};if(o.eventType!==ii)return{error:"Invalie eventType"};const c=r.participants||[],u=c.filter((t=>t.participantType===Ri)).map((t=>t.participantId)),d=u.filter((t=>!u.includes(t)));if(d.length)return{error:"Invalid participantIds",invalidParticipantIds:d};const l=i.filter((t=>2!==t.length));if(l.length)return{error:"Invalid participantIds",invalidParticipantIdPairs:l};const p=c.filter((t=>t.participantType===Oi)).map((t=>t.individualParticipantIds)),m=i.map((t=>({participantId:(null==s?void 0:s.pop())||ve(),participantType:Oi,participantRole:pu,individualParticipantIds:t}))),f=t?m:m.filter((t=>!p.find((e=>2===at(e,t.individualParticipantIds).length))));let h,I=[];if(f){const e=nc({allowDuplicateParticipantIdPairs:t,participants:f,returnParticipants:!0,tournamentRecord:r});if(e.error)return e;I=e.participants||[],h=e.message}const v=i.map((t=>{const e=I.find((e=>2===at(e.individualParticipantIds,t).length));if(e)return e;const{participant:i}=Nr({tournamentRecord:r,participantIds:t});return i})).map((t=>t.participantId)),g=al({event:o,entryStage:n,entryStatus:e,drawDefinition:a,tournamentRecord:r,participantIds:v});return f.length&&At({topic:"addParticipants",participants:f}),{...g,message:h,newParticipantIds:f.map(Ar)}},removeEventEntries:Xd,removeDrawEntries:function({participantIds:t,drawDefinition:e,drawId:i,event:n,autoEntryPositions:r=!0}){var a;if(!n)return{error:ht};if(!i)return{error:"Missing drawId"};if(!t||!t.length)return{error:"Missing participantIds"};const o=qd({drawDefinition:e});if(ot(t,o))return{error:"Existing participant drawPosition assignment"};const s=e=>{const i=e.participantId;return!t.includes(i)},{flightProfile:c}=Qo({event:n}),u=null==c||null===(a=c.flights)||void 0===a?void 0:a.find((t=>t.drawId===i));return null!=u&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),r&&(u.drawEntries=Wd({entries:u.drawEntries}))),null!=e&&e.entries&&(e.entries=e.entries.filter(s),r&&(e.entries=Wd({entries:e.entries}))),ut},modifyEventEntries:function({event:t,tournamentRecord:e,entryStage:i=An,participantIdPairs:n=[],unpairedParticipantIds:r=[],entryStatus:a=Qr}){if(!e)return{error:pt};if(!t)return{error:ht};const o=e.participants||[],s=o.filter((t=>t.participantType===Ri)).map((t=>t.participantId)),c=r.concat(...n).flat(1/0).filter((t=>!s.includes(t)));if(c.length)return{error:"Invalid participantIds",invalidParticipantIds:c};const u=n.filter((t=>2!==t.length));if(u.length)return{error:"Invalid participantIds",invalidParticipantIdPairs:u};const d=o.filter((t=>t.participantType===Oi)).map((t=>t.individualParticipantIds)),l=n.filter((t=>!d.find((e=>2===at(e,t).length)))).map((t=>({participantType:Oi,participantRole:pu,individualParticipantIds:t}))),p=nc({tournamentRecord:e,participants:l});if(p.error)return p;const m=n.map((t=>{const{participant:i}=Nr({tournamentRecord:e,participantIds:t});return i})).map((t=>({participantId:t,entryStatus:a,entryStage:i}))),f=r.map((t=>({entryStatus:ra,participantId:t,entryStage:i})));return t.entries=(t.entries||[]).filter((t=>t.entryStage===i)),t.entries=t.entries.concat(...m,...f),ut},modifyEntriesStatus:Kd,modifySeedAssignment:function({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n,seedValue:r}){return t?(t.participants||[]).find((t=>t.participantId===i))?Rl({drawDefinition:e,participantId:i,structureId:n,seedValue:r}):{error:"Invalid participantId"}:{error:pt}},deleteFlightProfileAndFlightDraws:function({tournamentRecord:t,event:e}){if(!t)return{error:pt};if(!e)return{error:ht};const{flightProfile:i}=Qo({event:e});if(i){var n;const r=null===(n=i.flights)||void 0===n?void 0:n.map((({drawId:t})=>t)).filter(Boolean),a=Lp({tournamentRecord:t,eventId:e.eventId,drawIds:r});return a.error?a:Wr({event:e,name:"flightProfile"})}return ut},deleteFlightAndFlightDraw:function({tournamentRecord:t,event:e,drawId:i,auditData:n}){if(!t)return{error:pt};if(!i)return{error:"Missing drawId"};if(!e)return{error:ht};const{flightProfile:r}=Qo({event:e});var a;if(r&&(null===(a=r.flights)||void 0===a?void 0:a.find((t=>t.drawId===i)))){const t=r.flights.filter((t=>t.drawId!==i));Hr({event:e,extension:{name:"flightProfile",value:{...r,flights:t}}})}return Lp({tournamentRecord:t,eventId:e.eventId,drawIds:[i],auditData:n}),ut},generateFlightProfile:function({drawNameRoot:t="Flight",attachFlightProfile:e,tournamentRecord:i,scaleAttributes:n,scaleSortMethod:r,deleteExisting:a,sortDescending:o,drawNames:s=[],flightsCount:c,flightValues:u,splitMethod:d,uuids:l=[],event:p,stage:m}){if(!p)return{error:ht};const f=p.entries||[],{flightProfile:h}=Qo({event:p});if(h&&e&&!a)return{error:"Existing profile"};const{scaledEntries:I}=xp({tournamentRecord:i,scaleAttributes:n,scaleSortMethod:r,sortDescending:o,event:p,stage:m}),v=I.map(Ar),g=f.filter((({participantId:t})=>!v.includes(t))).filter((t=>(!m||!t.entryStage||t.entryStage===m)&&sa.includes(t.entryStatus))),y=I.concat(...g),U=y.length;let w=st(y,Math.ceil(U/c));"splitWaterfall"===d?w=ct(y,c):"splitShuttle"===d&&(w=ct(y,c,!0));const S={scaleAttributes:n,splitMethod:d,flights:nt(0,c).map((e=>{var i;const n=e+1,r={flightNumber:n,drawId:(null==l?void 0:l.pop())||ve(),drawEntries:(a=w[e],(a||[]).map((({participantId:t})=>f.find((e=>e.participantId===t))))),drawName:(null==s?void 0:s.length)&&s[e]||`${t} ${n}`};var a;const o=null==u||null===(i=u.find((t=>t.flightNumber===n)))||void 0===i?void 0:i.matchUpValue;return o&&(r.matchUpValue=o),r}))};if(e){const t=Gp({flightProfile:S,deleteExisting:a,event:p});return{splitEntries:Pt()&&w||void 0,...t}}return{flightProfile:S,...ut}},attachFlightProfile:Gp,updateDrawIdsOrder:function({event:t,orderedDrawIdsMap:e}){var i,n;if("object"!=typeof t)return{error:ht};if(!e)return{error:It,message:"Missing drawIdsOrderMap"};if("object"!=typeof e)return{error:gt,message:"orderedDrawIdsMap must be an object"};const r=Object.values(e);if(!r.every((t=>!isNaN(t))))return{error:gt,message:"drawOrder must be numeric"};if(J(r).length!==r.length)return{error:gt,message:"drawOrder values must be unique"};if(null!==(i=t.drawDefinitions)&&void 0!==i&&i.length){const i=(t.drawDefinitions||[]).map((({drawId:t})=>t));if(at(i,Object.keys(e)).length!==i.length)return{error:gt,message:"Missing drawIds"};t.drawDefinitions.forEach((t=>{t.drawOrder=e[t.drawId]}))}const{flightProfile:a}=Qo({event:t});return null==a||null===(n=a.flights)||void 0===n||n.forEach((t=>{t.flightNumber=e[t.drawId]})),ut},getFlightProfile:Qo,getScaledEntries:xp,addFlight:Hp,generateAdHocMatchUps:function(t){return ud(t)},deleteAdHocMatchUps:function(t){return Ad(t)},drawMatic:Vp,setOrderOfFinish:function(t){return wl(t)},setDelegatedOutcome:function(t){return yl(t)},removeDelegatedOutcome:function(t){return pl(t)},addVoluntaryConsolationStage:function({drawDefinition:t,drawSize:e}){return md({drawDefinition:t,drawSize:e})},generateVoluntaryConsolationStructure:function(t){const{tournamentRecord:e}=t;return e?sd({participants:e.participants,...t}):{error:pt}},setMatchUpStatus:js,bulkMatchUpStatusUpdate:Bs,setDrawDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:i}){return t?e?i?ks({drawDefinition:e,matchUpFormat:i}):{error:"Missing matchUpFormat"}:{error:mt}:{error:pt}},setEventDefaultMatchUpFormat:function({tournamentRecord:t,event:e,matchUpFormat:i}){return t?i?e?h(i)?(e.matchUpFormat=i,ut):{error:"Unrecognized matchUpFormat"}:{error:ht}:{error:"Missing matchUpFormat"}:{error:pt}},setStructureDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,structureId:n,event:r}){return t?e?i?n?ks({drawDefinition:e,matchUpFormat:i,structureId:n,event:r}):{error:"Missing structureId"}:{error:"Missing matchUpFormat"}:{error:mt}:{error:pt}},setCollectionDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:i}){return t?e?i?h(i)?{error:"Not implemented"}:{error:"Unrecognized matchUpFormat"}:{error:"Missing matchUpFormat"}:{error:mt}:{error:pt}},assignDrawPosition:function({drawDefinition:t,drawPosition:e,structureId:i,participantId:n,qualifier:r,bye:a}){if(!t)return{error:mt};if(!e)return{error:"Missing drawPosition"};if(!i)return{error:"Missing structureId"};if(a){const n=os({drawDefinition:t,drawPosition:e,structureId:i});if(n.error)return n}else{if(r)return{error:"Not implemented"};{const r=As({drawDefinition:t,structureId:i,drawPosition:e,participantId:n});if(r.error)return r}}return{...ut}},assignSeedPositions:function(t){const{useExistingSeedLimit:e,tournamentRecord:i,drawDefinition:n,structureId:r,assignments:a,drawId:o}=t;let s=0;if(null==a||!a.length)return{error:"Missing assignments"};if(!i)return{error:pt};if(!o)return{error:"Missing drawId"};const{seedAssignments:c,seedLimit:u,error:d}=Ua({drawDefinition:n,structureId:r});if(d)return{error:d};const l=Object.assign({},...c.filter((t=>t.seedNumber)).map((t=>({[t.seedNumber]:t}))));a.forEach((t=>{const{seedNumber:i}=t;i<=u&&(!e||l[i])&&(l[i]=t)}));const p=Object.values(l),m=p.map((t=>null==t?void 0:t.participantId)).filter(Boolean);if(m.length!==tt(m).length)return{error:"participantId cannot be assigned to multiple seedNumbers"};for(const f of p){const t=Cl({...f,drawDefinition:n,structureId:r});if(null!=t&&t.error)return t;null!=t&&t.success&&s++}return s?{...ut,modifications:s}:{error:"No modifications applied"}},assignDrawPositionBye:function({drawDefinition:t,structureId:e,drawPosition:i}){return os({drawDefinition:t,structureId:e,drawPosition:i})},assignMatchUpSideParticipant:function({drawDefinition:t,participantId:e,sideNumber:i,matchUpId:n,event:r}){var a;if(e&&"string"!=typeof e)return{error:"Invalid participantId"};if(!t)return{error:mt};if(!i)return{error:"Missing sideNumber"};if(!n)return{error:"Missing matchUpId"};if(![1,2].includes(i))return{error:gt,sideNumber:i};const{matchUp:o,structure:s}=Ra({drawDefinition:t,matchUpId:n,event:r});return null!=s&&s.structures||t.drawType&&t.drawType!==kn||null!=s&&s.matchUps.find((({roundPosition:t})=>!!t))?{error:"Invalid drawType"}:!e&&(null!==(a=o.score)&&void 0!==a&&a.scoreStringSide1||x.includes(o.matchUpstatus)||o.matchUpStatus===N)?{error:"Cannot remove participants",message:"matchUp has completed status or score"}:(o.sides=[1,2].map((t=>{var n;const r=(null===(n=o.sides)||void 0===n?void 0:n.find((e=>e.sideNumber===t)))||{sideNumber:t};return i===t?{...r,participantId:e}:r})),gr({drawDefinition:t,matchUps:[o]}),{...ut})},swapDrawPositionAssignments:function(t){return cl(t)},removeDrawPositionAssignment:sl,alternateDrawPositionAssignment:function(t){return Vd(t)},withdrawParticipantAtDrawPosition:function(t){return Object.assign(t,{entryStatus:ia}),sl(t)},setDrawParticipantRepresentativeIds:function({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:"drawDefinition not found"};if(!Array.isArray(t))return{error:gt};const i=Mr((null==e?void 0:e.entries)||[]);return t.length&&at(t,i).length<t.length?{error:gt}:Vr({drawDefinition:e,extension:{name:"participantRepresentatives",value:t}})},getDrawParticipantRepresentativeIds:function({drawDefinition:t}){const{extension:e,error:i}=Xe({drawDefinition:t,name:"participantRepresentatives"});return i?{error:i}:{representativeParticipantIds:(null==e?void 0:e.value)||[]}},luckyLoserDrawPositionAssignment:function(t){return function({luckyLoserParticipantId:t,drawDefinition:e,drawPosition:i,structureId:n}){return Gd({participantId:t,drawDefinition:e,drawPosition:i,structureId:n,positionActionName:"luckyLoserDrawPositionAssignment"})}(t)},setPositionAssignments:function(t){return Hd(t)},automatedPositioning:function({applyPositioning:t=!0,tournamentRecord:e,drawDefinition:i,structureId:n,seedsOnly:r,event:a}){return a?i?ed({applyPositioning:t,drawDefinition:i,participants:null==e?void 0:e.participants,structureId:n,seedsOnly:r}):{error:"drawDefinition not found"}:{error:"Event not found"}},automatedPlayoffPositioning:Mp,checkInParticipant:function({tournamentRecord:t,participantId:e,matchUpId:i,matchUp:n,drawId:r}){n&&!r&&({drawId:r}=n),n&&!i&&({matchUpId:i}=n);const{event:a,drawDefinition:o}=ui({tournamentRecord:t,drawId:r});if(!a)return{error:"Event not found"};{const n=cu({tournamentParticipants:t.participants,drawDefinition:o,participantId:e,matchUpId:i});if(n.error&&"Participant already checked in"!==n.error)return n}return ut},checkOutParticipant:function({tournamentRecord:t,drawId:e,matchUpId:i,participantId:n,matchUp:r}){r&&!e&&({drawId:e}=r),r&&!i&&({matchUpId:i}=r);const{event:a,drawDefinition:o}=ui({tournamentRecord:t,drawId:e});if(!a)return{error:"Event not found"};{const e=uu({drawDefinition:o,tournamentParticipants:t.participants,matchUpId:i,participantId:n});if(e.error)return e}return ut},toggleParticipantCheckInState:du,generateDrawDefinition:Fp,addDrawDefinitionTimeItem:function({drawDefinition:t,timeItem:e}){if(!t)return{error:"drawDefinition not found"};if(!e)return{error:"Missing timeItem"};const i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter((t=>i.includes(t))).length!==n.length)return{error:"Invalid timeItem"};t.timeItems||(t.timeItems=[]);const r=(new Date).toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),wr({drawDefinition:t}),ut},assignTieMatchUpParticipantId:function(t){var e,i;const n=Rp(t);if(n.error)return n;let r=t.teamParticipantId;const{tournamentRecord:a,drawDefinition:o,participantId:s}=t;if(!s)return{error:"Missing participantId"};const{relevantAssignments:c,collectionPosition:u,teamParticipants:d,collectionId:l,matchUpType:p,dualMatchUp:m,tieMatchUp:f,tieFormat:h}=n,{tournamentParticipants:[I]}=wc({tournamentRecord:a,participantFilters:{participantIds:[s]}});if(!I)return{error:"Participant Not Found"};const{individualParticipantIds:v,participantType:g}=I;if(p===ei&&g!==Ri)return{error:"Invalid participantType"};const y=g===Ri?[s]:v,U=r?d.find((({participantId:t})=>t===r)):d.find((({individualParticipantIds:t})=>ot(y,t)));if(!U)return{error:"Team not found"};r||(r=U.participantId);const w=c.find((t=>t.participantId===(null==U?void 0:U.participantId))),S=null==w?void 0:w.drawPosition,N=f.sides.find((({drawPosition:t})=>t===S)),P=null==N?void 0:N.sideNumber;if(!h)return{error:"Missing tieFormat"};if(!(null===(e=h.collectionDefinitions)||void 0===e?void 0:e.find((t=>t.collectionId===l))))return{error:"Missing collectionDefinition"};if(null===(i=m.sides)||void 0===i||!i.length){const t=({displaySideNumber:t,drawPosition:e,sideNumber:i})=>({drawPosition:e,sideNumber:i,displaySideNumber:t});m.sides=[{...t(f.sides[0]),lineUp:[]},{...t(f.sides[1]),lineUp:[]}]}const D=m.sides.find((t=>t.sideNumber===P)),T=f.sides.find((t=>t.sideNumber===P));let M;if(p===ii&&g!==Oi){const t=function({side:t}){let e;if(t.participant){const i=t.participant.individualParticipantIds||[];if(1===i.filter(Boolean).length){const{participant:t}=Nr({participantIds:i,tournamentRecord:a});i.push(s);const{participant:n}=Nr({participantIds:i,tournamentRecord:a});if(n)e=t.participantId;else{t.individualParticipantIds=i;const e=dp({individualParticipantIds:i,pairOverride:!0,tournamentRecord:a,participant:t});if(e.error)return e}}else console.log("###")}else{const t=ic({participant:{participantType:Oi,participantRole:pu,individualParticipantIds:[s]},pairOverride:!0,tournamentRecord:a});if(t.error)return t}return{...ut,deleteParticipantId:e}}({side:T});if(t.error)return t;M=t.deleteParticipantId}else if(p===ii&&g===Oi){const t=I.individualParticipantIds||[],{modifiedLineUp:e}=Ap({collectionPosition:u,teamParticipantId:r,dualMatchUpSide:D,drawDefinition:o,participantIds:t,collectionId:l});for(const i of t)Cp({collectionPosition:u,teamParticipantId:r,drawDefinition:o,modifiedLineUp:e,participantId:i,collectionId:l,tieFormat:h});return D.lineUp=e,Ur({drawDefinition:o,matchUp:m}),{...ut,modifiedLineUp:e}}const{modifiedLineUp:A}=Ap({participantIds:[s],collectionPosition:u,teamParticipantId:r,dualMatchUpSide:D,drawDefinition:o,collectionId:l});if(Cp({collectionPosition:u,teamParticipantId:r,drawDefinition:o,modifiedLineUp:A,participantId:s,collectionId:l,tieFormat:h}),D.lineUp=A,Ur({drawDefinition:o,matchUp:m}),M){const t=Zd({participantIds:[M],teamDrawIds:[o.drawId],tournamentRecord:a});t.error&&console.log("cleanup",{result:t})}return{...ut,modifiedLineUp:A}},removeTieMatchUpParticipantId:function(t){var e,i,n,r;const{tournamentRecord:a,drawDefinition:o,participantId:s}=t;if(!s)return{error:"Missing participantId"};const c=Rp(t);if(c.error)return c;const{relevantAssignments:u,collectionPosition:d,teamParticipants:l,collectionId:p,matchUpType:m,dualMatchUp:f,tieMatchUp:h,tieFormat:I}=c;if(Cs({score:h.score})||h.winningSide)return{error:"Existing outcome"};const v=null===(e=h.sides)||void 0===e?void 0:e.find((t=>{var e,i,n;return(null===(e=t.participant)||void 0===e?void 0:e.participantId)===s||(null===(i=t.participant)||void 0===i||null===(n=i.individualParticipantIds)||void 0===n?void 0:n.includes(s))}));if(!v)return{error:"Participant Not Found"};const{tournamentParticipants:[g]}=wc({tournamentRecord:a,participantFilters:{participantIds:[s]}});if(!g)return{error:"Participant Not Found"};if(m===ei&&g.participantType===Oi)return{error:"Invalid participant"};const y=g.participantType===Ri?[s]:g.individualParticipantIds;f.sides||(f.sides=[{sideNumber:1},{sideNumber:2}]);let U=null===(i=f.sides)||void 0===i?void 0:i.find((({sideNumber:t})=>t===v.sideNumber));const w=Op({drawDefinition:o,participantIds:y}),S=(null==w?void 0:w.teamParticipantId)||(null==l||null===(n=l.find((t=>at((null==t?void 0:t.individualParticipantIds)||[],y).length===y.length)))||void 0===n?void 0:n.participantId);if(!S)return{error:"Participant Not Found"};if(!U&&((null===(r=f.sides)||void 0===r?void 0:r.filter((({lineUp:t})=>!t)).length)||0)<2){var N;const t=l.map((({participantId:t})=>{var e;return{drawPosition:null===(e=u.find((e=>e.participantId===t)))||void 0===e?void 0:e.drawPosition,teamParticipantId:t}}));console.log({drawPositionMap:t}),U=null===(N=f.sides)||void 0===N?void 0:N.find((e=>{var i;return(null===(i=t.find((({drawPosition:t})=>t===e.drawPosition)))||void 0===i?void 0:i.teamParticipantId)===S}))}if(!U)return{error:yt,participantId:s};const{modifiedLineUp:P}=Ap({collectionPosition:d,teamParticipantId:S,dualMatchUpSide:U,participantIds:y,drawDefinition:o,collectionId:p});if(U.lineUp=P,S&&bp({participantId:S,lineUp:P,drawDefinition:o,tieFormat:I}),m===ii&&g.participantType===Ri){var D;const t=null===(D=h.sides)||void 0===D?void 0:D.find((t=>t.sideNumber===U.sideNumber)),{participantId:e}=t||{},{tournamentParticipants:[i]}=wc({tournamentRecord:a,participantFilters:{participantIds:[e]},withEvents:!0});if(!i)return{error:"Participant Not Found"};{const t=null==i?void 0:i.individualParticipantIds.filter((t=>t!==s));if(i.draws.length){if(1===t.length){const{participant:e}=Nr({participantIds:t,tournamentRecord:a});if(!e){const e=ic({participant:{participantRole:pu,individualParticipantIds:t,participantType:Oi},pairOverride:!0,tournamentRecord:a});if(e.error)return e}}}else if(t.length){i.individualParticipantIds=t;const e=dp({participant:i,pairOverride:!0,tournamentRecord:a});if(e.error)return e}else{const t=Zd({participantIds:[e],tournamentRecord:a});t.error&&console.log("cleanup",{result:t})}}}return Ur({drawDefinition:o,matchUp:f}),{...ut,modifiedLineUp:P}},replaceTieMatchUpParticipantId:function(t){var e;const i=Rp(t);if(i.error)return i;const{existingParticipantId:n,tournamentRecord:r,newParticipantId:a,drawDefinition:o}=t;if(!n||!a)return{error:"Missing participantId"};const{collectionPosition:s,teamParticipants:c,collectionId:u,dualMatchUp:d,tieMatchUp:l,tieFormat:p}=i,{matchUpType:m}=l,f=l.sides.find((t=>{var e,i,r;return(null===(e=t.participant)||void 0===e?void 0:e.participantId)===n||(null===(i=t.participant)||void 0===i||null===(r=i.individualParticipantIds)||void 0===r?void 0:r.includes(n))}));if(!f)return{error:"Participant Not Found"};const{tournamentParticipants:h}=wc({tournamentRecord:r,participantFilters:{participantIds:[n,a]}});if(2!==h.length)return{error:"Missing participantId"};if(h[0].participantType!==h[1].participantType)return{error:"Invalid participantType"};const I=d.sides.find((({sideNumber:t})=>t===f.sideNumber));if(!I)return{error:yt,existingParticipantId:n};const v=h.find((({participantId:t})=>t===n)),g=(null==v?void 0:v.individualParticipantIds)||[v.participantId],y=Op({drawDefinition:o,participantIds:g}),U=(null==y?void 0:y.teamParticipantId)||(null===(e=c.find((t=>at((null==t?void 0:t.individualParticipantIds)||[],g).length===g.length)))||void 0===e?void 0:e.participantId),w=I.lineUp||y,S=w.find((({participantId:t})=>a===t)),N=(null==w?void 0:w.map((t=>{return[n,a].includes(t.participantId)?([n,a].includes(t.participantId)&&(t.collectionAssignments=null===(e=t.collectionAssignments)||void 0===e?void 0:e.filter((t=>!(t.collectionId===u&&t.collectionPosition===s)))),t.participantId===a&&(t.collectionAssignments||(t.collectionAssignments=[]),t.collectionAssignments.push({collectionId:u,collectionPosition:s})),t):t;var e})))||[];S||N.push({participantId:a,collectionAssignments:[{collectionId:u,collectionPosition:s}]});const P=m===ii,D=P&&w.map((t=>{var e;return(null===(e=t.collectionAssignments)||void 0===e?void 0:e.find((t=>t.collectionId===u&&t.collectionPosition===s)))&&t.participantId})).filter(Boolean),T=P&&N.map((t=>{var e;return(null===(e=t.collectionAssignments)||void 0===e?void 0:e.find((t=>t.collectionId===u&&t.collectionPosition===s)))&&t.participantId})).filter(Boolean);let M,A;if(I.lineUp=N,U&&bp({participantId:U,lineUp:N,drawDefinition:o,tieFormat:p}),P){var E;const{tournamentRecord:e}=t;let i=Nr({participantIds:T,tournamentRecord:e});if(!i.participant){var b;const t=ic({returnParticipant:!0,pairOverride:!0,tournamentRecord:e,participant:{individualParticipantIds:T,participantType:Oi,participantRole:pu}});if(t.error)return t;M=null===(b=t.participant)||void 0===b?void 0:b.participantId}i=Nr({participantIds:D,tournamentRecord:e});const n=null===(E=i.participant)||void 0===E?void 0:E.participantId;n&&Zd({participantIds:[n],tournamentRecord:e}).success&&(A=n)}return Ur({drawDefinition:o,matchUp:d}),{...ut,participantRemoved:A,participantAdded:M}},updateTeamLineUp:bp,validateLineUp:Ep,getTeamLineUp:Pr},Yp={allTournamentMatchUps:ro,tournamentMatchUps:so,allEventMatchUps:oo,getRoundMatchUps:function(t){return Cr(t)},allDrawMatchUps:ao,eventMatchUps:co,drawMatchUps:function({tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:r,matchUpFilters:a,contextFilters:o,contextProfile:s,drawDefinition:c,nextMatchUps:u,participants:d,tournamentId:l,inContext:p,context:m,event:f}){if(!f)return{error:ht};const{eventId:h,eventName:I,endDate:v}=f||{};return no({context:{...m,...fe({eventId:h,eventName:I,endDate:v||(null==f?void 0:f.endDate)||(null==r?void 0:r.endDate),tournamentId:l||(null==r?void 0:r.tournamentId),indoorOutDoor:(null==f?void 0:f.indoorOutDoor)||(null==r?void 0:r.indoorOutDoor),surfaceCategory:(null==f?void 0:f.surfaceCategory)||(null==r?void 0:r.surfaceCategory)})},tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,tournamentParticipants:d||r&&uo({tournamentRecord:r,participantsProfile:i}),participantsProfile:i,policyDefinitions:n,tournamentRecord:r,drawDefinition:c,matchUpFilters:a,contextFilters:o,contextProfile:s,nextMatchUps:u,inContext:p,event:f})},credits:Eu,getEvent:function({tournamentRecord:t,drawDefinition:e,event:i,context:n}){var r;if(!t)return{error:pt};if(!i)return{error:ht};const a=me(i);return n&&Object.assign(a,n),{event:a,drawDefinition:e&&(null===(r=a.drawDefinitions)||void 0===r?void 0:r.find((({drawId:t})=>e.drawId===t)))}},getEvents:function({tournamentRecord:t,context:e,inContext:i}){if(!t)return{error:pt};const{tournamentId:n}=t;return{events:(t.events||[]).map((t=>{const r=me(t);return e&&Object.assign(r,e),i&&Object.assign(r,{tournamentId:n}),r}))}},findEventExtension:Qe,findTournamentExtension:Ze,findParticipantExtension:function({tournamentRecord:t,participantId:e,name:i}){if(!t)return{error:pt};if(!e)return{error:"Missing participantId"};const{participant:n}=$e({tournamentRecord:t,participantId:e});return Je({element:n,name:i})},findDrawDefinitionExtension:Xe,getTieFormat:function({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,drawId:r,event:a}){var o,s,c;if(!t)return{error:pt};if(!(r||a||i||n))return{error:It};const u=lo({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:r,event:a});if(n&&null!=u&&u.error)return u;!e&&null!=u&&u.drawDefinition&&(e=null==u?void 0:u.drawDefinition);let d=null==u?void 0:u.structure;if(!d&&i&&!n){if(!e)return{error:"Missing drawId"};const t=Fr({drawDefinition:e,structureId:i});if(t.error)return t;d=t.structure}const l=null===(o=d)||void 0===o?void 0:o.tieFormat,p=null===(s=e)||void 0===s?void 0:s.tieFormat,m=null==a?void 0:a.tieFormat;return{structureDefaultTieFormat:l,eventDefaultTieFormat:m,drawDefaultTieFormat:p,tieFormat:(null==u||null===(c=u.matchUp)||void 0===c?void 0:c.tieFormat)||l||p||m||void 0}},getMatchUpFormat:kc,getDrawDefinition:function({tournamentRecord:t,drawDefinition:e}){return t?{drawDefinition:me(e)}:{error:pt}},getEventProperties:function({tournamentRecord:t,event:e}){var i,n;if(!t)return{error:pt};if(!e)return{error:ht};const r=e.entries||[],a=t.participants||[],o=(null===(i=e.category)||void 0===i?void 0:i.categoryName)||(null===(n=e.category)||void 0===n?void 0:n.ageCategoryCode),{eventType:s}=e,c=r.map((t=>t.participantId));let u,d,l;return{entryScaleAttributes:a.filter((t=>c.includes(t.participantId))).map((t=>{var e,i,n,r,a,c;const{participantId:p,participantName:m,name:f}=t;let h={scaleType:"SEEDING",eventType:s,scaleName:o};const I=null===(e=ml({participant:t,scaleAttributes:h}))||void 0===e||null===(i=e.scaleItem)||void 0===i?void 0:i.scaleValue;h={scaleType:"RANKING",eventType:s,scaleName:o};const v=null===(n=ml({participant:t,scaleAttributes:h}))||void 0===n||null===(r=n.scaleItem)||void 0===r?void 0:r.scaleValue;h={scaleType:"RATING",eventType:s,scaleName:o};const g=null===(a=ml({participant:t,scaleAttributes:h}))||void 0===a||null===(c=a.scaleItem)||void 0===c?void 0:c.scaleValue;return u=!(!u&&!I),d=!(!d&&!v),l=!(!l&&!g),{participantId:p,participantName:m||f,seed:I,ranking:v,rating:g}})),hasSeededParticipants:u,hasRankedParticipants:d,hasRatedParticipants:l}},getPositionAssignments:function({tournamentRecord:t,drawDefinition:e,structureId:i}){return t?e?i?Na({drawDefinition:e,structureId:i}):{error:"Missing structureId"}:{error:mt}:{error:pt}},isValidMatchUpFormat:h,getMaxEntryPosition:function({entries:t=[],entryStatus:e,stage:i}){return Math.max(...t.filter((t=>!(i&&i!==t.entryStage||e&&t.entryStatus!==e||isNaN(t.entryPosition)))).map((({entryPosition:t})=>parseInt(t||0))),0)},findVenue:wi,getCourts:Ni,getVenuesAndCourts:Ui,findCourt:function(t){return me(Si(t),!1,!0)},getEventTimeItem:pr,getTournamentTimeItem:function({tournamentRecord:t,itemType:e,itemSubTypes:i,returnPreviousValues:n}){if(!t)return{error:pt};if(!t.timeItems)return{message:yt};const{timeItem:r,previousItems:a,message:o}=lr({element:t,itemType:e,itemSubTypes:i,returnPreviousValues:n});return r&&{timeItem:r,previousItems:a}||{message:o}},getParticipantTimeItem:function({tournamentRecord:t,participantId:e,itemType:i,itemSubTypes:n,returnPreviousValues:r}){if(!t)return{error:pt};if(!e)return{error:"Missing participantId"};const a=$e({tournamentRecord:t,participantId:e});if(a.error)return a;const{participant:o}=a;if(null==o||!o.timeItems)return{message:yt};const{timeItem:s,previousItems:c,message:u}=lr({element:a.participant,itemType:i,itemSubTypes:n,returnPreviousValues:r});return s&&{timeItem:s,previousItems:c}||{message:u}},getDrawDefinitionTimeItem:function({drawDefinition:t,itemType:e,itemSubTypes:i,returnPreviousValues:n}){if(!t)return{error:"Missing drawId"};if(!t.timeItems)return{message:yt};const{timeItem:r,previousItems:a,message:o}=lr({element:t,itemType:e,itemSubTypes:i,returnPreviousValues:n});return r&&{timeItem:r,previousItems:a}||{message:o}},bulkUpdatePublishedEventIds:function({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:pt};if(null==e||!e.length)return{error:It,message:"Missing outcomes"};const n=e.reduce(((t,e)=>{const{drawId:i,eventId:n}=e;return n&&i&&(t[n]?t[n].includes(i)||t[n].push(i):t[n]=[i]),t}),{}),r=Object.keys(n);return{publishedEventIds:(null===(i=t.events)||void 0===i?void 0:i.filter((t=>r.includes(t.eventId)))).filter((t=>{const{timeItem:e}=pr({event:t,itemType:"PUBLISH.STATUS"}),i=null==e?void 0:e.itemValue,{eventId:r}=t;return n[r].filter((t=>{var e;return i&&i.PUBLIC&&(null===(e=i.PUBLIC.drawIds)||void 0===e?void 0:e.includes(t))&&"HIDDEN"!==i})).length})).map((t=>t.eventId)),eventIdPublishedDrawIdsMap:n}},matchUpActions:Ru,positionActions:function({policyDefinitions:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,drawId:a,event:o}){const{tournamentParticipants:s}=wc({tournamentRecord:e,inContext:!0});return El({tournamentParticipants:s,policyDefinitions:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,drawId:a,event:o})},findMatchUp:function(t){Object.assign(t,{inContext:!0});const{matchUp:e,error:i}=lo(t);return{matchUp:me(e,!0,!0),error:i}},participantScheduledMatchUps:ac,participantScaleItem:ml,getParticipantScaleItem:Jl,getParticipantSignInStatus:function({tournamentRecord:t,participantId:e}){if(!t)return{error:pt};if(!e)return{error:"Missing participantId"};const{participant:i}=$e({tournamentRecord:t,participantId:e});if(!i)return{error:"Participant Not Found"};const{timeItem:n}=lr({element:i,itemType:"SIGN_IN_STATUS"});return n&&n.itemValue===lc&&lc},getPolicyDefinitions:$o,getMatchUpScheduleDetails:Ti},$p={addVenue:ec,deleteVenue:Xs,deleteVenues:function({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:pt};if(!Array.isArray(e))return{error:gt};for(const n of t.venues||[]){const{venueId:r}=n;if(e.includes(r)){const{venueId:e}=n,r=Xs({tournamentRecord:t,venueId:e,force:i});if(r.error)return r}}return ut},modifyVenue:Zs,addCourt:$s,addCourts:Js,deleteCourt:function({tournamentRecord:t,drawDefinition:e,disableNotice:i,courtId:n,force:r}){const{venue:a,error:o}=Si({tournamentRecord:t,courtId:n});if(o)return{error:o};const{matchUps:s}=Hs({tournamentRecord:t,courtId:n});if(s.length&&!r)return qs({matchUpsCount:s.length});for(const c of s){const i=Qs({tournamentRecord:t,drawDefinition:e,drawId:c.drawId,matchUpId:c.matchUpId});if(i.error)return i}return a.courts=(a.courts||[]).filter((t=>t.courtId!==n)),i||At({topic:"modifyVenue",payload:{venue:a},key:a.venueId}),{...ut}},modifyCourt:Ys,modifyCourtAvailability:Ks,findVenue:function(t){return me(wi(t),!1,!0)}},Jp=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>np({convertExtensions:t,removeExtensions:e,tournamentId:Ot()}),newTournamentRecord:(t={})=>{const e=ep(t);return e.error?e:(Ft(e),_t(e.tournamentId),Object.assign({tournamentId:e.tournamentId},ut))},setTournamentId:t=>_t(t)};function e(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}return t.version=()=>"0.74.1",t.reset=()=>e(jt(Ot())),t.setState=(t,i,n)=>(Mt(i,n),e(ip(t,i))),t.devContext=e=>(Dt(e),t),t.getDevContext=t=>Pt(t),t.executionQueue=(e,n)=>function(e,n){if(!Array.isArray(e))return{error:gt};const r=Lt(Ot()),a=n&&me(r,!1,!0),o=[];for(const s of e){if("object"!=typeof s)return{error:gt};const{method:e,params:n}=s;if(!t[e])return{error:"Method not found"};const c=i(r,t[e],n);if(null!=c&&c.error)return a&&ip(a),{...c,rolledBack:!!a};o.push(c)}return bc(),bt(),{results:o}}(e,n),[Yp,Kp,$p,wp,gp,hp,vp,lp].forEach((e=>{Object.keys(e).forEach((i=>{t[i]=t=>{if(Pt())return n(e[i],t);try{return n(e[i],t)}catch(e){const r=e.toString();console.log("ERROR",{error:r,method:i,params:JSON.stringify(t)}),console.log(e)}}}))})),t;function i(e,i,n){return delete t.success,delete t.error,i({...rp(e,n),tournamentRecord:e})}function n(t,e){const n=(null==e?void 0:e.sandBoxRecord)||(null==e?void 0:e.sandboxRecord)||(null==e?void 0:e.sandboxTournament)||Lt(Ot()),r=(null==e?void 0:e.rollbackOnError)&&me(n,!1,!0),a=i(n,t,e);null!=a&&a.error&&r&&ip(r);const o=(null==a?void 0:a.success)&&!0!==(null==e?void 0:e.delayNotify)&&!0!==(null==e?void 0:e.doNotNotify);return o&&bc(),(o||null==a||!a.success||null!=e&&e.doNotNotify)&&bt(),a}}();var Zp=[{firstName:"Novak",lastName:"Djokovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Rafael",lastName:"Nadal",sex:"MALE",nationalityCode:"ESP"},{firstName:"Dominic",lastName:"Thiem",sex:"MALE",nationalityCode:"AUT"},{firstName:"Roger",lastName:"Federer",sex:"MALE",nationalityCode:"SUI"},{firstName:"Stefanos",lastName:"Tsitsipas",sex:"MALE",nationalityCode:"GRE"},{firstName:"Daniil",lastName:"Medvedev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Alexander",lastName:"Zverev",sex:"MALE",nationalityCode:"GER"},{firstName:"Andrey",lastName:"Rublev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Diego",lastName:"Schwartzman",sex:"MALE",nationalityCode:"ARG"},{firstName:"Matteo",lastName:"Berrettini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Gael",lastName:"Monfils",sex:"MALE",nationalityCode:"FRA"},{firstName:"Denis",lastName:"Shapovalov",sex:"MALE",nationalityCode:"CAN"},{firstName:"Roberto",lastName:"Bautista Agut",sex:"MALE",nationalityCode:"ESP"},{firstName:"David",lastName:"Goffin",sex:"MALE",nationalityCode:"BEL"},{firstName:"Pablo",lastName:"Carreno Busta",sex:"MALE",nationalityCode:"ESP"},{firstName:"Fabio",lastName:"Fognini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Milos",lastName:"Raonic",sex:"MALE",nationalityCode:"CAN"},{firstName:"Karen",lastName:"Khachanov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Stan",lastName:"Wawrinka",sex:"MALE",nationalityCode:"SUI"},{firstName:"Grigor",lastName:"Dimitrov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Felix",lastName:"Auger-Aliassime",sex:"MALE",nationalityCode:"CAN"},{firstName:"Cristian",lastName:"Garin",sex:"MALE",nationalityCode:"CHI"},{firstName:"John",lastName:"Isner",sex:"MALE",nationalityCode:"USA"},{firstName:"Borna",lastName:"Coric",sex:"MALE",nationalityCode:"CRO"},{firstName:"Alex",lastName:"de Minaur",sex:"MALE",nationalityCode:"AUS"},{firstName:"Dusan",lastName:"Lajovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Casper",lastName:"Ruud",sex:"MALE",nationalityCode:"NOR"},{firstName:"Benoit",lastName:"Paire",sex:"MALE",nationalityCode:"FRA"},{firstName:"Taylor",lastName:"Fritz",sex:"MALE",nationalityCode:"USA"},{firstName:"Filip",lastName:"Krajinovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Hubert",lastName:"Hurkacz",sex:"MALE",nationalityCode:"POL"},{firstName:"Ugo",lastName:"Humbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Daniel",lastName:"Evans",sex:"MALE",nationalityCode:"GBR"},{firstName:"Jan-Lennard",lastName:"Struff",sex:"MALE",nationalityCode:"GER"},{firstName:"Reilly",lastName:"Opelka",sex:"MALE",nationalityCode:"USA"},{firstName:"Nikoloz",lastName:"Basilashvili",sex:"MALE",nationalityCode:"GEO"},{firstName:"Kei",lastName:"Nishikori",sex:"MALE",nationalityCode:"JPN"},{firstName:"Guido",lastName:"Pella",sex:"MALE",nationalityCode:"ARG"},{firstName:"Adrian",lastName:"Mannarino",sex:"MALE",nationalityCode:"FRA"},{firstName:"Miomir",lastName:"Kecmanovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Marin",lastName:"Cilic",sex:"MALE",nationalityCode:"CRO"},{firstName:"Lorenzo",lastName:"Sonego",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jannik",lastName:"Sinner",sex:"MALE",nationalityCode:"ITA"},{firstName:"Nick",lastName:"Kyrgios",sex:"MALE",nationalityCode:"AUS"},{firstName:"John",lastName:"Millman",sex:"MALE",nationalityCode:"AUS"},{firstName:"Albert",lastName:"Ramos-Vinolas",sex:"MALE",nationalityCode:"ESP"},{firstName:"Kyle",lastName:"Edmund",sex:"MALE",nationalityCode:"GBR"},{firstName:"Tennys",lastName:"Sandgren",sex:"MALE",nationalityCode:"USA"},{firstName:"Alexander",lastName:"Bublik",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Sam",lastName:"Querrey",sex:"MALE",nationalityCode:"USA"},{firstName:"Yoshihito",lastName:"Nishioka",sex:"MALE",nationalityCode:"JPN"},{firstName:"Marton",lastName:"Fucsovics",sex:"MALE",nationalityCode:"HUN"},{firstName:"Aljaz",lastName:"Bedene",sex:"MALE",nationalityCode:"SLO"},{firstName:"Laslo",lastName:"Djere",sex:"MALE",nationalityCode:"SRB"},{firstName:"Richard",lastName:"Gasquet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pablo",lastName:"Andujar",sex:"MALE",nationalityCode:"ESP"},{firstName:"Jo-Wilfried",lastName:"Tsonga",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gilles",lastName:"Simon",sex:"MALE",nationalityCode:"FRA"},{firstName:"Tommy",lastName:"Paul",sex:"MALE",nationalityCode:"USA"},{firstName:"Jordan",lastName:"Thompson",sex:"MALE",nationalityCode:"AUS"},{firstName:"Fernando",lastName:"Verdasco",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alejandro",lastName:"Davidovich Fokina",sex:"MALE",nationalityCode:"ESP"},{firstName:"Feliciano",lastName:"Lopez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Frances",lastName:"Tiafoe",sex:"MALE",nationalityCode:"USA"},{firstName:"Dominik",lastName:"Koepfer",sex:"MALE",nationalityCode:"GER"},{firstName:"Jiri",lastName:"Vesely",sex:"MALE",nationalityCode:"CZE"},{firstName:"Pablo",lastName:"Cuevas",sex:"MALE",nationalityCode:"URU"},{firstName:"Ricardas",lastName:"Berankis",sex:"MALE",nationalityCode:"LTU"},{firstName:"Lucas",lastName:"Pouille",sex:"MALE",nationalityCode:"FRA"},{firstName:"Cameron",lastName:"Norrie",sex:"MALE",nationalityCode:"GBR"},{firstName:"Steve",lastName:"Johnson",sex:"MALE",nationalityCode:"USA"},{firstName:"Jeremy",lastName:"Chardy",sex:"MALE",nationalityCode:"FRA"},{firstName:"Stefano",lastName:"Travaglia",sex:"MALE",nationalityCode:"ITA"},{firstName:"Corentin",lastName:"Moutet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Juan",lastName:"Ignacio Londero",sex:"MALE",nationalityCode:"ARG"},{firstName:"Federico",lastName:"Delbonis",sex:"MALE",nationalityCode:"ARG"},{firstName:"Marco",lastName:"Cecchinato",sex:"MALE",nationalityCode:"ITA"},{firstName:"Thiago",lastName:"Monteiro",sex:"MALE",nationalityCode:"BRA"},{firstName:"Salvatore",lastName:"Caruso",sex:"MALE",nationalityCode:"ITA"},{firstName:"Lloyd",lastName:"Harris",sex:"MALE",nationalityCode:"RSA"},{firstName:"Vasek",lastName:"Pospisil",sex:"MALE",nationalityCode:"CAN"},{firstName:"Pierre-Hugues",lastName:"Herbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Egor",lastName:"Gerasimov",sex:"MALE",nationalityCode:"BLR"},{firstName:"Joao",lastName:"Sousa",sex:"MALE",nationalityCode:"POR"},{firstName:"Radu",lastName:"Albot",sex:"MALE",nationalityCode:"MDA"},{firstName:"Marcos",lastName:"Giron",sex:"MALE",nationalityCode:"USA"},{firstName:"Mikael",lastName:"Ymer",sex:"MALE",nationalityCode:"SWE"},{firstName:"Attila",lastName:"Balazs",sex:"MALE",nationalityCode:"HUN"},{firstName:"Federico",lastName:"Coria",sex:"MALE",nationalityCode:"ARG"},{firstName:"Soonwoo",lastName:"Kwon",sex:"MALE",nationalityCode:"KOR"},{firstName:"Mikhail",lastName:"Kukushkin",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Dennis",lastName:"Novak",sex:"MALE",nationalityCode:"AUT"},{firstName:"Pedro",lastName:"Martinez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Philipp",lastName:"Kohlschreiber",sex:"MALE",nationalityCode:"GER"},{firstName:"Yannick",lastName:"Hanfmann",sex:"MALE",nationalityCode:"GER"},{firstName:"Gianluca",lastName:"Mager",sex:"MALE",nationalityCode:"ITA"},{firstName:"James",lastName:"Duckworth",sex:"MALE",nationalityCode:"AUS"},{firstName:"Emil",lastName:"Ruusuvuori",sex:"MALE",nationalityCode:"FIN"},{firstName:"Yasutaka",lastName:"Uchiyama",sex:"MALE",nationalityCode:"JPN"},{firstName:"Roberto",lastName:"Carballes Baena",sex:"MALE",nationalityCode:"ESP"},{firstName:"Ashleigh",lastName:"Barty",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Simona",lastName:"Halep",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Naomi",lastName:"Osaka",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Sofia",lastName:"Kenin",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Elina",lastName:"Svitolina",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Karolina",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Bianca",lastName:"Andreescu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Petra",lastName:"Kvitova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Kiki",lastName:"Bertens",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Serena",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aryna",lastName:"Sabalenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Belinda",lastName:"Bencic",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Victoria",lastName:"Azarenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Johanna",lastName:"Konta",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Garbine",lastName:"Muguruza",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Madison",lastName:"Keys",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Iga",lastName:"Swiatek",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Petra",lastName:"Martic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Elena",lastName:"Rybakina",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Marketa",lastName:"Vondrousova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Elise",lastName:"Mertens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Maria",lastName:"Sakkari",sex:"FEMALE",nationalityCode:"GRE"},{firstName:"Anett",lastName:"Kontaveit",sex:"FEMALE",nationalityCode:"EST"},{firstName:"Jennifer",lastName:"Brady",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelique",lastName:"Kerber",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Alison",lastName:"Riske",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Karolina",lastName:"Muchova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Yulia",lastName:"Putintseva",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Dayana",lastName:"Yastremska",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Amanda",lastName:"Anisimova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Ons",lastName:"Jabeur",sex:"FEMALE",nationalityCode:"TUN"},{firstName:"Donna",lastName:"Vekic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Ekaterina",lastName:"Alexandrova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qiang",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Shuai",lastName:"Zhang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Svetlana",lastName:"Kuznetsova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Barbora",lastName:"Strycova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Anastasia",lastName:"Pavlyuchenkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Sloane",lastName:"Stephens",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Magda",lastName:"Linette",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Saisai",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Fiona",lastName:"Ferro",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Caroline",lastName:"Garcia",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Jelena",lastName:"Ostapenko",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Danielle",lastName:"Collins",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Veronika",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Cori",lastName:"Gauff",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Nadia",lastName:"Podoroska",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Kristina",lastName:"Mladenovic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Laura",lastName:"Siegemund",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Marie",lastName:"Bouzkova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Polona",lastName:"Hercog",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Alize",lastName:"Cornet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Anastasija",lastName:"Sevastova",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Rebecca",lastName:"Peterson",sex:"FEMALE",nationalityCode:"SWE"},{firstName:"Patricia",lastName:"Maria Tig",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Jil",lastName:"Teichmann",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Shelby",lastName:"Rogers",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Heather",lastName:"Watson",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Anna",lastName:"Blinkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Bernarda",lastName:"Pera",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Jessica",lastName:"Pegula",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alison",lastName:"Van Uytvanck",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Katerina",lastName:"Siniakova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Sara",lastName:"Sorribes Tormo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Su-Wei",lastName:"Hsieh",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Ajla",lastName:"Tomljanovic",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Kristyna",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Paula",lastName:"Badosa",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Daria",lastName:"Kasatkina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nao",lastName:"Hibino",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Arantxa",lastName:"Rus",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lauren",lastName:"Davis",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Krejcikova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Camila",lastName:"Giorgi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Irina-Camelia",lastName:"Begu",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Danka",lastName:"Kovinic",sex:"FEMALE",nationalityCode:"MNE"},{firstName:"Venus",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Zarina",lastName:"Diyas",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Christina",lastName:"Mchale",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Madison",lastName:"Brengle",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Carla",lastName:"Suarez Navarro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Martina",lastName:"Trevisan",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Kirsten",lastName:"Flipkens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Misaki",lastName:"Doi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Tamara",lastName:"Zidansek",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Sorana",lastName:"Cirstea",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Leylah",lastName:"Fernandez",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Taylor",lastName:"Townsend",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Lin",lastName:"Zhu",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Ana",lastName:"Bogdan",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Aliaksandra",lastName:"Sasnovich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Yafan",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Jasmine",lastName:"Paolini",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Varvara",lastName:"Gracheva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Viktoria",lastName:"Kuzmova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Nina",lastName:"Stojanovic",sex:"FEMALE",nationalityCode:"SRB"},{firstName:"Anastasia",lastName:"Potapova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Andrea",lastName:"Petkovic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kaja",lastName:"Juvan",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Elsa",lastName:"Jacquemot",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Victoria",lastName:"Jimenez Kasintseva",sex:"FEMALE",nationalityCode:"AND"},{firstName:"Alexandra",lastName:"Eala",sex:"FEMALE",nationalityCode:"PHI"},{firstName:"Diane",lastName:"Parry",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Daria",lastName:"Snigur",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Polina",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Robin",lastName:"Montgomery",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alexandra",lastName:"Vecic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kristina",lastName:"Dmitruk",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Alexa",lastName:"Noel",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Kamilla",lastName:"Bartone",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Weronika",lastName:"Baszak",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Oksana",lastName:"Selekhmeteva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Alina",lastName:"Charaeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Maria",lastName:"Bondarenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Priska",lastName:"Madelyn Nugroho",sex:"FEMALE",nationalityCode:"INA"},{firstName:"Linda",lastName:"Fruhvirtova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Dana",lastName:"Guzman",sex:"FEMALE",nationalityCode:"PER"},{firstName:"Linda",lastName:"Noskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Hong",lastName:"Yi Cody Wong",sex:"FEMALE",nationalityCode:"HKG"},{firstName:"Zhuoxuan",lastName:"Bai",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Mell",lastName:"Reasco Gonzalez",sex:"FEMALE",nationalityCode:"ECU"},{firstName:"Matilda",lastName:"Mutavdzic",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Diana",lastName:"Shnaider",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qinwen",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Alexandra",lastName:"Yepifanova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Matilde",lastName:"Paoletti",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Melania",lastName:"Delai",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jana",lastName:"Kolodynska",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Guillermina",lastName:"Grant",sex:"FEMALE",nationalityCode:"URU"},{firstName:"Darja",lastName:"Vidmanova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Melodie",lastName:"Collard",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Elvina",lastName:"Kalieva",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Sofia",lastName:"Costoulas",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Aliona",lastName:"Falei",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Mai",lastName:"Nirundorn",sex:"FEMALE",nationalityCode:"THA"},{firstName:"Elizabeth",lastName:"Coleman",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aubane",lastName:"Droguet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Madison",lastName:"Sieg",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Natsumi",lastName:"Kawaguchi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Leyre",lastName:"Romero Gormaz",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Elina",lastName:"Avanesyan",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Oceane",lastName:"Babel",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ziva",lastName:"Falkner",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Julia",lastName:"Garcia",sex:"FEMALE",nationalityCode:"MEX"},{firstName:"Natalia",lastName:"Szabanin",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Erika",lastName:"Andreeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Celia",lastName:"Belle Mohr",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ane",lastName:"Mintegi Del Olmo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Sebastianna",lastName:"Scilipoti",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Ana",lastName:"Geller",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Dayeon",lastName:"Back",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Selena",lastName:"Janicijevic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Romana",lastName:"Cisovska",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Amarissa",lastName:"Kiara Toth",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Mara",lastName:"Guth",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Evialina",lastName:"Laskevich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Julia",lastName:"Avdeeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Beatrice",lastName:"Ricci",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Eleonora",lastName:"Alvisi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jessica",lastName:"Bouzas Maneiro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Julie",lastName:"Belgraver",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lisa",lastName:"Pigato",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Ya",lastName:"Yi Yang",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Eva",lastName:"Lys",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Talia",lastName:"Gibson",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Yeon",lastName:"Ku",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Katrina",lastName:"Scott",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Palicova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Alina",lastName:"Shcherbinina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Giulia",lastName:"Morlet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tina",lastName:"Nadine Smith",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Sohyun",lastName:"Park",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Tara",lastName:"Wurth",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Polina",lastName:"Iatcenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Lauren",lastName:"Anzalotta Kynoch",sex:"FEMALE",nationalityCode:"PUR"},{firstName:"Savannah",lastName:"Broadus",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelina",lastName:"Wirges",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Amarni",lastName:"Banks",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Hanne",lastName:"Vandewinkel",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Jada",lastName:"Bui",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Sabina",lastName:"Zeynalova",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Pia",lastName:"Lovric",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Erika",lastName:"Matsuda",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Lyubov",lastName:"Kostenko",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Anaelle",lastName:"Leclercq",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Alessandra",lastName:"Simone",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Darja",lastName:"Semenistaja",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Daria",lastName:"Frayman",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nastasja",lastName:"Schunk",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Olivia",lastName:"Gadecki",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"India",lastName:"Houghton",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Maria",lastName:"Sholokhova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Julia",lastName:"Middendorf",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Petra",lastName:"Marcinko",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Radka",lastName:"Zelnickova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Lucie",lastName:"Nguyen Tan",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tatiana",lastName:"Barkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Annabelle",lastName:"Xu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Harold",lastName:"Mayot",sex:"MALE",nationalityCode:"FRA"},{firstName:"Holger",lastName:"Vitus Nodskov Rune",sex:"MALE",nationalityCode:"DEN"},{firstName:"Dominic",lastName:"Stephan Stricker",sex:"MALE",nationalityCode:"SUI"},{firstName:"Shintaro",lastName:"Mochizuki",sex:"MALE",nationalityCode:"JPN"},{firstName:"Arthur",lastName:"Cazaux",sex:"MALE",nationalityCode:"FRA"},{firstName:"Leandro",lastName:"Riedi",sex:"MALE",nationalityCode:"SUI"},{firstName:"Martin",lastName:"Damm",sex:"MALE",nationalityCode:"USA"},{firstName:"Natan",lastName:"Rodrigues",sex:"MALE",nationalityCode:"BRA"},{firstName:"Karlis",lastName:"Ozolins",sex:"MALE",nationalityCode:"LAT"},{firstName:"Luciano",lastName:"Darderi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Hanwen",lastName:"Li",sex:"MALE",nationalityCode:"CHN"},{firstName:"Arthur",lastName:"Fery",sex:"MALE",nationalityCode:"GBR"},{firstName:"Juan",lastName:"Bautista Torres",sex:"MALE",nationalityCode:"ARG"},{firstName:"Khololwam",lastName:"Montsi",sex:"MALE",nationalityCode:"RSA"},{firstName:"Jeffrey",lastName:"Von Der Schulenburg",sex:"MALE",nationalityCode:"SUI"},{firstName:"Timo",lastName:"Legout",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gustavo",lastName:"Heide",sex:"MALE",nationalityCode:"BRA"},{firstName:"Flavio",lastName:"Cobolli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Guy",lastName:"Den Ouden",sex:"MALE",nationalityCode:"NED"},{firstName:"Martin",lastName:"Breysach",sex:"MALE",nationalityCode:"FRA"},{firstName:"Toby",lastName:"Kodat",sex:"MALE",nationalityCode:"USA"},{firstName:"Lilian",lastName:"Marmousez",sex:"MALE",nationalityCode:"FRA"},{firstName:"Roman",lastName:"Andres Burruchaga",sex:"MALE",nationalityCode:"ARG"},{firstName:"Alex",lastName:"Barrena",sex:"MALE",nationalityCode:"ARG"},{firstName:"Dalibor",lastName:"Svrcina",sex:"MALE",nationalityCode:"CZE"},{firstName:"Martin",lastName:"Krumich",sex:"MALE",nationalityCode:"CZE"},{firstName:"Peter",lastName:"Fajta",sex:"MALE",nationalityCode:"HUN"},{firstName:"Lukas",lastName:"Neumayer",sex:"MALE",nationalityCode:"AUT"},{firstName:"Raphael",lastName:"Collignon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Dali",lastName:"Blanch",sex:"MALE",nationalityCode:"USA"},{firstName:"Terence",lastName:"Atmane",sex:"MALE",nationalityCode:"FRA"},{firstName:"Felix",lastName:"Gill",sex:"MALE",nationalityCode:"GBR"},{firstName:"Eliakim",lastName:"Coulibaly",sex:"MALE",nationalityCode:"CIV"},{firstName:"Hamad",lastName:"Medjedovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Jerome",lastName:"Kym",sex:"MALE",nationalityCode:"SUI"},{firstName:"Nicholas",lastName:"David Ionel",sex:"MALE",nationalityCode:"ROU"},{firstName:"Shunsuke",lastName:"Mitsui",sex:"MALE",nationalityCode:"JPN"},{firstName:"Giovanni",lastName:"Mpetshi Perricard",sex:"MALE",nationalityCode:"FRA"},{firstName:"Bu",lastName:"Yunchaokete",sex:"MALE",nationalityCode:"CHN"},{firstName:"Jack",lastName:"Pinnington Jones",sex:"MALE",nationalityCode:"GBR"},{firstName:"Alexander",lastName:"Hoogmartens",sex:"MALE",nationalityCode:"BEL"},{firstName:"Bruno",lastName:"Oliveira",sex:"MALE",nationalityCode:"BRA"},{firstName:"Maks",lastName:"Kasnikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Mikolaj",lastName:"Lorens",sex:"MALE",nationalityCode:"POL"},{firstName:"Chak",lastName:"Lam Coleman Wong",sex:"MALE",nationalityCode:"HKG"},{firstName:"Egor",lastName:"Agafonov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Mans",lastName:"Dahlberg",sex:"MALE",nationalityCode:"SWE"},{firstName:"Marat",lastName:"Sharipov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Luca",lastName:"Nardi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Sean",lastName:"Cuenin",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pedro",lastName:"Boscardin Dias",sex:"MALE",nationalityCode:"BRA"},{firstName:"Samuel",lastName:"Vincent Ruggeri",sex:"MALE",nationalityCode:"ITA"},{firstName:"Bruno",lastName:"Kuzuhara",sex:"MALE",nationalityCode:"USA"},{firstName:"Romain",lastName:"Faucon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Elmer",lastName:"Moller",sex:"MALE",nationalityCode:"DEN"},{firstName:"Mario",lastName:"Mansilla Diez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Leonardo",lastName:"Malgaroli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Pierre",lastName:"Yves Bailly",sex:"MALE",nationalityCode:"BEL"},{firstName:"Sebastian",lastName:"Gima",sex:"MALE",nationalityCode:"ROU"},{firstName:"Ilya",lastName:"Snitari",sex:"MALE",nationalityCode:"MDA"},{firstName:"Diego",lastName:"Augusto Barreto Sanchez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alexander",lastName:"Bernard",sex:"MALE",nationalityCode:"USA"},{firstName:"Pengyu",lastName:"Lu",sex:"MALE",nationalityCode:"CHN"},{firstName:"Max",lastName:"Wiskandt",sex:"MALE",nationalityCode:"GER"},{firstName:"Max",lastName:"Westphal",sex:"MALE",nationalityCode:"FRA"},{firstName:"Lorenzo",lastName:"Claverie",sex:"MALE",nationalityCode:"VEN"},{firstName:"Axel",lastName:"Garcian",sex:"MALE",nationalityCode:"FRA"},{firstName:"Aleksander",lastName:"Orlikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Maxwell",lastName:"Mckennon",sex:"MALE",nationalityCode:"USA"},{firstName:"Rafael",lastName:"Alfonso De Alba Valdes",sex:"MALE",nationalityCode:"MEX"},{firstName:"Dev",lastName:"Javia",sex:"MALE",nationalityCode:"IND"},{firstName:"Kokoro",lastName:"Isomura",sex:"MALE",nationalityCode:"JPN"},{firstName:"Matteo",lastName:"Gigante",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jack",lastName:"Anthrop",sex:"MALE",nationalityCode:"USA"},{firstName:"Pablo",lastName:"Llamas Ruiz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Biagio",lastName:"Gramaticopolo",sex:"MALE",nationalityCode:"ITA"},{firstName:"Patorn",lastName:"Hanchaikul",sex:"MALE",nationalityCode:"THA"},{firstName:"Marko",lastName:"Topo",sex:"MALE",nationalityCode:"SRB"},{firstName:"Carlos",lastName:"Alcaraz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Juncheng",lastName:"Shang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Toby",lastName:"Samuel",sex:"MALE",nationalityCode:"GBR"},{firstName:"Petr",lastName:"Nesterov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Mehdi",lastName:"Sadaoui",sex:"MALE",nationalityCode:"FRA"},{firstName:"Max",lastName:"Alcala Gurri",sex:"MALE",nationalityCode:"ESP"},{firstName:"Nikita",lastName:"Kashirin",sex:"MALE",nationalityCode:"RUS"},{firstName:"Aidan",lastName:"Mayo",sex:"MALE",nationalityCode:"USA"},{firstName:"Yu",lastName:"Zhang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Philip",lastName:"Sekulic",sex:"MALE",nationalityCode:"AUS"},{firstName:"Lorenzo",lastName:"Rottoli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Michal",lastName:"Novansky",sex:"MALE",nationalityCode:"SVK"},{firstName:"Maikel",lastName:"De Boes",sex:"MALE",nationalityCode:"BEL"},{firstName:"Chen",lastName:"Dong",sex:"MALE",nationalityCode:"AUS"},{firstName:"Evgeny",lastName:"Philippov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Damien",lastName:"Salvestre",sex:"MALE",nationalityCode:"FRA"},{firstName:"Francesco",lastName:"Maestrelli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Viacheslav",lastName:"Bielinskyi",sex:"MALE",nationalityCode:"UKR"},{firstName:"Jean",lastName:"Marc Malkowski",sex:"MALE",nationalityCode:"SUI"},{firstName:"Santiago",lastName:"De La Fuente",sex:"MALE",nationalityCode:"ARG"},{firstName:"Simeon",lastName:"Terziev",sex:"MALE",nationalityCode:"BUL"},{firstName:"Benjamin",lastName:"Kittay",sex:"MALE",nationalityCode:"USA"}];function Qp({personExtensions:t,consideredDate:e,isMock:i=!0,personData:n,count:r=1,category:a,sex:o}={}){if(isNaN(r))return{error:gt};let s=Zp.filter((t=>!o||t.sex===o)),c=[];if(Array.isArray(n)){const t=n.filter((t=>!("string"!=typeof t.firstName||"string"!=typeof t.lastName||![sp,cp].includes(t.sex)||t.nationalityCode&&("string"!=typeof t.nationalityCode||t.nationalityCode.length>3||!Nn.find((({iso:e,ioc:i})=>[e,i].includes(t.nationalityCode))))||(t.nationalityCode&&c.push(t.nationalityCode),0))));if(!t.length)return{error:gt};s=t}const u=Z(s);if(u.length<r){const{maleFirstNames:t,maleLastNames:e,femaleFirstNames:i,femaleLastNames:n,nationalityCodes:a}=Zp.reduce(((t,e)=>{const{firstName:i,lastName:n,nationalityCode:r}=e;return e.sex===sp?(t.maleFirstNames.includes(i)||t.maleFirstNames.push(i),t.maleLastNames.includes(n)||t.maleLastNames.push(n)):(t.femaleFirstNames.includes(i)||t.femaleFirstNames.push(i),t.femaleLastNames.includes(n)||t.femaleLastNames.push(n)),t.nationalityCodes.includes(r)||t.nationalityCodes.push(r),t}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});nt(0,r-u.length).forEach((()=>{const r=o||it([sp,cp]),s=it(a),c={firstName:it(r===sp?t:i),lastName:it(r===sp?e:n),sex:r,nationalityCode:s};u.push(c)}))}const{ageMinDate:d,ageMaxDate:l}=ur({consideredDate:e,category:a}),p=parseInt((null==d?void 0:d.slice(0,4))||0)||parseInt((null==l?void 0:l.slice(0,4))||0)-3,m=parseInt((null==l?void 0:l.slice(0,4))||0)||parseInt((null==d?void 0:d.slice(0,4))||0)+3,f=(d||l)&&[p,m],h=u.slice(0,r).map(((e,n)=>{const r=f&&et(nt(...f)),a=et(nt(0,365)),o=r&&function(t,e,i){const n=new Date(t,0);return Kt(new Date(n.setDate(e)),void 0)}(r,a);return Object.assign(fe({extensions:t||[{name:"regionCode",value:n+1}],birthDate:o,isMock:i}),e)}));return{persons:h.length&&h||u[0],nationalityCodes:c}}function Xp(t){const{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{city:e&&e[a],state:i&&i[a],postalCode:n&&n[a],countryCode:r}}var tm=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function em({count:t=1}={}){const e=Z(tm).slice(0,t);return e.length<t&&nt(0,t-e.length).forEach((t=>e.push(`Team ${t+1}`))),{teams:e}}var im=[{AL:"Alabama"},{AK:"Alaska"},{AZ:"Arizona"},{AR:"Arkansas"},{CA:"California"},{CO:"Colorado"},{CT:"Connecticut"},{DE:"Delaware"},{DC:"District of Columbia"},{FL:"Florida"},{GA:"Georgia"},{HI:"Hawaii"},{ID:"Idaho"},{IL:"Illinois"},{IN:"Indiana"},{IA:"Iowa"},{KS:"Kansas"},{KY:"Kentucky"},{LA:"Louisiana"},{ME:"Maine"},{MD:"Maryland"},{MA:"Massachusetts"},{MI:"Michigan"},{MN:"Minnesota"},{MS:"Mississippi"},{MO:"Missouri"},{MT:"Montana"},{NE:"Nebraska"},{NV:"Nevada"},{NH:"New Hampshire"},{NJ:"New Jersey"},{NM:"New Mexico"},{NY:"New York"},{NC:"North Carolina"},{ND:"North Dakota"},{OH:"Ohio"},{OK:"Oklahoma"},{OR:"Oregon"},{PA:"Pennsylvania"},{RI:"Rhode Island"},{SC:"South Carolina"},{SD:"South Dakota"},{TN:"Tennessee"},{TX:"Texas"},{UT:"Utah"},{VT:"Vermont"},{VA:"Virginia"},{WA:"Washington"},{WV:"West Virginia"},{WI:"Wisconsin"},{WY:"Wyoming"},{PR:"Puerto Rico"}],nm=["Adairsville","Ashburn","Ashland","Audubon Park","Aurora","Bay Minette","Bayville","Bean Station","Becket","Belle Isle","Bellmead","Belville","Benld","Benton","Boaz","Bolivar","Bossier City","Bremen","Brent","Brentwood","Brownsville","Burns","Cairo","Caledonia","Cambridge","Canutillo","Central Garage","Centralia","Cherry Valley","Chester Center","Chesterfield","Cibecue","Cohoe","Collinsville","Columbus","Corcoran","Cuba","Dolgeville","Douglas","Druid Hills","Dyker Heights","Eagar","East Dubuque","East Valley","Edgefield","Eliot","Elizabeth","Elmsford","Emerald Isle","Emory","Estero","Fairmount","Falcon Heights","Falmouth","Fillmore","Flower Hill","Fobes Hill","Fort Valley","Franklin","Freeport","Gardnertown","Gates Mills","Glasgow Village","Goldsboro","Grant-Valkaria","Greenfield","Gretna","Guilford Siding","Hampton Falls","Harrisonville","Hart","Haskins","Hebron","Hennepin","Highgrove","Homerville","Homewood","Hooksett","Inwood","Island Lake","Issaquah","Jasper","Jefferson","Jewell","Kaukauna","Kings Grant","Kingston","Kirkland","Kokomo","Koloa","La Center","LaBelle","Lake Placid","Lake Waccamaw","Laughlin","LaVerkin","Leadville North","Leland","Long Creek","Longmeadow","Luttrell","Magnolia","Malvern","Mar-Mac","Marana","Marble Falls","Martin","Martindale","Martinsburg","Mazomanie","Mechanicsville","Mexico Beach","Middletown","Mobile","Moravian Falls","Morehead","Mount Hermon","Mulberry","Munhall","Nettleton","Newton","North Granby","North Highlands","Northern Cambria","Northwest Harwinton","Nurillo","Oasis","Orlando","Osceola","Otis","Pacolet","Palm Beach Gardens","Paoli","Patton Village","Paw Paw Lake","Pearl River","Pine Bluffs","Pine","Pioneer","Port Hadlock-Irondale","Porter","Potsdam","Price","Princess Anne","Princeville","Red Oak","Richfield","Ridge Wood Heights","Ringwood","Robinwood","Rochester","Rockland","Rockwell City","Roland","Rolling Hills","Ruskin","Saint Anthony","Saint Robert","Salisbury","Sauk Rapids","Sayreville Junction","Sedona","Shawnee","Shenandoah","Silver Lake","South Waverly","Southwest Ranches","Southwick","Spring Green","Spring Valley","Spry","Strawberry Point","Terryville","Texico","Thomson","Tonganoxie","Townsend","Trinity","Union City","Van Buren","Verona Walk","Villa Rica","Warrenton","Warroad","Washington, D.C.","Weaverville","Wescosville","West Clarkston-Highland","West Orange","Williamsport","Windsor","Winnsboro","Woodbridge","Woodmoor","Wyoming","Zeeland"];function rm({count:t=1,participantsCount:e=32}={}){const i=Z(nm),n=i.slice(0,t);return{cities:nt(0,e).map((e=>e<Math.min(t,i.length)?n[e]:it(n)))}}function am({count:t=1,participantsCount:e=32}={}){const i=Z(im),n=i.slice(0,t).map((t=>Object.keys(t))).flat();return{states:nt(0,e).map((e=>e<Math.min(t,i.length)?n[e]:it(n)))}}function om({count:t=1,participantsCount:e=32}={}){const i=nt(0,t).map((()=>nt(0,5).map((()=>W(0,9))).join("")));return{postalCodes:nt(0,e).map((e=>e<t?i[e]:it(i)))}}function sm({scoreString:t,tiebreakTo:e=7}){return t.split(" ").filter(Boolean).map(((t,i)=>function({set:t,setNumber:i}){const n=(null==t?void 0:t.startsWith("["))&&t.split("[")[1].split("]")[0].split("-").map((t=>parseInt(t))),r=t.includes("(")?t.split("(")[0]:t.includes("[")?t.split("[")[0]:t,a=!n&&r.split("-").map((t=>parseInt(t))),o=n?n[0]>n[1]?1:n[0]<n[1]?2:void 0:a[0]>a[1]?1:a[0]<a[1]?2:void 0,s=t.includes("(")&&t.split("(")[1].split(")")[0],c=![!1,void 0].includes(s)&&ki({isSide1:2===o,lowValue:s,tiebreakTo:e})||[],[u,d]=a||[],[l,p]=n||c||[];return{side1Score:u,side2Score:d,side1TiebreakScore:l,side2TiebreakScore:p,winningSide:o,setNumber:i}}({set:t,setNumber:i+1})))}function cm({scoreString:t,winningSide:e,matchUpStatus:i}){if(!t)return{outcome:{...Xo,winningSide:e,matchUpStatus:i}};if(e&&![1,2,void 0].includes(e))return{error:gt,winningSide:e};const n=t&&sm({scoreString:t}),r={},a=In({sets:n}),o=In({sets:n,reversed:!0});return 2===e?(r.scoreStringSide1=o,r.scoreStringSide2=a):(r.scoreStringSide1=a,r.scoreStringSide2=o),r.sets=sm({scoreString:r.scoreStringSide1}),{outcome:{matchUpStatus:i,winningSide:e,score:r}}}const um={[E]:2,[N]:1,[T]:1,[S]:4};function dm({matchUpFormat:t="SET3-S:6/TB7",matchUpStatusProfile:e=um,pointsPerMinute:i=1,sideWeight:n=4,winningSide:r,defaultWithScorePercent:a=2}){if(!h(t))return{error:"Invalid matchUpFormat"};if("object"!=typeof e)return{error:gt};if(a>100&&(a=100),isNaN(a)||isNaN(i)||isNaN(n))return{error:gt};const o=Object.keys(e).filter((t=>Object.keys(_).includes(t)&&t!==w));if(Object.keys(o).reduce(((t,i)=>t+e[i]),0)>100)return{error:gt,matchUpStatusProfile:e};const s=o.reduce(((t,i)=>(t.pointer=t.pointer+e[i],t.valueMap.push([t.pointer,i]),t)),{pointer:0,valueMap:[]}),c=W(1,100),d=(s.valueMap.find((t=>c<=t[0]))||[100,w])[1],l={sets:[],scoreStringSide1:"",side2ScoreString:""};if([E,S].includes(d)){const t={score:l,winningSide:r=r||W(1,2),matchUpStatus:d};if(!(d===S&&W(1,100)>100-a))return{outcome:t}}else if(d===N)return{outcome:{score:l,matchUpStatus:d}};const p=u(t),{bestOf:m,setFormat:f,finalSetFormat:I}=p,v=[],g=W(0,1),y=r?[r-1]:[...nt(0,n).map((()=>g)),1-g],U=[T,S,D,M].includes(d)&&(et(nt(1,m))||1);let P;for(const u of nt(1,m+1)){const e=u===m,{set:n,incomplete:r,winningSideNumber:a}=lm({incomplete:U===u,matchUpStatus:d,pointsPerMinute:i,setFormat:e&&I||f,setNumber:u,weightedRange:y});if(v.push(n),r){P=a;break}if(wn({matchUp:{score:{sets:v},matchUpFormat:t}}).calculatedWinningSide)break}const A=wn({matchUp:{score:{sets:v},matchUpFormat:t}}),b=P?r||P:A.calculatedWinningSide,{score:R}=_s({score:{sets:v},winningSide:b,matchUpStatus:d});return{outcome:{score:R,winningSide:b,matchUpStatus:d}}}function lm({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){const o={setNumber:a},{setTo:s,tiebreakFormat:c,tiebreakAt:u,tiebreakSet:d,timed:l,minutes:p}=r,m=W(0,t.length-1),f=t[m];let h;if(l){const r=p*e,a=Math.round(.2*r),s=r+et([1,-1])*a,c=function(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}(s,2),u=[c,s-c];f&&u.reverse(),h=t[m]+1;let d=u[0]>u[1]?1:u[1]>u[0]?2:0;if(n){const[t,e]=u;return Object.assign(o,{side1Score:t,side2Score:e}),x.includes(i)?{set:o,incomplete:n,winningSideNumber:h}:{set:o,incomplete:n}}d||(u[W(0,1)]+=1),d=u[0]>u[1]?1:2,d!==h&&u.reverse();const[l,I]=u;return Object.assign(o,{side1Score:l,side2Score:I,winningSide:h}),{set:o}}if(n)return o.side1Score=W(0,u),o.side2Score=W(0,u),x.includes(i)&&(h=t[m]+1),{set:o,incomplete:n,winningSideNumber:h};{const e=nt(1,s+1).map((t=>nt(0,s+2-t).map((()=>t)))).flat(),i=e[W(0,e.length-1)],n=s&&Fi({isSide1:!0,tiebreakAt:u,lowValue:i,setTo:s}),a=!n,l=1===t.length&&t[m]+1;if(!a){l?(n[0]>n[1]?1:2)!==l&&n.reverse():f&&n.reverse();const[t,e]=n;Object.assign(o,{side1Score:t,side2Score:e})}const p=Un({matchUpScoringFormat:{setFormat:r},setObject:o});let h;if(p.hasTiebreakCondition||a){const{NoAD:t,tiebreakTo:e}=c||d||{},i=nt(1,e+1).map((t=>nt(0,e+2-t).map((()=>t)))).flat(),n=i[W(0,i.length-1)];let r=ki({isSide1:!0,lowValue:n,tiebreakTo:e,tiebreakNoAd:t});if(a){const t=r[0]>r[1]?1:2;l?t!==l&&r.reverse():f&&r.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=r,h=r[0]>r[1]?1:2}else 2===p.leadingSide?[o.side1TiebreakScore,o.side2TiebreakScore]=r:[o.side2TiebreakScore,o.side1TiebreakScore]=r}o.winningSide=p.winningSide||p.leadingSide||l||h}return{set:o}}function pm({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,drawDefinition:n,completionGoal:r,matchUpFormat:a,event:o}){const s=n.structures.slice().sort(xr);let c=0;const u="string"==typeof e&&e,d=u&&w;for(const l of s){const e=Or({drawDefinition:n}),{matchUps:s}=ba({inContext:!0,drawDefinition:n,matchUpsMap:e,structure:l,event:o}),p=s.filter((({winningSide:t})=>!t)).sort(_o).map(br);for(const m of p){if(!isNaN(r)&&c>=r)break;const{matchUps:s}=ba({inContext:!0,drawDefinition:n,matchUpsMap:e,structure:l,event:o}),p=s.find((t=>t.matchUpId===m)),f=p.matchUpStatus===N;if(null!=p&&p.readyToScore&&!f){const e=fm({winningSide:!i&&1,matchUpStatusProfile:t,drawDefinition:n,targetMatchUp:p,matchUpFormat:a,matchUpStatus:d,scoreString:u});if(e.error)return e;c+=1}}}return{...ut,completedCount:c}}function mm({matchUpStatusCodes:t,drawDefinition:e,targetMatchUp:i,matchUpStatus:n,matchUpFormat:r,scoreString:a,winningSide:o}){if(!i||i.matchUpStatus===y)return;const{matchUpId:s}=i||{},{outcome:c}=cm({matchUpStatus:n,scoreString:a,winningSide:o});return t&&(c.matchUpStatusCodes=t),js({drawDefinition:e,matchUpFormat:r,matchUpId:s,outcome:c})}function fm(t){const{matchUpStatusProfile:e={},drawDefinition:i,matchUpStatus:n,matchUpFormat:r,targetMatchUp:a,scoreString:o,winningSide:s}=t;if(o||n)return mm(t);const{matchUpId:c}=a||{},{outcome:u}=dm({matchUpStatusProfile:e,matchUpFormat:r,winningSide:s});return js({matchUpFormat:r,drawDefinition:i,matchUpId:c,outcome:u})}function hm({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,event:a}){const{flightProfile:o}=Qo({event:a}),{eventName:s,eventType:c,category:u}=a,{startDate:d}=n,l=[],p=(null==u?void 0:u.categoryName)||(null==u?void 0:u.ageCategoryCode)||(null==u?void 0:u.ratingType);if(Array.isArray(null==o?void 0:o.flights))for(const[f,h]of o.flights.entries()){const{drawId:o,stage:u,drawName:I,drawEntries:v}=h;l.push(h.drawId);const g=r[f],{seedsCount:y,generate:U=!0}=g||{};if(U){var m;const l=v.filter(Jo).map(Ar),h=p||s;n&&y&&y<=l.length&&nt(1,y+1).forEach(((t,e)=>{let i={scaleValue:t,scaleName:h,scaleType:"SEEDING",eventType:c,scaleDate:d};const r=l[e];Zl({tournamentRecord:n,participantId:r,scaleItem:i})}));let U=Fp({...g,matchUpType:c,seedingScaleName:h,tournamentRecord:n,isMock:!0,drawEntries:v,drawName:I,drawId:o,event:a,stage:u});const{drawDefinition:w,error:S}=U;if(S)return{error:S};const N=null===(m=r[f])||void 0===m?void 0:m.drawExtensions;if(Array.isArray(N)&&N.filter(_r).forEach((t=>jr({element:w,extension:t}))),U=tc({drawDefinition:w,event:a}),"drawId exists"===U.error)break;if(U.error)return U;if(g.drawType===kn&&g.drawMatic){const t=g.roundsCount||1;for(const e of nt(1,t+1)){const t=Vp({generateMatchUps:!0,tournamentRecord:n,drawDefinition:w,roundNumber:e});if(t.error)return t}}if(null!=g&&g.withPlayoffs){const t=w.structures[0].structureId,e=_p({idPrefix:g.idPrefix,...g.withPlayoffs,tournamentRecord:n,drawDefinition:w,isMock:!0,structureId:t,event:a});if(null!=e&&e.error)return e}const P=null==g?void 0:g.completionGoal;if(!1!==(null==g?void 0:g.automated)&&(e||P)){const r=null==g?void 0:g.matchUpFormat,o=pm({matchUpStatusProfile:t,completeAllMatchUps:!P&&e,randomWinningSide:i,completionGoal:P,drawDefinition:w,matchUpFormat:r});if(o.error)return o;const s=o.completedCount;if((null==g?void 0:g.drawType)===Yn){let o=Mp({structureId:w.structures.find((t=>t.stage===An)).structureId,tournamentRecord:n,drawDefinition:w,event:a});if(o.error)return o;const c=P?P-s:void 0;if(o=pm({completeAllMatchUps:!P&&e,completionGoal:P?c:void 0,matchUpStatusProfile:t,randomWinningSide:i,drawDefinition:w,matchUpFormat:r}),o.error)return o}}}}return{...ut,drawIds:l}}function Im({ratingsParameters:t=Kl,valuesInstanceLimit:e,consideredDate:i,category:n,nationalityCodesCount:r,nationalityCodeType:a,nationalityCodes:o,participantsCount:s=32,participantType:c,personIds:u,idPrefix:d,uuids:l,personExtensions:p,addressProps:m,matchUpType:f,personData:h,sex:I,inContext:v,withISO:g,rankingRange:y=[1,100],scaledParticipantsCount:U}){const w=c===Oi||f===ii,S=c===Ci||f===Ci,N=s*(w?2:S?8:1),{nationalityCodes:P,persons:D,error:T}=Qp({count:N,personExtensions:p,consideredDate:i,personData:h,category:n,sex:I});if(T)return{error:T};let M=[],A=[],E=[],b=[];if("object"==typeof n){const{categoryName:e,ageCategoryCode:i,ratingType:r}=n;if(!e&&!i||r||(A=Z(nt(...y)).slice(0,U||W(20,30)),[Oi,Ci].includes(c)&&(M=Z(nt(...y)).slice(0,U||W(20,30)))),r&&t[r]){let{ratingMax:e,ratingMin:i,ratingAttributes:a}=n;const o=Object.assign({},t[r],a||{}),{attributes:s={},decimalsCount:u,accessors:d,range:l,step:p}=o,m=l[0]>l[1]?2:.5,[f,h]=l.slice().sort(),I=()=>nt(0,1e3).map((()=>K(f,h,m,u,p))).filter((t=>(!e||t<=e)&&(!i||t>=i))).slice(0,U||W(20,30)).map((t=>d?Object.assign({},...d.map((e=>({[e]:t}))),s):t));E=I(),[Oi,Ci].includes(c)&&(b=I())}}const R=Nn.filter((t=>"ISO"===a?t.iso:t.ioc)),{citiesCount:C,statesCount:O,postalCodesCount:L}=m||{},{cities:x}=rm({count:C||N,participantsCount:N}),{states:F}=am({count:O||N,participantsCount:N}),{postalCodes:k}=om({count:L||N,participantsCount:N}),_={cities:x,states:F,postalCodes:k},j=function(t){const i=Math.ceil(N/t);return e&&i>e?Math.ceil(N/e):t}(r),B=j?Z(R).slice(0,r):o?R.filter((t=>o.includes(t.key))):R,G=Z(nt(0,Math.ceil(N/(j||1))).map((()=>B)).flat(1/0)),V=em({count:s}).teams;return{participants:nt(0,s).map((t=>{const e=w?2:S?8:1,i=nt(0,e).map((i=>function(t){const e=D[t],{nationalityCode:i,participantExtensions:r,participantTimeItems:o,extensions:s,firstName:c,birthDate:p,lastName:m,personId:f,sex:h}=e||{},I=c||"GivenName",v=m||"FamilyName",y=`${I} ${v}`,U=G[t],w=(null==P?void 0:P.length)&&i||U&&("ISO"===a?U.iso:U.ioc||U.iso)||i;null==G||!G.length||w||i||console.log("%c Invalid Nationality Code",{participantIndex:t,country:U});const S=Xp({..._,participantIndex:t,nationalityCode:w}),N=fe({participantId:gm({participantType:Ri,index:t,idPrefix:d,uuids:l}),extensions:r,timeItems:o,participantRole:pu,participantType:Ri,participantName:y,person:{addresses:[S],personId:f||(null==u?void 0:u.length)&&u[t]||ve(),standardFamilyName:v,standardGivenName:I,nationalityCode:w,extensions:s,birthDate:Wt(p)?p:void 0,sex:h}});if(g&&w){const t=Nn.find((({ioc:t})=>t===w));null!=t&&t.iso&&(N.person.isoNationalityCode=t.iso),null!=t&&t.label&&(N.person.countryName=t.label)}if(n){const e=A[t],i=M[t];vm({scaleValue:e,eventType:Ii,scaleType:Ic,participant:N,category:n}),vm({scaleValue:i,eventType:ii,scaleType:Ic,participant:N,category:n});const r=E[t],a=b[t];vm({scaleValue:r,eventType:Ii,scaleType:hc,participant:N,category:n}),vm({scaleValue:a,eventType:ii,scaleType:hc,participant:N,category:n})}return N}(t*e+i))),r=i.map((t=>t.participantId)),o=i.map((t=>t.person.standardFamilyName)).join("/"),s=w?Oi:Ci,c={participantId:gm({participantType:s,idPrefix:d,index:t,uuids:l}),participantRole:pu,participantName:w?o:V[t],individualParticipantIds:r,participantType:s};return v&&(c.individualParticipants=i),w||S?[c,...i]:i})).flat()}}function vm({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){const a=r.categoryName||r.ratingType||r.ageCategoryCode,o={itemValue:t,itemType:[fc,n,i,a].join(".")};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function gm({idPrefix:t,participantType:e,index:i,uuids:n}){return t?`${t}-${e===Ri?"I":"P"}-${i}`:(null==n?void 0:n.pop())||ve()}function ym({tieFormat:t,tieFormatName:e,drawSize:i,alternatesCount:n=0}){var r,a;let o=0,s=0;null===(r=t="object"==typeof t?t:Dp({namedFormat:e}))||void 0===r||null===(a=r.collectionDefinitions)||void 0===a||a.forEach((t=>{if(t.collectionId||(t.collectionId=ve()),(null==t?void 0:t.matchUpType)===ii){const e=t.matchUpCount;o=Math.max(o,e)}if((null==t?void 0:t.matchUpType)===ei){const e=t.matchUpCount;s=Math.max(s,e)}}));const c=Math.max(s,2*o);return{maxDoublesDraw:o*(i+n),maxSinglesDraw:s*(i+n),teamSize:c}}function Um({participantsProfile:t={},tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){const{participantsCount:o,participantType:s,largestTeamDraw:c,largestTeamSize:u}=function({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=Ri}=t||{};const a=n||0;let o=0,s=0,c=0,u=0,d=0;const l=({alternatesCount:t=0,uniqueParticipants:e,tieFormatName:i,drawSize:n=0,eventType:r,tieFormat:a,category:l,gender:p,stage:m})=>{const f=r===vi,h=r===gi;if(e||m===En||l||p)d+=f?2*(n+t):n+t;else{if(h){u=Math.max(u,n+t),a="object"==typeof a?a:Dp({namedFormat:i});const{teamSize:e,maxDoublesDraw:r,maxSinglesDraw:d}=ym({alternatesCount:t,tieFormatName:i,tieFormat:a,drawSize:n});c=Math.max(c,e),o=Math.max(o,r),s=Math.max(s,d)}f&&n+t&&n+t>o&&(o=n+t),!f&&!h&&n&&n>s&&(s=n+t)}};if(null==e||e.forEach((t=>{const{tieFormatName:e,tieFormat:i,drawProfiles:n,eventType:r,category:a,gender:o}=t;if(n)for(const s of n){const{tieFormatName:t,tieFormat:n}=s;l({...s,tieFormatName:t||e,tieFormat:n||i,eventType:r,category:a,gender:o})}})),Array.isArray(i))for(const m of i)l(m);const p=Math.max(u*c,2*o,s);return o&&(r=Oi),(n||a)<p&&(n=p),n&&o&&[Oi,gi].includes(r)&&(s&&Math.floor(s/2)>o?n=Math.floor(s/2):(!s||2*o>=s)&&(n=Math.ceil(n/2))),void 0===n&&(n=null!=e&&e.length||null!=i&&i.length?0:32),n<a&&(n=a),{largestTeamDraw:u,largestTeamSize:c,participantsCount:n,participantType:r,uniqueParticipantsCount:d}}({participantsProfile:t,eventProfiles:i,drawProfiles:n}),{teamKey:d}=t||{},{participants:l}=Im({uuids:a,...t,consideredDate:r,participantsCount:o,participantType:s});let p=nc({tournamentRecord:e,participants:l});if(!p.success)return p;if(d){const t=op({tournamentRecord:e,...d});if(t.error)return t}const m=l.filter((({participantType:t})=>t===Ri)).map(Ar);return nc({tournamentRecord:e,participants:nt(0,c).map((t=>{const e=m.slice(t*u,(t+1)*u);return{participantName:`Team ${t+1}`,participantRole:pu,participantType:Ci,participantId:ve(),individualParticipantIds:e}}))})}function wm({participantsProfile:t={},uniqueParticipantsCount:e,ratingsParameters:i,tournamentRecord:n,eventProfile:r,eventIndex:a,event:o,uuids:s}){const{category:c,gender:u,eventType:d}=o,l=d===Ii?Ri:d===vi?Oi:d,p=(e[An]||0)+(e[En]||0),m=[sp,cp].includes(u)?u:void 0,f=null!=t&&t.idPrefix?`E-${a}-${null==t?void 0:t.idPrefix}`:void 0,{participants:h}=Im({uuids:r.uuids||s,...t,scaledParticipantsCount:r.scaledParticipantsCount,consideredDate:null==n?void 0:n.startDate,rankingRange:r.rankingRange,participantType:l,participantsCount:p,ratingsParameters:i,idPrefix:f,category:c,sex:m});let I=nc({participants:h,tournamentRecord:n});return I.error?I:{uniqueDrawParticipants:h.filter((({participantType:t})=>t===l)),uniqueParticipantIds:h.map(Ar)}}function Sm({drawProfiles:t,category:e,gender:i}){const n={},r=null==t?void 0:t.reduce(((t,r)=>{const{qualifyingPositions:a=0,participantsCount:o=0,uniqueParticipants:s,stage:c=An,drawSize:u=0}=r||{};Object.keys(t).includes(c)||(t[c]=0);const d=(o||u)-a;return s||i||e||c===En?(Object.keys(n).includes(c)||(n[c]=0),n[c]+=d):t[c]=Math.max(d,t[c]),t}),{}),a=Object.keys(n);return a.forEach((t=>r[t]+=n[t])),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function Nm({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){const r=e[An]||0,a=e[En]||0;return{stageParticipants:{QUALIFYING:n.filter((({participantType:t})=>t===i)).filter((({participantId:e})=>!t.includes(e))).slice(0,a),MAIN:n.filter((({participantType:t})=>t===i)).filter((({participantId:e})=>!t.includes(e))).slice(a,a+r)}}}function Pm({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){const{drawType:a=jn,qualifyingPositions:o=0,stage:s=An,drawSize:c=0,drawName:u,drawId:d}=n,l=c-o,p=i.slice(0,l).map(Ar);if(p.length){const i=al({participantIds:p,autoEntryPositions:t,tournamentRecord:e,stage:s,event:r});if(i.error)return i}const m=Hp({drawName:u||a,qualifyingPositions:o,drawEntries:p.map((t=>({entryStatus:Qr,entryStage:s,participantId:t}))),drawId:d,event:r,stage:s});return m.error?m:{...ut}}function Dm({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:o,event:s}){let c=0;for(const u of r){const{qualifyingPositions:r=0,uniqueParticipants:d,stage:l=An,drawSize:p=0}=u,m=p-r,f=d||o||a||l===En,h=f?t.slice(c,c+m):i[l||An]||[];f&&(c+=m);const I=Pm({autoEntryPositions:e,drawParticipants:h,tournamentRecord:n,drawProfile:u,event:s});if(I.error)return I}return{...ut}}function Tm({allUniqueParticipantIds:t,matchUpStatusProfile:e,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:r,randomWinningSide:a,ratingsParameters:o,tournamentRecord:s,eventProfile:c,eventIndex:u,publish:d,uuids:l}){let p=c.gender,m=c.eventName;const{eventType:f=Ii,policyDefinitions:h,drawProfiles:I=[],eventExtensions:v,surfaceCategory:g,tieFormatName:y,discipline:U,eventLevel:w,ballType:S,category:N}=c,P=c.tieFormat||(f===gi?Dp({namedFormat:y}):void 0);let D=s.participants;for(const B of I)!p&&B.gender&&(p=null==B?void 0:B.gender);const{stageParticipantsCount:T,uniqueParticipantsCount:M,uniqueParticipantStages:A}=Sm({drawProfiles:I,category:N,gender:p}),E=f===Ii?Ri:f===vi?Oi:f,{uniqueDrawParticipants:b=[],uniqueParticipantIds:R=[]}=A?wm({event:{eventType:f,category:N,gender:p},uniqueParticipantsCount:M,participantsProfile:i,ratingsParameters:o,tournamentRecord:s,eventProfile:c,eventIndex:u,uuids:l}):{};let{eventAttributes:C}=c;"object"!=typeof C&&(C={});const O=(null==N?void 0:N.categoryName)||(null==N?void 0:N.ageCategoryCode)||(null==N?void 0:N.ratingType),L=c.eventId||ve();m=m||O||"Generated Event";const x={...C,surfaceCategory:g,discipline:U,eventLevel:w,eventName:m,eventType:f,tieFormat:P,ballType:S,category:N,eventId:L,gender:p};if(null!=v&&v.length&&Array.isArray(v)){const t=v.filter(_r);null!=t&&t.length&&Object.assign(x,{extensions:t})}if("object"==typeof h)for(const B of Object.keys(h))Mu({policyDefinitions:{[B]:h[B]},event:x});let F=Tp({tournamentRecord:s,event:x});if(F.error)return F;const{event:k}=F,{stageParticipants:_}=Nm({allUniqueParticipantIds:t,stageParticipantsCount:T,eventParticipantType:E,targetParticipants:D});if(F=Dm({uniqueDrawParticipants:b,autoEntryPositions:r,stageParticipants:_,tournamentRecord:s,drawProfiles:I,category:N,gender:p,event:k}),F.error)return F;if(F=hm({completeAllMatchUps:n,matchUpStatusProfile:e,randomWinningSide:a,tournamentRecord:s,drawProfiles:I,event:k}),F.error)return F;const j=F.drawIds;return d&&fp({tournamentRecord:s,event:k}),{drawIds:j,eventId:L,uniqueParticipantIds:R}}function Mm({allUniqueParticipantIds:t=[],participantsProfile:e={},matchUpStatusProfile:i,completeAllMatchUps:n,autoEntryPositions:r,randomWinningSide:a,ratingsParameters:o,tournamentRecord:s,drawProfile:c,startDate:u,drawIndex:d,goesTo:l,uuids:p}){var m;const{excessParticipantAlternates:f=!0,matchUpFormat:h=v,drawType:I=jn,tournamentAlternates:g=0,alternatesCount:y=0,generate:U=!0,eventExtensions:S,drawExtensions:N,completionGoal:P,drawSize:D=32,tieFormatName:T,seedsCount:M,category:A,idPrefix:E,publish:b,gender:R,stage:C}=c,O=c.eventType||c.matchUpType||Ii,L="object"==typeof c.tieFormat?c.tieFormat:O===Ci?Dp({namedFormat:T}):void 0,x=(null==A?void 0:A.categoryName)||(null==A?void 0:A.ageCategoryCode)||(null==A?void 0:A.ratingType);let F=c.eventName||x||`Generated ${O}`,k=(null==s?void 0:s.participants)||[];const _=!c.participantsCount||c.participantsCount>D?D:c.participantsCount,j=ve();let B={eventName:F,eventType:O,tieFormat:L,category:A,eventId:j},{eventAttributes:G}=c;if("object"!=typeof G&&(G={}),Object.assign(B,G),null!=S&&S.length&&Array.isArray(S)){const t=S.filter(_r);null!=t&&t.length&&Object.assign(B,{extensions:t})}const V=[];if(c.uniqueParticipants||!s||R||A){let t,i=_+y;O===Ci&&(({teamSize:t}=ym({alternatesCount:y,tieFormatName:T,tieFormat:L,drawSize:D})),i=t*D);const n=null!=e&&e.idPrefix?`D-${d}-${null==e?void 0:e.idPrefix}`:void 0,r=O===vi?Oi:Ri,{participants:a}=Im({...e,scaledParticipantsCount:c.scaledParticipantsCount,participantsCount:i,consideredDate:null==s?void 0:s.startDate,sex:R||(null==e?void 0:e.sex),rankingRange:c.rankingRange,uuids:c.uuids||p,ratingsParameters:o,participantType:r,idPrefix:n,category:A});if(s){const t=nc({tournamentRecord:s,participants:a});if(t.error)return t}if(a.forEach((({participantId:t})=>V.push(t))),k=a,O===Ci){const e=a.filter((({participantType:t})=>t===Ri)).map(Ar),i=nt(0,D).map((i=>{const n=e.slice(i*t,(i+1)*t);return{participantName:`Team ${i+1}`,participantRole:pu,participantType:Ci,participantId:ve(),individualParticipantIds:n}})),n=nc({participants:i,tournamentRecord:s});if(!n.success)return n;k=i}}const H=t=>{const{participantType:e}=t;return O===Ii&&e===Ri||O===vi&&e===Oi||O===Ci&&e===Ci},q=t=>{var e,i;return!c.gender||(null===(e=t.person)||void 0===e?void 0:e.sex)===c.gender||!(null===(i=t.individualParticipantIds)||void 0===i||!i.some((t=>{const e=k.find((e=>e.participantId===t));return e&&q(e)})))||void 0},W=k.filter(H).filter(q).filter((({participantId:e})=>!t.includes(e))).slice(0,_).map((t=>t.participantId));if(null!=W&&W.length){const t=al({autoEntryPositions:r,entryStage:C,tournamentRecord:s,participantIds:W,event:B});if(t.error)return t}const z=f&&(null==s||null===(m=s.participants)||void 0===m?void 0:m.filter((({participantId:t})=>!W.includes(t))).filter(H).filter(q).slice(0,y||D-_||g).map((t=>t.participantId)));if(null!=z&&z.length){const t=al({participantIds:z,autoEntryPositions:!1,entryStatus:Yr,tournamentRecord:s,event:B});if(t.error)return{error:t.error}}const K=x||F;s&&M&&M<=W.length&&nt(1,M+1).forEach(((t,e)=>{let i={scaleValue:t,scaleName:K,scaleType:"SEEDING",eventType:O,scaleDate:u};const n=W[e];Zl({tournamentRecord:s,participantId:n,scaleItem:i})}));const{drawDefinition:Y,error:$}=Fp({...c,tournamentRecord:s,seedingScaleName:K,matchUpFormat:h,isMock:!0,eventId:j,goesTo:l,event:B});if($)return{error:$};const J=U?Y.drawId:void 0;if(Array.isArray(N)&&N.filter(_r).forEach((t=>jr({element:Y,extension:t}))),U){if(tc({drawDefinition:Y,event:B}),I===kn&&c.drawMatic){const t=c.roundsCount||1;for(const e of nt(1,t+1)){const t=Vp({generateMatchUps:!0,tournamentRecord:s,drawDefinition:Y,roundNumber:e});if(t.error)return t}}if(c.withPlayoffs){const t=Y.structures[0].structureId,e=_p({...c.withPlayoffs,tournamentRecord:s,drawDefinition:Y,isMock:!0,structureId:t,idPrefix:E,event:B});if(null!=e&&e.error)return e}if(!1!==c.automated){if(c.outcomes){const{matchUps:t}=ao({drawDefinition:Y,inContext:!0,event:B});for(const e of c.outcomes){const{roundNumber:i,drawPositions:n,roundPosition:r,scoreString:a,winningSide:o,stage:s=An,matchUpFormat:c,stageSequence:u=1,matchUpStatus:d=w,matchUpStatusCodes:l,matchUpIndex:p=0,structureOrder:m}=e,f=t.reduce(((t,e)=>{const{structureId:i,matchUpId:n}=e;return t[i]?t[i].push(n):t[i]=[n],t}),{}),h=Object.assign({},...Object.keys(f).map(((t,e)=>({[t]:e+1})))),I=t.filter((t=>!(s&&t.stage!==s||u&&t.stageSequence!==u||i&&t.roundNumber!==i||r&&t.roundPosition!==r||m&&h[t.structureId]!==m||n&&2!==at(n,t.drawPositions).length)))[p],v=mm({matchUpStatusCodes:l,drawDefinition:Y,targetMatchUp:I,matchUpFormat:c,matchUpStatus:d,scoreString:a,winningSide:o,drawId:J});if(null!=v&&v.error)return v}}if(n||P){const t=pm({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:a,completionGoal:P,drawDefinition:Y,matchUpFormat:h});if(t.error)return t;const e=t.completedCount;if(I===Yn){let t=Mp({structureId:Y.structures.find((t=>t.stage===An)).structureId,tournamentRecord:s,drawDefinition:Y,event:B});const r=P?P-e:void 0;if(t=pm({completionGoal:P?r:void 0,matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:a,drawDefinition:Y,matchUpFormat:h}),t.error)return t}}}b&&fp({tournamentRecord:s,event:B})}return{...ut,event:fe(B),uniqueParticipantIds:V,targetParticipants:k,drawDefinition:Y,eventId:j,drawId:J}}function Am({tournamentRecord:t,venueProfiles:e}){const{startDate:i,endDate:n}=t;let r=[];for(const[a,o]of e.entries()){let{venueAbbreviation:e,venueId:s=ve(),dateAvailability:c,startTime:u="07:00",endTime:d="19:00",courtsCount:l,courtNames:p,venueName:m,courtIds:f}=o,h=ec({tournamentRecord:t,venue:{venueName:m||`Venue ${a+1}`,venueAbbreviation:e,venueId:s}});if(h.error)return h;r.push(s);const I=Jt(i,n);if(c=!Array.isArray(c)&&I.map((t=>({date:Kt(t),startTime:u,endTime:d})))||c,h=Js({tournamentRecord:t,dateAvailability:c,courtsCount:l,courtNames:p,courtIds:f,venueId:s}),h.error)return h}return r}const Em={anonymizeTournamentRecord:function({tournamentRecord:t,tournamentName:e,personIds:i=[],tournamentId:n}){if(!t)return{error:pt};t.tournamentId=n||ve(),t.createdAt=(new Date).toISOString(),t.tournamentName=e||`Anonymized Tournament ${Kt(new Date)}`,delete t.parentOrganisation;const r=t.startDate||Kt(new Date),a=(t.participants||[]).filter((({participantType:t})=>t===Ri)),o=a.reduce(((t,e)=>{var i;const n=null===(i=e.person)||void 0===i?void 0:i.sex;return[sp,cp].includes(n)?t[n]+=1:t.OTHER+=1,t}),{[sp]:0,[cp]:0,OTHER:0}),s=Object.assign({},...Object.keys(o).map((t=>{var e;return{[t]:(null===(e=Qp({category:{ageCategoryCode:"O18"},count:o[t],addressProps:{citiesCount:10},personExtensions:[],consideredDate:r,sex:t}))||void 0===e?void 0:e.persons)||[]}}))),c={[sp]:0,[cp]:0,OTHER:0},u=a.length,d=a.reduce(((t,e)=>{var i,n;const r=(null===(i=e.person)||void 0===i||null===(n=i.addresses)||void 0===n?void 0:n[0])||{},{city:a,state:o,postalCode:s}=r;return t.cities.includes(a)||t.cities.push(a),t.states.includes(o)||t.states.push(o),t.postalCodes.includes(s)||t.postalCodes.push(s),t}),{cities:[],postalCodes:[],states:[]}),l=d.postalCodes.length,p=d.cities.length,m=d.states.length,{cities:f}=rm({count:p||u,participantsCount:u}),{states:h}=am({count:m||u,participantsCount:u}),{postalCodes:I}=om({count:l||u,participantsCount:u}),v={cities:f,states:h,postalCodes:I};a.forEach(((t,e)=>{var n;const r=null==t?void 0:t.person,a=(null==r?void 0:r.sex)||"OTHER",o=null==r||null===(n=r.birthDate)||void 0===n?void 0:n.split("-").reverse()[0],u=c[a],d=s[a][u];if(c[a]+=1,o){var l;const[,t,e]=(null==d||null===(l=d.birthDate)||void 0===l?void 0:l.split("-"))||[],i=[o,t,e].join("-");d.birthDate=i}if(r.addresses){const t=Xp({...v,participantIndex:e,nationalityCode:d.nationalityCode});d.addresses=[t]}d.personId=(null==i?void 0:i[e])||ve(),d.standardFamilyName=d.lastName,d.standardGivenName=d.firstName,delete d.firstName,delete d.lastName,t.person=d,t.participantName=`${d.standardGivenName} ${d.standardFamilyName}`})),(t.participants||[]).filter((({participantType:t})=>t===Oi)).forEach((t=>{const{individualParticipantIds:e}=t;t.participantName=function({individualParticipantIds:t,individualParticipants:e}){let i=e.filter((({participantId:e})=>t.includes(e))).map((({person:t})=>null==t?void 0:t.standardFamilyName)).filter(Boolean).sort().join("/");return 1===t.length&&(i+="/Unknown"),i}({individualParticipantIds:e,individualParticipants:a})}));const g=(t.participants||[]).filter((({participantType:t})=>t===Ci)),y=em({count:g.length}).teams;return g.forEach(((t,e)=>{t.participantName=y[e]})),{...ut}},modifyTournamentRecord:function({ratingsParameters:t=Kl,participantsProfile:e={},matchUpStatusProfile:i,completeAllMatchUps:n,autoEntryPositions:r,randomWinningSide:a,schedulingProfile:o,tournamentRecord:s,eventProfiles:c,venueProfiles:u,autoSchedule:d,drawProfiles:l,goesTo:p,uuids:m}){var f;if(!s)return{error:pt};const h=[],I=[],v=[];null==c||c.forEach((t=>{const e=s.events.find(((e,i)=>void 0!==t.eventIndex&&i===t.eventIndex||t.eventName&&e.eventName===t.eventName||t.eventId&&e.eventId===t.eventId));null!=e&&e.gender&&(t.gender=e.gender)}));const g=(null===(f=s.participants)||void 0===f?void 0:f.length)||void 0;g&&null!=e&&e.idPrefix&&(e.idPrefix=`${e.idPrefix}-${g}`);const y=Um({startDate:s.startDate,participantsProfile:e,tournamentRecord:s,eventProfiles:c,drawProfiles:l,uuids:m});if(!y.success)return y;if(c){var U;let t=(null===(U=s.events)||void 0===U?void 0:U.length)||0;for(const o of c){let{ratingsParameters:c}=o;const u=s.events.find(((t,e)=>void 0!==o.eventIndex&&e===o.eventIndex||o.eventName&&t.eventName===o.eventName||o.eventId&&t.eventId===o.eventId));if(u){const{gender:t,category:d,eventType:l}=u,{drawProfiles:p,publish:f}=o,I=l===Ii?cc:l===vi?uc:l;if(p){const{stageParticipantsCount:f,uniqueParticipantsCount:g,uniqueParticipantStages:y}=Sm({drawProfiles:p,category:d,gender:t}),{uniqueDrawParticipants:U=[],uniqueParticipantIds:w=[]}=y?wm({event:{eventType:l,category:d,gender:t},uniqueParticipantsCount:g,participantsProfile:e,ratingsParameters:c,tournamentRecord:s,eventProfile:o,uuids:m}):{};h.push(...w);const{stageParticipants:S}=Nm({targetParticipants:s.participants||[],allUniqueParticipantIds:h,stageParticipantsCount:f,eventParticipantType:I});let N=Dm({uniqueDrawParticipants:U,autoEntryPositions:r,stageParticipants:S,tournamentRecord:s,drawProfiles:p,category:d,gender:t,event:u});if(N.error)return N;if(N=hm({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:a,tournamentRecord:s,drawProfiles:p,event:u}),N.error)return N;v.push(...N.drawIds)}f&&fp({tournamentRecord:s,event:u})}else{const{error:u,eventId:d,drawIds:l,uniqueParticipantIds:p}=Tm({startDate:s.startDate,allUniqueParticipantIds:h,matchUpStatusProfile:i,participantsProfile:e,completeAllMatchUps:n,autoEntryPositions:r,randomWinningSide:a,ratingsParameters:c,tournamentRecord:s,eventProfile:o,eventIndex:t,uuids:m});if(u)return{error:u};l&&v.push(...l),I.push(d),null!=p&&p.length&&h.push(...p),t+=1}}}if(l){let o=(s.events||[]).map((t=>{var e;return(null===(e=t.drawDefinitions)||void 0===e?void 0:e.map((()=>1)))||[]})).flat().reduce(((t,e)=>t+e),0);for(const c of l){const{drawId:u,eventId:d,event:l,error:f,uniqueParticipantIds:g}=Mm({startDate:s.startDate,allUniqueParticipantIds:h,matchUpStatusProfile:i,participantsProfile:e,completeAllMatchUps:n,autoEntryPositions:r,randomWinningSide:a,ratingsParameters:t,tournamentRecord:s,drawProfile:c,drawIndex:o,goesTo:p,uuids:m});if(f)return{error:f};const y=Tp({tournamentRecord:s,event:l});if(y.error)return y;u&&v.push(u),I.push(d),null!=g&&g.length&&h.push(...g),o+=1}}const w=null!=u&&u.length?Am({tournamentRecord:s,venueProfiles:u}):[];let S,N={};if(o){const t=au({schedulingProfile:o,tournamentRecord:s});if(t.error)return t;if(S=t.scheduledRounds,d){const{tournamentId:t}=s;N=ou({tournamentRecords:{[t]:s}})}}return{...ut,drawIds:v,eventIds:I,venueIds:w,scheduledRounds:S,schedulerResult:N}}},bm={generateOutcomeFromScoreString:cm,generateTournamentRecord:function({scheduleCompletedMatchUps:t,ratingsParameters:e=Kl,tournamentName:i="Mock Tournament",tournamentExtensions:n,tournamentAttributes:r,matchUpStatusProfile:a,participantsProfile:o,completeAllMatchUps:s,autoEntryPositions:c,randomWinningSide:u,policyDefinitions:d,schedulingProfile:l,eventProfiles:p,venueProfiles:m,drawProfiles:f,autoSchedule:h,startDate:I,endDate:v,goesTo:g,uuids:y}={}){if(I&&!Wt(I)||v&&!Wt(v))return{error:vt};if(p&&!Array.isArray(p))return{error:gt};if(!I){const t=new Date;I=Kt(v||t),v=Kt(t.setDate(t.getDate()+7))}if(!v){const t=new Date(I);v=Kt(t.setDate(t.getDate()+7))}"object"!=typeof r&&(r={});const U=ep({...r,tournamentName:i,startDate:I,endDate:v});if(null!=n&&n.length&&Array.isArray(n)){const t=n.filter(_r);null!=t&&t.length&&Object.assign(U,{extensions:t,isMock:!0})}if("object"==typeof d)for(const A of Object.keys(d))Tu({policyDefinitions:{[A]:d[A]},tournamentRecord:U});const w=Um({participantsProfile:o,tournamentRecord:U,eventProfiles:p,drawProfiles:f,startDate:I,uuids:y});if(!w.success)return w;const S=[],N=[],P=[];if(Array.isArray(f)){let t=0;for(const i of f){const{drawId:n,eventId:r,event:d,error:l,uniqueParticipantIds:p}=Mm({allUniqueParticipantIds:P,matchUpStatusProfile:a,participantsProfile:o,completeAllMatchUps:s,autoEntryPositions:c,randomWinningSide:u,ratingsParameters:e,tournamentRecord:U,drawProfile:i,startDate:I,drawIndex:t,goesTo:g,uuids:y});if(l)return{error:l};const m=Tp({tournamentRecord:U,event:d});if(m.error)return m;n&&S.push(n),N.push(r),null!=p&&p.length&&P.push(...p),t+=1}}if(p){let t=0;for(const i of p){const{error:n,eventId:r,drawIds:d,uniqueParticipantIds:l}=Tm({allUniqueParticipantIds:P,matchUpStatusProfile:a,participantsProfile:o,completeAllMatchUps:s,autoEntryPositions:c,randomWinningSide:u,ratingsParameters:e,tournamentRecord:U,eventProfile:i,eventIndex:t,startDate:I,uuids:y});if(n)return{error:n};d&&S.push(...d),N.push(r),null!=l&&l.length&&P.push(...l),t+=1}}const D=null!=m&&m.length?Am({tournamentRecord:U,venueProfiles:m,uuids:y}):[];let T,M={};if(l){const e=function({schedulingProfile:t,tournamentRecord:e}){if("object"!=typeof t)return{error:gt};const i=hs({tournamentRecord:e}).containedStructures,{matchUps:n}=ro({tournamentRecord:e}),{tournamentId:r}=e,a=[];for(const o of t){const{scheduleDate:t,venues:s=[]}=o;for(const o of s){const{rounds:s,venueId:c}=o;for(const o of s){const{drawId:s,winnerFinishingPositionRange:u,roundSegment:d}=o,l=n.filter((t=>{var e;const i=(null==u?void 0:u.indexOf("-"))>0&&u.split("-").map((t=>+t)),n=null===(e=t.finishingPositionRange)||void 0===e?void 0:e.winner;return!(t.drawId!==s||o.roundNumber&&t.roundNumber!==o.roundNumber||n&&i&&2!==at(n,i).length)}))[0];if(l){const{eventId:n,roundNumber:o,drawName:p,structureName:m,roundName:f}=l;let h=l.structureId;o&&!u&&(h=Object.keys(i).find((t=>i[t].includes(h)))||h);const I={tournamentId:r,structureId:h,roundNumber:o,roundSegment:d,eventId:n,drawId:s};let v=Ro({tournamentRecords:{[r]:e},round:I,scheduleDate:t,venueId:c});if(v.error)return v;a.push({structureName:m,roundName:f,drawName:p,...I})}}}}return{scheduledRounds:a}}({schedulingProfile:l,tournamentRecord:U});if(e.error)return e;if(T=e.scheduledRounds,h){const{tournamentId:e}=U;M=ou({scheduleCompletedMatchUps:t,tournamentRecords:{[e]:U}})}}return fe({tournamentRecord:U,scheduledRounds:T,schedulerResult:M,eventIds:N,venueIds:D,drawIds:S})},generateEventWithDraw:Mm,generateParticipants:Im,parseScoreString:sm,generateOutcome:dm,credits:Eu};let Rm=!1;const Cm=function(){const t={version:()=>"0.74.1",setDeepCopy:(e,i)=>(Mt(e,i),t),devContext:e=>(Dt(e),Rm=!0,t)};return[Em,bm].forEach((e=>{Object.keys(e).forEach((i=>{t[i]=t=>{try{return function(t,e){const i=t({...e});return null!=i&&i.error||bc(),bt(),Rm&&(Dt(!1),Rm=!1),i}(e[i],t)}catch(e){const r=e.toString();console.log("ERROR",{error:r,method:i,params:JSON.stringify(t)}),console.log(e)}}}))})),t}(),Om={activeMatchUpStatuses:F,auditConstants:{DELETE_EVENTS:"deleteEvents",DELETE_DRAW_DEFINITIONS:"deleteDrawDefinitions"},directingMatchUpStatuses:O,drawDefinitionConstants:Qn,entryStatusConstants:ua,errorConditionConstants:Ut,eventConstants:yi,extensionConstants:He,flightConstants:{SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:"splitWaterfall",SPLIT_SHUTTLE:"splitShuttle"},genderConstants:up,keyValueConstants:sn,matchUpActionConstants:{END:"END",NICKNAME:"NICKNAME",PENALTY:"PENALTY",REFEREE:"REFEREE",SCHEDULE:"SCHEDULE",SCORE:"SCORE",START:"START",STATUS:"STATUS"},matchUpStatusConstants:_,matchUpTypes:ri,nonDirectingMatchUpStatuses:L,participantConstants:mc,participantRoles:mu,particicipantsRequiredMatchUpStatuses:R,participantTypes:xi,penaltyConstants:{COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},policyConstants:{POLICY_TYPE_ROUND_ROBIN_TALLY:"roundRobinTally",POLICY_TYPE_POSITION_ACTIONS:"positionActions",POLICY_TYPE_RANKING_POINTS:"rankingPoints",POLICY_TYPE_ROUND_NAMING:"roundNaming",POLICY_TYPE_PARTICIPANT:"participant",POLICY_TYPE_SCHEDULING:"scheduling",POLICY_TYPE_AVOIDANCE:"avoidance",POLICY_TYPE_SEEDING:"seeding",POLICY_TYPE_SCORING:"scoring",POLICY_TYPE_DRAWS:"draws"},positionActionConstants:{ALTERNATE_PARTICIPANT:"ALTERNATE",WITHDRAW_PARTICIPANT:"WITHDRAW",ASSIGN_PARTICIPANT:"ASSIGN",LUCKY_PARTICIPANT:"LUCKY",REMOVE_ASSIGNMENT:"REMOVE",SWAP_PARTICIPANTS:"SWAP",ADD_NICKNAME:"NICKNAME",ADD_PENALTY:"PENALTY",ASSIGN_BYE:"BYE",SEED_VALUE:"SEED_VALUE"},ratingConstants:zl,recoveryTimeRequiredMatchUpStatuses:b,requestConstants:{DO_NOT_SCHEDULE:"DO_NOT_SCHEDULE"},resultConstants:dt,scaleConstants:vc,scheduleConstants:oi,surfaceConstants:{CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},tieFormatConstants:{COLLEGE_D3:"COLLEGE_D3",COLLEGE_DEFAULT:"COLLEGE_DEFAULT",COLLEGE_JUCO:"COLLEGE_JUCO",DOMINANT_DUO:"DOMINANT_DUO",LAVER_CUP:"LAVER_CUP",TEAM_DOUBLES_3_AGGREGATION:"TEAM_DOUBLES_3_AGGREGATION"},timeItemConstants:Fe,topicConstants:{ADD_DRAW_DEFINITION:"addDrawDefinition",ADD_MATCHUPS:"addMatchUps",ADD_PARTICIPANTS:"addParticipants",ADD_VENUE:"addVenue",AUDIT:"audit",DELETED_DRAW_IDS:"deletedDrawIds",DELETE_PARTICIPANTS:"deleteParticipants",DELETE_VENUE:"deleteVenue",DELETED_MATCHUP_IDS:"deletedMatchUpIds",MODIFY_DRAW_DEFINITION:"modifyDrawDefinition",MODIFY_MATCHUP:"modifyMatchUp",MODIFY_PARTICIPANTS:"modifyParticipants",MODIFY_VENUE:"modifyVenue",PUBLISH_EVENT:"publishEvent"},upcomingMatchUpStatuses:k,validMatchUpStatuses:C,venueConstants:{INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"}};var Lm={chunkArray:st,countValues:function(t){return e=Q(t),Object.keys(e).reduce(((t,i)=>{const n=e[i];return t[n]?t[n].push(i):t[n]=[i],t}),{});var e},dateRange:Jt,dateTime:pe,garman:cr,generateHashCode:function(t){if(null===t||"object"!=typeof t)return;const e=JSON.stringify(t),i=he(t),n=e.split("").reduce(((t,e)=>t+e.charCodeAt(0)),0);return[e.length,i,n].map((t=>t.toString(36))).join("")},generateRange:nt,generateTimeCode:$,instanceCount:Q,intersection:at,isNumeric:H,isPowerOf2:G,JSON2CSV:function(t,e){if(e&&"object"!=typeof e)return gt;const{includeTransoformAccessors:i,columnAccessors:n=[],columnTransform:r={},columnMap:a={},valuesMap:o={},context:s={},delimiter:c='"',columnJoiner:u=",",rowJoiner:d="\r\n",keyJoiner:l="."}=e||{};if(!Array.isArray(t)||!Array.isArray(n)||"object"!=typeof s||"object"!=typeof a||"object"!=typeof r||"object"!=typeof o||"string"!=typeof u||"string"!=typeof d||"string"!=typeof l||"string"!=typeof c)return gt;const p=t.filter(Boolean).map((t=>dr(t,l))),m=Object.values(r).flat();i&&n.push(...m);const f=p.reduce(((t,e)=>Object.keys(e).every((e=>!t.includes(e)&&t.push(e)||!0))&&t),[]).filter((t=>!(null!=n&&n.length)||n.includes(t))),h=Object.assign({},...Object.keys(r).map((t=>r[t].map((e=>({[e]:t}))).flat())).flat()),I=f.reduce(((t,e)=>{const i=h[e];return i?t.includes(i)||t.push(i):t.push(e),t}),[]);Object.keys(a).forEach((t=>!I.includes(t)&&I.unshift(t))),Object.keys(r).forEach((t=>!I.includes(t)&&I.unshift(t))),"object"==typeof s&&Object.keys(s).forEach((t=>!I.includes(t)&&I.unshift(t)));const v=I.map((t=>a[t]||t)),g=t=>`${c}${t}${c}`,y=p.map((t=>Object.values(I.reduce(((e,i)=>{var n;const a=r[i],c=(null!=a&&a.length?t[a.find((e=>t[e]))]:t[i])||(null==s?void 0:s[i])||"",u=(null===(n=o[i])||void 0===n?void 0:n[c])||c;return e[i]=g(u),e}),{})).join(u)));return[v.map(g).join(u),...y].join(d)},makeDeepCopy:me,nearestPowerOf2:V,numericSort:Ie,overlap:ot,parseAgeCategoryCode:ur,randomMember:it,randomPop:et,shuffleArray:Z,unique:J,UUID:ve,UUIDS:function(t=1){return nt(0,t).map(ve)}}}}]);