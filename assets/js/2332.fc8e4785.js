"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[2332],{7942:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>f});var i=r(959);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r,i,n={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var c=i.createContext({}),u=function(e){var t=i.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},d=function(e){var t=u(e.components);return i.createElement(c.Provider,{value:t},e.children)},l="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),l=u(r),m=n,f=l["".concat(c,".").concat(m)]||l[m]||p[m]||a;return r?i.createElement(f,o(o({ref:t},d),{},{components:r})):i.createElement(f,o({ref:t},d))}));function f(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,o=new Array(a);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[l]="string"==typeof e?e:n,o[1]=s;for(var u=2;u<a;u++)o[u]=r[u];return i.createElement.apply(null,o)}return i.createElement.apply(null,r)}m.displayName="MDXCreateElement"},6664:(e,t,r)=>{r.d(t,{C9:()=>Db,M6:()=>_E,QO:()=>xE,SX:()=>GE,iV:()=>CE,rj:()=>dE});var i=Object.defineProperty,n=(e,t)=>{for(var r in t)i(e,r,{get:t[r],enumerable:!0})};var a={};n(a,{competitionGovernor:()=>o,drawsGovernor:()=>_o,entriesGovernor:()=>dT,eventGovernor:()=>wT,generationGovernor:()=>ib,matchUpFormatGovernor:()=>Db,matchUpGovernor:()=>Tb,mocksGovernor:()=>_R,participantGovernor:()=>nN,policyGovernor:()=>dP,publishingGovernor:()=>CN,queryGovernor:()=>vP,reportGovernor:()=>jN,scheduleGovernor:()=>YN,scoreGovernor:()=>gy,tieFormatGovernor:()=>cA,tournamentGovernor:()=>AA,venueGovernor:()=>jA});var o={};n(o,{getLinkedTournamentIds:()=>xo,getTournamentIds:()=>ro,linkTournaments:()=>Co,mutate:()=>s,query:()=>ko,unlinkTournament:()=>Fo,unlinkTournaments:()=>Oo});var s={};n(s,{linkTournaments:()=>Co,unlinkTournament:()=>Fo,unlinkTournaments:()=>Oo});function c(e){return"function"==typeof e}function u(e){return"string"==typeof e}function d(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function l(e,t){if(!d(e)||!d(t))return!1;let r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(let n of r)if(e[n]!==t[n])return!1;return!0}function p(e,t){return Array.isArray(e)?Object.assign({},...(e??[]).filter(d).map((e=>e[t]&&{[e[t]]:e})).filter(Boolean)):{}}n({},{addNotice:()=>ki,callListener:()=>ji,createInstanceState:()=>Si,cycleMutationStatus:()=>Fi,deepCopyEnabled:()=>Ni,deleteNotice:()=>Li,deleteNotices:()=>Vi,disableNotifications:()=>bi,enableNotifications:()=>Ri,getDevContext:()=>wi,getMethods:()=>xi,getNotices:()=>_i,getProvider:()=>Ki,getTopics:()=>Bi,getTournamentId:()=>Gi,getTournamentRecord:()=>qi,getTournamentRecords:()=>$i,globalLog:()=>Ji,handleCaughtError:()=>Qi,removeTournamentRecord:()=>Yi,setDeepCopy:()=>Mi,setDevContext:()=>Ti,setGlobalLog:()=>Di,setGlobalMethods:()=>Ci,setGlobalSubscriptions:()=>Ai,setMethods:()=>Oi,setStateMethods:()=>Xi,setStateProvider:()=>yi,setSubscriptions:()=>Ei,setTournamentId:()=>zi,setTournamentRecord:()=>Wi,setTournamentRecords:()=>Hi,timeKeeper:()=>Pi});var m=e=>t=>Object.keys(e).every((r=>t[r]===e[r]));function f(e,t){if(void 0===e)return null;if("object"!=typeof e||null===e)return e;let r=Object.keys(e),i=e=>void 0===e?null:e;return Object.assign({},...r.map((r=>Array.isArray(e[r])?{[r]:t?e[r]:e[r].map((e=>f(e)))}:{[r]:t?i(e[r]):f(e[r])})))}function h(e){return Array.isArray(e)?e.length+e.map(h).reduce(((e,t)=>e+t),0):"object"==typeof e&&null!==e?Object.keys(e).length+Object.keys(e).map((t=>h(e[t]))).reduce(((e,t)=>e+t),0):0}function g(e){if(null===e||"object"!=typeof e)return;let t=JSON.stringify(e),r=h(e),i=t.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0);return[t.length,r,i].map((e=>e.toString(36))).join("")}var I={success:!0},U={SUCCESS:I,ERROR:"error"},v={message:"Chronological error; time violation.",code:"ANACHRONISM"},y={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},S={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},w={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},P={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},D={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},T={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},b={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},R={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},M={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},N={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},A={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},E={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},C={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},O={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},F={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},k={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},x={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},_={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},L={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},V={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},B={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},j={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},G={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},q={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},$={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},W={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},H={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},z={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},Y={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},K={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Q={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},J={message:"Invalid action",code:"ERR_INVALID_ACTION"},X={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},Z={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},ee={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},te={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},re={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},ie={message:"Existing round",code:"ERR_EXISTING_ROUND"},ne={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},ae={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},oe={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},se={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},ce={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},ue={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},de={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},le={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},pe={message:"Event exists",code:"ERR_EXISTING_EVENT"},me={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},fe={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},he={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},ge={message:"Missing stage",code:"ERR_MISSING_STAGE"},Ie={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Ue={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},ve={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},ye={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},Se={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},we={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},Pe={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},De={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Te={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},be={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Re={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Me={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Ne={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Ae={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Ee={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Ce={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Oe={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Fe={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},ke={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},xe={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},_e={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Le={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},Ve={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},Be={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},je={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Ge={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},qe={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},$e={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},We={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},He={message:"Missing value",code:"ERR_MISSING_VALUE"},ze={message:"Missing date",code:"ERR_MISSING_DATE"},Ye={message:"No valid dates",code:"ERR_NO_VALID_DATES"},Ke={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},Qe={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Je={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Xe={message:"Invalid Date",code:"ERR_INVALID_DATE"},Ze={message:"Invalid time",code:"ERR_INVALID_TIME"},et={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},tt={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},rt={message:"Invalid score",code:"ERR_INVALID_SCORE"},it={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},nt={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},at={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},ot={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},st={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},ct={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},ut={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},dt={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},lt={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},pt={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},mt={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},ft={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},ht={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},gt={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},It={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Ut={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},vt={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},yt={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},St={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},wt={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},Pt={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},Dt={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},Tt={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},bt={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},Rt={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},Mt={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},Nt={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},At={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Et={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},Ct={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},Ot={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},Ft={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},kt={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},xt={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},_t={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},Lt={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},Vt={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},Bt={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},jt={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},Gt={message:"Court exists",code:"ERR_EXISTING_COURT"},qt={message:"Venue exists",code:"ERR_EXISTING_VENUE"},$t={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Wt={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},Ht={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},zt={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},Yt={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Kt={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Qt={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},Jt={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Xt={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},Zt={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},er={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},tr={message:"Missing context",code:"ERR_MISSING_CONTEXT"},rr={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},ir={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},nr={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},ar={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},or={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},sr={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},cr={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},ur={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},dr={message:"Invalid object",code:"ERR_INVALID_OBJECT"},lr={message:"Invalid gender",code:"ERR_INVALID_GENDER"},pr={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},mr={message:"Invalid values",code:"ERR_INVALID_VALUES"},fr={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},hr={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},gr={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},Ir={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},Ur={message:"Value unchanged",code:"ABORT_UNCHANGED"},vr={message:"Not found",code:"ERR_NOT_FOUND"},yr={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Sr={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},wr={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Pr={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Dr={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},Tr={message:"Existing stage",code:"ERR_EXISTING_STAGE"},br={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},Rr={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Mr={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},Nr={message:"Scores present",code:"ERR_SCORES_PRESENT"},Ar={ANACHRONISM:v,CANNOT_CHANGE_WINNING_SIDE:ct,CANNOT_MODIFY_TIEFORMAT:at,CANNOT_MODIFY_PARTICIPANT_TYPE:ot,CANNOT_REMOVE_MAIN_STRUCTURE:S,CANNOT_REMOVE_PARTICIPANTS:st,COURT_EXISTS:Gt,COURT_NOT_FOUND:jt,DRAW_DEFINITION_NOT_FOUND:A,DRAW_ID_EXISTS:z,DRAW_POSITION_ACTIVE:V,DRAW_POSITION_ASSIGNED:F,DRAW_POSITION_NOT_CLEARED:x,DRAW_POSITION_NOT_FOUND:{message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},DRAW_SIZE_MISMATCH:$,DUPLICATE_ENTRY:y,DUPLICATE_VALUE:fr,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:Ot,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:Ct,EVENT_EXISTS:pe,EVENT_NOT_FOUND:le,EXISTING_DRAW_DEFINITIONS:N,EXISTING_END_TIME:zt,EXISTING_FLIGHT:Sr,EXISTING_MATCHUP_ID:Dr,EXISTING_OUTCOME:Pr,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:Tt,EXISTING_PARTICIPANT:bt,EXISTING_POLICY_TYPE:je,EXISTING_PROFILE:wr,EXISTING_ROUND:ie,EXISTING_STAGE:Tr,EXISTING_STRUCTURE:br,INCOMPATIBLE_MATCHUP_STATUS:Pe,INCOMPLETE_SOURCE_STRUCTURE:C,INSUFFICIENT_DRAW_POSITIONS:xt,INVALID_ACTION:J,INVALID_ASSIGNMENT:X,INVALID_BOOKINGS:Ke,INVALID_CATEGORY:pr,INVALID_COLLECTION_DEFINITION:ur,INVALID_CONFIGURATION:cr,INVALID_DATE_AVAILABILITY:Qe,INVALID_DATE:Xe,INVALID_DRAW_DEFINITION:R,INVALID_DRAW_POSITION_FOR_SEEDING:O,INVALID_DRAW_POSITION:B,INVALID_DRAW_SIZE:q,INVALID_END_TIME:Ht,INVALID_ENTRIES:fe,INVALID_EVENT_TYPE:ue,INVALID_GAME_SCORES:tt,INVALID_GENDER:lr,INVALID_MATCHUP_FORMAT:be,INVALID_MATCHUP_STATUS:De,INVALID_MATCHUP_STATUS_BYE:ye,INVALID_MATCHUP:ke,INVALID_OBJECT:dr,INVALID_PARTICIPANT_ID:dt,INVALID_PARTICIPANT_IDS:lt,INVALID_PARTICIPANT_ROLE:pt,INVALID_PARTICIPANT_SEEDING:Y,INVALID_PARTICIPANT_TYPE:mt,INVALID_PARTICIPANT:ut,INVALID_POLICY_DEFINITION:Be,INVALID_RECORDS:w,INVALID_SCALE_ITEM:ir,INVALID_SEED_NUMBER:ee,INVALID_SEED_POSITION:te,INVALID_SET_NUMBER:{message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},INVALID_SIDE_NUMBER:qe,INVALID_SCORE:rt,INVALID_STAGE:Ie,INVALID_START_TIME:Kt,INVALID_STRUCTURE:E,INVALID_STOP_TIME:Yt,INVALID_TIE_FORMAT:Te,INVALID_TIME:Ze,INVALID_TIME_ITEM:Jt,INVALID_TOURNAMENT_DATES:et,INVALID_TOURNAMENT_RECORD:T,INVALID_VALUES:mr,INVALID_WINNING_SIDE:it,MATCHUP_NOT_FOUND:Ce,METHOD_NOT_FOUND:Rr,MISSING_ASSIGNMENTS:he,MISSING_ASYNC_STATE_PROVIDER:Xt,MISSING_AVOIDANCE_POLICY:Le,MISSING_COLLECTION_DEFINITION:Me,MISSING_COURT_ID:We,MISSING_COURTS_INFO:Bt,MISSING_DATE_AVAILABILITY:Je,MISSING_DATE:ze,MISSING_DRAW_DEFINITION:M,MISSING_DRAW_ID:H,MISSING_DRAW_POSITION:j,MISSING_DRAW_POSITIONS:L,MISSING_DRAW_SIZE:W,MISSING_ENTRIES:me,MISSING_EVENT:de,MISSING_MATCHUP_FORMAT:Re,MISSING_MATCHUP_ID:Ae,MISSING_MATCHUP_IDS:Ee,MISSING_MATCHUP:Fe,MISSING_MATCHUPS:Oe,MISSING_PARTICIPANT_COUNT:wt,MISSING_PARTICIPANT_ID:It,MISSING_PARTICIPANT_IDS:St,MISSING_PARTICIPANT_ROLE:ft,MISSING_PARTICIPANT:ht,MISSING_PARTICIPANTS:gt,MISSING_PENALTY_ID:Lt,MISSING_PENALTY_TYPE:_t,MISSING_PERSON_DETAILS:Dt,MISSING_POLICY_ATTRIBUTES:Ve,MISSING_POLICY_DEFINITION:_e,MISSING_POLICY_TYPE:xe,MISSING_POSITION_ASSIGNMENTS:ve,MISSING_ROUND_NUMBER:{message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},MISSING_SCHEDULE:rr,MISSING_SCORING_POLICY:{message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},MISSING_SEED_ASSIGNMENTS:Z,MISSING_SEEDCOUNT_THRESHOLDS:Q,MISSING_SEEDING_POLICY:{message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},MISSING_SET_NUMBER:{message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},MISSING_SET_OBJECT:$e,MISSING_SIDE_NUMBER:{message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},MISSING_STAGE:ge,MISSING_STRUCTURE_ID:ne,MISSING_STRUCTURE:se,MISSING_STRUCTURES:oe,MISSING_TARGET_LINK:re,MISSING_TIE_FORMAT:Ne,MISSING_TIME_ITEM:Zt,MISSING_TIME_ITEMS:er,MISSING_TOURNAMENT_ID:b,MISSING_TOURNAMENT_RECORD:D,MISSING_TOURNAMENT_RECORDS:P,MISSING_VALUE:He,MISSING_VENUE_ID:Wt,MODIFICATIONS_FAILED:nr,NO_CANDIDATES:sr,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:kt,NO_MODIFICATIONS_APPLIED:ar,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:Ft,NO_PARTICIPANT_REMOVED:yt,NO_VALID_ACTIONS:gr,NO_VALID_ATTRIBUTES:Ir,NO_VALID_DATES:Ye,NOT_FOUND:vr,NOT_IMPLEMENTED:yr,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:Rt,PARTICIPANT_ID_EXISTS:vt,PARTICIPANT_NOT_CHECKED_IN:Pt,PARTICIPANT_NOT_FOUND:Ut,PARTICIPANT_PAIR_EXISTS:{message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},PENALTY_NOT_FOUND:Vt,POLICY_NOT_ATTACHED:{message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},POLICY_NOT_FOUND:Ge,SCHEDULE_NOT_CLEARED:k,SCHEDULED_MATCHUPS:Mr,SCORES_PRESENT:Nr,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:K,STAGE_SEQUENCE_LIMIT:Ue,STRUCTURE_NOT_FOUND:ae,TEAM_NOT_FOUND:hr,UNABLE_TO_ASSIGN_COURT:or,UNLINKED_STRUCTURES:ce,UNRECOGNIZED_DRAW_TYPE:_,UNRECOGNIZED_MATCHUP_FORMAT:we,UNRECOGNIZED_MATCHUP_STATUS:Se,VALUE_UNCHANGED:Ur,VENUE_EXISTS:qt},Er={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Cr={addNotice:function({topic:e,payload:t,key:r},i){if("string"==typeof e&&"object"==typeof t&&(Er.disableNotifications||(Er.modified=!0),!Er.disableNotifications&&(Er.subscriptions[e]||i)))return r&&(Er.notices=Er.notices.filter((t=>!(t.topic===e&&t.key===r)))),Er.notices.push({topic:e,payload:t,key:r}),{...I}},callListener:function({topic:e,notices:t},r){let i=Er.subscriptions[e];i&&"function"==typeof i&&i(t);let n=r?.[e];n&&"function"==typeof n&&n(t)},cycleMutationStatus:function(){let e=Er.modified;return Er.modified=!1,e},deleteNotice:function({topic:e,key:t}){Er.notices=Er.notices.filter((r=>(!e||r.topic===e)&&r.key!==t))},deleteNotices:function(){Er.notices=[]},disableNotifications:function(){Er.disableNotifications=!0},enableNotifications:function(){Er.disableNotifications=!1},getMethods:Fr,getNotices:function({topic:e}){return Er.notices.filter((t=>t.topic===e)).map((e=>e.payload))},getTopics:function(){return{topics:Object.keys(Er.subscriptions)}},getTournamentId:Or,getTournamentRecord:function(e){return Er.tournamentRecords[e]},getTournamentRecords:function(){return Er.tournamentRecords},removeTournamentRecord:function(e){if("string"!=typeof e)return{error:mr};if(!Er.tournamentRecords[e])return{error:vr};delete Er.tournamentRecords[e];let t=Object.keys(Er.tournamentRecords);return 1===t.length?Er.tournamentId=t[0]:t.length||(Er.tournamentId=void 0),{success:!0}},setMethods:function(e){return"object"!=typeof e?{error:mr}:(Object.keys(e).forEach((t=>{"function"==typeof e[t]&&(Er.methods[t]=e[t])})),{...I})},setSubscriptions:function(e){return"object"!=typeof e.subscriptions?{error:mr}:(Object.keys(e.subscriptions).forEach((t=>{Er.subscriptions[t]=e.subscriptions[t]})),{...I})},setTournamentId:function(e){return e?Er.tournamentRecords[e]?(Er.tournamentId=e,{success:!0}):{error:D}:(Er.tournamentId=void 0,{success:!0})},setTournamentRecord:function(e){let t=e?.tournamentId;return t?(Er.tournamentRecords[t]=e,{success:!0}):{error:T}},setTournamentRecords:function(e){Er.tournamentRecords=e;let t=Object.keys(e);1===t.length?Er.tournamentId=t[0]:t.length||(Er.tournamentId=void 0)},handleCaughtError:function({engineName:e,methodName:t,params:r,err:i}){let n;return"string"==typeof i?n=i.toUpperCase():i instanceof Error&&(n=i.message),console.log("ERROR",{tournamentId:Or(),params:JSON.stringify(r),engine:e,methodName:t,error:n}),{error:n}}};function Or(){return Er.tournamentId}function Fr(){return Er.methods??{}}function kr(e,t){return(e??0)-(t??0)}function xr(e){return"number"==typeof e?parseInt(e.toString()):"string"==typeof e?parseInt(e):0}function _r(e){return!isNaN(e)&&(e&&0==(e&e-1))}function Lr(e){if(!e.length)return;let t=[...e].sort(kr),r=Math.floor(t.length/2);return t.length%2?t[r]:(t[r-1]+t[r])/2}function Vr(e){return isNaN(e)?0:e%2&&e+1||e}function Br(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function jr(e){return!isNaN(parseFloat(e))}function Gr(e){let t=xr(e);if(!isNaN(t))return 0!==t&&1==(t&-t)}function qr(e){if(isNaN(e))return!1;for(;!_r(e);)e++;return e}function $r(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function Wr(e){return Number.isSafeInteger("string"==typeof e?+e:e)}function Hr(e,t,r,i,n=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=Hr(e,t,r):(s=Math.pow(s,r),s*=t-e,s+=e),i&&(s=function(e,t){t||(t=1);let r=1/t;return Math.round(e*r)/r}(s,i)),parseFloat(s.toFixed(n))}function zr(e,t=2){return parseFloat(Number(Math.round(1e3*e)/1e3).toFixed(t))}function Yr(e){return Array.isArray(e)?e?.filter(((e,t,r)=>r.lastIndexOf(e)===t)):[]}function Kr(e){return Array.isArray(e)?e?.map((e=>null===e?void 0:e)):e}function Qr(e){return Array.isArray(e)?e.map((e=>[Math.random(),e])).sort(((e,t)=>e[0]-t[0])).map((e=>e[1])):[]}function Jr(e){return Wr(e)?e:1/0}function Xr(e){return Array.isArray(e)?e.reduce(((e,t)=>(e[t]||(e[t]=0),e[t]++,e)),{}):{}}function Zr(e){return ei(Xr(e))}function ei(e){return Object.keys(e).reduce(((t,r)=>{let i=e[r];return t[i]?t[i].push(r):t[i]=[r],t}),{})}function ti(e,t,r){return r.indexOf(e)===t}function ri(e){return e.filter(ti)}function ii(e){return Array.isArray(e)&&e.length?e.splice(Math.floor(Math.random()*e.length),1)[0]:void 0}function ni(e){return e[Math.floor(Math.random()*e.length)]}function ai(e,t){return Array.from({length:t-e},((t,r)=>r+e))}function oi(e,t){return t.reduce(((t,r,i)=>(r===e&&t.push(i),t)),[])}function si(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>-1!==t.indexOf(e))).filter(((e,t,r)=>r.indexOf(e)===t)):[]}function ci(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>!t.includes(e))):[]}function ui(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.some((e=>t.includes(e)))}function di(e,t){return Array.isArray(t)&&t.reduce(((e,t)=>(e[t]=1+e[t]||1,e)),{})[e]||0}function li(e,t,r,i){return Array.isArray(e)?[].concat(...e.slice(0,t),...e.slice(t,t+r).sort(i),...e.slice(t+r,e.length)):[]}function pi(e,t){return Array.isArray(e)?e.reduce(((e,r,i)=>{let n=Math.floor(i/t);return e[n]=[].concat(e[n]||[],r),e}),[]):[]}function mi(e,[t,...r]){return e.length?[e.slice(0,t),...mi(e.slice(t),[...r,t])]:[]}function fi(e){return!!Array.isArray(e)&&e.reduce(((e,t)=>!isNaN(parseInt(t))&&e),!0)}function hi(e){return!!Array.isArray(e)&&e.reduce(((e,t)=>isNaN(parseInt(t))&&e),!0)}function gi(e,t,r){return Array.isArray(e)?e.reduce(((e,i,n)=>{let a=!!r&&!!(Math.floor(n/t)%2),o=n%t,s=a?t-1-o:o;return e[s]||(e[s]=[]),e[s].push(i),e}),[]):[]}var Ii={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Ui=Cr,vi=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function yi(e){if("object"!=typeof e)throw new Error("Global state provider can not be undefined or null");if(si(Object.keys(e),vi).length!==vi.length)throw new Error("Global state provider is missing required methods");return Ui=e,{success:!0}}function Si(){if(Ui.createInstanceState){try{Ui.createInstanceState()}catch(e){return{error:e}}return{success:!0}}return{error:Xt}}function wi(e){return e&&"object"==typeof e?"object"==typeof Ii.devContext&&(Object.keys(e).every((t=>Ii.devContext?.[t]===e[t]))&&Ii.devContext):Ii.devContext??!1}function Pi(e="reset",t="default"){let r=Date.now();if("report"===e){if("allTimers"===t)return Object.keys(Ii.timers).filter((e=>"default"!==e||Ii.timers[e].startTime)).map((e=>{let t=Ii.timers[e],i="stopped"===t.state?0:(r-(t?.startTime??0))/1e3,n=t.elapsedTime+i;return{state:Ii.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}));{let e="stopped"===Ii.timers[t].state?0:(r-(Ii.timers[t]?.startTime??0))/1e3,i=Ii.timers[t].elapsedTime+e;return{state:Ii.timers[t].state,elapsedTime:i.toFixed(2),timer:t}}}if(!Ii.timers[t]||"reset"===e){if("allTimers"===t)return Ii.timers={default:{elapsedTime:0}},!0;Ii.timers[t]={startTime:r,state:"active",elapsedTime:0}}return Ii.timers[t].elapsedTime||(Ii.timers[t].elapsedTime=0),"stop"===e&&"stopped"!==Ii.timers[t].state&&(Ii.timers[t].state="stopped")&&(Ii.timers[t].elapsedTime+=(r-(Ii.timers[t]?.startTime??0))/1e3),"start"===e&&(Ii.timers[t].startTime=r)&&(Ii.timers[t].state="active"),Ii.timers[t]}function Di(e){c(e)?Ii.globalLog=e:delete Ii.globalLog}function Ti(e){Ii.devContext=e}function bi(){Ui.disableNotifications()}function Ri(){Ui.enableNotifications()}function Mi(e,t){"boolean"==typeof e&&(Ii.deepCopy=e),"object"==typeof t&&(Array.isArray(t.ignore)&&(Ii.deepCopyAttributes.ignore=t.ignore),Array.isArray(t.toJSON)&&(Ii.deepCopyAttributes.toJSON=t.toJSON),Array.isArray(t.stringify)&&(Ii.deepCopyAttributes.stringify=t.stringify),t.threshold&&(Ii.deepCopyAttributes.threshold=t.threshold))}function Ni(){return{enabled:Ii.deepCopy,...Ii.deepCopyAttributes}}function Ai(e){return e?.subscriptions?(Object.keys(e.subscriptions).forEach((t=>{Ii.globalSubscriptions[t]=e.subscriptions[t]})),{...I}):{error:He,info:"missing subscriptions"}}function Ei(e){return e?.subscriptions?Ui.setSubscriptions({subscriptions:e.subscriptions}):{error:He,info:"missing subscriptions"}}function Ci(e){return e?"object"!=typeof e?{error:mr}:(Object.keys(e).forEach((t=>{c(e[t])&&(Ii.globalMethods[t]=e[t])})),{...I}):{error:He,info:"missing method declarations"}}function Oi(e){return e?"object"!=typeof e?{error:mr}:Ui.setMethods(e):{error:He,info:"missing method declarations"}}function Fi(){return Ui.cycleMutationStatus()}function ki(e){if("string"!=typeof e?.topic)return;let t=Ii.globalSubscriptions[e.topic];return Ui.addNotice(e,t)}function xi(){return{...Ii.globalMethods,...Ui.getMethods()}}function _i(e){return Ui.getNotices(e)}function Li({key:e,topic:t}){return Ui.deleteNotice({key:e,topic:t})}function Vi(){return Ui.deleteNotices()}function Bi(){return Ui.getTopics()}async function ji(e){return Ui.callListener(e,Ii.globalSubscriptions)}function Gi(){return Ui.getTournamentId()}function qi(e){return Ui.getTournamentRecord(e)}function $i(){return Ui.getTournamentRecords()}function Wi(e){return Ui.setTournamentRecord(e)}function Hi(e){return Ui.setTournamentRecords(e)}function zi(e){return Ui.setTournamentId(e)}function Yi(e){return Ui.removeTournamentRecord(e)}function Ki(){return Ui}function Qi({engineName:e,methodName:t,params:r,err:i}){return(c(Ui.handleCaughtError)&&Ui.handleCaughtError||Cr.handleCaughtError)({engineName:e,methodName:t,params:r,err:i})}function Ji(e,t){if(Ii.globalLog)try{Ii.globalLog({log:e,engine:t})}catch(r){console.log("globalLog error",r),console.log(t,e),Di()}else console.log(t,e)}function Xi(e,t,r,i){if(!d(e))return{error:mr};jr||(r=1);let n=Array.isArray(t)?t:[],a={},o=(e,i=0)=>{Object.keys(e).forEach((s=>{c(e[s])?a[s]=e[s]:d(e[s])&&(!0===t||n?.includes(s))&&(void 0===r||i<r)&&o(e[s],i+1)}))};return o(e),i?Ci(a):Oi(a),{methods:a}}function Zi(e,t,r,i){if("object"!=typeof e||null===e)return e;Ni()?.enabled||(i=!0);let n=["",void 0,null];t&&n.push(!1);let a=function(e,t,r){return Object.keys(e).filter((i=>!t.includes(e[i])&&(!r||!Array.isArray(e[i])||e[i].length)))}(e,n,r);return Object.assign({},...a.map((t=>Array.isArray(e[t])?{[t]:i?e[t]:e[t].map((e=>Zi(e)))}:{[t]:i?e[t]:Zi(e[t])})))}function en({context:e,result:t,stack:r,info:i}){return t&&!Array.isArray(t?.stack)&&(t.stack=[]),t&&Array.isArray(t?.stack)&&"string"==typeof r&&t.stack.push(r),t&&i&&(t.info=i),t&&"object"==typeof e&&Object.keys(e).length&&Object.assign(t,Zi(e)),t&&!t?.error&&!t?.success&&Object.assign(t,{...I}),t??{success:!0}}var tn="tournamentRecords",rn="policyDefinitions",nn="tournamentRecord",an="drawDefinition",on="matchUpFormat",sn="participantId",cn="scheduleDates",un="structureId",dn="participant",ln="matchUpIds",pn="structures",mn="matchUpId",fn="inContext",hn="structure",gn="courtIds",In="venueIds",Un="matchUps",vn="courtId",yn="eventId",Sn="matchUp",wn="drawId",Pn="error",Dn="event",Tn="param",bn="object",Rn="array",Mn="_validate",Nn="_message",An="_invalid",En="_ofType",Cn="_anyOf",On="_oneOf",Fn={[tn]:P,[nn]:D,[rn]:_e,[an]:M,[sn]:It,[on]:Re,tournamentId:b,[un]:ne,[ln]:Ee,[dn]:ht,[pn]:oe,[mn]:Ae,[hn]:se,[vn]:We,[Un]:Oe,[yn]:le,[Sn]:Fe,[gn]:He,[In]:He,[wn]:H,[Dn]:de},kn={[tn]:bn,[rn]:bn,[nn]:bn,[an]:bn,[cn]:Rn,[dn]:bn,[ln]:Rn,[pn]:Rn,[hn]:bn,[gn]:Rn,[In]:Rn,[Un]:Rn,[Sn]:bn,[Dn]:bn,uuids:Rn};function xn(e,t,r){if(!e&&!d(e))return{error:mr};if(!t?.length||e?._bypassParamCheck)return{valid:!0};if(!Array.isArray(t))return{error:mr};let{paramError:i,errorParam:n}=function(e,t){let r,i;return{paramError:t.find((({_ofType:t,_oneOf:n,_anyOf:a,_validate:o,_info:s,...u})=>{let d=n&&function(e,t){if(!t)return;let r=_n(e,t);return 1!==r.length?{error:mr}:r.reduce(((e,t)=>({...e,[t]:!0})),{})}(e,n);if(d?.error)return d.error;d&&Object.assign(u,d);let l=a&&function(e,t){if(!t)return;let r=_n(e,t).filter((t=>e[t]));return r.length<1?{error:mr}:r.reduce(((e,t)=>({...e,[t]:!0})),{})}(e,a);if(l?.error)return l.error;l&&Object.assign(u,l);let p=Object.keys(u).filter((e=>"boolean"==typeof u[e])),m=p.find((n=>{let a=o&&!c(o),d=void 0!==e[n]&&!o&&function(e,t,r){return r=r||kn[t]||"string","array"===r?!Array.isArray(e[t]):typeof e[t]!==r}(e,n,t),l=u[n]&&[void 0,null].includes(e[n]),p=a||d||l||o&&void 0!==e[n]&&!function(e,t){return!c(t)||t(e)}(e[n],o);return p&&(r=n,i=s),p}));return!p.length||m})),errorParam:r,paramInfo:i}}(e,t);if(!i)return{valid:!0};let a=void 0===e?.[n]?Fn[n]||i[Pn]||mr:i[Mn]&&i[An]||mr;return en({info:{param:n??(i[On]&&Object.keys(i[On]).join(", ")),message:i[Nn]},result:{error:a},stack:r})}function _n(e,t){return si(Object.keys(e),Object.keys(t))}var Ln="DYNAMIC",Vn="RANKING",Bn="RATING",jn="SCALE",Gn="SEEDING",qn={RANKING:Vn,RATING:Bn,SCALE:jn,SEEDING:Gn};function $n(e){let t=xn(e,[{[dn]:!0}]);if(t.error)return t;let r=e.participant.timeItems?.filter((({itemType:e})=>e?.startsWith(jn)&&[Vn,Bn,Gn].includes(e.split(".")[1]))),i={ratings:{},rankings:{},seedings:{}};if(r?.length){let e=e=>r.filter((t=>t?.itemType===e)).sort(((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime())).pop(),t=Yr(r.map((({itemType:e})=>e)));for(let r of t){let t=e(r);if(t){let[,e,r,n,a]=t.itemType.split("."),o=a?`${n}.${a}`:n,s=(e===Gn?"seedings":e===Vn&&"rankings")||"ratings";i[s][r]||(i[s][r]=[]),i[s][r].push({scaleValue:t.itemValue,scaleDate:t.itemDate,scaleName:o})}}}return{...I,...i}}function Wn(e){if(null===e)return{};let{source:t,template:r}=e||{};if(!r)return t;let i={};return function e(t,r,i){if(!t||!r)return;let n=Object.keys(t),a=Object.keys(r),o=Object.assign({},...a.filter((e=>e.indexOf("||"))).map((e=>e.split("||").map((t=>({[t]:e}))))).flat()),s=a.concat(...Object.keys(o)),c=s.includes("*");for(let u of n)if(s.indexOf(u)>=0||c){let n=r[o[u]||u]||c,a=t[u];if("object"!=typeof n||"function"==typeof a||Array.isArray(n)){let e=t[u];if(Array.isArray(n)&&!n.includes(e))return!1;(r[u]||c&&!1!==r[u])&&(i[u]=e)}else if(Array.isArray(a)){let t=a.map((t=>{let r={};return!1!==e(t,n,r)?r:void 0})).filter(Boolean);i[u]=t}else a&&(i[u]={},e(a,n,i[u]))}}(t,r,i),i}var Hn=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,zn=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Yn=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Kn=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function Qn(e){let{scheduledDate:t}=e;if(!t&&e.scheduledTime&&(t=la(e.scheduledTime)),!t)return;let r=da(e.scheduledTime),i=la(t);return i&&r&&(i+=`T${r}`),i}function Jn(e){return"object"==typeof e&&!Array.isArray(e)&&"[object Date]"===Object.prototype.toString.call(e)}function Xn(e){let t="string"==typeof e?e?.split(" "):[];return!(e&&t?.length>1&&!["AM","PM"].includes(t[1].toUpperCase()))&&!(e&&!Kn.test(fa(e,!0,!0)))}function Zn(e){return oa(e)||Hn.test(e)}var ea=e=>{let t=ia(e)||oa(e)?new Date(e):new Date,r=t.getUTCMonth()+1,i=r<10?`0${r}`:`${r}`;return`${t.getUTCFullYear()}-${Sa(i)}-${Sa(t.getUTCDate())}`};function ta(e,t="-",r="YMD"){if(!e)return"";"string"==typeof e&&e.indexOf("T")<0&&(e+="T00:00");let i=new Date(e),n=""+(i.getMonth()+1),a=""+i.getDate(),o=i.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),"DMY"===r?[a,n,o].join(t):"MDY"===r?[n,a,o].join(t):"YDM"===r?[o,a,n].join(t):"DYM"===r?[a,o,n].join(t):"MYD"===r?[n,o,a].join(t):[o,n,a].join(t)}function ra(e){let t=e?new Date(e):new Date,r=t.getTimezoneOffset();return new Date(t.getTime()-60*r*1e3)}function ia(e){if("boolean"==typeof e)return!1;let t=e instanceof Date&&e||!isNaN(e)&&new Date(e)||!1;return t&&!isNaN(t.valueOf())}function na(e,t){if(!Zn(e)||!Zn(t))return[];let r=la(e)+"T00:00",i=la(t)+"T00:00",n=new Date(r),a=new Date(i),o=[],s=0;if(ia(a)&&ia(n)&&n<=a){let e=n,t=e.getTime();for(;t<=a.getTime()&&s<300;)s+=1,o.push(new Date(e)),t=e.setDate(e.getDate()+1)}return o.map((e=>ta(e)))}var aa=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function oa(e){return"string"==typeof e&&aa.test(e)}function sa(e){if("string"!=typeof e)return!1;let t=e.split("Z")[0].split(":"),r=t.every((e=>!isNaN(parseInt(e))));return!(t.length<2||!r||parseInt(t[0])>23||parseInt(t[1])>60)}function ca(e){let t=da(e);if(!t)return 0;let[r,i]=t.split(":").map((e=>parseInt(e)));return 60*r+i}function ua(e){return sa(e)?e.split(":").slice(0,2).map(Sa).join(":"):void 0}function da(e){return oa(e)&&e.indexOf("T")>0?ua(e.split("T").reverse()[0]):ua(e)}function la(e){return oa(e)||Yn.test(e)?e.split("T")[0]:void 0}function pa(e,t){let r=new Date(e);return r.setDate(r.getDate()+t),la(r.toISOString())}function ma(e){e="string"!=typeof e?"00:00":e;let t={},r={};return({0:t.time,1:t.ampm}=e.split(" ")||[]),({0:r.hours,1:r.minutes}=t.time.split(":")||[]),r.ampm=t.ampm,isNaN(r.hours)||isNaN(r.minutes)||r.ampm&&!["AM","PM"].includes(r.ampm.toUpperCase())?{}:r}function fa(e,t,r){let i=la(e),n=da(e),a=i?n:e;return e?t&&(i&&r&&e||function(e){let t=ma(e);return t.ampm&&t.hours&&("pm"===t.ampm.toLowerCase()&&parseInt(t.hours)<12&&(t.hours=(t.hours&&parseInt(t.hours)||0)+12),"am"===t.ampm.toLowerCase()&&"12"===t.hours&&(t.hours="00")),`${t.hours||"12"}:${t.minutes||"00"}`.split(":").map(Sa).join(":")}(a))||function(e){let t=ma(e);if("object"!=typeof t||Object.keys(t).length)return t.ampm?e:(t.hours>12?(t.hours-=12,t.ampm="PM"):"12"===t.hours?t.ampm="PM":("00"===t.hours&&(t.hours="12"),t.ampm="AM"),"0"===t.hours?.[0]&&(t.hours=t.hours.slice(1)),`${t.hours||"12"}:${t.minutes||"00"} ${t.ampm}`)}(a):void 0}function ha(e,t){let r=ma(e),i=ma(t);if(parseInt(r.hours)<parseInt(i.hours))return-1;if(parseInt(r.hours)>parseInt(i.hours))return 1;if(r.hours===i.hours){if(parseInt(r.minutes)<parseInt(i.minutes))return-1;if(parseInt(r.minutes)>parseInt(i.minutes))return 1}return 0}function ga(e,t=7){let r=la(e)+"T00:00",i=new Date(r);return ta(new Date(i.setDate(i.getDate()+t)))}function Ia(e,t=void 0){let[r,i]=(e||"00:00").split(":").map(Sa),n=ra(t).setHours(r,i,0,0);return ra(n)}function Ua(e,t,r=!0){let i=new Date(e),n=(new Date(t).getTime()-i.getTime())/1e3/60;return r?Math.abs(Math.round(n)):Math.round(n)}function va(e,t){let r=da(e);if(!r)return"00:00";let i=isNaN(t)?0:t;return da(ya(Ia(r),i).toISOString())}function ya(e,t){let r=new Date(e);return new Date(r.getTime()+6e4*t)}function Sa(e){return e.toString()[1]?e:"0"+e}function wa(e,t){let r=new Date(e),i=new Date(t);return r.getFullYear()===i.getFullYear()&&r.getMonth()===i.getMonth()&&r.getDate()===i.getDate()}var Pa={addDays:ga,addWeek:function(e){return ga(e)},addMinutesToTimeString:va,convertTime:fa,getIsoDateString:Qn,getUTCdateString:ea,DateHHMM:function(e){let t=new Date(e);return function(e,t){let r=parseInt(e,10),i=Math.floor(r/3600),n=Math.floor((r-3600*i)/60),a=r-3600*i-60*n;return(!t||t?.displaySeconds?i+":"+n+":"+a:i+":"+n).split(":").map(Sa).join(":")}(t.getSeconds()+60*t.getMinutes()+3600*t.getHours(),{displaySeconds:!1})},extractDate:la,extractTime:da,formatDate:ta,getDateByWeek:function(e,t,r,i=!1){let n=new Date(t,0,1+7*(e-1)),a=i?0:1;return n.setDate(n.getDate()+(a-n.getDay())),ta(n,r)},isISODateString:oa,isDate:ia,isTimeString:sa,offsetDate:ra,offsetTime:function(e){return ra(e).getTime()},sameDay:wa,timeStringMinutes:ca,timeToDate:Ia,timeUTC:function(e){let t=ia(e)||oa(e)?new Date(e):new Date;return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())},validTimeValue:Xn,validDateString:Hn,timeValidation:Kn,dateValidation:Yn};function Da(e,t,r,i,n=0){if(Ki().makeDeepCopy)return Ki().makeDeepCopy(e,t,r,i);let a=Ni(),{stringify:o,toJSON:s,ignore:u,modulate:d}=a||{};if(!a?.enabled&&!r||"object"!=typeof e||c(e)||null===e||"number"==typeof a?.threshold&&n>=a.threshold)return e;let l=Array.isArray(e)?[]:{},p=Object.keys(e).filter((e=>!r||!u||Array.isArray(u)&&!u.includes(e)||c(u)&&!u(e))),m=(e,t)=>{l[e]=c(t?.toString)?t.toString():JSON.stringify(t)};for(let f of p){let a=e[f],u=c(d)?d(a):void 0;if(void 0!==u)l[f]=u;else if(t&&"extensions"===f&&Array.isArray(a)){let e=Ta(a);Object.assign(l,...e)}else i&&"extensions"===f?l[f]=[]:Array.isArray(o)&&o.includes(f)?m(f,a):Array.isArray(s)&&s.includes(f)&&c(a?.toJSON)?l[f]=a.toJSON():null===a?l[f]=void 0:Jn(a)?l[f]=new Date(a).toISOString():l[f]=Da(a,t,r,i,n+1)}return l}function Ta(e){return e?.map((e=>{let{name:t,value:r}=e;return t&&r&&{[`_${t}`]:r}})).filter(Boolean)}var ba="voluntaryConsolation",Ra="competitiveBands",Ma="roundRobinTally",Na="positionActions",Aa="matchUpActions",Ea="rankingPoints",Ca="roundNaming",Oa="participant",Fa="progression",ka="scheduling",xa="avoidance",_a="scoring",La="seeding",Va="feedIn",Ba="draws",ja={POLICY_TYPE_VOLUNTARY_CONSOLATION:ba,POLICY_TYPE_COMPETITIVE_BANDS:Ra,POLICY_TYPE_ROUND_ROBIN_TALLY:Ma,POLICY_TYPE_POSITION_ACTIONS:Na,POLICY_TYPE_MATCHUP_ACTIONS:Aa,POLICY_TYPE_RANKING_POINTS:Ea,POLICY_TYPE_ROUND_NAMING:Ca,POLICY_TYPE_PARTICIPANT:Oa,POLICY_TYPE_PROGRESSION:Fa,POLICY_TYPE_SCHEDULING:ka,POLICY_TYPE_AVOIDANCE:xa,POLICY_TYPE_DISPLAY:"display",POLICY_TYPE_FEED_IN:Va,POLICY_TYPE_SCORING:_a,POLICY_TYPE_SEEDING:La,POLICY_TYPE_AUDIT:"audit",POLICY_TYPE_DRAWS:Ba};function Ga({tournamentParticipants:e=[],policyDefinitions:t={},contextProfile:r,participantId:i,internalUse:n,personId:a}){let o=Da(e.find((e=>i&&e.participantId===i||a&&e.person&&e.person.personId===a)),!1,n);if(o){let e=t?.[Oa];if(r?.withScaleValues){let{ratings:e,rankings:t}=$n({participant:o});o.rankings=t,o.ratings=e}if(e?.participant)return Wn({template:e.participant,source:o})}return o}var qa="element required",$a="missing name";function Wa(e){if(!e||"object"!=typeof e)return{error:He};if(e.element&&"object"!=typeof e?.element)return{error:mr};if(!e?.name)return{error:He,info:$a};if(!e?.element){if(e.discover&&e.tournamentRecords){for(let t of Object.keys(e.tournamentRecords)){let r=Wa({element:e.tournamentRecords[t],name:e.name});if(r.error)return en({result:r,stack:"removeExtension"})}return{...I}}return{error:He,info:qa}}return e?.element.extensions?(e.element.extensions=e.element.extensions.filter((t=>t?.name!==e.name)),{...I}):{...I,info:vr}}function Ha({requiredAttributes:e=["name","value"],extension:t}){if(!t||"object"!=typeof t||"string"!=typeof t.name)return!1;let r=Object.keys(t);return e.filter((e=>r.includes(e))).length===e.length}function za(e){if("object"!=typeof e)return{error:He};let t="addExtension";if(e?.element&&"object"!=typeof e.element)return en({result:{error:mr},stack:t});if(!Ha({extension:e.extension}))return en({result:{error:mr,info:"invalid extension"},stack:t});if(!e.element){if(e.discover&&!e.tournamentId&&e.tournamentRecords){for(let r of Object.values(e.tournamentRecords)){let i=za({extension:e.extension,element:r});if(i.error)return en({result:i,stack:t})}return{...I}}return en({result:{error:He},stack:t})}if(e.element.extensions||(e.element.extensions=[]),e?.creationTime??1){let t=(new Date).toISOString();Object.assign(e.extension,{createdAt:t})}let r=e.element.extensions.find((({name:t})=>t===e.extension.name));return r?r.value=e.extension.value:e.extension.value&&e.element.extensions.push(e.extension),{...I}}function Ya(e){return e&&"object"==typeof e?e.tournamentRecord?za({creationTime:e.creationTime,element:e.tournamentRecord,extension:e.extension}):{error:D}:{error:He}}function Ka(e){return e&&"object"==typeof e?e.drawDefinition?za({creationTime:e.creationTime,element:e.drawDefinition,extension:e.extension}):{error:A}:{error:He}}function Qa(e){return e&&"object"==typeof e?e.event?za({creationTime:e.creationTime,extension:e.extension,element:e.event}):{error:le}:{error:He}}function Ja(e){if(!e||"object"!=typeof e)return{error:He};if(!e.participantId)return{error:It};let t=e.tournamentRecord?.participants||[],r=Ga({participantId:e.participantId,tournamentParticipants:t});return r?za({creationTime:e.creationTime,extension:e.extension,element:r}):{error:Ut}}function Xa(e){return e&&"object"==typeof e?e.tournamentRecord?Wa({element:e.tournamentRecord,name:e.name}):{error:D}:{error:He}}function Za(e){return e&&"object"==typeof e?e.drawDefinition?Wa({element:e.drawDefinition,name:e.name}):{error:A}:{error:He}}function eo(e){return e&&"object"==typeof e?e?.event?Wa({element:e.event,name:e.name}):{error:le}:{error:He}}function to(e){if(!e||"object"!=typeof e)return{error:He};if(!e.participantId)return{error:It};let t=e.tournamentRecord?.participants||[],r=Ga({participantId:e.participantId,tournamentParticipants:t});return r?Wa({element:r,name:e.name}):{error:Ut}}function ro({tournamentRecords:e}){return{tournamentIds:d(e)?Object.keys(e):[],...I}}var io="extensionQueries";function no({discover:e,element:t,name:r,...i}){if(!t||!r){if(e&&i){let t=Object.keys(i).filter((t=>"boolean"==typeof e||Array.isArray(e)&&e.includes(t))).find((e=>!!Array.isArray(i[e]?.extensions)&&i[e].extensions.find((e=>e?.name===r)))),n=t&&i[t];!n&&i.tournamentRecords&&(n=Object.values(i.tournamentRecords).find((e=>e.extensions?.length)));let a=n?.extensions?.find((e=>e?.name===r));return{extension:a,info:a?void 0:vr}}return en({result:{error:He},stack:io})}if(!Array.isArray(t.extensions))return{info:"no extensions"};let n=t.extensions.find((e=>e?.name===r));return{extension:n,info:n?void 0:vr}}var ao="appliedPolicies",oo="context",so="delegatedOutcome",co="disabled",uo="disableLinks",lo="disableAutoCalc",po="display",mo="drawDeletions",fo="entryProfile",ho="flightProfile",go="groupingAttribute",Io="lineUps",Uo="linkedTournamentsIds",vo="matchUpHistory",yo="participantRepresentatives",So="personRequests",wo="positionActions",Po="roundTarget",Do="scheduleLimits",To="scheduleTiming",bo="schedulingProfile",Ro="subOrder",Mo="tally",No="tieFormatModification",Ao={ACTIVE_SUSPENSION:"activeSuspension",APPLIED_POLICIES:ao,CONTEXT:oo,DELEGATED_OUTCOME:so,DISABLED:co,DISABLE_LINKS:uo,DISABLE_AUTO_CALC:lo,DISPLAY:po,DRAW_DELETIONS:mo,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:fo,EVENT_PROFILE:"eventProfile",EVENT_WITHDRAWAL_REQUESTS:"eventWithdrawalRequests",FLIGHT_PROFILE:ho,GROUPING_ATTRIBUTE:go,LINEUPS:Io,LINKED_TOURNAMENTS:Uo,MATCHUP_HISTORY:vo,PARTICIPANT_REPRESENTATIVES:yo,PERSON_REQUESTS:So,POSITION_ACTIONS:wo,RANKING_POINTS:"rankingPoints",ROUND_TARGET:Po,SCHEDULE_LIMITS:Do,SCHEDULE_TIMING:To,SCHEDULING_PROFILE:bo,STATUS_DETAIL:"statusDetail",SUB_ORDER:Ro,TALLY:Mo,TIE_FORMAT_MODIFICATIONS:No,FACTORY:"factory"},Eo=[so,co,uo,ho,Io,vo,yo,So,Po,Do,To,bo,Ro,Mo];function Co({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:P};let t=ro({tournamentRecords:e}),{tournamentIds:r}=t;return r?.length>1?za({tournamentRecords:e,discover:!0,extension:{name:Uo,value:{tournamentIds:r}}}):{...I}}function Oo({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:P};return en({result:Wa({name:Uo,tournamentRecords:e,discover:!0}),stack:"unlinkTournaments"})}function Fo({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e)return{error:mr};if(!t)return{error:b};let r,i=ro({tournamentRecords:e}),{tournamentIds:n}=i;return n.includes(t)?(n.every((i=>{let n=e[i],{extension:a}=no({element:n,name:Uo});if(!a)return!0;let o=a?.value?.tournamentIds||[];if(!o?.length||1===o.length&&o.includes(t)||i===t){let e=Xa({name:Uo,tournamentRecord:n});return e.error&&(r=e.error),e.success}let s=o.filter((e=>e!==t));a.value={tournamentIds:s};let c=Ya({tournamentRecord:n,extension:a});return c.error&&(r=c.error),c.success})),r?{error:r}:{...I}):{error:b}}var ko={};function xo({tournamentRecords:e}){return"object"==typeof e&&Object.keys(e).length?{linkedTournamentIds:Object.assign({},...Object.keys(e).map((t=>{let r=e[t],i=r?.tournamentId,{extension:n}=no({element:r,name:Uo});return{[t]:(n?.value?.tournamentIds||[]).filter((e=>e!==i))}})))}:{error:P}}n(ko,{getLinkedTournamentIds:()=>xo,getTournamentIds:()=>ro});var _o={};n(_o,{addAdHocMatchUps:()=>yU,addDrawDefinitionTimeItem:()=>lg,addFinishingRounds:()=>hm,addGoesTo:()=>gm,addPlayoffStructures:()=>cU,addQualifyingStructure:()=>Tg,addVoluntaryConsolationStage:()=>Ug,addVoluntaryConsolationStructure:()=>xf,allPlayoffPositionsFilled:()=>Ah,alternateDrawPositionAssignment:()=>hh,assignDrawPosition:()=>gU,assignDrawPositionBye:()=>Mm,attachConsolationStructures:()=>aU,attachPlayoffStructures:()=>oU,attachQualifyingStructure:()=>ug,attachStructures:()=>sU,autoSeeding:()=>uT,automatedPlayoffPositioning:()=>tg,automatedPositioning:()=>eg,checkValidEntries:()=>Bv,deleteAdHocMatchUps:()=>UU,drawMatic:()=>rP,findDrawDefinition:()=>MU,generateAdHocMatchUps:()=>ny,generateAdHocRounds:()=>eP,generateAndPopulatePlayoffStructures:()=>nU,generateDrawDefinition:()=>sT,generateDrawMaticRound:()=>fy,generateDrawStructuresAndLinks:()=>zv,generateDrawTypeAndModifyDrawDefinition:()=>Yv,generateQualifyingStructure:()=>Dg,generateVoluntaryConsolation:()=>hy,getAssignedParticipantIds:()=>_m,getAvailableMatchUpsCount:()=>DU,getAvailablePlayoffProfiles:()=>kg,getDrawDefinitionTimeItem:()=>_u,getDrawParticipantRepresentativeIds:()=>TU,getDrawTypeCoercion:()=>kv,getEligibleVoluntaryConsolationParticipants:()=>PU,getMatchUpsMap:()=>mp,getParticipantIdFinishingPositions:()=>bU,getPositionAssignments:()=>xv,getPositionsPlayedOff:()=>Og,getSeedingThresholds:()=>Wf,getSeedsCount:()=>Vv,getStructureSeedAssignments:()=>Ad,getTeamLineUp:()=>wp,getValidGroupSizes:()=>Gf,isAdHoc:()=>Tp,isCompletedStructure:()=>Nh,isValidForQualifying:()=>_v,luckyLoserDrawPositionAssignment:()=>fh,modifyDrawDefinition:()=>pU,modifyDrawName:()=>lU,modifySeedAssignment:()=>Th,mutate:()=>Lo,positionActions:()=>Fv,pruneDrawDefinition:()=>hU,qualifierDrawPositionAssignment:()=>Sh,query:()=>wU,removeDrawPositionAssignment:()=>Af,removeRoundMatchUps:()=>vU,removeSeededParticipant:()=>vg,removeStructure:()=>pg,renameStructures:()=>dg,resetDrawDefinition:()=>mU,resetVoluntaryConsolationStructure:()=>cu,setDrawParticipantRepresentativeIds:()=>Wo,setPositionAssignments:()=>vh,setStructureOrder:()=>rg,setSubOrder:()=>SU,shiftAdHocRounds:()=>Uh,swapAdHocRounds:()=>yh,swapDrawPositionAssignments:()=>Dh,updateTeamLineUp:()=>dh,withdrawParticipantAtDrawPosition:()=>Ef});var Lo={};n(Lo,{addAdHocMatchUps:()=>yU,addDrawDefinitionTimeItem:()=>lg,addPlayoffStructures:()=>cU,addQualifyingStructure:()=>Tg,addVoluntaryConsolationStage:()=>Ug,addVoluntaryConsolationStructure:()=>xf,alternateDrawPositionAssignment:()=>hh,assignDrawPosition:()=>gU,assignDrawPositionBye:()=>Mm,attachConsolationStructures:()=>aU,attachPlayoffStructures:()=>oU,attachQualifyingStructure:()=>ug,attachStructures:()=>sU,automatedPlayoffPositioning:()=>tg,automatedPositioning:()=>eg,deleteAdHocMatchUps:()=>UU,luckyLoserDrawPositionAssignment:()=>fh,modifyDrawDefinition:()=>pU,modifyDrawName:()=>lU,modifySeedAssignment:()=>Th,pruneDrawDefinition:()=>hU,qualifierDrawPositionAssignment:()=>Sh,removeDrawPositionAssignment:()=>Af,removeRoundMatchUps:()=>vU,removeSeededParticipant:()=>vg,removeStructure:()=>pg,renameStructures:()=>dg,resetDrawDefinition:()=>mU,resetVoluntaryConsolationStructure:()=>cu,setDrawParticipantRepresentativeIds:()=>Wo,setPositionAssignments:()=>vh,setStructureOrder:()=>rg,setSubOrder:()=>SU,shiftAdHocRounds:()=>Uh,swapAdHocRounds:()=>yh,swapDrawPositionAssignments:()=>Dh,updateTeamLineUp:()=>dh,withdrawParticipantAtDrawPosition:()=>Ef});var Vo=e=>t=>e[t],Bo=(e=[])=>e.map(qo).filter(Boolean),jo=(e=[])=>e.map(Go).filter(Boolean),Go=(e={})=>Vo(e)("participantId"),qo=(e={})=>Vo(e)("matchUpId"),$o=(e={})=>Vo(e)("drawId");function Wo({representativeParticipantIds:e,drawDefinition:t}){if(!t)return{error:A};if(!Array.isArray(e))return{error:mr};let r=jo(t?.entries||[]);return e.length&&si(e,r).length<e.length?{error:mr}:Ka({drawDefinition:t,extension:{name:yo,value:e}})}var Ho="ABANDONED",zo="AWAITING_RESULT",Yo="BYE",Ko="CANCELLED",Qo="COMPLETED",Jo="DEAD_RUBBER",Xo="DEFAULTED",Zo="DOUBLE_DEFAULT",es="DOUBLE_WALKOVER",ts="IN_PROGRESS",rs="INCOMPLETE",is="NOT_PLAYED",ns="RETIRED",as="SUSPENDED",os="TO_BE_PLAYED",ss="WALKOVER",cs=[zo,Qo,Xo,ts,rs,ns,as],us=[zo,Qo,Xo,es,Zo,ts,rs,ns,as,ss],ds=[Ho,zo,Yo,Ko,Qo,Jo,Xo,es,Zo,ts,rs,is,ns,as,os,ss],ls=[Yo,es,Zo,Qo,Xo,ns,ss],ps=[Ho,zo,Ko,Jo,ts,rs,is,as,os,void 0],ms=[Ko,Ho,Qo,Jo,Xo,es,Zo,ns,ss],fs=[Ho,Qo,Xo,es,Zo,ts,ns,ss],hs=[ts,rs,as,os],gs={ABANDONED:Ho,AWAITING_RESULT:zo,BYE:Yo,CANCELLED:Ko,COMPLETED:Qo,DEAD_RUBBER:Jo,DEFAULTED:Xo,DOUBLE_WALKOVER:es,DOUBLE_DEFAULT:Zo,IN_PROGRESS:ts,INCOMPLETE:rs,NOT_PLAYED:is,RETIRED:ns,SUSPENDED:as,TO_BE_PLAYED:os,WALKOVER:ss},Is="MAIN",Us="QUALIFYING",vs="CONSOLATION",ys="VOLUNTARY_CONSOLATION",Ss="PLAY_OFF",ws=[Is,Us,vs,Ss,ys],Ps={[Us]:1,[Is]:2,[Ss]:3,[vs]:3,[ys]:4},Ds="finishingPositions",Ts="aggregateEventStructures",bs={[Is]:1,[Ss]:2,[vs]:3,[Us]:4,[ys]:5},Rs={[Ss]:1,[Is]:2,[vs]:3,[Us]:4,[ys]:5},Ms="CLUSTER",Ns="WATERFALL",As="ITEM",Es="CONTAINER",Cs="DRAW",Os="RANDOM",Fs="TOP_DOWN",ks="BOTTOM_UP",xs="POSITION",_s="WINNER",Ls="LOSER",Vs="FIRST_MATCHUP",Bs="AD_HOC",js="FEED_IN",Gs="COMPASS",qs="OLYMPIC",$s="SINGLE_ELIMINATION",Ws="DOUBLE_ELIMINATION",Hs="FIRST_MATCH_LOSER_CONSOLATION",zs="FIRST_ROUND_LOSER_CONSOLATION",Ys="LUCKY_DRAW",Ks="CURTIS_CONSOLATION",Qs="CURTIS_CONSOLATION",Js="FEED_IN_CHAMPIONSHIP_TO_SF",Xs="FEED_IN_CHAMPIONSHIP_TO_SF",Zs="FEED_IN_CHAMPIONSHIP_TO_QF",ec="FEED_IN_CHAMPIONSHIP_TO_QF",tc="FEED_IN_CHAMPIONSHIP_TO_R16",rc="FEED_IN_CHAMPIONSHIP_TO_R16",ic="MODIFIED_FEED_IN_CHAMPIONSHIP",nc="MODIFIED_FEED_IN_CHAMPIONSHIP",ac="FEED_IN_CHAMPIONSHIP",oc="DOUBLE_ROUND_ROBIN",sc="ROUND_ROBIN",cc="ROUND_ROBIN_WITH_PLAYOFF",uc="DECIDER",dc="BACKDRAW",lc={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},pc={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},mc="WIN_RATIO",fc="ROUND_OUTCOME",hc=[Gs,Ks,ec,rc,Xs,ac,Zs,tc,Js,Hs,zs,Ys,nc,qs,Ss,cc],gc={MAIN:Is,QUALIFYING:Us,CONSOLATION:vs,ITEM:As,CONTAINER:Es,FIRST_MATCHUP:Vs,WINNER:_s,LOSER:Ls,AD_HOC:Bs,FEED_IN:js,FLEX_ROUNDS:"AD_HOC",COMPASS:Gs,PLAY_OFF:Ss,OLYMPIC:qs,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:$s,DOUBLE_ELIMINATION:Ws,CURTIS:Ks,FICSF:Js,FICQF:Zs,FICR16:tc,MFIC:ic,VOLUNTARY_CONSOLATION:ys,FIRST_MATCH_LOSER_CONSOLATION:Hs,FIRST_ROUND_LOSER_CONSOLATION:zs,MODIFIED_FEED_IN_CHAMPIONSHIP:nc,FEED_IN_CHAMPIONSHIP_TO_R16:rc,FEED_IN_CHAMPIONSHIP_TO_QF:ec,FEED_IN_CHAMPIONSHIP_TO_SF:Xs,FEED_IN_CHAMPIONSHIP:ac,LUCKY_DRAW:Ys,ROUND_ROBIN_WITH_PLAYOFF:cc,ROUND_ROBIN:sc,DECIDER:uc,BACKDRAW:dc,COMPASS_ATTRIBUTES:lc,OLYMPIC_ATTRIBUTES:pc,DRAW:Cs,RANDOM:Os,TOP_DOWN:Fs,BOTTOM_UP:ks,WATERFALL:Ns,WIN_RATIO:mc,ROUND_OUTCOME:fc,MULTI_STRUCTURE_DRAWS:hc,generatedDrawTypes:[Bs,Gs,Ks,Ws,ec,rc,Xs,ac,js,Hs,zs,Ys,nc,qs,Ss,sc,cc,$s],stageOrder:Ps,finishOrder:bs,AGGREGATE_EVENT_STRUCTURES:Ts,FINISHING_POSITIONS:Ds},Ic=gc;function Uc(e,t,r){let i=e=>no({element:e,name:Po})?.extension?.value,n=r?.deprioritizeCompleted,a=r?.mode===Ts&&Rs,o=r?.mode===Ds&&bs,s=o||a||Ps,c=e=>(e=>e?.stage===Is&&1===e?.stageSequence)(e)?-1:s[e?.stage],u=e=>e?.matchUps.every((({matchUpStatus:e})=>ms.includes(e)?1:-1));return n&&u(e)-u(t)||a&&c(e)-c(t)||(e?.stage&&s[e.stage]||0)-(t?.stage&&s[t.stage]||0)||(i(e)||0)-(i(t)||0)||!o&&!a&&(t?.positionAssignments?.length??1/0)-(e?.positionAssignments?.length??1/0)||(e?.stageSequence??0)-(t?.stageSequence??0)||(vc(e)||0)-(vc(t)||0)}function vc(e){return(e?.matchUps||[]).reduce(((e,t)=>{let r=(t.finishingPositionRange?.winner||[]).reduce(((e,t)=>e+t),0);return!e||r<e?r:e}),void 0)}function yc(e){let t=xn(e,[{[an]:!0,[un]:!0}]);if(t.error)return t;let{drawDefinition:r,structureId:i}=e,{structures:n}=Sc({drawDefinition:r}),a=n?.map((e=>e.structures?[...e.structures].concat(e):e)).flat(),o=a?.find((e=>e.structureId===i));return o?{structure:o,containingStructure:o.structureType===As?a?.find((e=>e.structures?.some((e=>e.structureId===i)))):void 0}:{error:ae}}function Sc({withStageGrouping:e,drawDefinition:t,stageSequences:r,stageSequence:i,roundTarget:n,sortConfig:a,stages:o,stage:s}){let c=!t&&M||!t?.structures&&oe||void 0;if(c)return{error:c,structures:[],stageStructures:{}};let u=t?.structures?.filter((function(e){return!s&&!Array.isArray(o)||s&&e.stage===s||Array.isArray(o)&&o.includes(e.stage)})).filter((function(e){return!i&&!Array.isArray(r)||i&&e.stageSequence===i||Array.isArray(r)&&r.includes(e.stageSequence)})).filter((e=>{let t=no({element:e,name:Po})?.extension?.value;return!n||n===t})).sort(((e,t)=>Uc(e,t,a)))??[],d=e?Object.assign({},...ws.map((e=>{let t=u?.filter((t=>t.stage===e));return t?.length&&{[e]:t}})).filter(Boolean)):{};return{structures:u,stageStructures:d}}function wc({drawDefinition:e}){if(!e)return{error:M};let t={};return{allPositionedParticipantIds:(e.structures||[]).map((e=>{let r=e.stage;t[r]||(t[r]=[]);let{positionAssignments:i}=Pc({structure:e}),n=i?.map(Go).filter(Boolean)??[];return t[r].push(...n),n})).flat(),stagePositionedParticipantIds:t}}function Pc({drawDefinition:e,structureId:t,structure:r}){let i,n=[];if(!r){if(!e)return{positionAssignments:n,error:M};if(({structure:r,error:i}=yc({drawDefinition:e,structureId:t})),i)return{positionAssignments:n,error:i}}return r.structures?n=[].concat(...r.structures.map((e=>Pc({structure:e}).positionAssignments))):r.positionAssignments?n=r.positionAssignments:i=ve,{positionAssignments:n,error:i}}function Dc({drawDefinition:e,structureId:t,structure:r}){let i=Pc({drawDefinition:e,structureId:t,structure:r})?.positionAssignments||[],n=i?.filter((e=>e.participantId??e.bye??e.qualifier)),a=i&&i?.length===n?.length,o=i?.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)),s=i?.filter((e=>!e.participantId&&e.bye)),c=i?.filter((e=>!e.participantId&&e.qualifier));return{allPositionsAssigned:a,positionAssignments:i,unassignedPositions:o,assignedPositions:n,qualifierPositions:c,byePositions:s}}var Tc="addDrawDefinition",bc="addMatchUps",Rc="addParticipants",Mc="addScaleItems",Nc="addVenue",Ac="audit",Ec="dataIssue",Cc="deleteParticipants",Oc="deleteVenue",Fc="deletedDrawIds",kc="deletedMatchUpIds",xc="modifyDrawDefinition",_c="modifyDrawEntries",Lc="modifyEventEntries",Vc="modifyMatchUp",Bc="modifyParticipants",jc="modifyPositionAssignments",Gc="modifySeedAssignments",qc="modifyTournamentDetail",$c="modifyVenue",Wc="mutations",Hc="publishEvent",zc="publishEventSeeding",Yc="publishOrderOfPlay",Kc="unPublishEvent",Qc="unPublishEventSeeding",Jc="unPublishOrderOfPlay",Xc="updateInContextMatchUp",Zc={ADD_DRAW_DEFINITION:Tc,ADD_MATCHUPS:bc,ADD_PARTICIPANTS:Rc,ADD_SCALE_ITEMS:Mc,ADD_VENUE:Nc,AUDIT:Ac,DATA_ISSUE:Ec,DELETE_PARTICIPANTS:Cc,DELETE_VENUE:Oc,DELETED_DRAW_IDS:Fc,DELETED_MATCHUP_IDS:kc,MODIFY_DRAW_DEFINITION:xc,MODIFY_DRAW_ENTRIES:_c,MODIFY_EVENT_ENTRIES:Lc,MODIFY_MATCHUP:Vc,MODIFY_PARTICIPANTS:Bc,MODIFY_POSITION_ASSIGNMENTS:jc,MODIFY_SEED_ASSIGNMENTS:Gc,MODIFY_TOURNAMENT_DETAIL:qc,MODIFY_VENUE:$c,MUTATIONS:Wc,PUBLISH_EVENT_SEEDING:zc,PUBLISH_EVENT:Hc,PUBLISH_ORDER_OF_PLAY:Yc,UNPUBLISH_EVENT_SEEDING:Qc,UNPUBLISH_EVENT:Kc,UNPUBLISH_ORDER_OF_PLAY:Jc,UPDATE_INCONTEXT_MATCHUP:Xc};function eu(e,t){if(!e)return{error:M};let r=Date.now();e.updatedAt&&r===new Date(e.updatedAt).getTime()&&(r+=1);let i=new Date(r).toISOString(),n=t?.filter(Boolean);return e.updatedAt=i,e.structures?.filter(Boolean).forEach((e=>{(!n?.length||n?.includes(e.structureId))&&(e.updatedAt=i)})),{...I}}function tu({drawDefinition:e,tournamentId:t,matchUps:r,eventId:i}){return e&&eu(e),ki({payload:{matchUps:r,tournamentId:t,eventId:i},topic:bc}),{...I}}function ru({drawDefinition:e,tournamentId:t,matchUpIds:r,eventId:i,action:n}){e&&eu(e),ki({topic:kc,payload:{tournamentId:t,matchUpIds:r,eventId:i,action:n}});for(let a of r)Li({key:a});return{...I}}function iu({drawDefinition:e,tournamentId:t,structureId:r,context:i,eventId:n,matchUp:a}){return a?(e&&au({drawDefinition:e,structureIds:r?[r]:void 0,tournamentId:t,eventId:n}),ki({topic:Vc,payload:{matchUp:a,tournamentId:t,context:i},key:a.matchUpId}),{...I}):(console.log(Fe),{error:Fe})}function nu({tournamentId:e,eventId:t,drawDefinition:r}){return r?(eu(r),ki({payload:{drawDefinition:r,tournamentId:e,eventId:t},topic:Tc,key:r.drawId}),{...I}):(console.log(M),{error:M})}function au({drawDefinition:e,tournamentId:t,structureIds:r,eventId:i}){return e?(eu(e,r),ki({payload:{tournamentId:t,eventId:i,drawDefinition:e},topic:xc,key:e.drawId}),{...I}):{error:M}}function ou({drawDefinition:e,tournamentId:t,structure:r,eventId:i}){if(!e)return{error:M};if(!r)return{error:se};let n=r.seedAssignments,a=r.structureId;return ki({payload:{tournamentId:t,eventId:i,drawId:e.drawId,structureId:a,seedAssignments:n},topic:Gc,key:e.drawId}),au({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:i}),{...I}}function su({drawDefinition:e,tournamentId:t,structure:r,event:i}){if(!e)return{error:M};if(!r)return{error:se};let n=Pc({structure:r}),a=r.structureId,o=e.drawId,s=i?.eventId;return ki({topic:jc,payload:{positionAssignments:n,tournamentId:t,structureId:a,eventId:s,drawId:o},key:a}),au({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:s}),{...I}}function cu({tournamentRecord:e,drawDefinition:t,resetEntries:r,event:i}){if(!t)return{error:M};let n=t.structures?.find((e=>e.stage===ys));if(!n)return{error:ae};let a=n.matchUps?.map((({matchUpId:e})=>e))||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],ru({tournamentId:e?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:t}),r&&(t.entries=t.entries.filter((e=>e.entryStage!==ys))),au({tournamentId:e?.tournamentId,eventId:i?.eventId,drawDefinition:t,structureIds:[n.structureId]}),{...I}}function uu({drawPositions:e,structure:t}){if([Us,Is].includes(t.stage)&&1===t.stageSequence)return;let{positionAssignments:r}=Pc({structure:t});r?.filter((({drawPosition:t})=>e?.includes(t)))?.forEach((e=>{za({element:e,extension:{name:uo,value:!0}})}))}function du(e){let{appliedPolicies:t,positionAction:r,drawDefinition:i}=e;if(!1===t?.audit?.[wo])return;let{extension:n}=no({name:wo,element:i}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let e=i.structures.find((e=>e.stage===Is));if(e){let t=Pc({structure:e}).positionAssignments?.map((({drawPosition:e,participantId:t,bye:r,qualifier:i})=>({drawPosition:e,participantId:t,qualifier:i,bye:r})));a.push({name:"initialMainAssignments",initialAssignments:t})}}za({element:i,extension:{value:a.concat(r),name:wo}})}function lu({tournamentRecord:e,drawDefinition:t,event:r}){let i=(e?.events||r&&[r])?.map((e=>e?.drawDefinitions)).flat().filter(Boolean)||t&&[t]||[],n={},a={},o=i.map((e=>e?.structures?.filter((e=>e?.structures)))).flat().filter(Boolean);for(let s of o){let{structures:e,structureId:t}=s??{};e&&t&&(n[t]=e?.map((e=>e.structureId)))&&e.forEach((e=>a[e.structureId]=s?.structureId))}return{containedStructures:n,containerStructures:a}}var pu="SINGLES",mu="SINGLES",fu="DOUBLES",hu="DOUBLES",gu="TEAM",Iu="TEAM",Uu={SINGLES_MATCHUP:pu,SINGLES:mu,DOUBLES_MATCHUP:fu,DOUBLES:hu,TEAM_MATCHUP:gu,TEAM:Iu};function vu(e){let{sides:t,matchUpType:r}=e||{},i=e.potentialParticipants?.length?e.potentialParticipants.flat().map((e=>r===hu?e?.individualParticipantIds||[]:e.participantId)).flat():[],n=(t||[]).map((e=>r===hu&&(e?.participant?.individualParticipantIds||[])||e?.participantId&&[e.participantId]||[])).flat();return{individualParticipantIds:n.concat(i).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:i}}function yu(e){return e?.tournamentRecords??(e?.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{}}var Su="SIGN_IN_STATUS",wu="SIGNED_OUT",Pu="SIGNED_IN",Du="TEAM",Tu="INDIVIDUAL",bu="GROUP",Ru="PAIR",Mu="TEAM",Nu={TEAM_PARTICIPANT:Du,INDIVIDUAL:Tu,GROUP:bu,TEAM:Mu,PAIR:Ru},Au={INDIVIDUAL:Tu,GROUP:bu,PAIR:Ru,TEAM:Mu,SIGN_IN_STATUS:Su,SIGNED_OUT:wu,SIGNED_IN:Pu};function Eu({participantsProfile:e,participants:t=[],deepCopy:r}){let i=new Map,n=!1!==r?Da(t,e?.convertExtensions,!0):t,a=n.filter((e=>e.participantType===Mu)),o=n.filter((e=>e.participantType===bu)),s=n.filter((e=>e.participantType===Ru));return n.forEach((e=>{if(e.participantType===Tu){let{participantId:t}=e;e.groupParticipantIds=[],e.teamParticipantIds=[],e.pairParticipantIds=[],e.groups=[],e.teams=[],a.forEach((r=>{(r?.individualParticipantIds||[]).forEach((n=>{n===t&&!e.teamParticipantIds?.includes(r.participantId)&&(e.teamParticipantIds.push(r.participantId),i.get(r.participantId)||i.set(r.participantId,{participantName:r.participantName,participantId:r.participantId}),e.teams.push({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participantOtherName,participantName:r.participantName,participantId:r.participantId,teamId:r.teamId}))}))})),s.forEach((r=>{(r?.individualParticipantIds||[]).forEach((i=>{i===t&&!e.pairParticipantIds.includes(r.participantId)&&e.pairParticipantIds.push(r.participantId)}))})),o.forEach((r=>{(r?.individualParticipantIds||[]).forEach((i=>{i===t&&!e.groupParticipantIds.includes(r.participantId)&&(e.groupParticipantIds.push(r.participantId),e.groups.push({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participantOtherName,participantName:r.participantName,participantId:r.participantId}))}))}))}})),{participantsWithGroupings:n,groupInfo:Object.fromEntries(i)}}var Cu=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Ou({participant:e,withISO2:t,withIOC:r}){let{person:i,individualParticipants:n}=e;[i,n?.map((({person:e})=>e))].flat().filter(Boolean).forEach((function(e){let{nationalityCode:i}=e||{};if(i){let n=Cu.find((({iso:e})=>e===i));r&&n?.ioc&&!e.iocNationalityCode&&(e.iocNationalityCode=n.ioc),t&&n?.iso2&&!e.iso2NationalityCode&&(e.iso2NationalityCode=n.iso2),n?.label&&!e.countryName&&(e.countryName=n.label)}}))}function Fu(e){let{tournamentRecord:t,participantId:r}=e,i=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};for(let n of Object.values(i)){let e=n.participants?.find((e=>e.participantId===r));if(e)return{participant:e,tournamentId:n.tournamentId}}return{error:Ut}}function ku(e){let{tournamentRecord:t,participantId:r}=e;if(r){let e=Fu({tournamentRecord:t,participantId:r});return e.participant??e}return e.element||e.drawDefinition||e.event||e.tournamentRecord||{error:He}}function xu(e){let{returnPreviousValues:t,itemSubTypes:r,itemType:i}=e,n=ku(e);if(n.error)return n;if(r&&!Array.isArray(r))return{error:mr,context:{itemSubTypes:r}};if(!Array.isArray(n.timeItems))return{error:er};let a=n.timeItems.filter((e=>e?.itemType===i)).filter((e=>!r?.length||r.some((t=>e?.itemSubTypes?.includes(t))))).sort(((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime())),o=a.pop();if(o){let e={timeItem:o,...I};return t&&Object.assign(e,{previousItems:a}),e}return{info:vr}}function _u({returnPreviousValues:e,drawDefinition:t,itemSubTypes:r,itemType:i}){if(!t)return{error:H};if(!t.timeItems)return{info:vr};let{timeItem:n,previousItems:a,info:o}=xu({element:t,returnPreviousValues:e,itemSubTypes:r,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function Lu({returnPreviousValues:e,itemSubTypes:t,itemType:r,event:i}){if(!i)return{error:de};if(!i.timeItems)return{info:vr};let{timeItem:n,previousItems:a,info:o}=xu({returnPreviousValues:e,element:i,itemSubTypes:t,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function Vu({returnPreviousValues:e,tournamentRecord:t,itemSubTypes:r,itemType:i}){if(!t)return{error:D};if(!t.timeItems)return{info:vr};let{timeItem:n,previousItems:a,info:o}=xu({element:t,returnPreviousValues:e,itemSubTypes:r,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function Bu({returnPreviousValues:e,tournamentRecord:t,participantId:r,itemSubTypes:i,itemType:n}){if(!t)return{error:D};if(!r)return{error:It};let a=Fu({tournamentRecord:t,participantId:r});if(a.error)return a;let{participant:o}=a;if(!o?.timeItems)return{info:vr};let{timeItem:s,previousItems:c,info:u}=xu({element:a.participant,returnPreviousValues:e,itemSubTypes:i,itemType:n});return s&&{timeItem:s,previousItems:c}||{info:u}}var ju={[bu]:"groupParticipantIds",[Ru]:"pairParticipantIds",[Mu]:"teamParticipantIds"},Gu={[bu]:"groups",[Mu]:"teams"};function qu({withIndividualParticipants:e,convertExtensions:t,tournamentRecord:r,withSignInStatus:i,withScaleValues:n,internalUse:a,withISO2:o,withIOC:s}){let c={};for(let u of r.participants??[]){let e=u?.participantId;e&&Hu({participantMap:c,participantId:e})}for(let u of r.participants??[]){let e=Da(u,t,a),{participantId:r,individualParticipantIds:d,participantType:l}=e;if(Object.assign(c[r].participant,e),d&&Wu({individualParticipantIds:d,participantCopy:e,participantMap:c,participantType:l,participantId:r}),i&&(c[r].participant.signedIn=$u(e)),n){let{ratings:t,rankings:i,seedings:n}=$n({participant:e});c[r].participant.seedings=n,c[r].participant.rankings=i,c[r].participant.ratings=t}(s||o)&&Ou({participant:c[r].participant,withISO2:o,withIOC:s})}if(e){!function({participantMap:e,template:t}){let r=Object.values(e);for(let i of r){let r=i.participant;if(r.individualParticipantIds?.length){r.individualParticipants=[];for(let i of r.individualParticipantIds){let n=e[i].participant;r.individualParticipants.push(t?Wn({template:t,source:n}):n)}}}}({participantMap:c,template:d(e)?e:void 0})}return{participantMap:c}}function $u(e){let{timeItem:t}=xu({itemType:Su,element:e});return t?.itemValue===Pu}function Wu({individualParticipantIds:e,participantCopy:t,participantMap:r,participantType:i,participantId:n}){for(let a of e){let o=r[a].participant;if(o[ju[i]].push(n),[Mu,bu].includes(i)){let{participantRoleResponsibilities:e,participantOtherName:r,participantName:n,participantId:a,teamId:s}=t;o[Gu[i]].push({participantRoleResponsibilities:e,participantOtherName:r,participantName:n,participantId:a,teamId:s})}if(i===Ru){let t=e.find((e=>e!==a));r[a].pairIdMap[n]=t,r[a].pairIdMap[t]=n}}}function Hu({participantMap:e,participantId:t}){if(e[t])return;let r={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};e[t]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[mu]:{...r},[hu]:{...r},[Mu]:{...r},...r}}}function zu({participantsProfile:e,useParticipantMap:t,tournamentRecord:r,contextProfile:i,inContext:n}){if(t)return{participantMap:qu({...e,...i,tournamentRecord:r})?.participantMap};let a,o=Da(r.participants,!1,!0)||[];if((e?.withIOC||e?.withISO2)&&o.forEach((t=>Ou({participant:t,...e}))),(n||e?.withGroupings)&&o?.length&&({participantsWithGroupings:o,groupInfo:a}=Eu({participantsProfile:e,deepCopy:!1,participants:o})),e?.withScaleValues&&o?.length)for(let s of o){let{ratings:e,rankings:t}=$n({participant:s});s.rankings=t,s.ratings=e}return{participants:o,groupInfo:a}}function Yu({onlySpecifiedPolicyTypes:e=!1,policyTypes:t=[],tournamentRecord:r,drawDefinition:i,structure:n,event:a}){if(!Array.isArray(t))return{error:xe};let o={};return r&&s(r),a&&s(a),i&&s(i),n&&s(n),{appliedPolicies:o,...I};function s(r){let i=r?.extensions?.find((e=>e.name===ao))?.value;if(i)for(let n of Object.keys(i))(e?t.includes(n):!t.length||t.includes(n))&&(o[n]=Da(i[n],!1,!0))}}function Ku({policyTypes:e=[],tournamentRecord:t,drawDefinition:r,structure:i,event:n}){if(!Array.isArray(e))return{error:xe};let{appliedPolicies:a}=Yu({tournamentRecord:t,drawDefinition:r,structure:i,event:n}),o={};for(let s of e){let e=a?.[s];e&&(o[s]=e)}return Object.keys(o).length?{policyDefinitions:o}:{info:Ge.message}}var Qu="WALKOVER",Ju="RETIRED",Xu="COMPETITIVE",Zu="ROUTINE",ed="DECISIVE",td="winRatio",rd={[Ra]:{policyName:"Competitive Bands Default",profileBands:{[ed]:20,[Zu]:50}}};function id({policyDefinitions:e,tournamentRecord:t,contextProfile:r,drawDefinition:i,event:n}){let a={policies:{}};if(!r)return a;let o=Ku({tournamentRecord:t,drawDefinition:i,event:n}).policyDefinitions;if(r.withCompetitiveness){let t=e?.[Ra]??o?.[Ra]??rd[Ra];a.policies[Ra]=t}return a}function nd({tournamentRecord:e,drawDefinition:t,policyType:r,structure:i,event:n}){if(!e)return{error:D};let{appliedPolicies:a}=Yu({tournamentRecord:e,drawDefinition:t,structure:i,event:n});return a?.[r]?{policy:a[r]}:{info:Ge?.message}}function ad({tournamentRecord:e,categoryName:t,categoryType:r,event:i}){t=t??i?.category?.categoryName??i?.category?.ageCategoryCode,r=r??i?.category?.categoryType??i?.category?.subType;let{policy:n}=nd({policyType:ka,tournamentRecord:e,event:i}),a=(e?no({element:e,name:To}).extension:void 0)?.value,o=(i&&no({name:To,element:i}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:o,categoryName:t,categoryType:r,policy:n}}}function od({drawDefinition:e,attributes:t}){let{extension:r}=no({element:e,name:fo}),i=r?.value||{};return t.forEach((e=>{Object.keys(e).forEach((t=>{i[t]?Object.assign(i[t],e[t]):i[t]=e[t]}))})),r={name:fo,value:i},Ka({drawDefinition:e,extension:r}),{entryProfile:i}}function sd({drawDefinition:e}){let{extension:t}=no({element:e,name:fo});return{entryProfile:t?.value||{}}}var cd="ALTERNATE",ud="CONFIRMED",dd="DIRECT_ACCEPTANCE",ld="FEED_IN",pd="JUNIOR_EXEMPT",md="LUCKY_LOSER",fd="ORGANISER_ACCEPTANCE",hd="QUALIFIER",gd="SPECIAL_EXEMPT",Id="UNGROUPED",Ud="UNPAIRED",vd="WILDCARD",yd="WITHDRAWN",Sd=[ud,dd,pd,fd,gd],wd=[ld,md,hd],Pd=[ud,dd,ld,pd,fd,gd,vd],Dd=[ud,dd,pd,md,hd,fd,gd,vd],Td=[cd,ud,dd,ld,pd,md,fd,hd,"REGISTERED",gd,Id,Ud,vd,yd],bd={ALTERNATE:cd,CONFIRMED:ud,DIRECT_ACCEPTANCE:dd,DIRECT_ENTRY_STATUSES:Pd,DRAW_SPECIFIC_STATUSES:wd,EQUIVALENT_ACCEPTANCE_STATUSES:Sd,FEED_IN:ld,JUNIOR_EXEMPT:pd,LUCKY_LOSER:md,ORGANISER_ACCEPTANCE:fd,QUALIFIER:hd,SPECIAL_EXEMPT:gd,STRUCTURE_SELECTED_STATUSES:Dd,UNGROUPED:Id,UNPAIRED:Ud,VALID_ENTRY_STATUSES:Td,WILDCARD:vd,WITHDRAWN:yd};function Rd({stage:e,drawDefinition:t}){let{entryProfile:r}=sd({drawDefinition:t}),i=Object.keys(r).includes(e);if(!i&&ws.includes(e)){return od({drawDefinition:t,attributes:[{[e]:{drawSize:void 0,alternates:!0}}]}),!0}return i}function Md({stage:e,drawDefinition:t,entryStatus:r}){return t.entries.reduce(((t,i)=>i.entryStage===e&&i.entryStatus===r?t+1:t),0)}function Nd({provisionalPositioning:e,placementGroup:t,drawDefinition:r,stageSequence:i,entryStatuses:n,structureId:a,roundTarget:o,stages:s,stage:c}){let u=r.entries?.reduce(((e,t)=>{let r=no({name:Po,element:t})?.extension?.value,a=c&&t.entryStage===c||s?.length&&t.entryStage&&s.includes(t.entryStage),u=!n||t.entryStatus&&n.includes(t.entryStatus),d=t.entryStageSequence??1;return!a||i&&d!==i||!u||o&&r&&o!==r?e:e.concat(t)}),[])??[];if(a&&c===Ss){let{playoffEntries:i,error:n}=function({provisionalPositioning:e,drawDefinition:t,structureId:r}){let i=[],n=(t.links??[]).find((e=>e.linkType===xs&&e.target.structureId===r));if(n){let{finishingPositions:r,structureId:a}=n.source,{structure:o}=yc({drawDefinition:t,structureId:a});o?.structureType===Es&&(o.structures??[]).forEach((t=>{let n=t.positionAssignments??[],{structureId:a}=t,o=a,s=Object.assign({},...n.map((e=>{let{participantId:t}=e,r=no({element:e,name:Mo}).extension?.value;return r&&t?{[t]:r}:void 0})).filter(Boolean)),c=Object.keys(s).reduce(((t,r)=>{let i=s[r],n=i.groupOrder||e&&i.provisionalOrder;return t.includes(n)||t.push(n),t}),[]).length===Object.keys(s).length,u=Object.keys(s).filter((t=>{let i=s[t],n=i.groupOrder||e&&i.provisionalOrder;return r?.includes(n)}));(!e||c)&&u.forEach((t=>{let n=s[t],{groupOrder:a,provisionalOrder:c,GEMscore:u}=n,d=a||e&&c,l=[...r??[]].sort(kr).indexOf(d)+1;i.push({entryStage:Ss,entryStatus:ld,placementGroup:l,groupingValue:o,participantId:t,GEMscore:u})}))}))}return{playoffEntries:i}}({provisionalPositioning:e,drawDefinition:r,structureId:a});return n&&console.log("playoff entries error"),(i?.length?i:u).filter((e=>!t||e.placementGroup===t))}return u}function Ad({provisionalPositioning:e,returnAllProxies:t,drawDefinition:r,structureId:i,structure:n}){let a,o=[];n||({structure:n,error:a}=yc({drawDefinition:r,structureId:i}));let s=Pc({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:ae};i||(i=n.structureId);let{stage:c,stageSequence:u}=n,d=c===Ss&&r&&Nd({provisionalPositioning:e,drawDefinition:r,stageSequence:u,structureId:i,stage:c}),l=d?d.filter((e=>1===e.placementGroup)).sort(((e,t)=>(e.GEMscore<t.GEMscore?1:e.GEMscore>t.GEMscore&&-1)||0)).map(((e,t)=>{let r=t+1;return{participantId:e.participantId,seedValue:r,seedProxy:!0,seedNumber:r}})):[],p=l?.slice(0,t?l.length:s.length/2);return p.length?o=p:n.seedAssignments?o=n.seedAssignments:a=Z,{seedAssignments:o,stageSequence:u,seedLimit:n.seedLimit??n?.positionAssignments?.length,stage:c,error:a}}var Ed=(e,t)=>(e||0)+(t||0);function Cd(e,t){let r=Array.isArray(e)?e[0]:e;return isNaN(r)&&Qu||r<=t[ed]&&ed||r<=t[Zu]&&Zu||Xu}function Od({score:e}){let t=e?.sets||[],r=t.reduce(((e,t)=>(e[0]+=t.side1Score||0,e[1]+=t.side2Score||0,e)),[0,0]),i=t.reduce(((e,t)=>(e[0]+=t.side1TiebreakScore||0,e[1]+=t.side2TiebreakScore||0,e)),[0,0]);return i.reduce(Ed)&&(r[i[0]>i[1]?0:1]+=1),{sets:t,games:r,score:e}}function Fd(e){let t=Math.min(...e.games),r=Math.max(...e.games);return Math.round(t/r*100)}function kd(e){return e.map(Fd).sort().map((e=>parseFloat(e.toFixed(2))))}function xd({tournamentRecord:e,profileBands:t,matchUp:r}){if(!r)return{error:Fe};let{score:i,winningSide:n}=r;if(!n)return{error:mr};let a=!t&&e&&nd({policyType:Ra,tournamentRecord:e}).policy,o=t||a?.profileBands||rd[Ra].profileBands,s=kd([Od({score:i})]),c=Cd(s,o),u=Array.isArray(s)?s[0]:s;return{...I,competitiveness:c,pctSpread:u}}function _d({matchUp:e}){if(!e)return{error:Fe};if(e&&!e.sides)return{error:ke};if(e&&!e.hasContext)return{error:tr};let t=(e.sides??[])?.map((e=>e?.participantId)).filter(Boolean),r=e.sides?.filter((e=>e.participant?.participantType===Tu)).map((e=>e.participantId)).filter(Boolean)??[],i=((e.sides??[])?.map((e=>e.participant?.individualParticipants)).filter(Boolean)??[]).map((e=>(e??[]).map((e=>e?.participantId)).filter(Boolean))),n=[...r,...i.flat()].filter(Boolean)??[];return{nestedIndividualParticipantIds:i,allRelevantParticipantIds:Yr(n.concat(t)).filter(Boolean)??[],individualParticipantIds:n,sideParticipantIds:t,...I}}var Ld="CHECK_IN",Vd="CHECK_OUT",Bd="SCHEDULE.ASSIGNMENT.VENUE",jd="SCHEDULE.ALLOCATION.COURTS",Gd="SCHEDULE.ASSIGNMENT.COURT",qd="SCHEDULE.COURT.ORDER",$d="SCHEDULE.DATE",Wd="HOME_PARTICIPANT_ID",Hd="SCHEDULE.ASSIGN.OFFICIAL",zd="SCHEDULE.TIME.SCHEDULED",Yd="SCHEDULE.TIME.START",Kd="SCHEDULE.TIME.STOP",Qd="SCHEDULE.TIME.RESUME",Jd="SCHEDULE.TIME.END",Xd="SCHEDULE.TIME.MODIFIERS",Zd="TO_BE_ANNOUNCED",el="NEXT_AVAILABLE",tl="FOLLOWED_BY",rl="AFTER_REST",il="RAIN_DELAY",nl=[Zd,el,tl,rl,il],al="SCALE",ol="RATING",sl="RANKING",cl="SEEDING",ul="PUBLISH",dl="PUBLIC",ll="STATUS",pl={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:nl,AFTER_REST:rl,ALLOCATE_COURTS:jd,ASSIGN_COURT:Gd,ASSIGN_OFFICIAL:Hd,ASSIGN_VENUE:Bd,CHECK_IN:Ld,CHECK_OUT:Vd,COMPLETED_DATE:"COMPLETED.DATE",COURT_ORDER:qd,ELIGIBILITY:"ELIGIBILITY",END_TIME:Jd,FOLLOWED_BY:tl,MEDICAL:"MEDICAL",MODIFICATION:"MODIFICATION",NEXT_AVAILABLE:el,NOT_BEFORE:"NOT_BEFORE",OTHER:"other",PENALTY:"PENALTY",PUBLIC:dl,PUBLISH:ul,RANKING:sl,RATING:ol,RAIN_DELAY:il,REGISTRATION:"REGISTRATION",RESUME_TIME:Qd,RETRIEVAL:"RETRIEVAL",SCALE:al,SCHEDULE:"SCHEDULE",SCHEDULED_DATE:$d,SCHEDULED_TIME:zd,SEEDING:cl,START_TIME:Yd,STATUS:ll,STOP_TIME:Kd,SUSPENSION:"SUSPENSION",TIME_MODIFIERS:Xd,TO_BE_ANNOUNCED:Zd};function ml({matchUp:e}){if(!e)return{error:Fe};if(!e.hasContext)return{error:tr};if(!e.sides||2!==e.sides.filter(Boolean).length)return{error:ke};let{nestedIndividualParticipantIds:t,allRelevantParticipantIds:r,sideParticipantIds:i}=_d({matchUp:e}),n=(e.timeItems??[]).filter((e=>e?.itemType&&[Ld,Vd].includes(e.itemType))).sort(((e,t)=>(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0))),a=n.map((e=>e.itemValue)).filter((e=>n.filter((t=>t?.itemValue===e)).reverse()[0].itemType===Ld));t?.forEach(((e,t)=>{let r=i?.[t],n=e?.length&&e.every((e=>a.includes(e)));r&&n&&!a.includes(r)&&a.push(r)})),i?.forEach(((e,r)=>{a.includes(e)&&(t?.[r]??[]).forEach((e=>{e&&!a.includes(e)&&a.push(e)}))}));let o=i?.reduce(((e,t)=>a.includes(t)&&e),!0);return{allRelevantParticipantIds:r,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...I}}var fl={[mu]:[mu,"S"],[hu]:[hu,"D"],[Iu]:[Iu,"T"],S:[mu,"S"],D:[hu,"D"],T:[Iu,"T"]},hl=e=>t=>{let r=d(t)&&t?.matchUpType||u(t)&&t;return r&&fl[e].includes(r)};function gl(e){let{matchUpAverageTimes:t,matchUpFormat:r}=e||{},i=t?.map((({matchUpFormatCodes:e})=>e?.filter((e=>e===r)))).flat().filter(Boolean).sort(((e,t)=>(e?.length||0)-(t?.length||0)))||[],n=i.includes(r)?r:i[0];return t?.find((({matchUpFormatCodes:e,averageTimes:t})=>e?.find((e=>n===e))&&t))?.averageTimes}function Il(e){let{matchUpRecoveryTimes:t,averageMinutes:r,matchUpFormat:i}=e||{};return t?.find((({matchUpFormatCodes:e,averageTimes:t,recoveryTimes:n})=>{if(t&&r){let{greaterThan:e=0,lessThan:i=360}=t;if(r>e&&r<i)return!0}return e?.find((e=>e===i))&&n}))?.recoveryTimes}function Ul({timesBlockArray:e,categoryName:t,categoryType:r}){return e.filter((e=>Array.isArray(e))).map((e=>e.sort(((e,t)=>(t.categoryNames?.length||0)-(e.categoryNames?.length||0))).find((({categoryTypes:e,categoryNames:i})=>!i?.length&&!e?.length||i?.includes(t)||e?.includes(r))))).find(Boolean)}var vl="DOUBLES_SINGLES",yl="SINGLES_DOUBLES",Sl="total",wl="participantConflict",Pl="matchUpConflict",Dl="ISSUE_IDS",Tl="CONFLICT",bl="WARNING",Rl="ERROR",Ml="ISSUE",Nl="STATE",Al={SINGLES_DOUBLES:yl,DOUBLES_SINGLES:vl,TOTAL:Sl,CONFLICT_MATCHUP_ORDER:Pl,CONFLICT_PARTICIPANTS:wl,SCHEDULE_ISSUE_IDS:Dl,SCHEDULE_CONFLICT:Tl,SCHEDULE_WARNING:bl,SCHEDULE_ERROR:Rl,SCHEDULE_ISSUE:Ml,SCHEDULE_STATE:Nl},El="SINGLES",Cl="SINGLES",Ol="DOUBLES",Fl="DOUBLES",kl="TEAM",xl="TEAM",_l={AGE:"AGE",BOTH:"BOTH",DOUBLES:Ol,DOUBLES_EVENT:Fl,RATING:"RATING",SINGLES:El,SINGLES_EVENT:Cl,TEAM_EVENT:xl,TEAM:kl};function Ll({defaultAverageMinutes:e=90,defaultRecoveryMinutes:t=0,tournamentRecord:r,matchUpFormat:i,categoryName:n,categoryType:a,eventType:o,event:s}){if(!r)return{error:D};o=o??s?.eventType??Cl;let c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},{scheduleTiming:u}=ad({tournamentRecord:r,categoryName:n,categoryType:a,event:s});return Vl({eventType:o,timingDetails:{...u,matchUpFormat:i,categoryType:a,defaultTiming:c}})}function Vl({timingDetails:e,eventType:t}){let r=function({matchUpFormat:e,categoryName:t,categoryType:r,defaultTiming:i,tournamentScheduling:n,eventScheduling:a,policy:o}){return Ul({categoryName:t,categoryType:r,timesBlockArray:[a?.matchUpAverageTimes&&gl({...a,matchUpFormat:e}),n?.matchUpAverageTimes&&gl({...n,matchUpFormat:e}),o?.matchUpAverageTimes&&gl({...o,matchUpFormat:e}),o?.defaultTimes?.averageTimes,i?.averageTimes]})}(e),i=Object.keys(r?.minutes||{}),n=r?.minutes&&(i?.includes(t)&&r.minutes[t]||r.minutes.default),a=function({tournamentScheduling:e,eventScheduling:t,averageMinutes:r,defaultTiming:i,matchUpFormat:n,categoryName:a,categoryType:o,policy:s}){return Ul({categoryName:a,categoryType:o,timesBlockArray:[t?.matchUpRecoveryTimes&&Il({...t,averageMinutes:r,matchUpFormat:n}),e?.matchUpRecoveryTimes&&Il({...e,averageMinutes:r,matchUpFormat:n}),s?.matchUpRecoveryTimes&&Il({...s,averageMinutes:r,matchUpFormat:n}),s?.defaultTimes?.recoveryTimes,i?.recoveryTimes]})}({...e,averageMinutes:n}),o=Object.keys(a?.minutes||{}),s=a?.minutes&&(o?.includes(t)&&a.minutes[t]||a.minutes.default),c=hl(Cl)(t)?yl:vl;return{averageMinutes:n,recoveryMinutes:s,typeChangeRecoveryMinutes:a?.minutes&&(o?.includes(c)&&a.minutes[c]||s)}}function Bl(e){return e.createdAt?new Date(e.createdAt).getTime():0}function jl({visibilityThreshold:e,timeItems:t,itemType:r}){let i=t.filter((t=>t&&t.itemType===r&&(!e||Bl(t)<new Date(e).getTime()))).sort(((e,t)=>Bl(e)-Bl(t))).pop(),n=i&&Bl(i);return{itemValue:i?.itemValue,timeStamp:n}}function Gl({visibilityThreshold:e,timeStamp:t,schedule:r,matchUp:i}){let{itemValue:n,timeStamp:a}=jl({timeItems:i?.timeItems||[],itemType:zd,visibilityThreshold:e});return!r||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{scheduledTime:n}:r}function ql({visibilityThreshold:e,timeStamp:t,schedule:r,matchUp:i}){let{itemValue:n,timeStamp:a}=jl({timeItems:i?.timeItems||[],itemType:$d,visibilityThreshold:e});return!r||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{scheduledDate:n}:r}function $l({visibilityThreshold:e,timeStamp:t,schedule:r,matchUp:i}){let{itemValue:n,timeStamp:a}=jl({timeItems:i?.timeItems||[],itemType:jd,visibilityThreshold:e});return!r||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{allocatedCourts:Da(n,!1,!0)}:r}function Wl({visibilityThreshold:e,timeStamp:t,schedule:r,matchUp:i}){let{itemValue:n,timeStamp:a}=jl({timeItems:i?.timeItems||[],itemType:Gd,visibilityThreshold:e});return!r||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{courtId:n}:r}function Hl({visibilityThreshold:e,timeStamp:t,schedule:r,matchUp:i}){let{itemValue:n,timeStamp:a}=jl({timeItems:i?.timeItems||[],itemType:Bd,visibilityThreshold:e});return!r||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{venueId:n}:r}function zl({visibilityThreshold:e,timeStamp:t,schedule:r,matchUp:i}){let{itemValue:n,timeStamp:a}=jl({timeItems:i?.timeItems||[],itemType:Xd,visibilityThreshold:e});return!r||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{timeModifiers:n}:r}function Yl(e){if(zn.test(e)){let t=ea();return new Date(`${t}T${e}`)}return new Date(e)}function Kl(e){let t=(e,t=2)=>("00"+e).slice(-t);return t(e/36e5|0)+":"+t(e%36e5/6e4|0)+":"+t(e%6e4/1e3|0)}function Ql(e=1){return ai(0,e).map(Jl)}function Jl(){let e=[];for(let a=0;a<256;a++)e[a]=(a<16?"0":"")+a.toString(16);let t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}function Xl(e){let{disableNotice:t,venue:r,context:i}=e;if("object"!=typeof r)return{error:mr};let n,a=yu(e);r.venueId||(r.venueId=Jl());for(let o of Object.values(a)){let e=Zl({disableNotice:!0,tournamentRecord:o,context:i,venue:r});if(e?.error)return e;n=e.venue}return t||ki({topic:Nc,payload:{venue:r}}),Zi({...I,venue:n})}function Zl({tournamentRecord:e,disableNotice:t,context:r,venue:i}){return e?i?(e.venues||(e.venues=[]),i.venueId||(i.venueId=Jl()),e.venues.reduce(((e,t)=>e||t.venueId===i.venueId),void 0)?{error:qt}:(r&&za({element:i,extension:{value:r,name:oo}}),e.venues.push(i),t||ki({payload:{venue:i,tournamentId:e.tournamentId},topic:Nc}),{...I,venue:Da(i)})):{error:He,info:"missing venue"}:{error:D}}function ep({tournamentRecords:e,tournamentRecord:t,venueId:r}){if(!t)return{error:D};if(!r)return{error:Wt};let i=(t.venues??[]).reduce(((e,t)=>t.venueId===r?t:e),void 0);if(!i&&e){let n=(xo({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(let a of n){let n=ep({tournamentRecord:e[a],venueId:r});if(n.success&&n.venue)return Xl({tournamentRecord:t,venue:n.venue}),{...I,venue:i}}}return i?{...I,venue:i}:{error:$t}}function tp({convertExtensions:e,...t}){let{tournamentRecords:r,tournamentRecord:i,venueId:n}=t;return Da(ep({tournamentRecords:r,tournamentRecord:i,venueId:n}),e,!0)}function rp({tournamentRecords:e,tournamentRecord:t,courtId:r}){if(!t)return{error:D};if(!r)return{error:We};let i,n;if((t.venues??[]).forEach((e=>{(e.courts??[]).forEach((t=>{t.courtId===r&&(i=t,n=e)}))})),i)return{...I,court:i,venue:n};if(e){let a=(xo({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(let o of a){let a=rp({tournamentRecord:e[o],courtId:r});if(a.success)return a.venue&&Xl({tournamentRecord:t,venue:a.venue}),{...I,court:i,venue:n}}}return en({result:{error:jt},stack:"findCourt"})}function ip(e){return Da(rp(e),!1,!0)}function np({tournamentRecord:e,internalUse:t,courtId:r}){if(!e)return{error:D};if(!r)return{error:We};let i=rp({tournamentRecord:e,courtId:r});if(i.error)return i;let n=i.court&&(({altitude:e,courtId:t,courtName:r,courtDimensions:i,latitude:n,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:c,pace:u,notes:d})=>({altitude:e,courtId:t,courtName:r,courtDimensions:i,latitude:n,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:c,pace:u,notes:d}))(i.court);return{...I,courtInfo:Da(n,!1,t)}}function ap({tournamentRecord:e,venueId:t}){if(!e)return{error:D};if(!t)return{error:Wt};let r=ep({tournamentRecord:e,venueId:t});if(r.error)return r;let i=(r.venue?.courts??[]).map((t=>(({courtInfo:e})=>({...e}))(np({courtId:t.courtId,internalUse:!0,tournamentRecord:e})))),n=r.venue&&(({venueId:e,venueName:t,venueAbbreviation:r})=>({venueAbbreviation:r,venueName:t,venueId:e}))(r.venue),a=n&&{...n,courtsInfo:i};return{...I,venueData:Da(a,!1,!0)}}function op({event:e,eventId:t}){if(!e)return{error:de};let r=no({name:ho,element:e})?.extension,i=t?Da(r?.value,!1,!0):r?.value;return t&&e.drawDefinitions?.forEach((e=>{i?.flights?.forEach((t=>{t.drawId===e.drawId&&Object.assign(t,{drawDefinition:e})}))})),{flightProfile:i}}function sp(e){let t,{tournamentRecord:r,eventId:i,drawId:n}=e,a="findEvent",o={},s=e.tournamentRecords??(r&&{[r.tournamentId]:r})??{},c=Object.values(s).map((({events:e,tournamentId:t})=>(e&&e.forEach((e=>{o[e.eventId]={tournamentId:t}})),e??[]))).flat();if(n){let e,r=c.find((r=>{let i=(r?.drawDefinitions??[]).find((e=>e.drawId===n));if(i)e=i,t=o[r.eventId].tournamentId;else{let e=(r&&op({event:r})?.flightProfile)?.flights?.find((e=>e.drawId===n));if(e)return t=o[r.eventId].tournamentId,{entries:e.drawEntries,drawName:e.drawName,tournamentId:t,drawId:n}}return i}));if(r)return{event:r,drawDefinition:e,tournamentId:t}}if(i){let e=c.find((e=>e?.eventId===i));return e?(t=o[e.eventId].tournamentId,{event:e,drawDefinition:void 0,tournamentId:t}):{event:void 0,drawDefinition:void 0,...en({result:{error:le},stack:a})}}return{event:void 0,drawDefinition:void 0,...en({result:{error:A},context:{drawId:n,eventId:i},stack:a})}}function cp(e){let{visibilityThreshold:t,timeStamp:r,schedule:i,matchUp:n}=e,a=xn(e,[{[Sn]:!0}]);if(a.error)return a;let{itemValue:o,timeStamp:s}=jl({timeItems:n?.timeItems||[],itemType:Wd,visibilityThreshold:t});return!i||s&&r&&new Date(s).getTime()>new Date(r).getTime()?{homeParticipantId:o}:i}function up(e){let t=e.event,r=e.matchUpType,{scheduleVisibilityFilters:i,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:o,scheduleTiming:s,matchUpFormat:c,publishStatus:u,matchUp:d}=e;if(!d)return{error:Fe};if(n&&!d.matchUpType&&!e.matchUpType&&(t||a)&&d.drawId){let i=t?.drawDefinitions?.find((e=>e.drawId===d.drawId));!i&&a&&({drawDefinition:i,event:t}=sp({tournamentRecord:a,drawId:d.drawId}));let n=d.structureId&&i?.structures?.find((({structureId:e})=>e===d.structureId));r=e.matchUpType||n?.matchUpType||i?.matchUpType||t?.eventType!==kl&&t?.eventType}let l,{milliseconds:p,time:m}=function({matchUp:e}){if(!e)return{error:Fe};if(!e.timeItems)return{error:er};let t=e.timeItems.filter((e=>[Yd,Kd,Qd,Jd].includes(e?.itemType))).sort(((e,t)=>Yl(e.itemValue).getTime()-Yl(t.itemValue).getTime())),r=t.reduce(((e,t)=>{let r,i=t?.itemType?.split("."),n=`SCHEDULE.TIME.${t?.itemType?.startsWith("SCHEDULE.TIME")&&i[2]}`;switch(n){case Yd:r=0;break;case Jd:if(e.lastValue&&[Yd,Qd].includes(e.lastType)){let i=Yl(t.itemValue).getTime()-Yl(e.lastValue).getTime();r=e.milliseconds+i}else r=e.milliseconds;break;case Kd:if([Yd,"SCHECULE.TIME.RESUME"].includes(e.lastType)){let i=Yl(t.itemValue).getTime()-Yl(e.lastValue).getTime();r=e.milliseconds+i}else r=e.milliseconds;break;default:r=e.milliseconds}return{milliseconds:r,lastType:n,lastValue:t.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([Yd,Qd].includes(r.lastType)){let e=(new Date).getTime()-Yl(r.lastValue).getTime();r.milliseconds+=e}return{milliseconds:r.milliseconds,time:Kl(r.milliseconds),relevantTimeItems:t}}({matchUp:d}),{startTime:f}=function({matchUp:e}){let t=e?.timeItems||[],r=e=>e.createdAt?new Date(e.createdAt).getTime():0;return{startTime:t.reduce(((e,t)=>{let i=t.itemType===Yd&&t;return i&&(!e||r(i)<r(e))?i:e}),void 0)?.itemValue}}({matchUp:d}),{endTime:h}=function({matchUp:e}){let t=e?.timeItems||[],r=e=>e.createdAt?new Date(e.createdAt).getTime():0;return{endTime:t.reduce(((e,t)=>{let i=t.itemType===Jd&&t;return i&&(!e||r(i)>r(e))?i:e}),void 0)?.itemValue}}({matchUp:d}),{visibilityThreshold:g,eventIds:I,drawIds:U}=i??{};if(I&&!I.includes(d.eventId)||U&&!U.includes(d.drawId))l=Zi({milliseconds:p,startTime:f,endTime:h,time:m});else{let e,t,i,o,u,I={matchUp:d,visibilityThreshold:g},{allocatedCourts:U}=$l(I),{homeParticipantId:v}=cp(I),{scheduledTime:y}=Gl(I),{timeModifiers:S}=zl(I),{scheduledDate:w}=ql(I),{venueId:P}=Hl(I),{courtId:D}=Wl(I),{courtOrder:T}=function({visibilityThreshold:e,timeStamp:t,schedule:r,matchUp:i}){let{itemValue:n,timeStamp:a}=jl({timeItems:i?.timeItems||[],itemType:qd,visibilityThreshold:e});return!r||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{courtOrder:n}:r}(I),b=d.matchUpType??r;if(s&&y&&n&&b){let r={matchUpFormat:d.matchUpFormat??c,...s};({averageMinutes:t=0,recoveryMinutes:i=0,typeChangeRecoveryMinutes:o=0}=Vl({timingDetails:r,eventType:b})),(t||i)&&(e=h?va(da(h),i):va(y,t+i)),o&&(u=h?va(da(h),o):va(y,t+o))}!w&&y&&(w=la(y));let R=Qn({scheduledDate:w,scheduledTime:y}),M={},N=(a&&P&&ap({tournamentRecord:a,venueId:P}))?.venueData||{};P&&(M[P]=N);let{venueName:A,venueAbbreviation:E,courtsInfo:C}=N,O=(D&&C?.find((e=>e.courtId===D)))?.courtName;for(let r of U||[]){if(!a)break;r.venueId&&!M[r.venueid]&&(M[r.venueId]=ap({venueId:r.venueId,tournamentRecord:a})?.venueData);let e=M[r.venueId];r.venueName=e?.venueName;let t=e?.courtsInfo?.find((e=>e.courtId===r.courtId));r.courtName=t?.courtName}l=Zi({typeChangeTimeAfterRecovery:u,timeAfterRecovery:e,scheduledDate:w,scheduledTime:y,isoDateString:R,allocatedCourts:U,homeParticipantId:v,timeModifiers:S,venueAbbreviation:E,venueName:A,venueId:P,courtOrder:T,courtName:O,courtId:D,typeChangeRecoveryMinutes:o,recoveryMinutes:i,averageMinutes:t,milliseconds:p,startTime:f,endTime:h,time:m})}let{scheduledDate:v}=ql({matchUp:d}),{scheduledTime:y}=Gl({matchUp:d});if(o&&u?.displaySettings?.draws){let e=u.displaySettings.draws,t=(e?.[d.drawId]??e?.default)?.scheduleDetails;if(t){let e=(t.find((e=>v&&e.dates?.includes(v)))??t.find((e=>!e.dates?.length)))?.attributes;if(e){l=Wn({source:l,template:Object.assign({},...Object.keys(l).map((e=>({[e]:!0}))),e)})}}}return{schedule:l,endDate:d.matchUpStatus&&ms.includes(d.matchUpStatus)&&(la(h)||la(v)||la(y))||void 0}}function dp(e){if(!e)return;let{tieFormatId:t,tieFormats:r}=e;return e.tieFormat?e.tieFormat:t&&Array.isArray(r)?r.find((e=>e.tieFormatId===t)):void 0}function lp({item:e,drawDefinition:t,structure:r,event:i}){if(e){if(e.tieFormat)return e.tieFormat;if(e.tieFormatId){if(t.tieFormat)return t.tieFormat;let r=t.tieFormats?.find((t=>e.tieFormatId===t.tieFormatId));return r||(i.tieFormat?i.tieFormat:i.tieFormats?.find((t=>e.tieFormatId===t.tieFormatId)))}if(r.tieFormat)return r.tieFormat;if(r.tieFormatId){let e=t.tieFormats?.find((e=>r.tieFormatId===e.tieFormatId));if(e)return e}}}function pp({drawDefinition:e,structure:t,matchUp:r,event:i}){return{tieFormat:lp({item:r,drawDefinition:e,structure:t,event:i})||lp({item:t,drawDefinition:e,structure:t,event:i})||dp(e)||dp(i)}}function mp({drawDefinition:e,structure:t}){let r={},i=[];return(e?.structures??[t]).filter((e=>e&&"object"==typeof e)).forEach((e=>{if(!e)return;let{structureId:t,matchUps:n,structures:a}=e,o=Array.isArray(a);if(o)o&&a.forEach((e=>{let{structureName:n}=e,a=e.matchUps;r[e.structureId]={matchUps:a,itemStructureIds:[],structureName:n},a&&(i.push(...a),a.forEach((e=>{e.tieMatchUps&&i.push(...e.tieMatchUps)}))),r[t]||(r[t]={itemStructureIds:[],matchUps:[]}),r[t].itemStructureIds||(r[t].itemStructureIds=[]),r[t].itemStructureIds.push(e.structureId)}));else{let e=n;r[t]={matchUps:e,itemStructureIds:[]},e?.forEach((e=>{i.push(e),e.tieMatchUps&&i.push(...e.tieMatchUps)}))}})),{mappedMatchUps:r,drawMatchUps:i}}function fp({mappedMatchUps:e,matchUpsMap:t,structureId:r,inContext:i}){let n=(e=t?.mappedMatchUps??e)[r],a=(n?.itemStructureIds||[]).map((t=>{let{matchUps:n,structureName:a}=e[t];return i?n.map((e=>Object.assign(Da(e,!0,!0),{containerStructureId:r,structureId:t,structureName:a}))):n})).flat();return(n?.matchUps||[]).concat(...a)}function hp({groupedOrder:e,roundPositionsCount:t}){if(!e||e?.length<=t)return e;let r=pi(e,e.length/t).map((e=>e.reduce(((e,t)=>e+t)))),i=r.slice().sort(kr);return r.map((e=>i.indexOf(e)+1))}function gp(e){if(!d(e))return!1;let{matchUpId:t,drawPositions:r}=e,i="string"==typeof t,n=!r||Array.isArray(r)&&r.length<=2&&r.every((e=>Wr(e)||null==e));return i&&n}function Ip(e){return!!Array.isArray(e)&&e.every(gp)}function Up({matchUps:e=[],interpolate:t}){if(!Ip(e))return{roundMatchUps:[],error:mr};let r=e.reduce(((e,t)=>{let r="string"==typeof t.roundNumber?xr(t.roundNumber):t.roundNumber;return!t.roundNumber||e.includes(r)?e:e.concat(r)}),[]).sort(kr).map((t=>{let r=e.filter((e=>e.roundNumber===t)),i=r.find((({matchUpType:e})=>e===Iu))?r.filter((({matchUpType:e})=>e===Iu)):r;return{[t]:(n=i,n.sort(((e,t)=>kr(e.roundPosition,t.roundPosition))))};var n})),i=e.reduce(((e,t)=>{let r="string"==typeof t.roundNumber?xr(t.roundNumber):t.roundNumber;return e[r]||(e[r]=Zi({abbreviatedRoundName:t.abbreviatedRoundName,finishingRound:t.finishingRound,roundName:t.roundName})),e}),{}),n=Object.assign({},...r);if(t){let e=Math.max(...Object.keys(n).map((e=>xr(e))).filter((e=>!isNaN(e)))),t=n[e]?.length;if(t>1&&_r(t)){let r=e+1;ai(r,r+t/2).forEach(((e,r)=>{n[e]=ai(0,t/(2+2*r)).map((()=>({})))}))}}let a=0,o=Object.assign({},...Object.keys(n).map((e=>{let t=n[e]?.length,r=n[e]?.filter((e=>!ms.includes(e.matchUpStatus)&&!e.score?.scoreStringSide1))?.length,i=t&&t===r;return a=Math.max(a,t),{[e]:{matchUpsCount:t,inactiveCount:r,inactiveRound:i}}}))),s=0,c=0,u=Object.keys(n).map((e=>xr(e))).filter((e=>!isNaN(e)));u.forEach((e=>{let t=n[e].sort(((e,t)=>e.roundPosition-t.roundPosition)),r=t.map((e=>e?.drawPositions||[])).flat();if(o[e].roundNumber=e,o[e].roundFactor=o[e].matchUpsCount?a/o[e].matchUpsCount:1,o[e].finishingRound=i[e]?.finishingRound,o[e].roundName=i[e]?.roundName,o[e].abbreviatedRoundName=i[e]?.abbreviatedRoundName,o[e].finishingPositionRange=n[e]?.[0]?.finishingPositionRange,1!==e&&o[e-1]){let r=o[e-1],i=r.drawPositions,n=r.matchUpsCount/o[e].matchUpsCount,a=pi(i,n),s=t.map((t=>{let{roundPosition:r}=t,n=[...t.drawPositions||[],void 0,void 0].slice(0,2);if(!r)return n;let o=n?.filter(Boolean)||[];if(!o?.length)return[void 0,void 0];if(e<3&&2===o?.length)return n?.slice().sort(kr);let s=si(i,o).length!==o?.length;if(o?.length&&s)return 1===o?.length?[o[0],void 0]:n?.slice().sort(kr);let c=2*(r-1);return a.slice(c,c+2).map((e=>o?.find((t=>e.includes(t)))))}));o[e].drawPositions=s?.flat(),o[e].pairedDrawPositions=s}else{let t=r.sort(kr),i=pi(t,2);o[e].drawPositions=t,o[e].pairedDrawPositions=i}o[e+1]&&o[e+1].matchUpsCount===o[e].matchUpsCount&&(o[e+1].feedRound=!0,o[e+1].feedRoundIndex=c,o[e].preFeedRound=!0,c+=1),o[e]&&!o[e].feedRound&&(o[e].roundIndex=s,s+=1)}));let d=!!Object.values(o).find((({matchUpsCount:e})=>!_r(e)));return{hasNoRoundPositions:e.some((e=>!e.roundPosition)),roundsNotPowerOf2:d,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:u,roundProfile:o,...I}}function vp(e){if(!Array.isArray(e))return"";let t=e.filter(jr);return t.length?Yr([Math.min(...t),Math.max(...t)]).join("-"):""}function yp({collectionPosition:e,collectionId:t,lineUp:r}){let i=[],n=[];if(r){let a=e=>void 0===e?-1:e,o=r.map((r=>{let{collectionAssignments:i,participantId:n}=r,a=i?.find((r=>r.collectionPosition===e&&r.collectionId===t));return a&&{participantId:n,...a}})).filter(Boolean).sort(((e,t)=>a(e.substitutionOrder)-a(t.substitutionOrder)));for(let e of o){let{participantId:t,previousParticipantId:r,substitutionOrder:a}=e;i.includes(t)||(r&&n.push({previousParticipantId:r,substitutionOrder:a,participantId:t}),i=i.filter((e=>e!==r)),i.push(t))}}return{assignedParticipantIds:i,substitutions:n}}function Sp({tournamentParticipants:e,tournamentRecord:t,participantIds:r}){let i="getPairedParticipant";if(!e&&!t)return{error:D};if(!Array.isArray(r)||r.length>2)return{error:lt};if(!r.length)return en({result:{error:St},stack:i});let n=(e=e??t?.participants??[]).filter((e=>e.participantType===Ru&&si(r,e.individualParticipantIds).length===r.length&&e.individualParticipantIds.length===r.length)),a=n[0];if(!a)return en({result:{error:Ut},stack:i});let o=Da(n.slice(1),!1,!0);return{participant:Da(a),duplicatedPairParticipants:o,...I}}function wp({drawDefinition:e,participantId:t}){if("object"!=typeof e)return{error:M};if("string"!=typeof t)return{error:It};let{extension:r}=no({element:e,name:Io});return{lineUp:(r?.value||{})[t]}}function Pp({drawDefinition:e}){if("object"!=typeof e)return{error:R};let t={},{structures:r=[],links:i=[]}=e||{},n=r.reduce(((e,t)=>{let{stage:r}=t;return e[r]?e[r].push(t):e[r]=[t],e}),{});for(let o of Object.keys(n)){let e=n[o].find((({stageSequence:e})=>1===e));if(!e)continue;let{structureId:r}=e;a({aggregator:{},targetRound:0,exitProfiles:t,exitProfile:"0",structureId:r,stage:o})}return{exitProfiles:t};function a({exitProfiles:e,exitProfile:t,structureId:n,targetRound:o,aggregator:s,stage:c}){e[n]||(e[n]=[]),"0"===t&&[vs,Ss].includes(c)||e[n].push(t);let u=i.filter((e=>e.source.structureId===n&&e.source.roundNumber>=o));for(let i of u){let n=i.source.roundNumber,o=i.target.roundNumber,c=i.target.structureId,u=r.find((e=>e.structureId===c)).stage,d=[u,c,o,n].join("|");if(s[d])return;s[d]=!0,a({exitProfile:`${t}-${n}`,structureId:c,exitProfiles:e,targetRound:o,aggregator:s,stage:u})}}}function Dp({roundsNotPowerOf2:e,drawDefinition:t,structure:r,matchUps:i}){if(!r)return!1;i=i??r.matchUps??[],e=e??Up({matchUps:i}).roundsNotPowerOf2;let n=!!r.positionAssignments?.find((({drawPosition:e})=>e))||!!i?.find((({drawPositions:e})=>e?.length));return(!t?.drawType||t.drawType!==Ys)&&!r?.structures&&e&&n}function Tp({structure:e}){if(!e)return!1;let t=e.matchUps||e.roundMatchUps&&Object.values(e.roundMatchUps).flat(),r=!!t?.find((e=>e?.roundPosition)),i=!!t?.find((e=>e?.drawPositions?.length));return!(e?.structures||e?.stage===ys||t.length&&(r||i))}var bp={[Ca]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Is]:"",[Ss]:"P",[Us]:"Q",[vs]:"C"}}},Rp=bp;function Mp(e){let t=xn(e,[{[Sn]:!0}]);if(t.error)return t;let r=e?.matchUp,i=r?.matchUpType;if(!i&&r?.sides?.length){let e=r.sides.find((({participant:e})=>e))?.participant?.participantType;i=e===Tu&&mu||e===Ru&&hu||e===Mu&&Mu||void 0}return{matchUpType:i}}var Np="timed",Ap="NOAD",Ep="SET",Cp={S:"normal",F:"final"};function Op(e){if("string"==typeof e){let t=e.startsWith("T")&&Np||e.startsWith(Ep)&&Ep||"";if(t===Np){let t=_p(e);if(t)return{simplified:!0,setFormat:t,bestOf:1}}if(t===Ep)return function(e){let t=e.split("-"),r=Vp(t[0].slice(3)),i=1===r||r%2!=0?r:void 0,n=1!==r&&r%2==0?r:void 0,a=t&&Fp(t[1]),o=t&&Fp(t[2]),s=a&&a.timed||o&&o.timed,c=i&&i<6||s&&n,u=!t[2]||o,d=a,l=Zi({setFormat:a,exactly:n,bestOf:i});if(o&&(l.finalSetFormat=o),c&&d&&u)return l}(e)}}function Fp(e){if(":"===e?.[1]){let t=e.split(":"),r=Cp[t[0]],i=t[1];if(r&&i){if(i.startsWith("TB")){let e=xp(i);return!1!==e&&("object"==typeof e?{tiebreakSet:e}:void 0)}if(i.startsWith("T"))return _p(i);let t=e.match(/^[FS]:(\d+)([A-Za-z]*)/),r=t&&Lp(t[2])||!1,n=!t?.[2]||r,a=t?Vp(t[1]):void 0,o=kp(i),s=!1!==o,c=s&&o||a,u=xp(i.split("/")[1]),d=!1!==u,l={setTo:a};return r&&(l.NoAD=!0),u?(l.tiebreakFormat=u,l.tiebreakAt=c):l.noTiebreak=!0,a&&n&&d&&s&&l||!1}}}function kp(e,t=!0){let r=e?.indexOf("@")>0&&e.split("@");if(r)return(t?Vp(r[1]):r[1])||!1}function xp(e){if(e){if(e.startsWith("TB")){let t=kp(e,!1),r=e.match(/^TB(\d+)([A-Za-z]*)/),i=r?.[1],n=r&&Lp(r[2]),a=!r?.[2]||n,o=Vp(i);if(o&&a){let e={tiebreakTo:o};return t&&"string"==typeof t&&!Wr(t)&&(e.modifier=t),n&&(e.NoAD=!0),e}return!1}return!1}}function _p(e){let t=e.slice(1),r=t.match(/^(\d+)(@?[A-Za-z]*)/),i=Vp(r?.[1]);if(!i)return;let n={timed:!0,minutes:i},a=r?.[2],o=[void 0,"P","G"].includes(a);if(a&&!o){let e=t.match(/^(\d+)(@)([A-Za-z]+)$/)?.[3];return e?(n.modifier=e,n):void 0}return a&&(n.based=r[2]),n}function Lp(e){return e&&e.indexOf(Ap)>=0}function Vp(e){return isNaN(Number(e))?0:Number(e)}function Bp(e,t){return!(!Array.isArray(e)||!u(t))&&si(e,fl[t]).length}function jp(e){let{matchUps:t,isCollectionMatchUp:r,excludeMatchUpStatuses:i,matchUpStatuses:n,hasWinningSide:a,matchUpFormats:o,roundPositions:s,matchUpFormat:c,collectionIds:u,isMatchUpTie:d,roundNumbers:l,matchUpIds:p,roundNames:m,stageSequences:f,scheduledDates:h,scheduledDate:g,participantIds:I,processContext:U,tournamentIds:v,matchUpTypes:y,structureIds:S,readyToScore:w,courtIds:P,eventIds:D,venueIds:T,drawIds:b,stages:R,filterMatchUpIds:M=!0,filterMatchUpTypes:N=!0}=e,A=Array.isArray(I)?I.filter(Boolean):[],E=Array.isArray(n)?n.filter(Boolean):[],C=Array.isArray(i)?i.filter(Boolean):[],O=Array.isArray(R)?R.filter(Boolean):[],F=Array.isArray(f)?f.filter(Boolean):[],k=Array.isArray(u)?u.filter(Boolean):[],x=Array.isArray(m)?m.filter(Boolean):[],_=Array.isArray(l)?l.filter(Boolean):[],L=Array.isArray(s)?s.filter(Boolean):[],V=Array.isArray(p)&&M?p.filter(Boolean):[],B=Array.isArray(y)&&N?y.filter(Boolean):[],j=Array.isArray(P)?P.filter(Boolean):[],G=Array.isArray(T)?T.filter(Boolean):[],q=Array.isArray(o)&&o.filter(Boolean)||"string"==typeof c&&[c]||[],$=Array.isArray(h)&&h.filter(Boolean)||"string"==typeof g&&g.length&&[g]||[],W=Array.isArray(v)?v.filter(Boolean):[],H=Array.isArray(D)?D.filter(Boolean):[],z=Array.isArray(b)?b.filter(Boolean):[],Y=Array.isArray(S)?S.filter(Boolean):[];return t.filter((e=>{if(w&&!hl(gu)(e)&&!e.readyToScore||e.winningSide&&a&&![1,2].includes(e.winningSide)||void 0!==d&&(d&&!e.tieMatchUps||!d&&e.tieMatchUps)||void 0!==r&&(r&&!e.collectionId||!r&&e.collectionId)||O.length&&!O.includes(e.stage)||F.length&&!F.includes(e.stageSequence)||k.length&&(!e.collectionId||!k.includes(e.collectionId))||x.length&&(!e.roundName||!x.includes(e.roundName))||_.length&&(!e.roundNumber||!_.includes(e.roundNumber))||L.length&&(!e.roundPosition||!L.includes(e.roundPosition))||E.length&&(!e.matchUpStatus||!E.includes(e.matchUpStatus))||C.length&&e.matchUpStatus&&C.includes(e.matchUpStatus)||V.length&&!V.includes(e.matchUpId)||B.length&&(!e.matchUpType||!Bp(B,e.matchUpType))||q.length&&(!e.matchUpFormat||!q.includes(e.matchUpFormat)))return!1;if($?.length){let{scheduledTime:t}=Gl({matchUp:e}),{scheduledDate:r}=ql({matchUp:e}),i=la(t)||r;if(!$.find((e=>wa(e,i))))return!1}if(j.length){let{courtId:t}=Wl({matchUp:e}),{allocatedCourts:r}=$l({matchUp:e}),i=r?.map((({courtId:e})=>e));if(!j.filter(Boolean).includes(t)||i?.includes(t))return!1}if(G.length){let{venueId:t}=Hl({matchUp:e});if(!G.filter(Boolean).includes(t))return!1}if(U){if(W.length&&!W.includes(e.tournamentId)||H.length&&!H.includes(e.eventId)||z.length&&!z.includes(e.drawId)||Y.length&&!Y.includes(e.structureId))return!1;if(A.length){let t=e.sides?.map((({participantId:e})=>e)).filter(Boolean)??[];if(!A.some((e=>t.includes(e))))return!1}}return!0}))}function Gp({drawPositionCollectionAssignment:e,sideNumberCollectionAssignment:t,positionAssignments:r,displaySideNumber:i,seedAssignments:n,drawPosition:a,isFeedRound:o,sideNumber:s}){let c=r.find((e=>e.drawPosition&&e.drawPosition===a)),u=a&&e,d=s&&t,l=u?u[a]?.participantId:c?.participantId,p=c?function({displaySideNumber:e,seedAssignments:t,participantId:r,assignment:i,sideNumber:n}){let a={drawPosition:i.drawPosition,displaySideNumber:e,sideNumber:n};if(r){let e=function({seedAssignments:e,participantId:t}){return e?.find((e=>!e.seedProxy&&e.participantId===t))}({seedAssignments:t,participantId:r});Object.assign(a,e,{participantId:r})}else i.bye&&Object.assign(a,{bye:!0});return i.qualifier&&Object.assign(a,{qualifier:!0}),a}({displaySideNumber:i,seedAssignments:n,participantId:l,assignment:c,sideNumber:s}):{...d?.[s]};if(o&&(1===s?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let e=u[a]?.teamParticipant,t=u[a]?.participant,r=u[a]?.substitutions;t&&(p.participant=t),r&&(p.substitutions=r),e&&(p.teamParticipant=e)}return p}var qp="ANY",$p="MALE",Wp="MIXED",Hp="OTHER",zp="FEMALE",Yp={ANY:qp,MALE:$p,FEMALE:zp,MIXED:Wp,OTHER:Hp};function Kp({scheduleVisibilityFilters:e,tournamentAppliedPolicies:t,provisionalPositioning:r,tournamentParticipants:i,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,seedAssignments:s,usePublishState:c,contextFilters:u,contextContent:d,matchUpFilters:l,participantMap:p,scheduleTiming:m,contextProfile:f,drawDefinition:h,publishStatus:g,context:I={},exitProfiles:U,matchUpsMap:v,structure:y,inContext:S,event:w}){let P={},D={};if(i=i??o?.participants,!y)return{collectionPositionMatchUps:P,error:se,roundMatchUps:D,matchUps:[]};let T=Array.isArray(l?.eventIds)?l?.eventIds.filter(Boolean):[],b=Array.isArray(l?.structureIds)?l?.structureIds.filter(Boolean):[],R=Array.isArray(l?.drawIds)?l?.drawIds.filter(Boolean):[],N=!I?.eventId||!T?.length&&!u?.eventIds?.filter(Boolean).length||T?.includes(I.eventId)||u?.eventIds?.includes(I.eventId),A=!b?.length||b.includes(y.structureId),E=!h||!R?.length||R.includes(h.drawId);if(!N||!A||!E)return{collectionPositionMatchUps:P,roundMatchUps:D,matchUps:[]};f&&!d&&(d=id({tournamentRecord:o,contextProfile:f,drawDefinition:h}));let{appliedPolicies:C}=Yu({drawDefinition:h}),O={...t,...C,...a},F=O?.scoring?.structures,k=y.stage&&F?.stage&&F?.stage[y.stage],x=y.stageSequence&&k?.stageSequence&&k.stageSequence[y.stageSequence],_=O?.scoring?.requireAllPositionsAssigned||k?.requireAllPositionsAssigned||x?.requireAllPositionsAssigned;v||(v=mp({drawDefinition:h,structure:y}));let{positionAssignments:L,allPositionsAssigned:V}=Dc({structure:y}),B=!_||V,{seedAssignments:j}=Ad({provisionalPositioning:r,drawDefinition:h,structure:y});s=s??j;let{roundOffset:G,structureId:q,structureName:$,stage:W,stageSequence:H}=y,{drawId:z,drawName:Y,drawType:K}=h??{};U=U||h&&Pp({drawDefinition:h}).exitProfiles;let Q=U?.[q],J=Q?.length&&(Q[0].split("-").map((e=>parseInt(e))).reduce(((e,t)=>e+t))||0),X=!!y.structures,Z=fp({matchUpsMap:v,structureId:q,inContext:S}),ee=O?.[Ca],te=function({roundNamingPolicy:e,drawDefinition:t,structure:r,matchUps:i}){let{roundProfile:n,roundMatchUps:a}=Up({matchUps:i}),{structureAbbreviation:o,stage:s}=r,c=Tp({structure:r}),u=Dp({structure:r}),d=r.structures,l={},p=bp[Ca],m=r.stage===Us,f=m?Math.max(...(t?.structures??[]).filter((e=>e.stage===Us)).map((({stageSequence:e})=>e??1)),0):0,h=(r.stageSequence??1)<f?r.stageSequence??1:"",g=h&&(e?.affixes?.preQualifying||p.affixes.preQualifying)||"",I=e?.roundNamingMap||p.roundNamingMap||{},U=e?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},v=e?.affixes?.preFeedRound||p.affixes.preFeedRound,y=e?.affixes?.roundNumber||p.affixes.roundNumber,S=(e?.namingConventions||p.namingConventions).round,w=s&&s!==Is?s[0]:"",P=e?.stageConstants||p.stageConstants,D=`${g}${s&&P?.[s]||w}${h}`,T=n?Object.keys(n):[],b=m&&P?.[Us]?`${P?.[Us]}-`:"";if(d||c||u)Object.assign(l,...T.map((e=>({[e]:{roundName:`${b}${S} ${e}`,abbreviatedRoundName:`${y}${e}`}}))));else{let t=m&&(e?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(l,...T.map((e=>{if(!n?.[e])return;let{matchUpsCount:r,preFeedRound:i}=n[e],a=2*r,s=t?.[n?.[e].finishingRound]||t&&`${y}${a}`||I[r]||`${y}${a}`,c=i?`-${v}`:"",u=[D,o,`${s}${c}`].filter(Boolean).join("-"),d=`${U[r]||`${y}${a}`}${c}`;return{[e]:{abbreviatedRoundName:[D,o,d].filter(Boolean).join("-"),roundName:u}}})))}return{roundNamingProfile:l,roundProfile:n,roundMatchUps:a}}({roundNamingPolicy:ee,drawDefinition:h,structure:y,matchUps:Z}),{roundNamingProfile:re,roundProfile:ie}=te;if(D=te?.roundMatchUps??[],l&&(Z=jp({matchUps:Z,...l,filterMatchUpTypes:!1,filterMatchUpIds:!1})),S){let{sourceDrawPositionRanges:t}=function({drawDefinition:e,structureId:t,matchUpsMap:r}){if(!e)return{error:M};if(!t)return{error:ne};let{structure:i}=yc({drawDefinition:e,structureId:t});if(i?.stage!==vs)return{error:Ie,info:"Structure is not CONSOLATION stage"};let{links:n}=e,a=n?.filter((e=>e.target.structureId===t))||[],o=a?.reduce(((e,t)=>{let{structureId:r}=t.source;return e.includes(r)?e:e.concat(r)}),[])||[],s=Object.assign({},...o.map((e=>({[e]:Up({matchUps:fp({structureId:e,matchUpsMap:r})}).roundProfile})))),c=fp({matchUpsMap:r,structureId:t}),{roundProfile:u}=Up({matchUps:c}),d={};return a?.forEach((e=>{let{structureId:t,roundNumber:r}=e.source,{feedProfile:i,groupedOrder:n,positionInterleave:a,roundNumber:o}=e.target,c=s[t],l=c[1]?.drawPositions,p=c[r]?.matchUpsCount;if(!p)return;let m=p?l.length/p:0,f=l.length/m,h=l.slice(),g=hp({roundPositionsCount:f,groupedOrder:n}),I=g?.length||1;if(I<=f){let e=pi(h,l.length/I);i===ks&&e.forEach((e=>e.reverse())),h=g?.length&&g?.map((t=>e[t-1])).flat()||h}let U=pi(h,m);if(a){let e=ai(0,a.interleave).map((()=>{})),t=ai(0,a.offset).map((()=>{}));U=U.map((t=>[t,...e])),U.unshift(t),U=U.flat(1);let r=U.length-a.offset;U=U.slice(0,r)}d[o]||(d[o]={});let v=u?.[o]?.feedRound?2:1;U.forEach(((e,t)=>{let r=1+t*v;d[o][r]||(d[o][r]=vp(e))}))})),{sourceDrawPositionRanges:d}}({drawDefinition:h,matchUpsMap:v,structureId:q}),r=h?function({drawDefinition:e,roundProfile:t,structureId:r,matchUpsMap:i}){if(!e)return{error:M};if(!r)return{error:ne};if(!t){let e=fp({matchUpsMap:i,structureId:r});if(({roundProfile:t}=Up({matchUps:e})),!t)return{error:He}}let n=(Math.min(...t?.[1]?.drawPositions??[])||1)-1,a=Object.keys(t);return{drawPositionsRanges:Object.assign({},...(a||[]).map((e=>{let r=t?.[e]?.matchUpsCount,i=t?.[1]?.drawPositions??[],o=pi(i,i.length/r),s=o.map(vp),c=o.map((e=>e.map((e=>e-n)))).map(vp),u=a.map((i=>{if(i>e)return;let n=t?.[i]?.drawPositions??[];return pi(n,n.length/r)})).filter(Boolean),d=ai(0,r).map((e=>u.map((t=>t[e])).flat().filter(Boolean).sort(kr))).map((e=>Yr(e))),l=d.map((e=>function(e){return e.reduce(((e,t)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==t-1)&&e.push([]),e[e.length-1].push(t),e}),[])}(e).map(vp).join(", "))),p=Object.assign({},...ai(0,r).map((e=>({[e+1]:{firstRoundDrawPositionsRange:s[e],firstRoundOffsetDrawPositionsRange:c[e],possibleDrawPositions:d[e],drawPositionsRange:l[e]}}))));return{[e]:p}})))}}({drawDefinition:h,roundProfile:ie,matchUpsMap:v,structureId:q}).drawPositionsRanges:void 0;Z=Z.map((i=>ae({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,drawPositionsRanges:r,roundNamingProfile:re,initialRoundOfPlay:J,appliedPolicies:O,usePublishState:c,publishStatus:g,isRoundRobin:X,roundProfile:ie,matchUp:i,event:w}))),(Z?.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{let t=e.tieMatchUps;Z=Z.concat(...t)})),u&&(Z=jp({processContext:!0,...u,matchUps:Z}))}else(Z?.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{let t=e.tieMatchUps;Z=Z.concat(...t)}));return l&&(Z=jp({matchUps:Z,...l,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(l?.matchUpTypes||l?.matchUpIds)&&(Z=jp({matchUpTypes:l.matchUpTypes,matchUpIds:l.matchUpIds,matchUps:Z})),(l?.matchUpTypes||l?.matchUpIds||S)&&(D=Up({matchUps:Z}).roundMatchUps??[]),pp({drawDefinition:h,structure:y,event:w})?.tieFormat&&({collectionPositionMatchUps:P}=function({matchUps:e}){let t=e.reduce(((e,t)=>!t.collectionPosition||e.includes(t.collectionPosition)?e:e.concat(t.collectionPosition)),[]).map((t=>({[t]:e.filter((e=>e.collectionPosition===t))})));return{collectionPositionMatchUps:Object.assign({},...t)}}({matchUps:Z})),{collectionPositionMatchUps:P,roundMatchUps:D,isRoundRobin:X,roundProfile:ie,matchUpsMap:v,matchUps:Z};function ae({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,drawPositionsRanges:r,initialRoundOfPlay:a,additionalContext:c,roundNamingProfile:u,tieDrawPositions:l,appliedPolicies:g,isCollectionBye:U,usePublishState:v,publishStatus:S,matchUpTieId:w,isRoundRobin:P,roundProfile:D,sideLineUps:T,matchUp:b,event:R}){c=c??{};let M=pp({drawDefinition:h,structure:y,matchUp:b,event:R})?.tieFormat,N=M?.collectionDefinitions,A=b.collectionId&&N?.find((e=>e.collectionId===b.collectionId)),E=b.collectionId?A?.matchUpFormat:b.matchUpFormat??y?.matchUpFormat??h?.matchUpFormat??R?.matchUpFormat,C=b.matchUpType||A?.matchUpType||y?.matchUpType||h?.matchUpType||!hl(kl)(R?.eventType)&&R?.eventType,O=U?Yo:b.matchUpStatus,{schedule:F,endDate:k}=up({scheduleVisibilityFilters:e,afterRecoveryTimes:n,tournamentRecord:o,usePublishState:v,scheduleTiming:m,matchUpFormat:E,publishStatus:S,matchUpType:C,matchUp:b,event:R}),x=l??b.drawPositions??[],{collectionPosition:_,collectionId:V,roundPosition:j}=b,Q=b.roundNumber??c.roundNumber,J=V?function({tournamentParticipants:e,positionAssignments:t,collectionPosition:r,drawPositions:i=[],participantMap:n,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:c}){if(!o||!r)return{};let u=({attribute:t,lineUp:i,teamParticipant:a})=>{let{assignedParticipantIds:s,substitutions:u}=yp({collectionPosition:r,collectionId:o,lineUp:i});if(c!==hu){let e=s?.[0];return e&&{[t]:{participantId:e,teamParticipant:a,substitutions:u}}}if(s?.length<=2){let r=n?.[s[0]]?.pairIdMap?.[s[1]],i=(r&&n[r]?.participant||Sp({participantIds:s,tournamentParticipants:e}).participant)?.participantId;return{[t]:{participantId:i,teamParticipant:a,substitutions:u}}}if(s?.length>2)return{[t]:{teamParticipant:a,substitutions:u}}};if(!i?.length){let e=s?.map((e=>{let{teamParticipant:t,sideNumber:r}=e,i=e.lineUp||wp({participantId:t.teamParticipantId,drawDefinition:a})?.lineUp;return u({attribute:r,lineUp:i,teamParticipant:t})})).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...e)}}let d=i?.map((r=>{let i=t.find((e=>e.drawPosition===r))?.participantId,o=s?.find((e=>e?.drawPosition===r)),c=o?.teamParticipant||i&&n?.[i]?.participant||e?.find((({participantId:e})=>e===i)),d=o?.lineUp||wp({participantId:i,drawDefinition:a})?.lineUp;return u({attribute:r,lineUp:d,teamParticipant:c})})).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...d)}}({tournamentParticipants:i,positionAssignments:L,collectionPosition:_,drawDefinition:h,participantMap:p,drawPositions:x,collectionId:V,sideLineUps:T,matchUpType:C}):void 0,X=u?.[Q]?.roundName||c.roundName,Z=u?.[Q]?.abbreviatedRoundName||c.abbreviatedRoundName,ee=D?.[Q]?.feedRound,te=D?.[Q]?.preFeedRound,re=D?.[Q]?.roundFactor,ie=r?.[Q],ne=j?ie?.[j]:void 0,oe=t?.[Q],se=A?.category?{...I?.category||{},...A.category}:I?.category??R?.category,ce=b.processCodes?.length&&b.processCodes||A?.processCodes?.length&&A?.processCodes||y?.processCodes?.length&&y?.processCodes||h?.processCodes?.length&&h?.processCodes||R?.processCodes?.length&&R?.processCodes||o?.processCodes,ue=f?.withCompetitiveness&&xd({...d,matchUp:b}),de=b.finishingPositionRange??c.finishingPositionRange,le=e=>Zi(e,void 0,!0),pe={...le(I),...le({matchUpFormat:b.matchUpType===kl?void 0:E,tieFormat:b.matchUpType!==kl?void 0:M,gender:A?.gender??R?.gender,roundOfPlay:W!==Us&&Wr(a)&&a+(Q||0),endDate:b.endDate??k,discipline:R?.discipline,category:se,finishingPositionRange:de,abbreviatedRoundName:Z,drawPositionsRange:ne,competitiveProfile:ue,structureName:$,stageSequence:H,drawPositions:x,matchUpStatus:O,processCodes:ce,isRoundRobin:P,matchUpTieId:w,preFeedRound:te,matchUpType:C,roundFactor:re,roundOffset:G,structureId:q,roundNumber:Q,feedRound:ee,roundName:X,drawName:Y,drawType:K,schedule:F,drawId:z,stage:W}),...Da(le(b),!0,!0)};if(E&&b.score?.scoreStringSide1){let e=Op(E),{bestOf:t,finalSetFormat:r,setFormat:i}=e??{};(r?.tiebreakSet||i?.tiebreakSet||i?.timed)&&(pe.score.sets=pe.score.sets.sort(((e,t)=>e.setNumber-t.setNumber)).map(((e,n)=>(n+1===t?(r?.tiebreakSet||r?.timed)&&(e.tiebreakSet=!0):(i?.tiebreakSet||i?.timed)&&(e.tiebreakSet=!0),e))))}if(Array.isArray(x)){let{orderedDrawPositions:e,displayOrder:t}=function({drawPositions:e,roundProfile:t,roundNumber:r}){let i=[void 0,void 0];if(hi(e))return{orderedDrawPositions:i,displayOrder:i};let n=t?.[r],a=n?.pairedDrawPositions?.find((t=>ui(t||[],e.filter(Boolean))))??i,o=n?.feedRound;if(fi(e)){let t=[...e].sort(kr);return{orderedDrawPositions:2===t.length?t:a,displayOrder:o?t:a}}if(o){let t=[e.find((e=>!isNaN(xr(e)))),void 0];return{orderedDrawPositions:t,displayOrder:t}}return{orderedDrawPositions:a,displayOrder:a}}({drawPositions:x,roundProfile:D,roundNumber:Q}),r=D?.[Q]?.feedRound,i=t[0]!==e[0],n=e.concat(void 0,void 0).slice(0,2).map(((e,t)=>{let n=t+1,a=Gp({...J,positionAssignments:L,displaySideNumber:i?3-n:n,seedAssignments:s,drawPosition:e,isFeedRound:r,sideNumber:n}),o=b.sides?.find((e=>e.sideNumber===n)),c=j?2*(j-1)+t+1:void 0;return le({sourceDrawPositionRange:c?oe?.[c]:void 0,...o,...a})}));Object.assign(pe,Da({sides:n},!0,!0))}if(i&&pe.sides){let e=g?.[Oa],t=t=>{let r=p?.[t]?.participant;return r&&Wn({template:e?.participant,source:r})};if(pe.sides.filter(Boolean).forEach((e=>{if(e.participantId){let r=Da(t(e.participantId)||i&&Ga({policyDefinitions:g,participantId:e.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:f}),void 0,!0);if(r){if(h?.entries){let t=h.entries.find((t=>t.participantId===e.participantId));t?.entryStatus&&(r.entryStatus=t.entryStatus),t?.entryStage&&(r.entryStage=t.entryStage)}Object.assign(e,{participant:r})}}if(e?.participant?.individualParticipantIds?.length&&!e.participant.individualParticipants?.length){let r=e.participant.individualParticipantIds.map((e=>t(e)||i&&Ga({policyDefinitions:g,tournamentParticipants:i,internalUse:!0,contextProfile:f,participantId:e})));Object.assign(e.participant,{individualParticipants:r})}})),!pe.matchUpType){let{matchUpType:e}=Mp({matchUp:pe});e&&Object.assign(pe,{matchUpType:e})}if(f?.inferGender&&(!pe.gender||pe.gender===Wp)&&2===pe.sides?.length&&pe.matchUpType!==kl){let e=pe.sides.map((e=>{if(hl(mu)(pe.matchUpType))return e.participant?.person?.sex;if(2===e.participant?.individualParticipants?.length){let t=Yr(e.participant.individualParticipants.map((e=>e.person?.sex))).filter(Boolean);if(1===t.length)return t[0]}}));if(2===e.filter(Boolean).length&&1===Yr(e).length){let t=e[0];pe.inferredGender=t}}}if(pe.tieMatchUps){let i=pe.matchUpStatus===Yo,n=pe.sides?.map((({participant:e,drawPosition:t,sideNumber:r,lineUp:i})=>{let n=e?.participantType===kl&&e;return{teamParticipant:n&&Zi({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participanOthertName,participantName:n.participantName,participantId:n.participantId,teamId:n.teamId}),drawPosition:t,sideNumber:r,lineUp:i}}));pe.tieMatchUps=pe.tieMatchUps.map((o=>{let s=pe.matchUpId,c={finishingPositionRange:pe.finishingPositionRange,abbreviatedRoundName:Z,roundNumber:Q,roundName:X};return ae({tieDrawPositions:x,scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,sideLineUps:n,drawPositionsRanges:r,initialRoundOfPlay:a,roundNamingProfile:u,additionalContext:c,appliedPolicies:g,isCollectionBye:i,usePublishState:v,publishStatus:S,matchUpTieId:s,isRoundRobin:P,roundProfile:D,matchUp:o,event:R})}))}let me=pe.sides&&2===pe.sides.filter((e=>e?.participantId)).length,fe=!pe.winningSide;if(Object.assign(pe,{readyToScore:B&&me&&fe,hasContext:!0}),me){let{allParticipantsCheckedIn:e,checkedInParticipantIds:t}=ml({matchUp:pe});Object.assign(pe,{allParticipantsCheckedIn:e,checkedInParticipantIds:t})}return Array.isArray(f?.exclude)&&f?.exclude.forEach((e=>delete pe[e])),pe}}function Qp({matchUp:e}){return!!e&&(ms.includes(e?.matchUpStatus)||e?.winningSide)}function Jp({requireParticipants:e=!0,scheduleVisibilityFilters:t,tournamentAppliedPolicies:r,tournamentParticipants:i,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:l,scheduleTiming:p,publishStatus:m,contextProfile:f,drawDefinition:h,exitProfiles:g,matchUpsMap:I,structureId:U,inContext:v,structure:y,context:S,event:w}){!y&&U&&({structure:y}=yc({drawDefinition:h,structureId:U}));let P=Kp({tournamentAppliedPolicies:r,scheduleVisibilityFilters:t,tournamentParticipants:i,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:l,scheduleTiming:p,publishStatus:m,contextProfile:f,drawDefinition:h,exitProfiles:g,matchUpsMap:I,structure:y,inContext:v,context:S,event:w}),D=[],T=[],b=[],R=[],M=[];if(P.error)return P;let N,{matchUps:A}=P,{assignedPositions:E}=Dc({structure:y}),C=E?.filter((e=>e.participantId)).map((e=>e.drawPosition));return A.filter((e=>{let t=1===c?.matchUpTypes?.length&&c.matchUpTypes[0]===Iu;return!(e.matchUpType!==Iu&&t)})).forEach((t=>{if(t.matchUpStatus===Ho)return void D.push(t);t.matchUpType===Iu&&(N=!0);let r=t.collectionId,i=r&&t.sides?.every((e=>e.participantId)),n=!r&&2===t.drawPositions?.filter(Boolean).length,a=!r&&t.drawPositions?.every((e=>C?.includes(e))),o=E?.filter((e=>e.bye)).map((e=>e.drawPosition)),s=!r&&t.drawPositions?.find((e=>o?.includes(e))),c=hs.includes(t.matchUpStatus)&&(i||n&&(!e||a));return s?M.push(t):Qp({matchUp:t})?T.push(t):c?b.push(t):R.push(t)})),{includesTeamMatchUps:N,abandonedMatchUps:D,completedMatchUps:T,upcomingMatchUps:b,pendingMatchUps:R,byeMatchUps:M,structure:y}}function Xp({finishingPositions:e,linkCondition:t,linkType:r,source:i}){let n=i.find((i=>{let n=!i.source?.finishingPositions||!e||ui(e,i.source?.finishingPositions);return t===i.linkCondition&&n&&i.linkType===r}));return[_s,Ls].includes(n?.linkType)&&!n?.source?.roundNumber?en({result:{error:mr},stack:"getTargetLink",context:n}):n}function Zp({drawDefinition:e,structureId:t,roundNumber:r}){return e?t?{links:(e.links||[]).filter(Boolean).reduce(((e,i)=>(i.source?.structureId===t&&(!r||i.source.roundNumber===r)&&(e.source=e.source.concat(i)),i.target?.structureId===t&&(!r||i.target.roundNumber===r)&&(e.target=e.target.concat(i)),e)),{source:[],target:[]})}:{error:ne}:{error:M}}function em({sourceRoundMatchUpCount:e,inContextDrawMatchUps:t,sourceRoundPosition:r,drawDefinition:i,targetLink:n}){if(!n)return{error:re};let{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:c,positionInterleave:u}}=n,{structure:d}=yc({drawDefinition:i,structureId:a}),{positionAssignments:l}=Pc({structure:d}),p=(t?.filter((e=>e.structureId===d?.structureId))).filter((e=>e.roundNumber===c&&!e.matchUpTieId)),m=p.length,f=ai(1,m+1),h=m/e,g=Math.ceil(h*r),I=1-r%2;if(u?.interleave&&.5!==h){let e=r+(u.offset+(r-1)*u.interleave);g=Math.ceil(e/2),I=1-e%2}let U=f,v=f[g-1],y=hp({roundPositionsCount:f.length,groupedOrder:s}),S=y?.length||1;if(S<=f.length){let e=pi(f,m/S);o===ks&&e.forEach((e=>e.reverse())),U=y?.length&&y?.map((t=>e[t-1])).flat()||U}o===Fs?v=U[g-1]:o===ks?((!y?.length||S>f.length)&&(g=p.length+1-g),v=U[g-1]):o===Os&&wi()&&console.log(yr,{feedProfile:o});let w,P=v&&p.reduce(((e,t)=>t.roundPosition===v?t:e),void 0);P?.feedRound?(I=0,w=Math.min(...(P.drawPositions||[]).filter(Boolean))):w=2===P?.drawPositions?.length&&P?.drawPositions[I];let D=l?.find((({drawPosition:e})=>e===w));if(D){let{extension:e}=no({element:D,name:uo});if(e?.value)return{disabledDrawPosition:w}}return{matchUp:P,targetDrawPosition:w,matchUpDrawPositionIndex:I}}function tm({inContextDrawMatchUps:e=[],useTargetMatchUpIds:t,inContextMatchUp:r,drawDefinition:i,matchUpId:n}){let a=r;e.length&&!a&&(a=e.find((e=>e.matchUpId===n)));let{structure:o}=yc({structureId:a?.structureId,drawDefinition:i});return o?.finishingPosition===fc?function({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:r,structure:i,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:o}=n,{links:s}=function({drawDefinition:e,roundNumber:t,structureId:r}){if(!e)return{error:M};if(!r)return{error:ne};let{links:i}=Zp({drawDefinition:e,structureId:r});return{links:{source:i.source.reduce(((e,r)=>r.source.roundNumber&&r.source.roundNumber!==t?e:e.concat(r)),[]),target:i.target.reduce(((e,r)=>r.target.roundNumber&&r.target.roundNumber!==t?e:e.concat(r)),[])}}}({roundNumber:n.roundNumber,structureId:i.structureId,drawDefinition:r}),c=s?.source,u=Xp({source:c,linkType:_s}),d=Xp({linkCondition:Vs,linkType:Ls,source:c}),l=Xp({source:c,linkType:Ls}),p=d&&l;l||(l=d);let m,f,h,g,I,U,v,y,S,w,P=u?.target?.feedProfile,D=l?.target?.feedProfile,T=d?.target?.feedProfile;if(t&&(a||o)&&(v=a&&P!==Cs&&e.find((({matchUpId:e})=>e===a)),g=o&&D!==Cs&&e.find((({matchUpId:e})=>e===o)),v||g))return{matchUp:n,targetLinks:{loserTargetLink:l,winnerTargetLink:u},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v}};let{roundPosition:b}=n;w=w||e.filter((e=>e.structureId===i.structureId));let R=w.reduce(((e,t)=>t.roundNumber!==n.roundNumber||t.matchUpTieId?e:e+1),0);return l&&!g&&D!==Cs&&({matchUpDrawPositionIndex:U,targetDrawPosition:I,matchUp:g}=em({targetLink:l,sourceRoundMatchUpCount:R,inContextDrawMatchUps:e,sourceRoundPosition:b,drawDefinition:r})),p&&T!==Cs&&({matchUpDrawPositionIndex:h,targetDrawPosition:f,matchUp:m}=em({targetLink:d,sourceRoundMatchUpCount:R,inContextDrawMatchUps:e,sourceRoundPosition:b,drawDefinition:r})),u&&!v&&P!==Cs&&({matchUpDrawPositionIndex:S,targetDrawPosition:y,matchUp:v}=em({targetLink:u,sourceRoundMatchUpCount:R,inContextDrawMatchUps:e,sourceRoundPosition:b,drawDefinition:r})),v||(w=w||e.filter((e=>e.structureId===i.structureId)),({matchUp:v}=function({structureMatchUps:e,matchUp:t}){let{roundNumber:r,roundPosition:i}=t,n=e.filter((e=>e.roundNumber===r&&!e.matchUpTieId)),a=e.filter((e=>e.roundNumber===r+1&&!e.matchUpTieId));if(a.length){let e;return a.length===n.length?e=a.find((e=>e.roundPosition===i)):a.length===n.length/2&&(e=a.find((e=>e.roundPosition===Math.ceil(i/2)))),{matchUp:e}}return{message:"no progression found"}}({structureMatchUps:w,matchUp:n}))),Zi({matchUp:n,targetLinks:{loserTargetLink:l,winnerTargetLink:u,byeTargetLink:d},targetMatchUps:{winnerMatchUpDrawPositionIndex:S,loserMatchUpDrawPositionIndex:U,byeMatchUpDrawPositionIndex:h,winnerTargetDrawPosition:y,loserTargetDrawPosition:I,byeTargetDrawPosition:f,winnerMatchUp:v,loserMatchUp:g,byeMatchUp:m},targetMatchUpIds:!(!a&&!o)})}({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:i,structure:o,matchUp:a}):function({matchUp:e}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:e}}({matchUp:a})}function rm({drawDefinition:e,inContextDrawMatchUps:t}){let r={};return t.forEach((i=>{let{matchUpId:n,structureId:a,drawPositions:o=[]}=i,{structure:s}=yc({drawDefinition:e,structureId:a});if(s?.finishingPosition===mc){let{roundNumber:e}=i,t=e&&xr(e)+1,r=s.matchUps??[],{roundMatchUps:n}=Up({matchUps:r});if(t&&n?.[t]){let e=[...o].sort(kr).map(((e,r)=>{let i=n[t].find((t=>t.drawPositions?.includes(e)));return{matchUpId:i?.matchUpId,roundNumber:t,schedule:i?.schedule,sideNumber:r+1,structureName:s.structureName}}));Object.assign(i,{sidesTo:e})}}else{let a=tm({useTargetMatchUpIds:!0,inContextDrawMatchUps:t,inContextMatchUp:i,drawDefinition:e,matchUpId:n}),{winnerMatchUp:o}=a.targetMatchUps,{loserMatchUp:s}=a.targetMatchUps;!i.winnerMatchUpId&&o&&(i.winnerMatchUpId=o.matchUpId),!i.loserMatchUpId&&s&&(i.loserMatchUpId=s.matchUpId);let c=nm({upcomingMatchUp:o}),u=nm({upcomingMatchUp:s});if(i.matchUpStatus!==Yo&&s?.matchUpStatus===Yo){let{matchUp:r}=im({matchUp:s,drawDefinition:e,inContextDrawMatchUps:t})||{};u=r&&nm({upcomingMatchUp:r})||u}let d=i.schedule?.timeAfterRecovery;if(d&&(c?.schedule?.scheduledTime&&ca(c.schedule.scheduledTime)<ca(d)&&(r[c.matchUpId]=i.matchUpId,c.schedule.scheduleConflict=i.matchUpId),u?.schedule?.scheduledTime&&ca(u.schedule.scheduledTime)<ca(d)&&(r[u.matchUpId]=i.matchUpId,u.schedule.scheduleConflict=i.matchUpId)),Object.assign(i,{winnerTo:c,loserTo:u}),i.drawPositions?.filter(Boolean).length){let e=a.targetLinks?.loserTargetLink?.linkCondition===Vs,r=function(e){return e?.sides?.map((({participant:e,participantId:t,qualifier:r})=>e||t&&{participantId:t}||r&&{qualifier:r})).filter(Boolean)||[]}(i);if(r.length){let i=jo(o?.sides),n=jo(s?.sides),c=r.find((({participantId:e})=>i.includes(e)))?[]:r,u=r.find((({participantId:e})=>n.includes(e)))?[]:r;s&&e&&u.length<2&&u.push({bye:!0,tbd:!0}),c?.length&&o&&(!a.targetMatchUpIds&&o&&(o=t.find((({matchUpId:e})=>e===o.matchUpId))),o.potentialParticipants||(o.potentialParticipants=[]),o.potentialParticipants.push(c)),u?.length&&s&&(a.targetMatchUpIds||(o=t.find((({matchUpId:e})=>e===s.matchUpId))),s.potentialParticipants||(s.potentialParticipants=[]),s.potentialParticipants.push(u))}}}})),Object.keys(r).length&&t.forEach((e=>{Object.keys(r).includes(e.matchUpId)&&(e.schedule.scheduleConflict=r[e.matchUpId])})),{scheduleConflictMatchUpIds:r}}function im({matchUp:e,drawDefinition:t,inContextDrawMatchUps:r}){let{matchUpId:i,matchUpStatus:n,structureId:a}=e||{};if(!e||!a||e?.matchUpStatus===os)return{matchUp:e};if(n===Yo){let n;return e.winnerMatchUpId?n=r.find((({matchUpId:t})=>t===e.winnerMatchUpId)):({winnerMatchUp:n}=tm({inContextDrawMatchUps:r,drawDefinition:t,matchUpId:i})?.targetMatchUps||{}),im({matchUp:n,drawDefinition:t,inContextDrawMatchUps:r})}return{matchUp:void 0}}function nm(e){if(e?.upcomingMatchUp)return(({matchUpId:e,structureId:t,schedule:r,roundNumber:i,roundPosition:n,structureName:a})=>({matchUpId:e,structureId:t,schedule:r,roundNumber:i,roundPosition:n,structureName:a}))(e.upcomingMatchUp)}function am(e){Object.assign(e,{requireParticipants:!1});let t=om(e);if(t.error)return en({result:t,stack:"getAllDrawMatchUps"});let{abandonedMatchUps:r,completedMatchUps:i,upcomingMatchUps:n,pendingMatchUps:a,byeMatchUps:o,matchUpsMap:s}=t;return{matchUps:(r??[]).concat(...i??[],...n??[],...a??[],...o??[]),matchUpsMap:s}}function om(e){if(!e?.drawDefinition)return{error:M};let t,{tournamentParticipants:r,contextContent:i,matchUpsMap:n}=e,{scheduleVisibilityFilters:a,tournamentAppliedPolicies:o,requireParticipants:s,participantsProfile:c,afterRecoveryTimes:u,policyDefinitions:d,tournamentRecord:l,usePublishState:p,contextFilters:m,matchUpFilters:f,scheduleTiming:h,participantMap:g,publishStatus:U,contextProfile:v,drawDefinition:y,nextMatchUps:S,inContext:w,context:P,event:D}=e,T=[],b=[],R=[],N=[],A=[];v&&!i&&(i=id({policyDefinitions:d,tournamentRecord:l,contextProfile:v,event:D})),!r?.length&&l&&(r=l?.participants,(w||c?.withGroupings)&&r?.length&&({participantsWithGroupings:r,groupInfo:t}=Eu({participants:r,participantsProfile:c})));let{structures:E}=Sc({drawDefinition:y});if(!E)return{error:ae};n||(n=mp({drawDefinition:y}));let C=y&&Pp({drawDefinition:y}).exitProfiles;E.forEach((e=>{let{byeMatchUps:t=[],pendingMatchUps:c=[],upcomingMatchUps:I=[],completedMatchUps:M=[],abandonedMatchUps:E=[]}=Jp({matchUpFilters:S?void 0:f,contextFilters:S?void 0:m,inContext:w||S||m,tournamentAppliedPolicies:o,scheduleVisibilityFilters:a,tournamentParticipants:r,requireParticipants:s,afterRecoveryTimes:u,policyDefinitions:d,tournamentRecord:l,usePublishState:p,contextContent:i,participantMap:g,scheduleTiming:h,publishStatus:U,contextProfile:v,drawDefinition:y,exitProfiles:C,matchUpsMap:n,structure:e,context:P,event:D});T=T.concat(...E),b=b.concat(...M),R=R.concat(...I),N=N.concat(...c),A=A.concat(...t)}));let O=e=>(!f&&!S&&!m||(f&&(e=jp({matchUps:e,...f})),m&&(e=jp({matchUps:e,...m,processContext:!0}))),e),F={abandonedMatchUps:O(T),completedMatchUps:O(b),upcomingMatchUps:O(R),pendingMatchUps:O(N),byeMatchUps:O(A),matchUpsMap:n,...I,groupInfo:t};if(S){let e="object"==typeof S||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:t,completed:r,upcoming:i,pending:n,bye:a}=e;rm({inContextDrawMatchUps:[].concat(...t&&T||[],...r&&b||[],...i&&R||[],...n&&N||[],...a&&A||[]),drawDefinition:y})}return F}function sm(e){let{participants:t=[],contextContent:r,participantMap:i}=e,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,useParticipantMap:u,tournamentRecord:d,contextFilters:l,contextProfile:p,matchUpFilters:m,nextMatchUps:f,inContext:h,context:g,event:I}=e;if(!I)return{error:de};let U,{eventId:v,eventName:y,endDate:S,eventType:w,category:P,gender:D,matchUpFormat:T}=I??{},b={...g,...Zi({indoorOutDoor:I.indoorOutdoor??d?.indoorOutdoor,surfaceCategory:I.surfaceCategory??d?.surfaceCategory,endDate:I.endDate??d?.endDate,tournamentId:d?.tournamentId,matchUpFormat:T,eventName:y,eventType:w,category:P,eventId:v,gender:D})};if(S&&(b.endDate=S),p&&!r&&(r=id({policyDefinitions:c,tournamentRecord:d,contextProfile:p,event:I})),!t?.length&&!i&&d){let e=zu({participantsProfile:o,useParticipantMap:u,policyDefinitions:c,tournamentRecord:d,contextProfile:p,inContext:h});i=e.participantMap,t=e.participants??[],U=e.groupInfo}let R=I.drawDefinitions??[],M=ad({tournamentRecord:d,event:I}).scheduleTiming;return{matchUps:R.flatMap((e=>{let{matchUps:u}=am({tournamentParticipants:t,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:b,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,tournamentRecord:d,contextFilters:l,contextProfile:p,drawDefinition:e,contextContent:r,matchUpFilters:m,participantMap:i,scheduleTiming:M,nextMatchUps:f,inContext:h,event:I});return u??[]})),groupInfo:U}}function cm(e){let t=xn(e,[{tournamentRecord:!0}]);if(t.error)return t;if(!e?.tournamentRecord)return{error:D};let{participantMap:r,participants:i}=e,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:c,tournamentRecord:u,inContext:d=!0,contextProfile:l,matchUpFilters:p,contextFilters:m,nextMatchUps:f,context:h}=e,g=e.tournamentId??u.tournamentId,I=u?.events??[];i||({participants:i,participantMap:r}=zu({participantsProfile:a,useParticipantMap:s,policyDefinitions:c,tournamentRecord:u,contextProfile:l,inContext:d}));let{appliedPolicies:U}=Yu({tournamentRecord:u}),v={...h,tournamentId:g,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},y=id({policyDefinitions:c,tournamentRecord:u,contextProfile:l});return{matchUps:I.flatMap((e=>(v.eventDrawsCount=e.drawDefinitions?.length??0,sm({context:v,scheduleVisibilityFilters:n,tournamentAppliedPolicies:U,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:c,tournamentRecord:u,contextContent:y,contextFilters:m,contextProfile:l,matchUpFilters:p,participantMap:r,nextMatchUps:f,participants:i,inContext:d,event:e}).matchUps??[]))).concat(...u.matchUps??[])}}function um({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:r,tournamentRecords:i,policyDefinitions:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:c}){if("object"!=typeof i||!Object.keys(i).length)return{error:P};let u=Object.keys(i).map((u=>{let d=i[u];return cm({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:r,policyDefinitions:n,tournamentRecord:d,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:c}).matchUps??[]})).flat();return{...I,matchUps:u}}function dm(e,t){return function(e,t){return(Ps[e?.stage]||0)-(Ps[t?.stage]||0)}(e,t)||(e?.stageSequence||0)-(t?.stageSequence||0)||e?.roundNumber&&t.roundNumber&&e?.roundNumber-t?.roundNumber||(e?.roundPosition??0)-(t?.roundPosition??0)}function lm(e){let t,{participants:r,participantMap:i,contextContent:n}=e,{scheduleVisibilityFilters:a,tournamentAppliedPolicies:o,participantsProfile:s,afterRecoveryTimes:c,policyDefinitions:u,useParticipantMap:d,tournamentRecord:l,matchUpFilters:p,contextFilters:m,contextProfile:f,drawDefinition:h,nextMatchUps:g,inContext:I,context:U,event:v}=e,{eventId:y,eventName:S,endDate:w,eventType:P,category:D,gender:T,matchUpFormat:b}=v??{},R={...U,surfaceCategory:v?.surfaceCategory??l?.surfaceCategory,indoorOutDoor:v?.indoorOutdoor??l?.indoorOutdoor,matchUpFormat:b,eventType:P,eventName:S,category:D,eventId:y,endDate:w,gender:T};return!r?.length&&!i&&l&&({participants:r=[],participantMap:i,groupInfo:t}=zu({participantsProfile:s,useParticipantMap:d,policyDefinitions:u,tournamentRecord:l,contextProfile:f,inContext:I})),f&&!n&&(n=id({policyDefinitions:u,tournamentRecord:l,contextProfile:f,drawDefinition:h,event:v})),{...am({context:R,tournamentAppliedPolicies:o,scheduleVisibilityFilters:a,tournamentParticipants:r,participantsProfile:s,afterRecoveryTimes:c,policyDefinitions:u,tournamentRecord:l,drawDefinition:h,contextContent:n,contextFilters:m,contextProfile:f,matchUpFilters:p,participantMap:i,nextMatchUps:g,inContext:I,event:v}),groupInfo:t}}function pm({element:e,accessor:t}){if("string"!=typeof t)return{values:[]};let r,i=Da(e),n=t.split("."),a=[];!function e({targetElement:t,attributes:i=[],significantCharacters:n}){for(let[s,c]of i.entries())if(t?.[c]){let n=i.slice(s+1);n.length?Array.isArray(t[c])?t[c].forEach((t=>e({targetElement:t,attributes:n}))):o({targetElement:t=t[c],index:s}):(r||(r=t[c]),a.includes(t[c])||a.push(t[c]))}function o({targetElement:e,index:t}){if(e&&t===i.length-1&&["string","number"].includes(typeof e)){let t=n?e.slice(0,n):e;r?a.includes(t)||a.push(t):(r=t,a.push(t))}}}({targetElement:i,attributes:n});let o={value:r};return a.length&&(o.values=a),o}var mm=e=>t=>e&&"object"==typeof t?Array.isArray(e)&&e.map((e=>({[e]:pm({element:t,accessor:e})?.value})))||"object"==typeof e&&Object.keys(e).map((e=>({[e]:pm({element:t,accessor:e})?.value})))||("string"==typeof e&&pm({element:t,accessor:e}))?.value:void 0,fm=mm;function hm({finishingPositionOffset:e=0,finishingPositionLimit:t,positionsFed:r,roundsCount:i,roundLimit:n,matchUps:a,lucky:o,fmlc:s}){if(!Ip(a))return[];let{roundProfile:c,roundNumbers:u=[]}=Up({interpolate:!0,matchUps:a});i=i??Math.max(...u,0);let d=n?i-n:0,l=d&&c?.[i-d]?.matchUpsCount,p=c&&Object.values(c).map(fm("matchUpsCount")),m=(e,r)=>{let i=Math.min(...e);l&&r&&1===i&&(i=l);let n=Math.max(...e);return t&&n>t&&(n=t),[i,n]},f=c&&Object.assign({},...u.map((t=>{let n=(i??0)+1-t-d,a=c[t].matchUpsCount,u={finishingPositionRange:{},finishingRound:n},l=p?.slice(t-1).reduce(((e,t)=>e+(t||0)),0),f=1+e+(s&&1!==t?r??0:0),h=ai(f,o?f+2*a:l+f+1),g=l+1-a,I=m(h.slice(g)),U=m(h.slice(0,g),!0);return u.finishingPositionRange={loser:I,winner:U},{[t]:u}}))),h=wi({finishingRound:!0});return a.filter(Boolean).forEach((e=>{let t=e.roundNumber&&f[e.roundNumber];h&&!t&&console.log({roundFinishingData:f,matchUp:e}),e.finishingRound=t?.finishingRound,e.finishingPositionRange=t?.finishingPositionRange})),a}function gm({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:r}){if(!t)return{error:M};let i={loserMatchUpIds:{},winnerMatchUpIds:{}};if(e||({matchUps:e,matchUpsMap:r}=am({inContext:!0,drawDefinition:t,matchUpsMap:r})),!r?.drawMatchUps.some((e=>e.finishingPositionRange))&&1===t?.structures?.length&&!t?.structures[0].structures){hm({matchUps:r?.drawMatchUps??[]})}return(e??[]).filter((({collectionId:e})=>!e)).forEach((n=>{let{matchUpId:a,structureId:o}=n,s=tm({inContextDrawMatchUps:e,drawDefinition:t,matchUpId:a}),{winnerMatchUp:c,loserMatchUp:u}=s.targetMatchUps,d=c?.matchUpId,l=u?.matchUpId,p=fp({matchUpsMap:r,structureId:o}).find((e=>e.matchUpId===a));if(p&&(d&&(i.winnerMatchUpIds[p.matchUpId]=d,Object.assign(p,{winnerMatchUpId:d}),Object.assign(n,{winnerMatchUpId:d})),l&&(i.loserMatchUpIds[p.matchUpId]=l,n.loserMatchUpId=l,p.loserMatchUpId=l,n.finishingPositionRange))){let e=u.finishingPositionRange&&[...n.finishingPositionRange.loser,...u.finishingPositionRange.loser],t=e&&[Math.min(...e),Math.max(...e)];n.finishingPositionRange.loser=t,p.finishingPositionRange.loser=t}})),{inContextDrawMatchUps:e,goesToMap:i}}function Im(e){let t=yu(e),r=e.matchUps??[],i=e.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:o}=e;if(!Array.isArray(r))return{error:Oe};if(!Array.isArray(i))return{error:H};let s=e.matchUpIds?.length?e.matchUpIds:r.map((e=>e.matchUpId));if(!Array.isArray(s))return{error:Ee};let c={},u={},d={},l={};a&&!Object.keys(t).length&&(t={[a.tournamentId]:a});let p=Object.values(t),m=p.reduce(((e,t)=>e.concat(t.events??[]).map((e=>(e.drawDefinitions||[]).map((e=>e.links||[])))).flat(1/0)),[]).filter((({linkType:e})=>e===xs)),f=r;if(m.length){f=um({nextMatchUps:!0,tournamentRecords:t}).matchUps;let e=m.reduce(((e,t)=>{let r=t.source?.structureId,i=t.target?.structureId;return r&&i&&(d[i]=r),r&&!e.includes(r)&&e.push(r),e}),[]);for(let t of e)c[t]=[];for(let t of f??[]){let r=t.containerStructureId||t.structureId;e.includes(r)&&c[r].push(t.matchUpId)}}let h=e=>{u[e]||(u[e]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},l[e]=[])},g=(e,t)=>{u[e].matchUpIds.forEach((e=>{u[t].matchUpIds.push(e)})),u[t].matchUpIds.push(e),u[e].dependentMatchUpIds.push(t),n&&u[e].participantIds.forEach((e=>u[t].participantIds.push(e)))},U=e=>{let t=Object.keys(c).length;for(let r of e||[]){let{matchUpId:e,winnerMatchUpId:i,loserMatchUpId:a}=r;if(!s.length||s.includes(e)){if(h(e),n){let{individualParticipantIds:t}=vu(r);u[e].participantIds=t}i&&(h(i),g(e,i),l[i].push(e)),a&&(h(a),g(e,a),l[a].push(e)),u[e].sources.push(l[e]);let o=l[e].map((e=>u[e].sources[0])).flat(),s=l[e].map((e=>u[e].sources[1])).flat();if(u[e].sources.push(o,s),t){let t=r.containerStructureId||r.structureId,i=d[t];if(c[i])for(let r of c[i])h(r),g(r,e),l[r].push(e)}}}};if(o)gm({drawDefinition:o}),f?.length||(f=lm({drawDefinition:o}).matchUps),U(f);else{if(f?.length||(f=um({nextMatchUps:!0,tournamentRecords:t}).matchUps),!i.length){let e=p?.length?p.map((({events:e=[]})=>e.map((({drawDefinitions:e=[]})=>e.map((({drawId:e})=>e)))))).flat(1/0):[];e&&(i=e)}for(let e of i){let r=f?.filter((t=>t.drawId===e)).sort(dm);if(!r?.find((({roundPosition:e})=>!e))){let i=r?.find((({tournamentId:e})=>e)),{drawDefinition:n}=sp({tournamentRecord:t[i?.tournamentId],drawId:e});n&&gm({drawDefinition:n})}U(r)}}return{positionDependencies:c,matchUpDependencies:u,sourceMatchUpIds:l,matchUps:f,...I}}function Um(e){let t=e?.matchUp,r=e?.score||t?.score,i=r?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s,side1PointScore:c,side2PointScore:u}=i||{},d=n||a||o||s||c||u;return!!(r?.sets?.length>1||d)}function vm({matchUpStatus:e}){return ls.includes(e)}function ym({matchUpStatus:e}){return ps.includes(e)}function Sm({matchUpStatus:e,winningSide:t,tieMatchUps:r,sides:i,score:n}){let a=i?.find((({participantId:e})=>e)),o=r?.filter(Sm)?.length;return Um({score:n})||o||t&&a||e&&function({matchUpStatus:e}){return fs.includes(e)}({matchUpStatus:e})&&![Xo,ss,ts].includes(e)}function wm(e){let{drawDefinition:t,findContainer:r,structureId:i,event:n}=e,a=e.structure,{containedStructures:o}=lu({drawDefinition:t}),s=i&&o[i]||[];if(!a){let e=yc({drawDefinition:t,structureId:i});if(e.error)return e;a=r?e.containingStructure??e.structure:e.structure}if(Tp({structure:a}))return{structure:a,isAdHoc:!0,error:B};let{matchUps:c}=am({inContext:!0,matchUpFilters:{isCollectionMatchUp:!1},drawDefinition:t,event:n}),u=c?.filter((e=>e.structureId===i||s.includes(e.structureId))),{matchUpDependencies:d}=Im({drawIds:[t.drawId],matchUps:c,drawDefinition:t}),l=[],p=[],m={},f=[];for(let w of c??[]){if(w.structureId===i||s.includes(w.structureId)){p.push(...w.drawPositions??[]);let e=w.roundNumber;for(let t of(w.drawPositions??[]).filter(Boolean))(!m[t]||e&&m[t]>e)&&(m[t]=e)}Sm(w)&&(f.push(w),l.push(w.matchUpId,...d?.[w?.matchUpId]?.matchUpIds||[]))}let h=Yr(p.filter(Boolean)).sort(kr),g=Yr(l),I=Yr(u?.map((({matchUpId:e,drawPositions:t})=>g.includes(e)?t:[])).flat().filter(Boolean)).sort(kr),{positionAssignments:U}=Pc({drawDefinition:t,structure:a}),v=U?.filter((e=>e.bye)).map((e=>e.drawPosition)),y=U?.filter((e=>e.qualifier)).map((e=>e.drawPosition)),S=h?.filter((e=>!I.includes(e)))||[];return{allDrawPositions:h,inContextStructureMatchUps:u,drawPositionInitialRounds:m,activeDependentMatchUpIds:g,qualifyingDrawPositions:y,inactiveDrawPositions:S,positionAssignments:U,activeDrawPositions:I,byeDrawPositions:v,activeMatchUps:f,structure:a}}function Pm({drawPosition:e,matchUps:t=[]}){return{initialRoundNumber:t.filter((({drawPositions:t})=>e&&t?.includes(e))).map((({roundNumber:e})=>e)).sort(kr)[0]}}var Dm={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",red:"\x1b[31m",brightred:"\x1b[91m",green:"\x1b[32m",brightgreen:"\x1b[92m",yellow:"\x1b[33m",brightyellow:"\x1b[93m",blue:"\x1b[34m",brightblue:"\x1b[94m",lightblue:"\x1b[105m",magenta:"\x1b[35m",brightmagenta:"\x1b[95m",cyan:"\x1b[36m",brightcyan:"\x1b[96m",white:"\x1b[37m",brightwhite:"\x1b[97m"},Tm=[];function bm(e,t){"string"==typeof e&&(e={method:e}),(t||wi())&&Tm.push(e)}function Rm(e){let t=function(e){let t=Tm.slice();return e&&(Tm.length=0),t}(e).map((e=>{let{color:t,keyColors:r,method:i,newline:n}=e,a=Object.keys(Dm).includes(t)?Dm[t]:Dm.cyan,o=Object.keys(e).filter((e=>!["color","keyColors","method","newline"].includes(e))).map((t=>{let i=r&&Object.keys(r).includes(t)&&Dm[r[t]]?Dm[r[t]]:Dm.brightwhite;return`${Dm.white}${t}: ${i}${e[t]}`})).join(", ");return[n?"\n":"",a,i,i?.length<15?"\t\t":"\t",Dm.white,o,Dm.reset,"\n"].join("")}));t?.length&&console.log(...t)}function Mm({provisionalPositioning:e,isPositionAction:t,tournamentRecord:r,drawDefinition:i,drawPosition:n,matchUpsMap:a,structureId:o,structure:s,event:c}){if(!i)return{error:M};if(s||({structure:s}=yc({drawDefinition:i,structureId:o})),!s)return{error:ae};o||({structureId:o}=s);let u="assignDrawPositionBye";bm({method:u,color:"cyan",drawPosition:n}),a||(a=mp({drawDefinition:i}));let{positionAssignments:d}=Pc({structure:s}),{activeDrawPositions:l}=wm({drawDefinition:i,structureId:o});if(d?.find((e=>e.drawPosition===n))?.bye)return{...I};if(l?.includes(n))return{error:V};let p=d?.find((e=>e.drawPosition===n));if(!p)return{error:B};let{filled:m,containsBye:f,assignedParticipantId:h}=function(e){let t=e.bye,r=e.qualifier,i=e.participantId;return{containsBye:t,containsQualifier:r,assignedParticipantId:i,filled:t||r||i}}(p);if(f)return{...I};if(m&&!f)return en({result:{error:F},stack:u});let g=Yu({tournamentRecord:r,drawDefinition:i,event:c}).appliedPolicies??{},U=am({inContext:!0,drawDefinition:i,matchUpsMap:a}).matchUps??[],{matchUps:v}=Kp({provisionalPositioning:e,drawDefinition:i,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:a,structure:s});if(d?.forEach((e=>{e.drawPosition===n&&(e.bye=!0)})),s.structureType===Es)return function({tournamentRecord:e,drawDefinition:t,drawPosition:r,matchUps:i,event:n}){i.forEach((i=>{i.drawPositions?.includes(r)&&Am({eventId:n?.eventId,tournamentRecord:e,drawDefinition:t,matchUp:i})}))}({tournamentRecord:r,drawDefinition:i,drawPosition:n,matchUps:v}),su({tournamentId:r?.tournamentId,drawDefinition:i,structure:s,event:c}),Nm({assignedParticipantId:h,isPositionAction:t,appliedPolicies:g,drawDefinition:i,drawPosition:n,structureId:o,stack:u});let{roundProfile:y,roundMatchUps:S}=Up({matchUps:v}),w=(y&&Object.keys(y).map((e=>parseInt(e))).reverse())?.find((e=>y?.[e].drawPositions?.includes(n))),P=w?S?.[w].find((({drawPositions:e})=>e?.includes(n))):void 0;P&&Am({tournamentRecord:r,drawDefinition:i,matchUp:P,event:c});let D=P?.drawPositions?.find((e=>e!==n));if(P&&D){let e=Em({sourceDrawPositions:P.drawPositions,matchUpId:P.matchUpId,inContextDrawMatchUps:U,drawPositionToAdvance:D,tournamentRecord:r,drawDefinition:i,matchUpsMap:a});if(e.error)return e}return su({tournamentId:r?.tournamentId,drawDefinition:i,structure:s,event:c}),Nm({assignedParticipantId:h,isPositionAction:t,appliedPolicies:g,drawDefinition:i,drawPosition:n,structureId:o,stack:u})}function Nm({assignedParticipantId:e,isPositionAction:t,appliedPolicies:r,drawDefinition:i,drawPosition:n,structureId:a,stack:o}){return t&&du({appliedPolicies:r,drawDefinition:i,positionAction:{removedParticipantId:e,drawPosition:n,structureId:a,name:o}}),en({result:{...I},stack:o})}function Am({tournamentRecord:e,drawDefinition:t,eventId:r,matchUp:i,event:n}){Object.assign(i,{matchUpStatus:Yo,score:void 0,winningSide:void 0}),iu({tournamentId:e?.tournamentId,eventId:r??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:t,matchUp:i})}function Em({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:r,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,matchUpId:o,event:s}){bm({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:e});let c=a.drawMatchUps.find((e=>e.matchUpId===o)),u=t.find((e=>e.matchUpId===o))?.structureId,{structure:d}=yc({drawDefinition:n,structureId:u}),{positionAssignments:l}=Pc({structure:d}),p=l?.filter((e=>e.bye)).map((e=>e.drawPosition)),m=c?.drawPositions?.find((t=>t!==e)),f=m&&p?.includes(m),{targetLinks:{loserTargetLink:h},targetMatchUps:{loserMatchUp:g,winnerMatchUp:U,loserTargetDrawPosition:v}}=tm({inContextDrawMatchUps:t,drawDefinition:n,matchUpId:o});if(U&&U.structureId===d?.structureId&&function({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:r,tournamentRecord:i,drawDefinition:n,winnerMatchUp:a,matchUpsMap:o,event:s}){let c="advanceWinner",u=o.drawMatchUps.find((e=>e.matchUpId===a.matchUpId)),d=t.find((e=>e.matchUpId===a.matchUpId))?.structureId,{structure:l}=yc({drawDefinition:n,structureId:d}),{positionAssignments:p}=Pc({structure:l}),m=p?.find((({drawPosition:t})=>t===e))?.bye,f=u.drawPositions?.filter(Boolean),h=p?.filter((e=>f?.includes(e.drawPosition))),g=p?.find((({drawPosition:t})=>t===e)),I=r?.find((t=>t!==e)),U=(I&&h?.find((({drawPosition:e})=>e===I)))?.bye,v=m&&U;if(v&&console.log({isByeAdvancedBye:v}),f?.length>1&&m&&!U)return en({result:{error:F},stack:c});let y=f?.find((t=>t!==e)),S=v,w=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),P=w.map((t=>!t&&!S||t===e?(S=!0,e):t)).sort(kr);if(!S)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:e,existingAssignments:h}),en({result:{error:F},stack:c});let D=p?.find((({drawPosition:e})=>e===y))?.bye,T=p?.find((({drawPosition:t})=>t===e))?.bye;Object.assign(u,{matchUpStatus:T||D?Yo:os,score:void 0,winningSide:void 0,drawPositions:P});let b=u.drawPositions.find((e=>!w.includes(e)));bm({method:c,color:"brightyellow",changedDrawPosition:b,pairedDrawPositionIsBye:D,drawPositionIsBye:T}),iu({tournamentId:i?.tournamentId,matchUp:u,eventId:s?.eventId,context:c,drawDefinition:n});let{targetLinks:{loserTargetLink:R},targetMatchUps:{loserMatchUp:M,loserTargetDrawPosition:N}}=tm({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:n});if(D||T){let r=D?e:y;if(r)Em({drawPositionToAdvance:r,matchUpId:a.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o});else if(T&&R&&M)if(M.feedRound)Cm({loserTargetDrawPosition:N,tournamentRecord:i,loserTargetLink:R,drawDefinition:n,loserMatchUp:M,matchUpsMap:o});else{let e=1-a.roundPosition%2,t=M.drawPositions[e],r=Mm({structureId:R.target.structureId,drawPosition:t,tournamentRecord:i,drawDefinition:n,event:s});if(r.error);}}}({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:r,tournamentRecord:i,drawDefinition:n,winnerMatchUp:U,matchUpsMap:a,event:s}),g&&f&&g.structureId!==d?.structureId){let{roundNumber:e}=g;if(1===e){let e=Mm({structureId:h.target.structureId,drawPosition:v,tournamentRecord:i,drawDefinition:n,event:s});if(e.error)return e}else Cm({loserTargetDrawPosition:v,tournamentRecord:i,loserTargetLink:h,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:s})}return{...I}}function Cm({loserTargetDrawPosition:e,tournamentRecord:t,loserTargetLink:r,drawDefinition:i,loserMatchUp:n,matchUpsMap:a,event:o}){let{roundNumber:s}=n;bm({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:e});let c=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:u}=Pm({drawPosition:e,matchUps:c});if(u===s){let n=Mm({structureId:r.target.structureId,drawPosition:e,tournamentRecord:t,drawDefinition:i,event:o});if(n.error)return n}}function Om({positionAssignments:e,tournamentRecord:t,drawDefinition:r,matchUpsMap:i,structure:n,event:a}){let{matchUps:o}=Kp({drawDefinition:r,matchUpsMap:i,structure:n,event:a});o.forEach((i=>{let n=e.filter((({drawPosition:e})=>i.drawPositions?.includes(e))).filter((e=>e.bye)).length;i.winningSide||(Object.assign(i,{matchUpStatus:n?Yo:os}),iu({tournamentId:t?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:r,matchUp:i}))}))}function Fm(e){let{inContextDrawMatchUps:t,participantId:r,drawPosition:i}=e,{tournamentRecord:n,drawDefinition:a,structureId:o,matchUpsMap:s,event:c}=e,{structure:u}=yc({drawDefinition:a,structureId:o}),d=(Dc({drawDefinition:a,structure:u}).positionAssignments||[]).find((e=>r&&e.participantId===r||i&&e.drawPosition===i));if(d&&r&&!i&&(i=d?.drawPosition),!i)return{error:j};r||(r=d?.participantId);let{activeDrawPositions:l}=wm({drawDefinition:a,structureId:o});return l.includes(i)?{error:V}:(t||({matchUps:t}=am({inContext:!0,drawDefinition:a,matchUpsMap:s})),km({inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:a,structureId:o,drawPosition:i,matchUpsMap:s,event:c}).drawPositionCleared?(su({tournamentId:n?.tournamentId,drawDefinition:a,structure:u,event:c}),{...I,participantId:r}):{error:x})}function km({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,matchUpsMap:n,structureId:a,event:o}){let{structure:s}=yc({drawDefinition:r,structureId:a});if(!s)return{error:ae};let c=Dc({drawDefinition:r,structure:s}).positionAssignments||[],u=c.some((e=>{if(e.drawPosition===i)return delete e.participantId,delete e.qualifier,delete e.bye,!0}));if(s.structureType===Es)return Om({positionAssignments:c,tournamentRecord:t,drawDefinition:r,matchUpsMap:n,structure:s}),{drawPositionCleared:u,...I};let{matchUps:d}=Kp({drawDefinition:r,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:s,event:o}),{roundProfile:l,roundMatchUps:p}=Up({matchUps:d}),m=(l&&Object.keys(l))?.map((e=>xr(e))),f=i,h=m?.map((e=>{let t=l?.[e]?.pairedDrawPositions?.find((e=>e.includes(f))),r=t?.find((e=>e!==f)),i=c.find((e=>e.drawPosition===r)),n=l?.[e+1],a=i?.bye,o=n?.pairedDrawPositions?.find((e=>e.includes(r))),s=a&&o&&n&&n.drawPositions?.includes(r),u=t&&{pairedDrawPositionByeAdvancedPair:!s&&o,pairedDrawPosition:r,targetDrawPosition:f,relevantPair:t,roundNumber:e};return s&&(f=r),u})).filter((e=>e?.targetDrawPosition))?.reduce(((e,t)=>{let{roundNumber:r,relevantPair:i,targetDrawPosition:n,pairedDrawPosition:a,pairedDrawPositionByeAdvancedPair:o}=t,s=[{roundNumber:r,targetDrawPosition:n,relevantPair:i},o&&{roundNumber:r+1,targetDrawPosition:a,relevantPair:o,subsequentRoundRemoval:!0}].filter(Boolean);return e.concat(...s)}),[]);return h?.forEach((({roundNumber:u,targetDrawPosition:d,relevantPair:l})=>{let m=p?.[u].find((e=>ui(e.drawPositions?.filter(Boolean),l.filter(Boolean))));m&&(function({inContextDrawMatchUps:e,targetDrawPosition:t,tournamentRecord:r,drawDefinition:i,matchUpsMap:n,roundNumber:a,structureId:o}){let{structure:s}=yc({drawDefinition:i,structureId:o});if(!s)return{error:ae};if(s.structureType===Es)return;n=n||mp({drawDefinition:i});let c=(n?.mappedMatchUps||{})[o].matchUps,{initialRoundNumber:u}=Pm({drawPosition:t,matchUps:c}),d=c?.filter((e=>e.roundNumber>=a&&e.roundNumber!==u&&e.drawPositions?.includes(t))),l=Pc({drawDefinition:i,structureId:o}).positionAssignments??[];d?.forEach((a=>xm({drawPosition:t,targetMatchUp:a,inContextDrawMatchUps:e,positionAssignments:l,tournamentRecord:r,drawDefinition:i,matchUpsMap:n,structure:s})))}({inContextDrawMatchUps:e,targetDrawPosition:d,tournamentRecord:t,drawDefinition:r,structureId:a,roundNumber:u,matchUpsMap:n}),xm({inContextDrawMatchUps:e,positionAssignments:c,tournamentRecord:t,drawDefinition:r,targetMatchUp:m,drawPosition:i,matchUpsMap:n,structure:s,event:o}))})),{tasks:h,drawPositionCleared:u,positionAssignments:c}}function xm({inContextDrawMatchUps:e,positionAssignments:t,tournamentRecord:r,drawDefinition:i,targetMatchUp:n,drawPosition:a,matchUpsMap:o,structure:s,event:c}){let u="removeDrawPosition",d=n.drawPositions?.slice(),l=n.matchUpStatus,p=n.winningSide,m=(o=o??mp({drawDefinition:i})).mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:f}=Pm({drawPosition:a,matchUps:m});if(n.roundNumber&&f&&n.roundNumber>f){let e=(n.drawPositions??[]).map((e=>e===a?void 0:e));n.drawPositions=e}if(n.matchUpType===Iu){let t=(e?.find((e=>e.matchUpId===n.matchUpId))?.sides??[]).reduce(((e,t,r)=>t.drawPosition===a?r:e),void 0);void 0!==t&&n.sides?.[t]?.lineUp&&(delete n.sides?.[t].lineUp,iu({tournamentId:r?.tournamentId,context:`${u}-TEAM`,eventId:c?.eventId,matchUp:n,drawDefinition:i}))}let h=tm({matchUpId:n.matchUpId,inContextDrawMatchUps:e,drawDefinition:i}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:U,winnerMatchUp:v,loserMatchUpDrawPositionIndex:y}}=h,S=t.filter((({drawPosition:e})=>n.drawPositions?.includes(e))).filter((e=>e.bye)).length,w=S&&Yo||n.matchUpStatus&&[Xo,ss].includes(n.matchUpStatus)&&n.matcHUpStatus||2===n.drawPositions?.length&&os||void 0;n.matchUpStatus=w,n.matchUpStatus&&[ss,Xo].includes(n.matchUpStatus)&&(n.winningSide=void 0);let P=d?.find((e=>!n.drawPositions?.includes(e)));if(d?.includes(a)&&l===n.matchUpStatus&&p===n.winningSide||(P&&bm({method:u,color:"brightyellow",removedDrawPosition:P}),iu({tournamentId:r?.tournamentId,eventId:c?.eventId,matchUp:n,context:`${u}-${a}`,drawDefinition:i})),U&&U.structureId!==h.matchUp.structureId&&!S){let{drawPositions:t,roundNumber:n}=U;if(1===n){let n=t[y];km({structureId:U.structureId,drawPosition:n,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:i,matchUpsMap:o})}else{let n=Math.min(...t.filter(Boolean)),a=function({loserMatchUpDrawPosition:e,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:i,loserMatchUp:n,matchUpsMap:a,event:o}){let{structure:s}=yc({structureId:n.structureId,drawDefinition:i}),{positionAssignments:c}=Pc({structure:s});if(c?.find((t=>t.drawPosition===e))?.bye){let s=Fm({drawPosition:e,structureId:n.structureId,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:i,matchUpsMap:a,event:o});if(s.error)return s}return{...I}}({loserMatchUpDrawPosition:n,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:i,loserMatchUp:U,matchUpsMap:o,event:c});if(a.error)return en({result:a,stack:u});let s=(o?.mappedMatchUps||{})[U.structureId].matchUps,{initialRoundNumber:d}=Pm({drawPosition:n,matchUps:s});1===d&&(bm({method:u,color:"brightyellow",loserMatchUpDrawPosition:n}),km({structureId:U.structureId,drawPosition:n,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:i,matchUpsMap:o}))}}return v&&v.structureId!==h.matchUp.structureId&&g.target.feedProfile,{...I}}function _m({drawDefinition:e,stages:t}){if(!e)return{error:M};let r=Yr((e?.structures??[]).filter((e=>!t?.length||e.stage&&t.includes(e.stage))).map((e=>{let{positionAssignments:t}=Pc({structure:e});return t?t.map(Go):[]})).flat().filter(Boolean));return{...I,assignedParticipantIds:r}}function Lm(e){let t=(e?.entries??[]).filter(Boolean).reduce(((e,t)=>{let{entryStage:r,entryStatus:i}=t,n=`_${r||Is}${i||""}`;return e[n]||(e[n]=[]),e[n].push(t),e}),{}),r=e=>isNaN(e)?1/0:e;return Object.keys(t).map((e=>t[e].sort(((e,t)=>r(e.entryPosition)-r(t.entryPosition))).map(((e,t)=>({...e,entryPosition:t+1}))))).flat()}function Vm(e){return[Ud,Id].includes(e)}function Bm({autoEntryPositions:e=!0,ignoreAssignment:t,tournamentRecord:r,drawDefinition:i,participantIds:n,entryStatus:a,entryStage:o,extension:s,eventSync:c,drawId:u,stage:d,event:l}){if(!n||!Array.isArray(n))return{error:dt,method:"modifyEntriesStatus",participantIds:n};if(!i&&!l)return{error:de};if(a&&!Td.includes(a))return{error:Mt};if(o&&!ws.includes(o))return{error:Ie};let p="modifyEntriesStatus",m=[];if(!a&&!s)return en({result:{error:He},info:"Missing entryStatus",stack:p});if(s&&!Ha({extension:s,requiredAttributes:["name"]}))return en({result:{error:mr},info:"Invalid extension",context:{extension:s},stack:p});let f=[];l?.drawDefinitions?.forEach((e=>{let t=_m({stages:d&&[d],drawDefinition:e}).assignedParticipantIds??[];f.push(...t)}));let h=r?.participants??[];if(!n.every((e=>{let t=Ga({tournamentParticipants:h,participantId:e})?.participantType;return!(t&&[Ru,Du].includes(t)&&Vm(a)||a&&l?.eventType&&t===Tu&&[Ol,xl].includes(l.eventType)&&[cd,...Sd].includes(a))})))return{error:Mt};let g=l&&op({event:l}).flightProfile,U=g?.flights?.find((e=>e.drawId===u)),v=e=>{let r=(e||[]).filter((e=>!d||!e.entryStage||d===e.entryStage)).filter((({participantId:e})=>n.includes(e)));return r.every((e=>!((e=>a&&f.includes(e.participantId)&&!(Sd.includes(e.entryStatus)&&Sd.includes(a)))(e)&&!t)&&(a&&(e.entryStatus=a,delete e.entryPosition),o&&(e.entryStage=o,delete e.entryPosition),s&&(s.value?za({element:e,extension:s}):Wa({element:e,name:s.name})),!0)))?{...I}:{error:Tt}},y=({flight:e,drawDefinition:t})=>{l&&(l.entries=Lm({entries:l.entries??[]})),e&&(e.drawEntries=Lm({entries:e.drawEntries})),t&&(t.entries=Lm({entries:t.entries}))},S=e=>{let{flight:t,drawDefinition:r}=e,i="updateDrawEntries";if(t){let e=v(t.drawEntries);if(e.error)return en({result:e,stack:i})}if(r){let e=v(r.entries);if(e.error)return en({result:e,stack:i});m.includes(r.drawId)||m.push(r.drawId)}return{...I}},w=l?.entries?.find((({entryPosition:e})=>e))??(U?.drawEntries?.find((({entryPosition:e})=>e))||i?.entries?.find((({entryPosition:e})=>e)));if(e&&!w&&y({flight:U,drawDefinition:i}),U||i){let e=S({flight:U,drawDefinition:i});if(e.error)return en({result:e,stack:p})}let P=l?.drawDefinitions?.map((({drawId:e})=>e))??[],D=g?.flights?.filter((e=>!P.includes(e.drawId)))||[];for(let I of D){let e=I&&S({flight:I});if(e?.error)return en({result:e,stack:p})}let T=1===g?.flights?.length&&(l?.drawDefinitions?.length??0)<=g?.flights?.length;if(!U&&!i&&a&&wd.includes(a))return{error:Ot};if(!U&&!i||a===yd||c&&T){let e,t=v(l?.entries);if(t?.error)return en({result:t,stack:p});if(a===yd&&(g?.flights?.every((t=>{let r=v(t.drawEntries);return r.error?(e=r.error,!1):(t.drawEntries=t.drawEntries.filter((({participantId:e})=>!n.includes(e))),!0)})),l?.drawDefinitions?.every((t=>{let r=v(t.entries);return r.error?(e=r.error,!1):(t.entries=t.entries?.filter((({participantId:e})=>!n.includes(e))),!0)}))),e)return en({result:{error:e},stack:p})}e&&y({flight:U,drawDefinition:i});for(let I of l?.drawDefinitions??[])m.length&&!m.includes(I.drawId)||au({tournamentId:r.tournamentId,eventId:l?.eventId,drawDefinition:I});return{...I}}function jm({requireTimeStamp:e,scaleAttributes:t,participant:r}){if(!r)return{error:ht};if(!d(t))return{error:mr};if(r.timeItems||(r.timeItems=[]),Array.isArray(r.timeItems)){let{accessor:i,scaleType:n,eventType:a,scaleName:o}=t,s=[jn,n,a,o].join("."),c=r.timeItems.filter((e=>e?.itemType===s)).filter((t=>!e||t?.itemDate)).sort(((e,t)=>(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0))).pop();if(c){let[e,t,r,n]=c.itemType?.split(".")??[];if(e!==jn)return{error:ir};let a=(i&&pm({element:c.itemValue,accessor:i}))?.value||c.itemValue,o={eventType:r,scaleDate:c.itemDate,scaleValue:a,scaleName:n,scaleType:t};return{...I,scaleItem:o}}}return{...I,scaleItem:void 0}}function Gm({publishedSeeding:e,usePublishState:t,withSeeding:r,participant:i,event:n}){let a={},o=e=>[jn,Gn,n.eventType,e].join("."),s=Object.assign({},...(i.timeItems||[]).filter((({itemType:e})=>e.split(".")[1]===Gn)).map((({itemType:e,itemValue:t})=>({[e]:t})))),c=(e?.stageSeedingScaleNames&&Object.values(e?.stageSeedingScaleNames)||Array.isArray(e?.seedingScaleNames)&&e.seedingScaleNames||[]).map(o),u=si(Object.keys(s),c);if(t&&(Object.keys(s).length||e?.drawIds?.length)&&!u.length||!u.length)if(t||"object"!=typeof r){let r,{categoryName:o,ageCategoryCode:s}=n.category||{},c=[s,n.eventId,o].filter(Boolean);for(let e of c){let t=jm({scaleAttributes:{eventType:n.eventType,scaleType:Gn,scaleName:e},participant:i});if(t.scaleItem){r=t.scaleItem;break}}if(r&&(!t||e?.published&&!e?.published?.drawIds?.length)){let e=r.scaleValue;a.seedValue=e}}else{let e=Object.keys(r).map((e=>{let t=o(r[e]);return[e,s[t]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),t=Object.assign({},...e);a.seedAssignments=t}else if(e?.stageSeedingScaleNames){let t=Object.keys(e.stageSeedingScaleNames).map((t=>{let r=o(e.stageSeedingScaleNames[t]);return[t,s[r]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),r=Object.assign({},...t);a.seedAssignments=r}else if(u){let e=u.map((e=>s[e]));a.seedValue=e.pop()}return a}function qm({convertExtensions:e,seedAssignments:t,participant:r,withSeeding:i,seedValue:n,eventId:a,ranking:o,entry:s}){let{entryStatus:c,entryStage:u,entryPosition:d,extensions:l}=s,p=l?.length&&e?Object.assign({},...Ta(l??[])):{},m=Object.assign(p,{entryPosition:d,entryStatus:c,entryStage:u,ranking:o,eventId:a});r.events[a]=Zi(m,!1,!1,!0),i&&(t&&(r.events[a].seedAssignments=t),n&&(r.events[a].seedValue=n))}function $m(e){let{participantMap:t,participantId:r,matchUpStatus:i,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:c,potential:u,schedule:d,drawId:l,score:p}=e;d&&Object.keys(d).length&&(i===Yo||t[r].scheduleItems.push({...d,scheduledDate:la(d?.scheduledDate),scheduledTime:da(d?.scheduledTime),checkScoreHasValue:Um({score:p}),matchUpStatus:i,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:c,potential:u,drawId:l}))}function Wm({event:e,status:t=dl}){let r=`${ul}.${ll}`;return Lu({itemType:r,event:e})?.timeItem?.itemValue?.[t]}function Hm({drawDetails:e,drawId:t}){return e?.[t]?.publishingDetail?.published}function zm(e){let{tournamentRecord:t,drawDefinition:r,eventIds:i,eventId:n,drawIds:a,drawId:o,event:s}=e??{};if(t&&!function(e){let{tournamentId:t}=e??{};return!!t}(t))return{error:mr};if(n&&!s)return{error:le};if(Array.isArray(i)&&i?.length){let e={};for(let r of i){if(!u(r))return{error:mr};let i=sp({tournamentRecord:t,eventId:r})?.event;if(!i)return{error:le};let n=Ym({event:i});e[r]=n}return{...I,publishState:e}}if(s){let e=Ym({event:s}),t={};if(o)return r?{publishState:{status:{published:!!e.status.publishedDrawIds?.includes(o),drawDetail:e.status.drawDetails?.[o]},...I}}:{error:A};if(Array.isArray(a)&&a?.length){let r=s.drawDefinitions?.map($o)??[];for(let i of a){if(!u(i))return{error:mr};if(!r.includes(i))return{error:A};t[i]={status:{published:!!e.status.publishedDrawIds.includes(i),drawDetail:e.status.drawDetails?.[i]}}}}else t=e;return{...I,publishState:t}}let c=[],d=!1,l={},p=function({tournamentRecord:e,status:t=dl}){let r=`${ul}.${ll}`;return Vu({tournamentRecord:e,itemType:r})?.timeItem?.itemValue?.[t]}({tournamentRecord:t});l.tournament=p??{};for(let u of t?.events??[]){let e=Ym({event:u});l[u.eventId]=e,e.status.published&&(c.push(u.eventId),d=!0);for(let{drawId:t}of u.drawDefinitions??[]){let r=e.status?.publishedDrawIds?.includes(t);r&&(l[t]={status:{published:r}})}}return t&&(l.tournament.status={published:d,publishedEventIds:c}),{...I,publishState:l}}function Ym({event:e}){let t=Wm({event:e});if(!t)return{status:{published:!1}};let r={published:void 0,seedingScaleNames:[],drawIds:[]};t.seeding&&Object.assign(r,t.seeding);let i=t.drawDetails??{};for(let a of e.drawDefinitions?.map($o)||[])i[a]||(i[a]={publishingDetail:{published:!1}});let n=i&&Object.keys(i).length&&Object.keys(i).filter((e=>Hm({drawDetails:i,drawId:e})))||t.drawIds;return{status:{published:n&&n.length>0,publishedDrawIds:n,publishedSeeding:r,drawDetails:i}}}function Km(e,t){return(e||"").localeCompare(t||"")}function Qm({finishingPositionRange:e={},participantMap:t,finishingRound:r,participantWon:i,matchUpStatus:n,participantId:a,stageSequence:o,roundNumber:s,structureId:c,matchUpId:u,drawId:d,stage:l}){let p=t[a],m=e=>Math.abs(e[0]-e[1]);p.structureParticipation[c]||(p.structureParticipation[c]={rankingStage:l,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:c,drawId:d});let f=p.structureParticipation[c],{winner:h,loser:g}=e,I=i?h:g;i&&(f.winCount+=1,n===ss&&(f.walkoverWinCount+=1),n===Xo&&(f.defaultWinCount+=1)),I&&(!f.finishingPositionRange||m(I)<m(f.finishingPositionRange))&&(f.finishingPositionRange=I),r&&((!f.finishingRound||r<f.finishingRound)&&(f.finishingMatchUpId=u,f.finishingRound=r,f.roundNumber=s),1===r&&(f.participantWon=i))}function Jm(e){let{withScheduleItems:t,scheduleAnalysis:r,withTeamMatchUps:i,participantMap:n,withOpponents:a,withMatchUps:o,withEvents:s,withDraws:c,finishingPositionRange:u,finishingRound:d,matchUpStatus:l,stageSequence:p,roundNumber:m,structureId:f,score:h,stage:g,withRankingProfile:I,tieWinningSide:U,roundPosition:v,matchUpTieId:y,matchUpSides:S,collectionId:w,matchUpType:P,winningSide:D,matchUpId:T,schedule:b,eventId:R,drawId:M,sides:N}=e,A=a&&2===N?.length&&Object.assign({},...N.map((({sideNumber:e},t)=>{let r=N[1-t].participantId;return e&&{[e]:r}})).filter(Boolean));for(let E of N){let{participantId:e,sideNumber:N,bye:C}=E;if(C)continue;let O=D===N,F=e=>{let t=n[e]?.participant,r=t?.participantType,i=[{participantId:e,participantType:r}];if(r!==Du)for(let a of t?.individualParticipantIds||[]){let e=n[a]?.participant;i.push({participantType:e?.participantType,participantId:a})}return i},k=(e,i)=>{if(o){if(n[e].matchUps[T]={participantWon:O,matchUpType:P,structureId:f,sideNumber:N,matchUpId:T,eventId:R,drawId:M,stage:g},a){let t=F(i);n[e].matchUps[T].opponentParticipantInfo=t}w&&(n[e].matchUps[T].collectionId=w)}a&&i&&(n[e].opponents[i]={participantId:i,matchUpId:T,eventId:R,drawId:M}),I&&Qm({finishingPositionRange:u,participantMap:n,participantWon:O,finishingRound:d,matchUpStatus:l,participantId:e,stageSequence:p,roundNumber:m,structureId:f,matchUpId:T,drawId:M,stage:g}),(r||t)&&$m({participantMap:n,participantId:e,matchUpStatus:l,roundPosition:v,matchUpType:P,roundNumber:m,structureId:f,matchUpId:T,schedule:b,drawId:M,score:h})},x=({participant:e,partnerParticipantId:t})=>{let r=(e,t)=>{e&&(e.partnerParticipantIds||(e.partnerParticipantIds=[]),e.partnerParticipantIds.includes(t)||e.partnerParticipantIds.push(t))};c&&r(e?.draws?.[M],t),s&&r(e?.events?.[R],t),o&&r(e?.matchUps?.[T],t)};if(e&&n[e]){let t=A?.[N];k(e,t);let r=n[e]?.participant.participantType===Ru,a=n[e]?.participant.individualParticipantIds||[];if(y){if(i){let t=e=>n[e].matchUps[y]={participantWon:U===N,matchUpId:y,matchUpType:Iu,sideNumber:N};t(e),a.forEach(t)}if(c&&!n[e].draws[M]){let t=S.find((e=>e.sideNumber===N))?.participant?.participantId,r=n[t]?.draws?.[M]?.entryStatus,i=e=>n[e].draws[M]={entryStatus:r,eventId:R,drawId:M};i(e),a.forEach(i)}}if(r&&(a.forEach((e=>n[e]&&k(e,t))),a.forEach(((e,t)=>{let r=a[1-t],i=n[e];i&&x({participant:i,partnerParticipantId:r})})),s&&S)){let t=S.find((e=>e.sideNumber===N))?.participant?.participantId;if(t){let r=n[t]?.events[R];r?(n[e].events[R]={...r},a.forEach((e=>n[e].events[R]={...r}))):console.log("Missing teamEntry",{eventId:R,teamParticipantId:t})}}if(D){let t=e=>{O?(n[e].counters[P].wins+=1,n[e].counters.wins+=1,l===ss&&(n[e].counters[P].walkoverWins+=1,n[e].counters.walkoverWins+=1),l===Xo&&(n[e].counters[P].defaultWins+=1,n[e].counters.defaultWins+=1)):(n[e].counters[P].losses+=1,n[e].counters.losses+=1,l===ss&&(n[e].counters[P].walkovers+=1,n[e].counters.walkovers+=1),l===Xo&&(n[e].counters[P].defaults+=1,n[e].counters.defaults+=1))};t(e),a.forEach(t)}}}}function Xm({participantFilters:e={},tournamentRecord:t,participants:r=[]}){if(!Object.keys(e).length)return r;let{accessorValues:i,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:o,participantRoles:s,participantRoleResponsibilities:c,participantTypes:u,participantIds:d,signInStatus:l,enableOrFiltering:p,eventIds:m,genders:f}=e,h=Zm(m)&&t?.events?.filter((e=>m?.includes(e.eventId)))||t?.events||[],g=n&&function({drawEntryStatuses:e,tournamentEvents:t}){let r=({entryStatus:t})=>!Array.isArray(e)||e.includes(t);return Yr(t.reduce(((e,t)=>{let{flightProfile:i}=op({event:t}),n=i?.flights?.map((({drawEntries:e})=>Array.isArray(e)?e.filter(r).map(Go):[])).flat()||[],a=t.drawDefinitions?.map((({entries:e})=>e?e.filter(r).map(Go):[]))||[];return e.concat(...n,...a)}),[]))}({drawEntryStatuses:n,tournamentEvents:h}),I=o&&function({eventEntryStatuses:e,tournamentEvents:t}){return Yr(t.reduce(((t,r)=>{let i=(r.entries||[]).filter((({entryStatus:t})=>!Array.isArray(e)||e.includes(t))).map(Go);return t.concat(...i)}),[]))}({eventEntryStatuses:o,tournamentEvents:h}),U=void 0!==a&&[!0,!1].includes(a)&&h.reduce(((e,t)=>e.concat(...(t.drawDefinitions||[]).map((e=>wc({drawDefinition:e}).allPositionedParticipantIds)).filter(Boolean))),[]),v=e=>i?.reduce(((t,r)=>{let{accessor:i,value:n}=r,{values:a}=pm({element:e,accessor:i});return t&&a?.includes(n)}),!0);if(r=r?.filter((e=>{let t=xu({element:e,itemType:Su})?.timeItem?.itemValue,{participantRoleResponsibilities:r,participantType:n,participantRole:o,participantId:m,person:h}=e,y=Array.isArray(f)&&f?.length&&h?.sex&&f.includes(h.sex);return p?f&&y||a&&U.includes(m)||!1===a&&!U.includes(m)||g?.includes(m)||I?.includes(m)||d?.includes(m)||l&&t===l||u&&n&&Zm(u)&&u.includes(n)||s&&o&&Zm(s)&&s.includes(o)||c&&Zm(r)&&Zm(c)&&c.find((e=>r?.includes(e)))||i?.length&&Zm(i)&&v(e):(!f||y)&&(void 0===a||a&&U.includes(m)||!1===a&&!U.includes(m))&&(!g||g.includes(m))&&(!I||I.includes(m))&&(!d||d.includes(m))&&(!l||t===l)&&(!u||n&&Zm(u)&&u.includes(n))&&(!s||o&&Zm(s)&&s.includes(o))&&(!c||Zm(r)&&Zm(c)&&c.find((e=>r?.includes(e))))&&(!i?.length||Zm(i)&&v(e))})),h.length&&m){let e=h.filter((e=>m.includes(e.eventId))).map((e=>{let r=(e.entries||[]).map((e=>e.participantId));if(hl(El)(e.eventType))return r;let i=(t?.participants??[]).filter((e=>r.includes(e.participantId))).map((e=>e.individualParticipantIds)).flat(1);return r.concat(...i)})).flat(1);r=r?.filter((t=>e.includes(t.participantId)))}return r}function Zm(e){return e&&Array.isArray(e)&&e.length}function ef(e){let{withIndividualParticipants:t,participantFilters:r={},withPotentialMatchUps:i,withRankingProfile:n,convertExtensions:a,policyDefinitions:o,withScheduleItems:s,tournamentRecord:c,scheduleAnalysis:u,withSignInStatus:l,withTeamMatchUps:p,withScaleValues:m,usePublishState:f,contextProfile:h,withStatistics:g,withOpponents:U,withMatchUps:v,internalUse:y,withSeeding:S,withEvents:w,withDraws:P,withISO2:T,withIOC:b}=e;if(!c)return{error:D};(v||n)&&Im({tournamentRecord:c});let{participantMap:R}=qu({convertExtensions:a,tournamentRecord:c,withSignInStatus:l,withScaleValues:m,internalUse:y,withISO2:T,withIOC:b}),M=function(e){let{participantFilters:t,convertExtensions:r,policyDefinitions:i,tournamentRecord:n,usePublishState:a,contextProfile:o,participantMap:s,withPotentialMatchUps:c,withRankingProfile:u,withScheduleItems:l,scheduleAnalysis:p,withTeamMatchUps:m,withStatistics:f,withOpponents:h,withMatchUps:g,withSeeding:I,withEvents:U,withDraws:v}=e,y=t?.participantIds,S=e=>{let t=[e];return s[e]?.participant.individualParticipantIds?.forEach((e=>t.push(e))),t.some((e=>!y?.length||y.includes(e)))?t:[]},w={withMatchUps:g||u,withEvents:U||u,withDraws:v||u,withPotentialMatchUps:c,withRankingProfile:u,withScheduleItems:l,scheduleAnalysis:p,withTeamMatchUps:m,withStatistics:f,participantMap:s,withOpponents:h,withSeeding:I},P=[],D={},T=[],b={},R={},M={},N=({eventType:e,scaleNames:t,participantId:r})=>s[r].participant?.rankings?.[e]?.find((e=>t.includes(e.scaleName)))?.scaleValue;for(let d of n?.events||[]){if(t?.eventIds&&!t.eventIds.includes(d.eventId))continue;let{drawDefinitions:e=[],extensions:y=[],eventType:P,eventName:A,category:E,entries:C,eventId:O,gender:F}=d,{flightProfile:k}=op({event:d}),x=k?.flights??[],_=zm({event:d}).publishState;_&&(b[O]=_);let L=_?.status?.publishedSeeding;if(U||I||u){let e=r?Object.assign({},...Ta(y??[])):{};R[O]={...e,eventName:A,eventType:P,category:E,eventId:O,gender:F};let t=[E?.categoryName,E?.ageCategoryCode].filter(Boolean);for(let i of C){let{participantId:e}=i;if(!e||!s[e])continue;let n,o,c=N({eventType:P,scaleNames:t,participantId:e});if(I){let t=s[e].participant;({seedAssignments:n,seedValue:o}=Gm({publishedSeeding:L,usePublishState:a,withSeeding:I,participant:t,event:d}))}let u=e=>{if(s[e]?.events?.[O])return;let t=s[e];qm({convertExtensions:r,seedAssignments:n,participant:t,withSeeding:I,seedValue:o,eventId:O,ranking:c,entry:i})};u(e),(s[e].participant.individualParticipantIds||[]).forEach(u)}}let V=b?.[O]?.publishedSeeding;if(v||u||I){let t=e=>e?Object.assign({},...e.map((({participantId:e,seedValue:t,seedNumber:r})=>({[e]:{seedValue:t,seedNumber:r}})))):void 0,r=Yr([...e.map($o),...x.map($o)]);for(let i of r){let r,n,o,c,d=e.find((e=>e.drawId===i)),l=x?.find((e=>e.drawId===i)),p=d?.entries||l?.drawEntries,{structures:m=[],drawOrder:f,drawName:h,drawType:g}=d??{},U=l?.flightNumber,y=[E?.categoryName,E?.ageCategoryCode].filter(Boolean),S=(d?.structures||[]).sort(((e,t)=>Uc(e,t))).map((({structureId:e,structures:t})=>[e,...(t||[]).map((({structureId:e})=>e))])).flat(1/0),w=0,D=m.filter((({stage:e,stageSequence:t})=>e===Is&&1===t||e===Us)).flatMap((e=>{let{seedAssignments:t,stageSequence:i,stage:a}=e,{positionAssignments:s}=Pc({structure:e});return a===Is?(w=s?.length??0,o=s,c=t):1===i&&(r=s,n=t),s})).map((({participantId:e})=>e)).filter(Boolean),T=t(c),b=t(n),R=d?p.filter((({participantId:e})=>D.includes(e))):p,A=!a||V?.published&&(0===V?.drawIds?.length||V?.drawIds?.includes(i));for(let e of R){let{entryStatus:t,entryStage:r,entryPosition:n,participantId:a}=e,o=N({participantId:a,scaleNames:y,eventType:P}),c=e=>{if(s[e].draws?.[i])return;let c=I&&A,d=c?{}:void 0,l=c?T?.[a]?.seedValue||T?.[a]?.seedNumber:void 0,p=l?T?.[a]:void 0,m=c?b?.[a]?.seedValue||b?.[a]?.seedNumber:void 0,f=m?b?.[a]:void 0;d&&l&&(d[Is]=p),d&&m&&(d[Us]=f);let h=l||m;h&&(s[e].participant.seedings[P]||(s[e].participant.seedings[P]=[]),p&&s[e].participant.seedings[P].push({...p,scaleName:i}),f&&s[e].participant.seedings[P].push({...f,scaleName:i}),d&&(s[e].events[O].seedAssignments||(s[e].events[O].seedAssignments={}),Object.keys(d).forEach((t=>s[e].events[O].seedAssignments[t]=d[t])))),(v||u)&&(s[e].draws[i]=Zi({seedAssignments:d,entryPosition:n,entryStatus:t,entryStage:r,seedValue:h,eventId:O,ranking:o,drawId:i},!1,!1,!0))};[Id,Ud].includes(t)||(c(a),(s[a].participant.individualParticipantIds||[])?.forEach(c))}let C=(d?.structures??[]).reduce(((e,t)=>(e.includes(t.stage)||e.push(t.stage),e)),[]),F=(d?.links??[]).length;M[i]={qualifyingPositionAssignments:r,qualifyingSeedAssignments:n,mainPositionAssignments:o,qualifyingSeedingMap:b,mainSeedAssignments:c,orderedStructureIds:S,mainSeedingMap:T,flightNumber:U,linksCount:F,drawOrder:f,drawName:h,drawType:g,drawSize:w,drawId:i,stages:C}}}if(u||p||m||f||h||g||v){let e=!!p||c,t=sm({afterRecoveryTimes:!!p,policyDefinitions:i,tournamentRecord:n,inContext:!0,contextProfile:o,participantMap:s,nextMatchUps:e,event:d})?.matchUps??[];for(let r of t){let{finishingPositionRange:t,potentialParticipants:i,tieMatchUps:a=[],sides:o=[],winningSide:c,matchUpType:u,matchUpId:d,eventId:m,drawId:f,collectionId:h,stageSequence:g,finishingRound:I,matchUpStatus:U,roundPosition:v,roundNumber:y,structureId:P,schedule:T,score:b,stage:R}=r;D[d]=r;let M={finishingPositionRange:t,finishingRound:I,stageSequence:g,roundPosition:v,collectionId:h,roundNumber:y,structureId:P,schedule:T,eventId:m,drawId:f,score:b,stage:R};Jm({...M,...w,matchUpStatus:U,winningSide:c,matchUpType:u,matchUpId:d,sides:o});for(let e of a){let{winningSide:t,sides:r=[],matchUpId:i,matchUpStatus:n,matchUpType:a}=e;Jm({...M,...w,winningSide:t,tieWinningSide:c,matchUpTieId:d,matchUpId:i,sides:r,matchUpSides:o,matchUpStatus:n,matchUpType:a})}Array.isArray(i)&&(e||p||l)&&i.flat().map(Go).filter(Boolean)?.forEach((e=>{S(e)?.forEach((e=>{s[e]&&(s[e].potentialMatchUps[d]=Zi({tournamentId:n?.tournamentId,matchUpId:d,eventId:m,drawId:f}))})),(p||l)&&$m({potential:!0,participantMap:s,participantId:e,matchUpStatus:U,roundPosition:v,structureId:P,matchUpType:u,roundNumber:y,matchUpId:d,schedule:T,drawId:f,score:b})}))}T.push(...t)}}if(f||u||p){let e=Object.values(s);for(let t of e){let{wins:e,losses:r,[mu]:{wins:i,losses:n},[hu]:{wins:a,losses:o}}=t.counters,c=(e,r,i)=>{let n=r+i,a=r,o=n&&a/n;t.statistics[e]={denominator:n,numerator:a,statValue:o,statCode:e}};if(f&&(c(td,e,r),c(`${td}.${mu}`,i,n),c(`${td}.${hu}`,a,o)),u){let e=(e=[])=>Math.abs(e[0]-e[1]);for(let r of Object.keys(t.draws)){let{orderedStructureIds:i=[],flightNumber:n}=M[r]||{};if(t.structureParticipation&&i.length){let a,o=0,s=i.map((r=>{let i=t.structureParticipation[r];if(!i)return;a||(a=i?.finishingPositionRange),e(a)>e(i?.finishingPositionRange)&&(a=i?.finishingPositionRange);let s=i.stage!==Us;return s&&(o+=1),Zi({...i,participationOrder:s?o:void 0,flightNumber:n})})).filter(Boolean);t.draws[r]&&(t.draws[r].finishingPositionRange=a,t.draws[r].structureParticipation=s)}}}if(p){let e=d(p)?p.scheduledMinutesDifference:0,r=t.scheduleItems||[],i=t.potentialMatchUps||{},n=r.reduce(((e,t)=>{let{scheduledDate:r,scheduledTime:i}=t;return e[r]||(e[r]=[]),i&&e[r].push(t),e}),{});Object.values(n).forEach((e=>e.sort(ha)));for(let o of r){let{typeChangeTimeAfterRecovery:r,timeAfterRecovery:a,scheduledDate:s,scheduledTime:c}=o,u=n[s],d=ca(c);for(let n of u){if(n.matchUpId===o.matchUpId||[ss,Xo].includes(n.matchUpStatus)&&!n.checkScoreHasValue)continue;let s=o.matchUpType!==n.matchUpType&&r||a,c=o.drawId===n.drawId,u=i[o.matchUpId]&&i[n.matchUpId],l=ca(n.scheduledTime),p=Math.abs(l-d),m=l>=d;if((e&&!isNaN(e)?p<=e:m&&ca(n.scheduledTime)<ca(s))&&(!u||!c)&&m){let e=[o.matchUpId,n.matchUpId].sort(Km).join("|");t.scheduleConflicts[e]={priorScheduledMatchUpId:o.matchUpId,matchUpIdWithConflict:n.matchUpId}}}}let a=t.participant.participantId;Object.keys(t.scheduleConflicts).length&&P.push(a),s[a].scheduleConflicts=t.scheduleConflicts}}}return{participantIdsWithConflicts:P,eventsPublishStatuses:b,derivedEventInfo:R,derivedDrawInfo:M,mappedMatchUps:D,participantMap:s,matchUps:T}}({withMatchUps:v??n,withEvents:w??n,withDraws:P??n,withPotentialMatchUps:i,participantFilters:r,withRankingProfile:n,convertExtensions:a,withScheduleItems:s,policyDefinitions:o,tournamentRecord:c,scheduleAnalysis:u,withTeamMatchUps:p,usePublishState:f,withStatistics:g,participantMap:R,withOpponents:U,contextProfile:h,withSeeding:S}),{participantIdsWithConflicts:N,eventsPublishStatuses:A,derivedEventInfo:E,derivedDrawInfo:C,mappedMatchUps:O}=M,F=M.matchUps;R=M.participantMap;let k=u??i,x=({potentialMatchUps:e,scheduleConflicts:t,scheduleItems:r,participant:i,statistics:a,opponents:o,matchUps:c,events:d,draws:l})=>{let p=Object.values(l),m=Object.values(o);return U&&p?.forEach((e=>{e.opponents=m.filter((t=>t.drawId===e.drawId))})),Zi({...i,scheduleConflicts:u?Object.values(t):void 0,draws:P||n?p:void 0,events:w||n?Object.values(d):void 0,matchUps:v||n?Object.values(c):void 0,opponents:U?m:void 0,potentialMatchUps:k?Object.values(e):void 0,statistics:g?Object.values(a):void 0,scheduleItems:s?r:void 0},!1,!1,!0)},_=new Map;for(let d of Object.keys(R))_.set(d,x(R[d]));let L=[..._.values()],V=o?.[Oa]?.participant,B=Xm({participants:L,participantFilters:r,tournamentRecord:c});if(t){let e=d(t)?t:void 0;for(let t of B)for(let r of t.individualParticipantIds??[]){t.individualParticipants||(t.individualParticipants=[]);let i=_.get(r);t.individualParticipants.push(e?Wn({template:e,source:i}):i)}}return{participantIdsWithConflicts:N,eventsPublishStatuses:A,derivedEventInfo:E,derivedDrawInfo:C,mappedMatchUps:O,participantMap:R,participants:V?B.map((e=>Wn({source:e,template:V}))):B,...I,matchUps:F}}function tf({participantId:e,drawDefinition:t,entryStatus:r,entryStage:i}){if(!t)return{error:M};let n=t.entries?.find((t=>!(t.participantId!==e||r&&r!==t.entryStatus||i&&i!==t.entryStage)));return e&&n}function rf(e){let{provisionalPositioning:t,drawDefinition:r,stageSequence:i,structureId:n,stage:a}=e;if(!r)return{error:M};let{entryProfile:o}=sd({drawDefinition:r}),s=a&&i&&o?.[a]?.stageSequence?.[i]?.qualifiersCount||a&&o?.[a]?.qualifiersCount||0,c={};if(!n)return{qualifiersCount:s,roundQualifiersCounts:c};let{structure:u}=yc({drawDefinition:r,structureId:n}),d=r.links?.filter((e=>e?.target?.structureId===u?.structureId)),l=0;if(d?.length)for(let m of d){let e=yc({structureId:m.source.structureId,drawDefinition:r})?.structure;if(e?.stage===Us){let r=m.source.roundNumber,i=m.target.roundNumber,n=0;if(e.structureType===Es){n=(e.structures?.length??0)*(m.source.finishingPositions?.length??0)}else n=Kp({matchUpFilters:{roundNumbers:[r]},structure:e,afterRecoveryTimes:!1,provisionalPositioning:t,inContext:!1}).matchUps?.length||0;c[i]||(c[i]=0),c[i]+=n,l+=n}}let p=Object.keys(c);if(p.length<=1){let e=p[0]||1;c[e]=Math.max(c[e]||0,s)}return l=Math.max(l,s),{qualifiersCount:l,roundQualifiersCounts:c}}function nf({stage:e,drawDefinition:t}){let{entryProfile:r}=sd({drawDefinition:t});return r?.[e]?.drawSize||0}function af({stage:e,drawDefinition:t}){return!!(e===ys||Rd({stage:e,drawDefinition:t})&&nf({stage:e,drawDefinition:t}))}function of({entryStatus:e=dd,drawDefinition:t,stageSequence:r,stage:i}){if(e===cd)return function({stage:e,drawDefinition:t}){let{entryProfile:r}=sd({drawDefinition:t});return r[e]?.alternates||0}({stage:i,drawDefinition:t})?{positionsAvailable:1/0,...I}:{error:Ct};let n=function(e){let{provisionalPositioning:t,drawDefinition:r,stageSequence:i,stage:n}=e,a=nf({stage:n,drawDefinition:r}),{qualifiersCount:o}=rf({provisionalPositioning:t,drawDefinition:r,stageSequence:i,stage:n});return a&&a-o}({drawDefinition:t,stageSequence:r,stage:i}),a=function({stage:e,drawDefinition:t}){let{entryProfile:r}=sd({drawDefinition:t});return r[e]?.wildcardsCount||0}({drawDefinition:t,stage:i}),o=Md({entryStatus:vd,drawDefinition:t,stage:i}),s=o+Md({entryStatus:dd,drawDefinition:t,stage:i}),c=n-s;return i!==ys&&s>=n?{error:Ft}:e===vd?o<a?{...I}:{error:Ft}:{positionsAvailable:c,...I}}function sf(e){let{suppressDuplicateEntries:t=!0,entryStatus:r=dd,entryStageSequence:i,entryStage:n=Is,ignoreStageSpace:a,drawDefinition:o,entryPosition:s,participant:c,roundTarget:u,extensions:d,extension:l,drawType:p,event:m}=e,f="addDrawEntry";if(!o)return{error:M};if(!n)return{error:ge};if(p!==Bs&&!af({stage:n,drawDefinition:o}))return en({result:{error:Ie},stack:f});let h=of({stageSequence:i,stage:n,drawDefinition:o,entryStatus:r});if(!(a||h.success||p&&p===Bs))return{error:h.error};if(l&&!Ha({extension:l}))return en({result:{error:mr},info:"Invalid extension",context:{extension:l},stack:f});let g=e.participantId||c?.participantId;if(!g)return en({result:{error:It},stack:f});let U=r===md&&tf({participantId:g,drawDefinition:o,entryStatus:r}),v=n===ys&&tf({participantId:g,drawDefinition:o,entryStage:n}),S=tf({participantId:g,drawDefinition:o}),w=r!==md&&n!==ys&&S;if(w)return t?(ki({payload:{drawId:o.drawId,eventId:m?.eventId,error:y,participantId:g},topic:Ec}),{...I}):en({result:{error:y},context:{participantId:g},stack:f});if(U||v)return en({context:{invalidEntry:w,invalidLuckyLoser:U,invalidVoluntaryConsolation:v},result:{error:bt},stack:f});let P=Zi({entryStageSequence:i,participantId:g,entryPosition:s,entryStatus:r,entryStage:n,extensions:d});return l&&za({element:P,extension:l}),u&&za({extension:{name:"roundEntry",value:u},element:P}),o.entries||(o.entries=[]),o.entries.push(P),au({drawDefinition:o}),{...I}}function cf({suppressDuplicateEntries:e=!0,autoEntryPositions:t=!0,entryStageSequence:r,ignoreStageSpace:i,drawDefinition:n,participantIds:a,entryStatus:o,roundTarget:s,entryStage:c,extension:u,drawId:d,event:l}){if(!a?.length)return{error:St};if(!l)return{error:le};if(!d)return{error:H};let p=(l.entries||[]).map(Go);if(a.filter((e=>!p.includes(e))).length)return{error:me};if(n){let d=function(e){let t="addDrawEntries",{suppressDuplicateEntries:r=!0,entryStatus:i=dd,stage:n=Is,autoEntryPositions:a=!0,ignoreStageSpace:o,participantIds:s,drawDefinition:c,stageSequence:u,roundTarget:d,extension:l,event:p}=e;if(!n)return{error:ge};if(!c)return{error:M};if(!Array.isArray(s))return{error:lt};if(!af({stage:n,drawDefinition:c}))return{error:Ie};if(l&&!Ha({extension:l}))return en({result:{error:mr},info:"Invalid extension",context:{extension:l},stack:t});let m=of({drawDefinition:c,stageSequence:u,entryStatus:i,stage:n});if(!o&&!m.success)return{error:m.error};let f=m.positionsAvailable??0;if(!o&&n!==ys&&f<s.length)return{error:Rt};let h=[],g=c.drawId,U=p?.eventId,v=s.reduce(((e,t)=>{let a=i===md&&tf({participantId:t,drawDefinition:c,entryStatus:i}),o=n===ys&&tf({entryStage:n,drawDefinition:c,participantId:t}),s=tf({participantId:t,drawDefinition:c});return i!==md&&n!==ys&&s&&(h.push(t),r&&ki({payload:{error:y,participantId:t,eventId:U,drawId:g},topic:Ec})),a||o?e.concat(t):e}),[]);return h.length&&r?en({context:{eventId:U,drawId:g,duplicateEntries:h},result:{error:y},stack:t}):(s.filter((e=>e&&!v.includes(e))).forEach((e=>{let t={entryStageSequence:u,entryStage:n,participantId:e,entryStatus:i};l&&za({element:t,extension:l}),d&&za({extension:{name:Po,value:d},element:t}),c.entries||(c.entries=[]),c.entries.push(t)})),a&&(c.entries=Lm({entries:c.entries})),au({drawDefinition:c}),v?.length||h?.length?{info:"some participantIds could not be added",participantIdsNotAdded:v,duplicateEntries:h,...I}:{...I})}({stageSequence:r,suppressDuplicateEntries:e,autoEntryPositions:t,stage:c,ignoreStageSpace:i,drawDefinition:n,participantIds:a,entryStatus:o,roundTarget:s,extension:u});if(d.error)return d}let{flightProfile:m}=op({event:l}),f=m?.flights.find((e=>e.drawId===d));return f?.drawEntries&&(a.forEach((e=>{let t=o===md&&uf({participantId:e,entryStatus:o,flight:f}),r=c===ys&&uf({participantId:e,entryStage:c,flight:f});(o===md||c===ys||!uf({flight:f,participantId:e}))&&!t&&!r&&f.drawEntries.push({participantId:e,entryStatus:o,entryStage:c})})),t&&(f.drawEntries=Lm({entries:f.drawEntries}))),{...I}}function uf({participantId:e,entryStatus:t,entryStage:r,flight:i}){let n=i.drawEntries?.find((i=>!(i.participantId!==e||t&&t!==i.entryStatus||r&&r!==i.entryStage)));return e&&n}function df({autoEntryPositions:e=!0,participantIds:t=[],entryStatuses:r,stage:i,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:de};if(!Array.isArray(t)||t.some((e=>!u(e))))return en({result:{error:dt},stack:a});let o=(n.drawDefinitions??[]).flatMap((e=>_m({drawDefinition:e}).assignedParticipantIds??[])),s=(r?.length&&n.entries?.filter((e=>e.entryStatus&&r.includes(e.entryStatus)))||[]).map(Go).filter((e=>!o.includes(e))),c=(i&&n.entries?.filter((e=>e.entryStage&&e.entryStage===i))||[]).map(Go).filter((e=>!o.includes(e)));if(t.length?t=t.filter((e=>(!r?.length||s.includes(e))&&(!i||c.includes(e)))):s.length&&c.length?t=si(s,c):s.length?t=s:c.length&&(t=c),t?.length&&o.some((e=>t.includes(e))))return en({result:{error:Tt},stack:a});if(!t?.length)return{...I,participantIdsRemoved:[]};let d=[];n.entries=(n.entries??[]).filter((e=>{let r=!t.includes(e?.participantId);return r||d.push(e.participantId),r})),e&&(n.entries=Lm({entries:n.entries}));let{flightProfile:l}=op({event:n});return l?.flights?.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!t.includes(e.participantId)))})),n.drawDefinitions?.forEach((e=>{e.entries=(e.entries??[]).filter((e=>!t.includes(e.participantId)))})),{...I,participantIdsRemoved:d}}var lf={[Aa]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},pf=lf;function mf(e){let{suppressDuplicateEntries:t=!0,entryStatus:r=dd,autoEntryPositions:i=!0,enforceGender:n=!0,entryStageSequence:a,policyDefinitions:o,entryStage:s=Is,tournamentRecord:c,ignoreStageSpace:u,drawDefinition:d,roundTarget:l,extensions:p,extension:m,drawId:f,event:h}=e,g="addEventEntries";if(!Array.isArray(e.participantIds))return en({result:{error:lt},stack:g});let U=Yr(e.participantIds??[]);if(!h)return{error:de};if(!U?.length)return en({result:{error:St},stack:g});if(!h?.eventId)return{error:le};let v=Yu({tournamentRecord:c,event:h}).appliedPolicies??{},y=o?.[Aa]??v?.[Aa]??pf[Aa],S=!1!==(n??y?.participants?.enforceGender),w=[],P=[];if(p&&(!Array.isArray(p)||!p.every((e=>Ha({extension:e}))))||m&&!Ha({extension:m}))return en({context:Zi({extension:m,extensions:p}),result:{error:mr},info:"Invalid extension(s)",stack:g});let D,T=!!c,b=[],R=c?.participants?.filter((e=>{if(!U.includes(e.participantId))return!1;let t=hl(mu)(h.eventType)&&e.participantType===Tu&&!Vm(r),i=h.eventType===hu&&e.participantType===Ru;return!!(t&&(!h.gender||!S||[Wp,qp].includes(h.gender)||h.gender===e.person?.sex)||i&&!Vm(r)||h.eventType===hu&&e.participantType===Tu&&Vm(r))||(t&&h.gender&&S&&![Wp,qp].includes(h.gender)&&h.gender!==e.person?.sex?(b.push({participantId:e.participantId,sex:e.person?.sex}),!1):h.eventType===Mu&&(e.participantType===Mu||Vm(r)&&e.participantType===Tu))})).map((e=>e.participantId))??[],M=U.filter((e=>!T||R.includes(e)));h.entries||(h.entries=[]);let N=h.entries.map((e=>e.participantId||e.participant?.participantId));if(M.forEach((e=>{if(!N.includes(e)){let t=Zi({participantId:e,entryStatus:r,entryStage:s,extensions:p});m&&za({element:t,extension:m}),l&&za({extension:{name:Po,value:l},element:t}),a&&(t.entryStageSequence=a),w.push(t.participantId),h.entries?.push(t)}})),f&&!Vm(s)){let e=cf({participantIds:M,suppressDuplicateEntries:t,autoEntryPositions:i,entryStageSequence:a,ignoreStageSpace:u,drawDefinition:d,entryStatus:r,roundTarget:l,entryStage:s,extension:m,drawId:f,event:h});e.error&&(D=e.error)}if(h.eventType&&[Fl,xl].includes(h.eventType)){let e=(h.entries||[]).map((e=>e.participantId)),t=(h.entries||[]).filter((e=>Vm(e.entryStatus))).map((e=>e.participantId)),r=(c?.participants??[]).filter((t=>e.includes(t.participantId)&&t.participantType&&[Ru,Mu].includes(t.participantType))).map((e=>e.individualParticipantIds)).flat(1/0),i=t.filter((e=>r.includes(e)));i.length&&(P.push(...i),df({participantIds:i,autoEntryPositions:!1,event:h}))}if(M.length!==U.length)return en({context:{mismatchedGender:b,gender:h.gender},result:{error:lt},stack:g});i&&(h.entries=Lm({entries:h.entries||[]}));let A=w.length-P.length;return en({result:{...I,addedEntriesCount:A},stack:g,info:D})}var ff="ADMINISTRATION",hf="COMPETITOR",gf="MEDIA",If="MEDICAL",Uf="OFFICIAL",vf="OTHER",yf="SECURITY",Sf={ADMINISTRATION:ff,CAPTAIN:"CAPTAIN",COACH:"COACH",COMPETITOR:hf,MEDIA:gf,MEDICAL:If,OFFICIAL:Uf,OTHER:vf,SECURITY:yf};function wf({addIndividualParticipantsToEvents:e,individualParticipantIds:t,groupingParticipantId:r,tournamentRecord:i,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!i)return en({result:{error:D},stack:a});if(!r||!t)return en({result:{error:He},stack:a});let o=(i.participants??[]).find((e=>e.participantId===r));if(!o)return en({result:{error:Ut},stack:a});if(![Mu,bu].includes(o.participantType))return en({result:{participantType:o.participantType,error:mt},stack:a});let s=Pf({individualParticipantIds:t,groupingParticipant:o,tournamentRecord:i,suppressErrors:n}),{removed:c,error:u}=s;if(u)return en({result:s,stack:a});if(e)for(let d of i.events??[]){let e=(d.entries??[]).map((({participantId:e})=>e)).filter(Boolean);if(e.includes(r)){let t=c?.filter((t=>!e.includes(t)));mf({participantIds:t,entryStatus:Id,tournamentRecord:i,event:d})}}return c&&ki({topic:Bc,payload:{tournamentId:i.tournamentId,participants:[o]}}),{...I,...s}}function Pf({individualParticipantIds:e=[],groupingParticipant:t,tournamentRecord:r,suppressErrors:i,mappedMatchUps:n,participants:a}){let o=[];if(!t)return{removed:o};let s=[],c=[];a||({participants:a,mappedMatchUps:n}=ef({withMatchUps:!0,tournamentRecord:r,withEvents:!0}));let u=a?.find((({participantId:e})=>e===t.participantId))?.events?.map((({eventId:e})=>e)),d=(t.individualParticipantIds??[]).filter((i=>{let d=e?.includes(i),l=d&&a?.find((e=>e.participantId===i))?.matchUps.filter((({eventId:e})=>u.includes(e))).map((({matchUpId:e})=>n?.[e])).filter((({winningSide:e,score:t})=>e||Um({score:t}))),p=d&&!l?.length;if(d&&!p&&c.push(i),p){o.push(i);for(let e of r.events??[])for(let n of e.drawDefinitions??[]){let{extension:e}=no({element:n,name:Io}),a=e?.value[t.participantId];e&&a&&(e.value[t.participantId]=a.filter((e=>e.participantId!==i)),za({element:n,extension:e}),nu({drawDefinition:n}));let o=lm({drawDefinition:n,inContext:!1}).matchUps??[];for(let t of o){let e=t.sides??[];for(let a of e){let e=a.lineUp??[];e.find((e=>e.participantId===i))&&(a.lineUp=e.filter((e=>e.participantId!==i)),iu({tournamentId:r?.tournamentId,drawDefinition:n,matchUp:t}))}}}}else s.push(i);return!p}));t.individualParticipantIds=d;let l={groupingParticipantId:t.participantId,cannotRemove:c,notRemoved:s,removed:o};return c.length&&!i&&{...l,cannotRemove:c,error:st}||l}function Df({participantRole:e=hf,individualParticipantIds:t=[],groupingTypes:r=[Du,bu],tournamentRecord:i}){if(!i)return{error:D};let n=i.participants??[],{participants:a,mappedMatchUps:o}=ef({withMatchUps:!0,tournamentRecord:i,withEvents:!0}),s=0;return n.filter((t=>(t.participantRole===e||!t.participantRole)&&t.participantType&&r.includes(t.participantType))).forEach((e=>{let{removed:r}=Pf({groupingParticipant:e,individualParticipantIds:t,tournamentRecord:i,mappedMatchUps:o,participants:a});r&&s++})),s?I:{error:yt}}function Tf(e){if(!e?.tournamentRecord)return{error:D};if(!e?.participantIds?.length)return{error:St};let{addIndividualParticipantsToEvents:t,tournamentRecord:r,participantIds:i}=e,n=r.participants?.length||0;if(!n)return{...I};let a=(r.events||[])?.filter((({eventType:e})=>e===kl)).map((e=>e?.drawDefinitions?.map((({drawId:e})=>e)))).flat(1/0),o=ef({participantFilters:{participantIds:i},tournamentRecord:r,withDraws:!0}).participants??[],s=a?.length&&si((cm({matchUpFilters:{drawIds:a,matchUpTypes:[hu]},tournamentRecord:r}).matchUps??[]).map((({sides:e})=>e?.map((({participantId:e})=>e)))).flat().filter(Boolean),i),c=o.filter((e=>e.draws?.filter((e=>(!a?.length||!a?.includes(e.drawId))&&e.positionAssignments)).length));if(s?.length||c.length)return{error:Tt};let u={},d={};for(let p of r.events||[]){let e=df({participantIds:i,event:p});if(e.error)return e;u[p.eventId]=e.participantIdsRemoved}r.participants=r.participants.filter((e=>{let r=i.includes(e.participantId)||e.participantType===Ru&&e.individualParticipantIds.some((e=>i.includes(e)));if(!r&&e.participantType===kl&&e.individualParticipantIds.some((e=>i.includes(e)))&&(e.individualParticipantIds=e.individualParticipantIds.filter((e=>!i.includes(e)))),r&&t&&[Ru,Mu].includes(e.participantType))for(let t of e.individualParticipantIds||[])i.includes(t)||(d[e.participantId]||(d[e.participantId]=[]),d[e.participantId].push(t));return!r}));let l=n-r.participants.length;if(Df({individualParticipantIds:i,tournamentRecord:r}),t)for(let p of r.events||[]){mf({participantIds:u[p.eventId].map((e=>d[e]||[])).flat(),entryStatus:Id,tournamentRecord:r,event:p})}return l&&ki({payload:{participantIds:i,tournamentId:r.tournamentId},topic:Cc}),l?{...I,participantsRemovedCount:l}:{error:st}}function bf({selected:e=!0,drawDefinition:t,entryStatuses:r,drawId:i,event:n,stage:a}){let o=n.entries??[];if(i){let{flightProfile:e}=op({event:n}),r=e?.flights?.find((e=>e.drawId===i));r?o=r.drawEntries:t.entries&&(o=t?.entries)}let s=o.filter((t=>(!r?.length||!t.entryStatus||r.includes(t.entryStatus))&&(!a||!t.entryStage||t.entryStage===a)&&(!e||t.entryStatus&&Dd.includes(t.entryStatus))));return{entries:o,stageEntries:s}}function Rf({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:r,participantId:i,drawId:n,stage:a,event:o}){let s="destroyGroupEntry";if(!t)return{error:D};if(!i)return en({result:{error:It},stack:s});if(!o)return{error:de};if(!o.eventType||![Fl,xl].includes(o.eventType))return en({result:{error:ue},stack:s});let c=t.participants??[],u=c.find((e=>e.participantId===i));if(!u)return en({result:{error:Ut},stack:s});if(!u.participantType||![Ru,Du].includes(u.participantType)||u.participantType===Du&&o.eventType!==xl||u.participantType===Ru&&o.eventType!==Fl)return{error:mt};let d=(o.entries??[]).find((e=>e.participantId===i));if(!d)return{error:Nt};let l,{stageEntries:p}=bf({selected:!1,drawDefinition:r,drawId:n,event:o,stage:a}),m=p.map(Go),f=c.filter((({participantId:e})=>m.includes(e))).map((({individualParticipantIds:e})=>e)).flat().filter(Boolean),h=u.individualParticipantIds?.filter((e=>1===oi(e,f).length)),g=df({participantIds:[i],event:o});return g.error||h?.length&&(g=mf({participantIds:h,entryStatus:Id,entryStage:d.entryStage,tournamentRecord:t,drawDefinition:r,drawId:n,event:o}),g.error)?g:(e&&Tf({participantIds:[i],tournamentRecord:t}).success&&(l=!0),{...I,participantRemoved:l})}function Mf({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:r,participantId:i,drawId:n,event:a}){return Rf({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:r,participantId:i,drawId:n,event:a})}function Nf(e){if(!e.tournamentRecord)return{error:D};let{participantIds:t,...r}=e,i=0,n=[];for(let a of t){let e=Rf({participantId:a,...r});e.success&&(i+=1),e.error&&n.push(e.error)}return i?{destroyedCount:i,...I}:{error:n}}function Af(e){let{tournamentRecord:t,replaceWithBye:r,drawDefinition:i,destroyPair:n,entryStatus:a,matchUpsMap:o,drawId:s}=e,c="removeDrawPositionAssignment",u=Fm(e);if(u.error)return en({result:u,stack:c});let{participantId:d}=u,{drawPosition:l,event:p,structureId:m}=e,f=Yu({tournamentRecord:t,drawDefinition:i,event:p}).appliedPolicies??{};if([cd,yd].includes(a)&&d){let{tournamentRecord:t}=e,{participant:r}=Fu({tournamentRecord:t,participantId:d}),{participantType:o,individualParticipantIds:u}=r??{};if(n&&o===Ru){let e=Mf({tournamentRecord:t,drawDefinition:i,participantId:d,event:p});if(e.error)return en({result:e,stack:c});u&&Bm({participantIds:u,tournamentRecord:t,drawDefinition:i,entryStatus:a,drawId:s,event:p})}else Bm({participantIds:[d],tournamentRecord:t,drawDefinition:i,entryStatus:a,drawId:s,event:p})}if(r){let e=Mm({tournamentRecord:t,drawDefinition:i,drawPosition:l,structureId:m,matchUpsMap:o,event:p});if(e.error)return en({result:e,stack:c})}let{structure:h}=yc({drawDefinition:i,structureId:m});return uu({structure:h,drawPositions:[l]}),du({appliedPolicies:f,drawDefinition:i,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:r,drawPosition:l,entryStatus:a,structureId:m}}),u}function Ef(e){return Object.assign(e,{entryStatus:yd}),Af(e)}function Cf(e){return u(e)?e.split(" ").map((e=>e.split("").map(((e,t)=>t?e.toLowerCase():e.toUpperCase())).join(""))).join(" "):e}function Of(e){return u(e)?Cf(e.replace(/_/g," ")):""}var Ff=({finishingPosition:e=fc,qualifyingRoundNumber:t,structureAbbreviation:r,seedAssignments:i=[],stageSequence:n=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:c,structureName:u,matchUpType:d,matchUps:l=[],structureId:p,roundOffset:m,roundLimit:f,stageOrder:h,structures:g,stage:I})=>{let U={structureId:p??Jl(),structureAbbreviation:r,finishingPosition:e,seedAssignments:i,matchUpFormat:s,stageSequence:n,structureName:u};a&&(U.structureOrder=a),c&&(U.structureType=c),o&&("string"==typeof o?U.seedingProfile=o:"object"==typeof o&&"string"==typeof o.positioning&&(U.seedingProfile=o.positioning)),d&&(U.matchUpType=d),m&&(U.roundOffset=m),h&&(U.stageOrder=h),f&&(U.roundLimit=f),I&&(U.stage=I),t&&(U.qualifyingRoundNumber=t);let v=l.flatMap((({drawPositions:e})=>e)).filter(Boolean);return g?U.structures=g:(U.matchUps=l,U.positionAssignments=Yr(v).sort(((e,t)=>e-t)).map((e=>({drawPosition:e})))),U},kf=Ff;function xf({structureName:e=Of(ys),structureAbbreviation:t,drawDefinition:r,matchUpType:i,structureId:n}){if(!r)return{error:M};let a=kf({stage:ys,structureAbbreviation:t,structureName:e,matchUps:[],structureId:n,matchUpType:i});return r.structures||(r.structures=[]),r.structures.push(a),au({drawDefinition:r,structureIds:[a.structureId]}),{...I}}function _f({drawPositions:e}){if(!e?.length)return{error:L};let t=[].concat(...(e??[]).map((t=>e.filter((e=>e!==t)).map((e=>[t,e]))))),r=Yr(t.map(Lf)).map((e=>e.split("|").map((e=>+e))));return{groupMatchUps:t,uniqueMatchUpGroupings:r}}function Lf(e=[]){return Array.isArray(e)&&e.length?[...e].sort(kr).join("|"):""}function Vf({groupSize:e,drawPositionOffset:t}){if(!e)return[];let r=e=>[...Array(e)].map(((e,t)=>t)),i=r(2*Math.round(e/2)+1).slice(1),n=r(i.length-1).map((()=>[])),a=i.slice(0,i.length/2),o=i.slice(i.length/2);i.slice(1).forEach(((e,t)=>{a.forEach(((e,r)=>{n[t].push([a[r],o[r]])}));let r=a.shift(),i=a.pop(),s=o.shift();a=[r,s,...a].filter(Boolean),o=[...o,i].filter(Boolean)}));let s=a.shift(),c=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,c].filter(Boolean);let d=e=>e[0].reduce(((e,t)=>e+t));return[...n].reverse().sort(((e,t)=>d(e)-d(t))).map((r=>r.filter((t=>t.every((t=>t<=e)))).map((e=>Lf(e.map((e=>e+t)))))))}var Bf={getRoundRobinGroupMatchUps:_f,determineRoundNumber:function({rounds:e,hash:t}){return e?.length?e?.reduce(((e,r,i)=>r.includes(t)?i+1:e),void 0):{error:He}},drawPositionsHash:Lf,groupRounds:Vf};function jf(e){let t,{groupNameBase:r="Group",playoffAttributes:i,stageSequence:n=1,structureOptions:a,appliedPolicies:o,seedingProfile:s,stage:c=Is,matchUpType:u,roundTarget:d,structureId:l,groupNames:p,drawSize:m,idPrefix:f,isMock:h,uuids:g}=e,U=e.structureName??i?.[0]?.name??Of(Is),{groupCount:v,groupSize:y}=function({appliedPolicies:e,structureOptions:t,drawSize:r}){let i=t?.groupSize,n=t?.groupSizeLimit||8,{validGroupSizes:a}=Gf({groupSizeLimit:n,drawSize:r}),o=a&&Math.max(...a);i&&a?.includes(i)||(i=i&&i>4||!a?.includes(4)?o:4);let s=Math.ceil(r/i);return{groupSize:i,groupCount:s}}({structureOptions:a,appliedPolicies:o,drawSize:m}),S=mc,w=ai(1,v+1).map((e=>{let i=function({structureOrder:e,matchUpType:t,groupSize:r,drawSize:i,idPrefix:n,isMock:a,uuids:o}){let s=(e-1)*r,c=ai(1+s,r+1+s),u=_f({drawPositions:c}).uniqueMatchUpGroupings??[],d=Vf({groupSize:r,drawPositionOffset:s});return u.map(p).sort(((e,t)=>(e.roundNumber??1/0)-(t.roundNumber??1/0)));function l(e){return d.reduce(((t,r,i)=>r.includes(e)?i+1:t),void 0)}function p(r){let s=l(Lf(r)),c=[1,i],u=function({structureOrder:e,drawPositions:t,roundNumber:r,idPrefix:i,uuids:n}){return i?`${i}-${e}-${r}-DP-${t.join("-")}`:n?.pop()||Jl()}({structureOrder:e,drawPositions:r,roundNumber:s,idPrefix:n,uuids:o}),d={matchUpStatus:s?os:Yo,matchUpType:t,finishingPositionRange:{winner:c,loser:c},drawPositions:r,roundNumber:s,matchUpId:u};return a&&(d.isMock=!0),d}}({groupSize:y,structureOrder:e,matchUpType:u,drawSize:m,idPrefix:f,isMock:h});t=Array.isArray(i)?Math.max(...i.map((({roundNumber:e})=>e??0))):0;let n=p?.[e-1]??`${r} ${e}`;return Ff({structureId:g?.pop(),structureType:As,finishingPosition:S,structureOrder:e,structureName:n,matchUps:i})})),P=Ff({structureId:l??g?.pop(),structureType:Es,finishingPosition:S,seedingProfile:s,structureName:U,stageSequence:n,structures:w,stage:c});return d&&za({extension:{name:Po,value:d},element:P}),{structures:[P],maxRoundNumber:t,groupCount:v,links:[],groupSize:y,...I}}function Gf({drawSize:e,groupSizeLimit:t=10}){let r=ai(3,t+1).filter((t=>{let r=Math.ceil(e/t),i=r*t-e,n=Math.ceil(e/r),a=Math.ceil(i/r);return(!i||i<t)&&n===t&&n>=3&&a<2}));return{...I,validGroupSizes:r}}function qf(e){let{roundRobinGroupsCount:t,participantsCount:r,cluster:i}=e;if(!Wr(r))return{seedBlocks:void 0,...en({result:{error:mr},context:{participantsCount:r},stack:"getSeedBlocks"})};let n=qr(r);if(t){let e=Math.min(t,n),r=[],i=1;for(ai(0,e).forEach((()=>{r.push([i]),i++}));i<n;){let t=ai(i,i+e);i+=e,r.push(t)}return{...I,seedBlocks:r}}let a=ai(1,n+1),o=[],s=n/2;for(;s>1;){let e=pi(a,s),t=e.length;e.forEach(((e,r)=>{let n,a=r<t/2,s=r%2==0,c=e[0],u=e[e.length-1];n=i&&t>4?8===t?a?u:c:s?c:u:a?c:u,ui(e,o)||o.push(n)})),s/=2}let c=a.filter((e=>!o.includes(e)));for(;c.length;)c.length%2==0?o.push(c.pop()):o.push(c.shift());let u=ai(0,20).map((e=>Math.pow(2,e)));u.unshift(1);let d=u.indexOf(n),l=0,p=[];return ai(0,d).forEach((e=>{p.push(o.slice(l,l+u[e])),l+=u[e]})),{...I,seedBlocks:p}}function $f({roundRobinGroupsCount:e,drawSize:t}){let r="getSeedGroups";if(!Wr(t))return{seedGroups:void 0,...en({result:{error:mr},context:{drawSize:t},stack:r})};if(e){if(!Wr(e))return{seedGroups:void 0,...en({context:{roundRobinGroupsCount:e},result:{error:mr},stack:r})};let i=1;return{seedGroups:ai(0,Math.floor(t/e)).map((()=>{let t=ai(i,i+e);return i+=e,t}))}}{let{seedBlocks:r}=qf({participantsCount:t,roundRobinGroupsCount:e}),i=0;return{seedGroups:(r||[]).map((e=>(e||[]).map((()=>(i+=1,i)))))}}}function Wf({roundRobinGroupsCount:e,participantsCount:t}){if(e){let{validGroupSizes:r}=Gf({drawSize:t});if(!r?.map((e=>Math.ceil(t/e)))?.includes(e))return en({context:{roundRobinGroupsCount:e},result:{error:mr}})}let{seedGroups:r}=$f({drawSize:t,roundRobinGroupsCount:e}),i=r?.map((e=>Math.min(...e)))||[];return{...I,seedingThresholds:i}}function Hf(e){if(!e)return 1/0;if(Wr(e))return xr(e);let t=e.split("-")[0];return Wr(t)?xr(t):1/0}function zf({positioning:e,size:t}){let r=function({size:e}){let t=[e],r=e;for(;r/2===Math.floor(r/2);)r/=2,t.push(r);return t.includes(1)||t.push(1),t.sort(kr),t.reverse(),t}({size:t}),i=[],n=[],a=e=>e[0],o=(t,r)=>(e&&[Ms,Ns].includes(e)&&r%2?(e=>e[e.length-1])(t):a(t))||a(t),s=(e,t)=>{if(e.every((e=>!n.includes(e)))){let r=o(e,t);return n.push(r),r}},c=e=>{let t=e.filter((e=>!n.includes(e)));if(t.length)return n.push(...t),t},u=(e,t)=>{let r=o(e,t);if(!n.includes(r))return n.push(r),r},d=ai(1,t+1);for(let l of r)if(1===l){let e=pi(d,2),t=e.map(s).filter(Boolean);t.length&&i.push(t);let r=e.flatMap(c).filter(Boolean);r.length&&i.push(r)}else{let e=pi(d,l).map(u).filter(Boolean);e.length&&i.push(e)}return{divisions:r,divisionGroupings:i}}function Yf({provisionalPositioning:e,returnAllProxies:t,appliedPolicies:r,seedingProfile:i,drawDefinition:n,allPositions:a,structure:o}){let s=[];if(!o)return{error:se};let{matchUps:c,roundMatchUps:u}=Kp({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:e,structure:o}),{seedAssignments:d}=Ad({provisionalPositioning:e,returnAllProxies:t,drawDefinition:n,structure:o}),{positionAssignments:l}=Dc({structure:o}),p=l?.length,m=d?.length??0,f=[],h=Object.keys(u).map((e=>parseInt(e))).sort(((e,t)=>e-t)).map((e=>{let t=u[e].map((e=>e.drawPositions)).flat(1/0).filter(Boolean),r=t.filter((e=>!f.includes(e)));return f=f.concat(...t),r})).filter((e=>e.length)).reverse(),g=h.pop()??[],I=g&&Math.min(...g)-1||0;i=i??r?.seeding?.seedingProfile;let U=g?.length||0,v=h.filter((e=>e.filter((e=>e<=m)).length)),{stage:y,structureType:S,roundLimit:w}=o,P=S===Es,D=!P&&h?.length,T=!P&&y===Us&&w,b=v.flat(1/0),R=D?b?.length:0,M=a?p:m,N=Dp({drawDefinition:n,structure:o,matchUps:c}),A=N?0:!D&&M||M&&b.length<M&&M-b.length||0;if(T){let e=o?.matchUps?o.matchUps.filter((({roundNumber:e})=>e===o.roundLimit)).length:0,t=g.length/e;if(!D){let e=Xf(i),r=pi(g,t),n=1,a=ai(0,r[0].length).map((()=>{let e=ai(n,n+r.length);return n+=r.length,e}));({validSeedBlocks:s}=Kf({drawPositionBlocks:r,nonRandom:i?.nonRandom,positioning:e,seedGroups:a}))}}else P?({validSeedBlocks:s}=function({seedingProfile:e,structure:t,nonRandom:r}){let i=t.structures||[],n=i.length,a=Pc({structure:t})?.positionAssignments,o=Xf(e),s=a?.length??0,{seedGroups:c}=$f({roundRobinGroupsCount:n,drawSize:s}),u=i.map((e=>Pc({structure:e}).positionAssignments?.map((e=>e.drawPosition))));return Kf({drawPositionBlocks:u,positioning:o,seedGroups:c,nonRandom:r})}({nonRandom:i?.nonRandom,seedingProfile:i,structure:o})):D?s=v.map((e=>({seedNumbers:e,drawPositions:e}))):N&&pi(g,2).map(((e,t)=>({drawPositions:[e[0]],seedNumbers:[t+1]}))).forEach((e=>s.push(e)));if(!P&&!N&&!T){let{blocks:e}=function(e){let{drawPositionOffset:t=0,roundRobinGroupsCount:r,seedNumberOffset:i=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:o}=e,s=1,c=[],{seedBlocks:u}=qf({cluster:Xf(n)===Ms,participantsCount:o,roundRobinGroupsCount:r});s=0;for(let l of u){if(s+1>a)break;let e=l.map((e=>e+t)),r=d(s+1,l.length).map((e=>+e+i));s+=l.length,c.push({drawPositions:e,seedNumbers:r})}return{blocks:c};function d(e,t){return Array.from(new Array(t),((t,r)=>r+e))}}({drawPositionOffset:I,seedNumberOffset:R,seedCountGoal:A,seedingProfile:i,baseDrawSize:U});e.forEach((e=>s.push(e)))}let E=s.flatMap((e=>e.drawPositions)).reduce(((e,t)=>g?.includes(t)&&e),!0);return N||D||P||E?{isLuckyStructure:N,validSeedBlocks:s,isContainer:P,isFeedIn:D}:{error:te,validSeedBlocks:[],isContainer:P,isFeedIn:D}}function Kf({drawPositionBlocks:e,positioning:t,seedGroups:r,nonRandom:i}){let n=[],{divisionGroupings:a}=zf({size:r.length,positioning:t}),o=[];return r.forEach(((r,s)=>{let c=function({blockPattern:e,index:t}){let r=0;for(let i of e){if(r===t)return i;let e=0;for(;e<i.length;){if(r===t)return i;r+=1,e++}}}({blockPattern:a,index:s});r.forEach(((r,a)=>{let u=s%2?e.length-a-1:a,d=e[u].slice().filter(((e,t)=>c.includes(t+1)&&e));t!==Ns?d=i?d:Qr(d):s%2&&d.reverse();let l=d.find((e=>!o.includes(e)));l&&(o.push(l),n.push({drawPositions:[l],seedNumbers:[r]}))}))})),{validSeedBlocks:n}}function Qf({appliedPolicies:e,drawDefinition:t,seedBlockInfo:r,drawPosition:i,structureId:n,seedNumber:a}){let{structure:o}=yc({drawDefinition:t,structureId:n});e||(e=Yu({drawDefinition:t}).appliedPolicies);let s=r?.validSeedBlocks;return!s&&o&&(s=Yf({appliedPolicies:e,drawDefinition:t,structure:o})?.validSeedBlocks),!!e?.seeding?.validSeedPositions?.ignore||(e?.seeding?.validSeedPositions?.strict?(s.find((e=>e.seedNumbers.includes(a)))?.drawPositions||[]).includes(i):[].concat(...s.map((e=>e.drawPositions))).includes(i))}function Jf(e){let{provisionalPositioning:t,drawDefinition:r,seedingProfile:i,seedBlockInfo:n,structureId:a,randomize:o}=e,{structure:s}=yc({drawDefinition:r,structureId:a}),{seedAssignments:c}=Ad({returnAllProxies:e.returnAllProxies,provisionalPositioning:t,drawDefinition:r,structure:s}),{positionAssignments:u}=Dc({structure:s}),d=u?.filter((e=>e.participantId??e.bye??e.qualifier))?.map((e=>e.drawPosition)).filter(Boolean),{appliedPolicies:l}=Yu({drawDefinition:r}),p=(n?.validSeedBlocks||s&&Yf({returnAllProxies:e.returnAllProxies,provisionalPositioning:t,appliedPolicies:l,drawDefinition:r,seedingProfile:i,structure:s})?.validSeedBlocks||[]).filter((e=>e.drawPositions.filter((e=>!d?.includes(e))).length))[0],m=c?.map((e=>e.participantId)).filter(Boolean),f=u?.map((e=>e.participantId)).filter(Boolean),h=m?.filter((e=>f?.includes(e))),g=m?.filter((e=>!f?.includes(e))),I=c?.filter((e=>g?.includes(e.participantId))),U=c?.filter((e=>!e.participantId)),v=(I?.length&&I.length>0?I.length:U?.length??0)&&p?.drawPositions.filter((e=>!d?.includes(e)))||[],y=o?Qr(v):v,S=[],w=y.map((()=>{let e=function(e,t){let r=e.filter((e=>!t.includes(e.participantId))),i=Math.min(...r.map((e=>Hf(e.seedValue))));return Qr(r.filter((e=>Hf(e.seedValue)===i))).pop()}(I,S)?.participantId;return e&&S.push(e),e})).filter(Boolean),P=c?.filter((e=>h?.includes(e.participantId))).map((e=>e.seedNumber)),D=(p?.seedNumbers||[]).filter((e=>!P?.includes(e))),T=c?.filter((e=>D.includes(e.seedNumber))).map((e=>e.participantId)),b=l?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:void 0===b||b?w:T,unplacedSeedNumbers:D,unfilledPositions:y,unplacedSeedAssignments:I}}function Xf(e){return"string"==typeof e?e:"object"==typeof e?e.positioning:void 0}function Zf({provisionalPositioning:e,tournamentRecord:t,drawDefinition:r,seedingProfile:i,participantId:n,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:c,eventId:u,event:d}){let l="assignSeed",{structure:p}=yc({drawDefinition:r,structureId:o}),{positionAssignments:m}=Dc({structure:p}),f=Ad({provisionalPositioning:e,drawDefinition:r,structure:p}).seedAssignments,h=f.map((e=>e.seedNumber)),g=tf({drawDefinition:r,participantId:n});if(n&&!g)return en({result:{error:dt},context:{participantId:n},stack:l});let U,v=d?op({event:d}).flightProfile?.flights?.length:0,y=v&&v>1,S=m?.find((e=>e.participantId===n))?.drawPosition;return S&&!Qf({drawPosition:S,drawDefinition:r,seedBlockInfo:a,structureId:o,seedNumber:s})?en({result:{error:O},context:{assignedDrawPosition:S},info:"invalid seed position",stack:l}):(h.includes(s)||f.push({seedNumber:s,seedValue:c}),f.forEach((e=>{e.participantId===n&&e.seedNumber!==s&&(e.participantId=void 0),e.seedNumber===s&&(e.participantId=n,!i?.groupSeedingThreshold&&!y&&(e.seedValue=c??s),U=!0)})),U?(ou({tournamentId:t?.tournamentId,drawDefinition:r,structure:p,eventId:u}),{...I}):en({result:{error:ee},stack:l}))}function eh({inContextTargetMatchUp:e,drawPositionSideIndex:t,teamParticipantId:r,tournamentRecord:i,drawDefinition:n,matchUp:a,event:o}){let s=e?.sides?.[t]?.sideNumber,c=s&&a.sides?.find((e=>e.sideNumber===s)),{extension:u}=no({element:n,name:Io}),d=Da((u?.value||{})[r],!1,!0);if(c)a?.sides?.forEach((e=>{e.sideNumber===s&&(e.lineUp=d)}));else{a.sides=[1,2].map((e=>({...a.sides?.find((t=>t.sideNumber===e))??{},sideNumber:e})));let e=a.sides.find((e=>e.sideNumber===s));e&&(e.lineUp=d)}iu({tournamentId:i?.tournamentId,context:"updateSidLineUp",eventId:o?.eventId,drawDefinition:n,matchUp:a})}function th(e){let{sourceMatchUp:t}=e,{targetMatchUp:r,structure:i,matchUpsMap:n,drawPosition:a}=e,o=r.roundNumber>1&&r.roundNumber-1,s=fp({structureId:i.structureId,matchUpsMap:n});!t&&a&&(t=s.find((({drawPositions:e,roundNumber:t})=>t===o&&e?.includes(a))));let c=t?.roundPosition,u=c+(c%2?1:-1),d=o&&s.find((({roundNumber:e,roundPosition:t})=>e===o&&t===u)),l=d?.matchUpStatus;return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:[es,Zo].includes(l)}}function rh({structureId:e,matchUpsMap:t,matchUp:r}){let i=r?.roundPosition,n=i+(i%2?1:-1);return{pairedPreviousMatchUp:fp({matchUpsMap:t,structureId:e}).find((({roundNumber:e,roundPosition:t})=>e===r?.roundNumber&&t===n))}}function ih({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:r,matchUpsMap:i,matchUp:n}){let a=e.find((e=>e.matchUpId===r)),{pairedPreviousMatchUp:o}=rh({structureId:a?.structureId,matchUp:a,matchUpsMap:i});if(a&&o){let r=o?.matchUpId,i=e.find((e=>e.matchUpId===r)),s=a?.structureId===i?.structureId?a?.roundPosition<i?.roundPosition?1:2:a.structureId===i?.structureId?2:1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map((e=>{let r=u(e)||!isNaN(e)?{code:e}:e;return r.sideNumber===s?{...r,previousMatchUpStatus:t}:r}))}}function nh({inContextDrawMatchUps:e,drawPosition:t,matchUpId:r}){let i=e.filter((({winnerMatchUpId:e,loserMatchUpId:t})=>t===r||e===r)).sort(((e,t)=>e.roundPosition-t.roundPosition));return e.find((e=>e.matchUpId===r)).feedRound?1:i.reduce(((e,r,i)=>r.drawPositions?.includes(t)?i+1:e),void 0)}function ah({inContextDrawMatchUps:e,sourceMatchUpStatus:t,tournamentRecord:r,sourceMatchUpId:i,drawDefinition:n,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:c,event:u}){let d="assignMatchUpDrawPosition";s||(s=mp({drawDefinition:n})),e||(e=am({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[]);let l=e.find((e=>e.matchUpId===c)),p=l?.structureId,m=n?.structures?.find((e=>e.structureId===p));if(!m)return{error:ae};let f=s?.drawMatchUps?.find((e=>e.matchUpId===c)),h=f?.drawPositions??[],{positionAdded:g,positionAssigned:U,updatedDrawPositions:v}=function({drawPosition:e,drawPositions:t}){let r=!1,i=!!t?.includes(e);return{updatedDrawPositions:i?t||[]:[...t,void 0,void 0].slice(0,2).map((t=>t||i?t:(i=!0,r=!0,e))).sort(kr).filter(Boolean),positionAdded:r,positionAssigned:i}}({drawPosition:o,drawPositions:h}),{positionAssignments:y}=Pc({drawDefinition:n,structure:m}),S=y?.filter((e=>v.includes(e.drawPosition)))?.find((({bye:e})=>e)),w=f?.matchUpStatus&&[ss,Xo].includes(f.matchUpStatus)&&v.filter(Boolean).length<2;if(a=S&&Yo||a||w&&f.matchUpStatus||f?.matchUpStatus&&[es,Zo].includes(f.matchUpStatus)&&f.matchUpStatus||os,f&&g){e=am({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[];let u=w&&nh({inContextDrawMatchUps:e,drawPosition:o,matchUpId:c})||void 0;f?.matchUpStatusCodes&&ih({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:i,matchUpsMap:s,matchUp:f}),Object.assign(f,{drawPositions:v,winningSide:u,matchUpStatus:a}),iu({tournamentId:r?.tournamentId,eventId:l?.eventId,context:d,drawDefinition:n,matchUp:f})}let P=tm({inContextDrawMatchUps:e,inContextMatchUp:l,drawDefinition:n,matchUpId:c}),{targetMatchUps:{winnerMatchUp:D,loserMatchUp:T,loserTargetDrawPosition:b},targetLinks:{loserTargetLink:R}}=P,M=fp({structureId:m.structureId,matchUpsMap:s});if(U&&S){if(D)if([Yo,es,Zo].includes(a)){let t=ah({matchUpId:D.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(t.error)return t}else{let{structureId:e}=D;e!==m.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(D&&l&&!l.feedRound){let{pairedPreviousMatchUpIsDoubleExit:t}=th({targetMatchUp:f,drawPosition:o,matchUpsMap:s,structure:m});if(t){let t=ah({matchUpId:D.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(t.error)return t}}if(f?.matchUpType===Iu){let t=e?.find((({matchUpId:e})=>e===f.matchUpId)),i=(t?.sides??[]).reduce(((e,t,r)=>t.drawPosition===o?r:e),void 0),a=y?.find((e=>e.drawPosition===o))?.participantId;a&&void 0!==i&&eh({inContextTargetMatchUp:t,drawPositionSideIndex:i,teamParticipantId:a,tournamentRecord:r,drawDefinition:n,matchUp:f})}if(R?.linkCondition===Vs&&2===v.filter(Boolean).length&&!S&&M.filter((({drawPositions:e,roundNumber:t})=>1===t&&ui(e,v))).every((({matchUpStatus:e})=>[Qo,ns].includes(e)))&&T){let{structureId:e}=T,t=Mm({drawPosition:b,tournamentRecord:r,drawDefinition:n,structureId:e,matchUpsMap:s,event:u});if(t.error)return t}return U?{...I}:en({result:{error:F},context:{drawPosition:o},stack:d})}function oh({inContextDrawMatchUps:e,drawDefinition:t,assignments:r,matchUpsMap:i,structure:n}){let a=lu({drawDefinition:t})?.containedStructures?.[n.structureId]?.map((({structureId:e})=>e))||[];a.push(n?.structureId);let o=r?.map((({drawPosition:e})=>e))||[],s=e?.filter((e=>a.includes(e.structureId)&&si(e.drawPositions??[],o).length))??[],c=s.map((({matchUpId:e})=>e)),u=i?.drawMatchUps?.filter((e=>c.includes(e.matchUpId)))??[];return{drawPositions:o,matchUps:u,targetMatchUps:s}}function sh({lineUp:e}){if(!Array.isArray(e))return;let t={};return Yr(e.flatMap((({collectionAssignments:e})=>e?.map((({collectionId:e,collectionPosition:t})=>[e,t].join("|"))))).filter(Boolean)).forEach((r=>{let[i,n]=r.split("|"),a=parseInt(n),{assignedParticipantIds:o}=yp({collectionPosition:a,collectionId:i,lineUp:e});o.forEach((e=>{t[e]||(t[e]=[]),t[e].push({collectionId:i,collectionPosition:a})}))})),Object.keys(t).map((e=>({participantId:e,collectionAssignments:t[e]})))}function ch(e){return`${e} must be an array`}function uh({lineUp:e,tieFormat:t}){let r=[];if(!Array.isArray(e))return r.push(ch("lineUp")),{valid:!1,errors:r,error:mr};let i=e.every((e=>{if("object"!=typeof e)return r.push("lineUp entries must be objects"),!1;let{participantId:t,collectionAssignments:i}=e;return t?"string"!=typeof t?(r.push("participantIds must be strings"),!1):Array.isArray(i)?i.every((e=>{if("object"!=typeof e)return r.push("collectionAssignments must be objects"),!1;let{collectionPosition:t}=e;return"number"==typeof t||(r.push("collectionPosition must be a number"),!1)})):(r.push(ch("collectionAssignments")),!1):(r.push("Missing participantId"),!1)})),n=Yr(e.map(Go)).length===e.length;return n||r.push("Duplicated participantId(s)"),{valid:i&&n,errors:r,error:r.length?mr:void 0}}function dh({drawDefinition:e,participantId:t,tieFormat:r,lineUp:i}){if("object"!=typeof e)return{error:M};if("string"!=typeof t)return{error:It};let n=uh({lineUp:i,tieFormat:r});if(!n.valid)return n;let{extension:a}=no({element:e,name:Io}),o=a?.value||{};return o[t]=sh({lineUp:i}),za({element:e,extension:{name:Io,value:o}}),nu({drawDefinition:e}),{...I}}function lh({inContextDrawMatchUps:e,inheritance:t=!0,tournamentRecord:r,drawDefinition:i,matchUpsMap:n,assignments:a,structure:o,event:s}){if(!i)return{error:M};let{drawPositions:c,matchUps:u,targetMatchUps:d}=oh({inContextDrawMatchUps:e,matchUpsMap:n,assignments:a,structure:o});for(let l of d)l.matchUpType===gu&&(l.sides??[]).forEach(((e,n)=>{if(e?.drawPosition&&c?.includes(e.drawPosition)){let a=u.find((({matchUpId:e})=>e===l.matchUpId));if(a?.sides?.[n]){if(delete a.sides[n].lineUp,!1===t){let t=l.tieFormat,r=e.participantId;t&&r&&dh({drawDefinition:i,participantId:r,lineUp:[],tieFormat:t})}iu({tournamentId:r?.tournamentId,context:"resetLineUps",eventId:s?.eventId,drawDefinition:i,matchUp:a})}}}));return{...I}}function ph({provisionalPositioning:e,inContextDrawMatchUps:t,isQualifierPosition:r,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:c,drawPosition:u,matchUpsMap:d,structureId:l,event:p}){let m="assignDrawPosition";if(!s&&!r)return en({result:{error:It},stack:m});d=d??mp({drawDefinition:a}),t||({matchUps:t}=am({inContext:!0,drawDefinition:a,matchUpsMap:d}));let f=yc({drawDefinition:a,structureId:l});if(f.error)return en({result:f,stack:m});let{structure:h}=f;if(!h)return{error:ae};if(Tp({structure:h}))return en({result:{error:ke},stack:m});let{seedAssignments:g}=Ad({provisionalPositioning:e,drawDefinition:a,structure:h}),U=g?.find((e=>e.participantId===s))?.seedNumber,{appliedPolicies:v}=Yu({tournamentRecord:n,drawDefinition:a,structure:h,event:p});if(U&&!Qf({seedNumber:U,appliedPolicies:v,drawDefinition:a,seedBlockInfo:c,drawPosition:u,structureId:l}))return en({result:{error:O},context:{drawPosition:u},stack:m});let y=Dc({structure:h}).positionAssignments||[],S=y?.find((e=>e.drawPosition===u));if(!S)return en({result:{error:B},context:{drawPosition:u},stack:m});if(y?.map(Go).includes(s))return en({result:{error:Tt},context:{drawPosition:u},stack:m});let{containsParticipant:w,containsBye:P}=function(e){let t=e.bye,r=e.qualifier,i=e.participantId;return{containsBye:t,containsQualifier:r,containsParticipant:i,filled:t||r||i}}(S);if(P){let e=Fm({inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:l,matchUpsMap:d,event:p});if(e.error)return en({result:e,stack:m})}if(w&&S.participantId!==s){let{activeDrawPositions:e}=wm({drawDefinition:a,structureId:l});if(e.includes(u))return en({result:{error:V},stack:m});lh({assignments:[S],inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:a,matchUpsMap:d,structure:h})}if(S.participantId=s,r&&(S.qualifier=!0),(h?.stageSequence||0)>1||h.stage&&[vs,Ss].includes(h.stage)){let t=h.stage===Us?Us:Is,r=(a.structures?.find((e=>e?.stage===t&&1===e?.stageSequence))?.seedAssignments??[]).find((e=>e.participantId===s));if(r?.participantId){let{participantId:t,seedNumber:i,seedValue:s}=r;Zf({eventId:p?.eventId,provisionalPositioning:e,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:t,seedNumber:i,seedValue:s,structureId:l,event:p})}}if(h.structureType!==Es)!function({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:i,drawDefinition:n,drawPosition:a,matchUpsMap:o,structure:s,event:c}){let u={isCollectionMatchUp:!1},{matchUps:d}=Kp({provisionalPositioning:e,matchUpFilters:u,drawDefinition:n,matchUpsMap:o,structure:s,event:c}),{roundMatchUps:l}=Up({matchUps:d}),{initialRoundNumber:p}=Pm({drawPosition:a,matchUps:d}),m=p&&l?.[p].find((e=>e.drawPositions?.includes(a)));if(m){let e=ah({matchUpId:m.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:i,drawDefinition:n,drawPosition:a,matchUpsMap:o});if(e.error)return en({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:e})}}({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:d,structure:h,event:p});else{Om({positionAssignments:y,tournamentRecord:n,drawDefinition:a,matchUpsMap:d,structure:h});let{drawPositions:e,matchUps:r,targetMatchUps:i}=oh({assignments:[S],inContextDrawMatchUps:t,drawDefinition:a,matchUpsMap:d,structure:h});if(e&&1===r?.length&&r[0].matchUpType===Iu){let t=(i?.[0].sides??[]).reduce(((t,r,i)=>e?.includes(r.drawPosition)?i:t),void 0);eh({inContextTargetMatchUp:i[0],teamParticipantId:s,matchUp:r[0],drawPositionSideIndex:t,tournamentRecord:n,drawDefinition:a})}}return su({tournamentId:n?.tournamentId,drawDefinition:a,structure:h,event:p}),{positionAssignments:y,...I}}function mh(e){let{participantIdAttributeName:t="participantId",isQualifierPosition:r,positionActionName:i,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,event:u}=e,d="positionParticipantAction";if(!a)return{error:M};let l=Yu({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:m}=e;m||(m=mp({drawDefinition:a}),Object.assign(e,{matchUpsMap:m})),p||(({matchUps:p}=am({inContext:!0,drawDefinition:a,matchUpsMap:m})),Object.assign(e,{inContextDrawMatchUps:p}));let{positionAssignments:f}=Pc({drawDefinition:a,structureId:c}),h=f?.find((e=>e.drawPosition===s));if(h?.participantId){let e=h.participantId,t=ph({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,matchUpsMap:m,event:u});return t.success?y({appliedPolicies:l,removedParticipantId:e}):en({result:t,stack:d})}let g=Fm({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:s,structureId:c,matchUpsMap:m,event:u});if(g.error)return en({result:g,stack:d});let U=g.participantId,v=ph({inContextDrawMatchUps:p,isQualifierPosition:r,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,matchUpsMap:m,event:u});return v.success?y({appliedPolicies:l,removedParticipantId:U}):en({result:v,stack:d});function y({appliedPolicies:e,removedParticipantId:r}){let{structure:n}=yc({drawDefinition:a,structureId:c});return uu({drawPositions:[s],structure:n}),du({appliedPolicies:e,drawDefinition:a,positionAction:{[t]:o,name:i,drawPosition:s,structureId:c}}),en({context:{removedParticipantId:r},result:{...I},stack:d})}}function fh(e){return function({luckyLoserParticipantId:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n}){return mh({positionActionName:"luckyLoserDrawPositionAssignment",participantId:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n})}(e)}function hh(e){return function({alternateParticipantId:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n}){return mh({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n})}(e)}function gh({params:e,modMap:t,structure:r}){let{tournamentRecord:i,drawDefinition:n,event:a}=e;for(let o of r.matchUps)t[o.matchUpId]&&(o.roundNumber=t[o.matchUpId],iu({tournamentId:i?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:o}))}function Ih(e,t){let r=[{drawDefinition:!0,structureId:!0}];Array.isArray(t)&&r.push(...t);let i=xn(e,r);if(i.error)return i;let n=yc(e);if(n.error)return n;let a=n.structure;if(!Tp({structure:a}))return en({result:{error:E,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=Up({matchUps:a?.matchUps});return s?.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Oe}}function Uh(e){let t=Ih(e,[{targetRoundNumber:!0,roundNumber:!0,[En]:"number"}]);if(t.error)return t;let{structure:r,roundMatchUps:i,roundNumbers:n}=t,{targetRoundNumber:a,roundNumber:o}=e;if(!n?.includes(o)||!n?.includes(a))return en({result:{error:mr},info:"roundNumbers must be valid rounds"});let s=a>o,c=s?ai(o+1,a+1):ai(a,o),u={};return c.forEach((e=>(i?.[e]??[]).forEach((({matchUpId:t})=>{u[t]=e-(s?1:-1)})))),i?.[o]?.forEach((({matchUpId:e})=>u[e]=a)),gh({params:e,modMap:u,structure:r}),{...I}}function vh({structurePositionAssignments:e,provisionalPositioning:t,tournamentRecord:r,drawDefinition:i,event:n}){if(!i)return{error:M};if(!Array.isArray(e))return{error:mr};for(let o of e){let{structureId:e,positionAssignments:a}=o;if(!a)continue;let s=yc({drawDefinition:i,structureId:e});if(s.error)return s;let c=s.structure;if(!c)return{error:ae};let u=Pc({structure:c}).positionAssignments?.map((({drawPosition:e})=>e)),d=a?.map((({drawPosition:e})=>e));if(si(u,d).length!==u?.length)return en({result:{error:mr},info:"drawPositions do not match",stack:"setPositionAssignments"});let l=mp({drawDefinition:i}),{matchUps:p}=am({inContext:!0,drawDefinition:i,matchUpsMap:l});for(let o of a||[]){let{drawPosition:s,participantId:u,bye:d,qualifier:m}=o;if(d){let t=Mm({tournamentRecord:r,drawDefinition:i,drawPosition:s,matchUpsMap:l,structureId:e,structure:c,event:n});if(t?.error)return t}else if(m)a.forEach((e=>{e.drawPosition===s&&(e.qualifier=!0,delete e.participantId,delete e.bye)}));else if(u){let a=ph({provisionalPositioning:t,inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:i,participantId:u,drawPosition:s,matchUpsMap:l,structureId:e,event:n});if(a?.error)return a}}su({tournamentId:r?.tournamentId,drawDefinition:i,structure:c,event:n})}let a=e.map((({structureId:e})=>e));return au({tournamentId:r?.tournamentId,eventId:n?.eventId,drawDefinition:i,structureIds:a}),{...I}}function yh(e){let t=Ih(e,[{roundNumbers:!0,[En]:Rn,[Mn]:e=>2===e.length&&e.every(jr)}]);if(t.error)return t;let{structure:r,roundMatchUps:i,roundNumbers:n}=t;if(!e.roundNumbers.every((e=>n?.includes(e))))return en({result:{error:mr,message:"roundNumbers must be valid rounds"}});let a={};return e.roundNumbers.forEach(((t,r)=>(i?.[t]??[]).forEach((({matchUpId:t})=>{a[t]=e.roundNumbers[1-r]})))),gh({params:e,modMap:a,structure:r}),{...I}}function Sh(e){return function({qualifyingParticipantId:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n}){return mh({positionActionName:"qualifierDrawPositionAssignment",participantId:e,isQualifierPosition:!0,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n})}(e)}function wh({tournamentRecord:e,drawDefinition:t,drawPositions:r,structureId:i,event:n}){if(!t)return{error:M};if(!i)return{error:ne};if(2!==r?.length)return{error:mr,drawPositions:r};let a=mp({drawDefinition:t}),{matchUps:o}=am({inContext:!0,drawDefinition:t,matchUpsMap:a}),{structure:s}=yc({drawDefinition:t,structureId:i});if(!s)return{error:ae};let c,u=Yu({tournamentRecord:e,drawDefinition:t,event:n}).appliedPolicies??{};if(c=s.structureType===Es?function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,drawPositions:i,matchUpsMap:n,structure:a,event:o}){let s=a.structures?.reduce(((e,t)=>{let r=t?.positionAssignments.filter((e=>i?.includes(e.drawPosition)));return r&&e.push(...r),e}),[]);if(2===s.filter((({bye:e})=>e)).length)return{...I};if(2===s.filter((({qualifier:e})=>e)).length)return{...I};lh({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,matchUpsMap:n,assignments:s,structure:a,event:o});let c=s.some((({qualifier:e})=>e));if(s.some((({bye:e})=>e))&&!c)Ph({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,assignments:s,matchUpsMap:n,structure:a,event:o});else{let e=Da(s,!1,!0);s.forEach(((t,r)=>{let i=e[1-r].participantId;t.qualifier=e[1-r].qualifier,t.participantId=i}))}return{...I}}({inContextDrawMatchUps:o,tournamentRecord:e,drawDefinition:t,drawPositions:r,matchUpsMap:a,structure:s,event:n}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,drawPositions:i,matchUpsMap:n,structure:a,event:o}){let s=a?.positionAssignments.filter((e=>i?.includes(e.drawPosition)));if(!s)return{error:mr,structure:a,info:"Missing positionAssignments"};if(2===s.filter((({bye:e})=>e)).length)return{...I};if(2===s.filter((({qualifier:e})=>e)).length)return{...I};let c=s.some((({qualifier:e})=>e));return s.some((({bye:e})=>e))&&!c?Ph({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,assignments:s,matchUpsMap:n,structure:a,event:o}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,assignments:i,matchUpsMap:n,structure:a,event:o}){let s=Object.assign({},...i.map(((e,t)=>{let{drawPosition:r}=e;return{[r]:{...i[1-t],drawPosition:r}}})));return a.positionAssignments=a.positionAssignments.map((e=>s[e.drawPosition]||e)),lh({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,matchUpsMap:n,assignments:i,structure:a,event:o}),{...I}}({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,assignments:s,matchUpsMap:n,structure:a,event:o})}({inContextDrawMatchUps:o,tournamentRecord:e,drawDefinition:t,drawPositions:r,matchUpsMap:a,structure:s,event:n}),c.error)return c;if(uu({structure:s,drawPositions:r}),du({appliedPolicies:u,drawDefinition:t,positionAction:{name:"swapDrawPositionAssignments",drawPositions:r,structureId:i}}),su({tournamentId:e?.tournamentId,drawDefinition:t,structure:s,event:n}),n.eventType===xl){let i=Kp({matchUpFilters:{matchUpTypes:[gu]},inContext:!0,structure:s}).matchUps.filter((e=>e.drawPositions?.some((e=>r.includes(e))))),a=Kp({matchUpFilters:{matchUpTypes:[gu]},structure:s}).matchUps;i.forEach((i=>{(i.sides||[]).forEach((o=>{let s=o?.drawPosition;if(r.includes(s)){let r=o.participantId,c=a.find((({matchUpId:e})=>e===i.matchUpId)),u=i?.sides?.reduce(((e,t,r)=>t.drawPosition===s?r:e),void 0);eh({inContextTargetMatchUp:i,drawPositionSideIndex:u,teamParticipantId:r,tournamentRecord:e,drawDefinition:t,matchUp:c,event:n})}}))}))}return au({drawDefinition:t,structureIds:[i]}),{...I}}function Ph({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,assignments:i,matchUpsMap:n,structure:a,event:o}){let s=i.find((({bye:e})=>e)),c=i.find((({participantId:e})=>e)),u=s.drawPosition,{participantId:d,drawPosition:l}=c,{structureId:p}=a,m=Af({drawPosition:u,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,structureId:p,matchUpsMap:n});return m.error||(m=Af({drawPosition:l,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,structureId:p,matchUpsMap:n}),m.error)||(Mm({drawPosition:l,tournamentRecord:t,drawDefinition:r,structureId:p,matchUpsMap:n,event:o}),m=ph({drawPosition:u,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,structureId:p,participantId:d,matchUpsMap:n,event:o}),m.error)?m:{...I}}function Dh(e){return wh(e)}function Th({validation:e=!0,tournamentRecord:t,drawDefinition:r,participantId:i,structureId:n,seedValue:a,event:o}){if(!r)return{error:M};if(!n)return{error:ne};let s=(t?.participants??[]).find((e=>e.participantId===i));if(t&&!s)return{error:dt};let{structure:c}=yc({drawDefinition:r,structureId:n});if(!c)return{error:ae};if(!(!e||jr(a)||void 0===a||""===a||"string"==typeof a&&a.split("-").every((e=>jr(e)&&xr(e)>0))))return{error:mr};let{seedAssignments:u}=Ad({drawDefinition:r,structure:c}),d=u?.map((e=>e.seedNumber)),l=u?.find((e=>e.participantId===i));if(l){let e="string"==typeof a?a.includes("-")&&a.split("-").map((e=>parseInt(e))).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";l.seedValue=e}else{let e={seedNumber:Math.max(0,...d||[])+1,participantId:i};a&&(e.seedValue=a),c.seedAssignments||(c.seedAssignments=[]),c.seedAssignments.push(e)}return ou({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:r,structure:c}),{...I}}function bh({drawDefinition:e,structureId:t}){if(!e)return{error:M};let{structure:r}=yc({drawDefinition:e,structureId:t}),i=(e?.links||[]).filter((e=>e.source?.structureId===t)).map((e=>e.target?.structureId));return{playoffStructures:(e?.structures||[]).filter((e=>i.includes(e.structureId))),structure:r}}function Rh({withStageGrouping:e,stageSequences:t,stageSequence:r,roundTarget:i,stages:n,event:a,stage:o}){if(!a)return{error:de};let s={},c=[];for(let u of a.drawDefinitions||[]){let{structures:a,stageStructures:d}=Sc({withStageGrouping:e,stageSequences:t,drawDefinition:u,stageSequence:r,roundTarget:i,stages:n,stage:o});if(c.push(...a),d)for(let e of Object.keys(d))s[e]||(s[e]=[]),s[e].push(...d[e])}return{structures:c,stageStructures:s}}function Mh({withStageGrouping:e,tournamentRecord:t,stageSequences:r,stageSequence:i,roundTarget:n,stages:a,stage:o}){if(!t)return{error:D};let s={},c=[];for(let u of t.events||[]){let{structures:t,stageStructures:d}=Rh({withStageGrouping:e,stageSequences:r,stageSequence:i,roundTarget:n,stages:a,event:u,stage:o});if(t&&c.push(...t),d)for(let e of Object.keys(d))s[e]||(s[e]=[]),s[e].push(...d[e])}return{structures:c,stageStructures:s}}function Nh(e){if(!e?.drawDefinition)return!1;let t=Jp(e),r=t?.includesTeamMatchUps,{completedMatchUps:i,pendingMatchUps:n,upcomingMatchUps:a}=t||{};return r&&(i=i?.filter((({matchUpType:e})=>e===Iu)),n=n?.filter((({matchUpType:e})=>e===Iu)),a=a?.filter((({matchUpType:e})=>e===Iu))),!(!i?.length||n?.length||a?.length)}function Ah(e){let{drawDefinition:t,structureId:r}=e;if(!t)return{error:M};let{playoffStructures:i}=bh({drawDefinition:t,structureId:r});if(!i?.length)return!1;let n=t?.entries?.filter((e=>e?.entryStatus&&Dd.includes(e.entryStatus)))?.length??0,a=0;return(i||[]).reduce(((e,t)=>!(!(Pc({structure:t}).positionAssignments??[])?.filter((e=>(e.participantId&&a++,e?.bye??e?.participantId))).length||!e)),!!i.length)||a===n}function Eh({significantCharacters:e,accessors:t=[],value:r}){let i=[],n=t[0];if(r?.[n]){let a=t.slice(1);if(Array.isArray(r[n]))r[n].forEach((t=>{let r=Eh({accessors:a,significantCharacters:e,value:t});i.push(...r)}));else if(r=r[n],a.length){let t=Eh({accessors:a,significantCharacters:e,value:r});i.push(...t)}else!function({value:t}){if(t&&["string","number"].includes(typeof t)){let r=e?t.slice(0,e):t;i.push(r)}}({value:r})}return i}function Ch({policyAttributes:e,idCollections:t,participants:r,participant:i}){if(!Array.isArray(e))return{error:Ve};if(!i)return{error:ht};let n=[];return e.forEach((e=>{let{directive:a,groupings:o,key:s,significantCharacters:c}=e||{};if(s){let e=s.split(".");n.push(...Eh({significantCharacters:c,value:i,accessors:e}))}else if(a){let o=e?.includeIds,s=(t?.[a]||[]).filter((e=>!o||o.includes(e)));s?.length&&r?.length&&s.forEach((e=>{let t=r.find((t=>t.participantId===e));if(t?.individualParticipantIds?.includes(i.participantId)){let e=t?.participantId;n.push(e)}}))}else o&&Object.keys(o).forEach((e=>{o[e].includes(i.participantId)&&n.push(e)}))})),{values:Yr(n)}}function Oh({candidatePositionAssignments:e,participantsWithGroupings:t,policyAttributes:r,idCollections:i}){let n=Object.assign({},...t.map((e=>({[e.participantId]:e}))));return e.map((e=>{let a=n[e.participantId],{values:o}=Ch({participants:t,policyAttributes:r,idCollections:i,participant:a});return{...e,values:o}}))}function Fh({participantIdGroups:e,positionAssignments:t,groupsToAvoid:r}){return Object.assign({},...t.filter((e=>e?.participantId)).map((t=>{let{drawPosition:i,participantId:n}=t,a=e&&e[n]||[],o=!!r.some((e=>a.includes(e)));return{[i]:{participantGroups:a,includesGroupsToAvoid:o}}})))}function kh(e){let{unfilledPositions:t,chunkedDrawPositions:r}=e,i=Fh(e);return r.map((e=>{let r=t.filter((t=>e.includes(t))),n=function(e){return e.filter((e=>!t(e)));function t(t){let r=xh(t);return!e.includes(r)}}(r),a=r.filter((e=>!n.includes(e))).filter((e=>{let t=xh(e);return!i[t]?.includesGroupsToAvoid}));return{unassigned:r,unpaired:n,pairedNoConflict:a}}))}function xh(e){return Number(e%2?e+1:e-1)}function _h({selectedParticipantGroups:e,participantIdGroups:t,positionAssignments:r,drawPositionChunks:i,unfilledPositions:n,isRoundRobin:a}){let o=i.map((i=>a?function(e){let{unfilledPositions:t,chunkedDrawPositions:r}=e,i=Fh(e);return r.map((e=>{let r=t.filter((t=>e.includes(t))),n=r.length===e.length?r:[],a=e.filter((e=>i[e]?.includesGroupsToAvoid)).length;return{unassigned:r,unpaired:n,pairedNoConflict:a?[]:r,conflictsCount:a}}))}({groupsToAvoid:e,chunkedDrawPositions:i,participantIdGroups:t,positionAssignments:r,unfilledPositions:n}):kh({groupsToAvoid:e,chunkedDrawPositions:i,participantIdGroups:t,positionAssignments:r,unfilledPositions:n})));if(a){return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>e?.length)))).filter((e=>e?.length)).sort(((e,t)=>(t.length||0)-(e.length||0))),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>e?.length)))).filter((e=>e?.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>e?.length)))).filter((e=>e?.length)).sort(((e,t)=>(t.length||0)-(e.length||0)))}}return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>e?.length)))).filter((e=>e?.length)),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>e?.length)))).filter((e=>e?.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>e?.length)))).filter((e=>e?.length))}}function Lh({positionAssignments:e,participantIds:t}){let r=e.map((e=>e.participantId));return t.filter((e=>!r.includes(e)))}function Vh({candidatePositionAssignments:e,unseededParticipantIds:t,participantIdGroups:r,drawPositionChunks:i,drawPositionGroups:n,pairedPriority:a,allGroups:o,groupKey:s}){let c,u=n.reduce(((e,t)=>t.length>e?t.length:e),0)<=2,d=Lh({positionAssignments:e,participantIds:t}),l=function({drawPositionGroups:e,positionAssignments:t}){let r=Object.assign({},...t.map((e=>({[e.drawPosition]:e}))));return e.map((e=>e.filter(Boolean).map((e=>r[e])).filter(Boolean).filter((e=>!e.participantId&&!e.bye)).map((e=>e.drawPosition)))).flat().filter(Boolean)}({positionAssignments:e,drawPositionGroups:n}),{participantId:p,groupKey:m}=function({useSpecifiedGroupKey:e=!1,targetParticipantIds:t,largestFirst:r=!0,allGroups:i,groupKey:n}){let a=Object.assign({},...Object.keys(i).map((e=>[e,i[e].filter((e=>t.includes(e)))])).filter((e=>e[1].length)).map((([e,t])=>({[e]:t})))),o=Object.keys(a).reduce(((e,t)=>a[t].length>e?a[t].length:e),0),s=Object.keys(a).filter((e=>a[e].length===o)),c=ni(r?s:Object.keys(a));return{participantId:(n=e&&a[n]?.length?n:c)&&a[n]?ni(a[n]):ni(t),groupKey:n}}({targetParticipantIds:d,useSpecifiedGroupKey:u,allGroups:o,groupKey:s}),f=function({allGroups:e,participantId:t}){return Object.keys(e).filter((r=>e[r].includes(t)))}({participantId:p,allGroups:o}),h=_h({positionAssignments:e,isRoundRobin:u,selectedParticipantGroups:f,participantIdGroups:r,drawPositionChunks:i,unfilledPositions:l}),{unassigned:g,unpaired:I,pairedNoConflict:U}=h,v=U?.length&&U[0],y=I?.length&&I[0],S=a&&v?v:y,w=a?y:v,P=S?.length&&S||w?.length&&w;if(P?.length){let e=ii(P);c=ii(e)}else{let e=ii(g[0]);c=ii(e)}return{newGroupKey:m,selectedParticipantId:p,targetDrawPosition:c}}function Bh({isRoundRobin:e,groupedParticipants:t}){let r=[];return e?t.forEach((e=>{let t=_f({drawPositions:e.map((e=>e.drawPosition))}).uniqueMatchUpGroupings??[],i=Object.assign({},...e.map((e=>({[e.drawPosition]:e}))));t.forEach((t=>{ui(i[t[0]].values||[],i[t[1]].values||[])&&(r.push(t),e.conflict=!0)}))})):t.forEach((e=>{ui(e[0]?.values||[],e[1]?.values||[])&&(r.push(e),e.conflict=!0)})),r}function jh({positionedParticipants:e,potentialDrawPositions:t,drawPositionGroups:r,avoidanceConflicts:i,isRoundRobin:n}){return i.map((i=>{let a=i.map((e=>e.drawPosition));return i.filter((e=>t.includes(e.drawPosition))).map((i=>{let o=t.filter((e=>!a?.includes(e))).filter((t=>{let a=r.find((e=>e.includes(t))).find((e=>e!==t)),o=e.find((e=>e.drawPosition===a)),s=Bh({isRoundRobin:n,groupedParticipants:[[i,o]]}),c=[e.find((e=>e.drawPosition===t)),o],u=Bh({isRoundRobin:n,groupedParticipants:[c]});return!s.length&&!u.length}));if(o.length)return{drawPosition:i.drawPosition,possibleDrawPositions:o}})).filter(Boolean)})).flat(1)}function Gh(e){let t,{initialPositionAssignments:r,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:a,drawPositionGroups:o,policyAttributes:s,idCollections:c,allGroups:u}=e,d=[],l=Math.min(...(o||[]).map((e=>e?.length)).filter(Boolean)),p=l>2,m=Da(r,!1,!0).filter((e=>!e.qualifier)),f=r.filter((e=>!e.participantId&&(!e.bye||a?.includes(e.drawPosition)))).map((e=>e.drawPosition));ai(0,n).forEach((()=>{let{newGroupKey:r,selectedParticipantId:i,targetDrawPosition:n}=Vh({...e,candidatePositionAssignments:m,allGroups:u,groupKey:t});t=r,m.forEach((e=>{e.drawPosition===n&&(e.participantId=i)}))}));let h=Oh({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:s,idCollections:c}),g=pi(h,l),I=Bh({groupedParticipants:g,isRoundRobin:p}),U=0;for(;U<20&&I.length;){let e=jh({positionedParticipants:h,potentialDrawPositions:f,avoidanceConflicts:I,drawPositionGroups:o,isRoundRobin:p});if(e.length){let t=qh({candidatePositionAssignments:m,swapOptions:e});t.error&&console.log({result:t}),h=Oh({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:s,idCollections:c}),g=pi(h,l),I=Bh({groupedParticipants:g,isRoundRobin:p}),U++}else U=20}return m.forEach((e=>{if(e.bye&&e.participantId){let e=X;d.push(e)}if(e.qualifier&&e.participantId){let e=X;d.push(e)}})),{positionAssignments:m,conflicts:I.length,groupedParticipants:g,errors:d}}function qh({candidatePositionAssignments:e,swapOptions:t}){let r=ii(t);if(!r)return{error:{message:"No swap options"}};let i=r.drawPosition,n=ii(r.possibleDrawPositions),a=e.find((e=>e.drawPosition===i)),o=e.find((e=>e.drawPosition===n))??{},s={participantId:o?.participantId,qualifier:o?.qualifier,bye:o?.bye},c={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,c),{...I}}function $h({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:r,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:u,avoidance:d,drawSize:l,event:p}){if(!d)return{error:Le};let{candidatesCount:m=1,policyAttributes:f,targetDivisions:h}=d,{roundsToSeparate:g}=d,U="randomUnseededSeparation",{structure:v}=yc({drawDefinition:a,structureId:u}),{matchUps:y}=Kp({provisionalPositioning:e,matchUpsMap:c,structure:v,event:p});if(h&&_r(h)&&!g){let e=function(e){if(!_r(e))return!1;let t=e,r=1;for(;2!==t;)r+=1,t/=2;return r}(h)||0,t=y.reduce(((e,t)=>t.roundNumber>e?t.roundNumber:e),0);g=t<e?1:t-e+1}let{positionAssignments:S}=Dc({structure:v}),w=Eu({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,P=S?.filter((e=>!e.participantId)),D=S?.map((e=>e.drawPosition)),T=v?.structureType===Es,b=T?{structure:v,matchUps:y,allDrawPositions:D,roundsToSeparate:g}:{matchUps:y,allDrawPositions:D,roundsToSeparate:g},{drawPositionGroups:R,drawPositionChunks:M}=T?function(e){let{structure:{structures:t}}=e,r=t.map((e=>e.positionAssignments.map((e=>e.drawPosition))));return{drawPositionGroups:r,drawPositionChunks:[r]}}(b):function({allDrawPositions:e,roundsToSeparate:t,matchUps:r}){let i=r.filter((e=>1===e.roundNumber)).map((e=>e.drawPositions)),n=i.flat().sort(kr),a=Math.max(...n),o=e.filter((e=>e>a)),s=n.length,c=ai(2===s?1:2,s).filter((e=>e===Br(e))),u=c.slice(0,t||c.length).reverse().map((e=>pi(n,e)));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:i,drawPositionChunks:u}}(b),N={groupParticipants:s.filter((e=>e.participantType===bu)).map((e=>e.participantId)),teamParticipants:s.filter((e=>e.participantType===Mu)).map((e=>e.participantId)),pairParticipants:s.filter((e=>e.participantType===Ru)).map((e=>e.participantId))},A=function({targetParticipantIds:e,policyAttributes:t,idCollections:r,participants:i}){if(!Array.isArray(t))return{error:Ve};if(!Array.isArray(i))return{error:gt};let n={};return e.forEach((e=>{let a=i.find((t=>t.participantId===e)),{values:o}=Ch({policyAttributes:t,idCollections:r,participants:i,participant:a});o&&o.forEach((t=>{n[t]||(n[t]=[]),n[t].includes(e)||n[t].push(e)}))})),n}({targetParticipantIds:t,policyAttributes:f,idCollections:N,participants:s});if(A.error)return en({result:A,stack:U});let E=Object.assign({},...t.map((e=>{let t=Object.keys(A).filter((t=>(A[t]??[]).includes(e)));return{[e]:t}}))),C=Lh({participantIds:t,positionAssignments:S});if(C.length>(P?.length||0))return{error:xt};let O,F=C.length,k=ai(0,m).map((()=>Gh({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:t,opponentsToPlaceCount:F,pairedPriority:!1,unseededByePositions:i,participantIdGroups:E,drawPositionChunks:M,drawPositionGroups:R,policyAttributes:f,idCollections:N,allGroups:A,drawSize:l})));if(O=k.reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0),!O||O.conflicts){let e=ai(0,m).map((()=>Gh({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:t,opponentsToPlaceCount:F,pairedPriority:!0,unseededByePositions:i,participantIdGroups:E,drawPositionChunks:M,drawPositionGroups:R,policyAttributes:f,idCollections:N,allGroups:A,drawSize:l})));O=k.concat(...e).filter((e=>!e.errors?.length)).reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0)}if(!O)return{error:sr};let x=(Pc({structure:v})?.positionAssignments??[]).filter((e=>e.participantId)).map((e=>e.participantId)),_=O.positionAssignments.filter((e=>!x.includes(e.participantId)));for(let I of _)if(I.bye){let e=Mm({tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:c,event:p,...I});if(e.error)return en({result:e,stack:U})}else if(I.participantId){let e=ph({automaticPlacement:!0,inContextDrawMatchUps:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:c,event:p,...I});if(e.error)return en({result:e,stack:U,context:{assignment:I}})}return{...I}}function Wh({provisionalPositioning:e,inContextDrawMatchUps:t,unseededByePositions:r,multipleStructures:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:u,structure:d,drawSize:l,event:p}){d||({structure:d}=yc({drawDefinition:a,structureId:u})),u||({structureId:u}=d);let{positionAssignments:m}=Dc({structure:d}),{seedAssignments:f}=Ad({provisionalPositioning:e,drawDefinition:a,structure:d}),h=f?.map((e=>e.participantId)).filter(Boolean),{stage:g,stageSequence:U}=d,v=g===Us?no({element:d,name:Po})?.extension?.value:void 0,y=Nd({provisionalPositioning:e,drawDefinition:a,stageSequence:U,entryStatuses:Pd,structureId:u,roundTarget:v,stage:g}),S=y.filter((e=>!h?.includes(e.participantId))).map((e=>e.participantId)),w=m?.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));if(!i&&S.length>(w?.length||0))return en({result:{error:xt},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:w?.length},stack:"positionUnseededParticipants"});let{appliedPolicies:P}=Yu({tournamentRecord:n,drawDefinition:a,event:p}),D=P?.[xa];if(d.stage===Ss){let e=y.reduce(((e,t)=>(e[t.groupingValue]||(e[t.groupingValue]=[]),e[t.groupingValue].push(t.participantId),e)),{});Object.keys(e).length&&(D||(D={policyName:"Playoff Avoidance"}),D.policyAttributes||(D.policyAttributes=[]),D.policyAttributes.push({groupings:e}))}return D&&s?$h({provisionalPositioning:e,unseededParticipantIds:S,inContextDrawMatchUps:t,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:u,avoidance:D,drawSize:l,entries:y}):function({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:r,unfilledDrawPositions:i,multipleStructures:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:c,structureId:u,drawSize:d,event:l}){let p=d>2?Qr(i):i.reverse();for(let m of t){let t=p.pop();if(!n||t){let i=ph({provisionalPositioning:e,inContextDrawMatchUps:r,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:t,matchUpsMap:c,structureId:u,event:l});if(i?.error&&console.log("!!!!!",{result:i}),i?.error)return en({result:i,stack:"randomUnseededDistribution"})}}return{...I}}({provisionalPositioning:e,unseededParticipantIds:S,inContextDrawMatchUps:t,unfilledDrawPositions:w,multipleStructures:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:c,drawSize:l,event:p})}function Hh(e){let t=e.structure??yc(e).structure,r="positionQualifiers",i=[];if(t.stage===vs)return en({result:{error:Ie},stack:r});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:o}=function({drawDefinition:e,structure:t,structureId:r}){t||({structure:t}=yc({drawDefinition:e,structureId:r})),r||({structureId:r}=t);let{positionAssignments:i}=Dc({structure:t}),{stage:n,stageSequence:a}=t,{qualifiersCount:o,roundQualifiersCounts:s}=rf({drawDefinition:e,stageSequence:a,structureId:r,stage:n}),c=(s?Object.keys(s):[]).map((e=>xr(e))),{matchUps:u}=Kp({structure:t}),{roundProfile:d}=Up({matchUps:u}),l=Object.assign({},...c.filter((e=>d?.[e])).map((e=>({[e]:d?.[e]?.drawPositions?.filter(Boolean)??[]})))),p=i?.filter((e=>e.qualifier)).map((e=>e.drawPosition)),m=o-(p?.length??0),f=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...c.map((e=>{let t=i?.filter((t=>t.qualifier&&l[e]?.drawPositions?.includes(t.drawPosition))).map((e=>e.drawPosition));return{[e]:(s?.[e]??0)-(t?.length??0)}}))),unplacedQualifiersCount:m,placedQualifiersCount:f,roundQualifiersCounts:s,positionAssignments:i,roundDrawPositions:l,qualifiersCount:o}}(e);for(let s of Object.keys(n)){let e=a?.filter((e=>o[s].includes(e.drawPosition)&&!e.participantId&&!e.qualifier&&!e.bye)).map((e=>e.drawPosition));if(n[s]>(e||0))return en({result:{error:kt},context:{unfilledDrawPositions:e},stack:r});ai(0,n[s]).forEach((()=>{let t=ii(e);i.push(t),a?.forEach((e=>{e.drawPosition===t&&(e.qualifier=!0,delete e.participantId,delete e.bye)}))}))}return{...I,qualifierDrawPositions:i}}function zh({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:r,appliedPolicies:i,validSeedBlocks:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:c,groupsCount:u,structureId:d,matchUpsMap:l,structure:p,event:m}){let f=[],h=[],g=0;if(p||({structure:p}=yc({drawDefinition:a,structureId:d})),d||(d=p?.structureId),i||(i=Yu({drawDefinition:a}).appliedPolicies),!n){let t=p&&Yf({provisionalPositioning:e,appliedPolicies:i,drawDefinition:a,seedingProfile:o,structure:p});t?.error&&h.push(t.error),n=t?.validSeedBlocks}return ai(0,u=u??n?.length??0).forEach((()=>{if(g<(u||0)){let i=function({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:i,seedingProfile:n,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:c,event:u}){let{unplacedSeedParticipantIds:d,unfilledPositions:l}=Jf({provisionalPositioning:e,randomize:!0,drawDefinition:i,seedingProfile:n,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:p}=Yu({drawDefinition:i}),{avoidance:m}=p??{};let f=[];for(let h of d){let o=l.pop();if(!o)return{error:j};f.push(o);let d=ph({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:i,seedingProfile:n,participantId:h,seedBlockInfo:a,drawPosition:o,matchUpsMap:c,structureId:s,event:u});if(!d.success)return d}return{...I,seedPositions:f}}({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:c,structureId:d,matchUpsMap:l,event:m});i?.success&&(g++,f.push(...i.seedPositions??[])),i.error&&h.push({seedPositionError:i.error})}})),h.length?{error:h}:{...I,seedPositions:f}}function Yh({orderedSortedFirstRoundSeededDrawPositions:e,validSeedBlocks:t,byesToPlace:r}){let i=[];t.forEach((t=>{if(r-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let r,n=Qh(pi(t.drawPositions,2)),a=e[i.length];for(;r=Kh(n,a);)i.push(r),a=e[i.length]}}));let n=i.map((e=>Array.isArray(e)?Qr(e):e)).flat(1/0);return Gr(r)&&t.map((e=>e.seedNumbers[0])).includes(r)?e:n}function Kh(e,t){if(Array.isArray(e)&&2!==e.length)return e.pop();if(!Array.isArray(e[0]))return e.includes(t)?e.indexOf(t)?e.pop():e.shift():Math.round(Math.random())?e.pop():e.shift();let r=e[0].flat(1/0).length,i=e[1].flat(1/0).length;if(r===i){let r=e[0].flat(1/0).includes(t)?e[0]:e[1];return Kh(t?r:e[Math.round(Math.random())],t)}return Kh(r<i?e[1]:e[0],t)}function Qh(e){let t=Math.floor(e.length/2);return e.length>2?[Qh(e.slice(0,t)),Qh(e.slice(t))]:e}function Jh({provisionalPositioning:e,relevantMatchUps:t,appliedPolicies:r,drawDefinition:i,seedingProfile:n,seedBlockInfo:a,byesToPlace:o,structure:s}){a||(a=Yf({provisionalPositioning:e,appliedPolicies:r,drawDefinition:i,seedingProfile:n,structure:s}));let{isFeedIn:c,isLuckyStructure:u,isContainer:d}=a,{validSeedBlocks:l}=a;r?.seeding?.containerByesIgnoreSeeding&&(l=[]);let p=function({provisionalPositioning:e,drawDefinition:t,structure:r}){let{positionAssignments:i}=Dc({structure:r}),{seedAssignments:n}=Ad({provisionalPositioning:e,drawDefinition:t,structure:r}),a=Object.assign({},...(n||[]).filter((e=>e.participantId)).map((e=>({[e.participantId]:e}))));return i?.map((e=>a[e.participantId]?{...e,seedNumber:a[e.participantId].seedNumber,seedValue:a[e.participantId].seedValue}:"")).filter(Boolean)}({provisionalPositioning:e,drawDefinition:i,structure:s})??[],m=Yr([].concat(...t.map((e=>e.drawPositions)))),f=p.filter((e=>m.includes(e.drawPosition))),h=(e,t)=>Hf(e.seedValue)-Hf(t.seedValue),g=l.reduce(((e,t)=>{let r=f.filter((e=>t.drawPositions?.includes(e.drawPosition))).sort(h);return e.concat(...r)}),[]).map((e=>e.drawPosition)),I=Yh({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:l,byesToPlace:o});return{strictSeedOrderByePositions:Xh({orderedSeedDrawPositions:g,relevantMatchUps:t}).slice(0,o),blockSeedOrderByePositions:Xh({orderedSeedDrawPositions:I,relevantMatchUps:t}).slice(0,o),isLuckyStructure:u,positionedSeeds:p,isContainer:d,isFeedIn:c}}function Xh({orderedSeedDrawPositions:e,relevantMatchUps:t}){let r=t.map((e=>e.drawPositions)).map((e=>e?.sort(((e,t)=>e-t)))).filter((e=>e?.[0]+1===e?.[1]));return e.map((e=>r.find((t=>t?.includes(e))))).filter(Boolean).map((t=>t?.reduce(((t,r)=>e.includes(r)?t:r),void 0))).filter(Boolean)}function Zh({provisionalPositioning:e,tournamentRecord:t,appliedPolicies:r,drawDefinition:i,seedBlockInfo:n,seedingProfile:a,matchUpsMap:o,structureId:s,structure:c,seedLimit:u,seedsOnly:d,event:l}){c||({structure:c}=yc({drawDefinition:i,structureId:s})),s||(s=c?.structureId);let p=!(c?.structures??c?.stage===Us),{byesCount:m,placedByes:f,relevantMatchUps:h}=function({provisionalPositioning:e,drawDefinition:t,matchUpsMap:r,structure:i,event:n}){let{matchUps:a,roundMatchUps:o}=Kp({afterRecoveryTimes:!1,provisionalPositioning:e,drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:r,structure:i,event:n}),s=o?.[1]||[],c=i?.structureType===Es,u=c?a:s,d=c?i?.structures?.length||0:a.length,{structureId:l,stage:p,stageSequence:m}=i,f=Nd({entryStatuses:Dd,provisionalPositioning:e,drawDefinition:t,stageSequence:m,structureId:l,stage:p}),{qualifiersCount:h}=rf({provisionalPositioning:e,drawDefinition:t,stageSequence:m,structureId:l,stage:p}),g=f.length+h,{positionAssignments:I,unassignedPositions:U}=Dc({structure:i}),v=U?.map((e=>e.drawPosition)),y=I?.filter((e=>e.bye)).length,S=I?.filter((e=>e.bye)).map((e=>e.drawPosition)),w=u.map((e=>e.drawPositions)).filter((e=>e?.reduce(((e,t)=>!S?.includes(t)&&e),!0))).flat(1/0).filter((e=>v?.includes(e))),P=I?.length,D=P?P-g:0;return D>d&&1===i.stageSequence&&i.stage!==vs&&(D=d),{placedByes:y,byesCount:D,relevantMatchUps:u,placedByePositions:S,roundMatchUps:o,positionsToAvoidDoubleBye:w}}({provisionalPositioning:e,drawDefinition:i,matchUpsMap:o,structure:c,event:l}),g=m-(f||0);if(g<=0)return{...I};let{strictSeedOrderByePositions:U,blockSeedOrderByePositions:v,isLuckyStructure:y,isFeedIn:S}=Jh({provisionalPositioning:e,relevantMatchUps:h,appliedPolicies:r,drawDefinition:i,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:c}),w=c?.structureType&&[Es,As].includes(c.structureType)&&r?.seeding?.containerByesIgnoreSeeding,P=p&&v?.length?v:U,{unseededByePositions:D}=function({provisionalPositioning:e,seedOrderByePositions:t,isLuckyStructure:r,appliedPolicies:i,drawDefinition:n,seedLimit:a,structure:o,isFeedIn:s}){let c,u=i?.seeding?.seedingProfile,d=o.stage===Us,{positionAssignments:l}=Dc({structure:o}),p=l?.filter((e=>e.participantId)).map((e=>e.drawPosition)),{matchUps:m,roundMatchUps:f}=Kp({provisionalPositioning:e,matchUpFilters:{isCollectionMatchUp:!1},structure:o}),h=f?.[1]||[],g=o.structureType===Es?m:h,I=Yr([].concat(...g.map((e=>e.drawPositions)))),U=Math.min(...I)-1,v=p?.filter((e=>I.includes(e))),y=e=>{let t=Math.ceil(e.length/2),r=[e.slice(0,t),e.slice(t)],i=r.map((e=>[].concat(...e.flat(1/0)).length)),n=Math.min(...i.flat(1/0)),a=Math.max(...i.flat(1/0)),o=i.indexOf(a),s=n!==a,c=Qr(r),[u,d]=!n||s?[r[o],r[1-o]]:[c[0],c[1]];return{greaterHalf:u,lesserHalf:d}},S=e=>{let{greaterHalf:t,lesserHalf:r}=y(e),{greaterHalf:i,lesserHalf:n}=y(t),a=Qr(i.flat(1/0)).pop();return{newlyFilteredChunks:[...r,...n,i.flat().filter((e=>e!==a))],drawPosition:a}},w=e=>!v?.includes(e),P=e=>{let t=pi(e.sort(kr),Math.ceil(e.length/4)).map((e=>e.filter(w))),r=[].concat(...t.flat(1/0)).length,i=[];for(let n=0;n<r;n++){let{newlyFilteredChunks:e,drawPosition:r}=S(t);i.push(r),t=e}return i},{validSeedBlocks:D}=Yf({provisionalPositioning:e,allPositions:!0,appliedPolicies:i,drawDefinition:n,structure:o}),T=D?.map((e=>e.drawPositions?.map((e=>e+U))));if(s){let e=I.length,{seedBlocks:t}=qf({cluster:Xf(u)===Ms,participantsCount:e});c=t.map((e=>e.map((e=>e+U)))).map(P).filter((e=>e.length))}else c=d?T?.map((e=>e.filter(w))):T?.map(P).filter((e=>e.length));let b=g.map((e=>e.drawPositions)).map((e=>e?.sort(((e,t)=>e-t)))).filter((e=>e?.[0]+1===e?.[1])),R=e=>b.reduce(((t,r)=>r.includes(e)?r.reduce(((t,r)=>r!==e?r:t),void 0):t),void 0),M=c.map((e=>e.map(R))).flat(1/0).filter(w).filter((e=>!t.includes(e))).filter(Boolean);if(d&&!o.structures){let e=a%4,t=M.slice(0,e),r=f[o.roundLimit]?.length,i=pi(M.slice(e),r).map(Qr).flat();M=t.concat(i)}return{unseededByePositions:M}}({provisionalPositioning:e,seedOrderByePositions:P,isLuckyStructure:y,appliedPolicies:r,drawDefinition:i,seedLimit:u,structure:c,isFeedIn:S}),T=(e,t)=>(e||[]).every((e=>(e=>e%2)(e)?t!==e+1:t!==e-1)),b=[].concat(...P);if(!d)for(;D.length;){let e=D.find((e=>T(b,e)));e?(b.push(e),D=D.filter((t=>t!==e))):(b.push(...D),D=[])}w&&(b=Qr(b),wi({ignoreSeededByes:w})&&console.log({byePositions:b}));let R=b.slice(0,g);for(let I of R){let r=Mm({provisionalPositioning:e,tournamentRecord:t,drawDefinition:i,drawPosition:I,matchUpsMap:o,structureId:s,structure:c,event:l});if(r?.error)return r}return{...I,unseededByePositions:D,byeDrawPositions:R}}function eg(e){let{drawDefinition:t}=e,{applyPositioning:r=!0,provisionalPositioning:i,multipleStructures:n,placeByes:a=!0,tournamentRecord:o,placementGroup:s,seedingProfile:c,structureId:u,seedLimit:d,seedsOnly:l,drawType:p,drawSize:m,event:f}=e,h=[];r||(bi(),t=Da(t,!1,!0));let g=e=>(r||Ri(),en({result:e,stack:"automatedPositioning"})),U=yc({drawDefinition:t,structureId:u});if(U.error)return g(U);let v=U.structure;if(!v)return{error:ae};let y=e.appliedPolicies||Yu({drawDefinition:t,structure:v,event:f})?.appliedPolicies,{qualifiersCount:S}=rf({stageSequence:v.stageSequence,provisionalPositioning:i,stage:v.stage,drawDefinition:t,structureId:u}),w=Pd;if(!Nd({stageSequence:v.stageSequence,provisionalPositioning:i,stage:v.stage,placementGroup:s,drawDefinition:t,entryStatuses:w,structureId:u})?.length&&!S)return P={...I},r||Ri(),P;var P;let D=e.matchUpsMap??mp({drawDefinition:t}),T=e.inContextDrawMatchUps??am({inContext:!0,drawDefinition:t,matchUpsMap:D})?.matchUps,b=[],R=Yf({provisionalPositioning:i,appliedPolicies:y,drawDefinition:t,seedingProfile:c,structure:v});if(R.error)return R;let{validSeedBlocks:M}=R;h.push({validSeedBlocks:M});let N=e.participants||(o?ef({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:o})?.participants:[]);if(Xf(v.seedingProfile||c)===Ns){let e=a?Zh({provisionalPositioning:i,tournamentRecord:o,appliedPolicies:y,drawDefinition:t,seedBlockInfo:R,matchUpsMap:D,structure:v,seedLimit:d,seedsOnly:l,event:f}):void 0;if(e?.error)return g(e);if(b=e.unseededByePositions,h.push({action:"positionByes",unseededByePositions:b}),e=zh({seedingProfile:v.seedingProfile?{positioning:v.seedingProfile}:c,provisionalPositioning:i,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:y,validSeedBlocks:M,drawDefinition:t,seedBlockInfo:R,participants:N,matchUpsMap:D,structure:v,event:f}),e.error)return g(e);h.push({seedPositions:e.seedPositions,action:"positionSeedBlocks"})}else{if(p!==Ys){let e=zh({seedingProfile:v.seedingProfile?{positioning:v.seedingProfile}:c,provisionalPositioning:i,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:y,validSeedBlocks:M,drawDefinition:t,seedBlockInfo:R,participants:N,matchUpsMap:D,structure:v,event:f});if(e.error)return g(e);h.push({action:"positionSeedBlocks",seedPositions:e.seedPositions})}let e=a?Zh({provisionalPositioning:i,tournamentRecord:o,appliedPolicies:y,drawDefinition:t,seedBlockInfo:R,matchUpsMap:D,structure:v,seedLimit:d,seedsOnly:l,event:f}):void 0;if(e?.error)return g(e);b=e?.unseededByePositions,h.push({action:"positionByes",byeDrawPositions:e?.byeDrawPositions,unseededByePositions:b})}let A={};if(!l){let e=Hh({inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:y,validSeedBlocks:M,drawDefinition:t,seedBlockInfo:R,participants:N,matchUpsMap:D,structure:v});if(e.error||(e.conflicts&&(A.qualifierConflicts=e.conflicts),h.push({action:"positionQualifiers",qualifierDrawPositions:e.qualifierDrawPositions}),e=Wh({provisionalPositioning:i,inContextDrawMatchUps:T,unseededByePositions:b,multipleStructures:n,tournamentRecord:o,drawDefinition:t,seedBlockInfo:R,participants:N,matchUpsMap:D,structureId:u,structure:v,drawSize:m,event:f}),e.error))return g(e);e.conflicts&&(A.unseededConflicts=e.conflicts),h.push({action:"positionUnseededParticipants"})}let{positionAssignments:E}=Pc({drawDefinition:t,structure:v});return au({drawDefinition:t,structureIds:[u]}),r||Ri(),{positionAssignments:E,conflicts:A,...I,positioningReport:h}}function tg(e){let{applyPositioning:t=!0,provisionalPositioning:r,tournamentRecord:i,drawDefinition:n,seedingProfile:a,structureId:o,placeByes:s,seedsOnly:c,event:u}=e;if(!u)return{error:le};if(!n)return{error:A};if(!Nh({drawDefinition:n,structureId:o})&&!r)return{error:C};let d=bh({drawDefinition:n,structureId:o}).playoffStructures?.sort(((e,t)=>vc(e)-vc(t))),l=[],p=[];if(d)for(let m of d){let{structureId:e}=m,o=eg({structureId:e,provisionalPositioning:r,applyPositioning:t,tournamentRecord:i,drawDefinition:n,seedingProfile:a,placeByes:s,seedsOnly:c});if(o.error)return o;o.positionAssignments&&l.push({positionAssignments:o.positionAssignments,structureId:e}),o.positioningReport&&p.push(o.positioningReport)}return{...I,structurePositionAssignments:l,positioningReports:p}}function rg({drawDefinition:e,orderMap:t}){return e?(("object"!=typeof t||!Object.values(t).every((e=>Wr(e))))&&en({result:{error:mr},context:{orderMap:t}}),e.structures||(e.structures=[]),e.structures.forEach((e=>{let r=t[e.structureId];r&&(e.structureOrder=r)})),e.structures.sort(((e,t)=>Jr(e.structureOrder)-Jr(t.structureOrder))),{...I}):{error:M}}function ig({drawDefinition:e}){let t=e.structures??[],r=e.links??[],i=new Map,n=e=>{let r=i.get(e)||i.set(e,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&i.get(e);if(r&&!r?.stage){let i=t.find((t=>t.structureId===e));r.stage=i?.stage}return r},a={},o={},s=r.map((e=>{let t=e.source.structureId,r=e.target.structureId,i=n(t),s=n(r);return[ks,Fs,Os,Ns].includes(e.target.feedProfile)?(i?.targets.push(r),s?.sources.push(t)):e.target.feedProfile===Cs&&(s?.drawSources.push(t),i?.drawTargets.push(r)),o[r]=o[r]||e.target.feedProfile===Cs,a[r]=Yr([...a[r]||[],t]).filter(Boolean),[e.source.structureId,e.target.structureId]}));for(let h of i.keys()){let e=i.get(h);if(e){let t=e.targets??[];for(;t.length;){let r=t.pop(),n=r&&i[r];n?.targets?.length?t.push(...n.targets):n&&(e.rootStage=n.stage)}if(e.rootStage||(e.rootStage=e.stage),!e.targets?.length){let t=e.sources??[];for(;t.length;){let r=t.pop(),n=r&&i[r];if(n?.sources?.length){for(let t of n.sources)e.progeny?.includes(t)||e.progeny?.push(t);t.push(...n.sources)}}}}}let c=0;for(let h of i.keys()){let e=i.get(h);if(e&&e.rootStage===Us){let t=[e.drawTargets?.[0]],r=0;for(;t.length;){r+=1;let e=t.pop(),n=e?i.get(e):void 0;n?.drawTargets?.length&&t.push(n.drawTargets[0])}e.distanceFromMain=r,r>c&&(c=r)}}let u=s.length;ai(0,Math.ceil(u/2)).forEach((()=>{s=ai(0,u).map((e=>{let t=s[e],r=s.reduce(((e,r)=>ui(t,r)?e.concat(...r):e),[])||[];return Yr(t.concat(...r))}))}));let d=s[0],l=s.slice(1).reduce(((e,t)=>e&&((e,t)=>si(e,t).length===e.length)(t,d)),!0),p=[d].filter(Boolean),m=[d].filter(Boolean);t.forEach((e=>{let{structureId:t,stage:r}=e;p.find((e=>e.includes(t)))||(p.push([t]),r!==ys&&m.push([t]))}));let f=l&&1===m.length;return!r?.length&&1===t.length&&n(t[0].structureId),{structureProfiles:Object.fromEntries(i),allStructuresLinked:f,maxQualifyingDepth:c,sourceStructureIds:a,hasDrawFeedProfile:o,structureGroups:p}}function ng({drawDefinition:e}){let{maxQualifyingDepth:t,structureProfiles:r}=ig({drawDefinition:e});for(let i of e.structures){let e=r[i.structureId];e.distanceFromMain&&(i.stageSequence=t+1-e.distanceFromMain)}return{...I}}function ag(e){let{duplicateValues:t=!0,creationTime:r=!0,removePriorValues:i,timeItem:n}=e;if(!n)return{error:Zt};let a=ku(e);if(a.error)return a;if(!(d(n)&&u(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:Jt};if(a.timeItems){if(function({element:e,duplicateValues:t,timeItem:r}){let{itemType:i,itemSubTypes:n,itemValue:a}=r,o=i&&xu({itemSubTypes:n,itemType:i,element:e})?.timeItem;return o&&JSON.stringify(o?.itemValue)===JSON.stringify(a)&&!t}({element:a,duplicateValues:t,timeItem:n}))return{...I}}else a.timeItems=[];if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,r){let e=(new Date).toISOString();Object.assign(n,{createdAt:e})}return i&&(a.timeItems=a.timeItems.filter((({itemType:e})=>n.itemType!==e))),i&&!n.itemValue||a.timeItems.push(n),{...I}}function og({creationTime:e=!0,removePriorValues:t,tournamentRecord:r,duplicateValues:i,participantId:n,timeItem:a}){if(!r)return{error:D};if(!n)return{error:It};let o=Fu({tournamentRecord:r,participantId:n});return o.error?o:ag({element:o.participant,removePriorValues:t,duplicateValues:i,creationTime:e,timeItem:a})}function sg(e){let{removePriorValues:t,tournamentRecord:r,duplicateValues:i,creationTime:n,timeItem:a}=e;return r?ag({element:r,removePriorValues:t,duplicateValues:i,creationTime:n,timeItem:a}):{error:D}}function cg(e){let{removePriorValues:t,duplicateValues:r,creationTime:i,timeItem:n,event:a}=e;return a?ag({removePriorValues:t,duplicateValues:r,element:a,creationTime:i,timeItem:n}):{error:le}}function ug({tournamentRecord:e,drawDefinition:t,structure:r,link:i}){if(!e)return{error:D};if(!t)return{error:M};let n=function({drawDefinition:e,tournamentId:t,structure:r,eventId:i,link:n}){if(!e)return{error:M};if(!r)return{error:se};if(!n)return{error:re};let a=n.target.structureId,o=yc({drawDefinition:e,structureId:a});if(o.error)return en({stack:"attachQualifyingStructure",context:{targetStructureId:a},result:o});e.structures||(e.structures=[]),e.links||(e.links=[]),e.structures.push(r),e.links.push(n),ng({drawDefinition:e});let s=Kp({structure:r})?.matchUps||[];return tu({drawDefinition:e,tournamentId:t,matchUps:s,eventId:i}),au({drawDefinition:e,structureIds:[r.structureId]}),{...I}}({tournamentId:e.tournamentId,drawDefinition:t,structure:r,link:i});return n.error||sg({tournamentRecord:e,timeItem:{itemType:"attachQualifyingStructures",itemValue:{structureId:r.structureId,drawId:t.drawId}}}),n}function dg({drawDefinition:e,structureDetails:t}){if(!Array.isArray(t))return{error:mr};if(!e)return{error:M};let r=Object.assign({},...t.map((e=>{if(!d(e))return;let{structureId:t,structureName:r}=e||{};return t&&r?{[t]:r}:void 0})).filter(Boolean));if(!Object.values(r).length)return{error:He};for(let i of e.structures||[]){let e=r[i.structureId];e&&(i.structureName=e)}return{...I}}function lg({drawDefinition:e,timeItem:t}){if(!e)return{error:A};if(!t)return{error:Zt};let r=t&&Object.keys(t),i=["itemType","itemValue"];if(i.filter((e=>r.includes(e))).length!==i.length)return{error:Jt};e.timeItems||(e.timeItems=[]);let n=(new Date).toISOString();return Object.assign(t,{createdAt:n}),e.timeItems.push(t),nu({drawDefinition:e}),{...I}}function pg(e){let{tournamentRecord:t,drawDefinition:r,structureId:i,event:n}=e,a=xn(e,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let o=r.structures??[],s=o.find((e=>e.structureId===i));if(!s)return{error:ae};let c=o.find((({stage:e,stageSequence:t})=>e===Is&&1===t)),u=i===c?.structureId,d=o.filter((({stage:e})=>e===Us)).map(fm("structureId"));if(u&&!d.length)return{error:S};let l=d.includes(i),p=function({isQualifyingStructure:e,tournamentRecord:t,drawDefinition:r,structureId:i,structure:n,event:a,force:o}){let s=[i];if(e){let e=e=>r.links?.find((t=>t.target.structureId===e)),t=e(i)?.source.structureId;for(;t;)s.push(t),t=e(t)?.source.structureId}if(am({matchUpFilters:{structureIds:s},drawDefinition:r}).matchUps?.some((({score:e})=>Um({score:e})))){let e=Yu({tournamentRecord:t,drawDefinition:r,structure:n,event:a})?.appliedPolicies;if(!(o??e?.[_a]?.allowDeletionWithScoresPresent?.structures))return{error:Nr}}return{...I}}({isQualifyingStructure:l,structure:s,...e});if(p?.error)return p;let{structureIdsToRemove:m,relatedStructureIdsMap:f}=function({qualifyingStructureIds:e,isQualifyingStructure:t,isMainStageSequence1:r,mainStageSequence1:i,drawDefinition:n,structureId:a}){let o=(n.structures??[]).map(fm("structureId")),s=e=>n.links?.map((t=>t.source.structureId===e&&t.target.structureId!==i?.structureId&&t.target.structureId)).filter(Boolean)??[],c=t=>n.links?.map((r=>e.includes(r.source.structureId)&&r.target.structureId===t&&r.source.structureId)).filter(Boolean)??[],u=new Map;return o.forEach((e=>u.set(e,t?c(e):s(e)))),{structureIdsToRemove:r?u.get(a):[a],relatedStructureIdsMap:u}}({qualifyingStructureIds:d,isQualifyingStructure:l,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:r,structureId:i}),{removedMatchUpIds:h,removedStructureIds:g}=function({relatedStructureIdsMap:e,qualifyingStructureIds:t,isMainStageSequence1:r,mainStageSequence1:i,drawDefinition:n,structureIdsToRemove:a,structureId:o}){let s=[],c=[];for(;a?.length;){let u=a.pop();c.push(...hg({idBeingRemoved:u,drawDefinition:n}));let d=fg({qualifyingStructureIds:t,isMainStageSequence1:r,idBeingRemoved:u,drawDefinition:n,structureId:o});s.push(...d.removedStructureIds);let l=mg({relatedStructureIdsMap:e,mainStageSequence1:i,idBeingRemoved:u,structureId:o});l?.length&&a.push(...l)}return{removedMatchUpIds:c,removedStructureIds:s}}({relatedStructureIdsMap:f,qualifyingStructureIds:d,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:r,structureIdsToRemove:m,structureId:i});if(function({removedMatchUpIds:e,drawDefinition:t}){let{matchUps:r}=am({drawDefinition:t});r?.forEach((t=>{t.winnerMatchUpId&&e.includes(t.winnerMatchUpId)&&delete t.winnerMatchUpId,t.loserMatchUpId&&e.includes(t.loserMatchUpId)&&delete t.loserMatchUpId}))}({removedMatchUpIds:h,drawDefinition:r}),u){let e=(c.matchUps??[])?.map(fm("matchUpId"));h.push(...e),c.positionAssignments=[],c.seedAssignments=[],c.matchUps=[],c.extensions&&(c.extensions=[])}return l&&ng({drawDefinition:r}),ru({tournamentId:t?.tournamentId,matchUpIds:h,action:"removeStructure",eventId:n?.eventId,drawDefinition:r}),au({drawDefinition:r,eventId:n?.eventId}),{...I,removedMatchUpIds:h,removedStructureIds:g}}function mg({idBeingRemoved:e,relatedStructureIdsMap:t,mainStageSequence1:r,structureId:i}){return e&&t.get(e)?.filter((e=>e!==r?.structureId||i===r.structureId))}function fg({qualifyingStructureIds:e,isMainStageSequence1:t,idBeingRemoved:r,drawDefinition:i,structureId:n}){let a=[];return i.links=i.links?.filter((e=>e.source.structureId!==r&&e.target.structureId!==r))??[],(!t||t&&e.length||r!==n)&&(i.structures=(i.structures??[]).filter((e=>(r&&r===e.structureId&&a.push(r),e.structureId!==r)))),{removedStructureIds:a}}function hg({idBeingRemoved:e,drawDefinition:t}){let{structure:r}=yc({structureId:e,drawDefinition:t}),i=Kp({structure:r}).matchUps;return Bo(i)}function gg({stageSequence:e=1,drawDefinition:t,drawSize:r,stage:i}){if(!t)return{error:M};if(!Rd({drawDefinition:t,stage:i}))return{error:Ie};let n=function({stage:e,drawDefinition:t}){return Pd.reduce(((r,i)=>(Md({drawDefinition:t,entryStatus:i,stage:e})||0)+r),0)}({drawDefinition:t,stage:i}),{qualifiersCount:a}=rf({drawDefinition:t,stageSequence:e,stage:i});if(r<n+a)return{error:$};let{entryProfile:o}=od({attributes:[{[i]:{drawSize:r}}],drawDefinition:t});return au({drawDefinition:t}),{...I,entryProfile:o}}function Ig({qualifiersCount:e=0,drawDefinition:t,stage:r}){return t?Rd({drawDefinition:t,stage:r})?r!==Is?{error:$,info:"qualifiersCount can only be set for main stage"}:(od({attributes:[{[r]:{qualifiersCount:e}}],drawDefinition:t}),au({drawDefinition:t}),{...I}):{error:Ie}:{error:M}}function Ug(e){return function({drawDefinition:e,drawSize:t}){if(!e)return{error:M};let r=gg({stage:ys,stageSequence:1,drawDefinition:e,drawSize:t});return r.error?r:(au({drawDefinition:e}),{...I})}(e)}function vg({tournamentRecord:e,drawDefinition:t,participantId:r,structureId:i}){let n="removeSeededParticipant";if(!e)return{error:D};if(!t)return{error:M};let a=(t.structures??[]).find((e=>e.structureId===i));return a?!a.stage||![Is,Us].includes(a.stage)||a.stage===Is&&1!==a.stageSequence?en({result:{error:E},stack:n}):a.seedAssignments?.find((e=>e.participantId===r))?{...I}:en({info:"participant not seeded",result:{error:vr},context:{participantId:r}}):en({result:{error:ae},stack:n})}function yg({targetEntryRound:e=1,finishingPositions:t,sourceRoundNumber:r,sourceStructureId:i,targetStructureId:n,linkType:a=_s}){return i&&n?{link:Zi({linkType:a,source:{roundNumber:r,structureId:i,finishingPositions:t},target:{feedProfile:Cs,roundNumber:e,structureId:n}})}:{error:ne}}function Sg({roundPosition:e,roundNumber:t,idPrefix:r,uuids:i}){return r?`${r}-${t}-${e}`:i?.pop()||Jl()}function wg({includeMatchUpType:e,matchUpType:t,roundNumber:r,matchUps:i,idPrefix:n,isMock:a,uuids:o,nodes:s}){let c=0,u=[],d=1,l=r-1,p=s?.length;for(;c<(p||0);){let p=s?.[c],m=s?.[c+1];l&&(p.roundNumber=l),m&&l&&(m.roundNumber=l);let f={roundPosition:d,children:[p,m],matchUpId:Sg({roundPosition:d,roundNumber:r,idPrefix:n,uuids:o})};u.push(f);let h={drawPositions:f.children.map((e=>e?.drawPosition)).filter(Boolean),matchUpStatus:os,matchUpId:f.matchUpId,roundPosition:d,roundNumber:r};e&&t&&(h.matchUpType=t),a&&(h.isMock=!0),i.push(h),d++,c+=2}return{roundNodes:u,matchUps:i}}function Pg({finishingPositionOffset:e,finishingPositionLimit:t,qualifyingRoundNumber:r,qualifyingPositions:i,matchUpType:n,roundLimit:a,idPrefix:o,drawSize:s,isMock:c,uuids:u}){if(isNaN(s)||s<2||i&&s<=i)return{matchUps:[],roundsCount:0};if(i&&(!_r(s)||s%i)){let e=i;for(;e<s;)e*=2;s=e}let d=i&&!(s%2)&&(!isNaN(i)||r&&!isNaN(r))&&(s/i===Math.round(s/i)||r&&s/r===Math.round(s/r));if(!_r(s)&&!d)return{matchUps:[],roundsCount:0};let l,p=ai(1,s+1).map((e=>({drawPosition:e}))),m=[],f=1;for(({roundNodes:l,matchUps:m}=wg({matchUpType:n,roundNumber:f,idPrefix:o,matchUps:m,isMock:c,nodes:p,uuids:u})),f++,a=a??r;l.length>1;)i&&l.length===i&&(a=f-1),({roundNodes:l,matchUps:m}=wg({nodes:l,matchUpType:n,roundNumber:f,idPrefix:o,matchUps:m,isMock:c,uuids:u})),f++;let h=f-1;return m=hm({finishingPositionOffset:e,finishingPositionLimit:t,roundsCount:h,roundLimit:a,matchUps:m}),a?m=m.filter((e=>a&&(e.roundNumber??0)<=a)):a=f-1,{drawSize:s,matchUps:m,roundsCount:h,roundLimit:a}}function Dg(e){let t="generateQualifyingStructure";if(!e.drawDefinition)return en({result:{error:M},stack:t});if(e.drawSize&&!Wr(e.drawSize)||e.participantsCount&&!Wr(e.participantsCount)||e.qualifyingPositions&&!Wr(e.qualifyingPositions))return en({result:{error:mr},stack:t});let r=e.drawSize??Vr(e.participantsCount),{qualifyingRoundNumber:i,qualifyingPositions:n,targetStructureId:a,structureOptions:o,appliedPolicies:s,drawDefinition:c,matchUpFormat:u,structureName:d,structureId:l,roundTarget:p,drawType:m,idPrefix:f,isMock:h,uuids:g}=e;if(!e.drawSize)return en({result:{error:W},context:{drawSize:r},stack:t});if(n&&n>=e.drawSize)return en({result:{error:mr},context:{drawSize:r,qualifyingPositions:n},stack:t});let U,v,y,S,w,P=0,{structureProfiles:D}=ig({drawDefinition:c}),T=D[a];if(!T)return en({result:{error:ae},context:{targetStructureId:a},stack:t});let b=c.matchUpType,R=p?`${p}-`:"",N=T.stage===Us,A=s?.[Ca]?.namingConventions?.pre??Rp[Ca]?.namingConventions?.pre,E=N&&A?`${A}-`:"",C=d??(R?`${E}${Of(Us)} ${R}`:`${E}${Of(Us)}`);if(m===sc){let{maxRoundNumber:e,structures:t,groupCount:i}=jf({structureName:d??C,structureId:l??g?.pop(),stage:Us,structureOptions:o,appliedPolicies:s,stageSequence:1,matchUpType:b,roundTarget:p,idPrefix:f,drawSize:r,isMock:h,uuids:g});P=i,U=e,y=t[0],w=[1]}else({drawSize:r,matchUps:S,roundLimit:U,roundsCount:v}=Pg({qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:b,idPrefix:f,drawSize:r,isMock:h,uuids:g})),U||(U=v),y=kf({structureName:d??C,structureId:l??g?.pop(),qualifyingRoundNumber:U,stage:Us,matchUpFormat:u,stageSequence:1,matchUpType:b,roundLimit:U,matchUps:S}),p&&za({extension:{name:Po,value:p},element:y}),P=S?.filter((e=>e.roundNumber===U))?.length;let O=m===sc?xs:_s,F=y&&U&&yg({sourceStructureId:y.structureId,sourceRoundNumber:U,targetStructureId:a,finishingPositions:w,linkType:O})?.link;return{qualifyingDrawPositionsCount:r,qualifiersCount:P,...I,structure:y,link:F}}function Tg(e){let t=e.tournamentRecord;if(!t)return{error:D};let r=function(e){if(!e.drawDefinition)return{error:M};if(!e.targetStructureId)return{error:ne};let t=Dg(e);if(t.error)return t;let{structure:r,link:i}=t;return r&&i?ug({tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,structure:r,link:i}):{error:mr}}(e);if(r.error)return r;let{qualifyingRoundNumber:i,qualifyingPositions:n,targetStructureId:a,drawDefinition:o,structureName:s,matchUpType:c,drawSize:u,drawType:d}=e;return sg({tournamentRecord:t,timeItem:{itemType:"addQualifyingStructures",itemValue:Zi({drawId:o.drawId,qualifyingRoundNumber:i,qualifyingPositions:n,targetStructureId:a,structureName:s,matchUpType:c,drawSize:u,drawType:d})}}),r}function bg({includeMatchUpType:e,drawPosition:t,roundNumber:r,matchUpType:i,idPrefix:n,matchUps:a,isMock:o,uuids:s,nodes:c,fed:u}){let d=c.length,l=t?t-d:void 0,p=ai(0,d).map((e=>l?l+e:void 0)),m=[];for(let f=0;f<d;f++){let t=p.shift(),d={drawPosition:t,fed:u+1,feed:!0},l=c[f];l.roundNumber=r-1;let h=Sg({roundPosition:l.roundPosition,roundNumber:r,idPrefix:n,uuids:s}),g={roundPosition:l.roundPosition,drawPositions:[t],matchUpStatus:os,roundNumber:r,matchUpId:h};e&&(g.matchUpType=i),o&&(g.isMock=!0),a.push(g);let I={children:[l,d]};m.push(I)}return{roundNodes:m,matchUps:a,drawPosition:t?t-d:void 0}}function Rg(e){let t=e.drawSize,{feedRoundsProfile:r,feedRounds:i=0,skipRounds:n=0,baseDrawSize:a}=e,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:c,feedsFromFinal:u,isConsolation:d,matchUpType:l,idPrefix:p,isMock:m,uuids:f,fmlc:h}=e;a=a??function(e){let t=Br(e);return t>e?t/2:t}(t);let g=function({drawSize:e}){let t=Math.ceil(Math.log(e)/Math.log(2));return ai(0,t).reverse().map((e=>Math.pow(2,e)))}({drawSize:a}),I=g.length,U=0;if(r?.length)U=r.reduce(((e,t)=>e+t),0);else if(t){let e=t-a;r=g.filter((t=>t<=e&&(e-=t,!0))),U=r.reduce(((e,t)=>e+t),0),i=r.length}else n>=I?i=0:u&&(i=I-u,n=0),r=g.filter(((e,t)=>u&&!i||i&&t>=n+i||t<n?0:e)),U=r.reduce(((e,t)=>e+t),0),i=r.length;let v=[...g,...r].sort(((e,t)=>t-e)),y=v.length,S=[...(c??[]).map((e=>e-1)),...(o??[]).map((e=>y-e))].map((e=>v[e])).reduce(((e,t)=>e+t),0);U-=S;let w,P=0,D=[],T=1,b=ai(0,a).map(((e,t)=>({drawPosition:t+1+U}))),R=U+1;for(let N of g){if(({roundNodes:w,matchUps:D}=wg({matchUpType:l,roundNumber:T,idPrefix:p,matchUps:D,isMock:m,nodes:b,uuids:f})),T++,r.includes(N)){let e=ai(0,Xr(r)[N]),t=y+1-T,i=o?.includes(t)??c?.includes(T);e.forEach((()=>{({roundNodes:w,matchUps:D,drawPosition:R}=bg({drawPosition:!i&&R||void 0,nodes:w,matchUpType:l,roundNumber:T,idPrefix:p,matchUps:D,isMock:m,uuids:f,fed:P})),T++,P+=1}))}b=w}y!==T-1&&console.log("ERROR"),D=hm({finishingPositionOffset:d?a-U:s,positionsFed:U,roundsCount:y,matchUps:D,fmlc:h});let M=w?.length?w[0]:w;return M&&(M.roundNumber=T-1,M.matchUps=D),{draw:M,matchUps:D,roundsCount:y}}function Mg(e){let{finishingPositionOffset:t=0,addNameBaseToAttributeName:r,playoffStructureNameBase:i,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:c="0",exitProfileLimit:u,roundOffsetLimit:d,roundOffset:l=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:f,stage:h=Is,drawSize:g,idPrefix:U,isMock:v,uuids:y}=e;if(o&&u&&!o?.[c]||g<2||f&&s>f)return{};let S=[],w=[],P=[],D=e.matchUpType??p?.matchUpType,T=t+1,b=`${T}-${t+g}`,R=o?.[c],M=i&&`${i} `||"",N=o?.[b]??n?.[b],A=e.structureName||N?.name||R?.name&&(r?`${M}${R?.name}`:R.name)||`${M}${b}`,E=N?.abbreviation??R?.abbreviation,C=e.structureId??R?.structureId??y?.pop(),O={idPrefix:U&&`${U}-${A}-RP`,finishingPositionOffset:t,matchUpType:D,drawSize:g,isMock:v,uuids:y},{matchUps:F}=m?Rg(O):Pg(O),k=kf({structureAbbreviation:E,stageSequence:s,structureName:A,matchUpType:D,roundOffset:l,structureId:C,matchUps:F,stage:h});S.push(...F),w.push(k);let x=Math.ceil(Math.log(g)/Math.log(2)),_=d?Math.min(d-l,x):!a||T<a?x:0;return g>2&&ai(1,_+1).forEach((e=>function(e){let m=g/Math.pow(2,e);if(m<2)return;let I=g/Math.pow(2,e)+t;if(a&&I+1>a)return;let{structures:v,structureId:T,matchUps:b,links:R}=Mg({finishingPositionOffset:I,exitProfile:`${c}-${e}`,roundOffset:l+e,stageSequence:s+1,drawSize:m,addNameBaseToAttributeName:r,playoffStructureNameBase:i,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:d,drawDefinition:p,sequenceLimit:f,matchUpType:D,idPrefix:U,uuids:y,stage:h});if(k.structureId&&T){let t={linkType:Ls,source:{roundNumber:e,structureId:k.structureId},target:{roundNumber:1,feedProfile:Fs,structureId:T}};R&&k&&R.push(t),R?.length&&P.push(...R)}return v?.length&&w.push(...v),b?.length&&S.push(...b),{structureId:T,childLinks:R,structures:w}}(e))),{structureId:k.structureId,matchUps:S,structureName:A,structures:w,links:P,...I}}function Ng({drawDefinition:e,matchUpsMap:t,structureId:r}){let i=yc({drawDefinition:e,structureId:r});if(i.error)return en({result:i});let{matchUps:n}=Kp({structure:i.structure,matchUpsMap:t});return{...Up({matchUps:n}),matchUps:n,matchUpsMap:t}}function Ag({finishingPositions:e,drawDefinition:t,structureId:r}){let{roundProfile:i}=Ng({drawDefinition:t,structureId:r});return(i&&Object.keys(i))?.reduce(((t,r)=>(Eg(i?.[r]).forEach((i=>{e.forEach((e=>{(function({position:e,rangeDefinition:t}){if(!Array.isArray(t)||t.reduce(((e,t)=>e||isNaN(t)),!1))return!1;let[r,i]=t;return ai(r,(i||r)+1).includes(e)})({position:e,rangeDefinition:i})&&(t[e]={roundNumber:r})}))})),t)),{})}function Eg(e){return[Yr(e?.finishingPositionRange?.loser||[]),Yr(e?.finishingPositionRange?.winner||[])]}function Cg(e){return Eg(e).map((e=>ai(e[0],e[1]&&e[1]+1||e[0]+1)))}function Og({drawDefinition:e,structureIds:t,matchUpsMap:r}){if(t&&!Array.isArray(t))return{error:mr,context:{structureIds:t}};if(!e)return{error:M};let i=(t=t??(e.structures??[]).filter((e=>e.stage!==Us)).map((({structureId:e})=>e))).map((t=>{let{roundProfile:i}=Ng({drawDefinition:e,matchUpsMap:r,structureId:t});return(i&&Object.values(i))?.map(Cg).flat()})).flat(),n=i.filter((e=>1===e?.length)).sort(kr).flat();return{positionsNotPlayedOff:Yr(i.flat()).filter((e=>!n.includes(e))),positionsPlayedOff:n}}function Fg({excludeRoundNumbers:e=[],playoffPositions:t=[],drawDefinition:r,structureId:i}){if(!r)return{error:M};if(!i)return{error:ne};if(!t)return{error:He,info:"missing playoffPositions"};let n=Og({drawDefinition:r});if(n.error)return n;let a=n.positionsPlayedOff,o=Ag({finishingPositions:t.filter((e=>!a.includes(e))),drawDefinition:r,structureId:i}),s=Object.values(o).reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>xr(e))).filter((t=>!e.includes(t))),c=Ag({finishingPositions:a,drawDefinition:r,structureId:i}),u=c?Object.values(c):[],d=c?u.reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>xr(e))):[],l=s.filter((e=>!d.includes(e))).sort(kr),{roundProfile:p}=Ng({drawDefinition:r,structureId:i}),m=l.map((e=>{let t=p?.[e].finishingPositionRange.loser,[r,i]=t??[0,0];return ai(r,(i||r)+1)})).flat().sort(kr),{playoffRoundsRanges:f}=function({playoffSourceRounds:e,roundProfile:t}){return{playoffRoundsRanges:e.map((e=>{let r=t[e].finishingPositionRange.loser,[i,n]=r,a=ai(i,(n||i)+1);return{finishingPositionRange:r.join("-"),finishingPositions:a,roundNumber:e}}))}}({playoffSourceRounds:l,roundProfile:p}),h=[...l,...d];return{playoffPositionsReturned:m,playedOffSourceRounds:d,playoffRoundsRanges:f,playoffSourceRounds:l,sourceRounds:h,roundProfile:p}}function kg({drawDefinition:e,structureId:t}){if(!e)return{error:M};let{matchUps:r,matchUpsMap:i}=lm({inContext:!0,drawDefinition:e}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=Og({drawDefinition:e,matchUpsMap:i}),{structures:o}=Sc({drawDefinition:e}),s=o.filter((e=>!t&&e.stage!==ys||e.structureId===t)),c={};for(let u of s){let t=u?.structureId,i=xg({playoffPositions:n,drawDefinition:e,structure:u,matchUps:r}),{error:a,...o}=i;if(a)return i;c[t]={structureId:t,...o}}return t?{positionsPlayedOff:a,...c[t]}:{availablePlayoffProfiles:Object.values(c),availablePlayoffRounds:Object.values(c),positionsPlayedOff:a}}function xg({playoffPositions:e,drawDefinition:t,structure:r,matchUps:i}){let n=r?.structureId,{links:a}=Zp({drawDefinition:t,structureId:n});if(r.structureType===Es||r.structures){let e=Pc({structure:r})?.positionAssignments?.length,o=r.structures.length,s=(e??0)/o,c=a.source?.flatMap((({source:e})=>e?.finishingPositions||[]))||[],u=ai(1,s+1).filter((e=>!c.includes(e))),d=i.find((e=>e.containerStructureId===n&&e.finishingPositionRange))?.finishingPositionRange?.winner||[0,1],l=a?.source.map((({target:e})=>e.structureId)),{positionsPlayedOff:p=[],positionsNotPlayedOff:m=[]}=Og({structureIds:l,drawDefinition:t}),f=[...p,...m],h=ai(d[0],d[1]+1).filter((e=>!f.includes(e))),g=pi(h,h.length/u.length);return{positionsNotPlayedOff:h,playoffFinishingPositionRanges:u.map(((e,t)=>{let r=g[t];return{finishingPosition:e,finishingPositions:r,finishingPositionRange:[Math.min(...r||[]),Math.max(...r||[])].join("-")}})),finishingPositionsAvailable:u,finishingPositionsPlayedOff:c,positionsPlayedOff:p,groupCount:o,groupSize:s}}let o=a?.source?.filter((e=>e.linkCondition!==Vs)).map((e=>e.source?.roundNumber))||[],s=a?.source?.filter((e=>e.linkCondition===Vs)).map((e=>e.source?.roundNumber))||[],c=Fg({excludeRoundNumbers:o,playoffPositions:e,drawDefinition:t,structureId:n}),u=c?.playoffSourceRounds?[...c?.playoffSourceRounds||[]]:void 0,d=[...c?.playoffRoundsRanges||[]],{roundProfile:l,error:p}=c;for(let m of s){let e=a?.source.find((e=>e.source.roundNumber===m)),t=e?.target.roundNumber,r=e?.target.structureId,n=i.filter((({roundNumber:e,structureId:i})=>i===r&&e===t)),o=n.filter((({sides:e})=>e.find((e=>e.participantFed&&!e.participantId)))).length;if(u&&o===n.length){u.push(m);let e=l?.[m]?.finishingPositionRange?.loser;if(e){let t=Math.min(...e),r=t+o,i=ai(t,r),n={finishingPositionRange:[t,r-1].join("-"),finishingPositions:i,roundNumber:m};d.push(n)}}}return u&&u.sort(kr),d.sort(((e,t)=>e.roundNumber-t.roundNumber)),{playoffRounds:u,playoffRoundsRanges:d,error:p}}function _g(e){let{finishingPositionOffset:t=0,playoffAttributes:r,stageSequence:i=1,staggeredEntry:n,structureName:a,stage:o=Is,matchUpType:s,structureId:c,idPrefix:u,drawSize:d,isMock:l,uuids:p}=e,m={finishingPositionOffset:t,matchUpType:s,drawSize:d,idPrefix:u,isMock:l,uuids:p},{matchUps:f}=n?Rg(m):Pg(m),h=kf({structureName:a||r?.[0]?.name||Of(Is),structureId:c||p?.pop(),stageSequence:i,matchUpType:s,matchUps:f,stage:o}),g=[h],U=[];if(d>2){let i=d/2,{matchUps:n}=Pg({finishingPositionOffset:t+i,idPrefix:u&&`${u}-c`,drawSize:i,matchUpType:s,isMock:l}),o=Of(vs),c=r?.["0-1"]?.name??e.consolationStructureName??(a?`${a} ${o}`:o),m=kf({structureName:c,matchUps:n,structureId:p?.pop(),stage:vs,stageSequence:1,matchUpType:s});g.push(m);let f={linkType:Ls,source:{roundNumber:1,structureId:h.structureId},target:{roundNumber:1,feedProfile:Fs,structureId:m.structureId}};U.push(f)}return{...I,structures:g,links:U}}function Lg({consolationStructure:e,roundOffset:t=0,mainStructure:r,roundsCount:i,feedPolicy:n,fmlc:a}){let o=e.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),s=n?.roundGroupedOrder||[],c=n?.roundFeedProfiles;return ai(1+t,i+1+t).map((i=>{let n=c&&c[i-1]?c[i-1]:i%2?Fs:ks,u=i-t<=2?i-t:2*(i-t-2)+2,d={linkType:Ls,source:{roundNumber:i,structureId:r.structureId},target:{feedProfile:n,roundNumber:u,structureId:e.structureId}},l=s[i-1];return l&&(d.target.groupedOrder=l),wi()&&(d.source.structureName=r.structureName,d.target.structureName=e.structureName),2===i&&a&&(d.linkCondition=Vs,d.target.feedProfile=Fs),o.includes(u)?d:void 0})).filter(Boolean)}function Vg(e){let{playoffStructureNameBase:t,finishingPositionOffset:r,stageSequence:i=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:o,stage:s=Is,matchUpType:c,structureId:u,drawSize:d,idPrefix:l,isMock:p,uuids:m}=e,f={finishingPositionOffset:r,matchUpType:c,drawSize:d,idPrefix:l,isMock:p,uuids:m},{matchUps:h,roundsCount:g}=o?Rg(f):Pg(f),U=e.structureName??n?.[0]?.name??Of(Is),v=Ff({structureId:u||m?.pop(),structureName:U,stageSequence:i,matchUpType:c,matchUps:h,stage:s}),y=[v],S=[];if(d>2){let e=[0,2].slice(0,d/16).map(((e,r)=>{let i=r+1,{consolationStructure:o}=function({playoffStructureNameBase:e,stageSequence:t=1,playoffAttributes:r,structureNameMap:i,roundOffset:n=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:c,isMock:u,index:d,uuids:l}){let p=c/(2*Math.pow(2,n)),{matchUps:m,roundsCount:f}=Rg({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:l}),h=0===d&&r?.["0-1"]?.name||1===d&&r?.["0-3"]?.name||`${Of(vs)} ${d+1}`,g=i?.[h]||h,I=e?`${e} ${g}`:g;return{consolationStructure:Ff({matchUps:m,stage:vs,structureName:I,stageSequence:t,matchUpType:a,structureId:o}),consolationRoundsCount:f}}({idPrefix:l&&`${l}-c${r}`,structureId:m?.pop(),playoffStructureNameBase:t,playoffAttributes:n,structureNameMap:a,stageSequence:i,roundOffset:e,matchUpType:c,drawSize:d,isMock:p,index:r,uuids:m});return y.push(o),{consolationStructure:o,links:Lg({consolationStructure:o,roundsCount:2,mainStructure:v,roundOffset:e})}})).map((e=>e.links)).flat();if(S.push(...e),d>=4&&d<=16||d>32){let{matchUps:e}=Pg({idPrefix:l&&`${l}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:c,isMock:p}),r=n?.["3-4"]?.name??Of(Ss),i=a?.[r]||r,o=t?`${t} ${i}`:i,s=Ff({structureId:m?.pop(),matchUps:e,stageSequence:2,stage:Ss,structureName:o,matchUpType:c}),u={linkType:Ls,source:{roundNumber:g-1,structureId:v.structureId},target:{structureId:s.structureId,feedProfile:Fs,roundNumber:1}};y.push(s),S.push(u)}}return{structures:y,links:S,...I}}function Bg(e){let{finishingPositionOffset:t,stageSequence:r=1,playoffAttributes:i,feedsFromFinal:n,staggeredEntry:a,structureName:o,stage:s=Is,structureId:c,matchUpType:u,skipRounds:d,feedRounds:l,idPrefix:p,drawSize:m,isMock:f,uuids:h,fmlc:g}=e,U=e.feedPolicy||e.policyDefinitions?.[Va]||e.appliedPolicies?.[Va],v={finishingPositionOffset:t,matchUpType:u,skipRounds:d,drawSize:m,idPrefix:p,isMock:f,uuids:h},{matchUps:y}=a?Rg(v):Pg(v),S=kf({structureName:o||i?.[0]?.name||Of(Is),structureId:c||h?.pop(),stageSequence:r,matchUpType:u,matchUps:y,stage:s}),w=[S],P=[],D=m/2,{matchUps:T,roundsCount:b}=Rg({finishingPositionOffset:D,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:D,matchUpType:u,feedRounds:l,skipRounds:d,isMock:f,uuids:h,fmlc:g});if(m>2){let t=i?.["0-1"]?.name??Of(vs),r=e.playoffStructureNameBase?`${e.playoffStructureNameBase} ${t}`:t,n=kf({matchUps:T,structureId:h?.pop(),stage:vs,stageSequence:1,structureName:r,matchUpType:u});w.push(n);let a=Lg({consolationStructure:n,mainStructure:S,roundsCount:b,feedPolicy:U,fmlc:g});P.push(...a)}return{...I,structures:w,links:P}}function jg({requireSequential:e=!0,playoffMatchUpFormat:t,playoffAttributes:r,sourceStructureId:i,policyDefinitions:n,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:c,feedPolicy:u,groupCount:d,idPrefix:l,isMock:p,uuids:m}){u=u||n?.[Va];let f="processPlayoffGroups",h=0,g=[],I=[],U=[],{error:v,positionRangeMap:y}=function({playoffGroups:e,drawDefinition:t,structureId:r}){if(!t)return{error:M};if("string"!=typeof r||!Array.isArray(e))return{error:mr};let i=e.map((({finishingPositions:e})=>e)).flat();return{positionRangeMap:kg({drawDefinition:t,structureId:r}).playoffFinishingPositionRanges?.filter((e=>i.includes(e.finishingPosition)))?.reduce(((e,t)=>(e[t.finishingPosition]=t,e)),{})}}({structureId:i,drawDefinition:o,playoffGroups:s});if(v)return en({result:{error:v},stack:f});if(y&&!s?.every((t=>{let{finishingPositions:r=[]}=t;if(!r.length)return!1;let i=[...r].sort(kr).map(((e,t)=>(r[t+1]||e)-e)).every((e=>e<2));return(!e||i)&&r.every((e=>y[e]))})))return en({context:{validFinishingPositions:Object.values(y)},result:{error:mr},stack:f});for(let S of s){let e=S.finishingPositions,o=y&&e.map((e=>y[e]?.finishingPositions)).flat(),s=d*e.length,f=qr(s),v=2===f&&$s||S.drawType||$s;o&&(h=Math.min(...o)-1);let w=o&&`${Math.min(...o)}-${Math.max(...o)}`,P=S.structureName||w&&S.playoffAttributes?.[w]?.name||S.playoffAttributes?.[0]?.name,D={addNameBaseToAttributeName:S.addNameBaseToAttributeName,playoffStructureNameBase:S.playoffStructureNameBase,finishingPositionNaming:S.finishingPositionNaming,finishingPositionLimit:S.finishingPositionLimit,structureId:S.structureId??m?.pop(),playoffAttributes:S.playoffAttributes,structureNameMap:S.structureNameMap,sequenceLimit:S.sequenceLimit,structureName:P,idPrefix:l&&`${l}-po`,appliedPolicies:n,finishingPositionOffset:h,stage:Ss,stageSequence:a,matchUpType:c,drawSize:f,isMock:p,uuids:m},T=({playoffStructures:t,playoffLinks:r})=>{let[n]=t,a=Gg({playoffStructureId:n.structureId,finishingPositions:e,sourceStructureId:i});U.push(a),U.push(...r),I.push(...t),g.push({structureId:n.structureId,finishingPositions:e}),h+=s};if(v===$s){let{matchUps:r}=Pg({finishingPositionLimit:h+s,idPrefix:l&&`${l}-po`,finishingPositionOffset:h,matchUpType:c,drawSize:f,isMock:p,uuids:m}),n=kf({structureId:S.structureId??m?.pop(),matchUpFormat:t,stage:Ss,structureName:P,stageSequence:a,matchUps:r});I.push(n);let o=Gg({playoffStructureId:n.structureId,finishingPositions:e,sourceStructureId:i});U.push(o),h+=s,g.push({structureId:n.structureId,finishingPositions:e})}else if([Gs,qs,Ss].includes(v)){let t={playoffAttributes:S.playoffAttributes??r,playoffStructureNameBase:S.playoffStructureNameBase,structureId:S.structureId??m?.pop(),structureName:S.structureName,idPrefix:l&&`${l}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:h,stage:Ss,roundOffset:0,stageSequence:a,drawSize:f,isMock:p,uuids:m};v===Gs?Object.assign(t,{playoffAttributes:S?.playoffAttributes??r??lc,roundOffsetLimit:3}):v===qs&&Object.assign(t,{playoffAttributes:S?.playoffAttributes??r??pc,roundOffsetLimit:2});let n=Mg(t);if(n.error)return n;if(n.links?.length&&U.push(...n.links),n.structures?.length&&I.push(...n.structures),I.sort(Uc),n.structureId){let t=Gg({playoffStructureId:n.structureId,finishingPositions:e,sourceStructureId:i});U.push(t),g.push({structureId:n.structureId,finishingPositions:e})}h+=s}else if([Hs,ac,rc,ec,Xs,nc].includes(v)){let t=[m?.pop(),m?.pop()],r={playoffStructureNameBase:S.playoffStructureNameBase,structureId:S.structureId??m?.pop(),playoffAttributes:S.playoffAttributes,idPrefix:l&&`${l}-po`,finishingPositionOffset:h,uuids:t,stage:Ss,structureName:P,matchUpType:c,feedPolicy:u,drawSize:f,isMock:p},n={[Hs]:{fmlc:!0,feedRounds:1},[nc]:{feedRounds:1},[rc]:{feedsFromFinal:3},[ec]:{feedsFromFinal:2},[Xs]:{feedsFromFinal:1}};Object.assign(r,n[v]||{});let{structures:a,links:o}=Bg(r),[d]=a,y=Gg({playoffStructureId:d.structureId,finishingPositions:e,sourceStructureId:i});U.push(y),U.push(...o),I.push(...a),g.push({structureId:d.structureId,finishingPositions:e}),h+=s}else if([sc].includes(v)){let{structures:e,links:t}=jf({...D,structureOptions:S.structureOptions||{groupSize:4}});T({playoffStructures:e,playoffLinks:t})}else if([zs].includes(v)){let{structures:e,links:t}=_g(D);T({playoffStructures:e,playoffLinks:t})}else if([Qs].includes(v)){let{structures:e,links:t}=Vg(D);T({playoffStructures:e,playoffLinks:t})}else if([Bs].includes(v)){T({playoffStructures:[kf({structureId:S.structureId??m?.pop(),structureName:S.structureName,finishingPosition:td,stage:Ss,stageSequence:a,matchUps:[]})],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:y,structures:I,links:U}}function Gg({playoffStructureId:e,finishingPositions:t,sourceStructureId:r}){return{linkType:xs,source:{structureId:r,finishingPositions:t},target:{structureId:e,feedProfile:Cs,roundNumber:1}}}function qg({matchUp:e,tieFormat:t,isMock:r,uuids:i}){let{collectionDefinitions:n}=t??{};return{tieMatchUps:(n??[]).map((t=>$g({matchUp:e,collectionDefinition:t,uuids:i,isMock:r}))).filter(Boolean).flat()}}function $g({collectionPositionOffset:e=0,collectionDefinition:t,matchUpsLimit:r,matchUp:i,isMock:n,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:c,processCodes:u}=t||{},d=e=>{if(!n&&!i?.isMock)return a?.pop()??Jl();let r=t?.collectionId;return a?.pop()??`${i?.matchUpId}-${r}-TMU-${e+1}`};return ai(0,r??o??0).map((t=>{let r=e+t+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(t),matchUpStatus:os,collectionPosition:r,collectionId:c,processCodes:u,matchUpType:s,isMock:n}}))}function Wg({value:e,sourceRange:t,targetRange:r}){let i=Math.min(...t),n=Math.max(...t),a=Math.min(...r);return(e-i)*(Math.max(...r)-a)/(n-i)+a}var Hg="ELO",zg="NTRP",Yg="WTN",Kg={ELO:Hg,NTRP:zg,TRN:"TRN",UTR:"UTR",WTN:Yg},Qg={[Hg]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[zg]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[Yg]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}};function Jg({targetRatingType:e,sourceRating:t}){let r=Qg[e].decimalsCount||0,i=Qg[e].range,n=i[0]>i[1],a=Math.max(...i),o=Wg({targetRange:i,sourceRange:Qg[Hg].range,value:t}),s=parseFloat(o.toFixed(r));return n?a-s:s}function Xg(e){let t=xn(e,[{ratings:!0,[En]:bn}]);if(t.error)return t;let r=e.matchUpType&&[mu,hu].includes(e.matchUpType)?e.matchUpType:mu,i=Object.keys(Qg),n=e.targetRatingType&&i.includes(e.targetRatingType)?e.targetRatingType:Hg,a=e.ratings[r]?e.ratings[r].reduce(((e,t)=>e.includes(t.scaleName)?e:e.concat(t.scaleName)),[]):[];if(!a)return{error:vr};let o=e.ratings[r]?.find((e=>e.scaleName===n))??e.ratings[r][0];if(a[0]===n)return o;let s=o.scaleName,c=Qg[o.scaleName].accessor,u=c?o.scaleValue[c]:o.scaleValue,d=function({sourceRatingType:e,sourceRating:t}){let r=Qg[e].range,i=r[0]>r[1],n=Qg[Hg].range;return Wg({value:i?r[0]-t:t,sourceRange:r,targetRange:n})}({sourceRatingType:s,sourceRating:u});return{convertedRating:Jg({targetRatingType:n,sourceRating:d}),sourceRating:u}}function Zg({participantResults:e,sides:t,score:r}){let i=t.find((({sideNumber:e})=>1===e)),n=t.find((({sideNumber:e})=>2===e)),a=i?.participant?.ratings,o=n?.participant?.ratings;if(a?.[mu]&&o?.[mu]){let t=Hg,{convertedRating:s}=Xg({ratings:a,targetRatingType:t}),{convertedRating:c}=Xg({ratings:o,targetRatingType:t}),{side1pressure:u,side2pressure:d}=function({side1ConvertedRating:e,side2ConvertedRating:t,score:r}){let i=e>t?e:t,n=e>t?t:e,a=Math.abs(e-t),o=Qg[Hg].range,s=Math.max(...o),c=0*(s-i),u=(i+c)/s*a,d=r?.sets?.reduce(((e,t)=>e+(t?.side1Score??0)),0),l=r?.sets?.reduce(((e,t)=>e+(t.side2Score??0)),0),p=e>t?2:1,m=d*(n+(1===p?u:0)),f=l*(n+(2===p?u:0)),h=m+f,g=zr(m/h),I=zr(f/h);return{side1pressure:g,side2pressure:I}}({side1ConvertedRating:s,side2ConvertedRating:c,score:r});e[i?.participantId].pressureScores.push(u),e[n?.participantId].pressureScores.push(d);let l=Math.max(...Qg[Hg].range),p=zr((c-s)/l),m=zr((s-c)/l);e[i?.participantId].ratingVariation.push(p),e[n?.participantId].ratingVariation.push(m)}}var eI="SET3-S:6/TB7",tI="SET3-S:6/TB7-F:TB10";function rI({winningSide:e,matchUpFormat:t=eI,matchUpStatus:r,tallyPolicy:i,score:n}){let a=[0,0],o=n?.sets,s="number"==typeof e&&e-1,c=Op(t),u=aI(c?.bestOf??1);if("number"==typeof s&&(r===Xo&&i?.setsCreditForDefaults||r===ss&&i?.setsCreditForWalkovers))a[s]=u;else for(let d of o||[]){let{winningSide:e}=d;e&&(a[e-1]+=1)}return"number"==typeof s&&r===ns&&(+a[1-s]===u&&(a[1-s]-=1),i?.setsCreditForRetirements&&(a[s]=u)),a}function iI({matchUpFormat:e=eI,winningSide:t,matchUpStatus:r,tallyPolicy:i,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let o="number"==typeof t&&t-1,s=Op(e),c=aI(s?.bestOf??1),u=s?.setFormat?.tiebreakAt||0,d=[[],[]];if("number"==typeof o&&(r===Xo&&i?.gamesCreditForDefaults||r===ss&&i?.gamesCreditForWalkovers)){let e=c*(s?.setFormat?.setTo||0);d[o].push(e)}else a.forEach(((e,t)=>{let r=(e.setNumber||t+1)>c&&s?.finalSetFormat?"finalSetFormat":"setFormat",n=s?.[r]?.based,a=s?.[r].tiebreakSet,{side1Score:o,side2Score:u}=e;sI(n)&&(d[0].push(xr(o||0)),d[1].push(xr(u||0))),a&&e.winningSide&&!1!==i?.gamesCreditForTiebreakSets&&d[e.winningSide-1].push(1)}));if(r===ns&&"number"==typeof o){let n=a.length>c&&s?.finalSetFormat?"finalSetFormat":"setFormat",l=s?.[n];if(sI(l.based)){let n=l?.setTo||0,p=e=>{if(s&&""!==e)return+e==u-1||+e===u?xr(u||0)+1:+e<u?n:u},m=rI({winningSide:t,score:{sets:a},matchUpStatus:r,matchUpFormat:e,tallyPolicy:i});if(d.map((e=>e[o]<=e[1-o])).reduce(((e,t)=>e+(t?1:0)),0)>m[1-o]){let e=d[o].length,t=p(d[1-o][e-1]);t&&(d[o][e-1]=t)}c>d[o].length&&i?.gamesCreditForRetirements&&d[o].push(n)}}return[d[0].reduce(((e,t)=>e+t),0),d[1].reduce(((e,t)=>e+t),0)]}function nI({matchUpFormat:e,score:t}){let r=e?Op(e):void 0,i=aI(r?.bestOf??1),n=[0,0],a=[0,0];return t?.sets?.forEach(((e,t)=>{let o=(e.setNumber||t+1)>i&&r?.finalSetFormat?"finalSetFormat":"setFormat",s=r?.[o]?.based;if(oI(s)){let{side1Score:t,side2Score:r}=e;t&&(a[0]+=xr(t||0)),r&&(a[1]+=xr(r||0))}else e.side1TiebreakScore&&(a[0]+=xr(e.side1TiebreakScore||0)),e.side2TiebreakScore&&(a[1]+=xr(e.side2TiebreakScore||0)),(e.side1TiebreakScore||e.side2TiebreakScore)&&e.winningSide&&(n[e.winningSide-1]+=1)})),{pointsTally:a,tiebreaksTally:n}}function aI(e){return e&&Math.ceil(e/2)||1}function oI(e){return"P"===e}function sI(e){return!oI(e)}function cI({participantIds:e,pressureRating:t,matchUpFormat:r,tallyPolicy:i,perPlayer:n,matchUps:a}){let o={},s=i?.excludeMatchUpStatuses||[],c=a?.filter((t=>(t.tieMatchUps||!s.includes(t.matchUpStatus))&&(!e?.length||2===si(e,[lI(t,0),lI(t,1)]).length))),u=c?.flatMap((({score:e,tieMatchUps:t})=>t?t.filter((({matchUpStatus:e})=>!s.includes(e))).flatMap((({score:e})=>e?.sets?.length??0)):e?.sets?.length??0))?.reduce(((e,t)=>e+t),0);for(let d of c??[]){let{matchUpStatus:e,tieMatchUps:a,tieFormat:s,score:c,winningSide:u,sides:l}=d,p=s&&d._disableAutoCalc&&s.collectionDefinitions.every((({scoreValue:e})=>e)),m=u&&uI(d),f=u&&dI(d);if(m||f)if(pI(o,m),pI(o,f),a?.length){n=0;for(let e of a){let{matchUpType:r}=e,n=hl(hu)(r),a=hl(mu)(r);e.winningSide&&(e.winningSide===u?(m&&(o[m].tieMatchUpsWon+=1,a&&(o[m].tieSinglesWon+=1),n&&(o[m].tieDoublesWon+=1)),f&&(o[f].tieMatchUpsLost+=1,a&&(o[f].tieSinglesLost+=1),n&&(o[f].tieDoublesLost+=1))):e.winningSide!==u&&(f&&(o[f].tieMatchUpsWon+=1,a&&(o[f].tieSinglesWon+=1),n&&(o[f].tieDoublesWon+=1)),m&&(o[m].tieMatchUpsLost+=1,a&&(o[m].tieSinglesLost+=1),n&&(o[m].tieDoublesLost+=1)))),fI({matchUpFormat:e.matchUpFormat,matchUpStatus:e.matchUpStatus,matchUpType:e.matchUpType,score:e.score,sides:e.sides,winningParticipantId:m,losingParticipantId:f,manualGamesOverride:p,participantResults:o,isTieMatchUp:!0,pressureRating:t,tallyPolicy:i,winningSide:u})}hI({winningParticipantId:m,losingParticipantId:f,participantResults:o,matchUpStatus:e})}else fI({matchUpFormat:d.matchUpFormat??r,matchUpType:d.matchUpType,isTieMatchUp:void 0,winningParticipantId:m,manualGamesOverride:p,losingParticipantId:f,participantResults:o,pressureRating:t,matchUpStatus:e,tallyPolicy:i,winningSide:u,score:c,sides:l});else if(e&&ms.includes(e)){let e=lI(d,0),t=lI(d,1);e&&(pI(o,e),o[e].matchUpsCancelled+=1),t&&(pI(o,t),o[t].matchUpsCancelled+=1)}else if(a?.length){n=0;for(let e of a){if(e.winningSide){let t=l?.find((({sideNumber:t})=>t===e.winningSide))?.participantId,r=l?.find((({sideNumber:t})=>t===e.winningSide))?.participantId;t&&r&&(pI(o,t),pI(o,r),o[t].tieMatchUpsWon+=1,o[r].tieMatchUpsLost+=1,hl(mu)(e.matchUpType)?(o[t].tieSinglesWon+=1,o[r].tieSinglesLost+=1):hl(hu)(e.matchUpType)&&(o[t].tieDoublesWon+=1,o[r].tieDoublesLost+=1))}mI({score:e.score,manualGamesOverride:p,participantResults:o,sides:l})}}else mI({manualGamesOverride:p,participantResults:o,score:c,sides:l});let h=c?.sets?.reduce(((e,t)=>e+(t?.side1Score??0)),0),g=c?.sets?.reduce(((e,t)=>e+(t.side2Score??0)),0);if(p){let e=l?.find((({sideNumber:e})=>1===e))?.participantId,t=l?.find((({sideNumber:e})=>2===e))?.participantId;pI(o,e),pI(o,t),e&&(o[e].gamesWon+=h,o[e].gamesLost+=g),t&&(o[t].gamesWon+=g,o[t].gamesLost+=h)}}return function({participantResults:e,matchUpFormat:t,tallyPolicy:r,perPlayer:i,totalSets:n}){let a=t&&Op(t)||{},o=a.bestOf,s=o&&Math.ceil(o/2)||1,c=a.setFormat?.setTo;Object.keys(e).forEach((t=>{let a=e[t].setsWon,o=e[t].setsLost,u=r?.groupTotalSetsPlayed?n:i*(s||0)||a+o,d=Math.round(a/u*1e3)/1e3;(d===1/0||isNaN(d))&&(d=u);let l=e[t].tieMatchUpsWon,p=l+e[t].tieMatchUpsLost,m=Math.round(l/p*1e3)/1e3;(m===1/0||isNaN(m))&&(m=l);let f=e[t].matchUpsWon,h=f+e[t].matchUpsLost,g=Math.round(f/h*1e3)/1e3;(g===1/0||isNaN(g))&&(g=f);let I=e[t].gamesWon||0,U=e[t].gamesLost||0,v=(i||0)*(s||0)*(c||0),y=Math.max(v,I+U),S=Math.round(I/y*1e3)/1e3;(S===1/0||isNaN(S))&&(S=0);let w=Math.round(e[t].pointsWon/e[t].pointsLost*1e3)/1e3;(w===1/0||isNaN(w))&&(w=0),e[t].setsWon=a,e[t].setsLost=o,e[t].setsPct=d,e[t].tieMatchUpsWon=l,e[t].tieMatchUpsPct=m,e[t].matchUpsPct=g,e[t].gamesWon=I,e[t].gamesLost=U,e[t].gamesPct=S,e[t].pointsPct=w,e[t].result=`${e[t].matchUpsWon}/${e[t].matchUpsLost}`}))}({participantResults:o,matchUpFormat:r,tallyPolicy:i,perPlayer:n,totalSets:u}),{participantResults:o}}function uI(e){return lI(e,e.winningSide-1)}function dI(e){return lI(e,1-(e.winningSide-1))}function lI(e,t){if(!e?.sides)return console.log("no sides:",{matchUp:e}),"foo";let r=e.sides[t];return r?r.participantId:(console.log("No Side",{matchUp:e,index:t}),"foo")}function pI(e,t){t&&!e[t]&&(e[t]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function mI({manualGamesOverride:e,participantResults:t,score:r,sides:i}){let{sets:n}=r||{},a=[[],[]],o=[0,0];for(let c of n||[]){let{winningSide:e,side1Score:t,side2Score:r}=c;e&&(o[e-1]+=1),a[0].push(xr(t||0)),a[1].push(xr(r||0))}let s=[a[0].reduce(((e,t)=>e+t),0),a[1].reduce(((e,t)=>e+t),0)];i.forEach(((r,i)=>{let{participantId:n}=r;n&&(pI(t,n),t[n].setsWon+=o[i],t[n].setsLost+=o[1-i],e||(t[n].gamesWon+=s[i],t[n].gamesLost+=s[1-i]))}))}function fI({winningParticipantId:e,manualGamesOverride:t,losingParticipantId:r,participantResults:i,pressureRating:n,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:c,tallyPolicy:u,winningSide:d,score:l,sides:p}){let m=d&&d-1,f=1-m;n&&c===mu&&Zg({participantResults:i,sides:p,score:l}),s||hI({winningParticipantId:e,losingParticipantId:r,participantResults:i,matchUpStatus:o});let h=rI({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:d,score:l}),g=iI({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:d,score:l}),{pointsTally:I}=nI({score:l,matchUpFormat:a});e&&(i[e].setsWon+=h[m],i[e].setsLost+=h[f],t||(i[e].gamesWon+=g[m],i[e].gamesLost+=g[f]),i[e].pointsWon+=I[m],i[e].pointsLost+=I[f]),r&&(i[r].setsWon+=h[f],i[r].setsLost+=h[m],t||(i[r].gamesWon+=g[f],i[r].gamesLost+=g[m]),i[r].pointsWon+=I[f],i[r].pointsLost+=I[m])}function hI({winningParticipantId:e,losingParticipantId:t,participantResults:r,matchUpStatus:i}){t&&(i===ss&&(r[t].walkovers+=1),i===Xo&&(r[t].defaults+=1),i===ns&&(r[t].retirements+=1),[Xo,ns,ss].includes(i)&&(r[t].allDefaults+=1),r[t].matchUpsLost+=1),e&&(r[e].matchUpsWon+=1),t&&e&&(r[t].defeats.push(e),r[e].victories.push(t))}function gI({participantResults:e,participantIds:t,attribute:r}){return II({participantResults:e,participantIds:t}).reduce(((e,t)=>{let{participantId:i,results:n}=t,a=n?.[r];return!isNaN(a)&&i&&(e[a]?e[a].push(i):e[a]=[i]),e}),{})}function II(e){return(e.participantIds||Object.keys(e.participantResults)).reduce(((t,r,i)=>(t.push({participantId:r,i:i,results:e.participantResults[r]}),t)),[])}var UI=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],vI={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function yI(e){let{requireCompletion:t=!0,participantResults:r,subOrderMap:i,tallyPolicy:n}=e,a=[];if(t&&!function({participantResults:e,participantsCount:t}){let r=II({participantResults:e}).filter((e=>t-1===e.results.matchUpsWon+e.results.matchUpsLost+e.results.matchUpsCancelled));return t===r.length}(e))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",s=gI({participantResults:r,attribute:o});a.push({attribute:o,groups:s});let c,u=Object.keys(s).map((e=>parseFloat(e))).sort(((e,t)=>t-e)).map((e=>s[e])).map((t=>{let r=SI({participantIds:t,...e});return a.push(...r.report??[]),r.order})).flat(1/0),d=1;u.forEach(((e,t)=>{t&&(e.resolved||c&&!e.resolved)&&(d+=1),c=e.resolved,e.resolved?(e.position=t+1,d=e.position):e.position=d}));let l=Xr(u.map((({position:e})=>e)));return u.forEach((e=>{let{participantId:t,position:a}=e||{},o=r[t];e.GEMscore=function(e){return(Array.isArray(n?.GEMscore)?Object.keys(vI).filter((e=>n.GEMscore.includes(e))):Object.keys(vI)).map((t=>(e[t]||0)*Math.pow(10,vI[t].toFixed(3)))).reduce(((e,t)=>e+t),0)}(o);let s=l[a];void 0!==e?.position&&(s>1&&(e.ties=s,i&&(e.subOrder=i[t])),e.rankOrder=a,e.groupOrder=a+(e.subOrder||1)-1)})),{groupOrder:u,report:a.flat(1/0).filter(Boolean)}}function SI({participantResults:e,disableHeadToHead:t,participantIds:r,matchUpFormat:i,tallyPolicy:n,matchUps:a}){let o,s=[],c=[];if(1===r?.length)return{order:[{resolved:!0,participantId:r[0]}]};if(2===r?.length&&(!n?.headToHead||!n.headToHead.disabled&&!t)){let t=function({participantIds:e,participantResults:t}){if(e){if(t[e[0]].victories.includes(e[1]))return e.map((e=>({resolved:!0,participantId:e})));if(t[e[1]].victories.includes(e[0]))return e.reverse().map((e=>({resolved:!0,participantId:e})))}}({participantIds:r,participantResults:e});if(t){let e=t[0].participantId;return c.push({attribute:"head2Head",participantIds:r,headToHeadWinner:e}),{order:[t],headToHeadWinner:e,report:c}}}let u=(n?.tallyDirectives||UI).filter((e=>{let t=!(jr(e.maxParticipants)&&r?.length>e.maxParticipants);return t||s.push(e),t}));return s.length&&c.push({excludedDirectives:s,participantIds:r}),u.every((({attribute:e,reversed:t,idsFilter:s,disableHeadToHead:u})=>(o=function({disableHeadToHead:e,participantIds:t,matchUpFormat:r,tallyPolicy:i,attribute:n,idsFilter:a,matchUps:o,reversed:s}){let c,{participantResults:u}=cI({participantIds:a&&t,matchUpFormat:r,tallyPolicy:i,matchUps:o}),d=gI({participantResults:u,participantIds:t,attribute:n}),l=[{attribute:n,reversed:s,groups:d,idsFilter:a}];return Object.keys(d).length>1&&t.length&&(c=Object.keys(d).map((e=>parseFloat(e))).sort(((e,t)=>s?e-t:t-e)).map((e=>d[e])).map((t=>{let n=SI({participantResults:u,disableHeadToHead:e,participantIds:t,matchUpFormat:r,tallyPolicy:i,matchUps:o});return l.push(...n.report??[]),n.order})).flat(1/0)),{order:c,report:l}}({disableHeadToHead:u,participantIds:r,matchUpFormat:i,tallyPolicy:n,attribute:e,idsFilter:s,matchUps:a,reversed:t}),c.push(o.report),!o.order))),o.order?{order:o.order,report:c}:{order:r?.map((e=>({participantId:e}))),report:c}}function wI({policyDefinitions:e,generateReport:t,pressureRating:r,matchUpFormat:i,matchUps:n=[],subOrderMap:a,perPlayer:o}){if(!n?.length||!Ip(n))return{error:Oe};let s=Yr(n.map((({structureId:e})=>e)));if(1!==s.length)return en({result:{error:mr,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let c=n.filter((e=>e&&e.matchUpStatus!==Yo)),u=c.length&&Yr(c.map((({drawPositions:e})=>e)).flat()).length,d=c.filter((e=>Qp({matchUp:e}))).length===c.length;d||(o=0);let l,p,m=n.every((({matchUpType:e,tieMatchUps:t})=>e===Iu&&t?.every((e=>Qp({matchUp:e}))))),f=e?.[Ma],h=n.filter((e=>Qp({matchUp:e})||e.matchUpType===Iu)),{participantResults:g}=cI({matchUps:h,pressureRating:r,matchUpFormat:i,tallyPolicy:f,perPlayer:o}),{groupOrder:I,report:U}=yI({matchUps:h,participantResults:g,participantsCount:u,matchUpFormat:i,tallyPolicy:f,subOrderMap:a});if(d&&I)l=U,p=I,I.forEach((e=>{let{participantId:t,groupOrder:r,rankOrder:i,subOrder:n,ties:a,GEMscore:o}=e,s=g[t];Object.assign(s,{groupOrder:r,rankOrder:i,GEMscore:o,subOrder:n,ties:a})}));else{let{groupOrder:e,report:t}=yI({requireCompletion:!1,participantResults:g,participantsCount:u,matchUpFormat:i,tallyPolicy:f,subOrderMap:a,matchUps:n});l=t,p=e,e&&e.forEach((e=>{let{participantId:t,groupOrder:r,GEMscore:i}=e,n=g[t];Object.assign(n,{provisionalOrder:r,GEMscore:i})}))}let v={completedTieMatchUps:m,readableReport:"",participantResults:g,bracketComplete:d,order:[],report:l};if((d||m)&&(v.order=p),t||wi({tally:!0})){let e=function({matchUps:e,order:t,report:r}){let i={};e.forEach((({sides:e})=>{e.forEach((e=>{e.participantId&&e.participant&&(i[e.participantId]=e.participant.participantName)}))}));let n=[];return Array.isArray(r)&&r.forEach(((e,t)=>{if(e.excludedDirectives?.length){let t=e.excludedDirectives.map((({attribute:e})=>e)).join(", "),r=`${t.length} directives were excluded due to participants limit}`;n.push(r);let i=`Excluded: ${t}`;n.push(i)}else{let r=(t,r)=>parseFloat(e.reversed?t:r)-parseFloat(e.reversed?r:t),a=e.groups?Object.values(e.groups).flat(1/0).length:e.participantIds?.length??0,o=e=>{e.groups&&Object.keys(e.groups).sort(r).forEach((t=>{let r=e.groups[t].map((e=>i[e])).join(", "),a=`${t} ${e.attribute}: ${r}`;n.push(a)}))},s=e.reversed?" in reverse order":"",c=`Step ${t+1}: ${a} particiants were ${e.groups?"grouped":"separated"}${s} by ${e.attribute}`;if(n.push(c),e.idsFilter){let t=`${e.attribute} was calculated considering ONLY TIED PARTICIPANTS`;n.push(t)}o(e)}n.push("----------------------")})),n.push("Final Order:"),t.forEach((e=>{let{participantId:t,resolved:r}=e,a=e.groupOrder||e.provisionalOrder;n.push(`${a}: ${i[t]} => resolved: ${!!r}`)})),n.join("\r\n")}({matchUps:n,report:l,order:p});wi({tally:!0})&&console.log(e),v.readableReport=e}return v}function PI({positionAssignments:e}){let t=(e||[]).filter(fm(sn)).map((e=>{let{extension:t}=no({element:e,name:Ro}),r=xr(t?.value),i=!isNaN(r)&&r;return i&&{participantId:e.participantId,subOrder:i}})).filter(Boolean),r=Xr(t.map((({subOrder:e})=>e)));return{subOrderMap:Object.assign({},...t.filter((({subOrder:e})=>1===r[e])).map((({participantId:e,subOrder:t})=>({[e]:t}))))}}function DI({positionAssignments:e,tournamentRecord:t,drawDefinition:r,matchUpFormat:i,matchUps:n,event:a}){if(!Ip(n))return{error:mr};if(!e)return{error:mr};let{policyDefinitions:o}=Ku({policyTypes:[Ma],tournamentRecord:t,drawDefinition:r,event:a}),{subOrderMap:s}=PI({positionAssignments:e}),c=n.length?wI({policyDefinitions:o,matchUpFormat:i,subOrderMap:s,matchUps:n}):void 0;if(c?.error)return c;let{participantResults:u={},bracketComplete:d,report:l}=c??{},p=Object.keys(u);return e.forEach((e=>{let{participantId:t}=e;if(p.includes(t)){za({element:e,extension:{value:u[t],name:Mo}}),u[t].ties||Wa({element:e,name:Ro})}else Wa({element:e,name:Mo}),Wa({element:e,name:Ro})})),au({drawDefinition:r}),{...I,participantResults:u,bracketComplete:d,report:l}}function TI({matchUps:e,matchUpId:t}){return{matchUp:(e||[]).find((e=>e.matchUpId===t))}}function bI({tournamentParticipants:e,afterRecoveryTimes:t,contextContent:r,contextProfile:i,drawDefinition:n,matchUpsMap:a,matchUpId:o,inContext:s,context:c,event:u}){if(!n)return{error:M};if(!o)return{error:Ae};if("string"!=typeof o)return{error:mr};let{structures:d=[]}=Sc({drawDefinition:n});i&&!r&&(r=id({contextProfile:i,drawDefinition:n}));for(let l of d){let{matchUps:d}=Kp({tournamentParticipants:e,afterRecoveryTimes:t,contextContent:r,drawDefinition:n,contextProfile:i,matchUpsMap:a,inContext:s,structure:l,context:c,event:u}),{matchUp:p}=TI({matchUps:d,matchUpId:o});if(p)return{matchUp:p,structure:l}}return{error:Ce}}function RI(e){return"object"!=typeof e?{error:He}:"object"!=typeof e.element?{error:mr}:e.notes?"string"==typeof e.notes||e.notes?.testing?(Object.assign(e.element,{notes:e.notes}),{...I}):{error:mr}:{error:He}}function MI(e){return"object"!=typeof e?{error:He}:"object"!=typeof e.element?{error:mr}:(e.element.notes&&delete e.element.notes,{...I})}var NI={matchUpStatus:os,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function AI(e){let t,r="modifyMatchUpScore",i=e.matchUpFormat,n=e.matchUp,{matchUpStatusCodes:a,removeWinningSide:o,tournamentRecord:s,drawDefinition:c,matchUpStatus:u,removeScore:d,winningSide:l,matchUpId:p,event:m,notes:f,score:h}=e,g=e.appliedPolicies&&Object.keys(e.appliedPolicies).length?e.appliedPolicies:Yu({policyTypes:[_a],tournamentRecord:s,drawDefinition:c,structure:t,event:m})?.appliedPolicies,U=n.matchUpType===Iu;if(U&&c){if(p&&n.matchUpId!==p){let e=bI({drawDefinition:c,matchUpId:p,event:m});if(!e.matchUp)return{error:Ce};({matchUp:n,structure:t}=e)}}else n.matchUpId!==p&&console.log("!!!!!");u&&[ss,es].includes(u)||d?Object.assign(n,{...NI}):h&&(n.score=h);let v,y=u&&n?.matchUpStatus===Xo&&u!==Xo;if(u&&(n.matchUpStatus=u),i&&(n.matchUpFormat=i),a&&(n.matchUpStatusCodes=a),l&&(n.winningSide=l),o&&(n.winningSide=void 0),!t&&c&&({structure:t}=bI({drawDefinition:c,matchUpId:p,event:m})),u&&!n.winningSide&&Um(n)&&!ms.includes(u)&&![zo,as].includes(u)&&(n.matchUpStatus=ts),(y&&n?.processCodes?.length||u===Xo)&&(v=g?.[_a]?.processCodes?.incompleteAssignmentsOnDefault),!n.collectionId){let e=t?.structureType===Es,a=Tp({structure:t});if(Dp({drawDefinition:c,structure:t})||a||e){let o=(e=>{i=U?"SET1-S:T100":i??n.matchUpFormat??e?.matchUpFormat??c?.matchUpFormat??m?.matchUpFormat;let t=U?{matchUpTypes:[Iu]}:void 0,{matchUps:r}=Kp({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:t,drawDefinition:c,structure:e,event:m});return a&&(e.positionAssignments=Yr(r.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e})))),DI({positionAssignments:e.positionAssignments,tournamentRecord:s,drawDefinition:c,matchUpFormat:i,matchUps:r,event:m})})(e&&t.structures.find((e=>e?.matchUps.find((e=>e.matchUpId===p))))||t);if(o.error)return en({result:o,stack:r})}}if(f){let e=RI({element:n,notes:f});if(e.error)return en({result:e,stack:r})}let S=s?.tournamentId,w=Bi().topics.includes(Xc),P=(w||v)&&mp({drawDefinition:c}),D=P&&am({matchUpFilters:{matchUpIds:[p]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:P}).matchUps?.[0];if(w&&D&&function({tournamentId:e,inContextMatchUp:t}){t&&ki({payload:{inContextMatchUp:t,tournamentId:e},topic:Xc,key:t.matchUpId})}({tournamentId:S,inContextMatchUp:D}),Array.isArray(v)&&D&&!D.sides?.every((({participantId:e})=>e)))if(u===Xo)n.processCodes=Yr([...n.processCodes??[],...v]);else for(let I of v||[]){let e=I&&n?.processCodes?.lastIndexOf(I);n?.processCodes?.splice(e,1)}return iu({eventId:m?.eventId,context:r,drawDefinition:c,tournamentId:S,matchUp:n}),{...I}}function EI(e){let{matchUpStatusCodes:t,matchUpStatus:r,structure:i,matchUp:n,dualMatchUp:a}=e,o=vm({matchUpStatus:r})||[Ko,Ho].includes(r)&&a,s="attemptToModifyScore",c=!!n.collectionId,u=Tp({structure:i});if(!(c||u||function({structure:e,matchUp:t}){let{drawPositions:r}=t,{positionAssignments:i}=Dc({structure:e});return 2===i?.filter((e=>r?.includes(e.drawPosition)&&e.participantId))?.length}({structure:i,matchUp:n})))return{error:he};let d=[ss].includes(r),l=o?r:e.winningSide&&Qo||rs;return en({result:AI({...e,matchUpStatusCodes:o&&t||[],matchUpStatus:l,context:s,removeScore:d}),stack:s})}function CI({collectionGroups:e=[]}){let t=Object.assign({},...e.filter((e=>Wr(e?.groupValue)&&e?.groupNumber)).map((e=>({[e.groupNumber]:{...e,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))));return{groupValueGroups:t,groupValueNumbers:Object.keys(t).map((e=>xr(e)))}}function OI({collectionDefinition:e,groupValueNumbers:t,groupValueGroups:r,sideTieValues:i,tieMatchUps:n}){let a=n.filter((t=>t.collectionId===e.collectionId)),o=[0,0],s=[0,0],c=a.every((e=>ms.includes(e.matchUpStatus))),{collectionValueProfiles:u,collectionGroupNumber:d,collectionValue:l,matchUpValue:p,winCriteria:m,scoreValue:f,setValue:h}=e,g=d&&t.includes(d),I=[0,0];if(a.forEach((e=>{e.winningSide&&(I[e.winningSide-1]+=1)})),Wr(p)?a.forEach((e=>{e.winningSide&&(o[e.winningSide-1]+=p)})):Wr(h)?a.forEach((e=>{e.score?.sets?.forEach((e=>{e.winningSide&&(o[e.winningSide-1]+=h)}))})):Wr(f)?a.forEach((e=>{e.score?.sets?.forEach((t=>{let{side1TiebreakScore:r=0,side2TiebreakScore:i=0,side1Score:n=0,side2Score:a=0}=t;(e.matchUpStatus===Qo||e.winningSide||t.winningSide)&&(n||a?(o[0]+=n,o[1]+=a):(r||i)&&t.winningSide&&(o[t.winningSide-1]+=1))}))})):Array.isArray(u)&&a.forEach((t=>{if(t.winningSide){let r=t.collectionPosition,i=function({collectionDefinition:e,collectionPosition:t}){return(e.collectionValueProfiles||[])?.find((e=>e.collectionPosition===t))?.matchUpValue}({collectionDefinition:e,collectionPosition:r});Wr(i)&&(o[t.winningSide-1]+=i)}})),Wr(l)){let t;if(m?.aggregateValue)c&&(Wr(p||h||f)&&o[0]!==o[1]?t=o[0]>o[1]?1:2:I[0]!==I[1]&&(t=I[0]>I[1]?1:2));else if(m?.valueGoal)t=o.reduce(((e,t,r)=>t>=m.valueGoal?r+1:e),0);else{let r=Math.floor(e.matchUpCount/2)+1;t=I.reduce(((e,t,i)=>t>=r?i+1:e),0)}t&&(g?r[d].values[t-1]+=l:s[t-1]+=l)}else g?(r[d].values[0]+=o[0]||0,r[d].values[1]+=o[1]||0):s=o;g?(r[d].sideWins[0]+=I[0]||0,r[d].sideWins[1]+=I[1]||0,r[d].allGroupMatchUpsCompleted=r[d].allGroupMatchUpsCompleted&&c,r[d].matchUpsCount+=a.length):s.forEach(((e,t)=>i[t]+=e||0))}function FI({collectionValueProfiles:e,matchUpCount:t}){let r=[];if(!Array.isArray(e))return r.push(`collectionValueProfiles is not an array: ${e}`),{errors:r};if(e.length&&e.length!==t)return r.push("collectionValueProfiles do not align with matchUpsCount"),{errors:r};for(let n of e){if("object"!=typeof n)return r.push(`valueProfile is not type object: ${n}`),{errors:r};let{matchUpValue:e,collectionPosition:i}=n;if("number"!=typeof e||"number"!=typeof i||i>t||i<1)return r.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:r}}let i=e.map((e=>e.collectionPosition));return i.length!==Yr(i).length?(r.push("collectionPositions are not unique"),{errors:r}):{...I}}var kI="MIXED events can not contain mixed singles or { gender: ANY } collections",xI="events with { gender: ANY } can not contain MIXED singles collections";function _I(e){let t="tieFormatGenderValidityCheck",{referenceGender:r,matchUpType:i,gender:n}=e;return r&&n&&[$p,zp].includes(r)&&r!==n?en({result:{valid:!1,error:lr},context:{gender:n},stack:t}):r===Wp&&(n===qp||n===Wp&&i!==hu)?en({result:{error:lr,valid:!1},info:kI,stack:t}):r===qp&&n===Wp&&i!==hu?en({result:{error:lr,valid:!1},info:xI,stack:t}):{valid:!0}}function LI(e,t){if(d(e),(e?.bestOf||e?.exactly)&&e?.setFormat)return function(e,t){let r=VI(e.bestOf)||void 0,i=VI(e.exactly)||void 0,n=r||i;if(e.setFormat?.timed&&e.simplified&&1===n)return BI(e.setFormat);let a=n&&`${Ep}${n}`||"",o=jI(e.setFormat,t),s=o&&`S:${o}`||"",c=jI(e.finalSetFormat,t),u=n&&n>1&&c&&o!==c&&`F:${c}`||"";if(a&&o)return[a,s,u].filter((e=>e)).join("-")}(e,t)}function VI(e){return!isNaN(Number(e))&&Number(e)}function BI(e){let t=`T${e.minutes}`;return e.based&&(t+=e.based),e.modifier&&(t+=`@${e.modifier}`),t}function jI(e,t){if("object"==typeof e&&Object.keys(e).length){if(e.timed)return BI(e);if(e.tiebreakSet)return GI(e.tiebreakSet);let r=VI(e.setTo);if(r){let i=e.NoAD&&Ap||"",n=GI(e.tiebreakFormat),a=n&&`/${n}`||"",o=VI(e.tiebreakAt);if(!1!==n)return`${r}${i}${a}${o&&(o!==r||t)&&`@${o}`||""}`}}}function GI(e){if(e){if("object"==typeof e&&!e.tiebreakTo)return"";if("object"==typeof e&&VI(e.tiebreakTo)){let t=`TB${e.tiebreakTo}${e.NoAD?Ap:""}`;return e.modifier&&(t+=`@${e.modifier}`),t}return!1}}function qI({matchUpFormat:e}){if(!u(e)||""===e)return!1;let t=Op(e),r=e.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),i=r?.[1],n=r?.[2],a=r?.[3],o=e.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o?.[1],c=o?.[2],d=o?.[3];return LI(t,!!(r&&n&&i===a||o&&c&&s===d))===e}var $I=(e,t)=>e.filter(Boolean).every((e=>typeof e===t)),WI=e=>e.filter(Boolean).every(jr);function HI(e){let t=e.category;if("object"!=typeof t)return{error:pr};let r,{ageCategoryCode:i,ageMaxDate:n,ageMinDate:a,ageMax:o,ageMin:s}=t,c=t.categoryName;if(!$I([i,n,a,c],"string")||!WI([o,s]))return{error:pr};let u=e.consideredDate??la((new Date).toLocaleDateString("sv"));if(!Zn(u))return{error:Xe};let[d]=u.split("-").slice(0,3).map((e=>parseInt(e))),l=pa(u,-1),[p,m]=l.split("-").slice(1,3).map((e=>parseInt(e))),f=`${Sa(p)}-${Sa(m)}`,h=pa(u,1),[g,I]=h.split("-").slice(1,3).map((e=>parseInt(e))),U=`${Sa(g)}-${Sa(I)}`,v=s&&pa(u,-365*s),y=o&&pa(u,-365*o),S=[],w=e=>!S.includes(e)&&S.push(e);i=i??c;let P=/^([UO]?)(\d{1,2})([UO]?)$/,D=/^C(\d{1,2})-(\d{1,2})$/,T=i?.includes("-"),b=T&&i?.match(D),R=i?.match(P),M=(e,t)=>`${e}-${t}`,N=e=>{let r=M(d-e-1,U);t.ageMin&&t.ageMin>e&&w(`Invalid submitted ageMin: ${s}`),t.ageMax&&t.ageMax>e&&w(`Invalid submitted ageMax: ${o}`),t.ageMinDate&&t.ageMinDate!==r&&w(`Invalid submitted ageMinDate: ${a}`),a=r,i&&(t.ageMax&&t.ageMax!==e&&(w(`Invalid submitted ageMax: ${o}`),v=void 0),o=e)},A=e=>{let r=M(d-e,f);t.ageMaxDate&&t.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${n}`),n=r,i&&(t.ageMin&&t.ageMin!==e+1&&(w(`Invalid submitted ageMin: ${s}`),v=void 0),s=e+1)},E=e=>{let[r,c,u]=(e.match(P)||[]).slice(1),l=parseInt(c);"U"===r?(t.ageMaxDate&&t.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),(e=>{let r=M(d-e,U);t.ageMinDate&&t.ageMinDate!==r&&w(`Invalid submitted ageMinDate: ${a}`),a=r,i&&(t.ageMax&&t.ageMax!==e-1&&(w(`Invalid submitted ageMax: ${o}`),y=void 0),o=e-1)})(l)):"O"===r&&A(l),"U"===u?(t.ageMaxDate&&t.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),N(l)):"O"===u&&(e=>{let r=M(d-e-1,f);t.ageMaxDate&&t.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${n}`),n=r,i&&(t.ageMin&&t.ageMin!==e&&(w(`Invalid submitted ageMin: ${s}`),v=void 0),s=e)})(l),n=n??v,a=a??y};if(b){if(n=void 0,a=void 0,o=void 0,s=void 0,t.ageMin){let e=d-t.ageMin;n=M(e,f)}if(t.ageMax){let e=d-t.ageMax-1;a=M(e,U)}let[e,c]=(i?.match(D)??[]).slice(1).map((e=>parseInt(e)));e<=c?(s=e,o=c,r=!0):w(`Invalid combined age range ${i}`)}else T?i?.split("-").forEach(E):R?E(i):(s&&A(s),o&&N(o));o&&t.ageMin&&t.ageMin>o&&(w(`Invalid submitted ageMin: ${t.ageMin}`),s=void 0);let C=Zi({consideredDate:u,combinedAge:r,ageMaxDate:n,ageMinDate:a,ageMax:o,ageMin:s});return S.length&&(C.errors=S),C}function zI({category:e}){if(!d(e))return{error:mr};let t=HI({category:e});if(t.error)return{error:t};let{ratingMax:r,ratingMin:i}=e;return r&&!jr(r)?en({result:{error:mr},context:{ratingMax:r}}):i&&!jr(i)?en({result:{error:mr},context:{ratingMin:i}}):{...t}}function YI({childCategory:e,withDetails:t,category:r}){let i=zI({category:r}),n=zI({category:e}),a=n.ageMin&&(i.ageMin&&n.ageMin<i.ageMin||i.ageMax&&n.ageMin>i.ageMax),o=n.ageMax&&(i.ageMax&&n.ageMax>i.ageMax||i.ageMin&&n.ageMax<i.ageMin),s=n.ageMinDate&&i.ageMaxDate&&new Date(n.ageMinDate)>new Date(i.ageMaxDate),c=n.ageMaxDate&&i.ageMinDate&&new Date(n.ageMaxDate)<new Date(i.ageMinDate),u=r?.ratingType&&e?.ratingType&&r.ratingType===e.ratingType&&(r.ratingMin&&e.ratingMin&&e.ratingMin<r.ratingMin||r.ratingMax&&e.ratingMax&&e.ratingMax>r.ratingMax||r.ratingMin&&e.ratingMax&&e.ratingMax<r.ratingMin||r.ratingMax&&e.ratingMin&&e.ratingMin>r.ratingMax),d=r?.ballType&&e?.ballType&&r.ballType!==e.ballType,l=Zi({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:c,invalidBallType:d,invalidAgeMax:o,invalidAgeMin:a,valid:!(u||s||c||d||o||a)},!0);return t&&Object.assign(l,{categoryDetails:i,childCategoryDetails:n}),l}function KI({checkCategory:e=!0,collectionDefinition:t,checkCollectionIds:r,checkGender:i=!0,referenceCategory:n,referenceGender:a,event:o}){a=a??o?.gender;let s="validateCollectionDefinition",c=[];if("object"!=typeof t)return c.push(`collectionDefinition must be an object: ${t}`),en({result:{errors:c,error:dr},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:d,collectionValue:l,collectionId:p,matchUpCount:m,matchUpFormat:f,matchUpValue:h,matchUpType:g,scoreValue:I,setValue:U,category:v,gender:y}=t;if(r&&"string"!=typeof p&&c.push(`collectionId is not type string: ${p}`),"number"!=typeof m&&c.push(`matchUpCount is not type number: ${m}`),g&&!Bp([mu,hu],g)&&c.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),1!==[!!u?.length].concat([h,l,I,U].map(Wr)).filter(Boolean).length&&c.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),h&&"number"!=typeof h&&c.push(`matchUpValue is not type number: ${h}`),l&&"number"!=typeof l&&c.push(`collectionValue is not type number: ${l}`),u&&m){let e=FI({collectionValueProfiles:u,matchUpCount:m});e.errors&&c.push(...e.errors)}if(d&&"number"!=typeof d&&c.push(`collectionGroupNumber is not type number: ${l}`),f&&!qI({matchUpFormat:f})&&c.push(`Invalid matchUpFormat: ${f}`),i){let e=_I({referenceGender:a,matchUpType:g,gender:y});if(e.error)return en({context:{referenceGender:a,gender:y},result:e,stack:s})}if(e&&n&&v){let e=YI({category:n,childCategory:v});if(!e.valid)return en({result:{error:pr},context:e,stack:s})}return c.length?en({result:{errors:c,error:ur},stack:s}):{valid:!0}}function QI(e){let t=!(!1===e?.enforceCategory||!e?.category),r=!(!1===e?.enforceGender||!e?.gender),i=e?.checkCollectionIds,n=e?.tieFormat,a=e?.event,o="validateTieFormat",s=[];if(!e||!n||"object"!=typeof n)return s.push("tieFormat must be an object"),en({result:{error:Te},context:{tieFormat:n,errors:s},stack:o});if("object"!=typeof n.winCriteria)return s.push("tieFormat.winCriteria must be an object"),en({result:{error:Te},context:{tieFormat:n,errors:s},stack:o});if(!Array.isArray(n.collectionDefinitions))return s.push(ch("tieFormat.collectionDefinitions")),en({result:{error:Te},context:{tieFormat:n,errors:s},stack:o});let c,u=n.collectionDefinitions.every((n=>{let{setValue:o,scoreValue:u,collectionValue:d}=n;(o||u)&&!d&&(c=!0);let{valid:l,errors:p}=KI({referenceCategory:e.category,referenceGender:e.gender,collectionDefinition:n,checkCollectionIds:i,checkCategory:t,checkGender:r,event:a});return!!l||(Array.isArray(p)&&s.push(...p),!1)})),d="number"==typeof n.winCriteria?.valueGoal&&n.winCriteria?.valueGoal>0&&!c||n.winCriteria?.aggregateValue;if(!d&&!n.winCriteria?.aggregateValue)return c?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),en({context:{tieFormat:n,errors:s,aggregateValueImperative:c},result:{error:Te},stack:o});let l=n.collectionDefinitions.map((({collectionId:e})=>e)),p=!i||l.length===Yr(l).length,m=u&&d&&p;return m?{valid:m,errors:s}:en({result:{error:Te},context:{tieFormat:n,errors:s},stack:o})}function JI(e){let{sideAdjustments:t=[0,0],separator:r="-",drawDefinition:i,matchUpsMap:n,structure:a,matchUp:o,event:s}=e;if(!Array.isArray(t)||2!==t.length||isNaN(t.reduce(((e,t)=>e+t))))return{error:mr};if(!o)return{error:Fe};let c=pp({matchUp:o,drawDefinition:i,structure:a,event:s})?.tieFormat||e?.tieFormat;if(!c)return{error:Ne};let u=QI({tieFormat:c});if(u.error)return u;let d=c?.collectionDefinitions||[],l=o?.tieMatchUps??[],p=[0,0],{groupValueGroups:m,groupValueNumbers:f}=CI(c);for(let y of d)OI({collectionDefinition:y,groupValueNumbers:f,groupValueGroups:m,sideTieValues:p,tieMatchUps:l});for(let y of f){let e,t=m[y],{allGroupMatchUpsCompleted:r,matchUpCount:i,winCriteria:n,groupValue:a,sideWins:o,values:s}=t;if(n?.aggregateValue)r&&s[0]!==s[1]&&(e=s[0]>s[1]?1:2);else if(n?.valueGoal)e=s.reduce(((e,t,r)=>t>=n.valueGoal?r+1:e),void 0);else{let t=Math.floor(i/2)+1;e=o.reduce(((e,r,i)=>r>=t?i+1:e),void 0)}e&&(p[e-1]+=a||0)}let h,g=p.map(((e,r)=>(e||0)+t[r])),I={side1Score:g[0],side2Score:g[1],winningSide:void 0},U=g.join(r),v=g.slice().reverse().join(r);if(c?.winCriteria){let{valueGoal:e,aggregateValue:t,tallyDirectives:r}=c.winCriteria;if(e?h=g.map(((e,t)=>({sideNumber:t+1,points:e}))).find((({points:t})=>t>=e))?.sideNumber:t&&l.every((e=>e.matchUpStatus&&ms.includes(e.matchUpStatus)||e.winningSide))&&g[0]!==g[1]&&(h=g[0]>g[1]?1:2),!h&&r){let e=o.matchUpId,t=o.hasContext?o:n?.drawMatchUps?.[e]||i&&bI({inContext:!0,drawDefinition:i,matchUpId:e})?.matchUp;if(t){let{completedTieMatchUps:e,order:r}=wI({matchUps:[t]});if(e&&r?.length){let e=r[0].participantId;h=t.sides.find((({participantId:t})=>t===e))?.sideNumber}}}}return h&&(I.winningSide=h),{scoreStringSide1:U,scoreStringSide2:v,winningSide:h,set:I}}function XI({inContextDualMatchUp:e,drawDefinition:t,tournamentId:r,dualMatchUp:i,eventId:n}){if(i){e||(e=bI({matchUpId:i.matchUpId,inContext:!0,drawDefinition:t})?.matchUp);let{extension:a}=no({element:t,name:Io}),o=Da(a?.value||{},!1,!0),s=({displaySideNumber:e,drawPosition:t,sideNumber:r})=>({drawPosition:t,sideNumber:r,displaySideNumber:e});i.sides=e?.sides?.map((e=>{let t=e.participantId,r=t&&o[t]||void 0,{lineUp:n,...a}=i.sides?.find((({sideNumber:t})=>t===e.sideNumber))??{},c=n?.length?n:r;return{...s(e),...a,lineUp:c}})),iu({context:"ensureSidLineUps",matchUp:i,drawDefinition:t,tournamentId:r,eventId:n})}}function ZI(e){if(e)return Da(e,!1,!0)}function eU(e){let t=xn(e,[{[tn]:!0}]);return t.error?t:Object.keys(e.tournamentRecords).reduce(((t,r)=>{t.tournamentIdMap[r]=[];let i=e.tournamentRecords[r].events??[],n=i.map((({eventId:e})=>e)),a=i.map((e=>(e.drawDefinitions??[]).map((({drawId:e})=>e)))).flat();return t.tournamentIdMap[r].push(...n,...a),t.eventIds.push(...n),t.drawIds.push(...a),t}),{eventIds:[],drawIds:[],tournamentIdMap:{}})}function tU({tournamentRecords:e,eventId:t,drawId:r}){let{tournamentIdMap:i}=eU({tournamentRecords:e});return(i?Object.keys(i):[]).find((e=>t&&i?.[e].includes(t)||r&&i?.[e].includes(r)))}function rU(e){let{exitWhenNoValues:t,drawDefinition:r,matchUpStatus:i,removeScore:n,matchUpsMap:a,matchUpId:o,event:s}=e,c=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord?.tournamentId]:e.tournamentRecord}||{},u=e.tournamentId||e.tournamentRecord?.tournamentId;c&&tU({tournamentRecords:c,...e});let d=u&&c[u];if(!d)return{error:D};let l=bI({drawDefinition:r,event:s,matchUpId:o});if(l.error)return l;if(!l.matchUp)return{error:Ce};let{matchUp:p,structure:m}=l;if(!p.tieMatchUps)return{error:ke};XI({tournamentId:d?.tournamentId,eventId:s?.eventId,dualMatchUp:p,drawDefinition:r});let{extension:f}=no({name:lo,element:p});if(f?.value){if(!n)return{...I,score:p.score};Wa({element:p,name:lo})}let h=pp({drawDefinition:r,structure:m,matchUp:p,event:s})?.tieFormat;p.tieFormat=ZI(h);let g=JI({drawDefinition:r,matchUpsMap:a,structure:m,matchUp:p,event:s}),{winningSide:U,set:v,scoreStringSide1:y,scoreStringSide2:S}=g,w=v?.side1Score||v?.side2Score;if(t&&!p.score&&!w)return{...I};let P,T={scoreStringSide1:y,scoreStringSide2:S,sets:v?[v]:[]},b=U&&[1,2].includes(U),R=b&&Qo||Sm({matchUpStatus:i??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:T})&&ts||os,M=!(!p.winningSide||b),N=p.tieMatchUps.find((({score:e,winningSide:t,matchUpStatus:r})=>e?.sets?.length&&(e.sets[0].side1Score||e.sets[0].side2Score)||r&&ms.includes(r)||t));if(p.tieFormat&&!b&&!N){let e=pp({drawDefinition:r,structure:m,event:s})?.tieFormat;e&&JSON.stringify(h)===JSON.stringify(e)&&(p.tieFormatId=void 0,p.tieFormat=void 0,P=!0)}return AI({appliedPolicies:e.appliedPolicies,matchUpStatus:R,score:T,removeWinningSide:M,tournamentRecord:d,drawDefinition:r,removeScore:n,winningSide:U,matchUpId:o,matchUp:p,event:s}),{...I,score:T,removeWinningSide:M,tieFormatRemoved:P,winningSide:U}}function iU(e){let t=EI(e);if(t.error)return t;let r,i=vm({matchUpStatus:e.matchUpStatus}),{dualWinningSideChange:n,projectedWinningSide:a,inContextDrawMatchUps:o,tournamentRecord:s,drawDefinition:c,matchUpStatus:u,dualMatchUp:d,matchUpsMap:l,winningSide:p,targetData:m,matchUpId:f,structure:h,matchUp:g,event:U}=e,v="directParticipants",y=!!g.collectionId,S=Tp({structure:h}),w=g.drawPositions;if(y){let{matchUpTieId:t,matchUpsMap:i}=e,a=rU({appliedPolicies:e.appliedPolicies,matchUpId:t,tournamentRecord:s,drawDefinition:c,matchUpsMap:i,event:U});if(r=a&&{tieMatchUpResult:a},w=o.find((({matchUpId:e})=>e===t))?.drawPositions,!n)return en({result:{...I,...r},stack:v})}if(S)return en({result:{...I,...r},stack:v});if(!w)return en({result:{error:L},stack:v});{let e=a?a-1:p-1,t=1-e,r=w[e],n=w[t],{targetLinks:{loserTargetLink:h,winnerTargetLink:g,byeTargetLink:y},targetMatchUps:{winnerMatchUpDrawPositionIndex:S,loserMatchUpDrawPositionIndex:P,winnerMatchUp:D,loserMatchUp:T,byeMatchUp:b}}=m;if(D){let e=function({winnerMatchUpDrawPositionIndex:e,inContextDrawMatchUps:t,projectedWinningSide:r,sourceMatchUpStatus:i,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:c,winnerMatchUp:u,dualMatchUp:d,matchUpsMap:l,event:p}){let m="directWinner";if(o){let r=u.drawPositions||[],d=r[e],f=o.source.structureId,h=yc({structureId:f,drawDefinition:c});if(h.error)return h;let{structure:g}=h,{positionAssignments:I}=Dc({structureId:f,drawDefinition:c}),U=I?.find((e=>e.drawPosition===n))?.participantId,v=o.target.structureId,{positionAssignments:y}=Dc({structureId:v,drawDefinition:c}),S=y?.find((e=>e.participantId===U))?.drawPosition,w=y?.filter((e=>{let t=r.includes(e.drawPosition),i=!e.participantId&&!e.bye&&!e.qualifier;return t&&i})).map((e=>e.drawPosition)),P=w?.includes(d);if(U&&1===o.target.roundNumber&&P)ph({drawPosition:d,participantId:U,structureId:v,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:a,drawDefinition:c,matchUpsMap:l,event:p});else if(U&&w?.length){let e=w.pop();e&&ph({participantId:U,structureId:v,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:a,drawDefinition:c,drawPosition:e,matchUpsMap:l,event:p})}else if(S){let e=ah({drawPosition:S,matchUpId:u.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:c,matchUpsMap:l});if(e.error)return en({result:e,stack:m})}else if(g?.stage!==Us){let e="winner target position unavaiallble";return console.log(e),{error:e}}if(g?.seedAssignments&&g.structureId!==v){let e=g.seedAssignments.find((({participantId:e})=>e===U)),t=e?.participantId;e&&t&&Zf({eventId:u?.eventId,structureId:v,...e,tournamentRecord:a,drawDefinition:c,participantId:t})}}else{let e=ah({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:c,matchUpsMap:l});if(e.error)return e}if(d&&r){let e=d.sides?.find((e=>e.sideNumber===r));if(e?.lineUp){let t=d.roundPosition,r=u.roundPosition,i=t===r&&1!==t||Math.floor(t/2)===r?2:1,n=l?.drawMatchUps?.find((({matchUpId:e})=>e===u.matchUpId)),o=[1,2].map((e=>({...n.sides?.find((t=>t.sideNumber===e))||{},sideNumber:e})));n.sides=o;let s=n.sides.find((e=>e.sideNumber===i));if(s){let t=e.lineUp?.filter((e=>e?.participantId));s.lineUp=sh({lineUp:t}),iu({tournamentId:a?.tournamentId,eventId:u?.eventId,matchUp:n,context:m,drawDefinition:c})}}}return{...I}}({sourceMatchUpStatus:i&&u||Qo,winnerMatchUpDrawPositionIndex:S,sourceMatchUpId:f,inContextDrawMatchUps:o,projectedWinningSide:a,winningDrawPosition:r,tournamentRecord:s,winnerTargetLink:g,drawDefinition:c,winnerMatchUp:D,dualMatchUp:d,matchUpsMap:l,event:U});if(e.error)return en({result:e,stack:v})}if(T){let e=function(e){let{loserMatchUpDrawPositionIndex:t,inContextDrawMatchUps:r,projectedWinningSide:i,sourceMatchUpStatus:n,loserDrawPosition:a,tournamentRecord:o,loserTargetLink:s,drawDefinition:c,loserMatchUp:u,dualMatchUp:d,matchUpsMap:l,event:p}=e,m="directLoser",f=s.linkCondition,h=u.drawPositions||[],g=f===Vs&&2===u.roundNumber&&Math.min(...h.filter(Boolean)),U=g||h[t],v=g||h[1-t],y=s.source.structureId,{structure:S}=yc({structureId:y,drawDefinition:c}),{matchUps:w}=Kp({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:S,event:p}),P=w.filter((e=>e.drawPositions?.includes(a))).filter((e=>{let t=e.sides.find((e=>e.drawPosition===a)),r=e.matchUpStatus===ss||e.matchUpStatus===Xo&&!Um(e);return t?.sideNumber===e.winningSide&&!r})),D=f===Vs&&0===P.length,{positionAssignments:T}=Dc({structureId:y,drawDefinition:c}),b=T?.find((e=>e.drawPosition===a))?.participantId,R=s.target.structureId,{positionAssignments:M}=Dc({structureId:R,drawDefinition:c}),N=M?.filter((({drawPosition:e})=>h.includes(e)));if(N?.some((e=>e.participantId===b)))return{...I};let A=N?.filter((e=>{let t=h.includes(e.drawPosition),r=!e.participantId&&!e.bye&&!e.qualifier;return t&&r})).map((e=>e.drawPosition)),E=A?.includes(U),C=s.target.roundNumber>1&&A?.length,O=1===s.target.roundNumber&&E;if(g){let e=function(){let e="loserLinkFedFMLC";return en(D?{result:k(),stack:e}:{result:F(),stack:e})}();if(e.error)return en({result:e,stack:m})}else if(O){let e=k();if(e.error)return en({result:e,stack:m})}else{if(!b||!C)return en({result:{error:B},context:{loserDrawPosition:a,loserTargetLink:s},stack:m});{A.sort(kr);let e=A[0],t=ph({participantId:b,structureId:R,drawPosition:e,inContextDrawMatchUps:r,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:c,matchUpsMap:l,event:p});if(t.error)return en({result:t,stack:m})}}if(S?.seedAssignments&&S.structureId!==R){let e=S.seedAssignments.find((({participantId:e})=>e===b)),t=e?.participantId;e&&t&&Zf({eventId:u?.eventId,structureId:R,...e,tournamentRecord:o,drawDefinition:c,participantId:t})}if(d&&i){let e=d.sides?.find((e=>e.sideNumber===3-i));if(e?.lineUp){let{roundNumber:t,eventId:r}=u,{roundPosition:i}=d,n=1===t?2-i%2:1,a=l?.drawMatchUps?.find((({matchUpId:e})=>e===u.matchUpId)),s=[1,2].map((e=>({...a.sides?.find((t=>t.sideNumber===e))||{},sideNumber:e})));a.sides=s;let p=a.sides.find((e=>e.sideNumber===n));p&&(p.lineUp=sh({lineUp:e.lineUp}),iu({tournamentId:o?.tournamentId,matchUp:a,context:m,drawDefinition:c,eventId:r}))}}return{...I};function F(){return en({result:Mm({drawPosition:v,structureId:R,tournamentRecord:o,drawDefinition:c,event:p}),stack:"assignLoserPositionBye"})}function k(){return en({result:b?ph({drawPosition:U,participantId:b,structureId:R,inContextDrawMatchUps:r,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:c,matchUpsMap:l,event:p}):{error:It},stack:"assignLoserDrawPosition"})}}({sourceMatchUpStatus:i&&u||Qo,loserMatchUpDrawPositionIndex:P,sourceMatchUpId:f,inContextDrawMatchUps:o,projectedWinningSide:a,loserDrawPosition:n,tournamentRecord:s,loserTargetLink:h,drawDefinition:c,loserMatchUp:T,winningSide:p,matchUpsMap:l,dualMatchUp:d,event:U});if(e.error)return en({result:e,stack:v})}if(b){let e=b.drawPositions||[],t=Mm({drawPosition:Math.min(...e.filter(Boolean)),structureId:y.target.structureId,tournamentRecord:s,drawDefinition:c,event:U});if(t.error)return en({result:t,stack:v})}}return en({result:{...I,...r},stack:v})}function nU(e){let t="genPlayoffStructure";if(!e.drawDefinition)return en({result:{error:M},stack:t});let r=kg(e);if(r.error)return en({result:r,stack:t});let{structureId:i,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:o,finishingPositionLimit:s,playoffAttributes:c,playoffPositions:u,roundOffsetLimit:d,tournamentRecord:l,exitProfileLimit:p,roundProfiles:m,roundNumbers:f,idPrefix:h,isMock:g,event:U,uuids:v}=e,y=Da(e.drawDefinition,!1,!0),{structure:S}=yc({structureId:i,drawDefinition:y});if(!S)return en({result:{error:ae},stack:t});if(S.structureType===Es||S.structures)return function(e){let t="generateAndPopulateRRplayoffStructures";if(!e.playoffGroups)return en({result:{error:He},info:"playoffGroups required",stack:t});let{sourceStructureId:r,requireSequential:i,tournamentRecord:n,drawDefinition:a,playoffGroups:o,groupCount:s,groupSize:c,event:u}=e,{structures:d=[],links:l=[],finishingPositionTargets:p,positionRangeMap:m,error:f}=jg({requireSequential:i,sourceStructureId:r,playoffGroups:o,groupCount:s,groupSize:c,...e});if(f)return{error:f};let h=p?.map((({finishingPositions:e})=>e)).flat().map((e=>m[e].finishingPositions)).flat();a.structures.push(...d),a.links.push(...l);let{matchUps:g,matchUpsMap:U}=am({inContext:!0,drawDefinition:a}),v=d.map((({structureId:e})=>e)),y=g?.filter((({structureId:e})=>v.includes(e))).map(qo),S=U?.drawMatchUps?.filter((({matchUpId:e})=>y?.includes(e)));if(S?.length){let t=pp({drawDefinition:a,event:u})?.tieFormat;t&&S.forEach((r=>{let{tieMatchUps:i}=qg({isMock:e.isMock,tieFormat:t,matchUp:r});Object.assign(r,{tieMatchUps:i,matchUpType:gu})}))}let{positionAssignments:w}=Pc({structureId:r,drawDefinition:a}),P={};w?.forEach((e=>{let t=no({element:e,name:Mo})?.extension?.value?.groupOrder;t&&(P[t]||(P[t]=[]),P[t].push(e.participantId))}));let D=tg({provisionalPositioning:e.provisionalPositioning,structureId:r,applyPositioning:!0,event:e.event,tournamentRecord:n,drawDefinition:a});return D.error&&D.error?.code!==C.code?en({result:D,stack:t}):{structures:d,links:l,positionsPlayedOff:h,drawDefinition:a,...I}}({sourceStructureId:S.structureId,...e,...r,drawDefinition:y});let{playoffRoundsRanges:w,playoffRounds:P}=r,{playoffPositionsReturned:D,error:T,playoffSourceRounds:b,playoffRoundsRanges:R}=Fg(e);if(T)return en({result:{error:T},stack:t});let N=m?.length&&Object.assign({},...m),A=f||"object"==typeof m&&m.map((e=>Object.keys(e))).flat(),E=Array.isArray(A)&&A.map((e=>!isNaN(e)&&xr(e))).filter(Boolean);if(E){if(!Array.isArray(E))return en({result:{error:mr},context:{validRoundNumbers:E},stack:t});E.forEach((e=>{if(!P?.includes(e))return en({result:{error:mr},context:{roundNumber:e},stack:t})}))}u&&u.forEach((e=>{if(!D?.includes(e))return en({result:{error:mr},context:{playoffPosition:e},stack:t})}));let O=E||b,F=E?w:R,k=[],x=[];for(let I of O??[]){let e=F?.find((e=>e.roundNumber===I));if(!e)return en({result:{error:mr},context:{roundNumber:I},stack:t});let r=e.finishingPositions.length,u=Math.min(...e.finishingPositions)-1,l=2,m=I&&N?.[I]&&l+N[I]-1,f=Mg({exitProfile:`0-${I}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:u,playoffAttributes:c,exitProfileLimit:p,stage:Ss,roundOffset:0,drawDefinition:y,sequenceLimit:m,stageSequence:l,drawSize:r,idPrefix:h,isMock:g,uuids:v,finishingPositionNaming:o,finishingPositionLimit:s,roundOffsetLimit:d});if(f.error)return en({result:f,stack:t});let{structures:U,links:S}=f;if(U?.length&&k.push(...U),S?.length&&x.push(...S),f.structureId&&I){let e={linkType:Ls,source:{structureId:i,roundNumber:I},target:{structureId:f.structureId,feedProfile:Fs,roundNumber:1}};x.push(e)}}if(!k.length)return en({result:{error:mr},info:"No structures generated",stack:t});y.structures.push(...k),y.links.push(...x);let{matchUps:_,matchUpsMap:L}=am({inContext:!0,drawDefinition:y}),V=k.map((({structureId:e})=>e)),B=_?.filter((({structureId:e})=>V.includes(e))).map(qo),j=L?.drawMatchUps?.filter((({matchUpId:e})=>B?.includes(e)));if(j?.length){let e=pp({drawDefinition:y,event:U})?.tieFormat;e&&j.forEach((t=>{let{tieMatchUps:r}=qg({matchUp:t,tieFormat:e,isMock:g});Object.assign(t,{tieMatchUps:r,matchUpType:Iu})}))}_?.filter((e=>Qp({matchUp:e})&&e.structureId===i))?.forEach((e=>{let{matchUpId:t,score:r,winningSide:i}=e,n=tm({inContextDrawMatchUps:_,drawDefinition:y,matchUpId:t}),a=iU({inContextDrawMatchUps:_,tournamentRecord:l,drawDefinition:y,matchUpsMap:L,winningSide:i,targetData:n,matchUpId:t,structure:S,matchUp:e,score:r,event:U});a.error&&console.log(a.error)})),_?.filter((e=>e.matchUpStatus===Yo&&e.structureId===i))?.forEach((e=>{let{matchUpId:t}=e,r=tm({inContextDrawMatchUps:_,drawDefinition:y,matchUpId:t}),{targetLinks:{loserTargetLink:i},targetMatchUps:{loserMatchUpDrawPositionIndex:n,loserMatchUp:a}}=r;if(i&&a){let e=i.target.structureId,t=Mm({drawPosition:a.drawPositions[n],structureId:e,tournamentRecord:l,drawDefinition:y,event:U});t.error&&console.log(t.error)}}));let G=[],q=gm({inContextDrawMatchUps:_,drawDefinition:y,matchUpsMap:L}).goesToMap,{structure:$}=yc({drawDefinition:e.drawDefinition,structureId:i}),{matchUps:W}=Kp({structure:$});return W.forEach((r=>{let i=q?.loserMatchUpIds[r.matchUpId];if(i&&r.loserMatchUpId!==i){r.loserMatchUpId=i;let n={tournamentId:l?.tournamentId,eventId:e.event?.eventId,context:t,matchUp:r};G.push(n)}let n=q?.winnerMatchUpIds[r.matchUpId];if(n&&r.winnerMatchUpId!==n){r.winnerMatchUpId=n;let i={tournamentId:l?.tournamentId,eventId:e.event?.eventId,context:t,matchUp:r};G.push(i)}})),{structures:k,matchUpModifications:G,links:x,drawDefinition:y,...I}}function aU(e){return sU({...e,itemType:"attachConsolationStructures"})}function oU(e){return sU({...e,itemType:"attachPlayoffStructures"})}function sU({itemType:e="attachStructures",matchUpModifications:t,tournamentRecord:r,drawDefinition:i,structures:n,links:a=[],event:o}){let s="attachStructures";if(!i)return{error:M};if(!Array.isArray(n)||!Array.isArray(a))return en({result:{error:mr},stack:s});let c=e=>[e.source.structureId,e.source.roundNumber||e.source.finishingPositions?.join("|"),e.target.roundNumber].join("|"),u=i.links?.map(c);if(a.some((e=>{let t=c(e);return u?.includes(t)})))return en({result:{error:br},info:"playoff structure exists",stack:s});a.length&&i.links?.push(...a);let d=n.map((({structureId:e})=>e)),l=i.structures?.map((({structureId:e})=>e));i.structures=(i.structures??[]).map((e=>d.includes(e.structureId)?n.find((({structureId:t})=>t===e.structureId)):e));let p=n?.filter((({structureId:e})=>!l?.includes(e)));p.length&&i.structures.push(...p),gm({drawDefinition:i});let m=n.map((e=>Kp({structure:e})?.matchUps||[])).flat();tu({tournamentId:r?.tournamentId,eventId:o?.eventId,drawDefinition:i,matchUps:m});let f=n.map((({structureId:e})=>e));if(au({drawDefinition:i,structureIds:f}),t?.length){let e={};t.forEach((t=>{let r=t.matchUp?.matchUpId;r&&(e[r]=t)}));let r=t=>{t.matchUps.forEach((t=>{if(e[t.matchUpId]){let{tieMatchUps:r,...i}=e[t.matchUpId].matchUp;if(Object.assign(t,i),r?.length){let i={};r.forEach((t=>e[t.matchUpId]=t)),t.tieMatchUps.forEach((e=>Object.assign(e,i[e.matchUpId])))}e[t.matchUpId].matchUp=t,iu(e[t.matchUpId])}}))};i.structures.forEach((e=>{if(l?.includes(e.structureId))if(e.structures)for(let t of e.structures)r(t);else r(e)}))}let h=p.map(fm("structureId"));if(r){ag({element:r,timeItem:{itemValue:{structureIds:f,drawId:i.drawId},itemType:e}})}return{...I,addedStructureIds:h}}function cU(e){let{structures:t,links:r,matchUpModifications:i,error:n}=nU(e);if(n)return{error:n};let a=e.drawDefinition;return oU({tournamentId:e.tournamentRecord?.tournamentId,eventId:e.event?.eventId||e.eventId,matchUpModifications:i,drawDefinition:a,structures:t,links:r})}function uU(e){let t=xn(e,[{_anyOf:{[tn]:!1,[nn]:!1,[an]:!1,[Dn]:!1},[rn]:!0}]);if(t.error)return t;let r=[],i=e.drawDefinition??e.event??((e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord);if(i){let t=dU(e,i);if(t.error)return t;r.push(...t?.applied??[]),e.drawDefinition&&au({drawDefinition:e.drawDefinition,tournamentId:e.tournamentId})}else{if(!e.tournamentRecords)return{error:D};{let t=Object.keys(e.tournamentRecords);if(!t.length)return{error:D};for(let i of t){let t=dU(e,e.tournamentRecords[i]);if(t.error)return t;r.push(...t?.applied??[])}}}return r.length?{...I,applied:r}:{error:je}}function dU(e,t){let r=Yu(e).appliedPolicies??{};t.extensions||(t.extensions=[]);let i=[],n=Object.keys(e.policyDefinitions);if(!n.length)return{error:_e};for(let a of n)if(!r[a]||e.allowReplacement){let t=e.policyDefinitions[a];if(!t)continue;if(!d(t))return{error:mr};let{policyName:n,...o}=t;if(!o||!Object.keys(o).length||n&&!u(n))return{error:mr};r[a]=e.policyDefinitions[a],i.push(a)}return i?.length?{...za({element:t,extension:{name:ao,value:r}}),applied:i}:{applied:i,error:je}}function lU({tournamentRecord:e,drawDefinition:t,flightProfile:r,drawName:i,drawId:n,event:a}){if(!i||"string"!=typeof i)return en({result:{error:mr},context:{drawName:i}});r||(r=op({event:a}).flightProfile);let o=r?.flights?.find((e=>e.drawId===n));if(o){o.drawName=i,Qa({event:a,extension:{name:ho,value:{...r,flights:r.flights}}})}return t&&(t.drawName=i,au({tournamentId:e?.tournamentId,drawDefinition:t})),o||t?{...I,flight:o}:{error:M}}function pU({tournamentRecord:e,drawDefinition:t,drawUpdates:r,drawId:i,event:n}){if(!d(r))return{error:mr};let a=op({event:n}).flightProfile,o=r.drawName&&lU({drawName:r.drawName,tournamentRecord:e,drawDefinition:t,flightProfile:a,drawId:i,event:n});if(o?.error)return o?.error;let s=o?.flight||a?.flights?.find((e=>e.drawId===i));if(!s&&!t)return{error:M};if(s){Qa({event:n,extension:{name:ho,value:{...a,flights:a.flights}}})}return t&&(r.policyDefinitions&&uU({policyDefinitions:r.policyDefinitions,drawDefinition:t}),au({tournamentId:e?.tournamentId,drawDefinition:t})),{...I}}function mU({tournamentRecord:e,removeScheduling:t,drawDefinition:r}){if(!r)return{error:M};let i=mp({drawDefinition:r}),n=e=>i?.drawMatchUps?.find((t=>t.matchUpId===e));for(let a of r.structures||[]){let{positionAssignments:o,stage:s,stageSequence:c}=a;o&&(1!==c||![Us,Is].includes(s))&&(a.positionAssignments=o.map((e=>(delete e.participantId,e))),a.seedAssignments=[]);let{matchUps:u,isRoundRobin:d}=Kp({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:i,structure:a});for(let i of u){let{matchUpId:a,roundNumber:o}=i,s=i.sides||[],c=n(a);if(c){if(delete c.extensions,delete c.notes,c.matchUpStatus!==Yo&&Object.assign(c,NI),o&&o>1&&c.drawPositions?.length&&!d){let e=s?.map((({drawPosition:e,participantFed:t})=>!t&&e)).filter(Boolean),t=c.drawPositions.map((t=>e.includes(t)?void 0:t));c.drawPositions=t}t?delete c.timeItems:c.timeItems?.length&&(c.timeItems=c.timeItems.filter((e=>e.itemType&&![jd,Gd,Bd,Hd,$d,zd].includes(e.itemType)))),iu({tournamentId:e?.tournamentId,context:"resetDrawDefiniton",drawDefinition:r,matchUp:c})}}}return au({drawDefinition:r,structureIds:(r.structures||[]).map((({structureId:e})=>e))}),{...I}}function fU({tournamentRecord:e}){if(!e)return{error:D};let t={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},r={};return(e.events?.map((e=>{let t=e.eventId;return r[t]=e,(e?.drawDefinitions||[]).map((e=>({drawDefinition:e,eventId:t})))})).flat().filter(Boolean)).forEach((({drawDefinition:e,eventId:i})=>{let n=0,a=0,o=0,{allStructuresLinked:s}=ig({drawDefinition:e}),c=r[i],u=(e?.structures||[]).map((t=>{let{stage:r,stageSequence:i,structureId:s}=t,u=Ps[r],{inContextStructureMatchUps:d}=wm({drawDefinition:e,structure:t,event:c}),l=d?.filter((({winningSide:e})=>e)),p=l.filter(Boolean).length||0;a+=p,o+=d.length-a;let m=Math.max(l.filter((({roundNumber:e})=>1===e)).map((({roundPosition:e})=>e))),{positionAssignments:f}=Pc({structure:t}),h=f?.filter((({participantId:e})=>e));n+=h?.length??0;let g=(f?.length??0)-(h?.length??0),{roundMatchUps:I,roundProfile:U,roundNumbers:v,maxMatchUpsCount:y}=Up({matchUps:d}),S=U&&Object.keys(U).filter((e=>!U[e].inactiveRound)).map((e=>parseInt(e))),w=U&&Object.keys(U).filter((e=>U[e].inactiveRound)).map((e=>parseInt(e))),P=U&&Object.values(U).every((e=>e.inactiveRound));return{positionsAssignedCount:h?.length??0,maxWinningSideFirstRoundPosition:m,unassignedPositionsCount:g,inactiveStructure:P,maxMatchUpsCount:y,inactiveRounds:w,roundMatchUps:I,activeRounds:S,roundNumbers:v,roundProfile:U,structureId:s,stageSequence:i,orderNumber:u,stage:r}})),d=u.find((e=>2===e.orderNumber&&1===e.stageSequence)),l=u.filter((({inactiveStructure:e})=>!e)).length,{links:p}=Zp({structureId:d.structureId,drawDefinition:e}),m=1===xr(d.activeRounds[0])&&1===d.activeRounds.length&&1===l,f=u?.every((({inactiveStructure:e})=>e)),h=!p.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),g=e.drawId;n&&!a&&t.positionsNoOutcomes.push(g),f&&t.inactive.push(g),m&&t.matchPlay.push(g),h&&t.canBePruned.push(g);let I={matchUpsWithWinningSideCount:a,matchUpsNoOutcomeCount:o,positionsAssignedCount:n,allStructuresLinked:s,structuresData:u,inactiveDraw:f,isMatchPlay:m,drawId:g};t.drawAnalysis[g]=I})),{...I,drawsAnalysis:t}}function hU({matchPlayDrawPositions:e=!0,tournamentRecord:t,drawDefinition:r,drawId:i}){if(!t)return{error:D};if(!r)return{error:M};let n=[],{drawsAnalysis:a}=fU({tournamentRecord:t});if(a.canBePruned.includes(i)){let o=a.matchPlay.includes(i),s=a.drawAnalysis[i],{structures:[c]}=Sc({stageSequence:1,drawDefinition:r,stage:Is}),u=s.structuresData.find((({structureId:e})=>c.structureId===e)),d=(c.matchUps??[]).sort(((e,t)=>e.roundPosition-t.roundPosition));n=d.filter((({roundNumber:e})=>!u.inactiveRounds.includes(e)));let l=n.map(qo),p=d.map(qo).filter((e=>!l.includes(e)));if(o){let t=n.filter((({roundNumber:e})=>!u.inactiveRounds.includes(e))).filter((({winningSide:e})=>e)),r=t.map(qo),i=l.filter((e=>!r.includes(e)));p.push(...i);let a=t.flatMap((e=>e.drawPositions??[])).filter(Boolean).flat(),o=Object.assign({},...a.map(((e,t)=>({[e]:t+1}))));if(t.forEach((t=>{e?t.drawPositions=t.drawPositions.map((e=>o[e])):delete t.drawPositions})),e){let e=c?.positionAssignments?.filter((e=>a.includes(e.drawPosition))).map((e=>(e.drawPosition=o[e.drawPosition],e)));c.positionAssignments=e}else c.positionAssignments=[];c.matchUps=t,n=t}ru({tournamentId:t?.tournamentId,matchUpIds:p,drawDefinition:r}),au({drawDefinition:r})}return{...I,matchUps:n}}function gU({tournamentRecord:e,drawDefinition:t,participantId:r,drawPosition:i,structureId:n,qualifier:a,event:o,bye:s}){if(!t)return{error:M};if(!i)return{error:j};if(!n)return{error:ne};if(s){let r=Mm({tournamentRecord:e,drawDefinition:t,drawPosition:i,structureId:n,event:o});if(r.error)return r}else{if(a)return{error:yr};{let a=ph({tournamentRecord:e,drawDefinition:t,participantId:r,drawPosition:i,structureId:n,event:o});if(a.error)return a}}return{...I}}function IU(e){let t=e.matchUpIds??[],{drawDefinition:r}=e,i=e.structureId??r?.structures?.find((e=>e.matchUps?.some((({matchUpId:e})=>t.includes(e)))))?.structureId??r?.structures?.[0]?.structureId;if(!i)return{error:ae};let n=r.structures?.find((e=>e.structureId===i));if(!n)return{error:ae};let a=n?.matchUps,o=a?.find((e=>!!e.roundPosition));if(n.structures||o||n.finishingPosition===fc)return{error:E};let s=a.filter((({roundNumber:t})=>e.roundNumbers?.includes(t))).map(qo);return t=t.filter((e=>!s.includes(e))),e.roundNumbers&&!t.length&&(t=s),{existingMatchUps:a,matchUpIds:t,structureId:i,structure:n}}function UU(e){let t=xn(e,[{[an]:!0},{[On]:{[ln]:!1,roundNumbers:!1},[An]:mr,[En]:Rn}]);if(t.error)return t;let{removeIncomplete:r=!1,removeUnAssigned:i=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:o,event:s}=e,c=IU(e);if(c.error)return c;let{structure:u,structureId:d,existingMatchUps:l,matchUpIds:p}=c,m=[],f=l?.filter((({matchUpId:e,score:t,winningSide:a})=>{if(a&&!n)return!1;if(a||Um({score:t})){if(!a&&!r)return!1;m.push(e)}else if(!i)return!1;return p?.includes(e)}))??[],h=f.map(qo),g=f.map((({tieMatchUps:e})=>e?.map(qo))).filter(Boolean).flat();if(h.length){u.matchUps=(u.matchUps??[]).filter((({matchUpId:e})=>!h.includes(e))),ru({tournamentId:a?.tournamentId,matchUpIds:[...g,...h],action:"deleteAdHocMatchUps",eventId:s?.eventId,drawDefinition:o});let e=function(e,t=1){return Array.isArray(e)&&e.every(Wr)?ai(Math.min(...e,t),Math.max(...e)+1).filter((t=>!e.includes(t))):[]}(Yr(u.matchUps.map(fm("roundNumber"))));if(e.length){e.reverse();for(let t of e)u.matchUps.forEach((e=>{e.roundNumber&&e.roundNumber>t&&(e.roundNumber-=1,iu({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:s?.eventId,drawDefinition:o,matchUp:e}))}))}if(m.length){u.positionAssignments=Yr(u.matchUps.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e})));let e=u?.matchUpFormat??o?.matchUpFormat??s?.matchUpFormat,{matchUps:t}=Kp({afterRecoveryTimes:!1,inContext:!0,structure:u,event:s}),r=DI({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:e,matchUps:t,event:s});r.error&&console.log(r)}au({structureIds:[d],eventId:s?.eventId,drawDefinition:o})}return!h.length&&p.length?{error:Nr}:{...I,deletedMatchUpsCount:[...h,...g].length}}function vU({removeCompletedMatchUps:e,tournamentRecord:t,drawDefinition:r,structureId:i,roundNumber:n,event:a}){if(!t)return{error:D};if(!r)return{error:M};if(!n)return en({result:{error:He},info:"roundNumber required"});let o=yc({drawDefinition:r,structureId:i});if(o.error)return o;let s=o.structure;return s?.structures?{error:E}:Tp({structure:s})?function({removeCompletedMatchUps:e,drawDefinition:t,tournamentId:r,roundNumber:i,structure:n,eventId:a}){let o=n?.matchUps??[],s=[],c=[],u=!1;if(o.reduce(((e,t)=>{let r=t?.roundNumber;return r?e.includes(r)?e:e.concat(r):e}),[]).sort(kr).includes(i)){let d=o.filter((t=>{let r=t.roundNumber===i&&(!ms.includes(t.matchUpStatus)||e);return r&&(c.push(t.matchUpId),t.tieMatchUps&&s.push(...t.tieMatchUps.map(qo))),!r}));c.length&&(ru({matchUpIds:[...s,...c],drawDefinition:t,tournamentId:r,eventId:a}),d.some((e=>e.roundNumber===i))||(d.forEach((e=>{e.roundNumber>i&&(e.roundNumber-=1,iu({drawDefinition:t,tournamentId:r,eventId:a,matchUp:e}))})),u=!0),n.matchUps=d)}return{deletedMatchUpsCount:c.length,roundRemoved:u,...I}}({tournamentId:t.tournamentId,removeCompletedMatchUps:e,eventId:a.eventId,drawDefinition:r,roundNumber:n,structure:s}):(console.log("not implemented"),{...I})}function yU(e){let{suppressNotifications:t,tournamentRecord:r,drawDefinition:i,matchUps:n,event:a}=e;if("object"!=typeof i)return{error:M};let o=e?.structureId;if(!o&&1===i.structures?.length&&(o=i.structures?.[0]?.structureId),"string"!=typeof o)return{error:ne};if(!Ip(n))return{error:mr,info:ch("matchUps")};let s=i.structures?.find((e=>e.structureId===o));if(!s)return{error:ae};let c=(s?.matchUps).find((e=>!!e.roundPosition));if(s.structures||c||s.finishingPosition===fc)return{error:E};if(ui(cm({tournamentRecord:r,inContext:!1})?.matchUps?.map(qo)??[],n.map(qo)))return{error:Dr,info:"One or more matchUpIds already present in tournamentRecord"};s.matchUps.push(...n);let u=n.map((({tieMatchUps:e})=>e)).filter(Boolean).flat();return t||(tu({tournamentId:r?.tournamentId,matchUps:[...u,...n],eventId:a?.eventId,drawDefinition:i}),au({drawDefinition:i,structureIds:[o]})),{...I}}function SU({tournamentRecord:e,drawDefinition:t,drawPosition:r,structureId:i,subOrder:n,event:a}){if(!t)return{error:M};if(!i)return{error:ne};if(!r)return{error:j};let{structure:o}=yc({drawDefinition:t,structureId:i});if(!o)return{error:ae};let s=o;o.structures&&o.structureType===Es&&(s=o.structures?.find((e=>e.positionAssignments?.find((e=>e.drawPosition===r)))));let c=s?.positionAssignments,u=c?.find((e=>e.drawPosition===r));u&&za({element:u,extension:{name:Ro,value:n}});let d=(a?.eventType===Iu||t.matchUpType===Iu||(a?.tieFormat??t?.tieFormat??o?.tieFormat))&&{matchUpTypes:[Iu]},{matchUps:l}=Kp({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:a});return DI({positionAssignments:c,tournamentRecord:e,drawDefinition:t,matchUpFormat:o?.matchUpFormat??t.matchUpFormat,matchUps:l,event:a}),au({drawDefinition:t,structureIds:[i]}),{...I}}var wU={};function PU({excludedMatchUpStatuses:e=[],includeEventParticipants:t,includeQualifyingStage:r,finishingRoundLimit:i,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:c,requirePlay:u,requireLoss:d,allEntries:l,winsLimit:p,event:m}){if(!s)return{error:M};let f=[Is,Ss];r&&f.push(Us);let h=m?.eventType?{matchUpTypes:[m.eventType]}:void 0,g=s?.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,U=t&&m?sm({contextFilters:{stages:f},matchUpFilters:h,tournamentRecord:o,inContext:!0,event:m})?.matchUps??[]:lm({contextFilters:{stages:f},matchUpFilters:g,tournamentRecord:o,inContext:!0,drawDefinition:s})?.matchUps??[],v=Nd({stage:ys,drawDefinition:s}).map((({participantId:e})=>e)),y={},S={},w={},P={};n||(n=Ku({policyTypes:[ba],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let D=n?.[ba];e=e.length&&e||D?.excludedMatchUpStatuses||[],t=t??D?.includeEventParticipants,l=l??D?.allEntries,i=i??D?.finishingRoundLimit,a=a??D?.roundNumberLimit,c=c??D?.matchUpsLimit,void 0===u&&(u=void 0===D?.requirePlay||D.requirePlay),void 0===d&&(d=void 0===D?.requireLoss||D.requireLoss),p=p??D?.winsLimit;for(let I of U){if(u&&I.winningSide&&![1,2].includes(I.winningSide)&&I.matchUpStatus!==es||I.finishingRound&&i&&I.finishingRound>=i||I.finishingRound&&a&&I.finishingRound<=a)continue;let t=I.sides?.find((({sideNumber:e})=>I.winningSide&&e===3-I.winningSide)),r=I.sides?.find((({sideNumber:e})=>I.winningSide&&e===I.winningSide));if(I.sides?.forEach((t=>{let r=t?.participant?.participantId;r&&(w[r]=t.participant,I.matchUpStatus===es&&!u&&(S[r]=t.participant,y[r]||(y[r]=0),(!I.matchUpStatus||!e.includes(I.matchUpStatus))&&(y[r]+=1)))})),t?.participant){let r=t.participant.participantId;S[r]=t.participant,y[r]||(y[r]=0),I.matchUpStatus&&!e.includes(I.matchUpStatus)&&(y[r]+=1)}if(r?.participant){let t=r.participant.participantId;P[t]||(P[t]=0),P[t]+=1,y[t]||(y[t]=0),I.matchUpStatus&&!e.includes(I.matchUpStatus)&&(y[t]+=1)}}let T=o?.participants&&!u&&!d&&l,b=T?((t&&m?m.entries:s.entries)??[]).filter((e=>![yd,Id].includes(e.entryStatus))).map((({participantId:e})=>e)):[],R=Object.keys(S),N=T?(o?.participants??[]).filter((({participantId:e})=>b.includes(e))):d&&Object.values(S)||Object.values(w);return{eligibleParticipants:N.filter((e=>(e=>!d||R.includes(e))(e.participantId)&&(e=>!u||(y[e]||0)>=0)(e.participantId)&&(e=>!p||(P[e]||0)<=p)(e.participantId)&&(e=>!c||y[e]<=c)(e.participantId)&&(e=>!v.includes(e))(e.participantId))).map((e=>({...e,individualParticipants:e.individualParticipantIds?.map((e=>o?.participants?.find((t=>t.participantId===e))))}))),losingParticipantIds:R,...I}}function DU(e){let t=xn(e,[{drawDefinition:!0}]);if(t.error)return t;let{drawDefinition:r,roundNumber:i}=e,n=e.structureId??(1===r.structures?.length&&r.structures?.[0]?.structureId);if("string"!=typeof n)return{error:ne};let a=r.structures?.find((e=>e.structureId===n));if(!a)return{error:ae};let o,s=(a.matchUps??[])?.reduce(((e,t)=>(t.roundPosition&&(o=!0),(t?.roundNumber||0)>e?t.roundNumber:e)),0);if(a.structures||o||a.finishingPosition===fc)return{error:E};let c=r?.entries?.filter((e=>{let t=e.entryStatus;return Dd.includes(t)}))??[],u=Math.floor(c?.length/2)||1,d=i??s??1,l=u-(a.matchUps?.filter((e=>e.roundNumber===d))?.length??0),p=l>0?l:0;return{...I,availableMatchUpsCount:p,lastRoundNumber:s,roundMatchUpsCount:u}}function TU({drawDefinition:e}){let t=no({name:"participantRepresentatives",element:e});return t.error?t:{representativeParticipantIds:t.extension?.value||[]}}function bU({byeAdvancements:e=!1,tournamentRecord:t,drawDefinition:r}){if(!r)return{error:M};let{participantIds:i,participantIdMatchUps:n}=function({tournamentParticipants:e,drawDefinition:t,event:r}){if(!t)return{error:M};let i=Da(am({tournamentParticipants:e,inContext:!0,drawDefinition:t,event:r}).matchUps,!1,!0),n=Yr(i.reduce(((e,t)=>e.concat(...t.sides.map((e=>e.participantId)).filter(Boolean))),[])),a=Object.assign({},...n.map((e=>{let t=i.filter((t=>t.sides.map((e=>e.participantId)).filter(Boolean).includes(e)));return{[e]:t}})));return{participantIds:n,participantIdMatchUps:a}}({tournamentParticipants:t?.participants,drawDefinition:r}),a=i?.map((t=>{let r=n[t].filter((e=>[Qo,Yo].includes(e.matchUpStatus)||e.winningSide)),i=r.map((r=>{let i=r.sides.find((e=>e.bye)),n=r.sides.find((e=>e.participantId===t)).sideNumber;return(r.winningSide||e&&i&&n)===n?r.finishingPositionRange.winner:r.finishingPositionRange.loser})),a=e=>Math.abs(e[0]-e[1]),o=i.reduce(((e,t)=>e&&a(e)<a(t)?e:t),void 0);return{[t]:{relevantMatchUps:r,finishingPositionRanges:i,finishingPositionRange:o}}}))||[];return Object.assign({},...a)}function RU({tournamentRecords:e,tournamentRecord:t,tournamentId:r,drawId:i}){if(!t&&!e)return{error:D};if(!i)return{error:H};if(!t&&e){if("string"!=typeof r&&!(r=tU({tournamentRecords:e,drawId:i})))return{error:b};if(!(t=e[r]))return{error:D}}let n=t&&sp({tournamentRecord:t,drawId:i});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:t,...I}:en({result:{error:A},stack:"findDrawDefinition"})}function MU(e){let{drawDefinition:t,error:r}=RU(e);return r?{error:r}:{drawDefinition:Da(t)}}function NU({targetRoundNumber:e,finishingPosition:t,drawDefinition:r,structureId:i,linkType:n}){let{links:a}=Zp({drawDefinition:r,structureId:i})||{},o=(a?.target||[]).filter((({linkType:e})=>e===n)).filter((({target:t})=>!e||e===t.roundNumber)).map((e=>{let i=e.source.structureId,{structure:n}=yc({structureId:i,drawDefinition:r});if(!t||n?.finishingPosition===t)return e})).filter(Boolean);return{sourceStructureIds:o.map((({source:e})=>e.structureId)),relevantLinks:o}}n(wU,{addGoesTo:()=>gm,allPlayoffPositionsFilled:()=>Ah,checkValidEntries:()=>Bv,findDrawDefinition:()=>MU,getAssignedParticipantIds:()=>_m,getAvailableMatchUpsCount:()=>DU,getAvailablePlayoffProfiles:()=>kg,getDrawDefinitionTimeItem:()=>_u,getDrawParticipantRepresentativeIds:()=>TU,getDrawTypeCoercion:()=>kv,getEligibleVoluntaryConsolationParticipants:()=>PU,getMatchUpsMap:()=>mp,getParticipantIdFinishingPositions:()=>bU,getPositionAssignments:()=>xv,getPositionsPlayedOff:()=>Og,getSeedingThresholds:()=>Wf,getSeedsCount:()=>Vv,getStructureSeedAssignments:()=>Ad,getTeamLineUp:()=>wp,getValidGroupSizes:()=>Gf,isAdHoc:()=>Tp,isCompletedStructure:()=>Nh,isValidForQualifying:()=>_v,positionActions:()=>Fv});var AU="qualifierDrawPositionAssignment",EU="withdrawParticipantAtDrawPosition",CU="alternateDrawPositionAssignment",OU="luckyLoserDrawPositionAssignment",FU="removeDrawPositionAssignment",kU="swapDrawPositionAssignments",xU="modifyPairAssignment",_U="modifyParticipantOtherName",LU="assignDrawPosition",VU="removeSeededParticipant",BU="assignDrawPositionBye",jU="modifySeedAssignment",GU="addPenalty",qU="MODIFY_PAIR",$U="QUALIFIER",WU="ALTERNATE",HU="WITHDRAW",zU="ASSIGN",YU="REMOVE",KU="LUCKY",QU="REMOVE_SEED",JU="SWAP",XU="NICKNAME",ZU="SEED_VALUE",ev="PENALTY",tv="BYE",rv={MODIFY_PAIR_ASSIGNMENT:qU,QUALIFYING_PARTICIPANT:$U,ALTERNATE_PARTICIPANT:WU,WITHDRAW_PARTICIPANT:HU,ASSIGN_PARTICIPANT:zU,LUCKY_PARTICIPANT:KU,REMOVE_ASSIGNMENT:YU,SWAP_PARTICIPANTS:JU,ADD_NICKNAME:XU,REMOVE_SEED:QU,ADD_PENALTY:ev,ASSIGN_BYE:tv,SEED_VALUE:ZU};function iv(e){let{inContextDrawMatchUps:t,targetData:r,drawDefinition:i,relevantLink:n}=e;if(n?.linkCondition===Vs&&r?.matchUp?.matchUpStatus===Yo)return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o},targetLinks:s}=r,c=[Xo,ss].includes(a?.matchUpStatus),u=o?.drawPositions?.filter(Boolean).length||0;if(a?.winningSide&&!c||o?.winningSide&&2===u&&(!o.feedRound||![ss,Xo].includes(o?.matchUpStatus)))return!0;let d=a&&tm({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:i}),l=o&&tm({matchUpId:o.matchUpId,inContextDrawMatchUps:t,drawDefinition:i}),p=d&&iv({relevantLink:s?.loserTargetLink,targetData:d,inContextDrawMatchUps:t,drawDefinition:i});return!!(l&&iv({targetData:l,inContextDrawMatchUps:t,drawDefinition:i})||p)}var nv={[Na]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Us,Is],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[XU,ev,$U,ZU],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},av="positionAction",ov="matchUpAction";function sv({actionType:e=av,appliedPolicies:t,drawDefinition:r,structure:i}){let n=e===av&&Na||e===ov&&Aa,a=e===av&&nv||e===ov&&lf,o=n&&(t?.[n]||a?.[n]),s=r.links?.filter((e=>e?.target?.structureId===i?.structureId))?.map((({target:e})=>e.feedProfile))??[],{enabledStructures:c,disabledStructures:u}=o||{},d=u?.find((e=>{let{stages:t,stageSequences:r,structureTypes:n,feedProfiles:a}=e;return(!a?.length||Array.isArray(a)&&a.some((e=>s.includes(e))))&&(!t?.length||Array.isArray(t)&&t?.includes(i?.stage))&&(!n?.length||Array.isArray(n)&&n?.includes(i?.structureType))&&(!r?.length||Array.isArray(r)&&r.includes(i?.stageSequence))}));return{enabledStructures:c,actionsDisabled:d,actionsPolicy:o}}function cv({activePositionOverrides:e,activeDrawPositions:t,action:r}){return!(!r||!e.includes(r))||!t.length}function uv({enabledStructures:e,drawDefinition:t,structure:r}){if(!1===e)return{};if(!e?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:i,stageSequence:n,structureType:a}=r||{},o=t.links?.filter((e=>e?.target?.structureId===r?.structureId))?.map((({target:e})=>e.feedProfile))||[];return{policyActions:e.find((e=>{let{stages:t,stageSequences:r,structureTypes:s,feedProfiles:c}=e||{},u=!t?.length||Array.isArray(t)&&t.includes(i),d=!r?.length||Array.isArray(r)&&r.includes(n),l=!s?.length||Array.isArray(s)&&s.includes(a),p=!c?.length||Array.isArray(c)&&c.some((e=>o.includes(e)));return d&&l&&p&&e&&u}))}}function dv({action:e,policyActions:t}){let r=!t?.enabledActions||t?.disabledActions?.length&&t.disabledActions.includes(e);return!r&&((0===t?.enabledActions.length||t?.enabledActions.includes(e))&&!r)}var lv="replaceTieMatchUpParticipantId",pv="assignTieMatchUpParticipantId",mv="removeTieMatchUpParticipantId",fv="assignMatchUpSideParticipant",hv="removeMatchUpSideParticipant",gv="substituteParticipant",Iv="REMOVE_SUBSTITUTION",Uv="REPLACE_PARTICIPANT",vv="REMOVE_PARTICIPANT",yv="setMatchUpStatus",Sv="SUBSTITUTION",wv="SCHEDULE",Pv="REFEREE",Dv="STATUS",Tv="START",bv="SCORE",Rv="END",Mv={REPLACE_TEAM_POSITION_METHOD:lv,ASSIGN_TEAM_POSITION_METHOD:pv,REMOVE_TEAM_POSITION_METHOD:mv,REPLACE_PARTICIPANT:Uv,SUBSTITUTION_METHOD:gv,REMOVE_SUBSTITUTION:Iv,REMOVE_PARTICIPANT:vv,SCHEDULE_METHOD:yv,SUBSTITUTION:Sv,SCHEDULE:wv,PENALTY:"PENALTY",REFEREE:Pv,STATUS:Dv,SCORE:bv,START:Tv,END:Rv};function Nv({restrictQualifyingAlternates:e,structure:t,entry:r}){let{stage:i}=t;if(!r.entryStage||r.entryStage===i||i===Us&&!e||r.entryStage===Is&&i===vs)return!0}function Av({restrictAdHocRoundParticipants:e,tournamentParticipants:t,matchUpParticipantIds:r,otherFlightEntries:i,drawDefinition:n,structureId:a,sideNumber:o,matchUpId:s,structure:c,matchUp:u,drawId:d,event:l}){let p=[],m=(c?.matchUps??[]).filter((({roundNumber:e})=>e===u.roundNumber)),f=n?.entries?.filter((({entryStatus:e})=>e&&Pd.includes(e))).map(Go)??[],h=m.map((e=>(e.sides??[]).flatMap(Go))).flat().filter(Boolean),g=f.filter((t=>!(r.includes(t)||e&&h.includes(t)))),I=t?.filter((e=>g?.includes(e.participantId))).map((e=>Da(e,void 0,!0)));I?.forEach((e=>{let t=(n.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),g.length&&p.push({payload:{drawId:d,matchUpId:s,structureId:a,sideNumber:o},method:fv,type:zU,availableParticipantIds:g,participantsAvailable:I});let U=function({eventEntries:e,structure:t}){return e.filter((e=>e.entryStatus===cd&&Nv({structure:t,entry:e}))).sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))).map(Go)}({eventEntries:l?.entries??[],structure:c}),v=Yr(f.concat(U));if(i){let e=(l?op({event:l}):void 0)?.flights?.filter((e=>e.drawId!==d)).flatMap((e=>e.drawEntries.filter((e=>e.participantId&&![yd,Id,Ud].includes(e.entryStatus))).map((({participantId:e})=>e)))).filter(Boolean);e?.length&&v.push(...e)}v=v.filter((t=>!(r.includes(t)||g.includes(t)||e&&h.includes(t))));let y=t?.filter((e=>v.includes(e.participantId))).map((e=>Da(e,void 0,!0)));return y?.forEach((e=>{let t=(n.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),y?.sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))),v.length&&p.push({payload:{drawId:d,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:v,participantsAvailable:y,method:fv,type:cd}),!Um(u)&&o&&u.sides?.find((e=>e.sideNumber===o))?.participantId&&p.push({payload:{drawId:d,matchUpId:s,structureId:a,sideNumber:o},method:hv,type:vv}),p}function Ev(e){if(!e)return{error:mr};let{drawDefinition:t,event:r}=e,{restrictAdHocRoundParticipants:i=!0,policyDefinitions:n,enforceGender:a,participantId:o,sideNumber:s,matchUpId:c}=e,d=e.tournamentRecord??(e.tournamentId&&u(e.tournamentId)&&e.tournamentRecords?.[e.tournamentId]);if(!d)return{error:D};if(!c||!u(c))return{error:Ae};if(s&&![1,2].includes(s))return en({result:{error:mr},context:{sideNumber:s}});if(!t){let e=(cm({tournamentRecord:d}).matchUps??[]).find((e=>e.matchUpId===c));r=(d?.events??[]).find((t=>t.eventId===e?.eventId));let i=(r?.drawDefinitions??[]).find((t=>t.drawId===e?.drawId));i&&(t=i)}if(!t)return{error:M};let l=ef({withIndividualParticipants:!0,tournamentRecord:d}).participants,{drawId:p}=t,{matchUp:m,structure:f}=bI({drawDefinition:t,matchUpId:c,event:r});if(!m)return{error:Ce};let h=Yu({tournamentRecord:d,drawDefinition:t,structure:f,event:r}).appliedPolicies??{};Object.assign(h,n??{});let g=h?.[Na]?.otherFlightEntries,U=h?.[Aa]??pf[Aa],{enabledStructures:v}=sv({actionType:ov,appliedPolicies:h,drawDefinition:t,structure:f}),{policyActions:y}=uv({enabledStructures:v,drawDefinition:t,structure:f}),S=e.matchUpsMap??mp({drawDefinition:t}),w=e.inContextDrawMatchUps??am({tournamentParticipants:l,inContext:!0,drawDefinition:t,matchUpsMap:S,event:r}).matchUps,P=w?.find((e=>e.matchUpId===c)),T=s&&P?.sides?.find((e=>e.sideNumber===s)),b=P?.sides?.map((e=>e.participantId||e.participant?.participantid)).filter(Boolean)??[],{assignedPositions:R,allPositionsAssigned:N}=Dc({structure:f}),{structureId:A}=f??{},E=[];if(!A)return{validActions:E};let C=Tp({structure:f}),O=m.collectionId;if(C&&!O){let e=Av({restrictAdHocRoundParticipants:i,tournamentParticipants:l,matchUpParticipantIds:b,otherFlightEntries:g,drawDefinition:t,structureId:A,sideNumber:s,matchUpId:c,structure:f,matchUp:m,drawId:p,event:r});E.push(...e)}let F=Nh({drawDefinition:t,structure:f}),k=R?.filter((e=>e.participantId)).map((e=>e.drawPosition)),x=R?.filter((e=>e.bye)).map((e=>e.drawPosition)),_=m.matchUpStatus===Yo||!O&&m.drawPositions?.reduce(((e,t)=>x?.includes(t)||e),!1);if(_)return{validActions:E,isByeMatchUp:_};dv({policyActions:y,action:Pv})&&E.push({type:Pv,payload:{matchUpId:c}});let L=!vm({matchUpStatus:m.matchUpStatus}),V=h?.scoring?.structures,B=f?.stage&&V?.stage&&V?.stage[f.stage],j=f?.stageSequence&&B?.stageSequence&&B.stageSequence[f.stageSequence],G=!(h?.scoring?.requireAllPositionsAssigned||B?.requireAllPositionsAssigned||j?.requireAllPositionsAssigned)||N,q=m.sides&&2===m.sides.filter((e=>e?.participantId)).length,$=m.matchUpStatus&&[es,Zo].includes(m.matchUpStatus),W=iv({inContextDrawMatchUps:w,drawDefinition:t,targetData:tm({inContextDrawMatchUps:w,drawDefinition:t,matchUpId:c})}),H=(2===P?.drawPositions?.length&&P.drawPositions.every((e=>k?.includes(e)))&&2===P?.sides?.length&&P.sides.every((({participantId:e})=>e))||q)&&!($&&W),z={method:GU,type:ev,payload:{drawId:p,matchUpId:c,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(L&&E.push({payload:{drawId:p,matchUpId:c,schedule:{}},method:yv,type:wv}),dv({policyActions:y,action:ev})&&(T?.participant||!s&&b?.length)&&E.push(z),L&&H&&E.push({type:Dv}),G&&H){let{matchUpId:e,matchUpFormat:t}=m,r={drawId:p,matchUpId:e,matchUpFormat:t,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};E.push({info:"set outcome and winningSide",method:yv,type:bv,payload:r}),dv({policyActions:y,action:Tv})&&E.push({type:Tv}),dv({policyActions:y,action:Rv})&&E.push({type:Rv})}if(O&&P){let e=function({specifiedPolicyDefinitions:e,inContextDrawMatchUps:t,matchUpParticipantIds:r,matchUpActionsPolicy:i,inContextMatchUp:n,policyActions:a,enforceGender:o,participantId:s,sideNumber:c,matchUpId:u,matchUp:d,drawId:l,side:p}){let m=[],f=n.sides?.find((e=>e.participant)),h=n.gender===Wp&&n.sideNumber&&1===n.sides?.filter((e=>e.particiapntId)).length&&f?.participant?.person?.sex,g=n.matchUpType,I=!1!==(o??i?.participants?.enforceGender)?n.gender:void 0,U=n.sides?.flatMap((e=>e.participant?.individualParticipants||e.participant)).filter(Boolean)?.map(Go),v=n.sides?.filter((e=>!c||e.sideNumber===c)).flatMap((e=>e.participant?.individualParticipants||e.participant)).filter(Boolean),y=v?.map(Go),S=t?.find((e=>e.matchUpId===n.matchUpTieId))?.sides?.map((e=>e.participant?.individualParticipants.filter((({participantId:e,person:t})=>!y?.includes(e)&&(!I||I===qp||t.sex===I||I===Wp&&!h||h&&t.sex!==h))))),w=c?S?.[c-1]:S?.map(((e,t)=>({participants:e,sideNumber:t+1}))),P=c?S?.[c-1]?.map(Go):S?.map(((e,t)=>({participants:e?.map(Go),sideNumber:t+1}))),D=c&&(hl(pu)(g)&&!y?.length||hl(fu)(g)&&(y?.length??0)<2)||!c&&(hl(pu)(g)&&(y?.length??0)<2||hl(fu)(g)&&(y?.length??0)<4),T=P?.filter((e=>!U?.includes(e))),b=w?.filter((({participantId:e})=>T.includes(e)));if(D&&T?.length&&m.push({availableParticipantIds:T,method:pv,availableParticipants:b,type:zU,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:c,drawId:l}}),y?.length&&(!Um(d)||p?.substitutions?.length)&&m.push({method:mv,type:vv,existingParticipantIds:y,payload:{participantId:void 0,tieMatchUpId:u,drawId:l}}),b?.length&&(!c&&y?.length||c&&p?.participant)&&m.push({availableParticipantIds:T,method:lv,availableParticipants:b,type:Uv,existingParticipantIds:y,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:l}}),dv({policyActions:a,action:Iv})&&p?.substitutions?.length){let e=p.participant?.participantType===Tu&&[p.participantId]||p.participant?.participantType===Ru&&p.participant.individualParticipantIds||[],t=p.substitutions.map((e=>e.participantId)).filter((t=>e.includes(t)));(!s||t.includes(s))&&m.push({method:mv,type:Iv,substitutedParticipantIds:t,payload:{participantId:void 0,tieMatchUpId:u,drawId:l}})}let R=e?.[Aa],M=R?.substituteWithoutScore,N=R?.substituteAfterCompleted;if(dv({policyActions:a,action:Sv})&&2===r.length&&(!c&&y?.length||c&&p?.participant)&&(M||Um(d))&&(N||d.matchUpStatus&&!ms.includes(d.matchUpStatus))&&v?.length&&w.length){let e=v.map(Go);m.push({info:"list of team players available for substitution",method:gv,availableParticipantIds:P,existingParticipantIds:e,availableParticipants:w,existingParticipants:v,type:Sv,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:c,matchUpId:u,drawId:l}})}return m}({specifiedPolicyDefinitions:n,inContextDrawMatchUps:w,matchUpParticipantIds:b,matchUpActionsPolicy:U,inContextMatchUp:P,policyActions:y,enforceGender:a,participantId:o,sideNumber:s,matchUpId:c,matchUp:m,drawId:p,side:T});E.push(...e)}return{structureIsComplete:F,validActions:E,isDoubleExit:$,...I}}function Cv(e,t){return e.bye||Hf(e.seedValue)<Hf(t.seedValue)||e.seedValue&&!t.seedValue?-1:(e.seedNumber||0)-(t.seedNumber||0)}function Ov({onlyAssignedPositions:e=!0,possiblyDisablingAction:t,tournamentParticipants:r,inactiveDrawPositions:i,activeDrawPositions:n,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:c,isByePosition:u,drawPosition:d,structureId:l,structure:p,drawId:m,event:f}){if(n.includes(d))return{};let h=i?.filter((e=>e!==d&&!(u&&s.includes(e)))),g=a?.filter((t=>(t=>!e||t.participantId||t.qualifier||t.bye)(t)&&h?.includes(t.drawPosition)))??[],I=g.map((({drawPosition:e})=>e)),{matchUps:U}=Kp({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:p,event:f}),v=U.filter((({drawPositions:e})=>ui(e,I))),y=Object.assign({},...v.map((e=>e.sides?.filter((({sourceDrawPositionRange:e})=>e)).map((({drawPosition:e,sourceDrawPositionRange:t})=>({[e]:t}))))).flat()),S=g.map((e=>e.participantId)).filter(Boolean),w=(r??[]).filter((e=>S.includes(e.participantId))),P=Object.assign({},...w.map((e=>({[e.participantId]:e})))),D=g.map((e=>{let t=P?.[e.participantId],r=y[e.drawPosition];return Zi({...e,participant:o?Da(t,!1,!0):void 0,sourceDrawPositionRange:r})}));return D.length?{validSwapAction:{payload:{drawId:m,structureId:l,drawPositions:[d]},willDisableLinks:t,method:kU,type:JU,availableAssignments:D}}:{}}function Fv(e){let t=xn(e,[{event:!0,drawDefinition:!0,structureId:!0}]);if(t.error)return t;let{policyDefinitions:r,returnParticipants:i=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:o,drawPosition:s,event:c}=e,u=e.tournamentParticipants??(a&&ef({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],d=yc({structureId:e.structureId,drawDefinition:o});if(d.error)return d;let l=d.containingStructure||d.structure;if(!l)return{error:ae};let p=l.structureId;if(d=wm({drawDefinition:o,structureId:p}),void 0===s&&!d.isAdHoc)return{error:j};if(d.isAdHoc)return Ev(e);if(d.error)return d;let{drawPositionInitialRounds:m,inactiveDrawPositions:f,activeDrawPositions:h,byeDrawPositions:g}=d,U=Yu({tournamentRecord:a,drawDefinition:o,structure:l,event:c}).appliedPolicies??{};Object.assign(U,r??{});let v,{actionsPolicy:y,enabledStructures:S,actionsDisabled:w}=sv({actionType:av,appliedPolicies:U,drawDefinition:o,structure:l}),P=y?.activePositionOverrides||[],{sourceStructureIds:D}=NU({finishingPosition:mc,targetRoundNumber:1,linkType:xs,drawDefinition:o,structureId:p})||{};D?.length&&(v=D.reduce(((e,t)=>Nh({structureId:t,drawDefinition:o})&&e),!0));let T=D.length,b=D.length&&!v,{policyActions:R}=uv({enabledStructures:S,drawDefinition:o,structure:l}),M=![Us,Is].includes(l.stage)||1!==l.stageSequence,{drawId:N}=o,A=[],{assignedPositions:E,positionAssignments:C}=Dc({structure:l}),O=E?.find((e=>e.drawPosition===s));if(!C?.map((e=>e.drawPosition))?.includes(s))return{error:B};let{stage:F,stageSequence:k}=l,x=[F];F===vs&&x.push(Is),F===Is&&x.push(vs);let _=Nd({entryStatuses:Pd,provisionalPositioning:n,drawDefinition:o,stageSequence:k,structureId:p,stages:x}),L=_m({drawDefinition:o,stages:x}).assignedParticipantIds??[],V=_.filter((e=>!L.includes(e.participantId))).map((e=>e.participantId)),G=g.includes(s),q=h.includes(s);if(w)return{hasPositionAssigned:!!O,info:"Actions Disabled for structure",isActiveDrawPosition:q,isDrawPosition:!0,validActions:[],isByePosition:G};if(dv({policyActions:R,action:zU})&&!q&&C&&!b&&(!O||G)){let{validAssignmentActions:e}=function({positionSourceStructureIds:e,unassignedParticipantIds:t,possiblyDisablingAction:r,provisionalPositioning:i,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:c,drawDefinition:u,seedingProfile:d,isByePosition:l,drawPosition:p,structureId:m,event:f}){let h,g,{drawId:I}=u,U=[],v=[],y=c?.[La]?.validSeedPositions?.ignore;if(y||({unplacedSeedParticipantIds:h,unplacedSeedAssignments:g,unfilledPositions:v}=Jf({provisionalPositioning:i,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:d,structureId:m,event:f})),v?.length||(v=o.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition))),l||U.push({payload:{drawId:I,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:r,method:BU,type:tv}),a&&y){let t=o.map((e=>e.participantId)).filter(Boolean),i={structureIds:e},{completedMatchUps:a}=om({inContext:!0,matchUpFilters:i,drawDefinition:u}),c=Yr((a??[]).filter((({matchUpType:e})=>f?.eventType!==kl||e===kl))?.map((({sides:e})=>e?.map(Go))).flat().filter((e=>e&&!t.includes(e)))),d=s?n?.filter((e=>c?.includes(e.participantId))).map((e=>Da(e,void 0,!0))):void 0;return d?.forEach((e=>{let t=(u.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),d?.length&&U.push(Zi({payload:{drawId:I,structureId:m,drawPosition:p},willDisableLinks:r,method:LU,type:zU,availableParticipantIds:c,participantsAvailable:d})),{validAssignmentActions:U}}if(v.includes(p)||l){let e;if(g?.length){let t=g.filter((e=>h?.includes(e.participantId)));t.sort(Cv),e=t.map((e=>e.participantId))}else e=t;let i=s?n?.filter((t=>e.includes(t.participantId))).map((e=>Da(e,void 0,!0))):void 0;i?.length&&U.push(Zi({payload:{drawId:I,structureId:m,drawPosition:p},willDisableLinks:r,method:LU,type:zU,availableParticipantIds:e,participantsAvailable:i}))}return{validAssignmentActions:U}}({positionSourceStructureIds:D,unassignedParticipantIds:V,possiblyDisablingAction:M,isWinRatioFedStructure:T,tournamentParticipants:u,positionAssignments:C,returnParticipants:i,appliedPolicies:U,drawDefinition:o,isByePosition:G,drawPosition:s,structureId:p,event:c});e?.forEach((e=>A.push(e)))}if(dv({policyActions:R,action:$U})){let{validAssignmentActions:e}=function({drawPositionInitialRounds:e,tournamentParticipants:t,positionAssignments:r,returnParticipants:i,appliedPolicies:n,drawDefinition:a,drawPosition:o,structureId:s,drawId:c}){let u=[],d=[],l=[],p=[],m=r.map((e=>e.participantId)).filter(Boolean),f=n?.[Na],h=!f?.disableRoundRestrictions&&e[o],g=f?.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:U}=NU({targetRoundNumber:h,linkType:_s,drawDefinition:a,structureId:s})||{};I?.length&&p.push(...I);let{sourceStructureIds:v,relevantLinks:y}=NU({targetRoundNumber:h,linkType:xs,drawDefinition:a,structureId:s})||{};v?.length&&p.push(...v);for(let S of U){let e=a.structures?.find((e=>e.structureId===S.source.structureId));if(e?.stage!==Us)continue;let r=Nh({structureId:S.source.structureId,drawDefinition:a});if(!g||r){let r=e.qualifyingRoundNumber,{matchUps:n}=Kp({matchUpFilters:{roundNumbers:[r],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:t,inContext:!0,structure:e});for(let e of n){let t=e.sides.find((t=>t?.sideNumber===e.winningSide)),r=e.matchUpStatus===Yo&&e.sides?.find((({participantId:e})=>e));if(t||r){let{participantId:e,participant:n}=t||r||{};e&&!m.includes(e)&&(n&&i&&u.push(n),d.push(e))}}}}for(let S of y){let e=a.structures?.find((e=>e.structureId===S.source.structureId));if(e?.stage!==Us)continue;let r=Nh({structureId:S.source.structureId,drawDefinition:a});if(!g||r){let{positionAssignments:r}=Pc({structure:e}),n=r?.map((e=>{let t=e.participantId,r=no({element:e,name:Mo}).extension?.value;return r?{participantId:t,groupOrder:r?.groupOrder}:{}})).filter((({groupOrder:e,participantId:t})=>1===e&&!m.includes(t))).map((({participantId:e})=>e))??[];if(n&&d.push(...n),i){let e=t.filter((({participantId:e})=>n.includes(e)));u.push(...e)}}}return d.length&&l.push(Zi({payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:c},method:AU,type:$U,qualifyingParticipantIds:d,qualifyingParticipants:i?u:void 0})),{validAssignmentActions:l,sourceStructureIds:p}}({drawPositionInitialRounds:m,tournamentParticipants:u,positionAssignments:C,returnParticipants:i,appliedPolicies:U,drawDefinition:o,drawPosition:s,structureId:p,drawId:N});e?.forEach((e=>A.push(e)))}let{participantId:$}=O||{},W=$&&u.find((e=>e.participantId===$));if(O){dv({policyActions:R,action:YU})&&!q&&(A.push({type:YU,method:FU,payload:{drawId:N,structureId:p,drawPosition:s},willDisableLinks:M}),G||A.push({type:HU,method:EU,payload:{drawId:N,structureId:p,drawPosition:s},willDisableLinks:M}),dv({policyActions:R,action:tv})&&!G&&A.push({type:tv,method:FU,payload:{drawId:N,structureId:p,drawPosition:s,replaceWithBye:!0},willDisableLinks:M}));let e=l.stage===Us||l.stage===Is&&1===l.stageSequence;if(!G&&cv({activePositionOverrides:P,activeDrawPositions:h,action:ZU})&&dv({policyActions:R,action:ZU})&&Qf({drawDefinition:o,structureId:p,drawPosition:s})&&e){let{seedAssignments:e}=Ad({returnAllProxies:!0,drawDefinition:o,structure:l}),{seedNumber:t,seedValue:r}=e?.find((e=>e.participantId===$))??{};A.push({type:ZU,method:jU,participant:W,seedNumber:t,payload:{drawId:N,structureId:p,participantId:$,seedValue:r}})}if(!G&&cv({activePositionOverrides:P,activeDrawPositions:h,action:QU})&&dv({policyActions:R,action:QU})&&Qf({drawDefinition:o,structureId:p,drawPosition:s})&&e){let{seedAssignments:e}=Ad({returnAllProxies:!0,drawDefinition:o,structure:l}),{seedNumber:t}=e?.find((e=>e.participantId===$))??{};A.push({method:VU,type:QU,participant:W,seedNumber:t,payload:{participantId:$,structureId:p,drawId:N}})}if(!G&&$){if(dv({policyActions:R,action:ev})){let e={type:ev,method:GU,participant:W,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:N}};A.push(e)}if(dv({policyActions:R,action:XU})){let e={type:XU,method:_U,participant:W,payload:{participantId:$,otherName:void 0}};A.push(e)}}if(dv({policyActions:R,action:JU})){let{validSwapAction:e}=Ov({possiblyDisablingAction:M,tournamentParticipants:u,inactiveDrawPositions:f,activeDrawPositions:h,positionAssignments:C,returnParticipants:i,byeDrawPositions:g,drawDefinition:o,isByePosition:G,drawPosition:s,structureId:p,structure:l,drawId:N});e&&A.push(e)}}if(dv({policyActions:R,action:WU})&&!b){let{validAlternatesAction:e}=function({tournamentParticipants:e=[],possiblyDisablingAction:t,activeDrawPositions:r,positionAssignments:i,returnParticipants:n,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:c,structureId:u,structure:d,drawId:l,event:p}){if(r.includes(s))return{};let m=c.find((e=>e.type===zU))?.availableParticipantIds,f=a?.[Na]?.otherFlightEntries,h=a?.[Na]?.restrictQualifyingAlternates,g=(o.entries??[]).filter((({entryStage:e})=>!h||(d.stage===Us?e===Us:e!==Us))).sort(((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0))).map((({participantId:e})=>e)).filter(Boolean),{allPositionedParticipantIds:I}=wc({drawDefinition:o}),U=i.map((e=>e.participantId)).filter(Boolean),v=g.filter((e=>d.stage&&[Us,Is,Ss].includes(d.stage)?!I?.includes(e):!U.includes(e))),y=(p?.entries??[]).filter((e=>e.entryStatus===cd&&Nv({restrictQualifyingAlternates:h,structure:d,entry:e})&&(d.stage&&[Us,Is,Ss].includes(d.stage)?!I?.includes(e.participantId):!U.includes(e.participantId)))).sort(((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0))).map((e=>e.participantId)),S=Yr(v.concat(y));if(f){let e=(p?op({event:p}).flightProfile:void 0)?.flights?.filter((e=>e.drawId!==l)).map((e=>e.drawEntries.filter((e=>e.participantId&&![yd,Id,Ud].includes(e.entryStatus)&&!g.includes(e.participantId))).map((({participantId:e})=>e)))).flat().filter(Boolean);e?.length&&S.push(...e)}m?.length&&(S=S.filter((e=>!m.includes(e))));let w=n?e?.filter((e=>S.includes(e.participantId))):void 0;return w?.forEach((e=>{let t=(o.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),w?.sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))),S.length?{validAlternatesAction:Zi({payload:{drawId:l,structureId:u,drawPosition:s},willDisableLinks:t,method:CU,availableAlternatesParticipantIds:S,type:WU,availableAlternates:w})}:{}}({possiblyDisablingAction:M,tournamentParticipants:u,positionAssignments:C,activeDrawPositions:h,returnParticipants:i,appliedPolicies:U,drawDefinition:o,drawPosition:s,validActions:A,structureId:p,structure:l,drawId:N,event:c});e&&A.push(e)}if(dv({policyActions:R,action:KU})&&!b&&C){let{validLuckyLosersAction:e}=function({tournamentParticipants:e=[],sourceStructuresComplete:t,possiblyDisablingAction:r,isWinRatioFedStructure:i,activeDrawPositions:n,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:c,structure:u,drawId:d,event:l}){if(n.includes(s)||i&&!t)return{};let{sourceStructureIds:p,targetStructureIds:m}=o.links?.reduce(((e,t)=>{let r=t.source?.structureId,i=t.target?.structureId;return e.sourceStructureIds.includes(r)||e.sourceStructureIds.push(r),e.targetStructureIds.includes(i)||e.targetStructureIds.push(i),e}),{sourceStructureIds:[],targetStructureIds:[]})||{},f=[],h=o.links?.filter((e=>e.target?.structureId===u.structureId))??[];for(let I of h){let e=I?.source?.structureId,{structure:t}=yc({structureId:e,drawDefinition:o}),r={};if(t?.finishingPosition===fc&&(1!==p?.length||1!==m?.length)){let{matchUps:e}=Kp({drawDefinition:o,structure:u,event:l}),{initialRoundNumber:t}=Pm({drawPosition:s,matchUps:e}),i=o.links?.find((e=>e.target?.structureId===u?.structureId&&e.target.roundNumber===t))?.source?.roundNumber;r.roundNumbers=[i]}let{completedMatchUps:i}=Jp({structureId:e,inContext:!0,matchUpFilters:r,drawDefinition:o}),n=a.map((e=>e.participantId)).filter(Boolean);i?.filter((({matchUpType:e,winningSide:t})=>t&&(l?.eventType!==kl||e===kl))).map((({winningSide:e,sides:t})=>e&&t?.[1-(e-1)])).map(Go).filter((e=>e&&!n.includes(e)))?.forEach((e=>{f.includes(e)||f.push(e)}))}let g=e?.filter((e=>f?.includes(e.participantId)));return g?.forEach((e=>{let t=(o.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),f?.length?{validLuckyLosersAction:{type:KU,method:OU,availableLuckyLosers:g,availableLuckyLoserParticipantIds:f,willDisableLinks:r,payload:{drawId:d,structureId:c,drawPosition:s}}}:{}}({sourceStructuresComplete:v,possiblyDisablingAction:M,isWinRatioFedStructure:T,tournamentParticipants:u,activeDrawPositions:h,positionAssignments:C,drawDefinition:o,drawPosition:s,structureId:p,structure:l,drawId:N});e&&A.push(e)}if(W?.participantType===Ru&&dv({policyActions:R,action:qU})){let{validModifyAssignedPairAction:e}=function({tournamentParticipants:e,returnParticipants:t,drawPosition:r,participant:i,drawId:n,event:a}){let o=a?.entries?.filter((({entryStatus:e})=>[Id,Ud].includes(e))).map((({participantId:e})=>e))||[];if(o.length){let a=i.individualParticipantIds,s=t?e.filter((({participantId:e})=>o.includes(e))):void 0,c=t?e.filter((({participantId:e})=>a.includes(e))):void 0;return{validModifyAssignedPairAction:Zi({payload:{participantId:i.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:r,drawId:n},method:xU,availableIndividualParticipantIds:o,availableIndividualParticipants:s,existingIndividualParticipantIds:a,existingIndividualParticipants:c,type:qU},!1,!1,!0)}}return{}}({tournamentParticipants:u,returnParticipants:i,drawPosition:s,participant:W,drawId:N,event:c});e&&A.push(e)}return{hasPositionAssigned:!!O,isActiveDrawPosition:q,isDrawPosition:!0,isByePosition:G,validActions:A,...I}}function kv({policyDefinitions:e,appliedPolicies:t,drawType:r}){let i=e?.[Ba]?.drawTypeCoercion,n=t?.[Ba]?.drawTypeCoercion;return("boolean"==typeof i?i:void 0)??(r&&i?.[r])??("boolean"==typeof n?n:void 0)??(r&&n?.[r])??!0}function xv({tournamentRecord:e,drawDefinition:t,stage:r=Is,structureId:i,structure:n}){if(!e)return{error:D};if(!n&&!t)return{error:M};if(!n&&!i&&1===t?.structures?.filter((e=>e.stage===r)).length&&(n=t.structures.find((e=>e.stage===r))),!n&&!i)return{error:ne};let{error:a,positionAssignments:o}=Pc({drawDefinition:t,structureId:i,structure:n});return{positionAssignments:o??[],structureId:n?.structureId,error:a}}function _v({structureId:e,drawDefinition:t}){if(!t)return{error:M};if(!u(e))return{error:mr};let r=Zp({drawDefinition:t,structureId:e});if(r.error)return r;let i=r.links.target.flatMap((e=>e.target.feedProfile)).filter(Boolean),n=!si([ks,Fs,Os,Ns],i).length;return{...I,valid:n}}function Lv({participantsCount:e,participantCount:t}){if(!(e=e??t))return{error:mr};let r=qr(e);return r?{drawSize:r}:en({result:{error:mr},stack:"getEliminationDrawSize",context:{participantsCount:e}})}function Vv(e){let{drawSizeProgression:t=!1,policyDefinitions:r,drawSize:i}=e||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:o,event:s}=e||{},c="getSeedsCount",u=e?.participantsCount??e?.participantCount;if(!r){let e=Ku({tournamentRecord:a,drawDefinition:o,event:s});if(e.error)return en({result:e,stack:c});r=e.policyDefinitions}let d=Wr(u);if(u&&!d)return en({result:{error:mr},context:{participantsCount:u},stack:c});if(n&&!d)return en({result:{error:wt},stack:c});if(isNaN(i)){if(!u)return en({result:{error:W},stack:c});({drawSize:i}=Lv({participantsCount:u}))}let l=n&&u||i;if(l&&l>i)return{error:Rt};let p=r?.[La];if(!p)return{error:Be};let m=p.seedsCountThresholds;return m?(void 0!==p.drawSizeProgression&&(t=p.drawSizeProgression),{seedsCount:m.filter((e=>t?e.drawSize<=i:i===e.drawSize)).reduce(((e,t)=>u&&u>=t.minimumParticipantCount?t.seedsCount:e),0)}):{error:Q}}function Bv({consideredEntries:e,policyDefinitions:t,tournamentRecord:r,appliedPolicies:i,participantMap:n,enforceGender:a,participants:o,event:s}){if((!o||!n)&&r&&({participants:o,participantMap:n}=ef({tournamentRecord:r})),!o)return{error:gt};if(!Array.isArray(o))return{error:mr};if(!s)return{error:de};let c=t?.[Aa]??i?.[Aa]??pf[Aa],u=!1!==(a??c?.participants?.enforceGender),{eventType:d,gender:l}=s,p=d===Fl,m=d===xl&&Mu||p&&Ru||Tu,f=Object.assign({},...(e??s.entries??[]).map((e=>({[e.participantId]:e.entryStatus})))),h=Object.keys(f),g=o.filter((e=>h.includes(e.participantId))).filter((e=>{let t=function({participant:e,participantType:t,eventType:r,entryStatusMap:i}){let n=i[e.participantId],a=r&&[Fl,xl].includes(r)&&e.participantType===Tu&&(Vm(n)||n===yd);return e.participantType!==t&&!a}({participant:e,participantType:m,eventType:d,entryStatusMap:f}),r=function(e){let{participant:t,participantMap:r,eventGender:i,mismatch:n,isDoubles:a,genderEnforced:o}=e,s=!n&&a&&Yr(t?.individualParticipantIds?.map((e=>r?.[e]?.participant?.person?.sex)).filter(Boolean)??[])||[],c=!i||!s?.length||qp===i||[$p,zp].includes(i)&&s[0]===i||Wp===i&&(1==s.length&&1===t.individualParticipantIds?.length||2===s.length),u=t?.person?.sex,d=!t?.person||!i||[qp,Wp].includes(i)||[$p,zp].includes(i)&&u===i;return!o||c&&d}({genderEnforced:u,participantMap:n,eventGender:l,participant:e,isDoubles:p,mismatch:t});return t||!r}));if(g.length){let e=g.map((e=>e.participantId));return{error:fe,invalidParticipantIds:e}}return{...I,valid:!0}}function jv({qualifyingProfiles:e,appliedPolicies:t,idPrefix:r,isMock:i,uuids:n}){let a,o=[],s=[],c=[],u=(e,t)=>e.stageSequence-t.stageSequence,d=(e,t)=>e.roundTarget-t.roundTarget,l=0,p=0,m=1;for(let f of e.sort(d)){let d=f.structureProfiles||[];m=f.roundTarget||m;let h,g,I,U=1,v=0;for(let o of(d||[]).sort(u)){let u,p,f,y=Vr(o.drawSize||o.participantsCount),{qualifyingRoundNumber:S,structureOptions:w,matchUpFormat:P,structureName:D,structureId:T,drawType:b}=o,R=o.matchUpType,M=o.qualifyingPositions||Gv({drawSize:y,qualifyingRoundNumber:S});if(!Wr(y))return en({result:{error:W},stack:"generateQualifyingSTructures"});let N=e.length>1?`${m}-`:"",A=d.length>1||N?U:"",E=D||(N||A?`${Of(Us)} ${N}${A}`:Of(Us));if(b===sc){let{structures:e,groupCount:s,maxRoundNumber:c}=jf({structureName:o.structureName||E,structureId:T||n?.pop(),stage:Us,structureOptions:w,appliedPolicies:t,stageSequence:U,matchUpType:R,roundTarget:m,drawSize:y,idPrefix:r,isMock:i,uuids:n});v=s,u=c,p=e[0],a=[1]}else({drawSize:y,matchUps:f,roundLimit:u}=Pg({qualifyingRoundNumber:S,qualifyingPositions:M,matchUpType:R,drawSize:y,idPrefix:r,isMock:i,uuids:n})),p=kf({structureName:o.structureName||E,structureId:T||n?.pop(),qualifyingRoundNumber:u,stage:Us,matchUpFormat:P,stageSequence:U,matchUpType:R,roundLimit:u,matchUps:f}),m&&za({extension:{name:Po,value:m},element:p}),v=f?.filter((e=>e.roundNumber===u))?.length||0;if(U>1){let{link:e}=yg({sourceStructureId:g,sourceRoundNumber:h,targetStructureId:p.structureId,finishingPositions:I===xs?[1]:void 0,linkType:I});c.push(e),l+=(y||0)-v}else l+=y||0;I=b===sc?xs:_s,g=p.structureId,h=u,s.push(p),U+=1}p+=v,o.push({qualifiersCount:v,finalQualifyingRoundNumber:h,finalQualifyingStructureId:g,finishingPositions:a,roundTarget:m,linkType:I}),m+=1}return{qualifiersCount:p,qualifyingDrawPositionsCount:l,qualifyingDetails:o,structures:s,...I,links:c}}function Gv({drawSize:e,qualifyingRoundNumber:t}){let r=e,i=0;for(;i<t;)r=Math.floor(r/2),i+=1;return r}function qv(e){let{drawTypeCoercion:t,enforceMinimumDrawSize:r}=e,i=xr(e.drawSize),n=t&&("boolean"==typeof t||t<=2)&&2===i&&$s||e.drawType||$s,a=hc.includes(n);if(i&&a)if(t&&("boolean"==typeof t&&i<4||i<=t))n=$s;else if(i<4&&r)return{...en({context:{enforceMinimumDrawSize:r,drawSize:i,drawType:n},result:{error:q},stack:"getCoercedDrawType"}),drawType:n};return{drawType:n}}function $v({structureName:e,matchUpType:t,idPrefix:r,drawSize:i,isMock:n,uuids:a}){let o=[],{matchUps:s}=Rg({linkFedFinishingRoundNumbers:[1],drawSize:i+1,matchUpType:t,idPrefix:r,isMock:n}),c=Ff({structureName:e||Of(Is),structureId:a?.pop(),stageSequence:1,stage:Is,matchUpType:t,matchUps:s});o.push(c);let u=i/2,{matchUps:d}=Rg({finishingPositionOffset:u,idPrefix:r&&`${r}-c`,drawSize:i-1,isConsolation:!0,matchUpType:t,isMock:n,uuids:a}),l=Ff({structureName:Of(dc),matchUps:d,structureId:a?.pop(),stage:vs,stageSequence:2,matchUpType:t});o.push(l);let{matchUps:p}=Pg({idPrefix:r&&`${r}-p1t2`,drawSize:2,matchUpType:t,isMock:n}),m=Ff({structureName:Of(uc),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:Ss,matchUpType:t});o.push(m);let f=function({mainStructure:e,consolationStructure:t,deciderStructure:r}){let i=t.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),n=e.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0),a=t.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0);return[...i.map(((r,n)=>{let a=i.indexOf(r)%2?Fs:ks;return{linkType:Ls,source:{roundNumber:1+n,structureId:e.structureId},target:{feedProfile:a,roundNumber:r,structureId:t.structureId}}})),{linkType:_s,source:{roundNumber:a,structureId:t.structureId},target:{feedProfile:Fs,roundNumber:n,structureId:e.structureId}},{linkType:_s,source:{roundNumber:n,structureId:e.structureId},target:{feedProfile:Fs,roundNumber:1,structureId:r.structureId}},{linkType:Ls,source:{roundNumber:n,structureId:e.structureId},target:{feedProfile:Fs,roundNumber:1,structureId:r.structureId}}]}({mainStructure:c,consolationStructure:l,deciderStructure:m});return{structures:o,links:f,...I}}function Wv(e){let{qualifyingRoundNumber:t,finishingPositionOffset:r,qualifyingPositions:i,matchUpType:n,idPrefix:a,drawSize:o,isMock:s,uuids:c}=e;if(!Wr(o)||o<2)return{matchUps:[],roundsCount:0};if(_r(o))return Pg(e);let u=function(e){let t=xr(e),r=t%2?t+1:t,i=!!(Math.ceil(r/2)%2),n=[{participantsCount:r,preFeedRound:i}];for(;r>2;){let e=Math.ceil(r/2),t=1===e,i=!(t||!(e%2));r=!t&&i?e+1:e;let a=!!(2!==r&&Math.ceil(r/2)%2);n.push({participantsCount:r,preFeedRound:a,feedRound:i})}return n}(o),d=u.shift(),l=ai(1,(d?.participantsCount||0)+1).map((e=>({drawPosition:e}))),p=[],m=1;({matchUps:p}=wg({roundNumber:m,matchUpType:n,idPrefix:a,matchUps:p,isMock:s,nodes:l,uuids:c})),m++;let f=e.roundLimit||t;for(let g of u){let e=g.participantsCount/2,t=ai(1,e+1);i&&e===i&&(f=m-1);let r=t.map((e=>{let t=Sg({roundPosition:e,roundNumber:m,idPrefix:a,uuids:c});return{roundPosition:e,roundNumber:m,matchUpId:t}}));p.push(...r),m++}let h=m-1;return p=hm({finishingPositionOffset:r,lucky:!0,roundsCount:h,roundLimit:f,matchUps:p}),f&&(p=p.filter((e=>e.roundNumber<=f))),{matchUps:p,roundsCount:h,roundLimit:f}}function Hv(e){let{playoffAttributes:t,stageSequence:r=1,stage:i=Is,matchUpType:n,drawSize:a,uuids:o}=e,s=e.structureId||(e.isMock||e.idPrefix?`${e.drawDefinition.drawId}-s-0`:void 0)||o?.pop(),c=e.appliedPolicies??Yu(e),u=e.policyDefinitions?.[Va]||c?.[Va];e.skipRounds=e.skipRounds||a<=4&&(u?.feedFromMainFinal?0:1)||0;let d=e.structureName??t?.[0]?.name??Of(Is);return{generators:{[Bs]:()=>({structures:[kf({finishingPosition:mc,stageSequence:r,structureName:d,matchUps:[],matchUpType:n,structureId:s,stage:i})],links:[],...I}),[Ys]:()=>{let{matchUps:t}=Wv(e);return{structures:[kf({stageSequence:r,structureName:d,matchUpType:n,structureId:s,matchUps:t,stage:i})],links:[],...I}},[$s]:()=>(()=>{let{matchUps:t}=Pg(e);return{structures:[kf({stageSequence:r,structureName:d,matchUpType:n,structureId:s,matchUps:t,stage:i})],links:[],...I}})(),[Ws]:()=>$v(e),[Gs]:()=>Mg({...e,roundOffsetLimit:3,playoffAttributes:t??lc}),[qs]:()=>Mg({...e,roundOffsetLimit:2,playoffAttributes:t??pc}),[Ss]:()=>Mg(e),[js]:()=>{let{matchUps:e}=Rg({drawSize:a,uuids:o,matchUpType:n});return{structures:[kf({stageSequence:r,structureName:d,matchUpType:n,structureId:s,stage:Is,matchUps:e})],links:[],...I}},[zs]:()=>_g(e),[Hs]:()=>Bg({...e,feedRounds:1,fmlc:!0}),[ic]:()=>Bg({...e,feedRounds:1}),[Js]:()=>Bg({...e,feedsFromFinal:1}),[Zs]:()=>Bg({...e,feedsFromFinal:2}),[tc]:()=>Bg({...e,feedsFromFinal:3}),[ac]:()=>Bg(e),[Ks]:()=>Vg(e),[sc]:()=>jf(e),[cc]:()=>function(e){let{drawDefinition:t,structureOptions:r,requireSequential:i}=e,n={structureName:Of(Is),...e,stage:Is},{structures:a,groupCount:o,groupSize:s}=jf(n);if(o<1)return{error:cr};let c=r?.playoffGroups||[{finishingPositions:[1],structureName:Of(Ss)}],[u]=a,{structures:d,links:l}=jg({sourceStructureId:u.structureId,requireSequential:i,drawDefinition:t,playoffGroups:c,groupCount:o,groupSize:s,...e});return d&&a.push(...d),{...I,structures:a,links:l}}(e)}}}function zv(e){let{enforceMinimumDrawSize:t=!0,overwriteExisting:r,appliedPolicies:i,staggeredEntry:n,drawDefinition:a,tieFormat:o,isMock:s,uuids:c}=e||{},u=xr(e.drawSize),d=e.drawTypeCoercion??kv({appliedPolicies:i,drawType:e.drawType}),l=qv({drawType:e.drawType,enforceMinimumDrawSize:t,drawTypeCoercion:d,drawSize:u});if(l.error)return l;let p=l.drawType,m=[],f=[],h=e?.matchUpType??mu,g=a?.structures?.filter((({stage:e})=>e===Us));g&&m.push(...g);let U=g?.map((({structureId:e})=>e)),v=a?.structures?.find((({stage:e,stageSequence:t})=>e===Is&&1===t)),y=a?.links?.filter((e=>e.target.structureId===v?.structureId&&U?.includes(e.source.structureId))),S=(e,t)=>{if(e.linkType===xs&&t?.structures){let r=e.source.finishingPositions||[];return t.structures.length*r.length}if(e.linkType===_s&&t?.matchUps?.length){let r=e.source.roundNumber;return t.matchUps.filter((({roundNumber:e})=>e===r)).length}},w=g?.map((e=>{let t=y?.find((t=>t.target.structureId===e.structureId)),r=Pc({structure:e})?.positionAssignments?.length??0;if(!t)return r;let i=t?.source.structureId,n=a.structures?.find((e=>e.structureId===i));return r-(S(t,n)||0)})).filter(Boolean).reduce(((e,t)=>e+t),0),P=y?.map((e=>{let t=e.source.structureId,r=g?.find((e=>e.structureId===t));return S(e,r)})).filter(Boolean).reduce(((e,t)=>e+t),0),D=!(!v||v?.matchUps?.length);if(g?.length&&!D)return{error:Tr};let T=!g?.length&&e.qualifyingProfiles,b=T?.length&&jv({idPrefix:e.idPrefix,qualifyingProfiles:T,appliedPolicies:i,isMock:s,uuids:c});if(b?.error)return b;let{qualifyingDrawPositionsCount:R,qualifyingDetails:M,qualifiersCount:N}=b||{qualifyingDrawPositionsCount:w,qualifiersCount:P};R&&(b?.structures&&m.push(...b.structures),b?.links&&f.push(...b.links)),Object.assign(e,Zi({drawSize:u,matchUpType:h,tieFormat:o}));let A=p!==Bs&&(!u||u<2||!n&&![js,Ys].includes(p)&&([cc,sc].includes(p)&&u<3||![sc,cc].includes(p)&&!_r(u)));if(A&&!R)return en({context:{drawSize:u,invalidDrawSize:A},result:{error:q},stack:"generateDrawStructuresAndLinks"});let{generators:E,error:C}=Hv(e);if(C)return{error:C};let O=E[p];if(!O)return{error:_};let F=O?.();if(F.error)return F;let{structures:k,links:x}=F;if(k?.length){let e=k.find((({stage:e,stageSequence:t})=>e===Is&&1===t));if(v&&e)if(D){let t=e.structureId;if(e.structureId=v.structureId,x?.length)for(let e of x)e.source.structureId===t&&(e.source.structureId=v.structureId),e.target.structureId===t&&(e.target.structureId=v.structureId)}else if(!r)return{error:Tr};m.push(...k)}m.sort(Uc),x?.length&&f.push(...x);let L=F.structures.find((({stage:e,stageSequence:t})=>e===Is&&1===t));for(let I of M||[]){let{finalQualifyingRoundNumber:e,finalQualifyingStructureId:t,roundTarget:r,finishingPositions:i,linkType:n}=I,a=L&&yg({targetStructureId:L.structureId,sourceStructureId:t,sourceRoundNumber:e,finishingPositions:i,targetEntryRound:r,linkType:n})?.link;if(a?.error)return a;a&&f.push(a)}return y&&f.push(...y),{...I,qualifyingResult:{qualifyingDrawPositionsCount:R,qualifiersCount:N},structures:m,links:f}}function Yv(e){let{modifyOriginal:t=!0,stageSequence:r=1,isMock:i}=e||{},n="generateDrawTypeAndModifyDrawDefinition";if(!e.drawDefinition)return en({result:{error:M},stack:n});let a=t?e.drawDefinition:Da(e.drawDefinition,!1,!0),{tieFormat:o,matchUpType:s}=e;if(o){let e=QI({tieFormat:o});if(e.error)return e}o=ZI(o??pp({drawDefinition:a})?.tieFormat),s=s??(a.matchUpType||mu),e.tieFormat=o,e.matchUpType=s;let c=nf({drawDefinition:a,stage:Is});e.drawSize=e.drawSize??c,!c&&e.drawSize&&gg({drawSize:e.drawSize,drawDefinition:a,stageSequence:r,stage:Is});let u=mp({drawDefinition:a}).drawMatchUps.map(qo),d=zv(e);if(d.error)return en({result:d,stack:n});let{structures:l,links:p,qualifyingResult:m}=d;a.structures=l,a.links=p;let f=Math.max(e.qualifiersCount??0,m?.qualifiersCount||0);if(m?.qualifyingDrawPositionsCount&&!nf({stage:Us,drawDefinition:a})){let e=gg({drawSize:m.qualifyingDrawPositionsCount,stage:Us,drawDefinition:a});if(e.error)return e}if(f){let e=Ig({qualifiersCount:f,drawDefinition:a,stage:Is});if(e.error)return e}let h=e.drawSize??c;Object.assign(e,Zi({drawSize:h,matchUpType:s,tieFormat:o}));let{matchUps:g,matchUpsMap:U}=am({drawDefinition:a});o&&g?.forEach((e=>{if(!u.includes(e.matchUpId)){let{tieMatchUps:t}=qg({tieFormat:o,matchUp:e,isMock:i});Object.assign(e,{tieMatchUps:t,matchUpType:s})}}));let{inContextDrawMatchUps:v}=gm({drawDefinition:a,matchUpsMap:U});return au({tournamentId:e.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:v,drawDefinition:a,matchUpsMap:U,...I,structures:l,matchUps:g,links:p}}function Kv(e){let{tournamentRecord:t,scaleAttributes:r,participantId:i}=e,n=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!i)return{error:It};let{participant:a,tournamentId:o}=Fu({tournamentRecords:n,tournamentRecord:t,participantId:i});return a?{...jm({participant:a,scaleAttributes:r}),tournamentId:o}:{error:Ut}}function Qv(e){let t,r,{removePriorValues:i,tournamentRecord:n,participantId:a,scaleItem:o}=e;if(!Xv({scaleItem:o}))return{error:ir};if(a&&Array.isArray(n.participants)&&(r=n.participants.find((e=>e.participantId===a)),r)){let e=Zv({removePriorValues:i,participant:r,scaleItem:o});if(e.error)return e;t=!e.valueChanged;let{topics:a}=Bi();a.includes(Bc)&&ki({topic:Bc,payload:{tournamentId:n.tournamentId,participants:[r]}})}return t&&{...I,info:Ur,existingValue:o?.scaleValue}||r&&{...I,newValue:o?.scaleValue}||{error:Ut}}function Jv(e){let{scaleItemsWithParticipantIds:t=[],removePriorValues:r,tournamentRecord:i,auditData:n,context:a}=e;if(!i)return{error:D};if(!i.participants)return{error:gt};let o=0,s={},c=[];for(let l of t){let e=l?.participantId;if(Array.isArray(l?.scaleItems))for(let t of l.scaleItems){if(!Xv({scaleItem:t}))return{error:ir};Array.isArray(s[e])||(s[e]=[]),s[e].push(t)}}i.participants.forEach((e=>{let{participantId:t}=e||{};Array.isArray(s[t])&&s[t].forEach((t=>{Zv({participant:e,scaleItem:t,removePriorValues:r}),c.push(e),o++}))}));let u=o?void 0:ar,{topics:d}=Bi();if(d.includes(Bc)&&o&&ki({topic:Bc,payload:{tournamentId:i.tournamentId,participants:c}}),a){let{eventId:e,drawId:t,...r}=a,n=r.scaleAttributes?.scaleType&&[r.scaleAttributes.scaleType];if(Object.keys(r).length){let a={itemType:Mc,itemValue:r};if(n&&(a.itemSubTypes=n),t||e){let{drawDefinition:r,event:n}=sp({tournamentRecord:i,eventId:e,drawId:t});t&&lg({drawDefinition:r,timeItem:a}),e&&cg({event:n,timeItem:a})}else sg({tournamentRecord:i,timeItem:a})}}return n&&d.includes(Ac)&&ki({topic:Ac,payload:n}),Zi({...I,modificationsApplied:o,info:u})}function Xv({scaleItem:e}){let t=e&&Object.keys(e),r=["scaleType","eventType","scaleName"];return!(r.filter((e=>t?.includes(e))).length!==r.length)}function Zv({removePriorValues:e,participant:t,scaleItem:r}){if(!t)return{error:ht};let i=r&&Object.keys(r),n=["scaleType","eventType","scaleName"];if(n.filter((e=>i.includes(e)&&r[e])).length!==n.length)return{error:ir};let a=(new Date).toISOString();t.timeItems||(t.timeItems=[]);let{scaleItem:o}=jm({scaleAttributes:r,participant:t}),s=e=>[void 0,null,""].includes(e),c=!(s(o?.scaleValue)&&s(r.scaleValue))&&JSON.stringify(o?.scaleValue)!==JSON.stringify(r.scaleValue);if(c){let{scaleType:i,eventType:n,scaleName:o}=r,s=[jn,i,n,o].join("."),c=Zi({itemValue:r.scaleValue,itemDate:r.scaleDate,createdAt:a,itemType:s});r.scaleId&&(c.itemSubTypes=[r.scaleId]),e&&(t.timeItems=t.timeItems.filter((e=>e.itemType!==s))),t.timeItems.push(c)}return{...I,valueChanged:c,newValue:r.scaleValue}}var ey={nSpread:400,diffThreshold:.125,kCalc:(e=0)=>250/Math.pow(e+5,.4),kMultiplier:function(e=3,t=2){let r=e/t;return isNaN(r)?ey.kDefault():r},kDefault:()=>1};function ty(e){let{winnerRating:t,loserRating:r}=e,{ratings:i=Qg,winnerCountables:n=1,loserCountables:a=0,ratingType:o=Hg,maxCountables:s,countables:c}=e||{},u=i?.[o];if(!u)return{error:He};let d=u.range||e.ratingRange;t=t||u.defaultInitialization,r=r||u.defaultInitialization;let l=d[0]>d[1],p=u.decimalsCount||0,m=l?d.slice().reverse():d,f=(e,t)=>parseFloat(t)>=Math.min(...e)&&parseFloat(t)<=Math.max(...e);(!f(d,t)||!f(d,r))&&(f(d,t)||(t=u.defaultInitialization),f(d,r)||(r=u.defaultInitialization));let h=Wg({targetRange:Qg[Hg].range,sourceRange:m,value:l?d[0]-t:t}),g=Wg({targetRange:Qg[Hg].range,sourceRange:m,value:l?d[0]-r:r}),I=(e,t)=>1/(1+Math.pow(10,(t-e)/ey.nSpread)),U=I(h,g),v=I(g,h),y=ey.kCalc(n),S=ey.kCalc(a),w=ey.kMultiplier(s,c),P=h+w*y*(1-U),D=g+w*S*(0-v),T=Wg({sourceRange:Qg[Hg].range,value:P,targetRange:m}),b=Wg({sourceRange:Qg[Hg].range,value:D,targetRange:m}),R=l?d[0]-T:T,M=parseFloat(R.toFixed(p)),N=l?d[0]-b:b,A=parseFloat(N.toFixed(p)),E=Math.max(...d)?Math.abs(t-r)/Math.max(...d):0;return(T>b&&E>ey.diffThreshold||M<0||A<0)&&(M=t,A=r),{newWinnerRating:M,newLoserRating:A}}var ry=e=>e?.reduce(((e,t)=>(t.winningSide&&(e[t.winningSide-1]+=1),e)),[0,0])||[0,0];function iy(e){let{removePriorValues:t=!0,tournamentRecord:r,ratingType:i=Hg,considerGames:n,matchUpIds:a,asDynamic:o}=e;if(!r)return{error:D};if(!Array.isArray(a))return{error:Oe};if("string"!=typeof i)return{error:mr,ratingType:i};if(!Qg[i])return{error:mr};let s=Qg[i],{accessor:c}=s,u={},d=e.matchUps??cm({matchUpFilters:{matchUpIds:a,matchUpStatuses:ms},tournamentRecord:r,inContext:!0}).matchUps??[];d.sort(dm);for(let p of d){let{endDate:e,matchUpFormat:a,score:s,sides:d,winningSide:l}=p,m=p.matchUpType,f={eventType:m,scaleName:i,scaleType:Bn},h=`${i}.${Ln}`,g={scaleName:h,eventType:m,scaleType:Bn},I=Object.assign({},...(d??[]).map((e=>{let{sideNumber:t,participant:r}=e;return t&&{[t]:[r?.participantId,...r?.individualParticipantIds??[]].filter(Boolean).flat()}}))),U=o?h:i,v=Object.assign({},...Object.values(I).flat().map((t=>{let{scaleItem:i}=Kv({scaleAttributes:g,tournamentRecord:r,participantId:t}),{scaleItem:n}=Kv({tournamentRecord:r,scaleAttributes:f,participantId:t});return t&&{[t]:i??n??{scaleName:U,eventType:m,scaleDate:e,scaleType:Bn,scaleValue:c?{[c]:void 0}:void 0}}}))),y=a?Op(a):{},S=y?.bestOf||1,w=n?S&(y?.setsTo||1):S,P=s?.sets&&ry(s.sets)||1===l&&[1,0]||[0,1],D=l?I[l]:[],T=l?I[3-l]:[];for(let n of D){let e=v[n]?.scaleValue,a="object"==typeof e?e[c]:e;for(let o of T){let s=v[o]?.scaleValue,u="object"==typeof s?s[c]:s,d=l?P[l]:[0,0],p=l?P[3-l]:[0,0],{newWinnerRating:m,newLoserRating:f}=ty({winnerCountables:d,loserCountables:p,maxCountables:w,winnerRating:a,loserRating:u,ratingType:i}),h=c?{...e,[c]:m}:m,g=c?{...s,[c]:f}:f;v[n].scaleValue=h,v[o].scaleValue=g;let I=Qv({participantId:n,removePriorValues:t,tournamentRecord:r,scaleItem:{...v[n],scaleName:U}});if(I.error||(I=Qv({participantId:o,removePriorValues:t,tournamentRecord:r,scaleItem:{...v[o],scaleName:U}}),I.error))return I}}Object.assign(u,v)}let l=d.map((({matchUpId:e})=>e));return{...I,modifiedScaleValues:u,processedMatchUpIds:l}}function ny(e){let{matchUpIds:t=[],drawDefinition:r,roundNumber:i,newRound:n,isMock:a,event:o}=e;if("object"!=typeof r)return{error:M};let{participantIdPairings:s,matchUpsCount:c}=e,u=DU(e);if(u.error)return en({result:u});let{lastRoundNumber:d,availableMatchUpsCount:l=0,roundMatchUpsCount:p=0}=u;if(c){if(c>p&&!1!==e.restrictMatchUpsCount)return en({result:{error:mr,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}})}else n?c=p:l>0&&(c=l);if(s&&!Array.isArray(s)||c&&!Wr(c)||t&&!Array.isArray(t)||!s&&!c)return{error:mr,info:"matchUpsCount or pairings error"};if(c&&!1!==e.restrictMatchUpsCount&&c>32)return{error:mr,info:"matchUpsCount must be less than 33"};if(i&&!e.ignoreLastRoundNumber&&i-1>(d||0))return{error:mr,info:"roundNumber error"};let m=i??(n&&(d??0)+1||d||1);s=s??ai(0,c).map((()=>({participantIds:[void 0,void 0]})));let f=s?.map(((i,n)=>{let a=i?.participantIds??[void 0,void 0];a.push(void 0,void 0);let o=a.slice(0,2).map(((e,t)=>Zi({sideNumber:t+1,participantId:e}))),s=t[n]??(t=>{if(!e.idPrefix)return;return`${r.drawId}-${e.idPrefix??"ah"}-${m}-${t}`})(n)??Jl();return{roundNumber:m,matchUpStatus:os,matchUpId:s,sides:o}}));if(f?.length){let e=pp({drawDefinition:r,event:o})?.tieFormat;e&&f.forEach((t=>{let{tieMatchUps:r}=qg({tieFormat:e,matchUp:t,isMock:a});Object.assign(t,{tieMatchUps:r,matchUpType:Iu})}))}return{roundNumber:m,matchUpsCount:f?.length??0,matchUps:f,...I}}function ay(e){return e.participantIdPairings.map((({participantIds:e})=>e.sort().join("|"))).sort().join("/")}function oy({valueSortedPairings:e,stipulated:t=[],pairingValueMap:r,deltaObjects:i,valueObjects:n,actorsCount:a}){let o=[].concat(...t),s=[],c=0;t.filter(Boolean).forEach((e=>{let[t,i]=e,n=sy(t,i),a=r[n];s.push({participantIds:e,value:a}),c+=r[n]})),pi(e,a).map((e=>Qr(e).map((e=>({...e,value:e.value+Math.random()*Math.round(Math.random())}))))).flat().forEach((e=>{let t=e.pairing.split("|");if(!t.reduce(((e,t)=>o.includes(t)||e),!1)){o.push(...t);let r=e.value;c+=r,s.push({participantIds:t,value:r})}})),s.sort(((e,t)=>e.value-t.value));let u=s.reduce(((e,t)=>{let[r,n]=t.participantIds,a=sy(r,n),o=i[a];return o>e?o:e}),0),d=s.reduce(((e,t)=>{let[r,i]=t.participantIds,a=sy(r,i),o=n[a];return o>e?o:e}),0);return{value:c,participantIdPairings:s,maxDelta:u,maxDiff:d}}function sy(e,t){return[e,t].sort(Km).join("|")}function cy({participantIds:e}){let t={},r=[];e.forEach((i=>{t[i]=e.filter((e=>e!==i)),t[i].forEach((e=>{let t=sy(e,i);r.includes(t)||r.push(t)}))}));let i=Object.assign({},...r.map((e=>({[e]:0}))));return{uniquePairings:r,possiblePairings:t,deltaObjects:i}}var uy=0;function dy({tournamentParticipants:e,adHocRatings:t={},possiblePairings:r,uniquePairings:i,maxIterations:n,deltaObjects:a,valueObjects:o,eventType:s,scaleName:c,salted:u}){i.forEach((r=>{let i=function({tournamentParticipants:e,adHocRatings:t,eventType:r,scaleName:i,pairing:n}){let a=Qg[i]?.defaultInitialization??uy;return n.split("|").map((i=>{if(r===Ol){let r=e?.find((e=>e.participantId===i))?.individualParticipantIds;return r?r?.map((e=>t[e]||a)):2*a}return t[i]||a}))}({tournamentParticipants:e,adHocRatings:t,scaleName:c,eventType:s,pairing:r}),n="number"==typeof u&&u||.5,d=u&&(Math.round(Math.random())?n:-1*n)||0,l=Math.abs(i[0]-i[1])+d,p=Math.abs(i[0]-i[1]);a[r]=p,o[r]||(o[r]=0),o[r]+=l?Math.pow(l,2):0}));let d=i.map((e=>({pairing:e,value:o[e]}))).sort(((e,t)=>e.value-t.value)),{pairingValues:l}=function({possiblePairings:e,valueObjects:t}){let r={};for(let n of Object.keys(e)){let t=e[n].map((e=>i(n,e)));r[n]=t.sort(((e,t)=>e.value-t.value))}function i(e,r){let i=sy(e,r);return{opponent:r,value:t[i]}}return{pairingValues:r}}({possiblePairings:r,valueObjects:o}),{candidate:p,candidatesCount:m,deltaCandidate:f,iterations:h}=function({maxIterations:e=4e3,valueSortedPairings:t,pairingValues:r,valueObjects:i,deltaObjects:n}){let a=Object.assign({},...t.map((e=>({[e.pairing]:e.value})))),o=Object.keys(r),s=[],c=oy({actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:n,valueObjects:i}),u=[ay(c)];s.push(c);let d,l=c.value,p=c,m=0,f=0,h=o.length;do{h-=1,d=o.length*r[o[0]].length}while(d>e&&h>5);let g=[];o.forEach((e=>{r[e].slice(0,h).forEach((r=>{f+=1;let c=sy(e,r.opponent);if(!g.includes(c)){let d=oy({stipulated:[[e,r.opponent]],actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:n,valueObjects:i});if(!u.includes(ay(d))){u.push(ay(d)),s.push(d);let{maxDelta:e,value:t}=d;e<p.maxDelta&&(p=d),(t<l||t===l&&Math.round(Math.random()))&&(l=t),g.push(c),m+=1}}})),s=s.filter((e=>Math.abs(e.value-l)<5))})),s.sort(((e,t)=>e.maxDiff-t.maxDiff));let I=ii(s);return{candidatesCount:m,deltaCandidate:p,maxIterations:e,iterations:f,candidate:I}}({valueSortedPairings:d,maxIterations:n,pairingValues:l,deltaObjects:a,valueObjects:o}),{participantIdPairings:g}=p;return{participantIdPairings:g,candidatesCount:m,deltaCandidate:f,iterations:h,candidate:p}}var ly=100,py=100,my=4e3;function fy({encounterValue:e=ly,sameTeamValue:t=py,maxIterations:r=my,generateMatchUps:i=!0,ignoreLastRoundNumber:n,iterationMatchUps:a,tournamentRecord:o,dynamicRatings:s,participantIds:c,drawDefinition:u,adHocRatings:l,salted:p=.5,roundNumber:m,structureId:f,matchUpIds:h,eventType:g,structure:U,scaleName:v,idPrefix:y,isMock:S,event:w}){if(!u)return{error:M};if(!U&&!f)return{error:ae};if(U||(U=yc({drawDefinition:u,structureId:f}).structure),!d(U))return{error:se};if(!c?.length)return{error:St};let P=[...a??[],...U?.matchUps??[]],{encounters:D}=function({matchUps:e}){let t=[];for(let r of e){let e=r.sides.map(Go);if(2===e.length){let[r,i]=e,n=sy(r,i);t.includes(n)||t.push(n)}}return{encounters:t}}({matchUps:P}),T=o?.participants??[];if(s){let e=Yr(U?.matchUps?U.matchUps.map((({roundNumber:e})=>e)):[]),t=Math.max(...e,0);if(t){let e=U?.matchUps?.filter((({roundNumber:e})=>e===t)).map((({matchUpId:e})=>e));iy({ratingType:v||w?.category?.ratingType,tournamentRecord:o,asDynamic:!0,matchUpIds:e})}}let b,R,{valueObjects:N}=function({encounters:e,tournamentParticipants:t,encounterValue:r,sameTeamValue:i}){let n={};for(let o of e)n[o]||(n[o]=0),n[o]+=r;let a=t?.filter((({participantType:e})=>e===Mu));if(a)for(let o of a){let e=o.individualParticipantIds??[],{uniquePairings:t}=cy({participantIds:e});for(let r of t)n[r]||(n[r]=0),n[r]+=i}return{valueObjects:n}}({tournamentParticipants:T,encounterValue:e,sameTeamValue:t,encounters:D}),{uniquePairings:A,possiblePairings:E,deltaObjects:C}=cy({participantIds:c}),O={tournamentParticipants:T,possiblePairings:E,drawDefinition:u,participantIds:c,uniquePairings:A,maxIterations:r,adHocRatings:l,deltaObjects:C,valueObjects:N,eventType:g,scaleName:v,structure:U,salted:p},{candidatesCount:F,participantIdPairings:k,iterations:x,candidate:_}=dy(O);if(!F)return{error:sr};if(i){let e=ny({structureId:U?.structureId,ignoreLastRoundNumber:n,participantIdPairings:k,newRound:!0,drawDefinition:u,roundNumber:m,matchUpIds:h,idPrefix:y,isMock:S,event:w});if(e.error)return e;b=e.roundNumber,R=e.matchUps}let{maxDelta:L,maxDiff:V}=_;return{roundNumber:b,participantIdPairings:k,candidatesCount:F,...I,iterations:x,matchUps:R,maxDelta:L,maxDiff:V}}function hy(e){let{drawType:t=$s,attachConsolation:r=!0,applyPositioning:i=!0,tournamentRecord:n,staggeredEntry:a,automated:o,placeByes:s,isMock:c,event:u}=e,d=e?.drawDefinition;if(!d)return{error:M};let l=ys,p=Nd({stageSequence:1,drawDefinition:d,stage:l}),m=[sc,Ws,cc].includes(t)?p.length:qr(p.length);if(!a&&t===js&&p.length<2||t===sc&&p.length<3)return{error:q};let{tieFormat:f,matchUpType:h}=e;if(f){let e=QI({tieFormat:f});if(e.error)return e}f=ZI(f??pp({drawDefinition:d})?.tieFormat),h=h??d.matchUpType??mu;let{structures:g}=Sc({stageSequence:1,drawDefinition:d,stage:l});if(g.length>1)return{error:Ue};if(g?.[0]?.matchUps?.length)return{error:br};let U=g?.[0]?.structureId;Object.assign(e,Zi({structureName:e.structureName??Of(ys),structureId:U,matchUpType:h,tieFormat:f,drawSize:m,stage:l}));let v=Hv(e);if(v.error)return v;let y=v.generators[t];if(!y)return{error:_};let S=y?.();if(S.error)return S;let{structures:w,links:P}=S,D=w.map((e=>Kp({structure:e}).matchUps)).flat();f&&D.forEach((e=>{let{tieMatchUps:t}=qg({matchUp:e,tieFormat:f,isMock:c});Object.assign(e,{tieMatchUps:t,matchUpType:h})})),(!i||!r)&&(d=Da(d,!1,!0)),d.links||(d.links=[]),P.length&&d.links.push(...P);let T=w.map((({structureId:e})=>e));d.structures||(d.structures=[]);let b=d.structures.map((({structureId:e})=>e));d.structures=d.structures.map((e=>T.includes(e.structureId)?w.find((({structureId:t})=>t===e.structureId)):e));let R=w.filter((({structureId:e})=>!b.includes(e)));return R.length&&d.structures.push(...R),o&&eg({seedingProfile:e.seedingProfile,applyPositioning:i,tournamentRecord:n,drawDefinition:d,structureId:U,placeByes:s,drawSize:m,event:u}),r&&au({drawDefinition:d}),{links:P,structures:w,...I}}var gy={};n(gy,{addGame:()=>My,addPoint:()=>Ry,addSet:()=>Ay,addShot:()=>Ny,analyzeScore:()=>aw,analyzeSet:()=>dw,calculateHistoryScore:()=>Py,checkScoreHasValue:()=>Um,checkSetIsComplete:()=>MS,clearHistory:()=>by,generate:()=>Iy,generateScoreString:()=>Uy,generateTieMatchUpScore:()=>JI,getSetComplement:()=>sw,getTiebreakComplement:()=>cw,helpers:()=>Fy,isValidMatchUpFormat:()=>qI,keyValueScore:()=>OS,mutate:()=>Sy,parseMatchUpFormat:()=>Op,parseScoreString:()=>uw,query:()=>nw,redo:()=>Ey,reverseScore:()=>yy,setServingSide:()=>Ty,stringifyMatchUpFormat:()=>LI,tidyScore:()=>iw,umo:()=>Oy,undo:()=>Cy,validateScore:()=>ow,validateTieFormat:()=>QI});var Iy={};function Uy(e){let{winnerFirst:t=!0,addOutcomeString:r,reversed:i=!1,matchUpStatus:n,matchUpFormat:a,autoComplete:o,winningSide:s,sets:c}=e;if(!c)return{error:He,info:"missing sets"};let u=a&&Op(a),{bestOf:d,finalSetFormat:l,setFormat:p}=u??{},m=i||!(!t||!s||1===s),f=r?function({matchUpStatus:e}){let t={[ns]:"RET",[ss]:"WO",[Zo]:"DF/DF",[es]:"WO/WO",[as]:"SUS",[Ho]:"ABN",[Xo]:"DEF",[Jo]:"DR"};return e&&t[e]||""}({matchUpStatus:n}):"",h=c?.sort(vy).map((function(e){let t=d&&e.setNumber===d&&l?l:p,r=t?.tiebreakSet||(f=e,!(jr(f?.side1Score)||jr(f?.side2Score))&&(e=>jr(e?.side1TiebreakScore)||jr(e?.side2TiebreakScore))(e)),{side1Score:i,side2Score:n,side1TiebreakScore:a,side2TiebreakScore:s}=e,c=a||(jr(a)||o?0:""),u=s||(jr(s)||o?0:"");var f;if(r)return`[${(m?[u,c]:[c,u]).join("-")}]`;let h=Math.min(c,u),g=h?`(${h})`:"",I=i||(jr(i)||o?0:""),U=n||(jr(n)||o?0:""),v=m?`${[U,I].join("-")}${g}`:`${[I,U].join("-")}${g}`;return["-"," "].includes(v)&&(v=""),v})).filter(Boolean).join(" ")||"";return f?2===s?`${f} ${h}`:`${h} ${f}`:h}function vy(e,t){return e.setNumber-t.setNumber}function yy(e){if(!e?.score)return{error:He};let{sets:t}=e.score,r=t.map((e=>{let{side1TiebreakScore:t,side2TiebreakScore:r,winningSide:i,side1Score:n,side2Score:a,setNumber:o}=e;return Zi({winningSide:i?3-i:void 0,side1TiebreakScore:r,side2TiebreakScore:t,side1Score:a,side2Score:n,setNumber:o})}));return{reversedScore:{sets:r,scoreStringSide1:Uy({sets:r}),scoreStringSide2:Uy({sets:r,reversed:!0})},...I}}n(Iy,{generateScoreString:()=>Uy,generateTieMatchUpScore:()=>JI,reverseScore:()=>yy});var Sy={};function wy({matchUp:e}){let{extension:t}=no({name:vo,element:e});if(!t)return{error:vr};let{history:r=[],undoHistory:i=[]}=t.value;return{history:r,undoHistory:i,...I}}function Py(e){if(!e)return{error:He};let{matchUp:t,updateScore:r}=e;if(!t)return{error:Fe};let i=wy({matchUp:t})?.history||[];if(!Array.isArray(i))return{error:mr,info:"history is not an array"};let{matchUpFormat:n}=t;if(!n)return{error:Re};if(!qI({matchUpFormat:n}))return{error:be};let a,o,s=Op(n),{bestOf:c,finalSetFormat:u,setFormat:d}=s,l=["0","15","30","40","A","G"],p={sets:[]},m=[],f=[0,0],h=1,g=0,U=0,v=e=>[1,2].includes(e),y=()=>(g+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:g,games:[]}),S={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},w={winningSide:void 0,points:[]},P=y(),D=0;for(let I of i){D+=1,o=p.sets.length+1===c;let e=o&&u?u:d,{tiebreakAt:t,setTo:r,NoAD:i,tiebbreakFormat:n}=e,s=P.side1Score===t&&P.side1Score===P.side2Score,g=!!e.tiebreakSet,T=g?e.tiebreakSet:n,{tiebreakTo:b,NoAD:R}=T||{},M=()=>{a=void 0,f=[0,0],h=3-h,P.side1TiebreakScore=0,P.side2TiebreakScore=0,P.side1PointScore="",P.side2PointScore="",U=0},N=e=>{P.winningSide=e;let{s:t,...r}=P;p.sets.push(r),S={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},w={winningSide:void 0,points:[]},P=y(),M()},A=e=>{w.winningSide=e;let{g:t,...r}=w;P.games.push(r),S={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},w={winningSide:void 0,points:[]},M(),P[`side${e}Score`]+=1},E=e=>{S.winningSide=e;let{p:t,...r}=S;w.points.push(r),S={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},U=0;let n=e-1;if(s||g){f[n]+=1,a=f.reduce(((e,t)=>e+t))%4/4>.5?h:3-h,P[`side${e}TiebreakScore`]=f[n],P[`side${3-e}TiebreakScore`]=f[1-n];let t=R?1:2;if(f[n]>=b&&f[n]>=f[1-n]+t)return A(e),{gameCompleted:!0}}else if(4===f[1-n]&&3===f[n]?f[1-n]-=1:f[n]+=1,P.side1PointScore=l[f[0]],P.side2PointScore=l[f[1]],5===f[n]||4===f[n]&&f[1-n]<3||i&&4===f[n])return A(e),{gameCompleted:!0}};if(v(I.srv)&&(h=I.srv),["p","s","g","o"].includes(I.u)&&m.push(I.u),I.shotOutcome&&(S.shots.push(I),"SERVE"===I.shotType&&["OUT","NET"].includes(I.shotOutcome)&&(U+=1),2===U)){E(3-h)}if(v(I.p)||Wr(I.pointNumber)){let e=I.winningSide||I.p;if(E(e)?.gameCompleted)continue}if(v(I.g)||Wr(I.gameNumber)){let e=I.winningSide||I.g;w.winningSide=e;let t=`side${e}Score`,n=`side${3-e}Score`;if(m.length&&(m.includes("p"),m=[]),A(e),P[t]===r&&P[t]-P[n]>=(i?1:2)&&(N(e),o))break}if(v(I.s)||Wr(I.setNumber)){if(N(I.winningSide||I.s),m.length&&(m.includes("p"),m.includes("g"),m=[]),o)break}}return D!==i.length&&console.log({error:"Match completed with excess history"}),(P.side1Score||P.side2Score||P.games.length||P.side1TiebreakScore||P.side2TiebreakScore)&&p.sets.push(P),p.scoreStringSide1=Uy({...p,matchUpFormat:n}),p.scoreStringSide2=Uy({...p,matchUpFormat:n,reversed:!0}),h=a||h,r&&(t.score=p),{...I,servingSide:h,score:p}}function Dy({undoHistory:e,history:t,matchUp:r}){return za({element:r,extension:{value:{history:t,undoHistory:e},name:vo}})}function Ty({matchUp:e,sideNumber:t}){if(![1,2].includes(t))return{error:qe};let{history:r=[]}=wy({matchUp:e});return r.push({srv:t}),Dy({matchUp:e,history:r})}function by({matchUp:e}){return Dy({matchUp:e})}function Ry({matchUp:e,point:t}){if(!t||!e)return{error:He};if("object"!=typeof t)return{error:mr,context:{point:t}};let{history:r=[]}=wy({matchUp:e});return r.push(t),Dy({matchUp:e,history:r})}function My({matchUp:e,game:t}){if("object"!=typeof t)return{error:mr,context:{game:t}};let{history:r=[]}=wy({matchUp:e});return r.push(t),Dy({matchUp:e,history:r})}function Ny({matchUp:e,shot:t}){if("object"!=typeof t)return{error:He};let{history:r=[]}=wy({matchUp:e});return r.push(t),Dy({matchUp:e,history:r})}function Ay({matchUp:e,set:t}){if("object"!=typeof t)return{error:He};let{history:r=[]}=wy({matchUp:e});return r.push(t),Dy({matchUp:e,history:r})}function Ey({matchUp:e}){let{history:t=[],undoHistory:r=[]}=wy({matchUp:e});return r.length&&t.push(r.pop()),Dy({matchUp:e,history:t,undoHistory:r})}function Cy({matchUp:e}){let{history:t=[],undoHistory:r=[]}=wy({matchUp:e});return r.push(t.pop()),Dy({matchUp:e,history:t,undoHistory:r})}n(Sy,{addGame:()=>My,addPoint:()=>Ry,addSet:()=>Ay,addShot:()=>Ny,calculateHistoryScore:()=>Py,clearHistory:()=>by,redo:()=>Ey,setServingSide:()=>Ty,umo:()=>Oy,undo:()=>Cy});var Oy={},Fy={};n(Fy,{keyValueScore:()=>OS,parseMatchUpFormat:()=>Op,stringifyMatchUpFormat:()=>LI,tidyScore:()=>iw});var ky=" ",xy="DEF",_y="COMPLETED",Ly="WO",Vy="ABN",By="SUS",jy="RET",Gy="INT",qy=[jy,xy,Ly,"WO/WO",Vy,By,Gy],$y="DEFAULTED",Wy="WALKOVER",Hy="ABANDONED",zy="SUSPENDED",Yy="RETIRED",Ky="INTERRUPTED",Qy=[Yy,$y,Wy],Jy="()",Xy="[]",Zy=["up","left","shift+tab"],eS=["enter","down","tab","right"],tS="backspace",rS="r",iS="s",nS="a",aS="d",oS="w",sS="i",cS=[rS,aS,oS,nS,iS,sS],uS="space",dS=["[","("],lS=[...Zy,...eS,uS,"]"],pS="-",mS="-",fS=["/"],hS=0,gS=["0","1","2","3","4","5","6","7","8","9"].concat(cS),IS=gS.map((e=>`shift+${e}`)),US=[pS,tS].concat(lS,fS),vS=[gS,IS,US].join(","),yS=[vS,Zy,eS,["=","+","num_1","num_2","shift+=","shift+-"]].join(","),SS=([].concat(...gS,...gS,...US,...gS,...gS,...gS,...gS,...gS,...gS),{OUTCOMEKEYS:cS,SIDE1KEYS:gS,SIDE2KEYS:IS,MODIFIERS:US,PROMPT:"Enter Score",MOVEUP:Zy,MOVEDOWN:eS,HOTKEYS:yS});function wS({scoreString:e,lowSide:t,outcome:r}){if(({scoreString:e}=PS({scoreString:e})),2===t){return e+((e&&e[e.length-1])!==ky?ky:"")+r}return r+ky+e}function PS({scoreString:e}){if(!e)return{scoreString:""};let t=!1;for(let r of qy){let i=e?.indexOf(r);0===i?e=e.slice(r.length+1).trim()+ky:i>0&&(e=e.slice(0,i)),i>=0&&(t=!0)}return e?.trim()||(e=""),{scoreString:e,removed:t}}function DS({analysis:e,scoreString:t,sets:r,lowSide:i}){let n,a;if(!t)return{scoreString:t,sets:r};let{scoreString:o,removed:s}=PS({scoreString:t});if(t=o,s)return{scoreString:t,sets:r,outcomeRemoved:!0};let c=r[r.length-1]||{},u=Object.values(c).filter((e=>void 0!==e)).length;c.setNumber&&1===u&&(c=(r=r.slice(0,r.length-1))[r.length-1]||{});let{tiebreakSet:d}=e.setFormat,{tiebreakTo:l,NoAD:p}=d||{},{isTiebreakEntry:m}=TS({brackets:Xy,scoreString:t}),f=function(e){return e.split("").reduce(((e,t,r)=>(t.match(/\d+/g)&&e.push(r),e)),[]).pop()}(t);if(f>=0){n=t.slice(0,f);let{isTiebreakEntry:o}=TS({brackets:Jy,scoreString:n}),{lastOpenBracketIndex:s,isTiebreakEntry:u}=TS({brackets:Xy,scoreString:n}),d=n&&n[n.length-1].trim(),h=n&&!isNaN(d),g=e.isIncompleteSetScore;if(m&&u){let e=n.slice(s+1).split(mS),r=e?.length>0&&void 0!==e[0]&&!isNaN(parseInt(e[0]))&&parseInt(e[0])||void 0,a=e?.length>1&&void 0!==e[1]&&parseInt(e[1])||void 0,o=[r,a];if(a){let e=1===i?1:0;o[e]=(o?.[1-e]||0)+(p?1:2),(o[e]||0)<l&&(o[e]=l),n=t.slice(0,s+1),n+=o.join(mS)}else void 0!==r?(n=t.slice(0,s+1),n+=r):(n=t.slice(0,s),g=!0);c.side1TiebreakScore=o[0]||0,c.side2TiebreakScore=o[1]||0}if(n.length||(n=void 0),g){let t=c.side1Score?.toString();if(t){let e=t?.slice(0,t.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}e.isTimedSet?(a=c.side1Score?r:r?.slice(0,r.length-1)||[],a[r.length-1]=c):a=r?.slice(0,r.length-1)||[]}else if(h){let t=c.side2Score?.toString(),i=c.side1Score?.toString();if(!e.isTiebreakEntry&&!e.isMatchTiebreak)if(c.side2Score){let e=t?.slice(0,t.length-1);c.side2Score=!isNaN(e)&&parseInt(e)||void 0}else{let e=i?.slice(0,i.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0}e.isTimedSet?c.side1Score?(a=r||[],a[r.length-1]=c):a=r?.slice(0,r.length-1)||[]:(a=r||[],a[r.length-1]=c),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else o?(a=r||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(m&&!u?a=r?.slice(0,r.length-1)||[]:(a=r,a[r.length-1]=c),m||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:t,sets:r}}function TS({brackets:e=Jy,scoreString:t}){if(!t)return{};let[r,i]=e.split(""),n=t.split(""),a=Math.max(...oi(r,n));return{isTiebreakEntry:a>Math.max(...oi(i,n)),lastOpenBracketIndex:a}}function bS(e){let{lowValue:t=0,NoAD:r=!1,tiebreakTo:i}=e||{};return t+1>=i?t+(r?1:2):parseInt(i)}function RS({matchUpFormat:e,matchUpStatus:t,winningSide:r,sets:i}){let n=Op(e),{bestOf:a}=n,o=Math.ceil(a/2),s=i?.reduce(((e,t)=>{let{winningSide:r}=t;return r&&e[r-1]++,e}),[0,0])?.indexOf(o)+1||void 0;return Qy.includes(t)&&r&&(s=r),{matchUpWinningSide:s}}function MS({ignoreTiebreak:e=!1,matchUpScoringFormat:t,matchUpFormat:r,isTiebreakSet:i,isDecidingSet:n,set:a}){if(!a)return{error:He,info:"missing set"};t=t||r&&Op(r);let o=n&&t.finalSetFormat||t?.setFormat||{},{side1Score:s,side2Score:c}=a,{setTo:u,tiebreakAt:d}=o,l=NS({set:a}),p=Math.abs(s-c),m=s>=u||c>=u,f=i||s>=u&&c>=u||d&&d<u&&(s===d||c===d),h=e||f&&(1===l&&a.side1TiebreakScore>a.side2TiebreakScore||2===l&&a.side2TiebreakScore>a.side1TiebreakScore),g=!f&&o.NoAD||f||i&&o.tiebreakFormat?.NoAD?1:2;return!(!(m&&(p>=g||f)||i)||f&&!h)}function NS({set:e}){if(e.side1Score||e.side2Score){if(e.side1Score>e.side2Score)return 1;if(e.side2Score>e.side1Score)return 2}else if(e.side1TiebreakScore||e.side2TiebreakScore){if(e.side1TiebreakScore>e.side2TiebreakScore)return 1;if(e.side2TiebreakScore>e.side1TiebreakScore)return 2}}function AS({analysis:e,set:t}){let r=NS({set:t}),{isDecidingSet:i,isTiebreakSet:n,matchUpScoringFormat:a}=e;return MS({matchUpScoringFormat:a,isDecidingSet:i,isTiebreakSet:n,set:t})&&r}function ES({lowSide:e,value:t,sets:r,scoreString:i,winningSide:n,matchUpStatus:a}){let o;return t===rS?i?(o=!0,i=wS({scoreString:i,lowSide:e,outcome:jy}),n=2===e?1:2,a=Yy):(o=!0,i=wS({scoreString:i,lowSide:e,outcome:xy}),n=2===e?1:2,a=$y):t===aS?(o=!0,i=wS({scoreString:i,lowSide:e,outcome:xy}),n=2===e?1:2,a=$y):t===oS?(o=!0,r=[],i=Ly,n=2===e?1:2,a=Wy):t===iS&&i?(o=!0,i=wS({scoreString:i,lowSide:e,outcome:By}),a=zy,n=void 0):t===nS?(o=!0,i=wS({scoreString:i,lowSide:e,outcome:Vy}),a=Hy,n=void 0):t===sS&&i&&(o=!0,i=wS({scoreString:i,lowSide:e,outcome:Gy}),a=Ky,n=void 0),{updated:o,sets:r,scoreString:i,matchUpStatus:a,winningSide:n}}function CS({matchUpFormat:e,scoreString:t,winningSide:r,value:i,sets:n}){let a=(n?.filter((e=>e?.winningSide))?.length||0)+(r?0:1),o=Op(e),s=a===o?.bestOf,c=s&&o?.finalSetFormat||o?.setFormat||{},u=c?.timed,d=s&&n[o?.bestOf-1],l=d?.winningSide,{isTiebreakEntry:p}=TS({brackets:Jy,scoreString:t}),{isTiebreakEntry:m}=TS({brackets:Xy,scoreString:t}),f=p||m,h=!!c.tiebreakSet,g=t?.[t.length-1]?.trim(),I=t&&!isNaN(g),U=!f&&g===pS,v=p&&dS.includes(g),y=m&&dS.includes(g),S=m&&g===mS,w=t?.split(""),[P]=Xy.split(""),D=w&&Math.max(...oi(P,w)),T=w&&Math.max(...oi(mS,w)),b=w&&T>D,R=n[n.length-1]?.winningSide,M=n?.length&&!R,N=qy.find((e=>t?.indexOf(e)>=0)),A=!isNaN(i),E=i===uS,C=lS.includes(i),O=t?.split("").find((e=>dS.includes(e))),F=C&&m&&!y&&(S||!function({scoreString:e}){if(!e)return!1;let t=e&&e[e.length-1].trim(),r=e&&!isNaN(t),[i,n]=Xy.split(""),a=e.split(""),o=Math.max(...oi(i,a)),s=Math.max(...oi(n,a)),c=Math.max(...oi(mS,a));return r&&o>s&&c>o}({scoreString:t}));return{isTiebreakSetValue:h&&A,matchUpScoringFormat:o,setNumber:a,setFormat:c,matchTiebreakHasJoiner:b,isGameScoreEntry:M,isSpace:E,isCloser:C,isTiebreakCloser:C&&O&&f&&I,isDecidingSet:s,isTiebreakSet:h,isTimedSet:u,isNumericEnding:I,isNumericValue:A,hasOpener:O,hasOutcome:N,finalSet:d,finalSetIsComplete:l,lastSetIsComplete:R,isInvalidSetTiebreakValue:E&&f&&v,isInvalidMatchTiebreakValue:F,isTiebreakEntry:f,isSetTiebreakEntry:p,isMatchTiebreakEntry:m,isIncompleteSetScore:U,isIncompleteSetTiebreak:v,isIncompleteMatchTiebreak:y,isPartialMatchTiebreakValue:S}}function OS(e){let t,r,{lowSide:i=1,value:n}=e,{scoreString:a,sets:o,winningSide:s,matchUpStatus:c}=e,{matchUpFormat:u,shiftFirst:d,auto:l=!0}=e,p=d&&2===i||!d&&1===i;if(!vS.includes(n))return{updated:!1,info:"invalid key"};d&&(i=3-i);let{matchUpWinningSide:m}=RS({sets:o,winningSide:s,matchUpStatus:c,matchUpFormat:u});s=m;let f=CS({value:n,winningSide:s,scoreString:a,sets:o,matchUpFormat:u});if(fS.includes(n)&&(n=pS),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&0===xr(n)&&(f.isTiebreakCloser=!0),lS.includes(n)&&f.hasOpener&&(n=""),lS.includes(n)&&(n=uS),f.lastSetIsComplete){let e=a?.length&&a[a.length-1];a&&" "!==e&&(a+=" ")}if(f.isTimedSet)({info:r,sets:o,scoreString:a,updated:t,matchUpStatus:c,winningSide:s}=function(e){let t,r,{sets:i,info:n,scoreString:a,winningSide:o,matchUpStatus:s}=e,{analysis:c,lowSide:u,value:d}=e;!i?.length&&d!==tS&&(i=[{setNumber:1}]);let l=i.length-1;if(cS.includes(d)){let e=i[i.length-1]||{},{side1Score:r,side2Score:l}=e;r&&!l?n="missing side2Score":c.finalSetIsComplete||o?n="final set is already complete":c.isIncompleteSetScore?n="incomplete set scoreString":c.isIncompleteSetScore||({sets:i,scoreString:a,winningSide:o,matchUpStatus:s,updated:t}=ES({lowSide:u,value:d,sets:i,scoreString:a,matchUpStatus:s,winningSide:o}))}else if(d===tS){if(({scoreString:a,sets:i,outcomeRemoved:r}=DS({analysis:c,scoreString:a,sets:i})),""===a?.trim()&&(a=a.trim()),a||(i=[]),r){let e=i[i.length-1]||{},{side1Score:t,side2Score:r}=e;if(t&&r){let n=(t>r?1:r>t&&2)||void 0;n&&(e.winningSide=n,i.push({setNumber:i.length+1}))}}s=void 0,o=void 0,t=!0}else if(c.hasOutcome)n="has outcome";else{if(o)return{sets:i,scoreString:a,winningSide:o,matchUpStatus:s,updated:!1,info:"matchUp is complete"};if(d===uS){let e=i[i.length-1]||{},{side1Score:r,side2Score:n}=e,s=(r>n?1:n>r&&2)||void 0;s&&!o&&!c.isIncompleteSetScore&&(i[i.length-1].winningSide=s,i.push({setNumber:i.length+1}),a+=" ",t=!0)}else if(d===pS&&void 0!==i[l].side1Score&&void 0===i[l].side2Score&&a&&c.isNumericEnding)a+="-",i[l].side2Score=0,s=void 0,o=void 0,t=!0;else if(!isNaN(d)){let e;if(void 0===i[l].side2Score){let r=xr((i[l].side1Score||0).toString()+d).toString().slice(0,2);i[l].side1Score=xr(r),e=i[l].side1Score.toString(),t=!0}else{let r=xr((i[l].side2Score||0).toString()+d).toString().slice(0,2);i[l].side2Score=xr(r),e=[i[l].side1Score,i[l].side2Score].join("-"),t=!0}if(t){let t=(i.slice(0,l)||[]).filter((e=>e)).map((e=>{let{side1Score:t,side2Score:r}=e;return[t,r].join("-")})).join(" ");a=t?t+" "+e:e}}}return{sets:i,scoreString:a,winningSide:o,matchUpStatus:s,info:n,updated:t}}({analysis:f,lowSide:i,scoreString:a,sets:o,matchUpStatus:c,winningSide:s,value:n}));else if(cS.includes(n))f.finalSetIsComplete||s?r="final set is already complete":f.isTiebreakEntry||f.isIncompleteSetScore?f.isTiebreakEntry||f.isIncompleteSetScore?r="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:n}):({sets:o,scoreString:a,matchUpStatus:c,winningSide:s,updated:t}=ES({lowSide:i,sets:o,scoreString:a,matchUpStatus:c,winningSide:s,value:n}));else if(n===tS)t=!0,({scoreString:a,sets:o}=DS({analysis:f,scoreString:a,sets:o,lowSide:i})),a||(o=[]),c=void 0,s=void 0;else if(f.hasOutcome)r="has outcome";else if(n!==pS||f.isMatchTiebreakEntry)if(n===mS&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?r="existing joiner":f.isNumericEnding&&(t=!0,a+=mS);else if([pS,mS].includes(n))r="invalid location for joiner";else{if(s)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:o,scoreString:a,updated:t}=function({analysis:e,scoreString:t,sets:r,value:i}){let n;if(!r?.length)return{sets:[]};let a=r[r.length-1];i=xr(i);let{validSide2Score:o,requiresTiebreak:s}=function({analysis:e,set:t={},value:r}){let i,n,a=e.isDecidingSet&&e.matchUpScoringFormat.finalSetFormat||e.matchUpScoringFormat.setFormat,{tiebreakAt:o,setTo:s,NoAD:c}=a,{side1Score:u}=t;return i=o&&o<s?u===o?r<=s:r<=o:u===s?c?r<s:r<=s+1:u===s-1?c?r<=s:r<=s+1:u===s+1?r===s||r===s-1:r<=s,i&&(n=o&&o<s?u===s&&r===o||u===o&&r===s:u>=s&&r>=s&&u!==r),{validSide2Score:i,requiresTiebreak:n}}({analysis:e,set:a,value:i});if(o){n=!0,t=(t||"")+i,a.side2Score=i;let o=AS({analysis:e,set:r[r.length-1]});a.winningSide=o||void 0,s?t+=Jy.split("")[0]:e.isDecidingSet||(t+=ky)}return{sets:r,scoreString:t,updated:n}}({analysis:f,scoreString:a,sets:o,value:n}));else if(f.isInvalidMatchTiebreakValue)r="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)r="invalid set tiebreak character";else if(f.isTiebreakCloser){let e=f.isSetTiebreakEntry?Jy:Xy,r=e.split("").reverse()[0],i=e.split("")[0],n=o[o.length-1],{tiebreakFormat:s}=f.setFormat,{tiebreakTo:c,NoAD:u}=s||{},d=NS({set:n});if(!f.isTiebreakSet){let e=parseInt(a.split(i).reverse()[0]),t=bS({lowValue:e,tiebreakTo:c,NoAD:u});1===d?(n.side1TiebreakScore=t,n.side2TiebreakScore=e):(n.side1TiebreakScore=e,n.side2TiebreakScore=t)}a=(a||"")+r,f.isDecidingSet||(a+=ky);let l=AS({analysis:f,set:n});n.winningSide=l||void 0,t=!0}else if(f.isTiebreakSetValue)({info:r,scoreString:a,sets:o,updated:t}=function({analysis:e,auto:t,lowSide:r,scoreString:i="",sets:n,value:a}){let o,s,{tiebreakSet:{tiebreakTo:c,NoAD:u}}=e.setFormat,[d]=Xy.split("");if(e.isMatchTiebreakEntry||(i+=d),n[e.setNumber-1]){let{lastOpenBracketIndex:e}=TS({brackets:Xy,scoreString:i}),d=(i.slice((e??0)+1)+(t?"":a)).split(mS);if((d[r-1]?.length||0)>=2)s="tiebreak digit limit";else if(t){1===r&&(d[0]=(d[0]||"")+a),2===r&&(d[1]=(d[1]||"")+a);let t=[d[0]||0,d[1]||0].map((e=>xr(e))),s=1===r?1:0;t[s]=t[1-s]+(u?1:2),t[s]<c&&(t[s]=c);let l=n[n.length-1];l.side1TiebreakScore=t[0],l.side2TiebreakScore=t[1],i=i.slice(0,(e??0)+1),i+=t.join(mS),o=!0}else{let e=[d[0]||0,d[1]||0].map((e=>xr(e))),t=n[n.length-1];t.side1TiebreakScore=e[0],t.side2TiebreakScore=e[1],i+=a,o=!0}}else{let e=bS({lowValue:xr(a||0),tiebreakTo:c,NoAD:u}),t=[xr(a),e];2===r&&t.reverse();let s={side1TiebreakScore:t[0],side2TiebreakScore:t[1],setNumber:n?.length+1||1};n.push(s),i+=t.join(mS),o=!0}return{info:s,scoreString:i,sets:n,updated:o}}({analysis:f,auto:l,lowSide:i,scoreString:a,sets:o,value:n}));else if(f.isSetTiebreakEntry){let[e]=Jy.split(""),i=Math.max(...oi(e,a.split(""))),o=a.slice(i+1),s=o&&xr(o)===hS,c=xr(o?o+n:n),{tiebreakFormat:u}=f.setFormat,{tiebreakTo:d,NoAD:l}=u||{};!s&&o.length<2?l&&c>d-1?r="invalid low value for NoAD tiebreak":(t=!0,a=(a||"")+n):r=s?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)r=`invalid key: ${n}`;else if(f.isGameScoreEntry)r="game scoreString entry";else if(f.lastSetIsComplete||!o.length){t=!0;let{scoreString:e,set:r}=function({analysis:e,lowSide:t,scoreString:r,value:i}){let{setTo:n,tiebreakAt:a,NoAD:o}=e?.setFormat||{},s=i===parseInt(a||n);if(a&&a<n&&i>a)return{scoreString:r};if(o&&i===n||i>n)return{scoreString:r};let c=[i,s?i+1:i+1===n?i+(o?1:2):n];2===t&&c.reverse();let u=Jy.split("")[0];r=(r||"")+(c.join(pS)+(s?u:ky));let d={side1Score:c[0],side2Score:c[1]},l=AS({analysis:e,set:d});return d.winningSide=l||void 0,{scoreString:r,set:d}}({analysis:f,lowSide:i,scoreString:a,value:xr(n)});r&&(r.setNumber=o?.length+1||1),o=o?.concat(r).filter(Boolean)||[r],a=e||void 0}else console.log("error: unknown outcome")}else(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(t=!0,({scoreString:a,sets:o}=DS({analysis:f,scoreString:a,sets:o,lowSide:i})),c=void 0);if(t){o=o?.filter(Boolean);let{matchUpWinningSide:e}=RS({sets:o,winningSide:s,matchUpStatus:c,matchUpFormat:u});return s=e,!e||c&&![os,rs].includes(c)?a&&!s&&![zy,Hy,Ky].includes(c)&&(c=void 0):(c=_y,o=o.filter((e=>{let{side1Score:t,side2Score:r,side1TiebreakScore:i,side2TiebreakScore:n}=e;return t||r||i||n}))),{updated:t,scoreString:a,sets:o,winningSide:s,matchUpStatus:c,info:r}}return{updated:t,scoreString:a,sets:o,winningSide:s,matchUpStatus:c,info:r}}var FS="\\d+-\\d+",kS="\\d+-\\d+\\(\\d+\\)",xS="\\[\\d+-\\d+\\]",_S=new RegExp(`(${FS}),`,"g"),LS=new RegExp(`(${kS}),`,"g"),VS=[FS,kS,xS,"\\d+-\\d+\\(\\d+-\\d+\\)"],BS=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"].map((e=>{let t=e.split("").map((e=>VS[e])).join(" ");return new RegExp(`^${t}$`)}));function jS(e){return!e||BS.some((t=>t.test(e)))}function GS(e){return/^\(\d+\)$/.test(e)||/^\(\d+$/.test(e)}function qS(e){let t=(r=e,r?.split("-").join("").split("/").join(""));var r;if(/^\d+$/.test(t)&&2===t.length){let e=t.split("");return 1===Math.abs(e.reduce(((e,t)=>+e-+t)))}return!1}function $S(e,t){let r=[e.slice(t,t+2),t?e.slice(0,1):e.slice(2)].map((e=>parseInt(e.join(""))));t&&r.reverse();let i=r;if(Math.abs(i.reduce(((e,t)=>+e-+t)))>=2)return i.join("-")}function WS(e){return 2===e.length?e.split("").join("-"):([", ",",","/"," "].forEach((t=>e=e.split(t).join("-"))),e=e.replace(/-{2,}/,"-"))}function HS(e){return e.startsWith("(")&&e.endsWith(")")}function zS(e){if(!/^[\d-]+(\(\d\))*$/.test(e))return e;let t=oi("-",e.split(""));if(!t.length)return e;let r=e.split("-"),i=!(r.length%2),n=!!(t.length%2);return i&&n&&t.length>r.length/2&&t.filter(((e,t)=>t%2)).forEach((t=>{e=e.substring(0,t)+" "+e.substring(t+1)})),e}function YS({score:e}){let t,r=e.split(""),i=[],n=()=>t=[void 0,void 0,void 0],a=()=>{let e=`${t[0]}-${t[1]}`;return t[2]&&(e+=` (${t[2]})`),n(),t.push(t),e};n();let o=()=>void 0!==t[0]&&void 0!==t[1]&&Math.abs(parseInt(t[0])-parseInt(t[1]));for(;r.length;){let e=r.shift(),n=jr(e)&&parseInt(e),s=void 0!==t[0]&&void 0!==t[1];if(jr(n)){if(void 0===t[0]){t[0]=n;continue}if(void 0===t[1]&&(t[1]=n,o())){i.push(a()),t=[void 0,void 0];continue}if(s&&1===r.length&&jr(r[0])){let e=r.pop();t[0]=t[0].toString()+t[1].toString(),t[1]=e,i.push(a()),t=[void 0,void 0]}s&&o()}}return{sets:i}}function KS(e){let t=e.indexOf("1"),r=e.split(""),i=r.every((e=>!isNaN(e)));if(i&&3===e.length&&0===t){let e=$S(r,t);if(e)return e}if(i&&7===e.length&&t>3){let e=$S(r.slice(4),t-4);if(e)return`${r[0]}-${r[1]} ${r[2]}-${r[3]} ${e}`}}function QS(e){let{score:t}=e,{applied:r,matchUpStatus:i}=e,n=t?.toString().split(""),a=n?.every((e=>jr(e))),o=e=>Math.abs(e[0]-e[1]);if("number"==typeof t||a){t=t.toString().toLowerCase(),a&&(t=n.join(""));let e=a?n.map((e=>parseInt(e))):t.split("").map((e=>parseInt(e))),{sets:i}=YS({score:t});if(e.length,3===t.length&&1===o(e.slice(0,2))){let[i,n,a]=e;t=`${i}-${n}(${a})`,r.push("numericTiebreakPattern1")}else if(3===t.length&&1===e[0]){let[i,n,a]=e;t=`[${i}${n}-${a}]`,r.push("numericTiebreakPattern2")}else if(4===t.length&&1===o(e.slice(0,2))&&"987654".split("").includes(e[0].toString())){let[i,n,a,o]=e;t=`${i}-${n}(${Math.min(a,o)})`,r.push("numericTiebreakPattern3")}else if(4===t.length&&1===e[0]&&1===e[2]){let[i,n,a,o]=e;t=`[${i}${n}-${a}${o}]`,r.push("bigSuper")}else if(4===t.length){let[i,n,a,o]=e;t=`${i}${n} ${a}${o}`,r.push("split4")}else if(5===t.length&&1===o(e.slice(0,2))){let[i,n,a,o,s]=e;t=`${i}-${n}(${a}) ${o}-${s}`,r.push("numericTiebreakPattern4")}else if(5===t.length&&1===o(e.slice(3))){let[i,n,a,o,s]=e;t=`${i}-${n} ${a}-${o}(${s})`,r.push("numericTiebreakPattern5")}else if(7===e.length)if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===e[4]){let[i,n,a,o,s,c,u]=e;t=`${i}-${n} ${a}-${o} [${s}${c}-${u}]`,r.push("numericTiebreakPattern6")}else if(1===o(e.slice(0,2))&&o(e.slice(3,5))>1&&o(e.slice(5,7))>1){let[i,n,a,o,s,c,u]=e;t=`${i}-${n}(${a}) ${o}-${s} ${c}-${u}`,r.push("numericTiebreakPattern7")}else if(o(e.slice(0,2))>1&&1===o(e.slice(2,4))&&o(e.slice(5,7))>1){let[i,n,a,o,s,c,u]=e;t=`${i}-${n} ${a}-${o}(${s}) ${c}-${u}`,r.push("numericTiebreakPattern8")}else if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===o(e.slice(4,6))){let[i,n,a,o,s,c,u]=e;t=`${i}-${n} ${a}-${o} ${s}-${c}(${u})`,r.push("numericTiebreakPattern9")}else t=t.slice(0,2)+" "+t.slice(2,4)+" "+t.slice(4),r.push("numericMatchTiebreakPattern");else if(t.length%2){let e=KS(t);e&&t!==e&&r.push("parsedSuperPattern"),t=e??t}else{let i=pi(t.split(""),2).map((e=>e.join(""))),n=i.map((e=>{let[t,r]=e.split("").map((e=>parseInt(e))),i=t>r?1:2;return Math.abs(t-r)>1&&i||-1*i})),a=n.reduce(((e,t)=>e>0&&t>0),1),o=Xr(n),s=Xr(n.map((e=>Math.abs(e)))),c=n[0]<0,u=!c&&n[1]<0;if(n[0]>0&&n[1]>0&&n[0]!==n[1])t=[i.slice(0,2).join(" "),i.slice(2).join("-")].join(" "),r.push("numeric3rdSetTiebreakPattern");else if(a)t=i.join(" "),r.push("chunkSplit");else if(6==e.length){if(2==o[1]||2===o[2])if(Object.values(s).includes(3)){let[i,a,o,s,c,u]=e,d=n.reduce(((e,t,r)=>t<0?r:e),void 0);if(0===d){t=`${i}-${a}(${Math.min(o,s)}) ${c}-${u}`,r.push("chunkSplitTiebreak1")}else if(1===d){t=`${i}-${a} ${o}-${s}(${Math.min(c,u)})`,r.push("chunkSplitTiebreak2")}else t=`${i}-${a} ${o}-${s}`,r.push("chunkSplitTrimExtraneous")}else t=i.join(" "),r.push("chunkSplit")}else if(8===e.length){let[r,i,a,o,s,d,l,p]=e;c||u?1===e[5]&&(t=c?`${r}-${i}(${a}) ${o}-${s} [${d}${l}-${p}]`:`${r}-${i} ${a}-${o}(${s}) [${d}${l}-${p}]`):(n[0],n[1])}}}return{score:t,applied:r,matchUpStatus:i}}function JS(e){let t=[0,0],r=[],i=e.split(" "),n=/(\d+)-(\d+)/;i.forEach((e=>{if(n.test(e)){let i=e.match(n).slice(1).map((e=>parseInt(e))),a=i[0]>i[1]?1:i[1]>i[0]&&2;a&&(t[a-1]+=1,r.push(a))}}));let a=t[0]>t[1]?1:t[1]>t[0]&&2,o=t[0]>0&&t[0]===t[1],s=t.reduce(((e,t)=>e+t),0);return{setsWon:t,setsTied:o,setWinners:r,totalSets:s,winningSide:a}}var XS={handleTiebreakSlashSeparation:function({score:e}){let t=new RegExp(/\(\d+\/\d+\)/g),r=e.match(t);for(let i of r||[]){let t=i.replace("/","-");e=e.replace(i,t)}return{score:e}},handleSetSlashSeparation:function({score:e}){return new RegExp(/-\d+\/\d+-/).test(e)&&(e=e.split("/").join(" ")),{score:e}},punctuationAdjustments:function({score:e,applied:t}){e=function(e){let t="[];",r="()",i=t+r,n=[t[0],r[0]],a=Object.assign({},...i.split("").map((e=>({[e]:0})))),o="",s=e.split("").map((e=>{let s=i.includes(e)&&e,c=n.includes(s);if(c&&s)return a[s]+=1,o=s,e;if(!c&&s&&o&&s!==o){a[o]-=1;let e=t.includes(o)&&t||r.includes(o)&&r||"",i=e.split("").find((e=>e!==o));if(!e.includes(s))return a[s]||(o=""),i;a[o]||(o="")}return e})).join("");return e!==s?s:e}(e);let r=/\)(\d+)/g;if(r.test(e))for(let y of e.match(r)){let t=y.replace(")",") ");e=e.replace(y,t)}let i=/\(([\d- ]+)\)/,n=(e=(e=e.replace(/\)\//g,") / ")).replace(/\/\)/g,")")).match(/\(([\d- ]+)\)/g);for(let y of n||[]){let[t]=y.match(i).slice(1),r=t.replace(/ /g,"");e=e.replace(y,`(${r})`)}let a=/\(\(\d-\d\)\)/g;if(a.test(e)){let t=e.match(a);t.length&&t.forEach((t=>{let r=t.match(/\((\(\d-\d\))\)/).slice(1)[0];e=e.replace(t,r)}))}if(a=/\(\((\d)\)\)/g,a.test(e)){let t=e.match(a);t.length&&t.forEach((t=>{let r=t.match(/\((\(\d\))\)/).slice(1)[0];e=e.replace(t,r)}))}/(^|\s)6-,/.test(e)&&(e=e.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);e=e.replace(o,"-"),["- "," -"].forEach((t=>{let r=new RegExp(`(\\d+)${t}(\\d+)`,"g"),i=e.match(r);i&&i.forEach((r=>e=e.replace(r,r.split(t).join("-"))))})),/^[(-/,]+$/.test(e)&&(e=""),/\)[-/,]+$/.test(e)&&(e=e.slice(0,e.length-1)),/\d \/\d/.test(e)&&(e=e.replace(/ \//g,"/")),e.includes(" /")&&(e=e.replace(/ \//g," "));let s=/\(\d+, \)/g;s.test(e)&&e.match(s).forEach((t=>{let[r]=t.match(/\((\d+), \)/).slice(1);2===r.length?e=e.replace(t,`(${r})`):1===r.length&&"6"===r&&(e=e.replace(t,"(6-0)"))}));let c=/\((\d+)\/\)/g;c.test(e)&&e.match(c).forEach((t=>{let[r]=t.match(/\((\d+)\/\)/).slice(1);e=2===r.length?e.replace(t,`(${r})`):1===r.length&&"6"===r?e.replace(t,"(6-0)"):e.replace(t,`(${r})`)}));let u=/\d\/\d\/,/g;u.test(e)&&e.match(u).forEach((r=>{let[i]=r.match(/(\d\/\d)\/,/).slice(1);e=e.replace(r,`${i},`),t.push("slashComma")}));let d=/\(\/(\d+)\)/g;d.test(e)&&e.match(d).forEach((t=>{let[r]=t.match(/\(\/(\d+)\)/).slice(1);e=2===r.length?e.replace(t,`(${r})`):1===r.length&&parseInt(r)<6?e.replace(t,`(6-${r})`):e.replace(t,`(${r})`)}));let l,p,m,f,h,g=()=>{h=Xr(e.split("")),p=h["("]===(h[")"]||0)+1,l=(h["("]||0)+1===h[")"],m=h["["]===h["]"]+1,f=p&&!m};g();let I=/(\d+-\d+\(\d+)0,/;if(I.test(e)){let[t]=e.match(I).slice(1);e=e.replace(I,t+")")}if(h["("]===h[")"]&&h["("]>1){let t=e.split(")(").join(") (").split(" ");e=t.every(HS)?t.map((e=>{let t=e.slice(1,e.length-1);return t.length>2?t:e})).join(" "):t.join(" ")}g();let U=/[A-Za-z]+/.test(e),v=/\d+/.test(e);if(!U&&!v)return{score:""};if(/^\[.+\]$/.test(e)&&"()/,- ".split("").some((e=>h[e]))&&(e=e.slice(1,e.length-1)),/^\(.+\)$/.test(e)&&1===h["("]&&1===h[")"]&&"[]/,".split("").some((e=>h[e]>1))&&(e=e.slice(1,e.length-1)),e.startsWith("(")&&e.endsWith("))")&&(e=e.slice(1,e.length-1)),h["("]>(h[")"]||0)&&"("===e[e.length-1]&&(e=e.slice(0,e.length-1)+")",g()),1===h["("]&&!h[")"]&&"("===e[0]&&(e+=")",g()),h["("]>(h[")"]||0)&&"(("===e.slice(0,2)&&(e=e.slice(1)),l){if(/^9\d/.test(e))e="("+e.slice(1);else if("("!==e[0])e="("+e;else{let t=[],r=0;for(let i of e.split("").reverse())")"===i&&(r?t.push("("):r+=1),"("===i&&(r-=1),t.push(i);t.reverse(),e=t.join("")}g()}if(h[")"]>(h["("]||0)&&")"===e[0]&&(e="("+e.slice(1),g()),f&&(e.endsWith(9)||/\d+0$/.test(e))&&(e=e.slice(0,e.length-1)+")",g()),f&&(!e.endsWith(")")||e.startsWith("(("))&&(e+=")",g()),f){let t="",r=0;for(let i of e.split(""))"("===i&&(r?t+=")":r+=1),")"===i&&(r-=1),t+=i;e=t}if(g(),m&&!p&&(e+="]"),e.includes("([")&&e.includes("])")&&(e=e.split("([").join("[").split("])").join("]"),g()),/\(\d+0$/.test(e)&&(e=e.slice(0,e.length-1)+")"),g(),1===h[")"]&&!h["("]&&e.endsWith(")")&&(e=e.slice(0,e.length-1)),e.startsWith("(")&&e.endsWith(")")&&1===h["("]&&1===h[")"]&&(e=e.slice(1,e.length-1),g()),/^\([\d ]+.*[\d ]+\)$/.test(e)&&h["("]===h[")"]){let t=e.slice(1,e.length-1);(e=>{let t=e.indexOf("("),r=e.indexOf(")");return t>=0&&r>=0&&t<r})(t)&&(e=t,g())}return{score:e,applied:t}},handleGameSeparation:function({score:e}){let t=new RegExp(/^\d+\/\d+/),r=e.split(" ");r.some((e=>t.test(e)))&&(e=r.map((e=>t.test(e)?e.replace("/","-"):e)).join(" "));let i=/^(\d+), *(\d+)$/;if(i.test(e)){let[t,r]=e.match(i).slice(1);e=[t,r].join("-")}return{score:e}},joinFloatingTiebreak:function({score:e}){if("string"!=typeof e)return{score:e};let t=e=>e?.split("-").join("").split("/").join(""),r=e=>e.split("[").join("(").split("]").join(")"),i=(e=e.split(", ").join(" ")).split(" ");e=i.map((e=>{let t=/^-(\d+)$/;if(t.test(e)){let[r]=e.match(t).slice(1);if(2===r.length)return r.split("").join("-")}return e})).join(" "),i=e.split(" ");let n=i.filter(GS),a=0,o="";for(let p of n){let e=oi(p,i).filter((e=>!a||e>a))[0],r=i.slice(a,e-1),n=i[e-1],s=t(n);if(/^\d+$/.test(s)&&2===s.length){let t=s.split(""),i=Math.abs(t.reduce(((e,t)=>+e-+t)));if(1===i){o+=[r.join(" "),[n,p].join("")].join(" "),a=e+1}else if(0===i){let i=Math.max(...t);if([4,5,6,7,8,9].includes(i)){let t=[i,[6,4].includes(i)?i+1:i-1].sort().reverse().join("-");o+=[r.join(" "),[t,p].join("")].join(" "),a=e+1}}}}if(n.length&&o.length){return o=[o,i.slice(a).join(" ")].join(" "),{score:o.trim()}}if(2===i.length&&["(","["].some((e=>i[1].includes(e)))){let e=t(i[0]).split("");if(1===Math.abs(e.reduce(((e,t)=>+e-+t),0)))return i[1]=r(i[1]),{score:i.join("")}}let s=i.map((e=>function(e){return/^\(\d+-\d+\)$/.test(e)||/^\[\d+-\d+\]$/.test(e)}(e)?"bracket":qS(e)&&"set"));if(s.includes("set")&&s.includes("bracket")){let e,t="";return i.forEach(((i,n)=>{"bracket"===s[n]&&"set"===e?(i=r(i),t+=i):t+=` ${i}`,e=s[n]})),{score:t.trim()}}i=e.split(" ");let c,u=i.map((e=>{let t=new RegExp(/^(\d+)-(\d+)$/);if(t.test(e)){let[r,i]=e.match(t).slice(1),n=Math.abs([r,i].reduce(((e,t)=>+e-+t))),a=Math.max(r,i);if(1===n)return c="tiebreakSet",c;if(n>=2&&a>=7&&"tiebreakSet"===c)return c="tiebreak",c}})),d=oi("tiebreak",u);if(d.length){let t="";i.forEach(((e,r)=>{d.includes(r)?t+=`(${e}) `:d.includes(r+1)?t+=`${e}`:t+=`${e} `})),e=t.trim()}let l=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(l.test(e)){let[t,r,i]=e.match(l).slice(1),n=Math.max(r,i)>=10;!qS(t)&&n&&(e=e.replace(l,`${t} [${r}-${i}]`))}return u=[],{score:e=e.split(" ").map((e=>{let t=/^\((.*)\)$/,r=t.test(e),i=(new RegExp(xS).test(e)?"super":new RegExp(kS).test(e)&&"tiebreak")||new RegExp(FS).test(e)&&"standard"||"unknown";return u.push(i),"standard"===i&&r?e.match(t)[1]:e})).join(" ")}},handleBracketSpacing:function({score:e,applied:t}){return e.includes("( ")&&(t.push("removeParenSpacingAfterOpen"),e=e.split("( ").map((e=>e.trim())).join("(")),e.includes(" )")&&(t.push("removeParenSpacingBeforeClose"),e=e.split(" )").map((e=>e.trim())).join(")")),[_S,LS].forEach((r=>{let i=e.match(r);i?.length&&(i.forEach((t=>{e=e.replace(t,t.slice(0,t.length-1)+" ")})),t.push("setsEndComma"))})),{score:e=e.split(" ").filter(Boolean).map(zS).join(" "),applied:t}},handleSpaceSeparator:function({score:e}){if(e.includes(",")){let t=e.split(",").map((e=>e.trim())),r=e=>/\d \d/.test(e);t.every(r)&&(e=t.map((e=>{let t=/\d+ \d+/g;for(let r of e.match(t)){let[t,i]=r.match(/(\d+) (\d+)/).slice(1);e=e.replace(r,`${t}-${i}`)}return e})).join(" "))}if(e.includes(" ")){let t=e.replace(/[ ,]/g,"");t.split("").every((e=>jr(e)))&&4===t.length&&(e=t)}return{score:e}},separateScoreBlocks:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:{score:e=e.toLowerCase().split(" ").map((e=>{if(/^\d+$/.test(e)&&e.length>2){let r=e.indexOf("1");if(e.length%2){if(3===e.length&&0===r){let i=$S(e.split(""),r);return t.push("getSuper"),i}}else{let{score:r,applied:i}=QS({score:e,applied:[]});r!==e&&(e=r,t.push(...i))}}return e})).join(" "),applied:t}},matchKnownPatterns:function({score:e,applied:t}){for(let P of[".",","," ","/"]){let r=new RegExp(`^(\\d+)\\${P}(\\d+)$`);if(r.test(e)){let i=e.match(r).slice(1).map((e=>parseInt(e))),n=Math.abs(i[0]-i[1]);n<=10&&n>=2&&(e=e.split(P).join("-"),t.push("variedJoinerPattern"))}}e.includes(";")&&(e=e.split(";").join(" "),t.push("semicolon set separation"));let r=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(r.test(e)){let[i,n,a,o,s,c]=e.match(r).slice(1);e=e.replace(r,`${i}${n}-${a} ${o}-${s}${c}`),t.push("smashSlashPattern")}/.*\s6[/-]+$/.test(e)&&(e+="0",t.push("incompleteFinalSetPattern"));let i=/\(6,\)/g;i.test(e)&&(e=e.replace(i,"(6, 0)"),t.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach((()=>{e=e.split(" ").map((e=>(n.test(e)&&(e=e.replace("("," (")),a.test(e)&&(e=e.replace(")",") ")),e))).join(" "),t.push("spaceConsiderationPatterns")}));let o=zS(e);o!==e&&(e=o,t.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(e)){let[r,i,n]=e.match(s).slice(1),[a,o]=i.split("");e=`${r}-${a} ${o}-${n}`,t.push("smashSetPattern")}let c=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(e)){let[r,i]=e.match(u).slice(1),n=r.trim(),a=i.trim();if(c.test(n)&&c.test(a)){let r=n.match(c).slice(1,3).join("-"),i=a.match(c).slice(1,3).join("-");e=`${r} ${i}`,t.push("slashSeparationPattern")}}let d=/^([\d -]+),([\d -]+)$/;if(d.test(e)){let[r,i]=e.match(d).slice(1),n=r.trim(),a=i.trim();if(c.test(n)&&c.test(a)){let r=n.match(c).slice(1,3).join("-"),i=a.match(c).slice(1,3).join("-");e=`${r} ${i}`,t.push("commaSeparationPattern")}}let l=/^\d \d,/;if(l.test(e)){let r=e.match(l)[0],i=r.slice(0,r.length-1).split(" ").join("-");e=e.replace(r,i),t.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(e)&&p<3;){let[r,i,n]=e.match(m).slice(1),a=i.split(""),o=`${r}-${a[0]} ${a[1]}-${n}`;e=e.replace(m,o),t.push("noSetSeparationPattern"),p+=1}let f=e.match(/(^|\s)7-6\s(\d+)\s/g);if(f?.length){let r=/(^|\s)7-6\s(\d+)\s/;f.forEach((i=>{let n=i.match(r).slice(2)[0];e=e.replace(i,`7-6(${n}) `),t.push("floatingTiebreakPattern1")}))}let h=e.match(/\d \d /);h?.forEach((r=>{let i=r.slice(0,r.length-1).split(" ").join("-");e=e.replace(r,i),t.push("spaceSeparatedSetPattern1")})),h=e.match(/ \d \d$/),h?.forEach((r=>{let i=" "+r.slice(1).split(" ").join("-");e=e.replace(r,i),t.push("spaceSeparatedSetPattern2")}));let g=/^\d, *\d\/\d, *\d/;if(g.test(e)){let r=e.match(g)[0],i=r.split("/").map((e=>`(${e})`)).join(" ")+" ";e=e.replace(r,i),t.push("slashCommaSetPattern")}let I=/\(6-\)/g;I.test(e)&&(e=e.replace(I,"(6-0)"),t.push("missingZeroPattern2"));let U=/(?<!-)(\d+)\/(\d+)(?!-)/g;if(U.test(e)){let r=e.match(U),i=/(?<!-)(\d+)\/(\d+)(?!-)/,n=e;r.forEach((e=>{let[t,r]=e.match(i).slice(1),a=`${t}-${r}`;n=n.replace(e,a)})),e=n,t.push("slashSetPattern")}let v=/(.*)\s(1\d)\s(\d+)$/;if(v.test(e)){let[r,i,n]=e.match(v).slice(1);r.replace(/\D/g,"").length>=4&&(e=r+` ${i}${n}`,t.push("spaceSeparatedSuperPattern"))}let y=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let P of e.match(y)||[]){let[r,i,n,a]=P.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[o,s]=i.split("-").map((e=>parseInt(e)));1===Math.abs(o-s)&&(e=e.replace(P,`${r}${i}(${n})${a}`),t.push("spaceSeparatedSetPattern"))}let S=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let P of e.match(S)||[]){let r=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[i,n,a]=P.match(r).slice(1),[o,s]=i.split("-").map((e=>parseInt(e)));1===Math.abs(o-s)&&(e=e.replace(P,`${i}(${n})${a}`),t.push("floatingTiebreakPattern2"))}let w=/(^|\s)(\d \d)\(/g;for(let P of e.match(w)||[]){let r=/(^|\s)(\d \d)\(/,[i,n]=P.match(r).slice(1);e=e.replace(P,`${i}${n.split(" ").join("-")}(`),t.push("spacedTiebreakPattern")}return{score:e,applied:t}},removeDanglingBits:function({score:e,attributes:t}){(e.endsWith(" am")||e.endsWith(" pm"))&&(e=""),e=e.replace(/[A-Za-z]+/g,"").trim(),[".",","].some((t=>e.endsWith(t)))&&(e=e.slice(0,e.length-1));let r="()/-".split("").some((t=>e.includes(t)));/ \d$/.test(e)&&r&&(t={removed:e.slice(e.length-2).trim()},e=e.slice(0,e.length-2));let i=/(.*)[A-Za-z]+$/;return i.test(e)&&(e=e.match(i).slice(1)[0].trim()),{score:e,attributes:t}},removeErroneous:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:[3,4].includes(e.length)&&KS(e)?{score:KS(e)}:{score:e=e.toLowerCase().split(" ").map((e=>{if(!/^\d+$/.test(e)||1!==e.length)return e;t.push("removeErroneous1")})).filter(Boolean).join(" "),applied:t}},handleWalkover:function({score:e,applied:t}){return["walkover","wo","w/o","w-o"].includes(e?.toString().toLowerCase())?(t.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:t}):{score:e}},properTiebreak:function({score:e,matchUpStatus:t}){let r=e?.split(" ");e=r.map((e=>{if(e.endsWith("]")){let t=e.split("[");if(qS(t[0]))return t[0]+`(${t[1].slice(0,t[1].length-1)})`}return e})).join(" ");let i=new RegExp(/(\([\d ]+\))/g);if(i.test(e))for(let s of e.match(i)){let t=s.replace(" ","-").match(/\((.*)\)/)?.[1];if(jr(t)&&t?.[0]>2)if([2,4].includes(t.length))t=t.split("").join("-");else if(3===t.length){let e=t.indexOf("1");t=$S(t.split(""),e)}e=e.replace(s,`(${t})`)}r=e?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=r.length-1;e=r.map(((e,r)=>{let i=[void 0,"","COMPLETED"].includes(t)||r!==a;if(n.test(e)&&i){let[t,r,i]=Array.from(e.match(n)).slice(1);return`${t}(${Math.min(r,i)})`}return e})).join(" "),r=e?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),e=r.map((e=>{if(n.test(e)){let[t,r]=Array.from(e.match(n)).slice(1),i=t.split("");return`${i[0]}-${i[1]}(${r})`}return e})).join(" "),r=e?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),e=r.map((e=>{if(n.test(e)){let[t,r]=Array.from(e.match(n)).slice(1);return qS(t)?`${t}(${r})`:t}return e})).join(" "),r=e?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),e=r.map((e=>{if(n.test(e)){let[t]=e.match(n).slice(1);return`[${t<9?10:parseInt(t)+2}-${t}]`}return e})).join(" ");let o=/\((\d)+0 /;if(o.test(e)){let t=e.match(o)[1];e=e.replace(o,`(${t}) `)}return{score:e}},handleNumeric:QS,handleRetired:function({score:e,profile:t,applied:r}){e=e?.toString().toLowerCase();let i=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(i.test(e)){let[t]=e.match(i).slice(1);return r.push("handleRetired"),{score:t.trim(),matchUpStatus:"retired",applied:r}}let n=t?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find((t=>e?.endsWith(t)));return a?(r.push("handleRetired"),{matchUpStatus:"retired",score:e?.replace(a,"").trim(),applied:r}):{score:e}},containedSets:function({score:e,attributes:t,identifier:r}){if("string"!=typeof e)return{score:e,identifier:r};let i=new RegExp(/\([\d,/ ]+\)/g),n=e.match(i);for(let c of n||[]){let t=c.match(/^\((.*)\)$/)?.slice(1)?.[0],r=e.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(2===t?.length&&r?.length>=2){let e=r.slice(r.length-2).split("").map((e=>parseInt(e)));if(1===Math.abs(e[0]-e[1]))continue}let i=zS(WS(t));e=e.replace(c,`(${i})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);if(e.match(a)?.forEach((t=>{let r=WS(t.match(/^\[(.*)\]$/)[1]);e=e.replace(t,`(${r}) `).trim()})),e.startsWith("(")&&[")","]"].some((t=>e.endsWith(t)))&&[")(","), (",") (",")[",") [","](","] ("].some((t=>e.includes(t)))){let t="",r=e.split(/[)\]]/).filter(Boolean).map((e=>(e.startsWith(",")&&(e=e.slice(1)),e.trim()))),i=r.every((e=>e.includes(",")||GS(e))),n=r.every((e=>e.includes("/")||GS(e))),a=r.every((e=>e.includes("-")||GS(e))),o=(i?",":a&&"-")||n&&"/";if(o){let i;r.forEach((e=>{if(e.startsWith("("))if("set"===i&&(t+=" "),e.includes(o))t+=e.slice(1).split(o).map((e=>e.trim())).join("-"),i="set";else{let r=e.slice(1);t+=`(${r}) `,i="tiebreak"}else if(e.startsWith("[")){let r=e.slice(1).split(o).map((e=>parseInt(e.trim()))),n=Math.min(...r);t+="set"===i?`(${n}) `:`[${r.join("-")}] `,i="tiebreak"}})),e=t.trim()}}let o=Xr(e.split(""));1===o["("]&&1===o[")"]&&e.startsWith("(")&&e.endsWith(")")&&(e=e.slice(1,e.length-1),1===o["-"]&&qS(e)&&jr(t?.removed)&&(e+=`(${t.removed})`,t.removed=void 0));let s=/\(\)/g;return s.test(e)&&(e=e.replace(s,"").trim()),{score:e}},sensibleSets:function({score:e,matchUpStatus:t,attributes:r}){let i,n=[],a=e.split(" "),o=a.length;e=a.map(((e,r)=>{if(new RegExp(kS).test(e)){let r=e.slice(3),i=e.slice(0,3),n=i.split("-");if(!qS(i)&&!t){let e=Math.max(...n),t=[e,e-1];return i.indexOf(e)&&t.reverse(),t.join("-")+r}}else if(2===e.length&&jr(e))return e.split("").join("-");e=zS(e);let a=(new RegExp(`^${xS}$`).test(e)?"super":new RegExp(`^${kS}$`).test(e)&&"tiebreak")||new RegExp(`^${FS}$`).test(e)&&"standard"||"unknown";if(n.push(a),o>1&&"standard"===a&&r<2){let[t,n]=e.split("-"),a=Math.abs(parseInt(t)-parseInt(n)),o=Math.max(t,n),s=Math.min(t,n),c=[parseInt(t),parseInt(n)].indexOf(s);if(o>9&&a>2){let t=o.toString().split(""),n=t.find((e=>parseInt(e)>s||r&&parseInt(e)<=i))??t[0];n&&(e=c?[n,s].join("-"):[s,n].join("-"))}o>(i||0)&&(i=o)}if("standard"===a){let[r,i]=e.split("-");if(!Math.abs(parseInt(r)-parseInt(i))&&"RETIRED"!==t)return""}return e})).filter(Boolean).join(" ");let{setsWon:s,setWinners:c,totalSets:u}=JS(e);if(1===u&&"6"===r?.removed&&(e+=" 6-0"),e.split(" ").length>2&&Math.max(...s)>=2&&c[0]===c[1]&&(e=e.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let t=[0,0];e=e.split(" ").map(((e,r)=>(t[c[r]]+=1,Math.max(...t)>2?void 0:e))).filter(Boolean).join(" ")}return{score:e,profile:n}},stringScore:function({score:e}){return{score:e=e?.toString().toLowerCase()||""}},superSquare:function({score:e}){let{setsTied:t,winningSide:r}=JS(e),i=/\s\((\d+)\)$/;if(!r&&t&&i.test(e)){let t=e.match(i).slice(1)[0],r=t<=8?10:t+2;e=e.replace(i,` [${r}-${t}]`)}let n=e.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:e};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every((e=>jr(e))))return{score:e};if("76"===o[0]){let t=2===o[1].length?Math.min(...o[1].split("").map((e=>parseInt(e)))):o[1];e=[...n.slice(0,n.length-1),`7-6(${t})`].join(" ")}else{o=o.map((e=>parseInt(e)));let t=Math.max(...o),r=Math.abs(o[0]-o[1]);if(t>=10){if(r>2&&o.every((e=>+e>=10))){let e=o.map((e=>e===t?e-10:10)).sort();r=Math.abs(e[0]-e[1]),r>2&&(o=e)}e=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" ")}else 3===n.length&&t>=7&&r>2&&(e=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" "))}return{score:e}},setBuilder:YS,excisions:function({score:e}){let t=new RegExp(/^\[\d+\](.*)$/);t.test(e)&&(e=e.match(t).slice(1)[0].trim());let r=/\(,/g;return r.test(e)&&(e=e.replace(r,"(")),{score:e}},replaceOh:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:(e.toLowerCase().includes("o")&&(e=e.toLowerCase().split(" ").map((e=>e.split("o").join("0"))).join(" "),t.push("replaceOh")),{score:e,applied:t})}},ZS={},ew=[],tw=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],rw=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function iw(e){if(!e.score)return{error:mr};let t,r,i,{score:n,sheetName:a,identifier:o,fileName:s,stepLog:c,fullLog:u,profile:d}=e,l=[],p=[],m=n,f=e=>{e.forEach((e=>{i=XS[e]({profile:d,identifier:o,matchUpStatus:t,attributes:r,applied:p,score:m});let n=i.score!==m;n&&l.push({method:e,score:i.score}),c&&(u||n||i.matchUpStatus!==t)&&console.log(t?{score:i.score,matchUpStatus:t}:{score:i.score},e),i.matchUpStatus&&(t=i.matchUpStatus),i.attributes&&(r=i.attributes),i.applied&&(p=i.applied),m=i.score}))};f(tw);let h=jS(m);return h||(m=n.toString().replace(/\D/g,""),r?.removed&&(r.removed=void 0),f(rw),h=jS(m),h||(ew.push({score:m,fileName:s,sheetName:a}),m="")),p.forEach((e=>{ZS[e]||(ZS[e]=0),ZS[e]+=1})),{matchUpStatus:t?.toUpperCase(),modifications:l,attributes:r,isValid:h,score:m}}var nw={};function aw({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:r,winningSide:i,score:n}){let a=n?.sets??[],o=(a?.filter((e=>e?.winningSide))||[]).reduce(((e,t)=>{let{winningSide:r}=t;return r?(e[r-1]++,e):e}),[0,0]),s=i?i-1:void 0,c=void 0!==s?1-s:void 0,u=void 0!==s&&o[s],d=void 0!==c&&o[c],l=t?Op(t):void 0,p=Math.max(...o),m=Xr(o)[p],f=l?.setFormat?.timed||l?.finalSetFormat?.timed,h=l?.bestOf,g=h&&Math.ceil(h/2)||1,I=r??e,U=I&&[Xo,ns,ss].includes(I),v=!l||!a.length||a.every(((e,t)=>{let r=t+1,i=r===h,n=r===a.length,{side1Score:o,side2Score:s,side1TiebreakScore:c,side2TiebreakScore:u,winningSide:d}=e,p=Math.max(o??0,s??0),m=c??u,{finalSetFormat:f,setFormat:g}=l,I=i&&f||g;if(m){let{tiebreakTo:e,NoAD:t}=I?.tiebreakFormat||{},r=Math.max(c??0,u??0);if(t&&r>e||r<e&&d&&(n&&!U||!n))return!1}return!I.setTo||!(!I.noTiebreak&&p>I.setTo+1)})),y=(!t||p===g)&&1===m&&o.indexOf(p)+1||void 0;return{valid:!(!v||!(i&&u>d&&i===y||i&&U||!i&&!y&&(![Qo,Xo,ns,ss].includes(I)||f&&I===Qo)))}}function ow({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:r,winningSide:i,score:n}){if("object"!=typeof n)return{error:mr};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=n,c="scoreString must be a string!";if(void 0!==o&&"string"!=typeof o)return{error:mr,info:c};if(void 0!==s&&"string"!=typeof s)return{error:mr,info:c};if(void 0!==a&&!Array.isArray(a))return{error:mr,info:ch("sets")};if(a?.length){let o=a.map((e=>e?.setNumber)).filter(Boolean);if(o.length!==Yr(o).length)return{error:mr,info:"setNumbers not unique"};for(let e of a){let{side1Score:t,side2Score:r,side1TiebreakScore:i,side2TiebreakScore:n,side1PointScore:a,side2PointScore:o,winningSide:s,setNumber:c}=e;if(![[t,r],[i,n],[a,o]].filter((e=>e.some((e=>void 0!==e)))).every((e=>e.every((e=>Wr(e))))))return{error:mr,info:"non-numeric values"};if(![c,s].filter((e=>void 0!==e)).every((e=>Wr(e))))return{error:mr,info:"non-numeric values"};if(s&&![1,2].includes(s))return{error:mr,info:"winningSide must be 1 or 2"}}let{valid:s}=aw({existingMatchUpStatus:e,matchUpStatus:r,matchUpFormat:t,winningSide:i,score:n});if(!s)return{error:rt,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}n(nw,{analyzeScore:()=>aw,analyzeSet:()=>dw,checkScoreHasValue:()=>Um,checkSetIsComplete:()=>MS,getSetComplement:()=>sw,getTiebreakComplement:()=>cw,isValidMatchUpFormat:()=>qI,parseScoreString:()=>uw,validateScore:()=>ow,validateTieFormat:()=>QI});var sw=e=>{let{isSide1:t,lowValue:r,setTo:i,tiebreakAt:n,NoAD:a}=e;if(void 0===r)return!1;let o,s=xr(r);return s?.toString().length>2&&(s=parseInt(s.toString().slice(0,2))),n&&n<i&&s>n&&(s=n),a&&!n?(s>i&&(o=i),o=s<i?i:i-1):o=s+1<i&&i||n&&n<i&&s===n&&i||!n&&s+2||i+1,[t?s:o,t?o:s]},cw=e=>{let{isSide1:t,lowValue:r,tiebreakTo:i,tiebreakNoAd:n}=e;if(void 0===r)return!1;let a="string"==typeof r?parseInt(r):r;a?.toString().length>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>i-1&&(a=i-1);let o=function(e){let{lowValue:t,NoAD:r,tiebreakTo:i}=e,n=r?1:2;return t+1>=i?t+n:i}({lowValue:a,NoAD:n,tiebreakTo:i});return[t?a:o,t?o:a]};function uw({tiebreakTo:e=7,scoreString:t=""}){return t?.split(" ").filter(Boolean).map(((t,r)=>function({set:t,setNumber:r}){let i=t?.startsWith("[")&&t.split("[")[1].split("]")[0].split("-").map((e=>parseInt(e))),n=t.includes("(")&&t.split("(")[0]||t.includes("[")&&t.split("[")[0]||t,a=!i&&n.split("-").map((e=>parseInt(e))),o=i?(i[0]>i[1]?1:i[0]<i[1]&&2)||void 0:(a[0]>a[1]?1:a[0]<a[1]&&2)||void 0,s=t.includes("(")?t.split("(")[1].split(")")[0]:void 0,c=(s&&cw({lowValue:s,isSide1:2===o,tiebreakTo:e}))??[],[u,d]=a||[],[l,p]=i||c||[];return{side1Score:u,side2Score:d,side1TiebreakScore:l,side2TiebreakScore:p,winningSide:o,setNumber:r}}({set:t,setNumber:r+1})))}function dw(e){let{setObject:t,matchUpScoringFormat:r}=e;if(!t)return{error:$e};let{setNumber:i}=t||{},{bestOf:n}=r||{},a=!(!i||!n||i!==n),o=a&&r?.finalSetFormat||r?.setFormat,s=!!o?.tiebreakSet,c=!!o?.timed,u=!s&&!c,d=!!(i&&n&&i<=n),l=[t?.side1Score,t?.side2Score],p=[t?.side1PointScore,t?.side2PointScore],m=[t?.side1TiebreakScore,t?.side2TiebreakScore],f=l.filter((e=>void 0!==e)).length,h=p.filter((e=>void 0!==e)).length,g=m.filter((e=>void 0!==e)).length,I=l?.filter((e=>!isNaN(e))).length,U=m?.filter((e=>!isNaN(e))).length,{tiebreakAt:v}=o||{},y=v&&2===l.filter((e=>e>=v)).length,S=y&&((l[0]>l[1]?1:l[1]>l[0]&&2)||void 0),w=!(!U||I),P=!!t?.winningSide,{error:D,result:T}=function({setObject:e,setFormat:t,sideGameScores:r,sideTiebreakScores:i}){if(!e)return{result:!1,error:$e};let n=!!t?.tiebreakSet,a=!!t?.timed;if(!t||n||a)return{result:!1,error:mr};if(2!==r?.filter((e=>!isNaN(e))).length)return{result:!1,error:tt};let{setTo:o,tiebreakAt:s,tiebreakFormat:c,NoAD:u}=t||{};if(!o||!r?.find((e=>e>=o)))return{result:!1,error:tt};let d=[1,2].includes(e?.winningSide);if(!e||!d)return{result:!1,error:it};let l=e?.winningSide-1,p=1-l,m=r[l],f=r[p],h=m-f;if(!(m>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&c,I=2===i?.filter((e=>!isNaN(e))).length,U=i?.[l],v=i?.[p],y=s&&2===r.filter((e=>e>=s)).length;if(g){let{NoAD:e,tiebreakTo:t}=c;if(y){if(h>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!I)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(t))return{result:!1,error:{message:"tiebreakTo error"}};if(!t||!i?.find((e=>e>=t)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};if(m>(s<o?o:o+1))return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!U||!v||U<v)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let r=U-v;if(r&&v>=t-1&&r<(e?1:2))return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!y)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=u?1:2,w=f>=o-1;return h&&w&&!y&&h<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:h>S&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}({setObject:t,setFormat:o,sideGameScores:l,sideTiebreakScores:m}),{error:b,result:R}=function({setObject:e,setFormat:t,sideTiebreakScores:r}){if(!e)return{result:!1,error:$e};let i=!!t?.tiebreakSet,n=!!t?.timed;if(!t||!i||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(e?.winningSide);if(!e||!a)return{result:!1,error:it};let{tiebreakSet:o}=t||{},{NoAD:s,tiebreakTo:c}=o||{};if(2!==r?.filter((e=>!isNaN(e))).length)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(c))return{result:!1,error:{message:"tiebreakTo error"}};if(!r?.find((e=>e>=c)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=e?.winningSide-1,d=1-u,l=r[u],p=r[d];if(!l||!p||l<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,f=l-p,h=p>=c-1;return f&&h&&f<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}({setObject:t,setFormat:o,sideTiebreakScores:m}),M=u&&!w&&T||s&&w&&R,N=d&&!(s&&!w)&&!(u&&w)&&(!P||M),A=function({matchUpScoringFormat:e,isDecidingSet:t,isTiebreakSet:r,setObject:i}){if(!i)return;let n=NS({set:i});return MS({matchUpScoringFormat:e,set:i,isDecidingSet:t,isTiebreakSet:r})&&n||void 0}({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:r,setObject:t}),E={expectTiebreakSet:s,expectTimedSet:c,hasTiebreakCondition:y,isCompletedSet:P,isDecidingSet:a,isTiebreakSet:w,isValidSet:N,isValidSetNumber:d,isValidSetOutcome:M,leadingSide:S,setFormat:o,sideGameScores:l,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:h,sideTiebreakScores:m,sideTiebreakScoresCount:g,winningSide:A};return void 0!==t?.winningSide&&(w?(E.isValidTiebreakSetOutcome=R,R||(E.tiebreakSetError=b)):(E.isValidStandardSetOutcome=T,T||(E.standardSetError=D))),E}var lw={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},pw={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},mw={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},fw={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},hw={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},gw={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},Iw={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},Uw={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},vw={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},yw={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Sw={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},ww={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Pw={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},Dw={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Tw={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},bw={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Rw={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},Mw="COLLEGE_DEFAULT",Nw="COLLEGE_JUCO",Aw="COLLEGE_D3",Ew="DOMINANT_DUO",Cw="DOMINANT_DUO_MIXED",Ow="LAVER_CUP",Fw="TEAM_DOUBLES_3_AGGREGATION",kw="TIME_TENNIS_DUAL",xw="TIME_TENNIS_PRO_CIRCUIT",_w="USTA_BREWER_CUP",Lw="USTA_OZAKI_CUP",Vw="USTA_COLLEGE",Bw="USTA_GOLD_TEAM_CHALLENGE",jw="USTA_LEVEL_1",Gw="USTA_INTERSECTIONAL",qw="USTA_SECTION_BATTLE",$w="USTA_SOUTHERN_LEVEL_5",Ww="USTA_TOC",Hw="USTA_WTT_ITT",zw="USTA_ZONAL",Yw={COLLEGE_D3:Aw,COLLEGE_DEFAULT:Mw,COLLEGE_JUCO:Nw,DOMINANT_DUO:Ew,DOMINANT_DUO_MIXED:Cw,LAVER_CUP:Ow,TEAM_DOUBLES_3_AGGREGATION:Fw,TIME_TENNIS_DUAL:kw,TIME_TENNIS_PRO_CIRCUIT:xw,USTA_BREWER_CUP:_w,USTA_OZAKI_CUP:Lw,USTA_COLLEGE:Vw,USTA_GOLD_TEAM_CHALLENGE:Bw,USTA_INTERSECTIONAL:Gw,USTA_LEVEL_1:jw,USTA_SECTION_BATTLE:qw,USTA_SOUTHERN_LEVEL_5:$w,USTA_TOC:Ww,USTA_WTT_ITT:Hw,USTA_ZONAL:zw},Kw="STANDARD",Qw={[Kw]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[Aw]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:eI,matchUpCount:6,matchUpValue:1},tieFormatName:Aw,valueGoal:5},[Mw]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:eI,matchUpCount:6,matchUpValue:1},tieFormatName:Mw,valueGoal:4},[Nw]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:eI,matchUpCount:6,matchUpValue:1},tieFormatName:Nw,valueGoal:5},[Ow]:bw,[Ew]:Sw,[Cw]:Iw,[Fw]:pw,[kw]:Uw,[xw]:gw,[_w]:vw,[Lw]:yw,[Vw]:ww,[Bw]:lw,[Gw]:hw,[jw]:Pw,[qw]:fw,[$w]:mw,[Hw]:Dw,[Ww]:Rw,[zw]:Tw},Jw=e=>{let t,r=e?.namedFormat&&Object.keys(Qw).includes(e.namedFormat)?e.namedFormat:Kw,i=Array.isArray(e?.uuids)?e?.uuids:[],{category:n,gender:a}=e?.event??{},o=Da(Qw[r],!1,!0),s=t=>{if(!e?.isMock&&!e?.event?.isMock||!e.event)return i?.pop()??Jl();let r=e?.event?.eventId;return i.pop()??`${r}-COL-${t+1}`};return o.hydrate?(t={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:tI,collectionName:"Doubles",matchUpType:hu,...o.doubles},{collectionId:s(1),matchUpFormat:eI,collectionName:"Singles",matchUpType:mu,...o.singles}]},o.tieFormatName&&(t.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach(((e,t)=>e.collectionId=s(t))),t=o),e?.hydrateCollections&&t.collectionDefinitions.forEach((e=>{n&&!e.category&&(e.category=n),a&&!e.gender&&(e.gender=a)})),t};function Xw(e){let t=e.drawDefinition,{existingQualifyingPlaceholderStructureId:r,appliedPolicies:i,drawEntries:n,structureId:a,idPrefix:o,isMock:s,event:c}=e,u=e.qualifyingProfiles,d=u?.length?jv({uuids:e.uuids,qualifyingProfiles:u,appliedPolicies:i,idPrefix:o,isMock:s}):void 0;if(d?.error)return d;t.structures=t.structures?.filter((({structureId:e})=>e!==r)),t.links=t.links?.filter((({source:e})=>e.structureId!==r));let{qualifiersCount:l,qualifyingDrawPositionsCount:p,qualifyingDetails:m}=d??{};p&&(d?.structures&&t.structures?.push(...d.structures),d?.links&&t.links?.push(...d.links));let f=t.structures?.find((({stage:e,stageSequence:t})=>e===Is&&1===t)),{qualifiersCount:h}=rf({stageSequence:1,drawDefinition:t,structureId:a,stage:Is}),g=Ig({qualifiersCount:Math.max(l??0,h??0),drawDefinition:t,stage:Is});if(g.error||(g=gg({drawSize:p,stage:Us,drawDefinition:t}),g.error))return g;!function({drawDefinition:e,drawEntries:t,event:r}){for(let i of(t??[]).filter((({entryStage:e})=>e===Us))){sf({...i,entryStage:i.entryStage??Is,drawDefinition:e,event:r})}}({drawDefinition:t,drawEntries:n,event:c});let I=function({mainStructure:e,qualifyingDetails:t,drawDefinition:r}){for(let i of t||[]){let{finalQualifyingRoundNumber:t,finalQualifyingStructureId:n,roundTarget:a,finishingPositions:o,linkType:s}=i,c=e&&yg({targetStructureId:e.structureId,sourceStructureId:n,sourceRoundNumber:t,finishingPositions:o,targetEntryRound:a,linkType:s})?.link;if(c?.error)return c;c&&(r.links||(r.links=[]),r.links.push(c))}return{error:void 0}}({mainStructure:f,qualifyingDetails:m,drawDefinition:t});return I.error?I:{drawDefinition:t,structureId:a}}function Zw(e){let{participantIds:t}=e,r=e.drawDefinition?.entries?.filter((t=>{let r=t.entryStatus;return!e.restrictEntryStatus||Dd.includes(r)})).map(Go)??[];if(t){let e=t.filter((e=>!r?.includes(e)));if(e?.length)return en({result:{error:dt},info:{invalidParticipantIds:e}})}else t=r;return e.roundsCount&&!1!==e.restrictRoundsCount&&e.roundsCount>t.length-1&&(!e.enableDoubleRobin||e.roundsCount>2*(t.length-1))?{error:mr,info:"Not enough participants for roundsCount"}:e.roundsCount&&!1!==e.restrictRoundsCount&&e.roundsCount>31?{error:mr,info:"roundsCount must be less than 32"}:{participantIds:t}}function eP(e){let t,r=[],{roundsCount:i=1,drawDefinition:n,matchUpsCount:a,structureId:o,idPrefix:s,isMock:c,event:u}=e,d=Zw(e);if(d.error)return d;for(let l of ai(1,i+1)){let i=ny({restrictMatchUpsCount:e.restrictMatchUpsCount,ignoreLastRoundNumber:!!t,newRound:!t,drawDefinition:n,matchUpsCount:a,structureId:o,roundNumber:t,idPrefix:s,isMock:c,event:u});if(i.error)return en({result:i,info:{iteration:l}});i.matchUps?.length&&r.push(...i.matchUps),t=(i?.roundNumber??1)+1}return{matchUps:r}}function tP({scaleType:e=Bn,scaleAccessor:t,participant:r,scaleName:i,eventType:n}){let a=(r&&jm({scaleAttributes:{eventType:n??Cl,scaleType:e,scaleName:i},participant:r}))?.scaleItem?.scaleValue;return t&&d(a)?a[t]:a}function rP(e){let t=function(e){return e.roundsCount&&"number"!=typeof e.roundsCount?{error:mr,info:"roundsCount must be a number"}:"object"!=typeof e.drawDefinition||e.drawDefinition.drawType&&e.drawDefinition.drawType!==Bs?{error:R}:Array.isArray(e.drawDefinition?.entries)||!e.participantIds||Array.isArray(e.participantIds)?{error:void 0}:{error:mr,info:"Missing Entries"}}(e);if(t?.error)return t;let r=Zw(e);if(r.error)return r;let i=function(e){if(e.structureId)return e.structureId;let t=e.drawDefinition,r=t?.structures?.filter((e=>1===e.stageSequence))?.reduce(((e,t)=>{let r=t.stage&&Ps[t.stage];return Tp({structure:t})&&r>(Ps[e?.stage]||1)?t:e}),void 0),i=t?.structures?.find((e=>e.structureId===r?.structureId));return i?Tp({structure:i})?{structure:i}:{error:R}:{error:ae}}(e);if(i.error)return i;let n,a=function(e){let{tournamentRecord:t,participantIds:r,scaleName:i,eventType:n,adHocRatings:a={}}=e,o=e.scaleAccessor??Qg[i]?.accessor,s=t.participants??[];for(let c of r??[]){let e=s?.find((e=>e.participantId===c)),t=tP({scaleName:`${i}.${Ln}`,participant:e,eventType:n});!t&&i&&(t=tP({scaleAccessor:o,participant:e,scaleName:i,eventType:n})),t&&!a[c]&&(a[c]=t)}return a}(e),o=e.tournamentRecord?.isMock??e.isMock,s=e.eventType??e.event?.eventType,c=[],u=[];for(let d of ai(1,(e.roundsCount??1)+1)){let t=fy({...e,participantIds:r.participantIds,structure:i.structure,ignoreLastRoundNumber:!0,iterationMatchUps:c,adHocRatings:a,roundNumber:n,eventType:s,isMock:o});if(t.error)return t;let{matchUps:l,...p}=t;u.push({...p,iteration:d,matchUpsCount:l?.length}),n=(p?.roundNumber??1)+1,l?.length&&c.push(...l)}return{...I,matchUps:c,roundResults:u}}function iP(e){let{tournamentRecord:t,drawDefinition:r,structureId:i,idPrefix:n,isMock:a,event:o}=e,s=o?.entries?.filter((({entryStage:e,entryStatus:t})=>(!e||e===Is)&&t&&Dd.includes(t))),c=s?.map(Go),u=s?Math.floor(s.length/2):0;if(e.automated)return function(e){let{restrictEntryStatus:t,generateMatchUps:r,structureId:i,matchUpIds:n,scaleName:a,scaleAccessor:o}=e.drawMatic??{},s=rP({...e,eventType:e.drawMatic?.eventType??e.matchUpType,generateMatchUps:r??!0,scaleAccessor:o??e.scaleAccessor,scaleName:a??e.scaleName,participantIds:e.participantIds,roundsCount:e.roundsCount,restrictEntryStatus:t,structureId:i,matchUpIds:n});return s.error?s:(s?.matchUps?.length&&yU({tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,suppressNotifications:!0,matchUps:s.matchUps,event:e.event,structureId:i}),{...I})}({...e,participantIds:c});{let s=eP({roundsCount:e.roundsCount,drawDefinition:r,matchUpsCount:u,idPrefix:n,isMock:a,event:o});if(s.error)return s;s.matchUps?.length&&yU({matchUps:s.matchUps,suppressNotifications:!0,tournamentRecord:t,drawDefinition:r,structureId:i,event:o})}return{...I}}function nP({sortDescending:e=!1,tournamentRecord:t,scaleAttributes:r,scaleSortMethod:i,stageSequence:n,entries:a,event:o,stage:s}){return t?{scaledEntries:(a=a??o?.entries??[]).filter((e=>(!s||!e.entryStage||e.entryStage===s)&&(!n||!e.entryStageSequence||e.entryStageSequence===n)&&Dd.includes(e.entryStatus))).map((e=>{let{participantId:i}=e,{scaleItem:n}=Kv({tournamentRecord:t,scaleAttributes:r,participantId:i});return{...e,...n}})).filter((e=>{let t=e.scaleValue;return!!(i||!isNaN(t)&&parseFloat(t))&&t})).sort(i||function(t,r){return e?c(r)-c(t):c(t)-c(r)})}:{error:D};function c(t){return parseFloat(t.scaleValue||(e?-1:1e5))}}function aP(e){let t="prepareStage",{drawDefinition:r}=e,{structures:i}=Sc({stageSequence:e.stageSequence||1,roundTarget:e.roundTarget,stage:e.stage,drawDefinition:r}),n=e.preparedStructureIds||[],a=i?.find((({structureId:e})=>!n.includes(e)));if(!a)return en({result:{error:ae},stack:t});let o=a?.structureId,{seedsCount:s,stageEntries:c,seedLimit:u}=function(e){let{seedsCount:t}=e;e.seededParticipants&&(t=e.seededParticipants.length),t>e.drawSize&&(t=e.drawSize);let r=function({entries:e,stage:t,stageSequence:r,roundTarget:i}){return e.filter((e=>{let n=no({name:Po,element:e})?.extension?.value;return(!e.entryStage||e.entryStage===t)&&(!r||!e.entryStageSequence||e.entryStageSequence===r)&&(!i||!n||n===i)&&Pd.includes(e.entryStatus)}))}(e);t>r.length&&(t=r.length);let{seedLimit:i}=function({requireParticipantCount:e=!0,enforcePolicyLimits:t=!0,drawSizeProgression:r,participantsCount:i,participantCount:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:c,seedsCount:u}){i=i??n;let d=yc({drawDefinition:o,structureId:c});if(d.error)return d;let l=d.structure;if(!l)return{error:ae};let{positionAssignments:p}=Dc({structure:l}),m=p?.length||0;if(u>m)return{error:K};let f=l.structures?.length,h=Wr(s?.groupSeedingThreshold)&&s?.groupSeedingThreshold,g=$f({roundRobinGroupsCount:f,drawSize:m})?.seedGroups,{seedsCount:U}=Vv({policyDefinitions:a,requireParticipantCount:e,drawSizeProgression:r,participantsCount:i,drawSize:m});return U&&a?.[La]&&u>U&&t&&(u=U),l.seedLimit=u,l.seedAssignments=ai(1,u+1).map((e=>{let t=g?.find((t=>t.includes(e))),r=t&&Math.min(...t);return{participantId:void 0,seedNumber:e,seedValue:h&&e>=h?r:e}})),au({drawDefinition:o,structureIds:[c]}),{...I,seedLimit:u}}({enforcePolicyLimits:e.enforcePolicyLimits??!0,appliedPolicies:e.appliedPolicies,participantsCount:r.length,seedingProfile:e.seedingProfile,drawDefinition:e.drawDefinition,structureId:e.structureId,seedsCount:t});return i&&i<t&&(t=i),{seedsCount:t,stageEntries:r,seedLimit:i}}({...e,structureId:o});(e.seededParticipants||e.event||e.seedingScaleName)&&function(e){let{seededParticipants:t,seedingScaleName:r,entries:i,event:n}=e,a=i.map(Go);t?function(e){let{provisionalPositioning:t,enteredParticipantIds:r,seededParticipants:i,tournamentRecord:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:c,structure:u,event:d}=e,l=u?Yf({provisionalPositioning:t,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;i.filter((({participantId:e})=>r.includes(e))).filter((e=>!e.seedNumber||e.seedNumber<=i.length)).sort(((e,t)=>e.seedNumber<t.seedNumber?-1:e.seedNumber<t.seedNumber?1:0)).forEach((e=>{let{participantId:r,seedNumber:i,seedValue:a}=e;Zf({provisionalPositioning:t,tournamentRecord:n,drawDefinition:o,seedingProfile:s,participantId:r,seedBlockInfo:l,structureId:c,seedNumber:i,seedValue:a,event:d})}))}({...e,enteredParticipantIds:a}):(n||r)&&function(e){let t=e.seedsCount,{provisionalPositioning:r,enteredParticipantIds:i,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:c,seedingProfile:u,structureId:d,event:l}=e,{categoryName:p,ageCategoryCode:m}=l?.category||{},f=l?.eventType,h=function(e){let{tournamentRecord:t,seedingScaleName:r,stageSequence:i,entries:n,stage:a,event:o}=e,{categoryName:s,ageCategoryCode:c}=o?.category||{},u=o?.eventType,d={scaleName:r||s||c||o.eventId,scaleType:Gn,eventType:u};return nP({scaleAttributes:d,tournamentRecord:t,stageSequence:i,entries:n,stage:a}).scaledEntries}({...e,ageCategoryCode:m,categoryName:p,eventType:f})||c&&function(e){let{tournamentRecord:t,stageSequence:r,event:i,entries:n,stage:a}=e,{categoryName:o,ageCategoryCode:s}=i?.category||{},c=i?.eventType;return nP({scaleAttributes:{scaleName:o||s,scaleType:Vn,eventType:c},tournamentRecord:t,stageSequence:r,entries:n,stage:a}).scaledEntries}({...e,ageCategoryCode:m,categoryName:p,eventType:f}),g=h?.length??0;g<t&&(t=g),h?.filter((({participantId:e})=>i.includes(e))).slice(0,a||t).forEach(((e,t)=>{let i=t+1,{participantId:a,scaleValue:c}=e;Zf({provisionalPositioning:r,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:a,structureId:d,seedNumber:i,seedValue:n?.[i]||c||i,event:l})}))}({...e,enteredParticipantIds:a})}({...e,seedsCount:s,structure:a,structureId:o});let d=!1!==e.automated&&e.drawType!==Bs&&!(e.qualifyingOnly&&e.stage!==Us),l=(i?.length||0)>1,p=d?function(e){let t="object"==typeof e.automated&&e.automated.seedsOnly,r=eg({...e,seedsOnly:t});if(r.error)return r;let i=r?.positionAssignments,n=r?.positioningReport;return{conflicts:r.conflicts,positionAssignments:i,positioningReport:n}}({...e,multipleStructures:l,seedLimit:u,structureId:o}):{};return p?.error?en({result:p,stack:t}):{...p,stageEntries:c,structureId:o,seedsCount:s}}function oP(e){let t=Yv({...e,modifyOriginal:!1});if(t.error)return t;let r=t.drawDefinition,{suppressDuplicateEntries:i=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:c,drawEntries:u,placeByes:d,drawSize:l,drawType:p,entries:m}=e,f=[],h=[],g=function(e){let{ignoreStageSpace:t,drawDefinition:r,drawEntries:i,drawType:n,entries:a}=e;for(let o of a){if(i&&o.entryStage&&o.entryStage!==Is)continue;let a=sf({...o,ignoreStageSpace:t??n===Bs,entryStage:o.entryStage??Is,event:e.event,drawDefinition:r,drawType:n});if(i&&a.error)return a}return{error:void 0}}({suppressDuplicateEntries:i,ignoreStageSpace:n,drawDefinition:r,drawEntries:u,drawType:p,entries:m});if(g.error)return g;let I=p===Ys?0:xr(e.seedsCount??0),U=aP({...e,qualifyingOnly:!l||o,appliedPolicies:a,drawDefinition:r,seedingProfile:s,participants:c,stage:Is,seedsCount:I,placeByes:d,drawSize:l,entries:m});if(U.error&&!U.conflicts)return U;U.positioningReport?.length&&f.push({[Is]:U.positioningReport});let v=U.structureId;return U.conflicts&&(h=U.conflicts),p===Bs&&e.roundsCount&&iP({...e,drawDefinition:r,structureId:v}),{drawDefinition:r,positioningReports:f,conflicts:h,structureId:v}}var sP=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]});function cP(e){let t=e.structureIds,{tournamentRecord:r,drawDefinition:i,matchUpFormat:n,structureId:a,matchUpId:o,event:s}=e,c=xn(e,[{[an]:!0,[on]:!0}]);if(c.error)return c;if(!qI({matchUpFormat:n}))return{error:we};if(o){let e=bI({drawDefinition:i,matchUpId:o,event:s});if(e.error)return e;let t=e.matchUp;if(t?.matchUpType===kl)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:ke};t&&(t.matchUpFormat=n,iu({tournamentId:r?.tournamentId,eventId:s?.eventId,context:"setMatchUpFormat",drawDefinition:i,matchUp:t}))}else if(Array.isArray(t)){if(s?.eventType===kl)return{error:ue};for(let e of t){let t=yc({drawDefinition:i,structureId:e});if(t.error)return t;t.structure&&(t.structure.matchUpFormat=n)}}else if(a){if(s?.eventType===kl)return{error:ue};let e=yc({drawDefinition:i,structureId:a});if(e.error)return e;e.structure&&(e.structure.matchUpFormat=n)}else i&&(i.matchUpFormat=n);return t=t??(a?[a]:void 0),au({drawDefinition:i,structureIds:t}),{...I}}function uP({tournamentRecord:e,drawDefinition:t,matchUpFormat:r,matchUpType:i,tieFormat:n,event:a}){if((r||n)&&!(r&&a?.matchUpFormat===r||a?.tieFormat&&n&&JSON.stringify(a.tieFormat)===JSON.stringify(n))){if(n){let e=function({tieFormat:e}){let t=QI({checkCollectionIds:!1,tieFormat:e});if(t.error)return t;for(let r of e.collectionDefinitions)r.collectionId||(r.collectionId=Jl());return{tieFormat:e}}({tieFormat:n});if(e.error)return e;t.tieFormat=e.tieFormat??n}else if(r){let i=cP({tournamentRecord:e,drawDefinition:t,matchUpFormat:r,event:a});if(i.error)return{info:"matchUpFormat or tieFormat error",error:i.error}}i&&(t.matchUpType=i)}return{error:void 0}}var dP={};n(dP,{attachPolicies:()=>uU,findPolicy:()=>nd,getAppliedPolicies:()=>Yu,getPolicyDefinitions:()=>Ku,mutate:()=>lP,query:()=>fP,removePolicy:()=>pP});var lP={};function pP(e){let t=xn(e,[{policyType:!0,_anyOf:{[tn]:!1,[nn]:!1,[an]:!1,[Dn]:!1}}]);if(t.error)return t;let r,i=e.drawDefinition??e.event??((e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord);if(i)return mP(e,i);if(!e.tournamentRecords)return{error:D};{let t=Object.keys(e.tournamentRecords);if(!t.length)return{error:D};for(let i of t){let t=mP(e,e.tournamentRecords[i]);if(t.error)return t;r=!0}}return r?{...I}:{error:Ge}}function mP(e,t){let r=Yu(e).appliedPolicies??{};return r[e.policyType]?(delete r[e.policyType],Object.keys(r).length?za({element:t,extension:{name:ao,value:r}}):Wa({element:t,name:ao}),{...I}):{error:Ge}}n(lP,{attachPolicies:()=>uU,removePolicy:()=>pP});var fP={};n(fP,{findPolicy:()=>nd,getAppliedPolicies:()=>Yu,getPolicyDefinitions:()=>Ku});var hP={[La]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[cc]:{positioning:Ns},[sc]:{positioning:Ns}},positioning:"SEPARATE"},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},gP=hP;function IP({appliedPolicies:e,policyDefinitions:t,drawDefinition:r,stack:i}){if(t&&"object"!=typeof t)return en({info:"policyDefinitions must be an object",result:{error:mr},stack:i});let n={[xa]:e?.[xa]};return t?function({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}){for(let n of Object.keys(e))JSON.stringify(t?.[n])!==JSON.stringify(e[n])&&(r[n]=e[n]);Object.keys(r).length&&(uU({policyDefinitions:r,drawDefinition:i}),t&&Object.assign(t,r))}({policyDefinitions:t,appliedPolicies:e,policiesToAttach:n,drawDefinition:r}):n.avoidance&&uU({drawDefinition:r,policyDefinitions:n}),!e?.[La]&&!t?.[La]&&(uU({policyDefinitions:gP,drawDefinition:r}),e&&Object.assign(e,gP)),{error:void 0}}function UP(e){let{tournamentRecord:t,matchUpFormat:r,appliedPolicies:i,policyDefinitions:n,matchUpType:a,tieFormat:o,drawType:s,stack:c,event:u}=e,d=e.drawId?u?.drawDefinitions?.find((t=>t.drawId===e.drawId)):void 0;d&&s!==d.drawType&&(d.drawType=s);let l=d??function(e){let{drawId:t=Jl(),processCodes:r,matchUpType:i,drawType:n}=e??{},a=sP();return Object.assign(a,{processCodes:r,matchUpType:i,drawType:n,drawId:t})}({processCodes:e.processCodes,drawId:e.drawId,drawType:s}),p=uP({tournamentRecord:t,drawDefinition:l,matchUpFormat:r,matchUpType:a,tieFormat:o,event:u});if(p.error)return en({result:p,stack:c});let m=IP({appliedPolicies:i,policyDefinitions:n,drawDefinition:l,stack:c});if(m.error)return m;let f=d?.structures?.find((e=>e.stage===Is&&1===e.stageSequence))?.structureId,h=d?d.structures?.filter((e=>e.stage===Us)):[];return{drawDefinition:l,structureId:f,existingDrawDefinition:d,existingQualifyingPlaceholderStructureId:1===h?.length&&!h[0].matchUps?.length&&h[0].structureId}}var vP={};function yP(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}n(vP,{addGoesTo:()=>gm,allCompetitionMatchUps:()=>um,allDrawMatchUps:()=>lm,allEventMatchUps:()=>sm,allPlayoffPositionsFilled:()=>Ah,allTournamentMatchUps:()=>cm,analyzeDraws:()=>fU,analyzeMatchUp:()=>JD,analyzeTournament:()=>LP,bulkUpdatePublishedEventIds:()=>zP,calculateWinCriteria:()=>GD,categoryCanContain:()=>YI,checkMatchUpIsComplete:()=>Qp,checkValidEntries:()=>Bv,compareTieFormats:()=>jP,competitionScheduleMatchUps:()=>_D,credits:()=>yP,drawMatchUps:()=>XD,eventMatchUps:()=>FD,filterParticipants:()=>Xm,findDrawDefinition:()=>MU,findExtension:()=>no,getAllDrawMatchUps:()=>am,getAllEventData:()=>XP,getAllStructureMatchUps:()=>Kp,getAllowedDrawTypes:()=>NP,getAllowedMatchUpFormats:()=>MP,getAppliedPolicies:()=>Yu,getAssignedParticipantIds:()=>_m,getAvailableMatchUpsCount:()=>DU,getAvailablePlayoffProfiles:()=>kg,getCategoryAgeDetails:()=>HI,getCheckedInParticipantIds:()=>ml,getCompetitionDateRange:()=>kP,getCompetitionMatchUps:()=>xD,getCompetitionParticipants:()=>wP,getCompetitionPenalties:()=>EP,getCompetitionVenues:()=>JP,getCourtInfo:()=>np,getCourts:()=>eT,getDrawData:()=>eD,getDrawDefinitionTimeItem:()=>_u,getDrawParticipantRepresentativeIds:()=>TU,getDrawTypeCoercion:()=>kv,getEligibleVoluntaryConsolationParticipants:()=>PU,getEntriesAndSeedsCount:()=>ID,getEvent:()=>nT,getEventData:()=>tD,getEventMatchUpFormatTiming:()=>RD,getEventProperties:()=>rT,getEventPublishStatus:()=>Wm,getEventStructures:()=>Rh,getEventTimeItem:()=>Lu,getEvents:()=>iT,getFlightProfile:()=>op,getHomeParticipantId:()=>cp,getLinkedTournamentIds:()=>xo,getMatchUpCompetitiveProfile:()=>xd,getMatchUpContextIds:()=>qD,getMatchUpDailyLimits:()=>LD,getMatchUpDailyLimitsUpdate:()=>ND,getMatchUpDependencies:()=>Im,getMatchUpFormat:()=>HD,getMatchUpFormatTiming:()=>Ll,getMatchUpFormatTimingUpdate:()=>SD,getMatchUpScheduleDetails:()=>up,getMatchUpType:()=>Mp,getMatchUpsMap:()=>mp,getMatchUpsStats:()=>zD,getMaxEntryPosition:()=>UD,getModifiedMatchUpFormatTiming:()=>MD,getPairedParticipant:()=>Sp,getParticipantEventDetails:()=>PP,getParticipantIdFinishingPositions:()=>bU,getParticipantMembership:()=>DP,getParticipantResults:()=>cI,getParticipantScaleItem:()=>Kv,getParticipantSchedules:()=>TP,getParticipantSignInStatus:()=>bP,getParticipantTimeItem:()=>Bu,getParticipants:()=>ef,getPersonRequests:()=>lD,getPolicyDefinitions:()=>Ku,getPositionAssignments:()=>xv,getPositionsPlayedOff:()=>Og,getPredictiveAccuracy:()=>VD,getProfileRounds:()=>hD,getPublishState:()=>zm,getRoundMatchUps:()=>Up,getRounds:()=>QD,getScaleValues:()=>$n,getScaledEntries:()=>nP,getScheduledRoundsDetails:()=>nD,getSchedulingProfile:()=>sD,getSchedulingProfileIssues:()=>dD,getSeedingThresholds:()=>Wf,getSeedsCount:()=>Vv,getStructureSeedAssignments:()=>Ad,getTeamLineUp:()=>wp,getTieFormat:()=>WP,getTimeItem:()=>xu,getTournamentIds:()=>ro,getTournamentInfo:()=>FP,getTournamentPenalties:()=>AP,getTournamentPersons:()=>xP,getTournamentStructures:()=>Mh,getTournamentTimeItem:()=>Vu,getValidGroupSizes:()=>Gf,getVenueData:()=>ap,getVenuesAndCourts:()=>QP,isAdHoc:()=>Tp,isCompletedStructure:()=>Nh,isValidForQualifying:()=>_v,isValidMatchUpFormat:()=>qI,matchUpActions:()=>Ev,participantScaleItem:()=>jm,participantScheduledMatchUps:()=>ED,positionActions:()=>Fv,publicFindVenue:()=>tp,tallyParticipantResults:()=>wI,tieFormatGenderValidityCheck:()=>_I,tournamentMatchUps:()=>kD,validMatchUp:()=>gp,validMatchUps:()=>Ip,validateCollectionDefinition:()=>KI,validateLineUp:()=>uh});var SP={};function wP(e){let{tournamentRecords:t}=e||{};if("object"!=typeof t||!Object.keys(t).length)return{error:P};let r=[],i={},n={},a={},o=[],s={},c=[];for(let u of Object.values(t)){let{participantIdsWithConflicts:t,mappedMatchUps:d,participantMap:l,participants:p,matchUps:m,derivedEventInfo:f,derivedDrawInfo:h}=ef({...e,tournamentRecord:u});Object.assign(s,d),Object.assign(i,l),Object.assign(n,f),Object.assign(a,h),r.push(...p??[]),o.push(...m??[]),t?.forEach((e=>{c.includes(e)||c.push(e)}))}return{participantIdsWithConflicts:c,derivedEventInfo:n,derivedDrawInfo:a,participantMap:i,mappedMatchUps:s,participants:r,...I,matchUps:o}}function PP({tournamentRecord:e,participantId:t}){if(!e)return{error:D};if(!t)return{error:It};let r=[t].concat((e.participants??[]).filter((e=>e?.participantType&&[Mu,Ru].includes(e.participantType)&&e.individualParticipantIds?.includes(t))).map((e=>e.participantId)));return{eventDetails:(e.events??[]).filter((e=>ui((e?.entries??[]).map((e=>e.participantId)),r))).map((e=>({eventName:e.eventName,eventId:e.eventId})))}}function DP({tournamentRecord:e,participantId:t}){if(!e)return{error:D};if(!t)return{error:It};let{participants:r}=ef({participantFilters:{participantTypes:[Mu,Ru,bu]},tournamentRecord:e});return(r??[]).filter((e=>e.individualParticipantIds?.includes(t))).reduce(((e,t)=>{let r=t.participantType;return r&&(e[r]||(e[r]=[]),e[r].push(t)),e}),{})}function TP({participantFilters:e={},tournamentRecord:t}){if(!t)return{error:D};if("object"!=typeof e)return{error:dr,context:{participantFilters:e}};let r=cm({tournamentRecord:t,contextFilters:{eventIds:e.eventIds}}).matchUps??[],i=Object.assign({},...r.map((e=>({[e.matchUpId]:e})))),n=r.filter((({schedule:e})=>e&&Object.keys(e).length)),a=Im({tournamentRecord:t,matchUps:r}).sourceMatchUpIds??[],o={};for(let s of n){let e,{sides:t}=s,r=t?.map((t=>{if(t.participant)return[t.participant].concat(...t.participant.individualParticipants||[]);a[s.matchUpId]&&!e&&(e=(a[s.matchUpId]||[]).map((e=>i[e])).filter((({winningSide:e,bye:t})=>!e&&!t)))})).filter(Boolean).flat()??[];for(let i of r){let{participantId:e}=i;o[e]||(o[e]={potentialMatchUps:[],participant:i,matchUps:[]}),o[e].matchUps.push(s)}let n=e?.map((({sides:e})=>e)).flat().map((({participant:e})=>e&&[e].concat(...e.individualParticipants||[]))).filter(Boolean).flat()||[];for(let i of n){let{participantId:e}=i;o[e]||(o[e]={potentialMatchUps:[],participant:i,matchUps:[]}),o[e].potentialMatchUps.push(s)}}return{participantSchedules:Object.values(o).filter((({participant:t})=>!(e.participantIds&&!e.participantIds.includes(t.participantId)||e.participantTypes&&!e.participantTypes.includes(t.participantType)))),...I}}function bP({tournamentRecord:e,participantId:t}){if(!e)return{error:D};if(!t)return{error:It};let{participant:r}=Fu({tournamentRecord:e,participantId:t});if(!r)return{error:Ut};let{timeItem:i}=xu({itemType:Su,element:r});return i&&i.itemValue===Pu&&Pu}n(SP,{filterParticipants:()=>Xm,getCompetitionParticipants:()=>wP,getPairedParticipant:()=>Sp,getParticipantEventDetails:()=>PP,getParticipantMembership:()=>DP,getParticipantScaleItem:()=>Kv,getParticipantSchedules:()=>TP,getParticipantSignInStatus:()=>bP,getParticipantTimeItem:()=>Bu,getParticipants:()=>ef,getScaleValues:()=>$n,participantScaleItem:()=>jm,validateLineUp:()=>uh});var RP={};function MP({tournamentRecord:e,categoryName:t,categoryType:r}){if(!e)return{error:D};let{appliedPolicies:i}=Yu({tournamentRecord:e});return(i?.[_a]?.matchUpFormats||[]).filter((({categoryNames:e,categoryTypes:i})=>!t&&!i||t&&e?.includes(t)||r&&i?.includes(r)))}function NP({tournamentRecord:e,categoryName:t,categoryType:r}){if(!e)return{error:D};let{appliedPolicies:i}=Yu({tournamentRecord:e});return(i?.[Ba]?.allowedDrawTypes||[]).filter((({categoryNames:e,categoryTypes:i})=>!t&&!i||t&&e?.includes(t)||r&&i?.includes(r)))}function AP({tournamentRecord:e}){if(!e)return{error:D};let t=(e?.participants??[]).reduce(((e,t)=>{let{participantId:r}=t;return(t.penalties??[]).forEach((t=>{let{penaltyId:i}=t||{};e[i]?e[i].participants.push(r):e[i]={...t,participantIds:[r]}})),e}),{});return{penalties:Object.values(t)}}function EP({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:P};let t=[];for(let r of Object.values(e)){let{penalties:e}=AP({tournamentRecord:r});t.push(...e??[])}return{penalties:t}}function CP({event:e}){return{eventInfo:(({eventId:e,eventName:t,eventType:r,eventLevel:i,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l,onlineResources:p,notes:m})=>({eventId:e,eventName:t,eventType:r,eventLevel:i,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l,onlineResources:p,notes:m}))(e)}}n(RP,{analyzeDraws:()=>fU,analyzeTournament:()=>LP,getAllowedDrawTypes:()=>NP,getAllowedMatchUpFormats:()=>MP,getAppliedPolicies:()=>Yu,getCompetitionDateRange:()=>kP,getCompetitionPenalties:()=>EP,getPolicyDefinitions:()=>Ku,getTournamentInfo:()=>FP,getTournamentPenalties:()=>AP,getTournamentPersons:()=>xP,getTournamentStructures:()=>Mh,getTournamentTimeItem:()=>Vu});var OP={[Oa]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}};function FP(e){let{tournamentRecord:t}=e??{};if(!t)return{error:D};let r=(({tournamentId:e,tournamentRank:t,tournamentStatus:r,formalName:i,tournamentName:n,promotionalName:a,onlineResources:o,localTimeZone:s,startDate:c,endDate:u,hostCountryCode:d,venues:l,notes:p,updatedAt:m})=>({tournamentId:e,tournamentRank:t,tournamentStatus:r,formalName:i,tournamentName:n,promotionalName:a,onlineResources:o,localTimeZone:s,startDate:c,endDate:u,hostCountryCode:d,venues:l,notes:p,updatedAt:m}))(t),i=ef({participantFilters:{participantRoles:[ff,Uf,gf,If,yf]},policyDefinitions:OP,tournamentRecord:t}).participants;i&&(r.tournamentContacts=i);let n=zm({tournamentRecord:t})?.publishState?.tournament?.status?.publishedEventIds||[],a=[];for(let o of t.events??[])if(!e?.usePublishState||n.includes(o.eventId)){let e=CP({event:o}).eventInfo;e&&a.push(e)}return r.eventInfo=a,{tournamentInfo:Da(r,!1,!0),...I}}function kP({tournamentRecords:e}){if(!d(e))return{error:P};let t=Object.keys(e??{}).reduce(((t,r)=>{let i=e[r],{tournamentInfo:{startDate:n,endDate:a}}=FP({tournamentRecord:i}),o=n&&new Date(la(n));(!t.startDate||o&&o<t.startDate)&&(t.startDate=o);let s=a&&new Date(la(a));return(!t.endDate||s&&s>t.endDate)&&(t.endDate=s),t}),{startDate:void 0,endDate:void 0}),r=t.startDate&&la(t.startDate.toISOString()),i=t.endDate&&la(t.endDate.toISOString());return r&&i?{startDate:r,endDate:i}:{error:ze}}function xP({tournamentRecord:e,participantFilters:t}){if(!e)return{error:D};let r=e.participants||[];t&&(r=Xm({participants:r,participantFilters:t,tournamentRecord:e}));let i={};return r.forEach((e=>{e.person&&(e=>{if(e.person){let{personId:t}=e.person;i[t]?i[t].participantIds.push(e.participantId):i[t]={...e.person,participantIds:[e.participantId]}}})(e)})),{tournamentPersons:Object.values(i)}}function _P(e){let t=2===e.participants?.filter((({participantType:e})=>e===Mu))?.length,r=1===e.events?.length&&e.events[0],i=1===r?.drawDefinitions?.length&&r.drawDefinitions[0],n=2===(1===i?.structures?.length&&i.structures[0])?.positionAssignments?.length;return!!(r.tieFormat&&t&&n)}function LP({tournamentRecord:e}){if(!e)return{error:D};let{drawsAnalysis:t}=fU({tournamentRecord:e}),r={isDual:_P(e),drawsAnalysis:t};return{...I,analysis:r}}var VP={};function BP(e){if(!e)return{};let t=[],r=e.tieFormatName,i=e.collectionDefinitions?.map((e=>{let{matchUpType:r,matchUpFormat:i,matchUpCount:n,category:a,gender:o}=e;t.includes(i)||t.push(i);let s=a?.ageCategoryCode;return[n,r===fu?"D":"S",s,i,o].join(";")})).join("|");return{tieFormatName:e&&r||"UNNAMED",matchUpFormats:t,tieFormatDesc:i}}function jP({considerations:e={},descendant:t,ancestor:r}){let i={},n={},{matchUpFormats:a,tieFormatDesc:o}=BP(t),{matchUpFormats:s,tieFormatDesc:c}=BP(r),u=Yr((a??[]).filter((e=>!(s??[]).includes(e))).concat((s??[]).filter((e=>!(a??[]).includes(e))))),d=!(!e?.collectionName||t.collectionDefinitions.map((({collectionName:e})=>e)).join("|")===r.collectionDefinitions.map((({collectionName:e})=>e)).join("|")),l=!(!e?.collectionOrder||t.collectionDefinitions.map((({collectionOrder:e})=>e)).join("|")===r.collectionDefinitions.map((({collectionOrder:e})=>e)).join("|")),p=Object.assign({},...(t?.collectionDefinitions||[]).map((e=>({[e.collectionId]:e})))),m=Object.assign({},...(r?.collectionDefinitions||[]).map((e=>({[e.collectionId]:e}))));i.collectionIds=ci(Object.keys(p),Object.keys(m)),n.collectionIds=ci(Object.keys(m),Object.keys(p)),i.collectionsValue=GP(p),n.collectionsValue=GP(m),i.groupsCount=r?.collectionGroups?.length??(0-(t?.collectionGroups?.length??0)||0),n.groupsCount=i.groupsCount?-1*i.groupsCount:0;let f=i.collectionsValue.totalValue-n.collectionsValue.totalValue,h=i.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==i.collectionsValue.assignmentValues.length,U=n.collectionsValue.assignmentValues.some(((e,t)=>{let r=i.collectionsValue.assignmentValues[t];return!r||e.valueKey!==r.valueKey||e.value!==r.value||!!Array.isArray(e.value)&&e.value.every(((e,t)=>r.value[t]===e))})),v=d||l||c!==o||g||U||0!==f,y=[...n.collectionsValue.invalidValues,...i.collectionsValue.invalidValues],S=y.length&&y;return{matchUpFormatDifferences:u,matchUpCountDifference:h,descendantDifferences:i,ancestorDifferences:n,orderDifference:l,valueDifference:f,nameDifference:d,descendantDesc:o,ancestorDesc:c,...I,different:v,invalid:S}}function GP(e){let t=[],r=[],i=0;return{totalValue:Object.keys(e).sort(Km).reduce(((n,a)=>{let o=e[a],{collectionValueProfiles:s,collectionValue:c,matchUpCount:u,matchUpValue:d,scoreValue:l,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:c,matchUpValue:d,scoreValue:l,setValue:p},f=Object.keys(m).filter((e=>![void 0,null].includes(m[e])&&(!Array.isArray(m[e])||m[e].length>0)));1!==f.length&&t.push({collectionId:a});let h=f[0];if(h){let e="collectionValueProfiles"===h?Object.values(s):m[h];r.push({valueKey:h,value:e})}return i+=u,s?.length?n+s.reduce(((e,t)=>e+t.value),0):u?Wr(d)?n+d*u:Wr(l)?n+l*u:Wr(p)?n+p*u:n+c:n}),0),totalMatchUps:i,invalidValues:t,assignmentValues:r}}function qP(e){Object.assign(e,{inContext:!0});let{matchUp:t,error:r}=$P(e);return{matchUp:Da(t,!0,!0),error:r}}function $P({participantsProfile:e,afterRecoveryTimes:t,tournamentRecord:r,contextContent:i,contextProfile:n,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:c,eventId:u,drawId:d,event:l}){if(!r)return{error:D};if("string"!=typeof s)return{error:Ae};if(!a||!l){let e=(cm({tournamentRecord:r,nextMatchUps:o}).matchUps??[]).find((e=>e.matchUpId===s));if(!e)return{error:Ce};({eventId:u,drawId:d}=e),({event:l,drawDefinition:a}=sp({tournamentRecord:r,eventId:u,drawId:d}))}if(!a)return{error:A};n&&!i&&(i=id({tournamentRecord:r,contextProfile:n}));let p={surfaceCategory:l?.surfaceCategory??r.surfaceCategory,indoorOutDoor:l?.indoorOutdoor??r.indoorOutdoor,endDate:l?.endDate??r.endDate,tournamentId:r.tournamentId,eventId:u??l?.eventId,drawId:d},{participants:m=[]}=zu({participantsProfile:e,tournamentRecord:r,contextProfile:n,inContext:c});if(o){let e=(lm({context:c?p:void 0,participants:m,afterRecoveryTimes:t,contextContent:i,contextProfile:n,drawDefinition:a,nextMatchUps:o,inContext:c,event:l}).matchUps??[]).find((e=>e.matchUpId===s));if(!e)return{error:Ce};let r=a?.structures?.find((t=>t.structureId===e.structureId));return{drawDefinition:a,structure:r,matchUp:e}}{let{matchUp:e,structure:r}=bI({context:c?p:void 0,tournamentParticipants:m,afterRecoveryTimes:t,contextContent:i,drawDefinition:a,contextProfile:n,matchUpId:s,inContext:c,event:l});return{matchUp:e,structure:r,drawDefinition:a}}}function WP({tournamentRecord:e,drawDefinition:t,structureId:r,matchUpId:i,structure:n,eventId:a,drawId:o,event:s}){if(!e)return{error:D};if(!(o||s||r||i))return en({result:{error:He},stack:"getTieFormat"});a&&!s&&(s=e.events?.find((e=>e.eventId===a)));let c=qP({tournamentRecord:e,drawDefinition:t,matchUpId:i,drawId:o,event:s});if(i&&c?.error)return c;if(!t&&c?.drawDefinition&&(t=c?.drawDefinition),!(n=n??c?.structure)&&r&&!i){if(!t)return{error:H};let e=yc({drawDefinition:t,structureId:r});if(e.error)return e;n=e.structure}let u=(n?.tieFormat||n?.tieFormatId)&&pp({structure:n,drawDefinition:t,event:s})?.tieFormat,d=(t?.tieFormat||t?.tieFormatId)&&pp({drawDefinition:t,event:s})?.tieFormat,l=pp({event:s})?.tieFormat,p=pp({matchUp:c?.matchUp,drawDefinition:t,structure:n,event:s})?.tieFormat;return{...I,matchUp:c?.matchUp,structureDefaultTieFormat:ZI(u),eventDefaultTieFormat:ZI(l),drawDefaultTieFormat:ZI(d),tieFormat:ZI(p),structure:n}}n(VP,{compareTieFormats:()=>jP,getTieFormat:()=>WP,tieFormatGenderValidityCheck:()=>_I,validateCollectionDefinition:()=>KI});var HP={};function zP({tournamentRecord:e,outcomes:t}){if(!e)return{error:D};if(!t?.length)return{error:He,info:"Missing outcomes"};let r=t.reduce(((e,t)=>{let{drawId:r,eventId:i}=t;return i&&r&&(e[i]?e[i].includes(r)||e[i].push(r):e[i]=[r]),e}),{}),i=Object.keys(r);return{publishedEventIds:(e.events?.filter((e=>i.includes(e.eventId)))).filter((e=>{let t=Wm({event:e}),{drawDetails:i,drawIds:n}=t??{},{eventId:a}=e;return r[a].filter((e=>{let r=i?Object.keys(t.drawDetails).filter((e=>Hm({drawId:e,drawDetails:i}))):[];return n?.includes(e)||r.includes(e)})).length})).map((e=>e.eventId)),eventIdPublishedDrawIdsMap:r}}function YP({dates:e=[],extension:t}){if(!t)return!1;if("boolean"==typeof t.value&&t.value)return!0;if(!e.length)return!1;let r=d(t.value)?t.value?.dates:void 0;return Array.isArray(r)?!!r?.length&&!!r.filter((t=>!e.length||e.includes(t))).length:void 0}function KP({convertExtensions:e,ignoreDisabled:t,venue:r,court:i}){let n={...Da(i,e,!0),venueId:r.venueId},{extension:a}=no({name:co,element:i});if(t&&a){let e=d(a.value)?a.value?.dates:void 0,t=!0===a?.value?[]:n.dateAvailability.map((t=>{let r=t.date;if(r&&!e.includes(r))return t})).filter(Boolean);n.dateAvailability=t}return{inContextCourt:n}}function QP(e){let{convertExtensions:t,ignoreDisabled:r,venueIds:i=[],dates:n}=e,a=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{},o=[],s=[],c=[],u=[];return Object.keys(a).filter((t=>!e.tournamentId||t===e.tournamentId)).forEach((e=>{let d=a[e];for(let a of d.venues??[])if(!i.length||i.includes(a.venueId)){if(r){let{extension:e}=no({name:co,element:a});if(e?.value)continue}o.includes(a.venueId)||(u.push(Da(a,t,!0)),o.push(a.venueId));for(let e of a.courts??[])if(!s.includes(e.courtId)){if(r){let{extension:t}=no({name:co,element:e});if(YP({extension:t,dates:n}))continue}let{inContextCourt:i}=KP({convertExtensions:t,ignoreDisabled:r,venue:a,court:e});c.push(i),s.push(e.courtId)}}})),{courts:c,venues:u,...I}}function JP({tournamentRecords:e,requireCourts:t,dates:r}){return"object"==typeof e&&Object.keys(e).length?Object.keys(e).reduce(((i,n)=>{let a=e[n],{venues:o}=function({convertExtensions:e,tournamentRecord:t,ignoreDisabled:r,dates:i}){if(!t)return{error:P};let n=Da(t.venues??[],e).filter((e=>{if(!r)return e;let{extension:t}=no({name:co,element:e});return!t?.value&&e})).filter(Boolean),a=n.reduce(((t,n)=>{let a=(n?.courts||[]).filter((e=>{if(!r&&!i?.length)return e;let{extension:t}=no({name:co,element:e});return YP({extension:t,dates:i})})).filter(Boolean).map((t=>{let{inContextCourt:i}=KP({convertExtensions:e,ignoreDisabled:r,venue:n,court:t});return i}));return a.length?t.concat(a):t}),[]);return{venues:n,courts:a}}({tournamentRecord:a,dates:r});return o?.forEach((e=>{let{venueId:r,courts:n}=e;(!t||n?.length)&&!i.venueIds.includes(r)&&(i.venues.push(e),i.venueIds.push(r))})),i}),{venues:[],venueIds:[]}):{error:P}}function XP({tournamentRecord:e,policyDefinitions:t}){if(!e)return{error:D};let r=e.events||[],i=e?.participants||[],{tournamentInfo:n}=FP({tournamentRecord:e}),{venues:a}=QP({tournamentRecord:e});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:r.map((r=>{let{eventId:n}=r,a=CP({event:r}).eventInfo,o=ad({tournamentRecord:e,event:r}).scheduleTiming,s=(r.drawDefinitions||[]).map((a=>{let s=(({drawId:e,drawName:t,matchUpFormat:r,updatedAt:i})=>({matchUpFormat:r,updatedAt:i,drawName:t,drawId:e}))(a),{abandonedMatchUps:c,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:l}=om({requireParticipants:!0,tournamentParticipants:i,context:{eventId:n},policyDefinitions:t,tournamentRecord:e,inContext:!0,scheduleTiming:o,drawDefinition:a,event:r});return{drawInfo:s,matchUps:{abandonedMatchUps:c,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:l}}})),c=Wm({event:r});return Object.assign(a,{drawsData:s,publish:c}),a}))}}}function ZP({publishStatus:e,drawId:t}){return e?.drawDetails?e.drawDetails?.[t]?.publishingDetail?.published:!e?.drawIds||e.drawIds.includes(t)}function eD(e){let{tournamentParticipants:t=[],includePositionAssignments:r,policyDefinitions:i,tournamentRecord:n,inContext:a=!0,usePublishState:o,status:s=dl,pressureRating:c,refreshResults:u,drawDefinition:d,noDeepCopy:l,sortConfig:p,context:m,event:f}=e;if(!d)return{error:M};let h=(({matchUpFormat:e,updatedAt:t,drawType:r,drawName:i,drawId:n})=>({matchUpFormat:e,updatedAt:t,drawName:i,drawType:r,drawId:n}))(d);h.display=no({element:d,name:po}).extension?.value;let g,U,{allStructuresLinked:v,sourceStructureIds:y,hasDrawFeedProfile:S,structureGroups:w}=ig({drawDefinition:d});if(!v)return{error:ce};let P=e?.publishStatus??Wm({event:f,status:s}),D=e.eventPublished??!!zm({event:f}).publishState?.status?.published,T=!1,b=!1,R=w.map((s=>{let l={},I=s.map((e=>{let{structure:t}=yc({drawDefinition:d,structureId:e}),{seedAssignments:r}=Ad({drawDefinition:d,structure:t});return t?.stage===Is&&1===t.stageSequence&&(g=r),t?.stage===Us&&1===t.stageSequence&&(U=r),t})).sort(((e,t)=>Uc(e,t,p))).map((r=>{if(!r)return;let s=r?.structureId,p=[];r.stage&&[Is,vs,Ss].includes(r.stage)&&(p=g),r?.stage===Us&&(p=U);let{matchUps:I,roundMatchUps:v,roundProfile:w}=Kp({seedAssignments:r?.seedAssignments?.length?void 0:p,context:{drawId:h.drawId,...m},tournamentParticipants:t,policyDefinitions:i,tournamentRecord:n,usePublishState:o,publishStatus:P,drawDefinition:d,inContext:a,structure:r,event:f}),{positionAssignments:D}=Pc({structure:r}),R=D?.filter(fm(sn)).map((e=>{let t=no({element:e,name:Mo})?.extension?.value,{drawPosition:r,participantId:i}=e;return b=!0,{participantResult:t,participantId:i,drawPosition:r}}));if(I.length&&(!R?.length&&e.allParticipantResults||u)){let{subOrderMap:e}=PI({positionAssignments:D}),t=wI({matchUpFormat:r.matchUpFormat,policyDefinitions:i,pressureRating:c,subOrderMap:e,matchUps:I});R=D?.filter(fm(sn)).map((e=>{let{drawPosition:r,participantId:i}=e;return b=!0,{participantResult:i&&t?.participantResults?.[i],participantId:i,drawPosition:r}}))}let M=r?(({stageSequence:e,structureName:t,structureType:r,matchUpFormat:i,stage:n})=>({stageSequence:e,structureName:t,structureType:r,matchUpFormat:i,stage:n}))(r):{};M.display=no({element:r,name:po}).extension?.value,M.sourceStructureIds=y[s],M.hasDrawFeedProfile=S[s],M.positionAssignments=D,M.structureActive=I.reduce(((e,t)=>{let r=[es,Zo,ts,Qo,Ko,Xo,ns,ss].includes(t.matchUpStatus);return e||r||!!t.winningSide||!!t.score?.scoreStringSide1}),!1);let N=I.reduce(((e,t)=>e&&[Yo,Qo,ns,ss,Xo,Ho].includes(t.matchUpStatus)),!!I.length);return M.structureCompleted=N,l[s]=N,M.structureActive&&(T=!0),{...M,participantResults:R,seedAssignments:p,roundMatchUps:v,roundProfile:w,structureId:s}}));return I.forEach((e=>{r||delete e.positionAssignments,e.sourceStructuresComplete=e.sourceStructureIds?.every((e=>l[e]))})),I})).flat();return h.drawActive=T,h.participantPlacements=b,h.drawGenerated=R?.reduce(((e,t)=>e||!!t?.roundMatchUps),!1),h.drawCompleted=R?.reduce(((e,t)=>e&&t.structureCompleted),!0),h.drawPublished=o?D&&ZP({publishStatus:P,drawId:h.drawId}):void 0,{structures:!o||h.drawPublished?l?R:Da(R,!1,!0):void 0,drawInfo:l?h:Da(h,!1,!0),...I}}function tD(e){let{includePositionAssignments:t,participantsProfile:r,policyDefinitions:i,usePublishState:n,status:a=dl,sortConfig:o}=e,s=xn(e,[{tournamentRecord:!0},{[Cn]:{event:!1,eventId:!1}}]);if(s.error)return s;let c=Da(e.tournamentRecord,!1,!0),u=e.event?void 0:sp({tournamentRecord:c,eventId:e.eventId}).event,d=e.event?Da(e.event,!1,!0):u&&Da(u,!1,!0)||void 0;if(!d)return{error:le};let{eventId:l}=d,{tournamentId:p,endDate:m}=c,f=Wm({event:d,status:a}),h=zm({event:d}).publishState??{},g=!!h?.status?.published,{participants:U}=ef({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:i,...r,tournamentRecord:c}),v=d.drawDefinitions||[],y=!n||g?v.filter((({drawId:e})=>!n||ZP({publishStatus:f,drawId:e}))).map((r=>(({drawInfo:e,structures:t})=>({...e,structures:t}))(eD({allParticipantResults:e.allParticipantResults,context:{eventId:l,tournamentId:p,endDate:m},pressureRating:e.pressureRating,refreshResults:e.refreshResults,includePositionAssignments:t,tournamentParticipants:U,noDeepCopy:!0,policyDefinitions:i,tournamentRecord:c,usePublishState:n,drawDefinition:r,publishStatus:f,sortConfig:o,event:d})))).map((({structures:e,...t})=>{let r=e?.filter((({stage:e,structureId:r})=>(({structureId:e,drawId:t})=>{if(!n)return!0;let r=f?.drawDetails?.[t]?.structureDetails;return!r||!Object.keys(r).length||r[e]?.published})({structureId:r,drawId:t.drawId})&&(({stage:e,drawId:t})=>{if(!n)return!0;let r=f?.drawDetails?.[t]?.stageDetails;return!r||!Object.keys(r).length||r[e]?.published})({stage:e,drawId:t.drawId}))).map((e=>(({drawId:e,structure:t})=>{if(!n)return t;let r=f?.drawDetails?.[e]?.structureDetails?.[t.structureId]?.roundLimit;if(Wr(r)){let e=ai(1,r+1),i={},n={};for(let r of e)t.roundMatchUps[r]&&(i[r]=t.roundMatchUps[r],n[r]=t.roundProfile[r]);t.roundMatchUps=i,t.roundProfile=n}return t})({drawId:t.drawId,structure:e})));return{...t,structures:r}})).filter((e=>e.structures?.length)):void 0,{tournamentInfo:S}=FP({tournamentRecord:c}),w=(c.venues||[]).map((e=>(({venueData:e})=>({...e}))(ap({tournamentRecord:c,venueId:e.venueId})))),P=(({eventId:e,eventName:t,eventType:r,eventLevel:i,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:e,eventName:t,eventType:r,eventLevel:i,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(d);P.display=no({element:d,name:po}).extension?.value;let D={tournamentInfo:S,venuesData:w,eventInfo:P,drawsData:y};return D.eventInfo.publishState=h,D.eventInfo.published=h?.status?.published,{...I,eventData:D,participants:U}}n(HP,{bulkUpdatePublishedEventIds:()=>zP,getAllEventData:()=>XP,getCourtInfo:()=>np,getDrawData:()=>eD,getEventData:()=>tD,getEventPublishStatus:()=>Wm,getPublishState:()=>zm,getVenueData:()=>ap});var rD={};function iD({defaultRecoveryMinutes:e=0,defaultAverageMinutes:t,tournamentRecords:r,matchUpFormat:i,categoryName:n,categoryType:a,tournamentId:o,eventType:s,eventId:c}){if(!qI({matchUpFormat:i}))return{error:we};let u;return Object.keys(r).filter((e=>!o||e===o)).forEach((e=>{if(u)return;let t=r[e],o=c?sp({tournamentRecord:t,eventId:c})?.event:void 0;return u=Ll({tournamentRecord:t,matchUpFormat:i,categoryName:n,categoryType:a,eventType:s,event:o}),u?.averageMinutes||u?.recoveryMinutes})),{recoveryMinutes:u?.recoveryMinutes||e,averageMinutes:u?.averageMinutes||t,typeChangeRecoveryMinutes:u?.typeChangeRecoveryMinutes||u?.recoveryMinutes||e}}function nD({scheduleCompletedMatchUps:e,containedStructureIds:t,tournamentRecords:r,periodLength:i=30,matchUps:n,rounds:a}){if("object"!=typeof r)return{error:P};if(!Array.isArray(a))return{error:He,info:ch("rounds")};let o={},s=[],c=[];a.sort(((e,t)=>(e.sortOrder??0)-(t.sortOrder??0))),t=t??Object.assign({},...Object.values(r).map((e=>lu({tournamentRecord:e}).containedStructures))),n||({matchUps:n}=um({nextMatchUps:!0,tournamentRecords:r}));let u=0,d={},l={},p={};return{scheduledRoundsDetails:a.flatMap((a=>{let m=a.periodLength||i,f=[];t?.[a.structureId]?f.push(...t[a.structureId]):f.push(a.structureId);let h=n?jp({tournamentIds:[a.tournamentId],roundNumbers:[a.roundNumber],matchUpIds:a.matchUpIds,eventIds:[a.eventId],drawIds:[a.drawId],processContext:!0,structureIds:f,matchUps:n}).sort(dm):[],{segmentNumber:g,segmentsCount:I}=a.roundSegment||{};if(Wr(g)&&_r(h?.length)&&_r(I)&&g>0&&g<=I&&I<h?.length&&!a.matchUpIds?.length){let e=h.length/I,t=e*(g-1);h=h.slice(t,t+e)}let U=r[a.tournamentId],v=sp({drawId:a.drawId,tournamentRecord:U}).event,y=[];for(let e of h){let t=e.matchUpFormat;t&&(o[t]||(o[t]=[],o[t].push(e)),y.push(t))}for(let t of y){let{eventType:i,category:n}=v??{},{categoryName:o,ageCategoryCode:f}=n??{},{typeChangeRecoveryMinutes:g,recoveryMinutes:I,averageMinutes:U,error:y}=iD({categoryName:o??f,categoryType:n?.categoryType,tournamentId:a.tournamentId,eventId:a.eventId,tournamentRecords:r,matchUpFormat:t,eventType:i});if(y)return{error:y,round:a};let S=h.filter((t=>(e||!ms.includes(t.matchUpStatus))&&t.matchUpStatus!==Yo)).map(qo);S.forEach((e=>{p[e]={typeChangeRecoveryMinutes:g,recoveryMinutes:I,averageMinutes:U},d[e]=I,l[e]=U})),c.push(...S),u=Math.max(U||0,u);let w=`${U}|${m}`;return s.includes(w)||s.push(w),{roundPeriodLength:m,recoveryMinutes:I,averageMinutes:U,matchUpIds:S,hash:w}}})),greatestAverageMinutes:u,matchUpFormatCohorts:o,recoveryMinutesMap:d,averageMinutesMap:l,orderedMatchUpIds:c,minutesMap:p,...I}}function aD({schedulingProfile:e,venueIds:t,eventIds:r,drawIds:i}){let n=[],a=e?.map((e=>{let a=la(e?.scheduleDate);if(!a)return void n.push(`Invalid date: ${e?.scheduledDate}`);let o=(e?.venues||[]).map((e=>{let{rounds:a,venueId:o}=e;if(!t?.includes(o))return void n.push(`Missing venueId: ${o}`);let s=a.filter((e=>{let t=r.includes(e.eventId)&&i.includes(e.drawId);return t||n.push(`Invalid eventId: ${e.eventId} or drawId: ${e.drawId}`),t}));return s.length?{venueId:o,rounds:s}:void 0})).filter(Boolean);return o.length&&a&&{...e,venues:o}})).filter(Boolean);return{updatedSchedulingProfile:a,modifications:n.length,issues:n}}function oD({tournamentRecords:e,schedulingProfile:t}){if(!t)return{valid:!0};if(!Array.isArray(t))return{valid:!1,error:mr};let r,i,{venueIds:n,tournamentsMap:a}=function(e){let t=e?.tournamentRecords&&Object.values(e?.tournamentRecords)||[],r={},{venueIds:i,eventIds:n,drawIds:a,structureIds:o,tournamentIds:s}=t.reduce(((e,t)=>{let{tournamentIds:i,tournamentMap:n,structureIds:a,venueIds:o,eventIds:s,drawIds:c}=function(e){let{tournamentRecord:t={},tournamentMap:r={},requireCourts:i}=e,n=[],a=[],o=[],s=[],c=(t?.venues||[]).map((({venueId:e,courts:t})=>(!i||t?.length)&&e)),u=t?.tournamentId;return u&&(n.push(u),r[u]={},(t?.events||[]).forEach((e=>{let t=e.eventId;o.push(t),r[u][t]={},(e.drawDefinitions||[]).forEach((e=>{let i=e.drawId;s.push(i),r[u][t][i]={};let{structures:n}=Sc({drawDefinition:e});(n||[]).forEach((e=>{let n=e.structureId,{matchUps:o}=Kp({structure:e}),{roundMatchUps:s}=Up({matchUps:o}),c=s&&Object.keys(s).map((e=>parseInt(e)));r[u][t][i][n]=c,a.push(n),e.structures?.length&&e.structures.forEach((e=>{a.push(e.structureId),r[u][t][i][e.structureId]=c}))}))}))}))),{tournamentMap:r,tournamentIds:n,structureIds:a,venueIds:c,eventIds:o,drawIds:s}}({tournamentRecord:t});return o.forEach((t=>{e.venueIds.includes(t)||e.venueIds.push(t)})),e.tournamentIds.push(...i),e.structureIds.push(...a),e.eventIds.push(...s),e.drawIds.push(...c),Object.assign(r,n),e}),{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:r,tournamentIds:s,structureIds:o,venueIds:i,eventIds:n,drawIds:a}}({tournamentRecords:e}),o=t.every((e=>{let{scheduleDate:t,venues:o}=e;return!!Zn(t)&&o.every((e=>{let{venueId:t,rounds:o}=e;return"string"!=typeof t?(i="venueId should be a string",!1):Array.isArray(o)?n.includes(t)?!!o.every((e=>{if(!e)return i="empty round",!1;let{roundSegment:t,tournamentId:r,structureId:n,roundNumber:o,eventId:s,drawId:c}=e,u=a?.[r]?.[s]?.[c]?.[n]?.includes(o);u||(i="Invalid rounds");let{segmentNumber:d,segmentsCount:l}=t||{},p=!t||Wr(d)&&_r(l)&&d<=l;return p||(i="Invalid segment"),u&&p})):(r=$t,!1):(i="rounds should be an array",!1)}))}));return!o&&!r&&(r=mr),{valid:!!o,error:r,info:i}}function sD({tournamentRecords:e,tournamentRecord:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:P};let{extension:r}=no({element:t,name:bo,tournamentRecords:e,discover:!0}),i=r?.value||[];if(i.length){let{venueIds:r}=JP({requireCourts:!0,tournamentRecords:e}),{eventIds:n,drawIds:a}=eU({tournamentRecords:e}),{updatedSchedulingProfile:o,modifications:s,issues:c}=aD({schedulingProfile:i,venueIds:r,eventIds:n,drawIds:a});if(s){i=o;let r=cD({tournamentRecords:e,tournamentRecord:t,schedulingProfile:i});return r.error?r:{schedulingProfile:i,modifications:s,issues:c}}}return{schedulingProfile:i,modifications:0}}function cD({tournamentRecords:e,tournamentRecord:t,schedulingProfile:r}){let i=oD({tournamentRecords:e,schedulingProfile:r});return i.error?i:r?za({tournamentRecords:e,discover:!0,extension:{name:bo,value:r}}):Wa({element:t,name:bo,tournamentRecords:e,discover:!0})}function uD(e){let{tournamentRecord:t}=e,r=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!e.schedulingProfile){let{modifications:e,issues:i}=sD({tournamentRecords:r,tournamentRecord:t});return{success:!e,modifications:e,issues:i}}let{venueIds:i}=JP({tournamentRecords:r}),{eventIds:n,drawIds:a}=eU({tournamentRecords:r}),{updatedSchedulingProfile:o,modifications:s,issues:c}=aD({schedulingProfile:e.schedulingProfile,venueIds:i,eventIds:n,drawIds:a});return s?{...cD({schedulingProfile:o,tournamentRecords:r}),modifications:s,issues:c}:{...I,modifications:s,issues:c}}function dD(e){let{scheduleDates:t=[],tournamentRecords:r,periodLength:i=30}=e??{};if("object"!=typeof r)return{error:T};if(!Array.isArray(t))return{error:mr};if(!t.every(Zn))return{error:Xe};let n=[],a=0,o={},{schedulingProfile:s}=sD({tournamentRecords:r});if(!s)return{issues:n,...I};let{matchUps:c}=um({nextMatchUps:!0,tournamentRecords:r});for(let u of s){let{scheduleDate:e,venues:s=[]}=u;if(!t?.length||t.includes(e))for(let t of s||[])if(t){let{rounds:s}=t,u=[],{orderedMatchUpIds:d,scheduledRoundsDetails:l}=nD({tournamentRecords:r,periodLength:i,matchUps:c,rounds:s}),{matchUpDependencies:p}=Im({tournamentRecords:r,matchUps:c}),m=e=>{let t;return l?.find(((r,i)=>{let n=r.matchUpIds.includes(e);return n&&(t=i),n})),t};if(d?.forEach(((e,t)=>{let r=si(d.slice(t+1),p?.[e]?.matchUpIds||[]);r.length&&u.push({matchUpId:e,shouldBeAfter:r})})),u.length){a+=u.length;let t=u.map((({matchUpId:t,shouldBeAfter:r})=>{let i=m(t),n=Yr(r.map(m));return o[e]||(o[e]={}),o[e][i]||(o[e][i]=[]),n.forEach((t=>{o[e][i].includes(t)||o[e][i].push(t)})),{matchUpId:t,matchUpRoundIndex:i,earlierRoundIndices:n,shouldBeAfter:r}}));n.push(...t)}}}return{issuesCount:a,profileIssues:{matchUpIdShouldBeAfter:Object.assign({},...n.map((e=>{let{matchUpId:t,shouldBeAfter:r,earlierRoundIndices:i}=e;return{[t]:{earlierRoundIndices:i,shouldBeAfter:r}}})))},roundIndexShouldBeAfter:o,...I}}function lD(e){let{tournamentRecords:t,requestType:r}=e,i=xn(e,[{[tn]:!0}]);if(i.error)return i;let n={};for(let a of Object.values(t)){let{extension:e}=no({element:a,name:So}),t=e?.value||[];for(let i of t){let{personId:e,requests:t}=i||{};n[e]||(n[e]=[]);for(let i of t)r&&i.requestType!==r||n[e].push(i)}}return{personRequests:n,...I}}function pD(e){let{containerStructureId:t,roundSegment:r,isRoundRobin:i,tournamentId:n,roundNumber:a,structureId:o,eventId:s,drawId:c}=e,u=i?t:o,d=[n,s,c,u,a].join("|");return Zi({structureId:u,roundSegment:r,tournamentId:n,roundNumber:a,eventId:s,drawId:c,id:d})}function mD({round:e,matchUps:t,events:r,tournamentRecords:i}){let n=r.find((t=>t.eventId===e.eventId)),{eventType:a,category:o,categoryType:s}=n||{},{categoryName:c,ageCategoryCode:u}=o||{},d=Xr(t.map((({matchUpFormat:e})=>e))),l=0;return Object.keys(d).forEach((t=>{let r=d[t],n=iD({categoryName:c||u,tournamentId:e.tournamentId,eventId:e.eventId,tournamentRecords:i,matchUpFormat:t,categoryType:s,eventType:a});if(n.error)return n;let o=n.averageMinutes*r;isNaN(l)||(l+=o)})),{roundMinutes:l}}function fD(e){let t=e.length,r=e.filter((({sides:e})=>e?.some((({bye:e})=>e)))).length||0,i=e.filter((({winningSide:e,matchUpStatus:t})=>e||ms.includes(t))).length||0,n=e.filter((({schedule:e,matchUpStatus:t})=>e?.scheduledDate&&e?.scheduledTime&&t!==Yo)).length||0,a=t-r;return{unscheduledCount:a-n,incompleteCount:a-n,scheduledCount:n,completedCount:i,matchUpsCount:t,isScheduled:a===n,isComplete:a===i,byeCount:r}}function hD({tournamentRecords:e,schedulingProfile:t,tournamentRecord:r,withRoundId:i}){if(r&&!e){if("object"!=typeof r)return{error:T};e={[r.tournamentId]:r}}if(t){let r=oD({tournamentRecords:e,schedulingProfile:t});if(r.error)return r}if(!t&&e){let r=sD({tournamentRecords:e});if(r.error)return r;t=r.schedulingProfile}if(!t)return{error:vr};let n={};return{profileRounds:t.map((({venues:e,scheduleDate:t})=>e.map((({rounds:e})=>e.map((e=>{let r=pD(e);return r.roundSegment?.segmentsCount&&(n[r.id]=r.roundSegment.segmentsCount),Zi({id:i?r.id:void 0,scheduleDate:t,...r})})))))).flat(1/0),segmentedRounds:n}}n(rD,{getPersonRequests:()=>lD,getProfileRounds:()=>hD,getScheduledRoundsDetails:()=>nD,getSchedulingProfile:()=>sD,getSchedulingProfileIssues:()=>dD});var gD={};function ID({policyDefinitions:e,drawDefinition:t,drawSize:r,drawId:i,event:n,stage:a}){if(!n)return{error:de};let{entries:o,stageEntries:s}=bf({drawDefinition:t,drawId:i,stage:a,event:n}),c=s.length,{drawSize:u}=Lv({participantsCount:c}),d=Vv({drawSize:r??u,participantsCount:c,policyDefinitions:e});if(d.error)return en({result:d,stack:"getEntriesAndSeedsCount"});let{seedsCount:l}=d;return{entries:o,seedsCount:l,stageEntries:s}}function UD(e){let{entries:t=[],entryStatus:r,stage:i}=e;return Math.max(...t.filter((e=>!(i&&i!==e.entryStage||r&&e.entryStatus!==r||isNaN(e.entryPosition)))).map((({entryPosition:e})=>xr(e||0))),0)}n(gD,{getEntriesAndSeedsCount:()=>ID,getMaxEntryPosition:()=>UD});var vD={};function yD({tournamentRecords:e,extensionName:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:P};let r,i=[];for(let n of Object.values(e)){let{extension:e}=no({element:n,name:t});e&&!r&&(i.push({params:{extension:e,discover:!0},method:"addExtension"}),r=!0);let a=n.events??[];for(let r of a){let{eventId:e}=r,{extension:n}=no({name:t,element:r});n&&i.push({params:{eventId:e,extension:n},method:"addEventExtension"})}}return{methods:i}}function SD({tournamentRecords:e}){return yD({extensionName:To,tournamentRecords:e})}n(vD,{allCompetitionMatchUps:()=>um,allDrawMatchUps:()=>lm,allEventMatchUps:()=>sm,allTournamentMatchUps:()=>cm,analyzeMatchUp:()=>JD,calculateWinCriteria:()=>GD,checkMatchUpIsComplete:()=>Qp,competitionScheduleMatchUps:()=>_D,drawMatchUps:()=>XD,eventMatchUps:()=>FD,getAllDrawMatchUps:()=>am,getAllStructureMatchUps:()=>Kp,getCheckedInParticipantIds:()=>ml,getCompetitionMatchUps:()=>xD,getEventMatchUpFormatTiming:()=>RD,getHomeParticipantId:()=>cp,getMatchUpCompetitiveProfile:()=>xd,getMatchUpContextIds:()=>qD,getMatchUpDailyLimits:()=>LD,getMatchUpDailyLimitsUpdate:()=>ND,getMatchUpDependencies:()=>Im,getMatchUpFormat:()=>HD,getMatchUpFormatTiming:()=>Ll,getMatchUpFormatTimingUpdate:()=>SD,getMatchUpScheduleDetails:()=>up,getMatchUpType:()=>Mp,getMatchUpsStats:()=>zD,getModifiedMatchUpFormatTiming:()=>MD,getParticipantResults:()=>cI,getPredictiveAccuracy:()=>VD,getRoundMatchUps:()=>Up,getRounds:()=>QD,isValidMatchUpFormat:()=>qI,matchUpActions:()=>Ev,participantScheduledMatchUps:()=>ED,tallyParticipantResults:()=>wI,tournamentMatchUps:()=>kD,validMatchUp:()=>gp,validMatchUps:()=>Ip});var wD="ADULT",PD="JUNIOR",DD="WHEELCHAIR",TD={[ka]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[hu]:30,default:60}}]},defaultDailyLimits:{[mu]:2,[hu]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[eI],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[DD],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[wD,DD],minutes:{default:60,[hu]:30}},{categoryTypes:[PD],minutes:{default:60,[hu]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[wD,DD],minutes:{default:30}},{categoryTypes:[PD],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[wD,PD],minutes:{default:30}},{categoryTypes:[DD],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},bD=TD;function RD({tournamentRecord:e,matchUpFormats:t,categoryType:r,event:i}){if(!i)return{error:de};let n,a=[];if(t?.length){let e=[];a=t.map((t=>{let r="string"==typeof t?{matchUpFormat:t}:t;if(!e.includes(r?.matchUpFormat)&&qI({matchUpFormat:r?.matchUpFormat}))return e.push(r.matchUpFormat),r})).filter(Boolean)}else{let{policy:t}=nd({policyType:_a,tournamentRecord:e,event:i});if(t?.matchUpFormats)a=t?.matchUpFormats;else{let e,t,{extension:r}=no({name:To,element:i});({matchUpAverageTimes:e,matchUpRecoveryTimes:t}=r?.value?r.value:bD[ka]),a=Yr([...(e||[]).map((e=>e.matchUpFormatCodes)),...(t||[]).map((e=>e.matchUpFormatCodes))].flat()).map((e=>({matchUpFormat:e}))),n="default scheduling policy in use"}}let{eventType:o,eventId:s,category:c}=i,u=c?.categoryName??c?.ageCategoryCode??s;return s?Zi({eventMatchUpFormatTiming:a.map((({matchUpFormat:t,description:n})=>({matchUpFormat:t,description:n,...Ll({tournamentRecord:e,matchUpFormat:t,categoryName:u,categoryType:r,eventType:o,event:i})}))),info:n}):{error:de}}function MD(e){let t=xn(e,[{[nn]:!0},{[Mn]:e=>qI({matchUpFormat:e}),[An]:we,[on]:!0}]);if(t.error)return t;let{tournamentRecord:r,matchUpFormat:i,event:n}=e,{extension:a}=no({name:To,element:n}),o=a?.value,{extension:s}=no({element:r,name:To}),c=s?.value,u=[o?.matchUpAverageTimes&&gl({...o,matchUpFormat:i}),c?.matchUpAverageTimes&&gl({...c,matchUpFormat:i})].find((e=>e));return{matchUpFormat:i,recoveryTimes:[o?.matchUpRecoveryTimes&&Il({...o,matchUpFormat:i}),c?.matchUpRecoveryTimes&&Il({...c,matchUpFormat:i})].find((e=>e)),averageTimes:u}}function ND({tournamentRecords:e}){return yD({extensionName:Do,tournamentRecords:e})}var AD=({scheduleAttributes:e=["scheduledDate","scheduledTime"],schedule:t={}})=>!!Object.keys(t).filter((t=>e.includes(t))).filter((e=>t[e])).length;function ED({scheduleAttributes:e=["scheduledDate","scheduledTime"],matchUps:t=[]}){if(!Ip(t))return{error:Oe};if(!Array.isArray(e))return{error:mr};let r=t.filter(Boolean).filter((({schedule:t})=>AD({schedule:t,scheduleAttributes:e}))).reduce(((e,t)=>{let{schedule:r}=t,i=la(r?.scheduledDate),n=da(r?.scheduledTime);return i&&n&&(e[i]?e[i].push(t):e[i]=[t]),e}),{});return Object.keys(r).forEach((e=>{r[e].sort(((e,t)=>ha(da(e.schedule?.scheduledTime),da(t.schedule?.scheduledTime))))})),{...I,scheduledMatchUps:r}}function CD({schedulingProfile:e,matchUps:t=[]}){let r={},i=({eventId:e,drawId:t,structureId:r,roundNumber:i})=>`${e}|${t}|${r}${i}`;e?.length&&e.map((({venues:e})=>e.map((({rounds:e})=>e)))).flat().forEach((e=>{e.sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))).forEach((({eventId:e,drawId:t,structureId:n,roundNumber:a},o)=>{let s=i({eventId:e,drawId:t,structureId:n,roundNumber:a});r[s]=o}))}));let n=[],a={noScheduledDate:[]};for(let s of t){let e=s.schedule||{},t=e.scheduledDate&&la(e.scheduledDate)||e.scheduledTime&&la(e.scheduledTime)||"noScheduledDate";a[t]||(a[t]=[]),a[t].push(s)}let o=Object.keys(a).sort();for(let s of o){let e=a[s],t={noScheduledTime:[]};for(let r of e){let e=r.schedule||{},i=e.scheduledTime&&da(e.scheduledTime)||"noScheduledTime";t[i]||(t[i]=[]),t[i].push(r)}let o=Object.keys(t).sort();for(let a of o){let e=t[a];e.sort(((e,t)=>(r[i(e)]||0)-(r[i(t)]||0))),n.push(...e)}}return n}function OD({courtPrefix:e="C|",minRowsCount:t,courtsData:r}){if(!Array.isArray(r))return{error:mr};let i=r?.reduce(((e,t)=>{let r=t.matchUps||[],i=Math.max(0,...r.map((e=>e.schedule.courtOrder||0)));return i>e?i:e}),1),n=ai(0,t?Math.max(t,i):i).map((e=>({matchUps:ai(0,r.length).map((t=>{let i=r[t],{courtId:n,venueId:a}=i;return{schedule:{courtOrder:e+1,venueId:a,courtId:n}}}))})));return r.forEach(((e,t)=>{for(let r of e.matchUps){let e=r.schedule?.courtOrder;e&&(n[e-1].matchUps[t]=r)}})),{courtPrefix:e,rows:n.map(((t,r)=>Object.assign({rowId:`rowId-${r+1}`},...t.matchUps.map(((t,r)=>({[`${e}${r}`]:t}))))))}}function FD(e){let{participants:t,contextContent:r,participantMap:i}=e,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,useParticipantMap:u,tournamentRecord:d,usePublishState:l,contextFilters:p,matchUpFilters:m,contextProfile:f,nextMatchUps:h,tournamentId:g,inContext:U,context:v,event:y}=e;if(!y)return{error:de};let S,{eventId:w,eventName:P,endDate:D,eventType:T,category:b,gender:R}=y??{},M={...v,...Zi({surfaceCategory:y.surfaceCategory??d?.surfaceCategory,indoorOutDoor:y.indoorOutdoor??d?.indoorOutdoor,tournamentId:g??d?.tournamentId,endDate:D??d?.endDate,eventName:P,eventType:T,category:b,eventId:w,gender:R})};!t&&d&&({participants:t,participantMap:i,groupInfo:S}=zu({participantsProfile:o,policyDefinitions:c,useParticipantMap:u,tournamentRecord:d,contextProfile:f,inContext:U})),f&&!r&&(r=id({policyDefinitions:c,tournamentRecord:d,contextProfile:f,event:y}));let N=Wm({event:y});return{...(y.drawDefinitions??[]).reduce(((e,u)=>{let g=om({context:M,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:t,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,tournamentRecord:d,usePublishState:l,contextContent:r,contextFilters:p,matchUpFilters:m,participantMap:i,publishStatus:N,contextProfile:f,drawDefinition:u,nextMatchUps:h,inContext:U,event:y});return Object.keys(g)?.forEach((t=>{Array.isArray(g[t])&&(e[t]||(e[t]=[]),e[t]=e[t].concat(g[t]))})),e}),{}),...I,groupInfo:S}}function kD(e){if(!e?.tournamentRecord)return{error:D};let t=e.contextContent,{scheduleVisibilityFilters:r,participantsProfile:i,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:c=!0,usePublishState:u,contextFilters:d,matchUpFilters:l,contextProfile:p,nextMatchUps:m,context:f}=e,h=e.tournamentId??s.tournamentId,g=s?.events??[],{participants:I,participantMap:U,groupInfo:v}=zu({participantsProfile:i,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:c});p&&!t&&(t=id({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:y}=Yu({tournamentRecord:s}),S=d?.eventIds??[];return{...g.filter((e=>!S.includes(e.eventId))).map((e=>FD({context:{eventDrawsCount:op({event:e}).flightProfile?.flights?.length||e.drawDefinitions?.length||0,...f},tournamentAppliedPolicies:y,scheduleVisibilityFilters:r,participantsProfile:i,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:u,contextFilters:d,contextProfile:p,contextContent:t,matchUpFilters:l,participantMap:U,participants:I,tournamentId:h,nextMatchUps:m,inContext:c,event:e}))).reduce(((e,t)=>((t&&Object.keys(t).filter((e=>!["success","matchUpsMap"].includes(e))))?.forEach((r=>{Array.isArray(t[r])&&(e[r]||(e[r]=[]),e[r]=e[r].concat(t[r]),e.matchUpsCount+=t[r].length)})),e)),{matchUpsCount:0}),groupInfo:v}}function xD({scheduleVisibilityFilters:e,participantsProfile:t,tournamentRecords:r,policyDefinitions:i,usePublishState:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:c}){if("object"!=typeof r||!Object.keys(r).length)return{error:P};let u=Object.keys(r).map((u=>{let d=r[u];return kD({scheduleVisibilityFilters:e,participantsProfile:t,policyDefinitions:i,tournamentRecord:d,usePublishState:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:c})})),d={};return{...u.reduce(((e,t)=>(Object.keys(t).forEach((r=>{Array.isArray(t[r])&&(e[r]||(e[r]=[]),e[r]=e[r].concat(t[r])),"groupInfo"===r&&Object.assign(d,t[r])})),e)),{}),groupInfo:d}}function _D(e){if("object"!=typeof e?.tournamentRecords||!Object.keys(e?.tournamentRecords).length)return{error:P};let t,r,{courts:i,venues:n}=QP(e),a=sD(e).schedulingProfile,{sortDateMatchUps:o=!0,courtCompletedMatchUps:s,alwaysReturnCompleted:c,activeTournamentId:u,tournamentRecords:l,withCourtGridRows:p,minCourtGridRows:m,usePublishState:f,status:h=dl,sortCourtsData:g}=e,U=f?Vu({tournamentRecord:l[u??Gi()],itemType:`${ul}.${ll}`}).timeItem?.itemValue?.[h]:void 0,v=c?xD({...e,matchUpFilters:{...e.matchUpFilters,matchUpStatuses:[Qo]},contextFilters:e.contextFilters}).completedMatchUps:[];if(f&&(!U||!Object.keys(U).length))return{completedMatchUps:v,dateMatchUps:[],courtsData:[],venues:n};f&&({drawIds:t,detailsMap:r}=function({tournamentRecords:e}){let t=[],r={};for(let i of Object.values(e))for(let e of i.events??[]){let i=Wm({event:e}),n=i?.drawDetails;d(n)?(Object.assign(r,n),t.push(...Object.keys(n).filter((e=>Hm({drawId:e,drawDetails:n}))))):i?.drawIds?.length&&t.push(...i.drawIds)}return{drawIds:t,detailsMap:r}}({tournamentRecords:l})),t?.length&&(e.contextFilters||(e.contextFilters={}),e.contextFilters?.drawIds?e.contextFilters.drawIds=e.contextFilters.drawIds.filter((e=>t.includes(e))):e.contextFilters.drawIds=t),U?.eventIds?.length&&(e.matchUpFilters||(e.matchUpFilters={}),e.matchUpFilters?.eventIds&&e.matchUpFilters.eventIds.length?e.matchUpFilters.eventIds=e.matchUpFilters.eventIds.filter((e=>U.eventIds.includes(e))):e.matchUpFilters.eventIds=U.eventIds),U?.scheduledDates?.length&&(e.matchUpFilters||(e.matchUpFilters={}),e.matchUpFilters.scheduledDates&&e.matchUpFilters.scheduledDates.length?e.matchUpFilters.scheduledDates=e.matchUpFilters.scheduledDates.filter((e=>U.scheduledDates.includes(e))):e.matchUpFilters.scheduledDates=U.scheduledDates),c&&(e.matchUpFilters||(e.matchUpFilters={}),e.matchUpFilters?.excludeMatchUpStatuses?.length?e.matchUpFilters.excludeMatchUpStatuses.includes(Qo)||e.matchUpFilters.excludeMatchUpStatuses.push(Qo):e.matchUpFilters.excludeMatchUpStatuses=[Qo]);let{completedMatchUps:y,upcomingMatchUps:S,pendingMatchUps:w,groupInfo:D}=xD({...e,matchUpFilters:e.matchUpFilters,contextFilters:e.contextFilters}),T=[...S??[],...w??[]];r&&Object.keys(r).length&&(T=T.filter((e=>{let{drawId:t,structureId:i,stage:n}=e;if(!r[t])return!1;if(r[t].stageDetails){let e=Object.keys(r[t].stageDetails),i=e.filter((e=>!r[t].stageDetails[e].published)),a=e.filter((e=>r[t].stageDetails[e].published));return(!i.length||!i.includes(n))&&(!(!a.length||!a.includes(n))||i.length&&!i.includes(n)&&!a.length)}if(r[t].structureDetails){let e=Object.keys(r[t].structureDetails),n=e.filter((e=>!r[t].structureDetails[e].published)),a=e.filter((e=>r[t].structureDetails[e].published));return(!n.length||!n.includes(i))&&(!(!a.length||!a.includes(i))||n.length&&!n.includes(i)&&!a.length)}return!0})));let b=o?CD({matchUps:T,schedulingProfile:a}):T,R=i?.map((e=>{let t=function({courtId:e}){let t=(s?b.concat(y??[]):b).filter((t=>t.schedule?.courtId===e||t.schedule?.allocatedCourts?.map((({courtId:e})=>e)).includes(e)));return g?CD({matchUps:t,schedulingProfile:a}):t}(e);return{surfaceCategory:e?.surfaceCategory??"",matchUps:t,...e}})),M={completedMatchUps:c?v:y,dateMatchUps:b,courtsData:R,groupInfo:D,venues:n};if(p){let{rows:e,courtPrefix:t}=OD({minRowsCount:m,courtsData:R});M.courtPrefix=t,M.rows=e}return{...M,...I}}function LD({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:P};let r;return Object.keys(e).filter((e=>!t||e===t)).forEach((t=>{let i=e[t],{matchUpDailyLimits:n}=function(e){let t=xn(e,[{[nn]:!0}]);if(t.error)return t;let{tournamentRecord:r}=e,{policy:i}=nd({policyType:ka,tournamentRecord:r}),{extension:n}=no({element:r,name:Do}),a=n?.value?.dailyLimits,o=i?.defaultDailyLimits;return{matchUpDailyLimits:a||o}}({tournamentRecord:i});r=n})),{matchUpDailyLimits:r}}function VD(e){let{matchUps:t}=e,{singlesForDoubles:r,tournamentRecord:i,drawDefinition:n,excludeMargin:a,exclusionRule:o,zoneDoubling:s,matchUpType:c,scaleName:u,eventId:d,zonePct:l,drawId:p,event:m}=e;if(!i&&!t)return{error:D};if(c&&![mu,hu].includes(c))return{error:mr,info:{matchUpType:c}};if(t&&!Ip(t))return{error:mr,context:{matchUps:t}};let f=Qg[u],h=f?.ascending??e.ascending??!1,g=f?.accessor??e.valueAccessor,U=Array.isArray(f?.range)?Math.abs(f.range[0]-f.range[1]):0,v=Wr(l)&&U?(l??0)*U:e.zoneMargin??U,y={withScaleValues:!0,withCompetitiveness:!0},S={matchUpTypes:c?[c]:[mu,hu]},w=i?.participants;t?.[0]?.hasContext?p?t=t.filter((e=>e.drawId===p)):d&&(t=t.filter((e=>e.eventId===d))):void 0===t&&(t=p&&!n&&[]||!p&&d&&!m&&[]||p&&lm({inContext:!0,drawDefinition:n,contextFilters:S,contextProfile:y,participants:w})?.matchUps||!p&&d&&sm({inContext:!0,contextFilters:S,contextProfile:y,participants:w,event:m})?.matchUps||cm({tournamentRecord:i,contextFilters:S,contextProfile:y})?.matchUps||[]),c&&(t=t.filter((e=>e.matchUpType===c)));let P=t.filter((({winningSide:e,score:t,sides:r,matchUpStatus:i})=>![ns,Xo,ss,Jo,Ho].includes(i??"")&&Um({score:t})&&2===r?.length&&e)),T=function({excludeMargin:e,exclusionRule:t,valueAccessor:r,ascending:i,scaleName:n,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:a,sides:s,score:c,winningSide:d}=u;if(!d)continue;if(t&&(!t.valueAccessor||!t.range))return{info:"exclusionRule requires valueAccessor and range",error:He};let l=d-1,p=BD({exclusionRule:t,valueAccessor:r,matchUpType:a,scaleName:n,sides:s});if(t){let e=p.map((({exclusionValues:e})=>e)).flat();if(e.length){o.excluded.push({scoreString:c?.scoreStringSide1,exclusionValues:e,winningSide:d,sideValues:p});continue}}if(p.filter((e=>![void 0,"",null].includes(e.value))).length<2){o.excluded.push({scoreString:c?.scoreStringSide1,missingValues:!0,winningSide:d,sideValues:p});continue}let m=p[l].value-p[1-l].value,f=parseFloat(e||0),h=f&&Math.abs(m)<f;if(h){o.excluded.push({scoreString:c?.scoreStringSide1,excludeMargin:e,winningSide:d,excludeGap:h,sideValues:p,valuesGap:m});continue}let g=i?m:-1*m,I=1===d?c?.scoreStringSide1:c?.scoreStringSide2;g>0?o.affirmative.push({winningScoreString:I,winningSide:d,sideValues:p,valuesGap:m,score:c}):o.negative.push({winningScoreString:I,winningSide:d,sideValues:p,valuesGap:m,score:c})}let s=o.affirmative.length+o.negative.length,c=s&&o.affirmative.length/s*100;return o.percent=c?Math.round(100*c)/100:0,o}({matchUps:P,excludeMargin:a,exclusionRule:o,valueAccessor:g,ascending:h,scaleName:u}),b=!s||hl(mu)(c)?v:2*(v||0),R=v?P.map((({competitiveProfile:e,matchUpType:t,score:i,sides:n})=>{let a=BD({singlesForDoubles:r,valueAccessor:g,matchUpType:t,scaleName:u,sides:n}),o=Math.abs(a[0].value-a[1].value);return{competitiveness:e?.competitiveness,valuesGap:o,score:i}})).filter((({valuesGap:e})=>e<=b)):[],M=function({zoneData:e}){let t={[Xu]:[],[Zu]:[],[ed]:[]};for(let r of e){let{competitiveness:e,score:i,valuesGap:n}=r;t[e]&&t[e].push({score:i,valuesGap:n})}return t}({zoneData:R}),N=M&&[].concat(Object.values(M)).flat().length,A=N&&Object.assign({},...Object.keys(M).map((e=>({[e]:Math.round(1e4*M[e].length/N)/100})))),E=P.length-(R?.length||0);return{...I,relevantMatchUps:P,zoneDistribution:A,zoneData:R,accuracy:T,nonZone:E}}function BD({singlesForDoubles:e,exclusionRule:t,valueAccessor:r,matchUpType:i,scaleName:n,sides:a}){let o=t?.range.sort(),s=e=>{let r=e?.[t?.valueAccessor];return{exclude:t&&r>=o[0]&&r<=o[1],exclusionValue:r}};return a.sort(((e,t)=>e.sideNumber-t.sideNumber)).map((({participant:t})=>{let a=[],o=t?.individualParticipants;if(o?.length){let c=[],u=0;for(let t of o){let{scaleValue:o,value:d}=jD({singlesForDoubles:e,valueAccessor:r,participant:t,matchUpType:i,scaleName:n}),{exclude:l,exclusionValue:p}=s(o);l&&a.push(p),c.push(o),d&&!isNaN(u)?u+=d:u=void 0}return{participantName:t.participantName,exclusionValues:a,scaleValues:c,value:u}}if(t){let{scaleValue:o,value:c}=jD({singlesForDoubles:e,valueAccessor:r,matchUpType:i,participant:t,scaleName:n}),{exclude:u,exclusionValue:d}=s(o);return u&&a.push(d),{participantName:t.participantName,exclusionValues:a,scaleValue:o,value:c}}return{}}))}function jD({singlesForDoubles:e,valueAccessor:t,matchUpType:r,participant:i,scaleName:n}){let a=e?mu:r,o=i?.rankings?.[a]?.find((e=>e.scaleName===n)),s=(i?.ratings?.[a]?.find((e=>e.scaleName===n))||o)?.scaleValue;return{scaleValue:s,value:t?s?.[t]:s}}function GD({collectionDefinitions:e=[],collectionGroups:t=[]}){let r,i=0,{groupValueNumbers:n}=CI({collectionGroups:t});for(let a of e||[]){let{collectionValueProfiles:e,collectionGroupNumber:t,collectionValue:o,matchUpCount:s,matchUpValue:c,scoreValue:u,setValue:d}=a,l=t&&n.includes(t);if(Wr(d||u))r=!0;else{if(l)continue;if("number"==typeof o&&Wr(o))i+=o;else if(Array.isArray(e)&&e?.length)for(let t of e)i+=t.matchUpValue;else"number"==typeof c&&Wr(c)&&(i+=(s??0)*c)}}for(let a of t)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...I}:{valueGoal:Math.floor(i/2)+1,...I}}function qD({matchUps:e,matchUpId:t}){if(!Ip(e))return{error:mr};let r=e.find((e=>e.matchUpId===t)),{drawId:i,eventId:n,structureId:a,tournamentId:o}=r||{};return{matchUpId:t,drawId:i,eventId:n,structureId:a,tournamentId:o}}function $D(e,t){if(!d(e))return{error:mr};if(!Array.isArray(t))return{error:mr};let r={};for(let{param:i,error:n,attr:a}of t){let t=WD({params:e,param:i,attr:a,error:n});if(t?.error)return t;r[i]=t}return r}function WD({params:e,param:t,attr:r,error:i}){if(t===hn&&d(e.drawDefinition)&&u(e.structureId)){let t=(e.drawDefinition.structures??[]).find((({structureId:t})=>t===e.structureId));return!t.length&&i?{error:i}:{structure:t}}if(t===Sn){let t=$P({...e,...r});return t.error&&i?{...t,error:i}:t}return{error:vr,info:{param:t}}}function HD(e){let{structureId:t,matchUpId:r,event:i}=e,n=e.drawDefinition,a=xn(e,[{[nn]:!0},{[Cn]:{[un]:!1,[mn]:!1,[wn]:!1,[Dn]:!1}}]);if(a[Pn])return a;let o=$D(e,[{[Tn]:Sn,[Pn]:He}])?.matchUp;if(r&&o?.error)return o;!n&&o?.drawDefinition&&(n=o?.drawDefinition);let s=o?.structure;if(!s&&t&&!r){if(!n)return{error:H};let e=yc({drawDefinition:n,structureId:t});if(e.error)return e;s=e.structure}let c=s?.matchUpFormat,u=n?.matchUpFormat,d=i?.matchUpFormat;return{structureDefaultMatchUpFormat:c,eventDefaultMatchUpFormat:d,drawDefaultMatchUpFormat:u,matchUpFormat:o?.matchUp?.matchUpFormat||c||u||d}}function zD({profileBands:e,tournamentRecord:t,matchUps:r}){if(!Ip(r))return{error:Oe};let i=!e&&nd({policyType:Ra,tournamentRecord:t}).policy,n=e||i?.profileBands||rd[Ra].profileBands,a=r.filter((({winningSide:e})=>e)),o=a.map(Od),s=kd(o).reduce(((e,t)=>((e,t)=>(e[Cd(t,n)]+=1,e))(e,t)),{[Xu]:0,[Zu]:0,[ed]:0,[Qu]:0}),c=Object.keys(s).reduce(((e,t)=>(s[t]||0)+e),0),u=Object.keys(s).map((e=>({[e]:100*parseFloat((s[e]/c).toFixed(4))}))),d=a.filter((({matchUpStatus:e})=>e===Ju)).length;return u.push({[Ju]:100*parseFloat((d/c).toFixed(4))}),{competitiveBands:Object.assign({},...u),...I}}var{stageOrder:YD}=Ic;function KD(e,t){return e.eventName.localeCompare(t.eventName)||e.eventId.localeCompare(t.eventId)||(YD[e?.stage]||0)-(YD[t?.stage]||0)||t.matchUpsCount-e.matchUpsCount||`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`.localeCompare(`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`)}function QD({excludeScheduleDateProfileRounds:e,excludeScheduledRounds:t,excludeCompletedRounds:r,inContextMatchUps:i,tournamentRecords:n,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:c,scheduleDate:u,withRoundId:d,venueId:l,context:p}){if(i&&!Array.isArray(i||"object"!=typeof i[0]))return{error:mr,inContextMatchUps:i};if(o&&!n){if("object"!=typeof o)return{error:T};n={[o.tournamentId]:o}}let m="object"!=typeof n||!Object.keys(n).length;if((l||u||!i||!a&&(e||r||a||s))&&m)return{error:P};let f=Object.assign({},...Object.values(n??{}).map((({venues:e=[],tournamentId:t})=>({[t]:e?.map((({venueId:e})=>e))})))),h=Object.values(n??{}).map((({events:e=[],tournamentId:t,startDate:r,endDate:i})=>e.map((e=>({...e,validVenueIds:f[t],startDate:e.startDate??r,endDate:e.endDate??i}))))).flat(),{segmentedRounds:g,profileRounds:U}=n&&(e||r||a||s)&&hD({tournamentRecords:n,schedulingProfile:a})||{},v=e&&Object.assign({},...U.map((e=>({[e.id]:e})))),y=i||n&&um({tournamentRecords:n,matchUpFilters:c})?.matchUps||[],S=[],w=y&&Object.values(y.reduce(((e,t)=>{let r=pD(t).id,i=g?.[r],n=[...e[r]?.matchUps??[],t],{containerStructureId:a,stageSequence:o,structureName:s,tournamentId:c,isRoundRobin:u,matchUpType:l,roundNumber:p,roundOffset:m,structureId:f,eventName:h,roundName:I,drawName:U,eventId:v,drawId:y}=t,S=u?a:f;return{...e,[r]:{id:d?r:void 0,structureId:S,stageSequence:o,segmentsCount:i,structureName:s,tournamentId:c,matchUpType:l,roundNumber:p,roundOffset:m,eventName:h,roundName:I,drawName:U,matchUps:n,eventId:v,drawId:y}}}),{})).map((e=>{let{minFinishingSum:t,winnerFinishingPositionRange:r}=function(e){return(e||[]).reduce(((e,t)=>{let r=(t.finishingPositionRange?.winner||[]).reduce(((e,t)=>e+t),0),i=(t.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:i}:e}),{minFinishingSum:0,winnerFinishingPositionRange:""})}(e.matchUps),i=e.segmentsCount;if(i){let a=e.matchUps.length/i;return pi(e.matchUps.sort(((e,t)=>e.roundPosition-t.roundPosition)),a).map(((a,o)=>{let{unscheduledCount:s,incompleteCount:c,matchUpsCount:u,isScheduled:d,isComplete:l,byeCount:m}=fD(a),f=mD({matchUps:e.matchUps,tournamentRecords:n,events:h,round:e});return Zi({...e,...p,roundSegment:{segmentsCount:i,segmentNumber:o+1},winnerFinishingPositionRange:r,unscheduledCount:s,incompleteCount:c,minFinishingSum:t,matchUpsCount:u,isScheduled:d,roundTiming:f,isComplete:l,byeCount:m,matchUps:a})}))}let{unscheduledCount:a,incompleteCount:o,matchUpsCount:s,isScheduled:c,isComplete:u,byeCount:d}=fD(e.matchUps),l=mD({matchUps:e.matchUps,tournamentRecords:n,events:h,round:e});return Zi({...e,...p,winnerFinishingPositionRange:r,unscheduledCount:a,incompleteCount:o,minFinishingSum:t,matchUpsCount:s,isScheduled:c,roundTiming:l,isComplete:u,byeCount:d})})).flat().filter((i=>{if(e){let t=la(e),r=d?i.id:pD(i).id;if(t&&v[r]&&la(v[r].scheduleDate)===t)return!1}let{isComplete:n,isScheduled:a}=i,s=!r||!n,c=!t||!a,p=l||u?h?.find((({eventId:e})=>e===i.eventId)):void 0,m=p?.startDate??o?.startDate,f=p?.endDate??o?.endDate,g=!u||!m||new Date(u)>=new Date(m),I=!u||!f||new Date(u)<=new Date(f),U=g&&I,y=!l||p?.validVenueIds.includes(l),w=s&&c&&y&&U;return w||S.push(i),w})).sort(KD)||[];return{...I,rounds:w,excludedRounds:S}}function JD(e){let{matchUp:t,sideNumber:r,setNumber:i,isTiebreakValue:n,isPointValue:a}=e||{},{matchUpFormat:o}=e||{};if(!t)return{error:Fe};o=o||t?.matchUpFormat;let s=Op(o),c=!!t?.winningSide,u=t.score?.sets,d=u?.length,l=i&&i-1,p=!!u?.find(((e,t)=>e.setNumber===i&&t===l)),m=u?.filter((e=>e?.winningSide))||[],f=m?.length||0,h=i&&u?.slice(i)||[],g=!!(d&&i&&h?.reduce(((e,t)=>(!t||!t.side1Score&&!t.side2Score&&!t.side1TiebreakScore&&!t.side2TiebreakScore&&!t.side1PointScore&&!t.side2PointScore)&&e),!0)),I=i<=d&&u.find((e=>e.setNumber===i)),U=I&&dw({setObject:I,matchUpScoringFormat:s}),{isCompletedSet:v,sideGameScores:y,sideTiebreakScores:S}=U||{},w=!!(I&&!v&&g||i&&i===d+1&&!c),P=[1,2].includes(r),D=P?r-1:0,T=I&&P&&(!n&&!a&&void 0!==y[D]&&y[D]||n&&void 0!==S[D]&&S[D]),b=!!T,R=m?.map((e=>dw({setObject:e,matchUpScoringFormat:s}).isValidSetOutcome)).reduce(((e,t)=>e&&t),!0),M=m.reduce(((e,t)=>{let{winningSide:r}=t;return e[r-1]++,e}),[0,0]),N=t?.winningSide,A=N&&N-1,E=1-A,C=M[A],O=M[E],F=Math.max(...M),k=Xr(M)[F],{bestOf:x}=s??{},_=F===(x&&Math.ceil(x/2)||1)&&1===k&&M.indexOf(F)+1||void 0,L=C>O&&N===_;return{completedSetsHaveValidOutcomes:R,validMatchUpWinningSide:L,calculatedWinningSide:_,matchUpScoringFormat:s,validMatchUpOutcome:_&&R&&L,isLastSetWithValues:g,completedSetsCount:f,isCompletedMatchUp:c,isValidSideNumber:P,hasExistingValue:b,existingValue:T,isExistingSet:p,isActiveSet:w,...U}}function XD({participants:e,tournamentAppliedPolicies:t,scheduleVisibilityFilters:r,participantsProfile:i,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:c,contextFilters:u,contextContent:d,matchUpFilters:l,participantMap:p,publishStatus:m,contextProfile:f,drawDefinition:h,nextMatchUps:g,tournamentId:I,inContext:U,context:v,event:y}){let S,{eventId:w,eventName:P,endDate:D,eventType:T,category:b,gender:R}=y??{},M={...v,...Zi({surfaceCategory:y?.surfaceCategory??s?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??s?.indoorOutdoor,endDate:D??y?.endDate??s?.endDate,tournamentId:I??s?.tournamentId,eventName:P,eventType:T,category:b,eventId:w,gender:R})};return!e?.length&&s&&({participants:e,participantMap:p,groupInfo:S}=zu({participantsProfile:i,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:f,inContext:U})),y&&f&&!d&&(d=id({policyDefinitions:a,tournamentRecord:s,contextProfile:f,drawDefinition:h,event:y})),{...om({context:M,tournamentAppliedPolicies:t,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:i,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:c,participantMap:p,contextContent:d,contextFilters:u,matchUpFilters:l,publishStatus:m,contextProfile:f,drawDefinition:h,nextMatchUps:g,inContext:U,event:y}),groupInfo:S}}var ZD={};function eT({tournamentRecord:e,venueId:t,venueIds:r}){return e?{courts:(e.venues||[]).filter((e=>t?e.venueId===t:!r||r.includes(e.venueId))).map((e=>{let{venueId:t}=e,r=Da(e.courts||[]);return r.forEach((e=>Object.assign(e,{venueId:t}))),r})).flat()}:{error:D}}n(ZD,{getCompetitionVenues:()=>JP,getCourts:()=>eT,getVenuesAndCourts:()=>QP,publicFindVenue:()=>tp});var tT={};function rT({tournamentRecord:e,event:t}){if(!e)return{error:D};if(!t)return{error:de};let r,i,n,a=t.entries||[],o=e.participants||[],s=t.category?.categoryName||t.category?.ageCategoryCode,{eventType:c}=t,u=a.map((e=>e.participantId));return{entryScaleAttributes:o.filter((e=>u.includes(e.participantId))).map((e=>{let{participantId:t,participantName:a,name:o}=e,u={scaleType:cl,eventType:c,scaleName:s},d=jm({participant:e,scaleAttributes:u})?.scaleItem?.scaleValue;u={scaleType:sl,eventType:c,scaleName:s};let l=jm({participant:e,scaleAttributes:u})?.scaleItem?.scaleValue;u={scaleType:ol,eventType:c,scaleName:s};let p=jm({participant:e,scaleAttributes:u})?.scaleItem?.scaleValue;return r=!(!r&&!d),i=!(!i&&!l),n=!(!n&&!p),{participantId:t,participantName:a||o,seed:d,ranking:l,rating:p}})),hasSeededParticipants:r,hasRankedParticipants:i,hasRatedParticipants:n}}function iT({tournamentRecord:e,withScaleValues:t,scaleEventType:r,inContext:i,eventIds:n,drawIds:a,context:o}){if(!e)return{error:D};let{tournamentId:s}=e,c=(e.events??[]).filter((({eventId:e})=>!n||Array.isArray(n)&&n.includes(e))).map((e=>{let t=e.drawDefinitions?.map($o);if(a?.length&&!si(a,t).length)return;let r=Da(e);return i&&Object.assign(r,{tournamentId:s}),o&&Object.assign(r,o),r})).filter(Boolean),u={};if(t){let t=ef({withScaleValues:!0,tournamentRecord:e}).participantMap,i=e=>e.reduce(((e,t)=>e+parseFloat(t)),0);for(let e of c){let n=r??e.eventType,o=e.eventId;u[o]||(u[o]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let s=(e.entries??[]).filter((({entryStatus:e})=>Dd.includes(e))).map(Go),c=e=>{if(e?.ratings?.[n])for(let t of e?.ratings?.[n]??[]){let e=t.scaleName;u[o].ratings[e]||(u[o].ratings[e]=[]);let r=Qg[e]?.accessor;if(r){let i=parseFloat(t.scaleValue?.[r]);i&&u[o].ratings[e].push(i)}}if(e?.rankings?.[n])for(let t of e?.rankings?.[n]??[]){let e=t.scaleName;u[o].ranking[e]||(u[o].ranking[e]=[]),t.scaleValue&&u[o].ranking[e].push(t.scaleValue)}};for(let e of s){let r=t?.[e]?.participant;if(r?.participantType!==Tu)for(let e of r?.individualParticipantIds??[]){let r=t?.[e]?.participant;c(r)}else c(r)}let d=u[o].ratings;for(let e of Object.keys(d)){let t=d[e];if(!t.length)continue;let r=Lr(t)?.toFixed(2);u[o].ratingsStats[e]={avg:parseFloat((i(t)/t.length).toFixed(2)),median:r?parseFloat(r):void 0,max:Math.max(...t),min:Math.min(...t)}}let l=(e,r)=>{let i=t=>{if(u[o].draws?.[e]&&t?.ratings?.[n])for(let r of t?.ratings?.[n]??[]){let t=r.scaleName;u[o].draws[e]?.ratings[t]||(u[o].draws[e].ratings[t]=[]);let i=Qg[t]?.accessor;if(i){let n=parseFloat(r.scaleValue?.[i]);n&&u[o].draws[e].ratings[t].push(n)}}if(u[o].draws?.[e]&&t?.rankings?.[n])for(let r of t?.rankings?.[n]??[]){let t=r.scaleName;u[o].draws[e]?.ranking[t]||(u[o].draws[e].ranking[t]=[]);let i=r.scaleValue;i&&u[o].draws[e].ranking[t].push(i)}};for(let n of r.filter(Boolean)){let e=t?.[n]?.participant;if(e?.participantType!==Tu)for(let r of e?.individualParticipantIds??[]){let e=t?.[r]?.participant;i(e)}else i(e)}},p=[],m=e=>a?.length&&a.includes(e)||p.includes(e);for(let t of e.drawDefinitions??[]){let e=t.drawId;if(m(e))continue;let r=_m({drawDefinition:t}).assignedParticipantIds??[];u[o].draws[e]||(u[o].draws[e]={ratingsStats:{},ratings:{},ranking:{}}),p.push(e),l(e,r)}let f=op({event:e}).flightProfile;for(let e of f?.flights??[]){let t=e.drawId;m(t)||l(t,e.drawEntries.map(Go))}for(let e of p){let t=u[o].draws[e].ratings;for(let r of Object.keys(t)){let n=t[r];if(!n.length)continue;let a=Lr(n)?.toFixed(2);u[o].draws[e].ratingsStats[r]={avg:parseFloat((i(n)/n.length).toFixed(2)),median:a?parseFloat(a):void 0,max:Math.max(...n),min:Math.min(...n)}}}}}return Zi({eventScaleValues:u,events:c,...I})}function nT({tournamentRecord:e,drawDefinition:t,context:r,event:i}){if(!e)return{error:D};if(!i)return{error:de};let n=Da(i);return r&&Object.assign(n,r),Zi({drawDefinition:t&&n.drawDefinitions?.find((({drawId:e})=>t.drawId===e)),event:n})}function aT(e){let t="validateAndDeriveDrawValues",{appliedPolicies:r,policyDefinitions:i}=function(e){let{tournamentRecord:t,event:r}=e,i=Yu({tournamentRecord:t,event:r}).appliedPolicies??{},n=Da(e.policyDefinitions??{},!1,!0);return{appliedPolicies:i,policyDefinitions:n}}(e),n=function({enforceGender:e,policyDefinitions:t,appliedPolicies:r}){return e??t?.[Aa]?.participants?.enforceGender??r?.[Aa]?.participants?.enforceGender}({...e,policyDefinitions:i,appliedPolicies:r}),a=function({considerEventEntries:e=!0,drawEntries:t,eventEntries:r,qualifyingOnly:i}){return(i&&[]||oT(t)||(e?r:[])).filter((({entryStage:e})=>!e||e===Is))}(e),o=function(e){let{consideredEntries:t,appliedPolicies:r,policyDefinitions:i,enforceGender:n,participantMap:a,participants:o,event:s}=e;return s&&o&&Bv({consideredEntries:t,policyDefinitions:i,appliedPolicies:r,participantMap:a,enforceGender:n,participants:o,event:s})}({...e,consideredEntries:a,appliedPolicies:r});if(o?.error)return en({result:o,stack:t});let s=function(e){return!e.drawSize&&e.consideredEntries.length&&![Bs,Ws,js,sc,cc].includes(e.drawType??"")&&qr(e.consideredEntries.length)||e.drawSize&&xr(e.drawSize)||!1}({...e,consideredEntries:a}),c=function(e){let{policyDefinitions:t,appliedPolicies:r,enforceMinimumDrawSize:i=!0,drawSize:n}=e,a=e.drawTypeCoercion??kv({drawType:e.drawType,policyDefinitions:t,appliedPolicies:r}),o=qv({drawType:e.drawType,enforceMinimumDrawSize:i,drawTypeCoercion:a,drawSize:n});return o.error?o:{drawType:o.drawType}}({...e,appliedPolicies:r,policyDefinitions:i,drawSize:s});if(c.error)return en({result:c,stack:t});let u=c.drawType;if(isNaN(s)&&u!==Bs)return en({result:{error:W},stack:t});let d=i?.[La]??r?.[La],l=e.seedingProfile??d?.seedingProfile?.drawTypes?.[u??""]??d?.seedingProfile;e.seedingProfile&&(i[La]||(i[La]={...gP[La]}),i[La].seedingProfile=l);let p=function(e){let{tournamentRecord:t,event:r,ignoreAllowedDrawTypes:i,drawType:n}=e,a=!i&&t&&NP({tournamentRecord:t,categoryType:r?.category?.categoryType,categoryName:r?.category?.categoryName});return a?.length&&!a.includes(n)?{error:G}:{...I}}({...e,drawType:u});return p?.error?en({result:p,stack:t}):{drawSize:s,drawType:u,enforceGender:n,seedingProfile:l,appliedPolicies:r,policyDefinitions:i}}function oT(e){return e?.filter((e=>e.entryStatus&&[...Dd,hd].includes(e.entryStatus)))}function sT(e){let{voluntaryConsolation:t,tournamentRecord:r,event:i}=e,n="generateDrawDefinition",{participants:a,participantMap:o}=ef({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:r}),s=oT(i?.entries)??[],c=aT({...e,participantMap:o,participants:a,eventEntries:s});if(c.error)return en({result:c,stack:n});let{appliedPolicies:u,policyDefinitions:d,drawSize:l,drawType:p,enforceGender:m,seedingProfile:f}=c,h=i?.eventType,g=e.matchUpType??h,U=function(e){let{existingDrawDefinition:t,hydrateCollections:r,enforceGender:i,tieFormatName:n,matchUpType:a,eventType:o,isMock:s,event:c}=e,{tieFormat:u,matchUpFormat:d}=e;if(a===kl&&o===kl){let e=t?.structures?.find((({stage:e})=>e===Is))?.tieFormat;u=u||e||n&&c?.tieFormat?.tieFormatName===n&&c.tieFormat||n&&Jw({namedFormat:n,hydrateCollections:r,isMock:s,event:c})||c?.tieFormat||Jw({event:c,isMock:s,hydrateCollections:r}),d=void 0}else d||(u=void 0,c?.matchUpFormat||(d=eI));if(u){let e=QI({gender:c?.gender,enforceGender:i,tieFormat:u});if(e.error)return e}return{tieFormat:u,matchUpFormat:d}}({...e,enforceGender:m,eventType:h,matchUpType:g});if(U.error)return en({result:U,stack:n});let{matchUpFormat:v,tieFormat:y}=U;if(e.drawId&&"string"!=typeof e.drawId)return en({result:{error:mr},stack:n});let S=function(e){let t="generateOrGetExisting",r=[],i=[],n=UP(e);if(n.error)return en({result:n,stack:t});let a=n.existingDrawDefinition,o=n.drawDefinition??{},s=n.structureId,c=e.drawEntries??e.eventEntries??[],u=n.existingQualifyingPlaceholderStructureId&&Xw({...e,...n})||oP({...e,...n,entries:c});return u.error?en({result:u,stack:t}):(u.positioningReports?.length&&r.push(...u.positioningReports??[]),u.conflicts?.length&&i.push(...u.conflicts??[]),o=u.drawDefinition,s=u.structureId,{existingDrawDefinition:a,positioningReports:r,drawDefinition:o,structureId:s,conflicts:i,entries:c})}({...e,isMock:e.isMock??!0,policyDefinitions:d,tournamentRecord:r,appliedPolicies:u,matchUpFormat:v,seedingProfile:f,participants:a,eventEntries:s,matchUpType:g,tieFormat:y,drawSize:l,drawType:p,event:i});if(S.error)return en({result:S,stack:n});let{existingDrawDefinition:w,positioningReports:P,drawDefinition:D,structureId:T,conflicts:b,entries:R}=S;if(!D)return en({result:{error:mr},stack:n});let M=function(e){let{qualifyingPlaceholder:t,qualifyingProfiles:r,existingDrawDefinition:i,positioningReports:n,appliedPolicies:a,qualifyingOnly:o,drawDefinition:s,seedingProfile:c,participants:u,structureId:d,entries:l,stack:p}=e,m=t&&!r?.length&&!i,f=[];if(r){let t=(e,t)=>e.stageSequence-t.stageSequence,i=(e,t)=>e.roundTarget-t.roundTarget,d=[],m=1;r.sort(i);for(let h of r){if(!Array.isArray(h.structureProfiles))return en({info:ch("structureProfiles"),result:{error:He},stack:p});m=h.roundTarget||m;let r=h.structureProfiles?.sort(t)||[],i=1;for(let t of r){let{qualifyingRoundNumber:r,qualifyingPositions:p,seededParticipants:h,seedingScaleName:g,seedsCount:I=0,seedByRanking:U,placeByes:v,drawSize:y}=t,S=aP({...e,seedingProfile:t.seedingProfile??c,stageSequence:i,qualifyingRoundNumber:r,preparedStructureIds:d,qualifyingPositions:p,seededParticipants:h,stage:Us,seedingScaleName:g,appliedPolicies:a,drawDefinition:s,qualifyingOnly:o,seedByRanking:U,participants:u,roundTarget:m,seedsCount:I,placeByes:v,drawSize:y,entries:l});if(S.error)return S;S.structureId&&d.push(S.structureId),i+=1,S.conflicts?.length&&f.push(...S.conflicts),S.positioningReport?.length&&n.push({[Us]:S.positioningReport})}m+=1}}else if(d&&m){let e=kf({structureName:Of(Us),stage:Us}),{link:t}=yg({sourceStructureId:e.structureId,targetStructureId:d,sourceRoundNumber:0,linkType:xs});s.structures||(s.structures=[]),s.structures.push(e),s.links||(s.links=[]),s.links.push(t)}return{qualifyingConflicts:f,error:void 0}}({...e,existingDrawDefinition:w,positioningReports:P,appliedPolicies:u,drawDefinition:D,seedingProfile:f,participants:a,structureId:T,entries:R,params:e,stack:n});if(M.error)return M;let{qualifyingConflicts:N}=M;return D.drawName=e.drawName??(p&&Of(p)),l&&"object"==typeof t&&l>=4&&xf({...t,drawDefinition:D,matchUpType:g}),{existingDrawDefinition:!!w,qualifyingConflicts:N,positioningReports:P,drawDefinition:D,structureId:T,...I,conflicts:b}}function cT({scaleAttributes:e,scaledEntries:t,stageEntries:r,seedsCount:i,scaleName:n}){if(!e)return{error:He,info:"missing scaleAttributes"};let a=Object.assign({},...(t||[]).slice(0,i).map((({participantId:e},t)=>({[e]:t+1}))));n=n||e.scaleName;let o=(new Date).toISOString();return{scaleItemsWithParticipantIds:r.map((({participantId:t})=>({scaleItems:[{scaleValue:a[t],eventType:e.eventType,scaleType:Gn,scaleName:n,scaleDate:o}],participantId:t})))}}function uT({tournamentRecord:e,drawDefinition:t,policyDefinitions:r,scaleAttributes:i,scaleName:n,drawSize:a,drawId:o,event:s,stage:c,sortDescending:u,scaleSortMethod:d}){let l=ID({policyDefinitions:r,drawDefinition:t,drawSize:a,drawId:o,event:s,stage:c});if(l.error)return l;let{entries:p,seedsCount:m,stageEntries:f}=l;if(!f||!m)return{error:mr};let h=nP({tournamentRecord:e,scaleAttributes:i,scaleSortMethod:d,sortDescending:u,entries:p,stage:c}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=cT({scaleAttributes:i,scaledEntries:h,stageEntries:f,seedsCount:m,scaleName:n});return{scaleItemsWithParticipantIds:g}}n(tT,{categoryCanContain:()=>YI,getCategoryAgeDetails:()=>HI,getEvent:()=>nT,getEventProperties:()=>rT,getEventStructures:()=>Rh,getEventTimeItem:()=>Lu,getEvents:()=>iT,getFlightProfile:()=>op,getScaledEntries:()=>nP});var dT={};n(dT,{addDrawEntries:()=>cf,addEventEntries:()=>mf,addEventEntryPairs:()=>yT,destroyPairEntries:()=>Nf,destroyPairEntry:()=>Mf,getEntriesAndSeedsCount:()=>ID,getMaxEntryPosition:()=>UD,modifyEntriesStatus:()=>Bm,modifyEventEntries:()=>ST,mutate:()=>lT,promoteAlternate:()=>fT,promoteAlternates:()=>hT,query:()=>gD,removeDrawEntries:()=>IT,removeEventEntries:()=>df,setEntryPosition:()=>pT,setEntryPositions:()=>mT});var lT={};function pT({tournamentRecord:e,drawDefinition:t,participantId:r,entryPosition:i,skipRefresh:n,event:a}){if(!e)return{error:D};if(!r)return en({result:{error:It},stack:"setEntryPositions"});if(void 0!==i&&!Number.isSafeInteger(i))return{error:mr,entryPosition:i};(a?.entries||[]).forEach((e=>{e.participantId===r&&(e.entryPosition=i)})),(t?.entries||[]).forEach((e=>{e.participantId===r&&(e.entryPosition=i)}));let o=e=>{e.entries.forEach((e=>{e.entryPosition===i&&e.participantId!==r&&(e.entryPosition+=.1)}))};return n||(a?.entries&&(o(a),a.entries=Lm({entries:a.entries})),t?.entries&&(o(t),t.entries=Lm({entries:t.entries}))),{...I}}function mT({tournamentRecord:e,entryPositions:t,drawDefinition:r,event:i}){if(!e)return{error:D};if(!Array.isArray(t))return{error:mr};for(let n of t){let{participantId:t,entryPosition:a}=n,o=pT({skipRefresh:!0,tournamentRecord:e,drawDefinition:r,participantId:t,entryPosition:a,event:i});if(o.error)return o}return i?.entries&&(i.entries=Lm({entries:i.entries})),r?.entries&&(r.entries=Lm({entries:r.entries})),{...I}}function fT(e){let{participantId:t}=e;return t&&"string"!=typeof t?{error:mr,participantId:t}:hT({...e,participantIds:[t].filter(Boolean)})}function hT({tournamentRecord:e,drawDefinition:t,participantIds:r,stageSequence:i,stage:n=Is,eventId:a,event:o}){if(!e)return{error:D};if(!Array.isArray(r))return{error:mr,participantIds:r};if(!o)return{error:de};if(o){let e=gT({element:o,participantIds:r,stageSequence:i,stage:n});if(e.error)return e}if(t){let e=gT({element:t,participantIds:r,stageSequence:i,stage:n});if(e.error)return a?en({context:{drawPromotionError:e.error,drawId:t.drawId},result:{...I},stack:"promoteAlternates"}):e}return{...I}}function gT({participantIds:e,stageSequence:t,element:r,stage:i}){let n=(r.entries||[]).filter((e=>e.entryStatus===cd)),a=(r.entries||[]).filter((t=>e.includes(t.participantId))),o=n.reduce(((e,t)=>{let{entryPosition:r}=t;return isNaN(r)&&e||(!e||r<e.entryPosition)&&t||e}),void 0),s=a.length?a:[o].filter(Boolean);if(!s?.length)return{error:Nt};let c=s.filter((({entryStatus:e})=>e!==cd));if(c.length)return{error:Mt,invalidEntryStatus:c};let u=s.filter((({entryStage:e})=>e&&e!==i));if(u.length)return{error:At,invalidStage:u};let d=t&&s.filter((e=>e.stageSequence!==t));if(d?.length)return{error:Et,invalidStageSequence:d};for(let l of s){l.entryStatus=dd;let e=l?.entryPosition;isNaN(e)||r.entries.forEach((t=>{t.entryStatus===cd&&t.entryPosition>e&&(t.entryPosition=t.entryPosition-1)}));let t=Math.max(...r.entries.filter((e=>e.entryStatus===dd&&!isNaN(e.entryPosition))).map((({entryPosition:e})=>xr(e||0))),0);l.entryPosition=t||0}return{...I}}function IT({autoEntryPositions:e=!0,participantIds:t,drawDefinition:r,drawId:i,stages:n,event:a}){if(!a)return{error:de};if(!i)return{error:H};if(!t?.length)return{error:St};if(ui(_m({drawDefinition:r,stages:n}).assignedParticipantIds??[],t))return{error:Tt};let o=e=>{let r=e.participantId;return!t.includes(r)},{flightProfile:s}=op({event:a}),c=s?.flights?.find((e=>e.drawId===i));return c?.drawEntries&&(c.drawEntries=c.drawEntries.filter(o),e&&(c.drawEntries=Lm({entries:c.drawEntries}))),r?.entries&&(r.entries=r.entries.filter(o),e&&(r.entries=Lm({entries:r.entries}))),{...I}}function UT(e){let t="addParticipant",{allowDuplicateParticipantIdPairs:r,returnParticipant:i,disableNotice:n,pairOverride:a,participant:o}=e,s=e.tournamentId?e.tournamentRecords?.[e.tournamentId]:e.tournamentRecord??(e.activeTournamentId&&e.tournamentRecords?.[e.activeTournamentId]);if(!s)return{error:D};if(!o)return en({result:{error:ht},stack:t});o.participantId||(o.participantId=Jl()),s.participants||(s.participants=[]);let{participantId:c,individualParticipantIds:u}=o;if(s.participants.reduce(((e,t)=>t.participantId===c||e),!1))return{error:vt};let{participantType:d,participantRole:l}=o;if(!d||!Object.keys(Nu).includes(d))return{error:mt,participantType:d};if(!l)return{error:ft};let p=s.participants||[],m=p.filter((e=>e.participantType===Tu)).map((e=>e.participantId));if(d!==Tu&&o.person)return{error:mr,person:o.person};if(u&&!Array.isArray(u))return{error:mr,individualParticipantIds:u};if(d===Ru){if(o.person)return{error:mr,person:o.person};if(!o.individualParticipantIds)return en({result:{error:St},stack:t});if(2!==o.individualParticipantIds.length&&!a)return en({info:"PAIR must be 2 individualParticipantIds",result:{error:lt},stack:t});{let e=p.filter((e=>e.participantType===Tu)).map((e=>e.participantId));if(!Array.isArray(o.individualParticipantIds))return en({result:{error:lt},stack:t});if(!o.individualParticipantIds.reduce(((t,r)=>e.includes(r)&&t),!0))return en({result:{error:lt},stack:t})}let e=p.filter((e=>e.participantType===Ru)).map((e=>({individualParticipantIds:e.individualParticipantIds,participant:e}))),n=o.participantType===Ru&&e.find((e=>2===si(e.individualParticipantIds,o.individualParticipantIds).length));if(n&&!r)return{...I,existingParticipant:!0,participant:i&&Da(n.participant)};if(!o.participantName){let e=p.filter((e=>o.individualParticipantIds?.includes(e.participantId))),t=e.map((e=>e.person?.standardFamilyName)).filter(Boolean).join("/");1===e.length&&(t+="/Unknown"),o.participantName=t}}else if(d===Tu){if(!o.person?.standardFamilyName||!o.person?.standardGivenName)return{error:Dt};if(!o.participantName){let e=`${o.person.standardFamilyName.toUpperCase()}, ${o.person.standardGivenName}`;o.participantName=e}}else{if(!d||![Mu,bu].includes(d))return{error:mt};if(u||(o.individualParticipantIds=[]),o.individualParticipantIds?.length)for(let e of o.individualParticipantIds){if("string"!=typeof e)return en({result:{participantId:e,error:mr},stack:t});if(!m.includes(e))return en({result:{participantId:e,error:Ut},stack:t})}}return s.participants.push(o),n||ki({payload:{tournamentId:s.tournamentId,participants:[o]},topic:Rc}),Zi({participant:i&&Da(o),...I})}function vT({allowDuplicateParticipantIdPairs:e,returnParticipants:t,tournamentRecord:r,participants:i=[]}){if(!r)return{error:D};r.participants||(r.participants=[]);let n=r.participants.map((e=>e.participantId))||[];i.forEach((e=>{e.participantId||(e.participantId=Jl())}));let a=i.filter((e=>!n.includes(e.participantId))),o=i.filter((e=>n.includes(e.participantId))),s=a.filter((e=>e.participantType===Tu)),c=a.filter((e=>e.participantType!==Tu)),u=s.concat(...c),d=[];if(u.length){for(let t of u){let i=UT({allowDuplicateParticipantIdPairs:e,returnParticipant:!0,disableNotice:!0,tournamentRecord:r,participant:t});if(i.error)return i;i.success&&!i.existingParticipant&&d.push(i.participant)}d.length&&ki({topic:Rc,payload:{tournamentId:r.tournamentId,participants:d}});let i={participants:t&&Da(d),addedCount:d.length,...I};return o.length&&Object.assign(i,{notAdded:o,info:bt}),Zi(i)}return{info:"No new participants to add",addedCount:0,...I}}function yT({allowDuplicateParticipantIdPairs:e,entryStage:t=Is,entryStatus:r=cd,participantIdPairs:i=[],tournamentRecord:n,drawDefinition:a,event:o,uuids:s}){if(!n)return{error:D};if(!o)return{error:de};if(o.eventType!==hu)return{error:ue};let c=[],u=new Map;for(let g of n.participants??[]){let{participantType:e,participantId:t,person:r,individualParticipantIds:i}=g;e===Tu&&r?.sex?u.set(t,r.sex):e===Ru&&i&&c.push(i)}let d=i.filter((e=>{if(2!==e.length||!u.has(e[0])||!u.has(e[1]))return!0;if(!o.gender||o.gender===qp)return!1;let t=e.map((e=>u.get(e))),r=o.gender===$p&&(t[0]!==$p||t[1]!==$p)||o.gender===zp&&(t[0]!==zp||t[1]!==zp);return o.gender===Wp&&(t.sort(Km),(t[0]!==zp||t[1]!==$p)&&(r=!0)),r}));if(d.length)return{error:lt,invalidParticipantIdPairs:d};let l,p=i.map((e=>({participantId:s?.pop()??Jl(),participantRole:hf,individualParticipantIds:e,participantType:Ru}))),m=e?p:p.filter((e=>!c.find((t=>2===si(t,e.individualParticipantIds).length)))),f=[];if(m){let t=vT({allowDuplicateParticipantIdPairs:e,participants:m,returnParticipants:!0,tournamentRecord:n});if(t.error)return t;f=t.participants||[],l=t.info}let h=mf({participantIds:i.map((e=>{let t=f.find((t=>2===si(t.individualParticipantIds,e).length));if(t)return t;let{participant:r}=Sp({tournamentRecord:n,participantIds:e});return r})).map((e=>e.participantId)),tournamentRecord:n,drawDefinition:a,entryStatus:r,entryStage:t,event:o});return m.length&&ki({payload:{participants:m},topic:Rc}),{...h,info:l,newParticipantIds:m.map(Go)}}function ST({entryStatus:e=dd,unpairedParticipantIds:t=[],participantIdPairs:r=[],entryStage:i=Is,tournamentRecord:n,event:a}){if(!n)return{error:D};if(!a)return{error:de};let o=n.participants??[],s=o.filter((e=>e.participantType===Tu)).map((e=>e.participantId)),c=t.concat(...r).flat(1/0).filter((e=>!s.includes(e)));if(c.length)return{error:lt,invalidParticipantIds:c};let u=r.filter((e=>2!==e.length));if(u.length)return{error:lt,invalidParticipantIdPairs:u};let d=o.filter((e=>e.participantType===Ru)).map((e=>e.individualParticipantIds)),l=vT({participants:r.filter((e=>!d.find((t=>2===si(t,e).length)))).map((e=>({participantType:Ru,participantRole:hf,individualParticipantIds:e}))),tournamentRecord:n});if(l.error)return l;let p=r.map((e=>{let{participant:t}=Sp({tournamentRecord:n,participantIds:e});return t})).map((t=>({participantId:t,entryStatus:e,entryStage:i}))),m=t.map((e=>({entryStatus:Id,participantId:e,entryStage:i})));return a.entries=(a.entries??[]).filter((e=>e.entryStage===i)),a.entries=a.entries.concat(...p,...m),{...I}}n(lT,{addDrawEntries:()=>cf,addEventEntries:()=>mf,addEventEntryPairs:()=>yT,destroyPairEntries:()=>Nf,destroyPairEntry:()=>Mf,modifyEntriesStatus:()=>Bm,modifyEventEntries:()=>ST,promoteAlternate:()=>fT,promoteAlternates:()=>hT,removeDrawEntries:()=>IT,removeEventEntries:()=>df,setEntryPosition:()=>pT,setEntryPositions:()=>mT});var wT={};n(wT,{addDrawDefinition:()=>HT,addEvent:()=>rb,addFlight:()=>eb,assignSeedPositions:()=>zT,attachFlightProfile:()=>YT,categoryCanContain:()=>YI,deleteDrawDefinitions:()=>AT,deleteEvents:()=>XT,deleteFlightAndFlightDraw:()=>$T,deleteFlightProfileAndFlightDraws:()=>ET,getCategoryAgeDetails:()=>HI,getEvent:()=>nT,getEventProperties:()=>rT,getEventStructures:()=>Rh,getEventTimeItem:()=>Lu,getEvents:()=>iT,getFlightProfile:()=>op,getScaledEntries:()=>nP,modifyEvent:()=>ZT,modifyEventMatchUpFormatTiming:()=>kT,modifyPairAssignment:()=>WT,mutate:()=>PT,query:()=>tT,refreshEventDrawOrder:()=>qT,removeEventMatchUpFormatTiming:()=>xT,removeScaleValues:()=>KT,removeSeeding:()=>JT,setEventDates:()=>BT,setEventDisplay:()=>QT,setEventEndDate:()=>VT,setEventStartDate:()=>LT,updateDrawIdsOrder:()=>GT,validateCategory:()=>zI});var PT={};function DT({removePriorValues:e=!0,status:t=dl,statusObject:r,event:i}){if(!d(r))return{error:mr};let n=Wm({event:i,status:t}),a=`${ul}.${ll}`;return cg({timeItem:{itemValue:{[t]:{...n,...r}},itemType:a},removePriorValues:e,event:i})}function TT(e){let{includePositionAssignments:t,removePriorValues:r,tournamentRecord:i,status:n=dl,event:a,drawIdsToRemove:o,drawIdsToAdd:s}=e;if(!i)return{error:D};if(!a)return{error:de};let{appliedPolicies:c}=Yu({tournamentRecord:i,event:a}),u={...c,...e.policyDefinitions},d=a.drawDefinitions?.map((({drawId:e})=>e))??[],l=e.drawDetails?Object.keys(e.drawDetails):[],p=l.length?[]:e.drawIds,m=(s??[]).concat(...o??[],...p??[],...l),f=m.filter((e=>!d.includes(e)));if(f.length)return en({result:{error:A},context:{invalidDrawIds:f}});let h=Wm({event:a,status:n}),g=Object.keys(h?.drawDetails||{}).filter((e=>d.includes(e))).reduce(((e,t)=>(e[t]=h.drawDetails[t],e)),{});for(let I of d)if((!m.length||m.includes(I))&&(o?.includes(I)||p?.length&&!p.includes(I)?g[I]={...g[I],publishingDetail:{published:!1}}:(s?.includes(I)||p?.includes(I)||!p?.length)&&(g[I]={...g[I],publishingDetail:{published:!0}})),e.drawDetails?.[I]){let t=e.drawDetails[I],r=t.structureDetails??g[I].structureDetails,i=t.stageDetails??g[I].stageDetails??{},{structureIdsToRemove:n=[],structureIdsToAdd:o=[],publishingDetail:s={},stagesToRemove:c=[],stagesToAdd:u=[]}=t;if((o||u)&&(s.published=!0),g[I]={publishingDetail:s,structureDetails:r,stageDetails:i},o.length||n.length){let e=(a.drawDefinitions?.find((e=>e.drawId===I))?.structures??[]).map((({structureId:e})=>e)),t=(o??[]).concat(n??[]).filter((t=>!e.includes(t)));if(t.length)return en({result:{error:ae},context:{invalidStructureIds:t}});r=r??{};for(let i of e)n.includes(i)?r[i]={published:!1}:r[i]={published:!0};g[I].structureDetails=r}let d=(a.drawDefinitions?.find((e=>e.drawId===I))?.structures??[]).map((({stage:e})=>e));if(u.length){for(let e of u)i[e]={published:!0};for(let e of d)i[e]||(i[e]={published:!1})}if(u.length||c.length){for(let e of c)i[e]={published:!1};for(let e of d)i[e]||(i[e]={published:!0})}(u.length||c.length)&&(g[I].stageDetails=i)}DT({statusObject:{drawDetails:g},removePriorValues:r,status:n,event:a});let{topics:U}=Bi(),v=U.includes(Hc),y=v||e.returnEventData?tD({includePositionAssignments:t,usePublishState:!0,tournamentRecord:i,policyDefinitions:u,event:a})?.eventData:void 0;return v&&ki({payload:{eventData:y,tournamentId:i.tournamentId},topic:Hc}),{...I,eventData:y}}n(PT,{addDrawDefinition:()=>HT,addEvent:()=>rb,addFlight:()=>eb,assignSeedPositions:()=>zT,attachFlightProfile:()=>YT,deleteDrawDefinitions:()=>AT,deleteEvents:()=>XT,deleteFlightAndFlightDraw:()=>$T,deleteFlightProfileAndFlightDraws:()=>ET,modifyEvent:()=>ZT,modifyEventMatchUpFormatTiming:()=>kT,modifyPairAssignment:()=>WT,refreshEventDrawOrder:()=>qT,removeEventMatchUpFormatTiming:()=>xT,removeScaleValues:()=>KT,removeSeeding:()=>JT,setEventDates:()=>BT,setEventDisplay:()=>QT,setEventEndDate:()=>VT,setEventStartDate:()=>LT,updateDrawIdsOrder:()=>GT,validateCategory:()=>zI});var bT="deleteDrawDefinitions",RT="autoSchedulingAudit",MT="deleteEvents",NT={AUTO_SCHEDULING_AUDIT:RT,DELETE_EVENTS:MT,DELETE_DRAW_DEFINITIONS:bT};function AT(e){if(!e.tournamentRecord)return{error:D};let t="deleteDrawDefinitions",r=e.drawIds??[],i=e.event,{autoPublish:n=!0,tournamentRecord:a,auditData:o,eventId:s,force:c}=e,{appliedPolicies:u}=Yu({tournamentRecord:a,event:i}),d={...u,...e.policyDefinitions},l=Array.isArray(r)?r[0]:void 0;if(!i){let e=sp({tournamentRecord:a,eventId:s,drawId:l});if(e.error)return e;i=e.event}let p=[],m=[],f=[];if(!i?.drawDefinitions)return en({info:"event has no drawDefinition",result:{...I},stack:t});let h=i.drawDefinitions.map((({drawId:e})=>e));if(r.length||(r=h),r=r.filter((e=>h.includes(e))),!r.length)return en({info:"nothing to do; no matching drawIds in event.",result:{...I},stack:t});let g,U=Da(op({event:i}).flightProfile,!1,!0),v=({participantId:e,drawPosition:t,qualifier:r,bye:i})=>({bye:i,qualifier:r,drawPosition:t,participantId:e}),y=c??u?.[_a]?.allowDeletionWithScoresPresent?.drawDefinitions,S=Wm({event:i})??{},w=S.drawIds??(S.drawDetails&&Object.keys(S.drawDetails))??[],P=[],T=i.drawDefinitions.filter((e=>{if(r.includes(e.drawId)){let t=lm({event:i,drawDefinition:e})?.matchUps??[];if(t.some((({score:e})=>Um({score:e})))&&!y)return P.push(e.drawId),!0;let{drawId:r,drawType:n,drawName:c}=e,u=U?.flights?.find((t=>t.drawId===e.drawId));u&&(u.drawEntries=u.drawEntries?.filter((e=>Dd.includes(e.entryStatus)))),w.includes(r)&&(w=w.filter((e=>e!==r)),g=!0);let d=Sc({stageSequence:1,drawDefinition:e,stage:Is})?.structures?.[0],l=(d?xv({structureId:d.structureId,tournamentRecord:a,drawDefinition:e}):void 0)?.positionAssignments?.map(v),h=Sc({stage:Us,drawDefinition:e})?.structures,I=h?.length?h.map((t=>{let r=t.stageSequence;return{positionAssignments:xv({structureId:t.structureId,tournamentRecord:a,drawDefinition:e})?.positionAssignments.map(v),stageSequence:r}})):void 0,S={action:bT,payload:{drawDefinitions:[e],eventId:s??i?.eventId,auditData:o}};f.push(S),p.push(Zi({tournamentId:a.tournamentId,eventId:s??i?.eventId,qualifyingPositionAssignments:I,positionAssignments:l,auditData:o,drawType:n,drawName:c,drawId:r})),t?.forEach((({matchUpId:e})=>m.push(e)))}return!r.includes(e.drawId)}));if(P.length&&!c)return en({context:{drawIdsWithScoresPresent:P},result:{error:Nr},stack:t});if(i.drawDefinitions=T,U&&Qa({event:i,extension:{name:ho,value:U}}),uD({tournamentRecord:a}),g){let e={};for(let r of w)e[r]=S.drawDetails?.[r]??{published:!0};let t=DT({statusObject:{drawDetails:e},event:i});if(t.error)return{error:t.error}}if(f.length&&ki({topic:Ac,payload:f}),m.length&&ru({tournamentId:a?.tournamentId,matchUpIds:m}),r.forEach((e=>function({tournamentId:e,eventId:t,drawId:r}){return ki({payload:{drawId:r,tournamentId:e,eventId:t},topic:Fc,key:r}),Li({key:r}),{...I}}({drawId:e}))),function({appliedPolicies:e,event:t,deletedDrawsDetail:r,auditData:i}){if(!1===e?.audit?.[mo])return;let{extension:n}=no({name:mo,element:t}),a={...i,deletedDrawsDetail:r},o={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:mo};za({element:t,extension:o})}({appliedPolicies:u,event:i,deletedDrawsDetail:p,auditData:o}),n&&g){let e=TT({drawIdsToRemove:r,policyDefinitions:d,tournamentRecord:a,event:i});if(e.error)return{...I,info:e.error}}return{...I}}function ET({autoPublish:e=!0,tournamentRecord:t,auditData:r,event:i,force:n}){if(!t)return{error:D};if(!i)return{error:de};let{flightProfile:a}=op({event:i});if(a){let o=a.flights?.map((({drawId:e})=>e)).filter(Boolean),s=AT({eventId:i.eventId,tournamentRecord:t,autoPublish:e,auditData:r,drawIds:o,event:i,force:n});return s.error?s:eo({event:i,name:ho})}return{...I}}function CT(e){let{matchUpFormat:t,recoveryTimes:r,averageTimes:i,tournamentId:n,eventId:a}=e,o=e?.tournamentRecords??(e?.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{};if(!Object.keys(o).length)return{error:P};let s,c=Object.keys(o).filter((e=>!n||n===e));if(n&&!c.includes(n))return{error:mr};for(let u of c){let e=o[u],{event:n}=sp({tournamentRecord:e,eventId:a});a&&n&&(s=!0);let c=OT({tournamentRecord:e,event:n,matchUpFormat:t,averageTimes:i,recoveryTimes:r});if(c.error)return c}return!a||s?{...I}:{error:le}}function OT({tournamentRecord:e,recoveryTimes:t,matchUpFormat:r,averageTimes:i,event:n}){if(!e)return{error:D};if(i&&!Array.isArray(i))return{error:mr};if(t&&!Array.isArray(t))return{error:mr};let a=To;if(n){let{extension:e}=no({element:n,name:a});za({element:n,extension:{name:a,value:FT({...e?.value||{},matchUpFormat:r,averageTimes:i,recoveryTimes:t})}})}else{let{extension:n}=no({element:e,name:a});za({extension:{name:a,value:FT({...n?.value||{},matchUpFormat:r,averageTimes:i,recoveryTimes:t})},element:e})}return{...I}}function FT(e){let{matchUpRecoveryTimes:t=[],matchUpAverageTimes:r=[],matchUpFormat:i}=e,{averageTimes:n,recoveryTimes:a}=e;n=(n||[]).filter((e=>e?.categoryNames?.length||e?.categoryTypes?.length));let o=n?.length&&r.map((e=>e?.matchUpFormatCodes.includes(i)?{...e,matchUpFormatCodes:e.matchUpFormatCodes?.filter((e=>e!==i))}:e)).filter((({matchUpFormatCodes:e})=>e?.length)).concat({matchUpFormatCodes:[i],averageTimes:n});a=(a||[]).filter((e=>e?.categoryNames?.length||e?.categoryTypes?.length));let s=a?.length&&t.map((e=>e?.matchUpFormatCodes.includes(i)?{...e,matchUpFormatCodes:e.matchUpFormatCodes?.filter((e=>e!==i))}:e)).filter((({matchUpFormatCodes:e,averageTimes:t})=>e?.length||t)).concat({matchUpFormatCodes:[i],recoveryTimes:a});return{matchUpAverageTimes:o?.length&&o||r,matchUpRecoveryTimes:s?.length&&s||t}}function kT(e){let{tournamentRecord:t,recoveryMinutes:r,averageMinutes:i,matchUpFormat:n,categoryType:a,eventId:o,event:s}=e;if(!t)return{error:D};if(!qI({matchUpFormat:n}))return{error:mr};if(!s)return{error:de};let{averageTimes:c=[],recoveryTimes:u=[]}=MD({tournamentRecord:t,matchUpFormat:n,event:s}),d=s.category,l=d?.categoryName||d?.ageCategoryCode||s?.eventId,p={categoryNames:[l],minutes:{}},m={categoryNames:[l],minutes:{}},f=e=>{if(e.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!e.categoryNames?.includes(l)||(e.categoryNames=e.categoryNames.filter((e=>e!==l)),p={minutes:e.minutes,categoryNames:[l]},e.categoryNames.length))return e},h=i&&!isNaN(xr(i)),g=r&&!isNaN(xr(r)),I=c.map(f).filter((e=>e?.categoryNames?.length)),U=u.map(f).filter((e=>e?.categoryNames?.length));return h&&(Object.assign(p.minutes,{[s?.eventType||mu]:i}),I.push(p)),g&&(Object.assign(m.minutes,{[s?.eventType||mu]:r}),U.push(m)),h||g?CT({averageTimes:h&&I,recoveryTimes:g&&U,tournamentRecord:t,matchUpFormat:n,eventId:o,event:s}):{error:mr}}function xT(e){if(e.event)return _T({event:e.event});{e.tournamentRecord&&!e.tournamentRecords&&(e.tournamentRecords={[e.tournamentRecord.tournamentId]:e.tournamentRecord});let t=xn(e,[{[tn]:!0,[yn]:!0}]);if(t.error)return t;let{tournamentRecords:r,eventId:i}=e;for(let e of Object.values(r??{})){let{event:t}=sp({tournamentRecord:e,eventId:i});if(t)return _T({event:t})}}return{error:le}}function _T({event:e}){return eo({event:e,name:To})}function LT({tournamentRecord:e,event:t,startDate:r}){if(!e)return{error:D};if(!t)return{error:de};if(!Yn.test(r))return{error:Xe};let i=jT(e);if(i.error)return i;let{tournamentStartDate:n,tournamentEndDate:a}=i,o=new Date(la(r)).getTime();if(!n||!a||o<n||o>a)return{error:Xe};let s=t.endDate&&new Date(la(t.endDate)).getTime();return s&&o>s&&(t.endDate=r),t.startDate=r,{...I}}function VT({tournamentRecord:e,event:t,endDate:r}){if(!e)return{error:D};if(!t)return{error:de};if(!Yn.test(r))return{error:Xe};let i=jT(e);if(i.error)return i;let{tournamentStartDate:n,tournamentEndDate:a}=i,o=new Date(la(r)).getTime();if(!n||!a||o<n||o>a)return{error:Xe};let s=t.startDate&&new Date(la(t.startDate)).getTime();return s&&o<s&&(t.startDate=r),t.endDate=r,{...I}}function BT({tournamentRecord:e,event:t,startDate:r,endDate:i}){if(!e)return{error:D};if(!t)return{error:de};if(!r&&!i)return{error:He,info:"missing date"};if(r&&!Yn.test(r))return{error:Xe};if(i&&!Yn.test(i))return{error:Xe};if(r&&i){if(new Date(la(r)).getTime()>new Date(la(i)).getTime())return{error:mr}}if(r){let i=LT({tournamentRecord:e,event:t,startDate:r});if(i.error)return i}if(i){let r=VT({tournamentRecord:e,event:t,endDate:i});if(r.error)return r}return{...I}}function jT(e){let{startDate:t,endDate:r}=e;return Yn.test(t)&&Yn.test(r)?{tournamentStartDate:new Date(la(t)).getTime(),tournamentEndDate:new Date(la(r)).getTime()}:en({result:{error:et},context:{startDate:t,endDate:r}})}function GT({event:e,orderedDrawIdsMap:t}){if("object"!=typeof e)return{error:de};if(!t)return{error:He,info:"Missing drawIdsOrderMap"};if("object"!=typeof t)return{error:mr,info:"orderedDrawIdsMap must be an object"};let r=Object.values(t);if(!r.every((e=>!isNaN(e))))return{error:mr,info:"drawOrder must be numeric"};if(Yr(r).length!==r.length)return{error:mr,info:"drawOrder values must be unique"};if(e.drawDefinitions?.length){let r=(e.drawDefinitions||[]).map((({drawId:e})=>e)),i=Object.keys(t);if(i?.length&&si(r,i).length!==r.length)return{error:mr,info:"Missing drawIds"};e.drawDefinitions.forEach((e=>{e.drawOrder=t[e.drawId]}))}let{flightProfile:i}=op({event:e});return i?.flights?.forEach((e=>{e.flightNumber=t[e.drawId]})),{...I}}function qT({tournamentRecord:e,event:t}){if(!e)return{error:D};if(!t)return{error:de};let{flightProfile:r}=op({event:t}),i=r?.flights&&Object.assign({},...r.flights.sort(((e,t)=>e.flightNumber-t.flightNumber)).map(((e,t)=>({[e.drawId]:t+1}))))||t.drawDefinitions?.length&&Object.assign({},...t.drawDefinitions.sort(((e,t)=>e.drawOrder-t.drawOrder)).map(((e,t)=>({[e.drawId]:t+1}))))||void 0;return i?GT({event:t,orderedDrawIdsMap:i}):{...I}}function $T({autoPublish:e=!0,tournamentRecord:t,auditData:r,drawId:i,event:n,force:a}){if(!t)return{error:D};if(!i)return{error:H};if(!n)return{error:de};let{flightProfile:o}=op({event:n});if(o&&o.flights?.find((e=>e.drawId===i))){let e=o.flights.filter((e=>e.drawId!==i));Qa({event:n,extension:{name:ho,value:{...o,flights:e}}})}if(n.drawDefinitions?.find((e=>e.drawId===i))){let o=AT({drawIds:[i],eventId:n.eventId,tournamentRecord:t,autoPublish:e,auditData:r,event:n,force:a});if(o.error)return o}return qT({tournamentRecord:t,event:n})}function WT({replacementIndividualParticipantId:e,existingIndividualParticipantId:t,tournamentRecord:r,drawDefinition:i,participantId:n,event:a,uuids:o}){if(!a)return{error:de};if(a?.eventType!==Ol)return{error:ue};if(o&&!Array.isArray(o))return{error:mr};if(!r)return{error:D};if(![e,t,n].every((e=>"string"==typeof e)))return{error:It};if(!(a?.entries?.filter((({entryStatus:e})=>[Id,Ud].includes(e))).map((({participantId:e})=>e))||[]).includes(e))return{error:dt};let s=(r.participants||[]).find((e=>e.participantId===n));if(s?.participantType!==Ru)return{error:ut,participant:s};let c,u=s.individualParticipantIds,d=[e,...u.filter((e=>e!==t))],{participant:l}=Sp({participantIds:d,tournamentRecord:r});if(l)c=l.participantId;else{let e=UT({participant:{participantId:o?.pop(),participantRole:hf,individualParticipantIds:d,participantType:Ru},returnParticipant:!0,tournamentRecord:r});if(e.error)return e;c=e.participant.participantId}let{flightProfile:p}=op({event:a});if(i){let e=p?.flights?.find((({drawId:e})=>e===i.drawId));e&&(e.drawEntries=e.drawEntries.map((e=>e.participantId===n?{...e,participantId:c}:e))),i.entries=i.entries.map((e=>e.participantId===n?{...e,participantId:c}:e));for(let t of i.structures||[])if(t.positionAssignments)t.positionAssignments=t.positionAssignments.map((e=>e.participantId===n?{...e,participantId:c}:e));else if(t.structures)for(let e of t.structures)e.positionAssignments=e.positionAssignments.map((e=>e.participantId===n?{...e,participantId:c}:e))}a.entries=a.entries.map((r=>r.participantId===n&&{...r,participantId:c}||r.participantId===e&&{...r,participantId:t}||r));let m=r.events.some((({entries:e,eventId:t,drawDefinitions:r})=>a.eventId===t?r.some((({drawId:e,entries:t})=>e!==i?.drawId&&t?.find((e=>e.participantId===n)))):e?.find((e=>e.participantId===n))));if(!m){let e=Tf({addIndividualParticipantsToEvents:!1,participantIds:[n],tournamentRecord:r});if(e.error)return e}return{...I,participantOtherEntries:m,newPairParticipantId:c}}function HT(e){let{flight:t,suppressNotifications:r,modifyEventEntries:i,existingDrawCount:n,allowReplacement:a,checkEntryStatus:o,tournamentRecord:s,drawDefinition:c,event:u}=e;if(!c)return{error:M};if(!u)return{error:de};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:d,drawName:l,entries:p}=c,{entries:m}=u,f=0;if(void 0!==n&&n!==u.drawDefinitions.length)return{error:mr,info:"drawDefintions count mismatch"};let{flightProfile:h}=op({event:u}),g=t&&h?.flights?.find((e=>e.flightNumber===t.flightNumber)),U=h?.links?.find((e=>e?.target?.drawId===d))?.source?.drawId;if(U&&!u.drawDefinitions.find((e=>e.drawId===U)))return en({result:{error:M},info:{sourceDrawId:U}});if(g&&g.drawId!==c.drawId)return en({result:{error:R},info:{relevantFlight:g}});let v=p?.every((({participantId:e,entryStatus:t})=>{let r=g?.drawEntries.find((t=>t.participantId===e));return!t||r?.entryStatus===t})),y=!o||m&&p?.every((({participantId:e,entryStatus:t,entryStage:r})=>m.find((t=>t.participantId===e&&(!t.entryStage||t.entryStage===r)))?.entryStatus===t));if(g&&!v)return en({result:{error:R},context:{drawEntriesPresentInFlight:v,matchingEventEntries:y,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(i&&p?.filter(Boolean).forEach((e=>{if(e?.entryStatus&&Dd.includes(e?.entryStatus)){let t=m?.filter(Boolean).find((t=>t.participantId===e.participantId));t&&e.entryStatus&&t?.entryStatus!==e.entryStatus&&(t.entryStatus=e.entryStatus,f+=1)}})),m&&!y)return en({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:y,eventEntries:m},error:R}});let S,w=h?.flights?.map((({flightNumber:e})=>!isNaN(e)&&xr(e)))?.filter(Boolean)||[],P=u.drawDefinitions.map((({drawOrder:e})=>e&&xr(e)))?.filter(Boolean)||[],D=Math.max(0,...P,...w)+1,T=h?.flights?.find((e=>e.drawId===d));if(T){T.drawName=c.drawName,S={name:ho,value:{...h,flights:h.flights}};let e=T.flightNumber;e&&!P.includes(e)?D=e:T.flightNumber=D}else{let e=h?.flights||[];e.push({manuallyAdded:!0,flightNumber:D,drawEntries:p,drawName:l,drawId:d}),S={name:ho,value:{...h||{},flights:e}}}Qa({event:u,extension:S}),Object.assign(c,{drawOrder:D});let b=u.drawDefinitions.find((e=>e.drawId===d)),N=s?.tournamentId,A=u.eventId;if(b){if(!a)return{error:z};let e=lm({drawDefinition:b})?.matchUps?.map(qo)??[],t=lm({drawDefinition:c})?.matchUps;if(!r){e?.length&&ru({matchUpIds:e,action:"modifyDrawDefinition",tournamentId:N,eventId:A}),t?.length&&tu({matchUps:t,tournamentId:N,eventId:A}),u.drawDefinitions=u.drawDefinitions.map((e=>e.drawId===d?c:e));let r=c.structures?.map((({structureId:e})=>e));au({drawDefinition:c,tournamentId:N,structureIds:r,eventId:A})}}else if(u.drawDefinitions.push(c),!r){let{matchUps:e}=lm({drawDefinition:c,event:u});e&&tu({tournamentId:s?.tournamentId,matchUps:e}),nu({drawDefinition:c,tournamentId:N,eventId:A})}return{...I,modifiedEventEntryStatusCount:f}}function zT(e){let{provisionalPositioning:t,useExistingSeedLimit:r,tournamentRecord:i,drawDefinition:n,seedingProfile:a,structureId:o,assignments:s,drawId:c,event:u}=e,d=0;if(!s?.length)return{error:he};if(!i)return{error:D};if(!c)return{error:H};let l=Ad({provisionalPositioning:t,drawDefinition:n,structureId:o});if(l.error)return l;let{seedAssignments:p,seedLimit:m}=l,f=Object.assign({},...(p??[]).filter((e=>e.seedNumber)).map((e=>({[e.seedNumber]:e}))));s.forEach((e=>{let{seedNumber:t}=e;m&&t<=m&&(!r||f[t])&&(f[t]=e)}));let h=Object.values(f),g=h.map((e=>e?.participantId)).filter(Boolean);if(g.length!==ri(g).length)return{error:Y};for(let I of h){let e=Zf({...I,provisionalPositioning:t,tournamentRecord:i,drawDefinition:n,seedingProfile:a,structureId:o,event:u});if(e?.error)return e;e?.success&&d++}return d?{...I,modifications:d}:{error:ar}}function YT({deleteExisting:e,event:t,flightProfile:r}){let i="attachFlightProfile";if(!r)return en({result:{error:He},stack:i});if(!t)return en({result:{error:de},stack:i});let{flightProfile:n}=op({event:t});return n&&!e?en({result:{error:wr},stack:i}):t.drawDefinitions?.length?en({result:{error:N},stack:i}):(Qa({event:t,extension:{name:ho,value:r}}),{flightProfile:Da(r,!1,!0),...I})}function KT({tournamentRecord:e,scaleAttributes:t,drawDefinition:r,entryStatuses:i,drawId:n,event:a,stage:o}){if(!a)return{error:de};if(i&&!Array.isArray(i))return en({result:{error:mr},info:ch("entryStatus"),stack:"removeScaleValues"});let s=a.entries;if(n){let{flightProfile:e}=op({event:a}),t=e?.flights?.find((e=>e.drawId===n));s=t?t.drawEntries:r?.entries}return function({tournamentRecord:e,scaleAttributes:t,participantIds:r}){if(!e)return{error:D};if(!r)return{error:St};if(!t)return{error:He,info:"scaleAttributes required"};let{scaleType:i,eventType:n,scaleName:a}=t,o=[al,i,n,a].join(".");return e.participants?.forEach((e=>{r.includes(e.participantId)&&e.timeItems&&(e.timeItems=e.timeItems.filter((e=>e&&e?.itemType!==o)))})),{...I}}({tournamentRecord:e,scaleAttributes:t,participantIds:(s||[]).filter((e=>(!o||!e.entryStage||e.entryStage===o)&&(!i||i.includes(e.entryStatus)))).map(Go)})}function QT({removePriorValues:e,tournamentRecord:t,displaySettings:r,status:i=dl,event:n}){if(!t)return en({result:{error:D}});if(!n)return en({result:{error:de}});if(!d(r))return en({result:{error:He}});if(d(r.draws))for(let o of Object.keys(r.draws)){let e=r.draws[o].scheduleDetails??[];if(e.length){let t=[];for(let r of e){let e=t.find((e=>l(e.attributes,r.attributes)));e?.dates&&r.dates?e.dates.push(...r.dates):t.push(r)}r.draws[o].scheduleDetails=t}}let a=DT({statusObject:{displaySettings:r},removePriorValues:e,status:i,event:n});return a.error?a:{...I}}function JT({tournamentRecord:e,drawDefinition:t,entryStatuses:r,scaleName:i,drawId:n,event:a,stage:o}){if(!e)return{error:D};if(!a)return{error:de};return i=i||a.category?.categoryName||a.category?.ageCategoryCode,KT({tournamentRecord:e,scaleAttributes:{eventType:a.eventType,scaleType:Gn,scaleName:i},drawDefinition:t,entryStatuses:r,drawId:n,event:a,stage:o})}function XT({removePairParticipants:e,tournamentRecord:t,eventIds:r}){if(!t)return{error:D};if(!t.events)return{error:le};if(!Array.isArray(r))return{error:He,info:ch("drawIds")};let i=[],n=[],a=[],o=[];if(t.events=(t.events||[]).filter((e=>{if(r.includes(e.eventId)){let r={action:MT,payload:{events:[e]}};i.push(r),n.push({tournamentId:t.tournamentId,eventName:e.eventName,eventType:e.eventType,category:e.category,eventId:e.eventId,gender:e.gender})}let s=e.eventType===Ol?(e.entries||[]).map((({entryStatus:e,participantId:t})=>e!==Id&&t)).filter(Boolean):[],c=r.includes(e.eventId);return c?o.push(...s):a.push(...s),!c})),e){let e=o.filter((e=>!a.includes(e)));t.participants=t.participants.filter((({participantId:t})=>!e.includes(t)))}return uD({tournamentRecord:t}),i.length&&(ki({topic:Ac,payload:i}),sg({tournamentRecord:t,timeItem:{itemType:MT,itemValue:n}})),{...I}}function ZT(e){let t=xn(e,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:bn}]);if(t.error)return t;let{tournamentRecord:r,eventUpdates:i,event:n}=e,a="modifyEvent";if(i.startDate||i.endDate){let e=BT({startDate:i.startDate,endDate:i.endDate,tournamentRecord:r,event:n});if(e.error)return en({result:e,stack:a})}let o=n?.entries?.filter((({entryStatus:e})=>{let t=e;return[...Dd,cd].includes(t)})).map((({participantId:e})=>e))??[],s=o?ef({participantFilters:{participantIds:o},withIndividualParticipants:!0,tournamentRecord:r}).participants??[]:[],c=[],u=s.reduce(((e,t)=>{let r=t.person?.sex?[t.person.sex]:t.individualParticpants?.map((e=>e.person?.sex))||[];return c.push(...r),e.includes(t.participantType)?e:e.concat(t.participantType)}),[]),d=Yr(c),l=!d.length||[Wp,qp].includes(i.gender??"")||1===d.length&&d[0]===i.gender;if(i.gender&&!l)return en({context:{gender:i.gender,validGender:l},result:{error:mr},stack:a});let p=(u.includes(kl)&&[kl]||u.includes(Tu)&&[El]||u.includes(Ru)&&[Ol]||[Ol,El,kl]).includes(i.eventType??"");return i.eventType&&!p?en({context:{participantType:i.eventType,validEventType:p},result:{error:mr},stack:a}):(i.eventType&&(n.eventType=i.eventType),i.eventName&&(n.eventName=i.eventName),i.gender&&(n.gender=i.gender),{...I})}function eb({qualifyingPositions:e,drawEntries:t=[],drawName:r,drawId:i,event:n,stage:a}){let o="addFlight";if(!n)return en({result:{error:de},stack:o});if(!r)return en({result:{error:He},stack:o});if(t?.length){let e=(n.entries??[]).map(Go),r=t.map(Go);if(si(r,e).length!==r.length)return en({result:{error:mr},stack:o})}let s=op({event:n})?.flightProfile,c=s?.flights?.map((({flightNumber:e})=>!isNaN(e)&&xr(e)))?.filter(Boolean)||[],u=Math.max(0,...c)+1,d={drawId:i||Jl(),flightNumber:u,drawEntries:t,drawName:r};if(a&&(d.stage=a),e&&(d.qualifyingPositions=e),(s?.flights||[]).find((({drawId:e})=>e===d.drawId)))return en({result:{error:Sr},stack:o});let l=(s?.flights||[]).concat(d);return Qa({event:n,extension:{name:ho,value:{...s||{},flights:l}}})}var tb={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:Sw,DOMINANT_DUO_MIXED:Iw,LAVER_CUP:bw,TEAM_DOUBLES_3_AGGREGATION:pw,TIME_TENNIS_DUAL:Uw,TIME_TENNIS_PRO_CIRCUIT:gw,USTA_BREWER_CUP:vw,USTA_OZAKI_CUP:yw,USTA_COLLEGE:ww,USTA_GOLD_TEAM_CHALLENGE:lw,USTA_INTERSECTIONAL:hw,USTA_LEVEL_1:Pw,USTA_SECTION_BATTLE:fw,USTA_SOUTHERN_LEVEL_5:mw,USTA_TOC:Rw,USTA_WTT_ITT:Dw,USTA_ZONAL:Tw};function rb({suppressNotifications:e,tournamentRecord:t,internalUse:r,event:i}){if(!t)return{error:D};if(t.events||(t.events=[]),!i)return{error:de};let{startDate:n,endDate:a}=t;if(!r&&(i.entries?.length||i.drawDefinitions?.length)){let e=Zi({drawDefinitions:!!i.drawDefinitions?.length,entries:!!i.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:mr,context:e}}let o={eventType:Cl,drawDefinitions:[],entries:[],startDate:n,endDate:a,...i};if(i.eventType===xl)if(i.tieFormat){let e=QI({tieFormat:i.tieFormat});if(e.error)return e}else if(i.tieFormatName){if(!tb[i.tieFormatName])return{context:{tieFormatName:i.tieFormatName},error:mr};let e=Jw({isMock:t?.isMock,namedFormat:i.tieFormatName,event:i});o.tieFormat=e}if(o.eventId||(o.eventId=Jl()),t.events.reduce(((e,t)=>e||t.eventId===o.eventId),void 0))return{error:pe};{let r=o;if(t.events.push(r),!e){let{topics:e}=Bi();if(e.includes(bc)){let e=sm({event:i}).matchUps??[];tu({tournamentId:t?.tournamentId,eventId:i.eventId,matchUps:e})}for(let t of i.drawDefinitions||[])nu({drawDefinition:t})}return{...I,event:o}}}var ib={};n(ib,{drawMatic:()=>rP,garman:()=>mb,generateAdHocMatchUps:()=>ny,generateAdHocRounds:()=>eP,generateAndPopulatePlayoffStructures:()=>nU,generateCourts:()=>pb,generateDrawDefinition:()=>sT,generateDrawMaticRound:()=>fy,generateDrawStructuresAndLinks:()=>zv,generateDrawTypeAndModifyDrawDefinition:()=>Yv,generateFlightProfile:()=>sb,generateLineUps:()=>lb,generateQualifyingStructure:()=>Dg,generateSeedingScaleItems:()=>cT,generateVoluntaryConsolation:()=>hy,roundRobinGroups:()=>Bf});var nb="splitWaterfall",ab="splitShuttle",ob={SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:nb,SPLIT_SHUTTLE:ab};function sb(e){let{drawNameRoot:t="Flight",attachFlightProfile:r,tournamentRecord:i,scaleAttributes:n,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:c=[],flightsCount:u,splitMethod:d,uuids:l=[],event:p,stage:m}=e;if(!p)return{error:de};let f=p.entries??[],{flightProfile:h}=op({event:p});if(h&&r&&!o)return{error:wr};let g=e.scaledEntries??nP({tournamentRecord:i,scaleAttributes:n,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,U=g.map(Go),v=Qr(f.filter((({participantId:e})=>!U.includes(e))).filter((e=>(!m||!e.entryStage||e.entryStage===m)&&(!e.entryStatus||Pd.includes(e.entryStatus))))),y=g.concat(...v),S=y.length,w=pi(y,Math.ceil(S/u));function P(e){return(e||[]).map((({participantId:e,scaleValue:t})=>{let r=f.find((t=>t.participantId===e));return r?.scaleValue&&t&&(r.scaleValue=t),r})).sort(((e,t)=>e.scaleValue-t.scaleValue)).map(((e,t)=>(e.scaleValue&&(e.seedNumber=t+1),e)))}d===nb?w=gi(y,u):d===ab&&(w=gi(y,u,!0));let D={scaleAttributes:n,splitMethod:d,flights:ai(0,u).map((e=>{let r=e+1;return{flightNumber:r,drawId:l?.pop()??Jl(),drawEntries:P(w[e]),drawName:c?.length&&c[e]||`${t} ${r}`}}))};if(r){let e=YT({flightProfile:D,deleteExisting:o,event:p});return{splitEntries:wi()&&w||void 0,...e}}return{flightProfile:D,...I}}var cb="ASC",ub="DESC",db={ASC:"ASC",ASCENDING:cb,DESC:"DESC",DESCENDING:ub};function lb(e){let{tieFormat:t}=e,{useDefaultEventRanking:r,tournamentRecord:i,drawDefinition:n,scaleAccessor:a,singlesOnly:o,attach:s,event:c}=e;if(c?.eventType!==xl)return{error:ue};if(!i)return{error:D};if(!t&&!n)return{error:A};if(t=t??pp({drawDefinition:n,event:c})?.tieFormat,QI({tieFormat:t}).error)return{error:Te};if("object"!=typeof a&&!r)return{error:mr,context:{scaleAccessor:a}};let u={},d=(n?.entries??c?.entries??[]).filter((e=>e?.entryStatus===dd)).map(Go),{participants:l=[]}=ef({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:i}),p=l.filter((({participantId:e})=>d.includes(e))),m=c?.category?.categoryName??c?.category?.ageCategoryCode,{scaleName:f=m,scaleType:h=Vn,sortOrder:g,accessor:U}=a||{},v=h===Vn?"rankings":"ratings",y=(e,t)=>{let i=e[v]?.[t];if(!i&&r&&(i=e[v]?.[pu]),Array.isArray(i)){let e=i.find((e=>e.scaleName===f))?.scaleValue;if(jr(e))return e;if(U&&"object"==typeof e)return e[U]}return 0},S=(e,t,r)=>{let i=g===ub?e:t;return y(g===ub?t:e,r)-y(i,r)},w=(e,t)=>S(e,t,pu),P=(e,t)=>S(e,t,fu),T=[],b=t?.collectionDefinitions??[];for(let I of p){let e=I.individualParticipants?.sort(w)??[],t=o?e:I.individualParticipants?.sort(P)??[],r={};for(let n of b){let i=[],{collectionId:a,matchUpCount:o,matchUpType:s,gender:c}=n,u=hl(pu)(s);ai(0,o).forEach((n=>{let o=u?e:t??[],s=n+1,d=[];ai(0,u?1:2).forEach((e=>{let t=o?.find((t=>{let r=c&&([$p,zp].includes(c)&&c||c===Wp&&[$p,zp][e]);return!(r&&r!==t.person?.sex||i.includes(t.participantId))}))?.participantId;t&&(d.push(t),i.push(t),r[t]||(r[t]=[]),r[t].push({collectionPosition:s,collectionId:a}))})),u||T.push(d)}))}let i=Object.keys(r).map((e=>({collectionAssignments:r[e],participantId:e})));u[I.participantId]=i}let R=[];for(let I of T){let{participant:e}=Sp({tournamentParticipants:l,participantIds:I});if(!e){let e={individualParticipantIds:I,participantRole:hf,participantType:Ru};R.push(e)}}if(s){for(;R.length;)UT({participant:R.pop(),tournamentRecord:i});za({element:n,extension:{name:Io,value:u}})}return{...I,lineUps:u,participantsToAdd:R}}function pb(e){if(!e)return{error:He};let t=xn(e,[{dates:!1,[Mn]:e=>Array.isArray(e)&&e.every(Zn)},{uuids:!1,[Mn]:e=>Array.isArray(e)&&e.every(u)},{startTime:!1,endTime:!1,[Mn]:sa},{idPrefix:!1,namePrefix:!1,[Mn]:u},{count:!0,[Mn]:jr}]);if(t.error)return t;let{startDate:r,endDate:i}=e.tournamentRecord??{},n=e.dates||r&&i&&na(r,i)||[],a=ai(1,e.count+1).map((t=>Zi({courtId:e.uuids?.pop()??(e.idPrefix&&`${e.idPrefix}-${t}`)??Jl(),courtName:e.courtNames?.pop()??(e.namePrefix&&`${e.namePrefix} ${t}`),dateAvailability:n.map((t=>({startTime:e.startTime??"08:00",endTime:e.endTime??"20:00",date:t})))})));return{...I,courts:a}}var mb={};function fb({court:e,date:t}){let r=t&&e.dateAvailability.find((e=>wa(e.date,t))),i=e.dateAvailability.find((e=>!e.date));return r||i}function hb(e){let t=xn(e,[{courtDate:!0,_ofType:bn}]);if(t.error)return t;let{includeBookingTypes:r=[],courtDate:i}=e,n=[],a=Ia(i.startTime);(i.bookings||[]).filter((e=>!e.bookingType||!r.includes(e.bookingType))).sort(((e,t)=>ua(e.startTime).localeCompare(ua(t.startTime)))).forEach((e=>{let t={startTime:da(a.toISOString()),endTime:e.startTime};Ia(e.startTime)>a&&n.push(t),Ia(e.endTime)>a&&(a=Ia(e.endTime))}));let o={startTime:da(a.toISOString()),endTime:i.endTime};return Ia(i.endTime)>a&&n.push(o),{timeSlots:n}}function gb(e){let t=xn(e,[{periodStart:!0,date:!0},{courts:!0,_ofType:Rn}]);if(t.error)return t;let{averageMatchUpMinutes:r,includeBookingTypes:i,periodStart:n,date:a}=e,o=e.courts,s=Ia(n),c=ya(s,r),{enoughTime:u}=function({averageMatchUpMinutes:e,includeBookingTypes:t,periodStartTime:r,periodEndTime:i}){function n(t){let n=Ia(t.startTime),a=Ia(t.endTime);return!(n>r||a<i)&&Ua(r,a)>=e}return{enoughTime:e=>{let{timeSlots:r}=hb({includeBookingTypes:t,courtDate:e});return!!r?.filter(n)?.length}}}({averageMatchUpMinutes:r,includeBookingTypes:i,periodStartTime:s,periodEndTime:c});return{availableToScheduleCount:(o?.filter((e=>{if(!Array.isArray(e.dateAvailability))return!1;let t=fb({date:a,court:e});return!(!t||!u(t))}))||[]).length,...I}}function Ib(e){let{remainingScheduleTimes:t=[],clearScheduleDates:r,periodLength:i=30,scheduleDate:n,courts:a=[]}=e,{bookings:o=[]}=e;if(!Array.isArray(a)||!a.length)return{error:mr,courts:a};if(!Array.isArray(o))return{error:Ke};if(!Zn(n))return{error:Xe};r&&(Array.isArray(r)?r.includes(n)&&(o=[]):o=[]);let{courtBookings:s,unassignedBookings:c}=o.reduce(((e,t)=>{let{courtId:r}=t;return r?e.courtBookings[r]?e.courtBookings[r].push(t):e.courtBookings[r]=[t]:e.unassignedBookings.push(t),e}),{courtBookings:{},unassignedBookings:[]}),u=a.map(((e,r)=>{let{courtId:i,courtName:a}=e,o=s[i]||[],c=fb({date:n,court:e})||{},{bookings:u=[],startTime:d,endTime:l,date:p}=c;return{courtId:i,courtName:a,dateAvailability:{bookings:[t[r]&&{startTime:d,endTime:t[r]},...Da(u,!1,!0),...o].filter(Boolean),startTime:d,endTime:l,date:p}}}));c.sort(((e,t)=>ca(e.startTime)-ca(t.startTime)));let d=[];for(let l of c){let{startTime:e,endTime:t,averageMinutes:r,recoveryMinutes:n,matchUpId:a}=l,o=ca(e),s=ca(t),c=u.map((e=>{let t=e.dateAvailability,{timeSlots:r=[]}=hb({courtDate:t});return{courtName:e.courtName,courtId:e.courtId,timeSlots:r}})).flat().reduce(((e,{courtId:t,courtName:r,timeSlots:n})=>{let a;return n.find((({startTime:t,endTime:r})=>{a=ca(t)-o;let n=o>=ca(t);return s<=ca(r)&&0!==e.startDifference&&((0===a||a+i>=0)&&(void 0===e.startDifference||a<e.startDifference)||n)}))?{courtName:r,courtId:t,startDifference:a}:e}),{});if(c.courtId){let i={averageMinutes:r,recoveryMinutes:n,matchUpId:a,startTime:e,endTime:t};d.push(i),u.find((({courtId:e})=>e===c.courtId))?.dateAvailability.bookings.push(i)}else console.log({unassignedBooking:l})}return{virtualCourts:u.map((({courtId:e,courtName:t,dateAvailability:r})=>({dateAvailability:[r],courtName:t,courtId:e}))),assignedBookings:d}}function Ub({averageMatchUpMinutes:e,periodLength:t=30,recoveryMinutes:r}){let i=(e||90)+(r||0);return t>i?i:t||30}function vb(e){let{startTime:t="8:00",endTime:r="20:30",count:i=10,date:n}=e??{};return ai(0,i).map((()=>({dateAvailability:[{date:n,startTime:t,endTime:r}]})))}function yb({scheduleDate:e,startTime:t,endTime:r,courts:i}){let n=(t?"startTime":r&&"endTime")||void 0;return i.reduce(((i,a)=>{let o=fb({date:e,court:a}),s=n&&(o?.[n]||a[n]);return s&&(!i||t&&ca(s)<ca(i)||r&&ca(s)>ca(i))?s:i}),void 0)}function Sb(e){let t=xn(e,[{courts:!0,_ofType:Rn}]);if(t.error)return t;let{date:r=ea(),startTime:i="08:00",endTime:n="19:00",periodLength:a,courts:o}=e,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:c,averageMatchUpMinutes:u,clearScheduleDates:d,courtsCount:l,bookings:p}=e;a=a||Ub({averageMatchUpMinutes:u}),r=la(r),i=da(i),n=da(n);let m=0,f=0,h=0,g=0,I=0;!o&&l&&(o=vb({startTime:i,endTime:n,count:l,date:r}));let{virtualCourts:U}=Ib({remainingScheduleTimes:c,clearScheduleDates:d,scheduleDate:r,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:v}=function({averageMinutes:e,startTime:t,endTime:r,courts:i,date:n}){let a;if(t=t||yb({courts:i,scheduleDate:n,startTime:!0}),r=r||yb({courts:i,scheduleDate:n,endTime:!0}),t&&r){let o=Ia(t),s=Ia(r);for(let t of i||[]){if(!Array.isArray(t.dateAvailability))continue;let r=fb({court:t,date:n}),{timeSlots:i}=hb({courtDate:r});i?.forEach((t=>{let r=Ia(t.startTime),i=Ia(t.endTime);if(r>s||r<o||i<o)return!1;if(Ua(r,i)>=e){let e=da(r.toISOString());(!a||e<a)&&(a=e)}}))}}return{firstTimeSlotStartTime:a}}({averageMinutes:u,courts:U,startTime:i,endTime:n,date:r});s&&v&&(i=v||i);let y=ca(i),S=ca(n)-y,w=ai(0,Math.floor(S/a)+1).map((e=>{let t=function(e){let t=Math.floor(e/60),r=e-60*t;return t>23&&(t%=24),[Sa(t),Sa(r)].join(":")}(y+e*a),i=gb({courts:U??[],averageMatchUpMinutes:u,periodStart:t,date:r});if(i.error)return{error:i.error};let{availableToScheduleCount:n=0}=i,o=n>f?n-f:0;I+=e?n:0;let s=e?I/e:n,c=e?a*s/u*(e-1)+s:s,d=n?f&&c-m||o:0;m=c,f=n,h+=d;let l=xr(h)-g;return g+=l,{periodStart:t,add:l,availableToScheduleCount:n,newCourts:o,totalMatchUps:g}}));return{scheduleTimes:w.reduce(((e,t)=>{let r=ai(0,t.add).map((()=>({scheduleTime:t.periodStart})));return e.concat(...r)}),[]).flat(),timingProfile:w,totalMatchUps:g}}n(mb,{default:()=>Pb,garman:()=>wb});var wb={getCourtsAvailableAtPeriodStart:gb,generateTimeSlots:hb,getScheduleTimes:Sb,courtGenerator:vb},Pb=wb,Db={};n(Db,{isValid:()=>qI,isValidMatchUpFormat:()=>qI,parse:()=>Op,stringify:()=>LI});var Tb={};n(Tb,{allCompetitionMatchUps:()=>um,allDrawMatchUps:()=>lm,allEventMatchUps:()=>sm,allTournamentMatchUps:()=>cm,analyzeMatchUp:()=>JD,applyLineUps:()=>xR,assignMatchUpSideParticipant:()=>Rb,assignTieMatchUpParticipantId:()=>_b,bulkMatchUpStatusUpdate:()=>NR,calculateWinCriteria:()=>GD,checkInParticipant:()=>Ab,checkMatchUpIsComplete:()=>Qp,checkOutParticipant:()=>Nb,competitionScheduleMatchUps:()=>_D,disableTieAutoCalc:()=>DR,drawMatchUps:()=>XD,enableTieAutoCalc:()=>SR,eventMatchUps:()=>FD,findMatchUp:()=>qP,getAllDrawMatchUps:()=>am,getAllStructureMatchUps:()=>Kp,getCheckedInParticipantIds:()=>ml,getCompetitionMatchUps:()=>xD,getEventMatchUpFormatTiming:()=>RD,getHomeParticipantId:()=>cp,getMatchUpCompetitiveProfile:()=>xd,getMatchUpContextIds:()=>qD,getMatchUpDailyLimits:()=>LD,getMatchUpDailyLimitsUpdate:()=>ND,getMatchUpDependencies:()=>Im,getMatchUpFormat:()=>HD,getMatchUpFormatTiming:()=>Ll,getMatchUpFormatTimingUpdate:()=>SD,getMatchUpScheduleDetails:()=>up,getMatchUpType:()=>Mp,getMatchUpsStats:()=>zD,getModifiedMatchUpFormatTiming:()=>MD,getParticipantResults:()=>cI,getPredictiveAccuracy:()=>VD,getRoundMatchUps:()=>Up,getRounds:()=>QD,isValidMatchUpFormat:()=>qI,matchUpActions:()=>Ev,mutate:()=>bb,participantScheduledMatchUps:()=>ED,query:()=>vD,removeDelegatedOutcome:()=>wR,removeMatchUpSideParticipant:()=>Bb,removeTieMatchUpParticipantId:()=>Vb,replaceTieMatchUpParticipantId:()=>Ob,resetAdHocMatchUps:()=>FR,resetMatchUpLineUps:()=>bR,resetScorecard:()=>OR,resetTieFormat:()=>CR,setDelegatedOutcome:()=>ER,setMatchUpFormat:()=>TR,setMatchUpStatus:()=>MR,setOrderOfFinish:()=>kR,substituteParticipant:()=>PR,tallyParticipantResults:()=>wI,toggleParticipantCheckInState:()=>Eb,tournamentMatchUps:()=>kD,updateTieMatchUpScore:()=>rU,validMatchUp:()=>gp,validMatchUps:()=>Ip});var bb={};function Rb({tournamentRecord:e,drawDefinition:t,participantId:r,sideNumber:i,matchUpId:n,event:a}){if(r&&"string"!=typeof r)return{error:dt};if(!t)return{error:M};if(!n)return{error:Ae};let o=void 0===i;if(o&&(i=1),![1,2].includes(i))return en({result:{error:mr,context:{sideNumber:i}}});let{matchUp:s,structure:c}=bI({drawDefinition:t,matchUpId:n,event:a});if(!s)return{error:Ce};if(c?.structures||t.drawType&&t.drawType!==Bs||c?.matchUps?.find((({roundPosition:e})=>!!e)))return{error:G};if(!r&&(s?.score?.scoreStringSide1||ms.includes(s?.matchUpstatus)||s?.matchUpStatus&&[es,Zo].includes(s.matchUpStatus)))return{error:st,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map((e=>{let t=s.sides?.find((t=>t.sideNumber===e))??{sideNumber:e};return i===e?{...t,participantId:r}:t})),o)for(let e of s.sides)e.sideNumber&&(e.sideNumber=3-e.sideNumber);iu({tournamentId:e?.tournamentId,context:"assignSideParticipant",drawDefinition:t,matchUp:s})}return{...I,sidesSwapped:o}}function Mb({removePriorValues:e,tournamentRecord:t,duplicateValues:r,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:o,event:s}){let{matchUp:c}=bI({drawDefinition:i,event:s,matchUpId:a});if(!c)return{error:Ce};let u=ag({removePriorValues:e,element:c,duplicateValues:r,timeItem:o});return n||iu({tournamentId:t?.tournamentId,eventId:s?.eventId,context:"addTimeItem",drawDefinition:i,matchUp:c}),u}function Nb(e){let t=xn(e,[{[nn]:!0},{[an]:!0},{[sn]:!0},{[mn]:!0}]);if(t.error)return t;let r=$D(e,[{[Tn]:Sn,attr:{[fn]:!0}}]);if(r.error)return r;let{tournamentRecord:i,drawDefinition:n,participantId:a,matchUpId:o}=e,s=r?.matchUp?.matchUp,{matchUpStatus:c,score:u}=s??{};if(c&&fs.includes(c)||c&&ms.includes(c)||Um({score:u}))return{error:J};let d=ml({matchUp:s});if(d?.error)return d;let{checkedInParticipantIds:l,allRelevantParticipantIds:p}=d??{};if(!p?.includes(a))return{error:dt};if(!l?.includes(a))return{error:Pt};let m=_d({matchUp:s});if(m?.error)return m;let{sideParticipantIds:f,nestedIndividualParticipantIds:h}=m??{},g=f?.indexOf(a);return void 0!==g&&[0,1].includes(g)&&(h?.[g]??[]).forEach((e=>{Mb({drawDefinition:n,matchUpId:o,timeItem:{itemType:Vd,itemValue:e}})})),Mb({tournamentRecord:i,drawDefinition:n,matchUpId:o,timeItem:{itemValue:a,itemType:Vd}}),{...I,checkedOut:!0}}function Ab(e){let t=xn(e,[{[nn]:!0},{[an]:!0},{[sn]:!0},{[mn]:!0}]);if(t[Pn])return t;let r=$D(e,[{[Tn]:Sn,attr:{[fn]:!0}}]);if(r[Pn])return r;let{tournamentRecord:i,drawDefinition:n,participantId:a,matchUpId:o}=e,s=ml({matchUp:r?.matchUp?.matchUp});if(s?.error)return s;let{checkedInParticipantIds:c,allRelevantParticipantIds:u}=s??{};if(!u?.includes(a))return{[Pn]:dt};let d={...I,checkedIn:!0};return c?.includes(a)||Mb({tournamentRecord:i,drawDefinition:n,matchUpId:o,timeItem:{itemValue:a,itemType:Ld}}),d}function Eb(e){let t=xn(e,[{[sn]:!0,[an]:!0,[mn]:!0}]);if(t.error)return t;let r=e.tournamentId??e.activeTournamentId,i=e.tournamentRecord??(r&&e.tournamentRecords?.[r]);if(!i)return{error:D};let n=$D(e,[{[Tn]:Sn,attr:{[fn]:!0},[Pn]:Ce}]).matchUp?.matchUp;if(!n)return{error:Ce};let{checkedInParticipantIds:a=[]}=ml({matchUp:n}),{participantId:o,matchUpId:s,drawDefinition:c}=e;return o&&a.includes(o)?Nb({tournamentRecord:i,drawDefinition:c,participantId:o,matchUpId:s,matchUp:n}):Ab({tournamentRecord:i,drawDefinition:c,participantId:o,matchUpId:s,matchUp:n})}function Cb({tournamentRecord:e,drawDefinition:t,tieMatchUpId:r,event:i}){if(!e)return{error:D};if(!t)return{error:H};if(!i)return{error:le};let n=mp({drawDefinition:t}),{matchUp:a}=bI({matchUpId:r,drawDefinition:t,matchUpsMap:n});if(!a)return{error:Ce};let{matchUp:o,structure:s}=bI({tournamentParticipants:e.participants,matchUpId:r,inContext:!0,drawDefinition:t,matchUpsMap:n,event:i});if(!o)return{error:Ce};let{collectionPosition:c,drawPositions:u,collectionId:d,matchUpTieId:l,matchUpType:p}=o;if(p&&!Bp([mu,hu],p))return{error:ke};let{positionAssignments:m}=Pc({structure:s}),f=m?.filter((e=>u?.includes(e.drawPosition))),{matchUp:h}=bI({matchUpId:l,drawDefinition:t,matchUpsMap:n}),g=[...h?.sides?.map(Go)??[],...f?.map(Go)??[]],{participants:U}=ef({tournamentRecord:e,participantFilters:{participantTypes:[Mu],participantIds:g}}),{matchUp:v}=bI({matchUpId:l,inContext:!0,drawDefinition:t,matchUpsMap:n}),y=pp({matchUp:h,drawDefinition:t,structure:s,event:i})?.tieFormat;return{inContextDualMatchUp:v,inContextTieMatchUp:o,relevantAssignments:f,collectionPosition:c,teamParticipants:U,collectionId:d,matchUpType:p,dualMatchUp:h,tieMatchUp:a,tieFormat:y,structure:s,...I}}function Ob(e){let t=Cb(e);if(t.error)return t;let r="replaceTieMatchUpParticipantid",{existingParticipantId:i,tournamentRecord:n,newParticipantId:a,drawDefinition:o,substitution:s,event:c}=e;if(!i||!a)return en({result:{error:It},stack:r});if(i===a)return{...I};let{inContextDualMatchUp:u,inContextTieMatchUp:d,collectionPosition:l,collectionId:p,dualMatchUp:m,tieMatchUp:f,tieFormat:h}=t,g=d?.matchUpType,U=d?.sides?.find((e=>e.participant?.participantId===i||e.participant?.individualParticipantIds?.includes(i)));if(!U)return{error:Ut};let v=ef({tournamentRecord:n,participantFilters:{participantIds:[i,a]}})?.participants??[];if(2!==v.length)return en({result:{error:It},stack:r});if(v[0].participantType!==v[1].participantType)return en({result:{error:mt},stack:r});let{appliedPolicies:y}=Yu({tournamentRecord:n,drawDefinition:o,event:c}),S=e.policyDefinitions?.[Aa]??y?.[Aa]??pf[Aa],w=v.find((({participantId:e})=>e===a));if(!1!==(e.enforceGender??S?.participants?.enforceGender)&&[$p,zp].includes(d?.gender)&&d?.gender!==w?.person?.sex)return{error:ut,info:"Gender mismatch"};let P=S?.processCodes?.substitution;XI({tournamentId:n.tournamentId,eventId:c.eventId,inContextDualMatchUp:u,drawDefinition:o,dualMatchUp:m});let D=m?.sides?.find((({sideNumber:e})=>e===U.sideNumber));if(!D)return en({result:{sideNumber:U.sideNumber,existingParticipantId:i,error:vr},stack:r});if(d?.sides?.flatMap((e=>e.participant?.individualParticipantIds||e.participant?.participantId||[]))?.includes(a))return en({result:{error:bt},stack:r});let T=u?.sides?.find((({sideNumber:e})=>e===U.sideNumber))?.participantId,b=D.lineUp,R=b?.find((({participantId:e})=>a===e)),M=b?.reduce(((e,t)=>t.substitutionOrder>e?t.substitutionOrder:e),0),N=b?.map((e=>{let t=Da(e,!1,!0);if(![i,a].includes(t.participantId))return t;if(!s&&[i,a].includes(t.participantId)&&(t.collectionAssignments=t.collectionAssignments?.filter((e=>!(e.collectionPosition===l&&e.collectionId===p)))),s&&i===t.participantId&&(t.collectionAssignments=t.collectionAssignments.map((e=>e.collectionPosition===l&&e.collectionId===p&&void 0===e.substitutionOrder?{...e,substitutionOrder:M}:e))),t.participantId===a){t.collectionAssignments||(t.collectionAssignments=[]);let e={collectionId:p,collectionPosition:l};s&&(e.previousParticipantId=i,e.substitutionOrder=(M??0)+1),t.collectionAssignments.push(e)}return t}))??[];if(!R){let e={collectionId:p,collectionPosition:l};s&&(e.substitutionOrder=(M??0)+1,e.previousParticipantId=i);let t={collectionAssignments:[e],participantId:a};N.push(t)}let A,E,C=g===hu,{assignedParticipantIds:O}=yp({lineUp:b,collectionPosition:l,collectionId:p}),{assignedParticipantIds:F}=yp({lineUp:N,collectionPosition:l,collectionId:p});if(D.lineUp=N,T&&h){let e=dh({participantId:T,lineUp:N,drawDefinition:o,tieFormat:h});if(e.error)return en({result:e,stack:r})}else console.log("team participantId not found");if(C){let{tournamentRecord:t}=e,i=Sp({participantIds:F,tournamentRecord:t});if(!i.participant){let e=UT({returnParticipant:!0,pairOverride:!0,tournamentRecord:t,participant:{participantRole:hf,individualParticipantIds:F,participantType:Ru}});if(e.error)return en({result:e,stack:r});A=e.participant?.participantId}i=Sp({participantIds:O,tournamentRecord:t});let n=i.participant?.participantId;n&&Tf({participantIds:[n],tournamentRecord:t}).success&&(E=n)}if(s||1===U.substitutions?.length){if(s)P&&f&&(f.processCodes=Yr([...f?.processCodes??[],...P]));else for(let e of P||[]){let t=f?.processCodes?.lastIndexOf(e);void 0!==t&&f?.processCodes?.splice(t,1)}f&&iu({tournamentId:n?.tournamentId,matchUp:f,context:r,drawDefinition:o})}return m&&iu({tournamentId:n?.tournamentId,matchUp:m,context:r,drawDefinition:o}),{...I,modifiedLineUp:N,participantRemoved:E,participantAdded:A}}function Fb({collectionPosition:e,teamParticipantId:t,dualMatchUpSide:r,drawDefinition:i,participantIds:n,collectionId:a}){if(!a||!e||!Array.isArray(n))return{modifiedLineUp:r?.lineUp||[],error:mr};let o=r?.lineUp||wp({participantId:t,drawDefinition:i})?.lineUp,s=[],c=[];return{modifiedLineUp:o?.map((t=>{if(!n.includes(t.participantId))return t;let r=t.collectionAssignments?.filter((r=>{let i=r.collectionId===a&&r.collectionPosition===e;return i&&(r.previousParticipantId&&s.push(r.previousParticipantId),c.push({participantId:t.participantId,...r})),!i}));return{participantId:t.participantId,collectionAssignments:r}})).filter(Boolean)||[],assignmentsRemoved:c,previousParticipantIds:s}}function kb({individualParticipantIds:e,groupingParticipantId:t,removeFromOtherTeams:r,tournamentRecord:i}){let n="addIndividualParticipantIds";if(!i)return en({result:{error:D},stack:n});if(!t||!e)return en({result:{error:He},stack:n});let a=i.participants??[],o=a.find((e=>e.participantId===t));if(!o)return en({result:{error:Ut},stack:n});if(o?.participantType&&![Mu,bu].includes(o.participantType))return en({context:{participantType:o.participantType},result:{error:mt},stack:n});let s=e.filter((e=>a.find((t=>t.participantId===e))?.participantType!==Tu));if(s.length)return en({result:{error:lt,invalidParticipantIds:s},stack:n});o.individualParticipantIds||(o.individualParticipantIds=[]);let c=o.individualParticipantIds,u=e.filter((e=>!c.includes(e)));u.length&&(r&&Df({individualParticipantIds:u,tournamentRecord:i}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:d}=Bi();if(d.includes(Bc)){let e=a.find((({participantId:e})=>e===t));ki({topic:Bc,payload:{participants:[e]}})}return function({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:r}){let i=(r.events||[]).filter((e=>e?.eventType===kl&&e?.entries?.some((e=>e.participantId===t)))),n=t=>!e.includes(t.participantId);for(let a of i){a.entries=(a.entries||[]).filter(n);let{flightProfile:e}=op({event:a});e?.flights?.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter(n)})),a?.drawDefinitions?.forEach((e=>{e.entries=(e.entries||[]).filter(n)}))}}({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:i}),{groupingParticipant:Da(o,!1,!0),added:u.length,...I}}function xb(e){let{updateParticipantName:t=!0,groupingParticipantId:r,removeFromOtherTeams:i,tournamentRecord:n,pairOverride:a,participant:o}=e;if(!n)return{error:D};if(!o)return{error:ht};if(!o.participantId)return UT({tournamentRecord:n,participant:o});let{participant:s}=Fu({participantId:o.participantId,tournamentRecord:n});if(!s)return UT({tournamentRecord:n,participant:o});let{participantRoleResponsibilties:c,individualParticipantIds:u,participantOtherName:d,participantName:l,participantRole:p,participantType:m,onlineResources:f,contacts:h,person:g}=o;if(m&&s.participantType!==m)return{error:ot};let U={};if(h&&(U.contacts=h),f&&(U.onlineResources=f),l&&"string"==typeof l&&(U.participantName=l),d&&"string"==typeof d&&(U.participantOtherName=d),Array.isArray(u)){let{participants:e}=ef({participantFilters:{participantTypes:[Tu]},tournamentRecord:n}),r=e?.map(Go);if(r){let i=u.filter((e=>"string"==typeof e&&r.includes(e)));([bu,Iu].includes(m||s.participantType)||m===Ru&&(2===i.length||a))&&(U.individualParticipantIds=i),s.participantType===Nu.PAIR&&t&&(U.participantName=function({individualParticipants:e,newValues:t}){let r=t.individualParticipantIds,i=e.filter((({participantId:e})=>r.includes(e))).map((({person:e})=>e?.standardFamilyName)).filter(Boolean).sort().join("/");return 1===r.length&&(i+="/Unknown"),i}({individualParticipants:e,newValues:U}))}}return Object.keys(Sf).includes(p)&&(U.participantRole=p),Object.keys(Nu).includes(m)&&(U.participantType=m),Array.isArray(c)&&(U.participantRoleResponsibilties=c),s.participantType===Nu.INDIVIDUAL&&g&&function({updateParticipantName:e,existingParticipant:t,newValues:r,person:i}){let n,a={},{standardFamilyName:o,standardGivenName:s,nationalityCode:c,personId:u,sex:d}=i;if(d&&Object.keys(Yp).includes(d)&&(a.sex=d),u&&"string"==typeof u&&(a.personId=u),c&&"string"==typeof c&&(function(e){return Cu.flatMap((({iso:e,ioc:t})=>[e,t])).filter(Boolean).includes(e)}(c)||""===c)&&(a.nationalityCode=c),o&&"string"==typeof o&&o.length>1&&(a.standardFamilyName=o,n=!0),s&&"string"==typeof s&&s.length>1&&(a.standardGivenName=s,n=!0),n&&e){let e=`${a.standardGivenName} ${a.standardFamilyName}`;r.participantName=e}Object.assign(t.person,a)}({updateParticipantName:t,existingParticipant:s,newValues:U,person:g}),Object.assign(s,Zi(U)),r&&kb({individualParticipantIds:[s.participantId],groupingParticipantId:r,removeFromOtherTeams:i,tournamentRecord:n}),ki({topic:Bc,payload:{tournamentId:n.tournamentId,participants:[s]}}),{participant:Da(s),...I}}function _b(e){let t=Cb(e);if(t.error)return t;let r="assignTieMatchUpParticipantId",i=e.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:o,event:s}=e;if(!o)return en({result:{error:It},stack:r});if(e.sideNumber&&![1,2].includes(e.sideNumber))return en({result:{error:qe},stack:r});let{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:d,collectionPosition:l,teamParticipants:p,collectionId:m,matchUpType:f,dualMatchUp:h,tieFormat:g}=t;if(u?.sides?.flatMap((e=>e.participant?.individualParticipantIds||e.participant?.participantId||[]))?.includes(o))return en({result:{...I},stack:r});i=i??(e.sideNumber?c?.sides?.find((t=>t.sideNumber===e.sideNumber))?.participantId:void 0);let U=ef({participantFilters:{participantIds:[o]},tournamentRecord:n})?.participants?.[0];if(!U)return en({result:{error:Ut},stack:r});let{appliedPolicies:v}=Yu({tournamentRecord:n,drawDefinition:a,event:s}),y=e.policyDefinitions?.[Aa]??v?.[Aa]??pf[Aa];if(!1!==(e.enforceGender??y?.participants?.enforceGender)&&[$p,zp].includes(u?.gender)&&u?.gender!==U.person?.sex)return{error:ut,info:"Gender mismatch"};let{individualParticipantIds:S,participantType:w}=U;if(hl(mu)(f)&&w!==Tu)return{error:mt};let P=w===Tu?[o]:S,D=i&&p?.find((({participantId:e})=>e===i))||p?.find((({individualParticipantIds:e})=>ui(P,e)));if(!D)return{error:hr};if(i||(i=D.participantId),!i)return{error:Ut};let T=d?.find((e=>e.participantId===D?.participantId))?.drawPosition,b=h?.sides?.find((e=>e.participantId===i))?.sideNumber,R=u?.sides?.find((e=>T&&e.drawPosition===T))?.sideNumber,M=b??R??e.sideNumber;if(!g)return{error:Ne};if(!g.collectionDefinitions?.find((e=>e.collectionId===m)))return{error:Me};XI({tournamentId:n.tournamentId,eventId:s.eventId,inContextDualMatchUp:c,drawDefinition:a,dualMatchUp:h});let N=h?.sides?.find((e=>e.sideNumber===M)),A=u?.sides?.find((e=>e.sideNumber===M)),E=(N?.lineUp??wp({participantId:i,drawDefinition:a})?.lineUp)?.filter((e=>e.collectionAssignments?.find((e=>e.collectionPosition===l&&e.collectionId===m&&!e.previousParticipantId))))?.map((e=>e?.participantId)),C=E?.length>1&&E||(w===Ru?U.individualParticipantIds:[o]),O=Fb({collectionPosition:l,teamParticipantId:i,dualMatchUpSide:N,drawDefinition:a,participantIds:C,collectionId:m});if(O.error)return en({result:O,stack:r});let F,{modifiedLineUp:k}=O;if(f===hu){if(w!==Ru){let e=Lb({collectionPosition:l,teamParticipantId:i,drawDefinition:a,modifiedLineUp:k,participantId:o,collectionId:m,tieFormat:g});if(e?.error)return en({result:e,stack:r});if(e=function({side:e}){let t;if(e.participant){let r=e.participant.individualParticipantIds||[];if(1===r.filter(Boolean).length){let{participant:e}=Sp({participantIds:r,tournamentRecord:n});r.push(o);let{participant:i}=Sp({participantIds:r,tournamentRecord:n});if(!i&&e){e.individualParticipantIds=r;let t=xb({pairOverride:!0,tournamentRecord:n,participant:e});if(t.error)return t}else t=e?.participantId}}else{let e=UT({participant:{individualParticipantIds:[o],participantRole:hf,participantType:Ru},pairOverride:!0,tournamentRecord:n});if(e.error)return e}return{...I,deletedParticipantId:t}}({side:A}),e.error)return e;F=e.deletedParticipantId,N&&(N.lineUp=k),h&&iu({tournamentId:n?.tournamentId,matchUp:h,context:r,drawDefinition:a})}else if(w===Ru)for(let I of C)Lb({collectionPosition:l,teamParticipantId:i,drawDefinition:a,modifiedLineUp:k,participantId:I,collectionId:m,tieFormat:g})}else{let e=Lb({collectionPosition:l,teamParticipantId:i,drawDefinition:a,modifiedLineUp:k,participantId:o,collectionId:m,tieFormat:g});if(e?.error)return e}if(N&&(N.lineUp=k),h&&iu({tournamentId:n?.tournamentId,matchUp:h,context:r,drawDefinition:a}),F){let{error:e}=Tf({participantIds:[F],tournamentRecord:n});e&&console.log("cleanup")}return{...I,modifiedLineUp:k}}function Lb({collectionPosition:e,teamParticipantId:t,drawDefinition:r,modifiedLineUp:i,participantId:n,collectionId:a,tieFormat:o}){let s=wp({participantId:t,drawDefinition:r})?.lineUp,c=(i||s)?.find((e=>e?.participantId===n)),u={collectionId:a,collectionPosition:e};if(c)c.collectionAssignments.push(u);else{let e={collectionAssignments:[u],participantId:n};i.push(e)}return dh({participantId:t,lineUp:i,drawDefinition:r,tieFormat:o})}function Vb(e){let{tournamentRecord:t,drawDefinition:r,participantId:i,event:n}=e,a="removeTieMatchUpParticiapantId";if(!i)return en({result:{error:It},stack:a});let o=Cb(e);if(o.error)return o;let{appliedPolicies:s}=Yu({tournamentRecord:t,drawDefinition:r,event:n}),c=(e.policyDefinitions?.[Aa]??s?.[Aa]??pf[Aa])?.processCodes?.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:d,relevantAssignments:l,collectionPosition:p,teamParticipants:m,collectionId:f,matchUpType:h,dualMatchUp:g,tieMatchUp:U,tieFormat:v}=o;if(!g)return en({result:{error:Fe},stack:a});let y=d?.sides?.find((e=>e.participant?.participantId===i||e.participant?.individualParticipantIds?.includes(i)));if(!y)return en({result:{error:Ut},stack:a});if(!y.substitutions?.length&&(Um({score:d?.score})||d?.winningSide))return en({result:{error:Pr},stack:a});let S=u?.sides?.find((({sideNumber:e})=>e===y.sideNumber))?.participantId;if(!S)return en({result:{error:Ut},stack:a});let w=ef({participantFilters:{participantIds:[i]},tournamentRecord:t})?.participants?.[0];if(!w)return en({result:{error:Ut},stack:a});if(h===mu&&w.participantType===Ru)return en({result:{error:ut},stack:a});let P=w.participantType===Tu?[i]:w.individualParticipantIds;XI({tournamentId:t.tournamentId,eventId:n.eventId,inContextDualMatchUp:u,drawDefinition:r,dualMatchUp:g});let D=g.sides?.find((({sideNumber:e})=>e===y.sideNumber));if(!D&&(g.sides?.filter((({lineUp:e})=>!e)).length||0)<2){let e=m?.map((({participantId:e})=>({drawPosition:l?.find((t=>t.participantId===e))?.drawPosition,teamParticipantId:e})));D=g.sides?.find((t=>e?.find((({drawPosition:e})=>e===t.drawPosition))?.teamParticipantId===S))}if(!D)return en({result:{error:Ut,context:{participantId:i}}});let{modifiedLineUp:T,previousParticipantIds:b}=Fb({collectionPosition:p,teamParticipantId:S,dualMatchUpSide:D,participantIds:P,drawDefinition:r,collectionId:f});if(D.lineUp=T,S&&v&&dh({participantId:S,lineUp:T,drawDefinition:r,tieFormat:v}),h===hu&&w.participantType===Tu){let e=d?.sides?.find((e=>e.sideNumber===D?.sideNumber)),{participantId:r}=e??{},n=r&&ef({participantFilters:{participantIds:[r]},tournamentRecord:t,withDraws:!0})?.participants?.[0];if(!n)return en({result:{error:Ut},stack:a});{let e=n?.individualParticipantIds?.filter((e=>e!==i))??[];if(b&&e.push(...b),e.length>2)return en({result:{error:lt},stack:a});if(n.draws?.length){if(1===e.length){let{participant:r}=Sp({participantIds:e,tournamentRecord:t});if(!r){let r=UT({participant:{participantRole:hf,individualParticipantIds:e,participantType:Ru},pairOverride:!0,tournamentRecord:t});if(r.error)return en({result:r,stack:a})}}}else if(e.length){n.individualParticipantIds=e;let r=xb({participant:n,pairOverride:!0,tournamentRecord:t});if(r.error)return en({result:r,stack:a})}else{let e=Tf({participantIds:[r],tournamentRecord:t});e.error&&console.log("cleanup",{result:e})}}}if(1===y.substitutions?.length&&!d?.sides?.find((e=>e.sideNumber!==y.sideNumber))?.substitutions?.length&&U?.processCodes?.length){for(let e of c||[]){let t=U.processCodes.lastIndexOf(e);U.processCodes.splice(t,1)}iu({tournamentId:t?.tournamentId,matchUp:U,context:a,drawDefinition:r})}return iu({tournamentId:t?.tournamentId,matchUp:g,context:a,drawDefinition:r}),{...I,modifiedLineUp:T}}function Bb(e){let t=xn(e,[{[nn]:!0,[an]:!0,[mn]:!0}]);if(t.error)return t;let{drawDefinition:r,sideNumber:i,matchUpId:n,event:a}=e;if(i&&![1,2].includes(i))return{error:mr,sideNumber:i};let{matchUp:o,structure:s}=bI({drawDefinition:r,matchUpId:n,event:a});return o?Tp({structure:s})?(o.sides?.forEach((e=>{(!i||e.sideNumber===i)&&delete e.participantId})),iu({tournamentId:e.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:r,matchUp:o}),{...I}):{error:G}:{error:Ce}}function jb({inContextDrawMatchUps:e,positionAssignments:t,sourceMatchUpStatus:r,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:c,matchUp:u,event:d}){if(s){let t=e.find((({matchUpId:e})=>u.matchUpId===e)).sides?.find((e=>e.drawPosition===i))?.sideNumber,r=u.sides?.find((e=>e.sideNumber===t));r&&delete r.lineUp}u.drawPositions=(u.drawPositions||[]).map((e=>e===i?void 0:e)).filter(Boolean);let l=t.filter((({drawPosition:e})=>u.drawPositions?.includes(e))).filter((e=>e.bye)).length;return u.matchUpStatus=l&&Yo||[Xo,ss].includes(u.matchUpStatus)&&u.matchUpStatus||os,[ss,Xo].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&ih({inContextDrawMatchUps:e,sourceMatchUpStatus:r,sourceMatchUpId:a,matchUpsMap:c,matchUp:u}),iu({tournamentId:n?.tournamentId,eventId:d?.eventId,context:`removeSubsequentDrawPosition-${i}`,drawDefinition:o,matchUp:u}),{...I}}function Gb(e){let{dualWinningSideChange:t,inContextDrawMatchUps:r,tournamentRecord:i,drawDefinition:n,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:c,matchUpId:u,structure:d,event:l}=e,p=!!e.matchUp.collectionId,m=Tp({structure:d}),{drawPositions:f,winningSide:h}=c.matchUp||{};if(!m&&!f)return{error:L};let g,{targetLinks:{loserTargetLink:U,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:S,winnerMatchUp:w,byeMatchUp:P}}=c,D=AI({...e,matchUpStatus:a||os,removeWinningSide:!0});if(D.error)return D;if(p){let{matchUpTieId:r,matchUpsMap:a}=e;if(g=rU({appliedPolicies:e.appliedPolicies,matchUpId:r,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:l}),!t&&!g.removeWinningSide)return{...I}}if(m)return{...I};let{matchUps:T}=Kp({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:o,structure:d}),{positionAssignments:b}=Dc({structure:d}),R=h-1,M=1-R,N=f[R],A=f[M],{winnerParticipantId:E,loserParticipantId:C}=b?.reduce(((e,t)=>(t.drawPosition===A&&(e.loserParticipantId=t.participantId),t.drawPosition===N&&(e.winnerParticipantId=t.participantId),e)),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},O=T.filter((e=>e.drawPositions?.includes(A)));if(w&&qb({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:r,winningDrawPosition:N,winnerParticipantId:E,tournamentRecord:i,winnerTargetLink:v,drawDefinition:n,winnerMatchUp:w,dualMatchUp:s,matchUpsMap:o}),S){let{winnerHadMatchUpStatus:e}=function({matchUpStatuses:e=[Yo,ss,Xo],drawPositionMatchUps:t,loserDrawPosition:r,sourceMatchUps:i}){let n=t?.reduce(((e,t)=>!e||t.roundNumber>e.roundNumber?t:e),void 0),a=n?.drawPositions?.find((e=>e!==r)),o=i.filter((e=>e?.drawPositions?.includes(a))).map((e=>e.matchUpStatus)),s=i.filter((e=>e?.drawPositions?.includes(r))).map((e=>e.matchUpStatus));return{sourceMatchUp:n,winnerHadMatchUpStatus:ui(o||[],e),winnerMatchUpStatuses:o,loserHadMatchUpStatus:ui(s||[],e),loserMatchUpStatuses:s}}({drawPositionMatchUps:O,loserDrawPosition:A,sourceMatchUps:T}),t=U.linkCondition===Vs;if(e&&t){$b({targetLink:U,inContextDrawMatchUps:r,drawDefinition:n,drawPosition:Math.min(...S.drawPositions),matchUpsMap:o,event:l})}let c=function({sourceMatchUpStatus:e,loserParticipantId:t,tournamentRecord:r,loserTargetLink:i,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:c,event:u}){let d="removeDirectedLoser",l=i.target.structureId,{structure:p}=yc({drawDefinition:a,structureId:l});if(!p)return{error:ae};let{positionAssignments:m}=Dc({structure:p}),f=m?.find((e=>e.participantId===t))?.drawPosition;if(m?.forEach((e=>{e.participantId===t&&delete e.participantId})),p.seedAssignments=(p.seedAssignments??[]).filter((e=>e.participantId!==t)),c){let e=o?.sides.reduce(((e,t,r)=>t.drawPosition===f?r:e),void 0),t=s?.drawMatchUps?.find((({matchUpId:e})=>e===o.matchUpId)),i=t?.sides?.[e];i&&(delete i.lineUp,iu({tournamentId:r?.tournamentId,eventId:u?.eventId,matchUp:t,context:d,drawDefinition:a}))}return{...I}}({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:C,tournamentRecord:i,loserTargetLink:U,drawDefinition:n,loserMatchUp:S,dualMatchUp:s,matchUpsMap:o,event:l});if(c.error)return c}if(P){$b({sourceMatchUpId:u,targetLink:y,inContextDrawMatchUps:r,drawDefinition:n,drawPosition:Math.min(...P.drawPositions),matchUpsMap:o,event:l})}return{...I,...g&&{tieMatchUpResult:g}}}function qb({inContextDrawMatchUps:e,winningDrawPosition:t,sourceMatchUpStatus:r,winnerParticipantId:i,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:c,matchUpsMap:u,dualMatchUp:d,event:l}){let{structureId:p,roundNumber:m}=c;if(a){let e=a.target.structureId,{structure:t}=yc({drawDefinition:s,structureId:e});if(!t)return{error:ae};let{positionAssignments:r}=Dc({structure:t});t.seedAssignments=(t.seedAssignments??[]).filter((e=>e.participantId!==i));let o=r?.find((e=>e.participantId===i))?.drawPosition,{matchUps:d}=Kp({drawDefinition:s,structure:t,event:l}),p=Xr(d.map((e=>e.drawPositions)).flat(1/0).filter(Boolean));if(1===(o?p[o]:void 0))r?.forEach((e=>{e.participantId===i&&delete e.participantId}));else{let e=d.filter((({drawPositions:e})=>e.includes(o)));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:e,winnerTargetLink:a})}let m=u?.drawMatchUps?.find((({matchUpId:e})=>e===c.matchUpId));m&&iu({tournamentId:n?.tournamentId,eventId:l?.eventId,matchUp:m,context:"removeDirectedWinner",drawDefinition:s})}return m&&function({inContextDrawMatchUps:e,sourceMatchUpStatus:t,targetDrawPosition:r,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:c,matchUpsMap:u,event:d}){let{structure:l}=yc({drawDefinition:a,structureId:o});if(l?.structureType===Es)return{...I};u=u??mp({drawDefinition:a});let p=(u?.mappedMatchUps||{})[o].matchUps,{initialRoundNumber:m}=Pm({drawPosition:r,matchUps:p}),f=p?.filter((e=>e.roundNumber>=c&&e.roundNumber!==m&&e.drawPositions?.includes(r))),{positionAssignments:h}=Pc({drawDefinition:a,structureId:o});for(let g of f??[])jb({inContextDrawMatchUps:e,sourceMatchUpStatus:t,positionAssignments:h,targetDrawPosition:r,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:g,event:d})}({targetDrawPosition:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:d,matchUpsMap:u,roundNumber:m,structureId:p}),{...I}}function $b({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,matchUpsMap:n,targetLink:a,event:o}){return Fm({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,matchUpsMap:n,drawPosition:i,structureId:a.target.structureId,event:o}),{...I}}function Wb(e){let{tournamentRecord:t,appliedPolicies:r,drawDefinition:i,matchUpsMap:n,targetData:a,structure:o,event:s}=e,c="doubleExitAdvancement";if(o.structureType===Es)return en({result:{...I},stack:c});let{matchUp:u,targetMatchUps:d,targetLinks:l}=a,{loserMatchUp:p,winnerMatchUp:m,loserTargetDrawPosition:f}=d;if(p&&p.matchUpStatus!==Yo){let{loserTargetLink:a}=l;if(r?.progression?.doubleExitPropagateBye){let e=zb({loserTargetDrawPosition:f,tournamentRecord:t,loserTargetLink:a,drawDefinition:i,loserMatchUp:p,matchUpsMap:n,event:s});if(e.error)return en({result:e,stack:c})}else{let{feedRound:r,drawPositions:i,matchUpId:n}=p,a=r?2:2-i.indexOf(f),o=Hb({...e,targetMatchUp:p,walkoverWinningSide:a,tournamentRecord:t,sourceMatchUp:u,matchUpId:n});if(o.error)return en({result:o,stack:c})}}if(m){let r=Hb({...e,matchUpId:m.matchUpId,targetMatchUp:m,tournamentRecord:t,sourceMatchUp:u});if(r.error)return en({result:r,stack:c})}return en({result:{...I},stack:c})}function Hb(e){let{inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:i,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o}=e,s=i.structures.find((({structureId:e})=>e===a.structureId)),c=e.matchUpStatus===Zo?Zo:es,u=e.matchUpStatus===Zo?Xo:ss,d="conditionallyAdvanceDrawPosition",l=o.drawMatchUps.find((e=>e.matchUpId===a.matchUpId));if(!l)return{error:Fe};let p=n?.drawPositions||[],m=l.drawPositions?.filter(Boolean),f=n?.structureId===a.structureId;if(f&&ui(p,m)&&(m=m.filter((e=>!p.includes(e)))),f&&m.length>1)return en({result:{error:F},stack:d});let{pairedPreviousMatchUpIsDoubleExit:h,pairedPreviousMatchUp:g}=th(e),U=tm({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:i}),{targetMatchUps:v,targetLinks:y}=U,{loserTargetDrawPosition:S,winnerMatchUp:w,loserMatchUp:P}=v;if(P){let{loserTargetLink:e}=y,t=zb({loserTargetDrawPosition:S,loserMatchUp:P,tournamentRecord:r,loserTargetLink:e,drawDefinition:i,matchUpsMap:o});if(t.error)return en({result:t,stack:d})}let D,T=l.drawPositions?.filter(Boolean)||[],b=1===T.length,R=e.walkoverWinningSide||b&&nh({drawPosition:T[0],matchUpId:a.matchUpId,inContextDrawMatchUps:t})||void 0,M=[ss,Xo].includes(l.matchUpStatus)&&!T.length,N=1===l.finishingRound,A=M&&!N?c:u,E=t.find((e=>e.matchUpId===g.matchUpId)),C=[];n&&(n?.structureId===E?.structureId?D=n.roundPosition<g?.roundPosition?1:2:a.feedRound?D=n.structureId===a.structureId?2:1:R&&(D=3-R));let O=e.matchUpStatus,k=g?.matchUpStatus;1===D?C=[{matchUpStatus:Yb(O),previousMatchUpStatus:O,sideNumber:1},{matchUpStatus:Yb(k),previousMatchUpStatus:k,sideNumber:2}]:2===D&&(C=[{matchUpStatus:Yb(k),previousMatchUpStatus:k,sideNumber:1},{matchUpStatus:Yb(O),previousMatchUpStatus:O,sideNumber:2}]),C.length&&(C=C.map((e=>Zi(e))));let x=AI({...e,winningSide:R,matchUp:l,matchUpStatusCodes:C,context:d,matchUpStatus:A});if(x.error)return en({result:x,stack:d});if(M)return Wb({...e,matchUpStatus:A,targetData:U});if(!w)return en({result:{...I},stack:d});let _=2===m.length?m[R-1]:m[0],{positionAssignments:L}=Pc({structure:s}),V=L?.find((e=>e.drawPosition===_)),B=o.drawMatchUps.find((e=>e.matchUpId===w.matchUpId)),j=B?.drawPositions?.filter(Boolean),G=1===j.length;if(_){if(V?.bye){let r=tm({matchUpId:B.matchUpId,inContextDrawMatchUps:t,drawDefinition:i});if(G){let r=j.filter(Boolean)[0],n=nh({drawPosition:r,matchUpId:B.matchUpId,inContextDrawMatchUps:t}),a=AI({appliedPolicies:e.appliedPolicies,matchUpId:B.matchUpId,matchUp:B,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,context:d,drawDefinition:i,winningSide:n});return a.error?en({result:a,stack:d}):Em({drawPositionToAdvance:r,matchUpId:B.matchUpId,inContextDrawMatchUps:t,drawDefinition:i,matchUpsMap:o})}if([ss,Xo].includes(w.matchUpStatus)){let t=Wb({...e,matchUpId:B.matchUpId,matchUpStatus:A,targetData:r});if(t.error)return en({result:t,stack:d})}return en({result:{...I},stack:d})}return ah({matchUpId:w.matchUpId,drawPosition:_,inContextDrawMatchUps:t,drawDefinition:i})}if(h){if(!B)return{error:Fe};if(G){let e=j[0],r=nh({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawPosition:e});console.log("existing drawPosition is winningSide",{walkoverWinningSide:r})}let r=[ss,Xo].includes(B.matchUpStatus)?u:c,n=AI({matchUpId:B.matchUpId,appliedPolicies:e.appliedPolicies,matchUp:B,matchUpStatusCodes:[],removeScore:!0,context:d,drawDefinition:i,matchUpStatus:r});if(n.error)return en({result:n,stack:d});if(r===c){let t=Wb({...e,matchUpId:a.matchUpId,matchUpStatus:r,targetData:U});if(t.error)return t}}return en({result:{...I},stack:d})}function zb(e){let{loserTargetDrawPosition:t,tournamentRecord:r,loserTargetLink:i,drawDefinition:n,matchUpsMap:a,event:o}=e,s=i?.target?.structureId,{structure:c}=yc({drawDefinition:n,structureId:s});return c?Mm({drawPosition:t,tournamentRecord:r,drawDefinition:n,structureId:s,matchUpsMap:a,event:o}):{error:se}}function Yb(e){return e===es?ss:e===Zo?Xo:e}function Kb(e){let{tournamentRecord:t,drawDefinition:r,matchUpStatus:i,structure:n,matchUp:a}=e,o=!(!a.tieMatchUps||a.rondPosition||!e.inContextDrawMatchUps.find((e=>e.matchUpId===a.matchUpId)).containerStructureId),s=i===Yo,c=a.winningSide,u=[es,Zo].includes(i),d=vm({matchUpStatus:i}),l=ym({matchUpStatus:i}),p=!d&&!l,m=e.matchUpTieId||c&&d&&!u,f=c&&u;return p&&{error:Se}||m&&Qb(e)||f&&function(e){let t=Gb(e);return t.error?t:Wb(e)}(e)||c&&Gb(e)||l&&AI({...e,removeScore:[Ko,ss].includes(i),matchUpStatus:i||os})||s&&function({tournamentRecord:e,drawDefinition:t,structure:r,matchUp:i}){let n="attemptToSetMatchUpStatusBYE";if(i?.winningSide)return en({result:{error:De},context:{matchUpStatus:Yo},stack:n});let{positionAssignments:a}=Dc({structure:r}),o=a?.filter((e=>e.bye)).map((e=>e.drawPosition));return i.drawPositions?.some((e=>o?.includes(e)))?(i.matchUpStatus=Yo,i.matchUpStatusCodes=[],iu({tournamentId:e?.tournamentId,context:n,drawDefinition:t,matchUp:i}),{...I}):en({result:{error:ye},info:"matchUp does not include BYE",stack:n})}({tournamentRecord:t,drawDefinition:r,structure:n,matchUp:a})||!d&&{error:Se}||u&&function(e){let t=Qb({...e,removeScore:!0});return t.error?t:Wb(e)}(e)||o&&Qb(e)||en({result:{error:De},stack:"attemptToSetMatchUpStatus"})}function Qb(e){let t="scoreModification";if(e.isCollectionMatchUp&&e.dualMatchUp?.winningSide&&!e.projectedWinningSide){let r=Gb(e);if(r.error)return en({result:r,stack:t})}let r=!!e.matchUp.collectionId,i=AI({...e,context:t});if(r){let{matchUpTieId:r,drawDefinition:n,matchUpsMap:a}=e,o=rU({tournamentRecord:e.tournamentRecord,appliedPolicies:e.appliedPolicies,matchUpId:r,event:e.event,drawDefinition:n,matchUpsMap:a});if(o.error)return en({result:o,stack:t});Object.assign(i,{tieMatchUpResult:o})}return en({result:i,stack:t})}function Jb({drawDefinition:e,structure:t,matchUp:r}){let i=[];if(t.finishingPosition===mc&&Nh({drawDefinition:e,structure:t})){let{structureIds:n}=function({drawDefinition:e,structure:t,matchUp:r}){let{drawPositions:i}=r,{positionAssignments:n}=Pc({drawDefinition:e,structure:t}),a=n?.filter((({drawPosition:e})=>i?.includes(e)))?.map((e=>{let{extension:t}=no({element:e,name:Mo});return t?.value?.groupOrder})),{containerStructures:o}=lu({drawDefinition:e}),s=o[t.structureId];return{structureIds:Zp({drawDefinition:e,structureId:s})?.links?.source?.filter((e=>ui(a,e.source?.finishingPositions||[]))).map((e=>e.source.structureId))}}({drawDefinition:e,structure:t,matchUp:r});n?.length&&i.push(...n)}return{connectedStructureIds:i}}function Xb(e){let t,r="attemptToSetWinningSide",{appliedPolicies:i,disableAutoCalc:n,drawDefinition:a,dualMatchUp:o,winningSide:s,structure:c,matchUp:u}=e;if(o?._disableAutoCalc&&!1!==n)return EI(e);if(u.winningSide&&u.winningSide!==s){let{connectedStructureIds:r}=Jb({drawDefinition:a,structure:c,matchUp:u});r.length&&(console.log({connectedStructureIds:r}),t=!0);let i=Gb(e);if(i.error)return i}let d,l,p=iU(e);return p.error?en({result:p,stack:r}):(e.qualifierChanging&&i?.[Fa]?.autoReplaceQualifiers&&(d=function(e){let t,{inContextDrawMatchUps:r,inContextMatchUp:i,drawDefinition:n,winningSide:a}=e,o=e.targetData.targetLinks?.winnerTargetLink;if(o.target.feedProfile===Cs){let s=i.sides.find((({sideNumber:e})=>e!==a)).participantId,c=r.find((e=>e.structureId===o.target.structureId&&e.roundNumber===o.target.roundNumber&&e.sides.some((({participantId:e})=>e===s))));if(c?.matchUpStatus===os&&!iv({inContextDrawMatchUps:r,drawDefinition:n,targetData:tm({matchUpId:c.matchUpId,inContextDrawMatchUps:r,drawDefinition:n})})){let{structure:r}=yc({structureId:c.structureId,drawDefinition:n}),o=Pc({structure:r}).positionAssignments;for(let c of o||[])if(c.participantId===s){let s=i.sides.find((({sideNumber:e})=>e===a)).participantId;if(c.participantId=s,r?.positionAssignments)r.positionAssignments=o;else if(r?.structures){let e=Object.assign({},...(o||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of r.structures)t.positionAssignments?.forEach((t=>t.participantId=e[t.drawPosition]))}su({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:n,structure:r}),t=!0}}}return{...I,qualifierReplaced:t}}(e).qualifierReplaced),e.qualifierAdvancing&&i?.[Fa]?.autoPlaceQualifiers&&(l=function(e){let t,{inContextDrawMatchUps:r,inContextMatchUp:i,drawDefinition:n,winningSide:a}=e,o=e.targetData.targetLinks?.winnerTargetLink;if(o.target.feedProfile===Cs){let s=i.sides.find((({sideNumber:e})=>e===a))?.participantId,c=ni(r.filter((e=>e.structureId===o.target.structureId&&e.roundNumber===o.target.roundNumber&&e.sides.some((({participantId:e,qualifier:t})=>t&&!e)))));if(c?.matchUpStatus===os&&!iv({inContextDrawMatchUps:r,drawDefinition:n,targetData:tm({matchUpId:c.matchUpId,inContextDrawMatchUps:r,drawDefinition:n})})){let r=c.sides.find((e=>e.qualifier&&!e.participantId))?.drawPosition,{structure:i}=yc({structureId:c.structureId,drawDefinition:n});if(!i)return{error:ae};let a=Pc({structure:i}).positionAssignments;for(let o of a||[])if(o.drawPosition===r&&!o.participantId){if(o.participantId=s,i.positionAssignments)i.positionAssignments=a;else if(i.structures){let e=Object.assign({},...(a||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of i.structures)t.positionAssignments?.forEach((t=>t.participantId=e[t.drawPosition]))}su({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:n,structure:i}),t=!0}}}return{...I,qualifierPlaced:t}}(e).qualifierPlaced),en({result:Zi({...I,...p,connectedStructures:t,qualifierReplaced:d,qualifierPlaced:l}),stack:r}))}n(bb,{applyLineUps:()=>xR,assignMatchUpSideParticipant:()=>Rb,assignTieMatchUpParticipantId:()=>_b,bulkMatchUpStatusUpdate:()=>NR,checkInParticipant:()=>Ab,checkOutParticipant:()=>Nb,disableTieAutoCalc:()=>DR,enableTieAutoCalc:()=>SR,findMatchUp:()=>qP,removeDelegatedOutcome:()=>wR,removeMatchUpSideParticipant:()=>Bb,removeTieMatchUpParticipantId:()=>Vb,replaceTieMatchUpParticipantId:()=>Ob,resetAdHocMatchUps:()=>FR,resetMatchUpLineUps:()=>bR,resetScorecard:()=>OR,resetTieFormat:()=>CR,setDelegatedOutcome:()=>ER,setMatchUpFormat:()=>TR,setMatchUpStatus:()=>MR,setOrderOfFinish:()=>kR,substituteParticipant:()=>PR,toggleParticipantCheckInState:()=>Eb,updateTieMatchUpScore:()=>rU});var Zb={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function eR(e){let{inContextDrawMatchUps:t,appliedPolicies:r,drawDefinition:i,matchUpsMap:n,targetData:a,matchUp:o}=e,{iteration:s=0}=e;s+=1;let c="removeDoubleExit";bm({method:c,color:"brightyellow",iteration:s,keyColors:Zb});let{targetLinks:{loserTargetLink:u},targetMatchUps:{loserMatchUp:d,winnerMatchUp:l,loserTargetDrawPosition:p}}=a;if(l&&l.matchUpStatus!==Yo){let{stage:t,roundNumber:r,roundPosition:i}=l;bm({winner:"winner",stage:t,roundNumber:r,roundPosition:i,keyColors:Zb}),tR({...e,targetMatchUp:l,sourceMatchUp:o,iteration:s})}if(d&&d.matchUpStatus!==Yo){let a=t.find((({matchUpId:e})=>e===d.matchUpId)),{structure:o}=yc({drawDefinition:i,structureId:a.structureId}),{stage:l,roundNumber:m,roundPosition:f,feedRound:h}=d;if(bm({loser:"loser",stage:l,roundNumber:m,roundPosition:f,keyColors:Zb,feedRound:h}),r?.progression?.doubleExitPropagateBye)$b({drawPosition:p,targetLink:u,inContextDrawMatchUps:t,drawDefinition:i,matchUpsMap:n});else{let t=tR({...e,structure:o,targetMatchUp:d,iteration:s});if(t.error)return en({result:t,stack:c})}}return en({result:{...I},stack:c})}function tR(e){let{inContextDrawMatchUps:t,appliedPolicies:r,drawDefinition:i,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o,structure:s,iteration:c}=e,u="conditionallyRemoveDrawPosition";bm({method:u});let d,l,p,m=tm({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:i}),{targetMatchUps:{winnerMatchUp:f}}=m,h=o?.drawMatchUps.find((e=>e.matchUpId===a.matchUpId)),g=[];if(a.feedRound)p=f?.drawPositions?.filter(Boolean)?.find((e=>a.drawPositions.includes(e)));else if(n){if(l=rh({structureId:s.structureId,matchUp:n,matchUpsMap:o})?.pairedPreviousMatchUp,d=[es,Zo].includes(l?.matchUpStatus),g=l?.drawPositions?.filter(Boolean)||[],[...ms,Yo].includes(l?.matchUpStatus)||l?.winningSide){let e=n.drawPositions||[],t=a.drawPositions?.filter(Boolean);ui(e,t)&&(t=t?.filter((t=>!e.includes(t)))),p=e.concat(g).find((e=>t?.includes(e)))}}else p=si(a?.drawPositions||[],f?.drawPositions||[])?.[0];if(f&&p){let{stage:e,roundNumber:r,roundPosition:n}=f;bm({method:"removeDirectedWinner",drawPositionToRemove:p,keyColors:Zb,color:"brightgreen",stage:e,roundNumber:r,roundPosition:n}),qb({winningDrawPosition:p,winnerMatchUp:f,inContextDrawMatchUps:t,drawDefinition:i,matchUpsMap:o})}let U=eR({targetData:m,matchUp:a,inContextDrawMatchUps:t,appliedPolicies:r,drawDefinition:i,matchUpsMap:o,structure:s,iteration:c});if(U.error)return en({result:U,stack:u});let v=function({pairedPreviousDoubleExit:e,noContextTargetMatchUp:t}){return t.matchUpStatus===Yo?Yo:e?[Zo,Xo].includes(t?.matchUpStatus)?Xo:ss:os}({pairedPreviousDoubleExit:d,noContextTargetMatchUp:h}),y=!d;return U=AI({...e,matchUpId:a.matchUpId,matchUp:h,removeWinningSide:!0,matchUpStatusCodes:[],context:u,matchUpStatus:v,removeScore:y,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),U.error?en({result:U,stack:u}):{...I}}function rR(e){let{matchUp:t,matchUpStatus:r,score:i,winningSide:n}=e,a="noDownStreamDependencies";if([es,Zo].includes(t?.matchUpStatus)&&![es,Zo].includes(r)){let t=eR(e);if(t.error)return en({result:t,stack:a})}let o=r===es,s=Um({score:i})&&!o&&(e.isCollectionMatchUp&&!e.projectedWinningSide||!n),c=e?.inContextMatchUp?.collectionId&&function(e){let{matchUpFormat:t,score:r}=e,i=r?.sets?.length,n=t&&Op(t),{setFormat:a,finalSetFormat:o,bestOf:s}=n??{};return(s&&i===s&&o||a)?.timed||!1}(e.inContextMatchUp),u=e.removeScore||!c&&![rs,Ho].includes(r||rs),d=e.isCollectionMatchUp&&e.dualMatchUp.winningSide&&!e.projectedWinningSide||t.winningSide&&!n&&!Um({score:i}),l=r&&r!==os,p=r=>{let i,{structure:n,drawDefinition:a,dualMatchUp:o,disableAutoCalc:s}=e;if(o?._disableAutoCalc&&!1!==s)return EI(e);let{connectedStructureIds:c}=Jb({drawDefinition:a,structure:n,matchUp:t});c.length&&(console.log({connectedStructureIds:c}),i=!0),Object.assign(e,{removeScore:r});let u=Gb(e);if(u.error)return u;if(e.removingQualifier&&e.appliedPolicies?.[Fa]?.autoRemoveQualifiers){let t=function(e){let t,{inContextDrawMatchUps:r,inContextMatchUp:i,drawDefinition:n}=e,a=e.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===Cs){let o=i.sides?.find((({sideNumber:e})=>e===i.winningSide))?.participantId,s=r.find((e=>e.structureId===a.target.structureId&&e.roundNumber===a.target.roundNumber&&e.sides?.some((({participantId:e})=>e===o))));if(s&&s.matchUpStatus===os&&!iv({inContextDrawMatchUps:r,drawDefinition:n,targetData:tm({matchUpId:s.matchUpId,inContextDrawMatchUps:r,drawDefinition:n})})){let{structure:r}=yc({structureId:s.structureId,drawDefinition:n}),i=Pc({structure:r}).positionAssignments;for(let a of i||[])if(a.participantId===o){if(a.participantId=void 0,r?.positionAssignments)r.positionAssignments=i;else if(r?.structures){let e=Object.assign({},...(i||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of r?.structures||[])t.positionAssignments?.forEach((t=>t.participantId=e[t.drawPosition]))}su({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:n,structure:r}),t=!0}}}return{qualifierRemoved:t}}(e);return{...I,connectedStructures:i,...t}}return{...I,connectedStructures:i}};if(d&&n&&e.isCollectionMatchUp)return iR(e);let m=[Ko,Ho].includes(r)&&e.dualWinningSideChange;return en({result:(n||m)&&Xb(e)||s&&p(u)||l&&Kb(e)||d&&p(u)||t&&iR({...e,removeScore:!0})||{...I},stack:a})}function iR(e){let t="scoreModification";if(e.isCollectionMatchUp&&e.dualMatchUp?.winningSide&&!e.projectedWinningSide){let t=Gb(e);if(t.error)return t}let r=AI({...e,context:t});if(e.isCollectionMatchUp){let{matchUpTieId:t,drawDefinition:r,event:i,matchUpsMap:n}=e,{removeWinningSide:a}=rU({tournamentRecord:e.tournamentRecord,appliedPolicies:e.appliedPolicies,matchUpId:t,drawDefinition:r,matchUpsMap:n,event:i});a&&console.log("REMOVE WINNING SIDE")}return en({result:r,stack:t})}function nR(e){let t=xn(e,[{[nn]:!0,[an]:!0,[mn]:!0},{homeParticipantId:!0,[Pn]:It}]);if(t.error)return t;let r=$D(e,[{[Tn]:Sn,attr:{[fn]:!0}}]);if(r.error)return r;let i=r?.matchUp?.matchUp?.sides?.map((e=>e?.participantId));if(e.homeParticipantId&&!i?.includes(e.homeParticipantId))return{error:dt};let{disableNotice:n=!0,homeParticipantId:a,removePriorValues:o,tournamentRecord:s,drawDefinition:c,matchUpId:u}=e;return Mb({duplicateValues:!1,removePriorValues:o,tournamentRecord:s,drawDefinition:c,disableNotice:n,matchUpId:u,timeItem:{itemType:Wd,itemValue:a}})}function aR(e){let t="addMatchUpScheduledTime",r=e.matchUp,{removePriorValues:i,tournamentRecord:n,drawDefinition:a,disableNotice:o,scheduledTime:s,matchUpId:c}=e;if(!c)return en({result:{error:Ae},stack:t});if(!Xn(s))return en({result:{error:Ze},stack:t});if(!r){let e=bI({drawDefinition:a,matchUpId:c});if(e.error)return en({result:e,stack:t});r=e.matchUp}let u=la(s),d=ql({matchUp:r}).scheduledDate,l=u&&!d;if((zl({matchUp:r}).timeModifiers||[])?.length){let e=oR({disableNotice:!0,removePriorValues:i,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:c,matchUp:r});if(e?.error)return en({result:e,stack:t})}let p=fa(s,!0,l);return Mb({duplicateValues:!1,removePriorValues:i,tournamentRecord:n,drawDefinition:a,disableNotice:o,matchUpId:c,timeItem:{itemType:zd,itemValue:p}})}function oR({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,timeModifiers:n,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return en({result:{error:Ae},stack:s});if(void 0!==n&&!Array.isArray(n))return en({info:ch("timeModifiers"),result:{error:mr},stack:s});if(!o){let e=bI({drawDefinition:r,matchUpId:a});if(e.error)return en({result:e,stack:s});o=e.matchUp}let c=zl({matchUp:o}).timeModifiers||[],u=n.filter((e=>!c.includes(e)));if(n.length&&!u.length)return{...I};if(u.some((e=>nl.includes(e)))){c=c.filter((e=>!nl.includes(e)));let i=aR({disableNotice:!0,removePriorValues:e,scheduledTime:"",tournamentRecord:t,drawDefinition:r,matchUpId:a});if(i.error)return en({result:i,stack:s})}let d=n?.length?[...u,...c]:void 0;return Mb({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:a,timeItem:{itemType:Xd,itemValue:d}})}function sR({scheduledDate:e,removePriorValues:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a}){if(!a)return{error:Ae};let o=e&&Yn.test(e);return e&&!o?{error:Xe}:Mb({duplicateValues:!1,removePriorValues:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemValue:la(e),itemType:$d}})}function cR({removePriorValues:e,tournamentRecords:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,courtDayDate:a,matchUpId:o,courtIds:s}){if(!r&&!t)return{error:D};if(!o)return{error:Ae};let c,u=bI({drawDefinition:i,matchUpId:o});if(u.error)return u;if(u?.matchUp?.matchUpType!==gu)return{error:ke};if(!(void 0===s||Array.isArray(s)&&s.length&&s.every((e=>"string"==typeof e))))return{error:mr,context:{courtIds:s}};if(s){let e=QP({tournamentRecords:t||r&&{[r.tournamentId]:r}});if(e.error)return e;let i=e.courts?.filter((e=>s.includes(e.courtId)));if(i?.length!==s.length)return{error:mr,context:{courtIds:s}};c=i?.map((e=>({venueId:e.venueId,courtId:e.courtId})))}return Mb({duplicateValues:!1,removePriorValues:e,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:{itemType:jd,itemDate:a,itemValue:c}})}function uR({removePriorValues:e,tournamentRecords:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a,venueId:o}){if(!r)return{error:D};if(!a)return{error:Ae};if(o){let e=ep({tournamentRecords:t,tournamentRecord:r,venueId:o});if(e.error)return e}return Mb({duplicateValues:!1,removePriorValues:e,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:Bd,itemValue:o}})}function dR({removePriorValues:e,tournamentRecords:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,courtDayDate:a,matchUpId:o,courtId:s}){if(!r&&!t)return{error:D};if(!o)return{error:Ae};if(s){let e=rp({tournamentRecords:t,tournamentRecord:r,courtId:s});if(e.error)return e;let a=e.venue?.venueId;uR({tournamentRecords:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:o,venueId:a})}return Mb({duplicateValues:!1,removePriorValues:e,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:{itemType:Gd,itemDate:a,itemValue:s}})}function lR(e,t){let r=zn.test(e)?e:da(e),i=la(e)||la(t)||ta(new Date);return new Date(`${i}T${r}`).getTime()}function pR(e){let t="addMatchUpScheduleItems",r=xn(e,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[En]:bn}],t);if(r.error)return r;let i,n,{matchUpDependencies:a,inContextMatchUps:o}=e,{errorOnAnachronism:s=!1,checkChronology:c=!0,removePriorValues:d,tournamentRecords:l,tournamentRecord:p,drawDefinition:m,disableNotice:f,drawMatchUps:h,matchUpId:g,schedule:U,event:y}=e;if(h)i=h.find((e=>e.matchUpId===g));else{let e=bI({drawDefinition:m,event:y,matchUpId:g});if(e.error)return e;i=e.matchUp}let{endTime:S,courtId:w,courtIds:P,courtOrder:D,resumeTime:T,homeParticipantId:b,scheduledDate:R,scheduledTime:M,startTime:N,stopTime:A,timeModifiers:E,venueId:C}=U;c&&(!a||!o)&&({matchUpDependencies:a,matchUps:o}=Im({drawDefinition:m}));let O=a?.[g]?.matchUpIds;if(U.scheduledDate&&c&&O){let e=o?.filter((e=>(e.schedule?.scheduledDate||la(e.schedule?.scheduledTime))&&O.includes(e.matchUpId))).map((({schedule:e})=>{let t=Qn(e);return new Date(t).getTime()}));if(e?.length){let r=Qn(U),i=new Date(r).getTime();if(Math.max(...e)>=i){if(s)return en({result:{error:v},stack:t});n=v}}}if(void 0!==R){let e=sR({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,scheduledDate:R,matchUpId:g});if(e?.error)return en({result:e,stack:t,context:{scheduledDate:R}})}if(void 0!==M){let e=aR({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,scheduledTime:M,matchUpId:g,matchUp:i});if(e?.error)return en({result:e,stack:t,context:{scheduledTime:M}})}if(void 0!==N){let e=hR({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,matchUpId:g,startTime:N,event:y});if(e?.error)return en({result:e,stack:t,context:{startTime:N}})}if(void 0!==A){let e=IR({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,matchUpId:g,stopTime:A,event:y});if(e?.error)return en({result:e,stack:t,context:{stopTime:A}})}if(void 0!==T){let e=UR({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,resumeTime:T,matchUpId:g,event:y});if(e?.error)return en({result:e,stack:t,context:{resumeTime:T}})}if(void 0!==S){let e=gR({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,matchUpId:g,endTime:S,event:y});if(e?.error)return en({result:e,stack:t,context:{endTime:S}})}if(void 0!==P){let e=cR({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,matchUpId:g,courtIds:P});if(e?.error)return en({result:e,stack:t,context:{courtIds:P}})}if(void 0!==w&&void 0!==R){let e=dR({courtDayDate:R,disableNotice:!0,removePriorValues:d,tournamentRecords:l,tournamentRecord:p,drawDefinition:m,matchUpId:g,courtId:w});if(e?.error)return en({result:e,stack:t,context:{courtId:w}})}if(void 0!==C){let e=uR({disableNotice:!0,removePriorValues:d,tournamentRecords:l,tournamentRecord:p,drawDefinition:m,matchUpId:g,venueId:C});if(e?.error)return en({result:e,stack:t,context:{venueId:C}})}if(void 0!==D&&Wr(D)){let e=mR({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,courtOrder:D,matchUpId:g});if(e?.error)return en({result:e,stack:t,context:{courtOrder:D}})}if(void 0!==E){let e=oR({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,timeModifiers:E,matchUpId:g,matchUp:i});if(e?.error)return en({result:e,stack:t,context:{timeModifiers:E}})}return u(b)&&nR({disableNotice:!0,homeParticipantId:b,removePriorValues:d,tournamentRecord:p,drawDefinition:m,matchUpId:g}),f||iu({tournamentId:p?.tournamentId,eventId:y?.eventId,context:t,drawDefinition:m,matchUp:i}),n?{...I,warnings:[n]}:{...I}}function mR({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,courtOrder:n,matchUpId:a}){if(!a)return{error:Ae};if(n&&!Wr(n))return{error:mr,info:"courtOrder must be numeric"};let o=n&&xr(n);return Mb({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:a,timeItem:{itemType:qd,itemValue:o}})}function fR({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,participantId:n,officialType:a,matchUpId:o}){if(!o)return{error:Ae};if(!n)return{error:It};if(t){if(!Ga({tournamentParticipants:ef({tournamentRecord:t,participantFilters:{participantTypes:[Tu],participantRoles:[Uf]}}).participants??[],participantId:n}))return{error:Ut}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(s.itemSubTypes=[a]),Mb({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:o,timeItem:s})}function hR({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:n,startTime:a,event:o}){if(!n)return{error:Ae};if(!Xn(a))return{error:Ze};let{matchUp:s}=bI({drawDefinition:r,event:o,matchUpId:n}),{scheduledDate:c}=ql({matchUp:s}),u=(s?.timeItems??[]).filter((e=>[Kd,Qd,Jd].includes(e?.itemType))).map((e=>lR(e.itemValue,c))).reduce(((e,t)=>!e||t<e?t:e),void 0);if(!u||lR(a,c)<u){s?.timeItems&&(s.timeItems=s.timeItems.filter((e=>e.itemType!==Yd)));let o=fa(a,!0,!0);return Mb({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:n,timeItem:{itemType:Yd,itemValue:o}})}return{error:Kt}}function gR({validateTimeSeries:e=!0,removePriorValues:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a,endTime:o,event:s}){if(!a)return{error:Ae};if(!Xn(o))return{error:Ze};let{matchUp:c}=bI({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:u}=ql({matchUp:c}),d=(c?.timeItems??[]).filter((e=>[Yd,Qd,Kd].includes(e?.itemType))).map((e=>lR(e.itemValue,u))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(!e||!d||lR(o,u)>d){c?.timeItems&&(c.timeItems=c.timeItems.filter((e=>e.itemType!==Jd)));let e=fa(o,!0,!0);return Mb({duplicateValues:!1,removePriorValues:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:Jd,itemValue:e}})}return{error:Ht}}function IR({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:n,stopTime:a,event:o}){if(!n)return{error:Ae};if(!Xn(a))return{error:Ze};let{matchUp:s}=bI({drawDefinition:r,event:o,matchUpId:n}),{scheduledDate:c}=ql({matchUp:s}),u=s?.timeItems??[];if(u.reduce(((e,t)=>t.itemType===Jd||e),void 0))return{error:zt};let d=u.filter((e=>[Yd,Qd,Kd].includes(e?.itemType))).sort(((e,t)=>lR(e.itemValue,c)-lR(t.itemValue,c))),l=d[d.length-1],p=l&&l.itemType===Kd,m=d.filter((e=>!p||e.createdAt!==l.createdAt)).map((e=>lR(e.itemValue,c))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(lR(a,c)>m){if(s?.timeItems&&p){let e=l.createdAt;s.timeItems=s.timeItems.filter((t=>t.createdAt!==e))}return Mb({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:n,timeItem:{itemValue:fa(a,!0,!0),itemType:Kd}})}return{error:Yt}}function UR({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,resumeTime:n,matchUpId:a,event:o}){if(!a)return{error:Ae};if(!Xn(n))return{error:Ze};let{matchUp:s}=bI({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:c}=ql({matchUp:s}),u=s?.timeItems??[];if(u.reduce(((e,t)=>t.itemType===Jd||e),void 0))return{error:zt};let d=u.filter((e=>[Yd,Qd,Kd].includes(e?.itemType))).sort(((e,t)=>lR(e.itemValue,c)-lR(t.itemValue,c))),l=d[d.length-1],p=l&&l.itemType===Qd,m=d.filter((e=>!p||e.createdAt!==l.createdAt)).map((e=>lR(e.itemValue,c))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(lR(n,c)>m){if(s?.timeItems&&p){let e=l.createdAt;s.timeItems=s.timeItems.filter((t=>t.createdAt!==e))}return Mb({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:a,timeItem:{itemValue:fa(n,!0,!0),itemType:Qd}})}return{error:Qt}}function vR(e){let t="setMatchUpStatus";e.matchUpStatus&&[ss,es].includes(e.matchUpStatus)&&(e.score=void 0);let{allowChangePropagation:r,disableScoreValidation:i,tournamentRecords:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:c,matchUpStatus:u,winningSide:d,matchUpId:l,event:p,score:m}=e;if(!c)return{error:M};if(u&&[Ko,rs,Ho,os].includes(u)&&d)return{error:mr,winningSide:d,matchUpStatus:u};if(![void 0,...ds].includes(u))return en({result:{error:De},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let f=mp({drawDefinition:c}),{matchUps:h}=am({nextMatchUps:!0,tournamentRecord:a,inContext:!0,drawDefinition:c,matchUpsMap:f,event:p}),g=f.drawMatchUps.find((e=>e.matchUpId===l)),I=h?.find((e=>e.matchUpId===l));if(!g||!h)return{error:Ce};if((g.winningSide||d)&&u===Yo)return{context:"Cannot have Bye with winningSide",error:Pe,matchUpStatus:u};let U,v=I?.structureId,{structure:y}=yc({drawDefinition:c,structureId:v}),S=hl(Iu)(g.matchUpType),w=I?.drawPositions?.filter(Boolean);if(S){if(o)za({extension:{name:lo,value:!0},element:g});else if(s){let t=g.winningSide;Wa({name:lo,element:g});let{winningSide:r,scoreStringSide1:i,scoreStringSide2:n,set:a}=JI({drawDefinition:c,matchUpsMap:f,structure:y,matchUp:g,event:p}),o={scoreStringSide1:i,scoreStringSide2:n,sets:a?[a]:[]};U=r!==t,Object.assign(e,{winningSide:r,dualWinningSideChange:U,projectedWinningSide:r,score:o})}XI({tournamentId:a?.tournamentId,inContextDualMatchUp:I,eventId:p?.eventId,dualMatchUp:g,drawDefinition:c})}if(S&&u&&[zo].includes(u))return{error:mr,info:"Not supported for matchUpType: TEAM"};let P=I?.matchUpTieId,D=tm({matchUpId:P||l,inContextDrawMatchUps:h,drawDefinition:c});if(m&&!S&&!i){let e=g.matchUpFormat??y?.matchUpFormat??c?.matchUpFormat??p?.matchUpFormat,t=ow({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:e,matchUpStatus:u,winningSide:d,score:m});if(t.error)return t}let T=g?.sides?[]:Pc({drawDefinition:c,structureId:v}).positionAssignments,b=I?.sides?.map((e=>e.participantId)).filter(Boolean).length,R=b&&2===b||g.collectionId&&Tp({structure:y})&&b&&b>=1||2===w?.length&&T?.filter((e=>w.includes(e.drawPosition))).every((e=>e.participantId));if(u&&us.includes(u)&&!R)return en({info:"present in participantsRequiredMatchUpStatuses",context:{matchUpStatus:u,requiredParticipants:R},result:{error:De}});let N=Yu({policyTypes:[Fa,_a],tournamentRecord:a,drawDefinition:c,event:p})?.appliedPolicies??{};"object"==typeof e.policyDefinitions&&Object.assign(N,e.policyDefinitions);let A=I?.stage===Us&&1===I.finishingRound,E=A&&d,C=A&&g.winningSide&&!d&&(!e.matchUpStatus||e.matchUpStatus&&ym({matchUpStatus:e.matchUpStatus}))&&(!e.outcome||!Um({outcome:e.outcome})),O=E&&d!==g.winningSide&&g.winningSide;if(Object.assign(e,{inContextDrawMatchUps:h,qualifierAdvancing:E,qualifierChanging:O,removingQualifier:C,inContextMatchUp:I,appliedPolicies:N,matchUpTieId:P,matchUpsMap:f,targetData:D,structure:y,matchUp:g}),P){let{matchUp:t}=bI({matchUpId:P,inContext:!0,drawDefinition:c,matchUpsMap:f,event:p});if(t){let r=pp({matchUp:t,drawDefinition:c,structure:y,event:p})?.tieFormat,{projectedWinningSide:i}=function({drawDefinition:e,matchUpStatus:t,matchUpsMap:r,winningSide:i,dualMatchUp:n,tieFormat:a,structure:o,matchUp:s,event:c,score:u}){let d=Da(n,void 0,!0);for(let p of d?.tieMatchUps||[])p.matchUpId===s.matchUpId&&(p.winningSide=i,p.score=u,Um({score:u})||t?t&&(p.matchUpStatus=t):Object.assign(p,{...NI}));a=a??pp({matchUp:s,structure:o,drawDefinition:e,event:c})?.tieFormat;let{winningSide:l}=JI({matchUp:d,drawDefinition:e,matchUpsMap:r,structure:o,tieFormat:a,event:c});return{projectedWinningSide:l}}({drawDefinition:c,matchUpStatus:u,dualMatchUp:t,matchUpsMap:f,winningSide:d,tieFormat:r,structure:y,matchUp:g,event:p,score:m});U=i!==t.winningSide,Object.assign(e,{isCollectionMatchUp:!0,dualWinningSideChange:U,projectedWinningSide:i,matchUpTieId:P,dualMatchUp:t,tieFormat:r})}}let F=iv(e),k=vm({matchUpStatus:u});if(!P){if(F&&!d&&(u&&ym({matchUpStatus:u})||u&&[es,Zo].includes(u)))return{error:Pe,activeDownstream:F,winningSide:d};if(d&&d===g.winningSide&&u&&!k)return{context:"winningSide must include directing matchUpStatus",error:Pe,directingMatchUpStatus:k,matchUpStatus:u}}let{schedule:x}=e;if(x){let e=pR({disableNotice:!0,tournamentRecords:n,tournamentRecord:a,drawDefinition:c,matchUpId:l,schedule:x});if(e.error)return e}let _=!S&&!U&&d&&g.winningSide&&g.winningSide!==d;if(r&&_&&g.roundPosition)return function(e){let{tournamentRecord:t,inContextMatchUp:r,structure:i,drawDefinition:n}=e,a=r.roundNumber,o=r.sides.find((e=>e.sideNumber===r.winningSide)),s=r.sides.find((e=>e.sideNumber!==r.winningSide)),{drawPosition:c,participantId:u}=o,{drawPosition:d,participantId:l}=s,p="swapWinnerLoser",{matchUps:m}=Kp(e),f=m.filter((({drawPositions:e,roundNumber:t})=>e?.includes(c)&&t>a));wi({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach((r=>{r.drawPositions=r.drawPositions?.map((e=>e===c?d:e))||[],iu({tournamentId:t?.tournamentId,eventId:e.event?.eventId,context:p,drawDefinition:n,matchUp:r})}));let{stage:h,stageSequence:g}=i,I=n.structures.filter((({stage:e,stageSequence:t})=>e===h&&t>g)).map((({structureId:e})=>e)),{targetLinks:{loserTargetLink:U,winnerTargetLink:v}}=e.targetData,y=[U?.target.structureId,v?.target?.structureId].filter(Boolean);return n.structures.filter((({stage:e,structureId:t})=>e!==h&&y.includes(t))).forEach((({stage:e,stageSequence:t,structureId:r})=>{I.includes(r)||I.push(r),n.structures.filter((({stage:r,stageSequence:i})=>r===e&&i>t)).forEach((({structureId:e})=>{I.includes(e)||I.push(e)}))})),n.structures.filter((({structureId:e})=>I.includes(e))).forEach((e=>{let{positionAssignments:t}=Pc({structure:e}),r=t?.find((({participantId:e})=>e===u)),i=t?.find((({participantId:e})=>e===l));r&&(r.participantId=l),i&&(i.participantId=u)})),AI({...e,context:p})}(e);let L=d&&!P||e.projectedWinningSide;bm({activeDownstream:F,matchUpWinner:L,method:t,winningSide:d});let V=!F&&rR(e)||L&&function(e){let{matchUp:t,winningSide:r,matchUpTieId:i,dualWinningSideChange:n}=e;return r===t.winningSide||i&&!n?yR(e):en({stack:"winningSideWithDownstreamDependencies",result:{error:ct},context:{winningSide:r,matchUp:t}})}(e)||k&&yR(e)||{error:gr};return en({result:V,stack:t})}function yR(e){let{tournamentRecord:t,matchUp:r,event:i}=e,n=e.isCollectionMatchUp&&r.winningSide&&!e.winningSide&&!Um({score:e.score}),a=e.isCollectionMatchUp?e.matchUpStatus||n&&os||Qo:e.matchUpStatus||Qo,o=e.removeScore||[Ko,ss].includes(a)&&![rs,Ho].includes(a),s=AI({...e,matchUpStatus:a,removeWinningSide:n,context:"sms",removeScore:o});if(s.error)return s;if(e.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,matchUpsMap:a}=e,o=rU({appliedPolicies:e.appliedPolicies,matchUpId:r,tournamentRecord:t,drawDefinition:n,matchUpsMap:a,event:i});if(o.error)return o;Object.assign(s,{tieMatchUpResult:o})}return s}function SR({tournamentRecord:e,drawDefinition:t,matchUpId:r,event:i}){if(!t)return{error:M};let{matchUp:n}=bI({drawDefinition:t,matchUpId:r,event:i});return n?.matchUpType!==gu?{error:ke}:vR({enableAutoCalc:!0,tournamentRecord:e,drawDefinition:t,matchUpId:r,event:i})}function wR({drawDefinition:e,event:t,matchUpId:r}){if(!e)return{error:M};if(!r)return{error:Ae};let{matchUp:i}=bI({drawDefinition:e,event:t,matchUpId:r});return i?Wa({name:so,element:i}):{error:Ce}}function PR(e){return function({substituteParticipantId:e,existingParticipantId:t,tournamentRecord:r,drawDefinition:i,sideNumber:n,matchUpId:a,event:o}){let s="substituteParticipant";if(!i)return{error:M};if(!a)return{error:Ae};if(!t||!e)return en({result:{error:It},stack:s});let{matchUp:c}=bI({drawDefinition:i,matchUpId:a,event:o});if(!c)return{error:Ce};if(!c.collectionId)return en({result:{error:ke},stack:s});let u=mp({drawDefinition:i}),{matchUps:d}=am({tournamentParticipants:r?.participants,inContext:!0,drawDefinition:i,matchUpsMap:u}),l=d?.find((e=>e.matchUpId===a)),p=d?.find((e=>e.matchUpId===l?.matchUpTieId))?.sides?.find((e=>e.participant.individualParticipants.some((({participantId:e})=>e===t))));return!p||n&&p.sideNumber!==n?{error:dt}:p.participant?.individualParticipants?.map(Go).filter((e=>e!==t))?.includes(e)?Ob({newParticipantId:e,tieMatchUpId:a,existingParticipantId:t,substitution:!0,tournamentRecord:r,drawDefinition:i,event:o}):en({result:{error:dt},stack:s})}(e)}function DR({drawDefinition:e,matchUpId:t,event:r}){if(!e)return{error:M};let{matchUp:i}=bI({drawDefinition:e,matchUpId:t,event:r});return za({extension:{name:lo,value:!0},element:i})}function TR(e){let t="setMatchUpFormat",r=xn(e,[{tournamentRecord:!0},{[Mn]:e=>qI({matchUpFormat:e}),[An]:we,matchUpFormat:!0}]);if(r.error)return en({result:r,stack:t});let{tournamentRecord:i,drawDefinition:n,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:c,eventType:u,matchUpId:d,eventId:l,stages:p,drawId:m,event:f,force:h}=e;if(a&&!Array.isArray(a))return en({result:{error:mr,scheduledDates:a},stack:t});if(u&&!Bp([El,Ol],u))return en({result:{error:ue},stack:t});let g=0,U=e.structureIds||c&&[c].filter(Boolean)||[],v=e.eventIds||l&&[l].filter(Boolean)||[],y=e.drawIds||m&&[m].filter(Boolean)||[];if((c||U?.length)&&!n)return en({result:{error:M},stack:t});if(m&&d&&n){let e=cP({tournamentRecord:i,drawDefinition:n,matchUpFormat:s,structureIds:U,structureId:c,matchUpId:d});if(e.error)return e;g+=1}let S=e=>{let r=[];for(let n of e.structures||[]){if(Array.isArray(p)&&!p.includes(n.stage)||Array.isArray(o)&&!o.includes(n.stageSequence)||U?.length&&!U.includes(n.structureId))continue;U?.length&&n.matchUpFormat!==s&&(n.matchUpFormat=s,r.push(n.structureId),g+=1);let c=((h||a)&&Kp({matchUpFilters:{matchUpStatuses:[os]},structure:n}).matchUps)??[],u=(a&&Kp({matchUpFilters:{matchUpStatuses:[os]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:n}).matchUps)??[];if(c?.length){let r=u?u.map(qo):c.map(qo);for(let n of c)r.includes(n.matchUpId)&&(n.matchUpFormat=a?.length?s:void 0,iu({tournamentId:i?.tournamentId,eventId:f?.eventId,context:t,drawDefinition:e,matchUp:n}))}}return!r.length&&e.matchUpFormat!==s&&(e.matchUpFormat=s,g+=1),r};for(let I of i?.events||[])if(!(v?.length&&!v.includes(I.eventId)||u&&u!==I.eventType||u===kl))if(Array.isArray(o)||Array.isArray(p)||U?.length||y?.length)for(let e of I.drawDefinitions||[]){if(Array.isArray(y)&&!y.includes(e.drawId))continue;au({structureIds:S(e),drawDefinition:e})}else I.matchUpFormat!==s&&(I.matchUpFormat=s,g+=1);return g?{...I,modificationsCount:g}:{...I,info:ar}}function bR({inheritance:e=!0,tournamentRecord:t,drawDefinition:r,matchUpId:i,event:n}){if(!r)return{error:M};let a=bI({drawDefinition:r,matchUpId:i})?.matchUp;if(!a?.tieMatchUps)return{error:ke};let o=bI({inContext:!0,drawDefinition:r,matchUpId:i,event:n})?.matchUp,s=0;return(a?.sides||[]).forEach((e=>{e.lineUp&&delete e.lineUp})),(o?.sides||[]).forEach((i=>{if(s+=1,!1===e){let e=o?.tieFormat,t=i.participantId;e&&t&&dh({drawDefinition:r,participantId:t,lineUp:[],tieFormat:e})}iu({tournamentId:t?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:r,matchUp:a})})),{...I,modificationsCount:s}}function RR(e){let{matchUpFormat:t,matchUpStatus:r,winningSide:i,score:n}=e;if(!n)return{sets:[]};let a=n.sets||[],o=Uy({winnerFirst:!1,matchUpFormat:t,matchUpStatus:r,sets:a}),s=Uy({winnerFirst:!1,reversed:!0,matchUpFormat:t,matchUpStatus:r,sets:a}),c=Uy({matchUpFormat:t,matchUpStatus:r,winningSide:i,sets:a}),u=o===c?s:o;return i&&(o=1===i?c:u,s=2===i?c:u),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function MR(e){let t=xn(e,[{[mn]:!0,[an]:!0}]);if(t.error)return t;let r=yu(e);if(!e.drawDefinition){let t=e.tournamentRecord??(e.tournamentId&&r[e.tournamentId]);e.tournamentRecord||(e.tournamentRecord=t);let i=sp({eventId:e.eventId,drawId:e.drawId,tournamentRecord:t});if(i.error)return i;i.drawDefinition&&(e.drawDefinition=i.drawDefinition),e.event=i.event}let{disableScoreValidation:i,policyDefinitions:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:c,matchUpId:u,schedule:d,event:l,notes:p}=e,m=e.matchUpFormat||e.outcome?.matchUpFormat,{policy:f}=nd({policyType:_a,tournamentRecord:a,event:l}),h=void 0!==e.allowChangePropagation&&e.allowChangePropagation||void 0!==f?.allowChangePropagation&&f.allowChangePropagation||void 0,{outcome:g}=e;if(g?.winningSide&&![1,2].includes(g.winningSide))return{error:it};if(m){let e=cP({tournamentRecord:a,drawDefinition:c,matchUpFormat:m,matchUpId:u,event:l});if(e.error)return e}if(g?.score?.sets&&!g.score.scoreStringSide1){let{score:e}=RR(g);g.score=e,g.score.sets=g.score.sets.filter((e=>e.side1Score||e.side2Score||e.side1TiebreakScore||e.side2TiebreakScore))}return vR({matchUpStatusCodes:g?.matchUpStatusCodes,matchUpStatus:g?.matchUpStatus,winningSide:g?.winningSide,allowChangePropagation:h,disableScoreValidation:i,score:g?.score,tournamentRecords:r,policyDefinitions:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:c,matchUpFormat:m,matchUpId:u,schedule:d,event:l,notes:p})}function NR(e){if(!e?.outcomes)return{error:He};if(!Array.isArray(e.outcomes))return{error:He,info:{outcomes:e.outcomes}};let t=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{},r=e.outcomes??[],i=r.reduce(((e,t)=>e.includes(t.tournamentId)?e:e.concat(t.tournamentId)),[]);for(let n of i){let e=t[n];if(!e)return{error:D};let i=r.filter((e=>e.tournamentId===n));if(i.length){let t=AR({outcomes:i,tournamentRecord:e});if(t.error)return t}}return{...I}}function AR(e){let{tournamentRecords:t,tournamentRecord:r,outcomes:i,policyDefinitions:n}=e,a={};i.forEach((e=>{let{eventId:t}=e;a[t]||(a[t]=[]),a[t].push(e)}));for(let o of Object.keys(a)){let{event:e}=sp({tournamentRecord:r,eventId:o});for(let i of a[o]){let{drawId:a}=i,o=e?.drawDefinitions?.find((e=>e.drawId===a));if(o&&a){let{matchUpFormat:s,matchUpId:c}=i,u=MR({schedule:i?.schedule,tournamentRecords:t,policyDefinitions:n,tournamentRecord:r,drawDefinition:o,matchUpFormat:s,matchUpId:c,outcome:i,drawId:a,event:e});if(u.error)return u}}}return{...I}}function ER(e){return function({drawDefinition:e,matchUpId:t,outcome:r,matchUp:i}){if(!i&&!e)return{error:M};if(!r)return{error:He,info:"missing outcome"};if(!i&&!t)return{error:Fe};if(!i){let r=bI({drawDefinition:e,matchUpId:t});if(r.error)return r;i=r.matchUp}return"object"==typeof r&&r.score?.scoreStringSide1&&r.score?.scoreStringSide2?za({element:i,extension:{name:so,value:r}}):{error:mr}}(e)}function CR(e){let t="resetTieFormat",{drawDefinition:r,event:i,uuids:n}=e,a=xn(e,[{[nn]:!0,[mn]:!0}],t);if(a.error)return a;let o=$D(e,[{[Tn]:Sn}]);if(o[Pn])return o;let s=e.tournamentRecord?.tournamentId,{matchUp:c,structure:u}=o?.matchUp??{};if(!c?.tieMatchUps)return en({result:{error:ke},info:"Must be a TEAM matchUp",stack:t});if(!c.tieFormat)return{...I};let d=pp({structure:u,drawDefinition:r,event:i})?.tieFormat;if(!d)return en({result:{error:vr},info:"No inherited tieFormat",stack:t});let l=[],p=[],m=[],f=[];for(let h of d.collectionDefinitions){let{matchUpCount:e,collectionId:t}=h;p.push(t);let r=(c.tieMatchUps||[]).filter((e=>e.collectionId===t));if(r.length>e)r.sort(((e,t)=>(e.matchUpStatus===os?1:0)-(t.matchUpStatus===os?1:0))),m.push(...r.slice(0,e)),l.push(...r.slice(3).map(qo));else if(m.push(...r),r.length<e){let t=$g({collectionDefinition:h,matchUpsLimit:e-r.length,matchUp:c,uuids:n});f.push(...t)}}for(let h of c?.tieMatchUps||[])h.collectionId&&!p.includes(h.collectionId)&&l.push(h.matchUpId);return f.length&&(m.push(...f),tu({eventId:i?.eventId,matchUps:f,drawDefinition:r,tournamentId:s})),l.length&&ru({matchUpIds:l,eventId:i?.eventId,drawDefinition:r,tournamentId:s}),c&&(c.tieMatchUps=m,c.tieFormatId=void 0,c.tieFormat=void 0,iu({structureId:u?.structureId,eventId:i?.eventId,context:t,drawDefinition:r,tournamentId:s,matchUp:c})),{...I,newMatchUps:f,deletedMatchUpIds:l}}function OR(e){let{tournamentRecord:t,drawDefinition:r,matchUpId:i,event:n}=e,a="resetScorecard";if(!r)return en({result:{error:M},stack:a});if(!i)return en({result:{error:Ae},stack:a});if(!u(i))return en({result:{error:mr,matchUpId:i},stack:a});let o=mp({drawDefinition:r}),{matchUps:s}=am({nextMatchUps:!0,inContext:!0,drawDefinition:r,matchUpsMap:o}),c=o.drawMatchUps.find((e=>e.matchUpId===i)),d=s?.find((e=>e.matchUpId===i));if(!c||!s)return{error:Ce};if(c.matchUpType!==xl)return{error:ke};let l=tm({inContextDrawMatchUps:s,drawDefinition:r,matchUpId:i}),p=d?.structureId,{structure:m}=yc({drawDefinition:r,structureId:p});if(Object.assign(e,{inContextDrawMatchUps:s,inContextMatchUp:d,matchUpsMap:o,targetData:l,structure:m,matchUp:c}),iv(e))return{error:ct};if(c.tieMatchUps?.length)for(let u of c.tieMatchUps){let e=vR({matchUpId:u.matchUpId,matchUpTieId:i,winningSide:void 0,removeScore:!0,tournamentRecord:t,drawDefinition:r,event:n});if(e.error)return en({result:e,stack:a})}let f=Yu({tournamentRecord:t,drawDefinition:r,event:n})?.appliedPolicies,h=rU({event:e.event,removeScore:!0,tournamentRecord:t,appliedPolicies:f,drawDefinition:r,matchUpsMap:o,matchUpId:i});if(h.error)return en({result:h,stack:a});if(e.tiebreakReset&&!h.tieFormatRemoved){let e=pp({drawDefinition:r,structure:m,event:n})?.tieFormat;if(c.tieFormat&&e){let{matchUpCountDifference:a,descendantDifferences:o,ancestorDifferences:s,valueDifference:u}=jP({descendant:c.tieFormat,ancestor:e});if(1===o.collectionIds.length&&!s.collectionIds.length&&!s.groupsCount&&1===a&&1===u){let e=CR({tournamentRecord:t,drawDefinition:r,matchUpId:i,event:n});if(e.error)return e}}}return{...I}}function FR(e){let t=xn(e,[{[an]:!0,[Dn]:!0},{[On]:{[ln]:!1,roundNumbers:!1},[Nn]:"At least one must be provided",[En]:Rn}]);if(t.error)return t;let r=IU(e);if(r.error)return r;let{matchUpIds:i}=r,n=hl(xl)(e.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=e;for(let c of i){if(n){let t=OR({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:c,event:s});if(t.error||e.removeAssignments&&bR({inheritance:!1,drawDefinition:o,matchUpId:c}).error)return t}let t=vR({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:c,event:s});if(t.error)return t;if(e.removeAssignments){let t=Bb({...e,matchUpId:c});if(t.error)return t}}return{...I}}function kR(e){return function({drawDefinition:e,finishingOrder:t}){if(!e)return{error:M};let r="setOrderOfFinish";if(!Array.isArray(t))return en({info:ch("finishingOrder"),result:{error:mr},stack:r});let{completedMatchUps:i,matchUpsMap:n}=om({inContext:!0,drawDefinition:e}),a=i?.map(qo)??[],o=t.map(qo),{matchUpTypes:s,roundNumbers:c,structureIds:u,matchUpTieIds:d}=(i??[]).filter((({matchUpId:e})=>o.includes(e))).reduce(((e,t)=>{let{matchUpTieId:r,matchUpType:i,roundNumber:n,structureId:a}=t;return e.matchUpTypes.includes(i)||e.matchUpTypes.push(i),e.roundNumbers.includes(n)||e.roundNumbers.push(n),e.structureIds.includes(a)||e.structureIds.push(a),e.matchUpTieIds.includes(r)||e.matchUpTieIds.push(r),e}),{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(s.length>1||d.length>1||c.length>1||u.length>1)return en({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:mr},stack:r});let l,p,m={},f=[],h=[];if(!t.every((({orderOfFinish:e,matchUpId:t})=>(f.push(t),e&&h.push(e),m[t]=e,l=a.includes(t),p=void 0===e||Wr(e)&&Math.floor(e)>0,l&&p))))return en({result:{error:l?mr:De},info:(l?!p&&"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed")||void 0,stack:r});let g=i?.filter((e=>e.structureId===u[0]&&e.roundNumber===c[0]&&e.matchUpType===s[0]&&e.matchUpTieId===d[0]&&!f.includes(e.matchUpId)));for(let I of g??[]){let{orderOfFinish:e}=I||{};if(e){if(!Wr(e))return en({context:{orderOfFinish:e,matchUp:I},result:{error:mr},stack:r});h.push(e)}}if(ri(h).length!==h.length||Math.max(...h)>h.length)return en({info:"Values not unique or greater than expected number of values",result:{error:mr},stack:r});if(u.length){let t=Jp({matchUpFilters:{matchUpIds:o},structureId:u[0],drawDefinition:e,matchUpsMap:n});if(t.error)return en({result:t,stack:r});t.completedMatchUps?.forEach((e=>e.orderOfFinish=m[e.matchUpId]))}return{...I}}(e)}function xR({tournamentRecord:e,drawDefinition:t,matchUpId:r,lineUps:i,event:n}){if(!e)return{error:D};if(!t)return{error:A};if("string"!=typeof r)return{error:ke};if(!Array.isArray(i))return{error:mr,lineUps:i};let a=e.participants||[],o=bI({tournamentParticipants:a,inContext:!0,drawDefinition:t,matchUpId:r});if(o.error)return o;if(!o.matchUp)return{error:Ce};let{matchUp:s,structure:c}=o,{drawPositions:u,matchUpType:d}=s;if(d!==Iu)return{error:ke};if(!u?.length)return{error:L};let l=pp({matchUp:s,drawDefinition:t,structure:c,event:n})?.tieFormat,p={};for(let f of i){if(!Array.isArray(f))return{error:mr,lineUp:f};let t={},r=[];for(let e of f){if("object"!=typeof e)return{error:mr,lineUpAssignment:e};let{participantId:i,collectionAssignments:n=[]}=e;if(!Array.isArray(n))return{error:mr,collectionAssignments:n};let o=a.find((e=>e.participantId===i));if(!o)return{error:Ut};if(o.participantType!==Tu)return{error:mt};let c=s.sides?.find((e=>e.participant?.individualParticipantIds?.includes(i)))?.sideNumber;c&&r.push(c);for(let e of n){if("object"!=typeof e)return{error:mr,collectionAssignment:e};let{collectionId:r,collectionPosition:n}=e,a=l?.collectionDefinitions?.find((e=>e.collectionId===r));if(!a)return{error:mr,collectionId:r};let o=`${r}-${n}`;t[o]||(t[o]=[]);let s=t[o].length;if(hl(mu)(a.matchUpType)&&s||a.matchUpType===hu&&s>1)return{info:"Excessive collectionPosition assignments",error:mr};t[o].push(i)}}let i=Object.values(t);for(let s of i)if(2===s.length){let{participant:t}=Sp({tournamentParticipants:a,participantIds:s});if(!t){let t=UT({participant:{participantType:Ru,participantRole:hf,individualParticipantIds:s},pairOverride:!0,tournamentRecord:e});if(t.error)return t}}let n=Xr(r),o=((n[1]||0)>(n[2]||0)?1:(n[2]||0)>(n[1]||0)&&2)||void 0,c=Object.keys(p).map((e=>parseInt(e)));o&&!c.includes(o)&&(p[o]=f)}if(!Object.keys(p).length)return{error:Ur};if(o=bI({drawDefinition:t,matchUpId:r}),o.error)return o;if(!o.matchUp)return{error:Ce};let{matchUp:m}=o;m.sides||(m.sides=[]);for(let f of[1,2]){let e=m.sides.find((e=>e.sideNumber===f)),t=p[f];t&&(e?e.lineUp=t:m.sides.push({lineUp:t,sideNumber:f}))}return iu({tournamentId:e?.tournamentId,context:"applyLineUps",drawDefinition:t,matchUp:m}),{...I}}var _R={};n(_R,{anonymizeTournamentRecord:()=>rN,generate:()=>LR,generateEventWithDraw:()=>GM,generateOutcome:()=>EM,generateOutcomeFromScoreString:()=>VR,generateParticipants:()=>DM,generateTournamentRecord:()=>eN,modifyTournamentRecord:()=>iN,mutate:()=>tN});var LR={};function VR(e){let{matchUpFormat:t,matchUpStatus:r,winningSide:i,scoreString:n}=e;if(!n)return{outcome:{...NI,winningSide:i,matchUpStatus:r}};if(i&&![1,2,void 0].includes(i))return{error:mr,winningSide:i};let a=n&&uw({scoreString:n}),o={},s=Uy({sets:a,matchUpFormat:t}),c=Uy({sets:a,reversed:!0,matchUpFormat:t});return 2===i?(o.scoreStringSide1=c,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=c),o.sets=uw({scoreString:o.scoreStringSide1}),Zi({outcome:{matchUpStatus:r,winningSide:i,score:o}})}function BR({matchUpScheduleTimes:e,matchUpDependencies:t,allDateMatchUpIds:r,matchUp:i}){let n=(t?.[i.matchUpId]?.matchUpIds||[]).filter((e=>r.includes(e))).filter((t=>!e[t]));return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function jR({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:t,timeAfterRecovery:r,matchUp:i}){let{individualParticipantIds:n}=vu(i);r=r??i.schedule?.timeAfterRecovery;let a=t=>{e[t]||(e[t]=[]),e[t]=Yr(e[t].concat(...n))},o=e=>{r&&(!t[e]||r>t[e])&&(t[e]=r)},s=i.winnerTo?.matchUpId||i.winnerMatchUpId;s&&(r&&o(s),a(s));let c=i.loserTo?.matchUpId||i.loserMatchUpId;c&&(r&&o(c),a(c)),i.sidesTo?.length&&i.sidesTo.forEach((({matchUpId:e})=>{e&&(r&&o(e),a(e))}))}function GR({individualParticipantProfiles:e,participantId:t}){e[t]||(e[t]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function qR({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,typeChangeRecoveryMinutes:r,averageMatchUpMinutes:i=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:c}){let u=da(c?.schedule?.endTime),d=u?va(u,xr(o)):va(s,xr(i)+xr(o)),l=r&&(u?va(da(u),r):va(s,xr(i)+xr(r))),p=a?.[c.matchUpId]?.participantIds||[],m=(c.roundPosition&&e[c.matchUpId]||[]).flat();p.forEach((e=>{GR({individualParticipantProfiles:t,participantId:e});let r=t[e].priorMatchUpType!==c.matchUpType&&l||d;m.includes(e)?function({individualParticipantProfiles:e,recoveryValue:t,participantId:r,scheduleTime:i,drawId:n}){e[r].potentialRecovery[n]||(e[r].potentialRecovery[n]=[]),e[r].potentialRecovery[n].push(t),e[r].potentialBookings[n]||(e[r].potentialBookings[n]=[]),e[r].potentialBookings[n].push({timeAfterRecovery:t,scheduleTime:i})}({individualParticipantProfiles:t,drawId:c.drawId,recoveryValue:r,participantId:e,scheduleTime:s}):(t[e].timeAfterRecovery=r,t[e].bookings.push({scheduleTime:s,timeAfterRecovery:r}))})),jR({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:n,timeAfterRecovery:d,matchUp:c})}function $R({matchUpScheduleTimes:e,matchUpDependencies:t,scheduleTime:r,matchUpId:i,details:n}){let a,o=n.minutesMap?.[i]?.recoveryMinutes,s=va(r,(n.minutesMap?.[i]?.averageMinutes||0)+(o||0)),c=t?.[i]?.dependentMatchUpIds||[];if(c.length){let t=c.reduce(((t,r)=>{let i=e[r];if(!i)return t;let n={scheduleTime:i,matchUpId:r};return i&&!t.matchUpId||ca(i)<ca(t.scheduleTime)?n:t}),{});t.scheduleTime&&ca(s)>ca(t.scheduleTime)&&(a=t)}return{scheduledDependent:a}}n(LR,{generateEventWithDraw:()=>GM,generateOutcome:()=>EM,generateOutcomeFromScoreString:()=>VR,generateParticipants:()=>DM,generateTournamentRecord:()=>eN});var WR="DO_NOT_SCHEDULE",HR={DO_NOT_SCHEDULE:WR};function zR({averageMatchUpMinutes:e=90,requestConflicts:t={},potentials:r=!0,personRequests:i,scheduleTime:n,scheduleDate:a,matchUp:o}){let s=function(e){let{sides:t,matchUpType:r}=e||{};return(t||[]).map((e=>r===hu&&(e?.participant?.individualParticipants||[])||e?.participant&&[e.participant]||[])).flat()}(o).map((({person:e})=>e?.personId));if(r){let e=(o?.potentialParticipants||[]).flat().map((({person:e})=>e?.personId));s.push(...e)}let c=s.map((e=>i[e]?.map((t=>({...t,personId:e}))))).filter(Boolean).flat().filter((e=>e.requestType===WR&&wa(a,e.date))),u=[],d=o?.matchUpId,l=Ia(da(n),la(a)),p=da(ya(l,e).toISOString());for(let m of c){let{requestId:e,startTime:r,endTime:i}=m;(n>r&&n<i||p>r&&p<i)&&(u.push({matchUpId:d,request:m,scheduleTime:n}),t[e]?(t[e].scheduleTimes.includes(n)||t[e].scheduleTimes.push(n),t[e].matchUpIds.includes(d)||t[e].matchUpIds.push(d)):t[e]={request:m,scheduleTimes:[n],matchUpIds:[d]})}return{conflicts:u}}function YR({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,matchUp:r,value:i}){let{matchUpType:n}=r,{individualParticipantIds:a}=vu(r),o=(e[r.matchUpId]||[]).filter((e=>!ui(e,a))).flat();[...a,...o].forEach((e=>{if(GR({individualParticipantProfiles:t,participantId:e}),!t[e].potentialCounted[r.drawId]){let a=t[e].counters;a[n]?a[n]+=i:i>0&&(a[n]=i),a[Sl]?a[Sl]+=i:i>0&&(a[Sl]=i),o.includes(e)&&(t[e].potentialCounted[r.drawId]=!0)}}))}function KR({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:r,greatestAverageMinutes:i,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:c,scheduleDate:u,minutesMap:d,matchUps:l}){let p=[];r||(n=l?.filter((e=>{let t=e.schedule||{},r=e.matchUpStatus===Yo;return r&&p.push({tournamentId:e.tournamentId,matchUpId:e.matchUpId}),!r&&AD({schedule:t})&&(!u||e.schedule.scheduledDate===u)})),r=n.map(qo));let m=Array.isArray(c)?c.includes(u):c,f=m?[]:l.filter((({matchUpId:e})=>r.includes(e)));for(let h of f){YR({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,value:1,matchUp:h});let r=h.schedule?.scheduledTime;if(r){o[h.matchUpId]=r;let n=d?.[h.matchUpId]?.recoveryMinutes;qR({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:i,recoveryMinutes:n,scheduleTime:r,matchUp:h})}}return{dateScheduledMatchUpIds:r,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:m}}function QR({matchUpPotentialParticipantIds:e,scheduleCompletedMatchUps:t,dateScheduledMatchUpIds:r,matchUpNotBeforeTimes:i,matchUpScheduleTimes:n,orderedMatchUpIds:a,clearDate:o,matchUps:s}){let c=Object.keys(n),u=a.map((e=>s.find((t=>t.matchUpId===e)))).filter(Boolean).filter((e=>{let i=!o&&(r.includes(e.matchUpId)||c.includes(e.matchUpId)),n=[Yo,Xo,Qo,Ho,ns,ss,es,Zo].includes(e?.matchUpStatus);return t||!i&&!e.winningSide&&!n})),{matchUpMap:d}=u.reduce(((t,r)=>{let{drawId:n,tournamentId:a}=r;return t.matchUpMap[a]||(t.matchUpMap[a]={}),t.matchUpMap[a][n]?t.matchUpMap[a][n].push(r):t.matchUpMap[a][n]=[r],jR({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:i,matchUp:r}),t}),{matchUpMap:{}});return{matchUpsToSchedule:u,matchUpMap:d}}function JR({defaultRecoveryMinutes:e=0,averageMatchUpMinutes:t=90,dateScheduledMatchUps:r,tournamentRecords:i,venueIds:n=[],periodLength:a,scheduleDate:o,matchUps:s}){if("object"!=typeof i)return{error:P};if(!Ip(s)&&!Array.isArray(r))return{error:Oe};a=a??Ub({recoveryMinutes:e,averageMatchUpMinutes:t});let c=Object.assign({},...Object.values(i).map((e=>(e.events??[]).map((t=>{let{scheduleTiming:r}=ad({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:r}}})))).flat()),u={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]};r||(r=s?.filter((e=>{let t=e.schedule;return AD({schedule:t})&&(!o||e.schedule.scheduledDate===o)})));let d=r?.filter((e=>(!n.length||n.includes(e.schedule.venueId))&&e.matchUpStatus!==Yo));return{bookings:d?.map((({eventId:e,schedule:t,matchUpFormat:r})=>{let{event:i,scheduleTiming:n}=c[e],o=i?.eventType,s={...n,defaultTiming:u,matchUpFormat:r},{averageMinutes:d,recoveryMinutes:l}=Vl({timingDetails:s,eventType:o}),{courtId:p,venueId:m}=t,f=da(t.scheduledTime),h=va(f,d);return{recoveryMinutes:l,averageMinutes:d,periodLength:a,startTime:f,courtId:p,endTime:h,venueId:m}})).filter(Boolean),relevantMatchUps:d,dateScheduledMatchUps:r}}function XR({calculateStartTimeFromCourts:e=!0,remainingScheduleTimes:t,defaultRecoveryMinutes:r,averageMatchUpMinutes:i,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:c,startTime:u,venueIds:d,matchUps:l,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),"object"!=typeof a||!Object.keys(a).length)return{error:P};s=s??Ub({recoveryMinutes:r,averageMatchUpMinutes:i});let{courts:m,venues:f}=QP({dates:[c],ignoreDisabled:!0,tournamentRecords:a}),h=m?.filter((e=>!d||d.includes(e.venueId)))??[];u=u??yb({courts:h,scheduleDate:c,startTime:!0}),p=p??yb({courts:h,scheduleDate:c,endTime:!0});let{bookings:g,dateScheduledMatchUps:I}=JR({defaultRecoveryMinutes:r,averageMatchUpMinutes:i,tournamentRecords:a,scheduleDate:c,periodLength:s,venueIds:d,matchUps:l}),U={calculateStartTimeFromCourts:e,remainingScheduleTimes:t,averageMatchUpMinutes:i,clearScheduleDates:n,date:c,periodLength:s,startTime:u,bookings:g,endTime:p,courts:h},{scheduleTimes:v}=Sb(U),y=1===d?.length&&d[0]||1===f?.length&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:I?.map(fm("matchUpId")),dateScheduledMatchUps:I,scheduleTimes:v,venueId:y}}function ZR({scheduledRoundsDetails:e,greatestAverageMinutes:t,garmanSinglePass:r}){let i,n,a,o,s=[],c=[];for(let u of e.filter(Boolean))o||(o=u.hash),(u.hash===o||r)&&(c=c.concat(u.matchUpIds)),u.hash!==o&&!r&&(o=u.hash,s.push({averageMinutes:a,recoveryMinutes:n,roundPeriodLength:i,matchUpIds:c}),c=u.matchUpIds),a=r?t:u.averageMinutes,n=u.recoveryMinutes,i=u.roundPeriodLength;return c.length&&s.push({matchUpIds:c,roundPeriodLength:i,recoveryMinutes:n,averageMinutes:a}),{groupedRounds:s}}function eM({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,scheduleCompletedMatchUps:r,containedStructureIds:i,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:c,periodLength:u,scheduleDate:d,useGarman:l,matchUps:p,courts:m,venues:f}){let h={},g=[],I=[],U=[];for(let v of f){let{rounds:f=[],venueId:y}=v,{scheduledRoundsDetails:S,greatestAverageMinutes:w,orderedMatchUpIds:P,minutesMap:D}=nD({scheduleCompletedMatchUps:r,containedStructureIds:i,tournamentRecords:c,periodLength:u,matchUps:p,rounds:f});U.push(...P??[]);let T,b,{groupedRounds:R}=ZR({scheduledRoundsDetails:S,greatestAverageMinutes:w,garmanSinglePass:!0}),M=[];l&&({scheduleTimes:M,dateScheduledMatchUpIds:T,dateScheduledMatchUps:b}=XR({averageMatchUpMinutes:R[0]?.averageMinutes,scheduleDate:la(d),venueIds:[v.venueId],clearScheduleDates:s,tournamentRecords:c,periodLength:u,matchUps:p}));let N=KR({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:T,greatestAverageMinutes:w,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:d,minutesMap:D,matchUps:p});({dateScheduledMatchUpIds:T,dateScheduledMatchUps:b}=N);let{byeScheduledMatchUpDetails:A,clearDate:E}=N;A?.length&&I.push(...A);let{matchUpsToSchedule:C,matchUpMap:O}=QR({matchUpPotentialParticipantIds:e,scheduleCompletedMatchUps:r,dateScheduledMatchUpIds:T,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:P,clearDate:E,matchUps:p}),F=m.filter((e=>e.venueId===y));h[y]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:w,scheduledRoundsDetails:S,dateScheduledMatchUps:b,matchUpsToSchedule:C,scheduleTimes:M,groupedRounds:R,venueCourts:F,minutesMap:D,matchUpMap:O},s||g.push(...T)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:h,allDateMatchUpIds:U}}function tM({individualParticipantProfiles:e,matchUpNotBeforeTimes:t,matchUpDependencies:r,scheduleTime:i,matchUp:n,details:a}){let o=(r?.[n.matchUpId]?.participantIds||[]).flat(),s=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,c=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,u=o.every((t=>{GR({individualParticipantProfiles:e,participantId:t});let r=e[t];if(!r.timeAfterRecovery)return!0;let a=da(n?.schedule?.endTime),o=a?va(a,xr(c)):va(i,xr(s)+xr(c));return![...Object.keys(r.potentialBookings).filter((e=>e!==n.drawId)).map((e=>r.potentialBookings[e])).flat(),...r.bookings].find((e=>function(e,t){let r=ca(e.scheduleTime),i=ca(e.timeAfterRecovery),n=ca(t.scheduleTime),a=ca(t.timeAfterRecovery),o=r>n&&r<a,s=n>r&&n<i,c=i>n&&i<a,u=a>r&&a<i;return Zi({hasOverlap:r===n||i===a||o||c||s||u,startAisContained:o,endAisContained:c,startBisContained:s,endBisContained:u},!0)}({scheduleTime:i,timeAfterRecovery:o},e).hasOverlap))})),d=t[n.matchUpId],l=(d?Ua(Ia(d),Ia(i),!1):0)>=0;return{enoughTime:u&&l}}function rM({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpDailyLimits:r={},matchUp:i}){let{enteredIndividualParticipantIds:n}=vu(i),{matchUpId:a,matchUpType:o}=i,s=(i.roundPosition&&t[a]||[]).flat(),c=Yr(n.concat(...s));return c.forEach((t=>{GR({individualParticipantProfiles:e,participantId:t})})),{participantIdsAtLimit:c.filter((t=>{let i=e[t];if(i)return[o,Sl].find((e=>{let t=i.counters?.[e]||0,n=r[e]||0;return t&&n&&t>=n}))})),relevantParticipantIds:c}}function iM({scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:t=!1,errorOnAnachronism:r=!1,checkChronology:i=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:c,matchUpIds:u,schedule:d}){if(!s)return{error:D};if(!(c||u&&Array.isArray(u)))return{error:Ee};if(!(c||d&&"object"==typeof d))return{error:rr};let l,p=[],m=0;if(i&&!n){let e=Im({tournamentRecords:o,tournamentRecord:s});n=e.matchUpDependencies,l=e.matchUps}l||(l=cm({tournamentRecord:s})?.matchUps??[]);let f=l.reduce(((r,i)=>{let{matchUpId:n,drawId:a,matchUpStatus:o}=i;return(t||o!==Yo)&&(e||!ms.includes(o))&&(r[a]?r[a].push(n):r[a]=[n]),r}),{}),h=c?.map((e=>e.matchUpId));for(let g of Object.keys(f)){let{drawDefinition:e}=RU({tournamentRecord:s,drawId:g});if(!e)continue;let t=f[g].filter((e=>u?.includes(e)??h?.includes(e))),I=lm({inContext:!1,drawDefinition:e}).matchUps;for(let u of t){let t=pR({schedule:c?.find((e=>e.matchUpId===u))?.schedule||d,matchUpDependencies:n,errorOnAnachronism:r,removePriorValues:a,inContextMatchUps:l,tournamentRecords:o,tournamentRecord:s,checkChronology:i,drawDefinition:e,drawMatchUps:I,matchUpId:u});if(t?.warnings?.length&&p.push(...t.warnings),t?.success&&(m+=1),t.error)return t}}return p.length?{...I,scheduled:m,warnings:p}:{...I,scheduled:m}}function nM(e){let{scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:r=!1,errorOnAnachronism:i,matchUpContextIds:n,removePriorValues:a,tournamentRecords:o,checkChronology:s,matchUpDetails:c,schedule:u}=e;if(e.matchUpIds&&!n)return iM(e);let d=xn(e,[{[tn]:!0},{[On]:{matchUpContextIds:!1,matchUpDetails:!1},[An]:mr,[En]:Rn}]);if(d.error)return d;if((!c||n)&&!u)return{error:He,info:"schedule is required"};let l=[],p=0,{matchUpDependencies:m}=Im({tournamentRecords:o});for(let f of Object.values(o)){let{tournamentId:e}=f,d=n?.filter((t=>t.tournamentId===e)).map(qo),h=c?.filter((t=>t?.tournamentId===e));if(d?.length||h?.length){let e=iM({matchUpDetails:h,scheduleCompletedMatchUps:t,scheduleByeMatchUps:r,matchUpDependencies:m,errorOnAnachronism:i,removePriorValues:a,tournamentRecords:o,tournamentRecord:f,checkChronology:s,matchUpIds:d,schedule:u});if(e.warnings?.length&&l.push(...e.warnings),e.scheduled&&(p+=e.scheduled),e.error)return e}}return l.length?{...I,scheduled:p,warnings:l}:{...I,scheduled:p}}function aM({autoSchedulingAudit:e,tournamentRecords:t}){ki({topic:Ac,payload:e});let r=e=>e?Object.values(e).reduce(((e,t)=>e+t.length||0),0):0,i=(e?.schedulingProfile||[]).reduce(((e,t)=>e+t.venues.reduce(((e,t)=>e+t.rounds.length),0)),0),n={scheduledDatesCount:e.scheduledDates?.length,noTimeMatchUpIdsCount:r(e?.noTimeMatchUpIds),scheduledMatchUpIdsCount:r(e?.scheduledMatchUpIds),overLimitMatchUpIdsCount:r(e?.overLimitMatchUpIds),requestConflictsCount:r(e?.requestConflicts),profileRoundsCount:i},a={itemType:RT,itemValue:n};for(let o of Object.values(t))sg({tournamentRecord:o,timeItem:a})}function oM({averageMinutes:e,startTime:t,endTime:r,court:i,date:n}){if(!Array.isArray(i.dateAvailability))return{error:He,stack:"getEarliestCourtTime"};let a=yb({scheduleDate:n,courts:[i],startTime:!0}),o=yb({scheduleDate:n,courts:[i],endTime:!0});t=t||a,r=r||o;let s=fb({court:i,date:n}),{timeSlots:c}=hb({courtDate:s}),u=Ia(t),d=Ia(r);return{earliestCourtTime:c?.reduce(((t,r)=>{let i=Ia(r.startTime),n=Ia(r.endTime);if(i>d||n<u)return t;let a=u>i?u:i;if(Ua(a,n)>=e){let e=da(a.toISOString());(!t||e<t)&&(t=e)}return t}),void 0),courtStartTime:a,courtEndTime:o}}function sM(e){let{scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:r=ms,scheduledDates:i,venueIds:n}=e,a=yu(e),o=d(a)?Object.values(a).map((({tournamentId:e})=>e)).filter(Boolean):[];if(!o?.length)return{error:P};let s=0;for(let c of o){let e=cM({ignoreMatchUpStatuses:r,scheduleAttributes:t,tournamentRecord:a[c],scheduledDates:i,venueIds:n});if(e.error)return e;s+=e.clearedScheduleCount??0}return{...I,clearedScheduleCount:s}}function cM({scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:t=ms,tournamentRecord:r,scheduledDates:i,venueIds:n=[]}){if("object"!=typeof r)return{error:D};if(!Array.isArray(t)||!Array.isArray(n))return{error:mr};n.length&&e.push("venueId");let a=cm({matchUpFilters:{scheduledDates:i},tournamentRecord:r}).matchUps??[],o={};a.forEach((({matchUpStatus:r,schedule:i,drawId:a,matchUpId:s})=>{(!r||!t.includes(r))&&AD({schedule:i,scheduleAttributes:e})&&(!n?.length||n.includes(i.venueId))&&(o[a]||(o[a]=[]),o[a].push(s))}));let s=r.tournamentId,c=0;for(let u in o){let{event:e,drawDefinition:t}=sp({tournamentRecord:r,drawId:u}),i=lm({drawDefinition:t,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let r of i){let i=!1;r.timeItems=(r.timeItems??[]).filter((e=>{let t=e?.itemType&&![jd,Gd,Bd,$d,zd].includes(e?.itemType);return t||(i=!0),t})),i&&(iu({context:"clear schedules",eventId:e?.eventId,drawDefinition:t,tournamentId:s,matchUp:r}),c+=1)}}return{...I,clearedScheduleCount:c}}function uM(e){let{checkPotentialRequestConflicts:t=!0,scheduleCompletedMatchUps:r,clearScheduleDates:i,scheduleDates:n=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:c,pro:u}=e,d=xn(e,[{[tn]:!0},{[Mn]:e=>!e||Array.isArray(e)&&e.every(Zn),[cn]:!1,[En]:Rn}]);if(d.error)return d;let l=sD({tournamentRecords:a});if(l.error)return l;if(!l.schedulingProfile.length)return{...I};let{modifications:p,issues:m=[],schedulingProfile:f=[]}=l,h=Object.assign({},...Object.values(a).map((e=>lu({tournamentRecord:e}).containedStructures))),g=n.map((e=>{if(Zn(e))return la(e)})).filter(Boolean),U=f.map((e=>e.scheduleDate)).map((e=>Zn(e)&&la(e))).filter((e=>e&&(!n.length||g.includes(e))));if(!U.length)return{error:Ye};if(i&&!c){sM({tournamentRecords:a,scheduledDates:Array.isArray(i)?i:[]})}let v=QP({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:y}=um({matchUpFilters:{matchUpTypes:[mu,hu]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:S}=Im({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:y}),{matchUpDailyLimits:w}=LD({tournamentRecords:a}),{personRequests:P}=lD({requestType:WR,tournamentRecords:a}),D={schedulingProfileModifications:p,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:r,schedulingProfileIssues:m,dateSchedulingProfiles:f.filter((e=>{let t=la(e?.scheduleDate);return U.includes(t)})).sort(((e,t)=>new Date(e.scheduleDate).getTime()-new Date(t.scheduleDate).getTime())),containedStructureIds:h,matchUpDependencies:S,matchUpDailyLimits:w,clearScheduleDates:i,tournamentRecords:a,schedulingProfile:f,personRequests:P,periodLength:o,useGarman:s,matchUps:y,dryRun:c,courts:v};return u?function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:r,schedulingProfileIssues:i,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:c,tournamentRecords:u,periodLength:d=30,schedulingProfile:l,personRequests:p,matchUps:m=[],courts:f,dryRun:h}){let g={},U={},v={},y={},S={},w={},P={},D={},T={};for(let I of n??[]){let e=la(I?.scheduleDate),i=I?.venues||[],n={},l={},b=(e,t)=>{e.forEach((e=>{let r=l[e].counters;r[t]?r[t]+=1:r[t]=1,r[Sl]?r[Sl]+=1:r[Sl]=1}))};g[e]={},U[e]={},w[e]=[],P[e]=[],D[e]=[],T[e]=[];let R={};m?.forEach((t=>{t.schedule?.scheduledDate&&wa(e,la(t.schedule.scheduledDate))&&jR({matchUpPotentialParticipantIds:n,matchUpNotBeforeTimes:R,matchUp:t})}));let M,{allDateScheduledByeMatchUpDetails:N,allDateScheduledMatchUpIds:A,venueScheduledRoundDetails:E,allDateMatchUpIds:C}=eM({matchUpPotentialParticipantIds:n,individualParticipantProfiles:l,scheduleCompletedMatchUps:r,containedStructureIds:a,matchUpNotBeforeTimes:R,matchUpScheduleTimes:S,matchUpDependencies:o,clearScheduleDates:c,tournamentRecords:u,periodLength:d,scheduleDate:e,matchUps:m,courts:f,venues:i}),O=m?.filter((({matchUpId:e})=>A.includes(e))),{bookings:F}=JR({dateScheduledMatchUps:O,tournamentRecords:u,scheduleDate:e,periodLength:d}),{virtualCourts:k}=Ib({scheduleDate:e,periodLength:d,bookings:F,courts:f}),x=k?.reduce(((t,r)=>{let{earliestCourtTime:i,courtEndTime:n}=oM({date:e,averageMinutes:0,court:r});return(!t.startTime||Ia(i)<Ia(t.startTime))&&(t.startTime=i),(!t.endTime||Ia(n)>Ia(t.endTime))&&(t.endTime=n),t}),{}),_=x.startTime,L=({courtId:e,booking:t})=>k?.find((t=>t.courtId===e))?.dateAvailability[0].bookings.push(t),V=10,B=0;for(;!M;){for(let{venueId:r}of i){let i,a=E[r],c=a.matchUpsToSchedule.length,u=[],m=[],f=0;for(;!i;){for(let c of a.matchUpsToSchedule){if(m.length===a.courtsCount||u.length===a.courtsCount){i=!0;break}let{matchUpId:f,matchUpType:h}=c,{participantIdsAtLimit:I,relevantParticipantIds:w}=rM({matchUpPotentialParticipantIds:n,individualParticipantProfiles:l,matchUpDailyLimits:s,matchUp:c});if(I.length){P[e].includes(f)||P[e].push(f);continue}let{dependenciesScheduled:D,remainingDependencies:M}=BR({matchUpScheduleTimes:S,matchUpDependencies:o,allDateMatchUpIds:C,matchUp:c});if(!D){U[e][f]||(U[e][f]=[]),U[e][f].push({remainingDependencies:M});continue}let N=[],A=k?.reduce(((r,i)=>{if(m.includes(i.courtId))return r;let{earliestCourtTime:s}=oM({averageMinutes:a.greatestAverageMinutes,startTime:_,date:e,court:i});if(r.scheduleTime&&ca(s)>=ca(r.scheduleTime))return r;let{scheduledDependent:u}=$R({matchUpScheduleTimes:S,matchUpDependencies:o,scheduleTime:s,matchUpId:f,details:a});if(u)return r;let{enoughTime:d}=tM({individualParticipantProfiles:l,matchUpNotBeforeTimes:R,matchUpDependencies:o,scheduleTime:s,details:a,matchUp:c});if(!d)return g[e][f]||(g[e][f]=[]),g[e][f].includes(s)||g[e][f].push(s),r;let I=a.minutesMap?.[f]?.averageMinutes||a.greatestAverageMinutes,{conflicts:U}=zR({potentials:t,averageMatchUpMinutes:I,requestConflicts:T,personRequests:p,scheduleTime:s,scheduleDate:e,matchUp:c});if(U?.length)return N.push(...U),!1;b(w,h);let v=a.minutesMap?.[f]?.recoveryMinutes;return qR({matchUpPotentialParticipantIds:n,individualParticipantProfiles:l,matchUpNotBeforeTimes:R,averageMatchUpMinutes:I,matchUpDependencies:o,recoveryMinutes:v,scheduleTime:s,matchUp:c}),(!r.scheduleTime||ca(s)<ca(r.scheduleTime))&&(r.averageMatchUpMinutes=I,r.recoveryMinutes=v,r.scheduleTime=s,r.courtName=i.courtName,r.courtId=i.courtId),r}),{});if(A.scheduleTime){let{averageMatchUpMinutes:e,recoveryMinutes:t,scheduleTime:i,courtId:n}=A;S[f]=i,y[f]=n,u.push(f),m.push(n);let o=i,s=va(o,e);L({courtId:n,booking:{averageMatchUpMinutes:e,recoveryMinutes:t,periodLength:d,matchUpId:f,startTime:o,courtId:n,endTime:s,venueId:r}}),a.matchUpsToSchedule=a.matchUpsToSchedule.filter((e=>e.matchUpId!==f))}else N?.length&&(v[e]||(v[e]=[]),v[e].push(...N))}(m.length===a.courtsCount||u.length===a.courtsCount||!a.matchUpsToSchedule.length)&&(i=!0),a.matchUpsToSchedule.length&&u<a.courtsCount&&(Ia(_)<Ia(x.endTime)?_=va(_,d):(i=!0,a.complete=!0)),f+=1,!i&&f>=c&&(i=!0)}a.matchUpsToSchedule?.length||(a.complete=!0)}B+=1,M=i.every((({venueId:e})=>E[e].complete))||B===V}for(let{venueId:t}of i){let r=E[t].matchUpMap;Object.keys(r).forEach((t=>{let i=u[t];i&&Object.keys(r[t]).forEach((n=>{let{drawDefinition:a}=RU({tournamentRecord:i,drawId:n});a&&r[t][n].forEach((({matchUpId:t})=>{let r=S[t],n=y[t];if(r){let o=r.split(":").map(Sa).join(":"),s=`${la(e)}T${o}`;h||(aR({drawDefinition:a,scheduledTime:s,matchUpId:t}),dR({courtDayDate:e,tournamentRecords:u,tournamentRecord:i,drawDefinition:a,matchUpId:t,courtId:n})),w[e].push(t)}}))}))})),D[e]=E[t].matchUpsToSchedule.map(qo)}!h&&N?.length&&nM({matchUpDetails:N,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let t of I.venues)for(let r of t.rounds){let t=(r.matchUps??[]).map((({matchUpId:e})=>e))?.filter((t=>w[e].includes(t)));r.canScheduledMatchUpIds=t;let i=Math.round((t?.length||0)/r.matchUpsCount*1e4)/100;(i===1/0||isNaN(i))&&(i=void 0),r.possibleToSchedulePct=i,r.matchUpsCount===t?.length&&(r.possibleToSchedule=!0)}}let b=(n??[]).map((({scheduleDate:e})=>e)),R={timeStamp:Date.now(),overLimitMatchUpIds:P,scheduledMatchUpIds:w,schedulingProfile:l,noTimeMatchUpIds:D,requestConflicts:T,scheduledDates:b};return aM({tournamentRecords:u,autoSchedulingAudit:R}),{...I,schedulingProfileModifications:e,schedulingProfileIssues:i,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:U,matchUpScheduleTimes:S,overLimitMatchUpIds:P,scheduledMatchUpIds:w,noTimeMatchUpIds:D,requestConflicts:T,scheduledDates:b}}(D):function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:r,schedulingProfileIssues:i,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:c,tournamentRecords:u,schedulingProfile:d,personRequests:l,periodLength:p,matchUps:m,courts:f,dryRun:h}){let g={},U={},v={},y={},S={},w={},P={},D={},T={},b={};for(let I of n){let e=la(I?.scheduleDate),i=I?.venues||[],n={},d={},R=(e,t)=>{e.forEach((e=>{let r=d[e].counters;r[t]?r[t]+=1:r[t]=1,r[Sl]?r[Sl]+=1:r[Sl]=1}))};v[e]={},y[e]={},g[e]={},U[e]={},P[e]=[],D[e]=[],T[e]=[],b[e]=[];let M={};m.forEach((t=>{t.schedule?.scheduledDate&&wa(e,la(t.schedule.scheduledDate))&&jR({matchUpPotentialParticipantIds:n,matchUpNotBeforeTimes:M,matchUp:t})}));let N,{allDateScheduledByeMatchUpDetails:A,venueScheduledRoundDetails:E,allDateMatchUpIds:C}=eM({matchUpPotentialParticipantIds:n,individualParticipantProfiles:d,scheduleCompletedMatchUps:r,containedStructureIds:a,matchUpNotBeforeTimes:M,matchUpScheduleTimes:w,matchUpDependencies:o,clearScheduleDates:c,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:e,matchUps:m,courts:f,venues:i}),O=10,F=0,k=10;for(;!N;){for(let{venueId:r}of i){let i=0,a=E[r];for(;a.courtsCount&&a.scheduleTimes?.length&&a.matchUpsToSchedule?.length&&i<=a.courtsCount;){let{scheduleTime:c,attempts:u=0}=a.scheduleTimes.shift(),p=a.matchUpsToSchedule.find((r=>{let{matchUpId:i,matchUpType:u}=r,{participantIdsAtLimit:p,relevantParticipantIds:m}=rM({matchUpPotentialParticipantIds:n,individualParticipantProfiles:d,matchUpDailyLimits:s,matchUp:r});if(p.length)return D[e].includes(i)||D[e].push(i),!1;let{scheduledDependent:f}=$R({matchUpScheduleTimes:w,matchUpDependencies:o,scheduleTime:c,matchUpId:i,details:a});if(f)return!1;let{dependenciesScheduled:h,remainingDependencies:g}=BR({matchUpScheduleTimes:w,matchUpDependencies:o,allDateMatchUpIds:C,matchUp:r});if(!h)return y[e][i]||(y[e][i]=[]),y[e][i].push({scheduleTime:c,remainingDependencies:g}),!1;let{enoughTime:I}=tM({individualParticipantProfiles:d,matchUpNotBeforeTimes:M,matchUpDependencies:o,scheduleTime:c,details:a,matchUp:r});if(!I)return v[e][i]||(v[e][i]=[]),v[e][i].push({scheduleTime:c}),!1;let U=a.greatestAverageMinutes,{conflicts:P}=zR({potentials:t,averageMatchUpMinutes:U,requestConflicts:b,personRequests:l,scheduleTime:c,scheduleDate:e,matchUp:r});if(P?.length)return S[e]||(S[e]=[]),S[e].push(...P),!1;R(m,u);let T=a.minutesMap?.[i]?.recoveryMinutes;return qR({matchUpPotentialParticipantIds:n,individualParticipantProfiles:d,matchUpNotBeforeTimes:M,averageMatchUpMinutes:U,matchUpDependencies:o,recoveryMinutes:T,scheduleTime:c,matchUp:r}),w[i]=c,!0}));a.matchUpsToSchedule=a.matchUpsToSchedule.filter((({matchUpId:e})=>e!==p?.matchUpId)),p?i+=1:(U[e][r]||(U[e][r]=[]),U[e][r].push({scheduleTime:c,attempts:u+1}))}a.matchUpsToSchedule?.length&&(U[e][r]=U[e][r]?.filter((e=>{let t=e.attempts<O;return t&&a.scheduleTimes.push(e),!t}))),(!a.scheduleTimes?.length||!a.matchUpsToSchedule?.length)&&(a.complete=!0)}F+=1,N=i.every((({venueId:e})=>E[e].complete))||F===k}for(let{venueId:t}of i){let r=E[t].matchUpMap;Object.keys(r).forEach((i=>{let n=u[i];n&&Object.keys(r[i]).forEach((a=>{let{drawDefinition:o}=RU({tournamentRecord:n,drawId:a});o&&r[i][a].forEach((({matchUpId:r})=>{let i=w[r];if(i){let a=i.split(":").map(Sa).join(":"),s=`${la(e)}T${a}`;h?P[e].push(r):(aR({drawDefinition:o,scheduledTime:s,matchUpId:r}).success&&P[e].push(r),t&&uR({tournamentRecord:n,drawDefinition:o,matchUpId:r,venueId:t}))}}))}))})),T[e]=E[t].matchUpsToSchedule.map(qo),g[e][t]=E[t].scheduleTimes.sort(((e,t)=>ca(e.scheduleTime)-ca(t.scheduleTime)))}!h&&A?.length&&nM({matchUpDetails:A,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let t of I.venues)for(let r of t.rounds){let t=(r.matchUps?.map((({matchUpId:e})=>e))||[]).filter((t=>P[e].includes(t)));r.canScheduledMatchUpIds=t;let i=Math.round(t.length/r.matchUpsCount*1e4)/100;(i===1/0||isNaN(i))&&(i=0),r.possibleToSchedulePct=i,r.matchUpsCount===t.length&&(r.possibleToSchedule=!0)}}let R=n.map((({scheduleDate:e})=>e)),M={timeStamp:Date.now(),overLimitMatchUpIds:D,scheduledMatchUpIds:P,schedulingProfile:d,noTimeMatchUpIds:T,requestConflicts:b,scheduledDates:R};return aM({tournamentRecords:u,autoSchedulingAudit:M}),{...I,schedulingProfileModifications:e,schedulingProfileIssues:i,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:U,recoveryTimeDeferredMatchUpIds:v,dependencyDeferredMatchUpIds:y,matchUpScheduleTimes:w,overLimitMatchUpIds:D,scheduledMatchUpIds:P,noTimeMatchUpIds:T,requestConflicts:b,scheduledDates:R}}(D)}function dM(e){let t=e||{};return t.tournamentId||(t.tournamentId=Jl()),(!t.startDate||oa(t.startDate)||Hn.test(t.startDate))&&(!t.endDate||oa(t.endDate)||Hn.test(t.endDate))?(t.extensions&&(t.extensions=t.extensions.filter(Ha)),{...t}):{error:Xe}}function lM({addParticipants:e=!0,participantAttribute:t,tournamentRecord:r,personAttribute:i,teamNames:n,accessor:a,uuids:o}){if(!r)return{error:D};let s={},c=(r.participants??[]).filter((({participantType:e,participantRole:t})=>e===Tu&&t===hf)),u=0;for(let f of c){let e=a&&pm({element:f,accessor:a})?.value||i&&f.person?.[i]||t&&f[t];if(e){if(!Object.keys(s).includes(e)){s[e]={participantName:n?.[u]??e,participantId:o?.pop()??Jl(),individualParticipantIds:[],participantRole:hf,participantType:Mu};let r={value:i??t,name:go};za({element:s[e],extension:r}),u+=1}s[e].individualParticipantIds.push(f.participantId)}}let d=Object.keys(s),l=(r.participants??[]).map((e=>{if(e.participantType!==Mu||e.participantRole!==hf)return;let{extension:t}=no({name:go,element:e}),r=t?.value;return d.includes(r)?e.participantId:void 0})).filter(Boolean),p=0,m=[];return Object.keys(s).forEach((t=>{let i=s[t],{participantId:n}=i;l.includes(n)||(r.participants||(r.participants=[]),e&&r.participants.push(i),m.push(i),p++)})),e&&p?(ki({payload:{tournamentId:r.tournamentId,participants:m},topic:Rc}),{...I,participantsAdded:p}):m.length?{...I,newParticipants:m}:{error:nt}}var pM=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],mM=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function fM({count:e=1,participantsCount:t=32}={}){let r=Qr(mM),i=r.slice(0,e);return{cities:ai(0,t).map((t=>t<Math.min(e,r.length)?i[t]:ni(i)))}}function hM({count:e=1,participantsCount:t=32}={}){let r=Qr(pM),i=r.slice(0,e).map((e=>Object.keys(e))).flat();return{states:ai(0,t).map((t=>t<Math.min(e,r.length)?i[t]:ni(i)))}}function gM({count:e=1,participantsCount:t=32}={}){let r=ai(0,e).map((()=>ai(0,5).map((()=>$r(0,9))).join("")));return{postalCodes:ai(0,t).map((t=>t<e?r[t]:ni(r)))}}function IM({idPrefix:e,participantType:t,index:r,uuids:i}){return e?`${e}-${t===Tu?"I":Ru?"P":Mu?"T":bu?"G":"X"}-${r}`:i?.pop()||Jl()}function UM(e){let{cities:t,states:r,postalCodes:i,nationalityCode:n,participantIndex:a}=e;return{postalCode:i?.[a],state:r?.[a],city:t?.[a],countryCode:n}}var vM={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function yM(e){let{count:t=100,sex:r}=e||{};if(!t||r&&![$p,zp].includes(r))return{personData:[],error:mr};let i=Math.ceil(1.3*t),{lastNames:n,firstFemale:a,firstMale:o}=vM,s=Cu.map((({iso:e})=>e)).filter(Boolean),c=Math.ceil(i/n.length),u=Math.ceil(i/a.length),d=Math.ceil(i/o.length),l=ai(0,c).flatMap((()=>{let e=Da(n,!1,!0);return ai(0,n.length).map((()=>ii(e)))})),p=ai(0,u).flatMap((()=>{let e=Da(a,!1,!0);return ai(0,a.length).map((()=>ii(e)))})),m=ai(0,d).flatMap((()=>{let e=Da(o,!1,!0);return ai(0,o.length).map((()=>ii(e)))})),f={};for(let h=0;h<i;h++){let e=l.pop(),t=r||ni([$p,zp]),i=t===$p?m.pop():p.pop(),n=ni(s);f[`${i}${e}`]={nationalityCode:n,sex:t,firstName:i,lastName:e}}return{personData:Object.values(f).slice(0,t)}}function SM(e){let t=e?.count||1,{personExtensions:r,consideredDate:i,isMock:n=!0,gendersCount:a,personData:o,category:s,sex:c}=e||{};if(isNaN(t))return{error:mr};let u=a?.[$p]||c===$p&&t||0,d=a?.[zp]||c===zp&&t||0;t=Math.max(t,u+d);let l=t-(u+d),p=[...u&&yM({count:u,sex:$p}).personData||[],...d&&yM({count:d,sex:zp}).personData||[],...l&&yM({count:l}).personData||[]],m=p.filter((e=>!c||u&&d||e.sex===c)),f=[];if(Array.isArray(o)){let e=o.filter((e=>!("string"!=typeof e.firstName||"string"!=typeof e.lastName||e.sex&&![$p,zp].includes(e.sex)||e.nationalityCode&&("string"!=typeof e.nationalityCode||e.nationalityCode.length>3||!Cu.find((({iso:t,ioc:r})=>[t,r].includes(e.nationalityCode)))))&&(e.nationalityCode&&f.push(e.nationalityCode),!0)));if(!e.length)return{error:mr};m=e}let h=o?m:Qr(m);if(h.length<t){let{maleFirstNames:e,maleLastNames:r,femaleFirstNames:i,femaleLastNames:n,nationalityCodes:a}=p.reduce(((e,t)=>{let{firstName:r,lastName:i,nationalityCode:n}=t;return t.sex===$p?(e.maleFirstNames.includes(r)||e.maleFirstNames.push(r),e.maleLastNames.includes(i)||e.maleLastNames.push(i)):(e.femaleFirstNames.includes(r)||e.femaleFirstNames.push(r),e.femaleLastNames.includes(i)||e.femaleLastNames.push(i)),e.nationalityCodes.includes(n)||e.nationalityCodes.push(n),e}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});ai(0,t-h.length).forEach((()=>{let t=c||ni([$p,zp]),o=ni(a),s={firstName:ni(t===$p?e:i),lastName:ni(t===$p?r:n),sex:t,nationalityCode:o};h.push(s)}))}let{ageMinDate:g,ageMaxDate:I}=HI({consideredDate:i,category:s}),U=xr(g?.slice(0,4)||0)||xr(I?.slice(0,4)||0)-3,v=xr(I?.slice(0,4)||0)||xr(g?.slice(0,4)||0)+3,y=(g||I)&&[U,v],S=h.slice(0,t).map(((e,t)=>{let[i,a]=y||[],o=y&&ii(ai(i,a)),s=ii(ai(0,365)),c=o&&function(e,t,r){let i=new Date(e,0);return ta(new Date(i.setDate(t)),r)}(o,s);return Object.assign(Zi({extensions:r||[{name:"regionCode",value:t+1}],birthDate:c,isMock:n}),e)}));return{persons:S.length&&S||h[0],nationalityCodes:f}}var wM=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function PM({nameRoot:e="TEAM",count:t=1}={}){let r=Qr(wM).slice(0,t);return r.length<t&&ai(0,t-r.length).forEach((t=>r.push(`${e} ${t+1}`))),{names:r}}function DM(e){let{rankingRange:t,scaledParticipantsCount:r}=e,{ratingsParameters:i=Qg,valuesInstanceLimit:n,consideredDate:a,category:o,nationalityCodesCount:s,nationalityCodeType:c,nationalityCodes:u,participantsCount:d=32,participantType:l,personIds:p,idPrefix:m,uuids:f,personExtensions:h,addressProps:g,gendersCount:U,matchUpType:v,personData:y,sex:S,inContext:w,withISO2:P,withIOC:D,scaleAllParticipants:T}=e,b=l===Ru||v===fu,R=l===Mu||v===Mu;t&&(!Array.isArray(t)||!t.every((e=>jr(e)))||2!==t.length)&&(t=void 0),r=T?d:r;t=t||[1,r&&r>1e3?r:1e3],t[1]+=1;let M=d*(b?2:R?8:1),N=SM({count:M,personExtensions:h,consideredDate:a,gendersCount:U,personData:y,category:o,sex:S});if(N.error)return N;let{nationalityCodes:A,persons:E}=N,C=[],O=[],F=[],k=[];if("object"==typeof o){let{categoryName:e,ageCategoryCode:n,ratingType:a}=o;if((e||n)&&!a){let[e,i]=t||[];if(O=Qr(ai(e,i)).slice(0,r||$r(20,30)),[Ru,Mu].includes(l)){let[e,i]=t||[];C=Qr(ai(e,i)).slice(0,r||$r(20,30))}}if(a&&i[a]){let{ratingMax:e,ratingMin:t,ratingAttributes:n}=o,s={...i[a],...n||{}},{attributes:c={},decimalsCount:u,accessors:d,range:p,step:m}=s,f=e=>{let t={},r=Object.keys(e||{});for(let i of r){let r=e[i];if("object"==typeof r&&r.generator){let{range:e}=r,[n,a]=e.slice().sort();t[i]=$r(n,a)}else t[i]=r}return t},h=p[0]>p[1]?2:.5,[g,I]=p.slice().sort(),U=()=>ai(0,2e3).map((()=>Hr(g,I,h,m,u))).filter((r=>(!e||r<=e)&&(!t||r>=t))).slice(0,r||$r(20,30)).map((e=>d?Object.assign({},...d.map((t=>({[t]:e}))),f(c)):e));F=U(),[Ru,Mu].includes(l)&&(k=U())}}let x=Cu.filter((e=>"IOC"===c&&e.ioc||e.iso));let{postalCodesProfile:_,postalCodesCount:L,statesProfile:V,citiesProfile:B,citiesCount:j,statesCount:G}=g||{},q=e=>Object.keys(e).map((e=>ai(0,V[e]).map((()=>e)))).flat(),$={cities:B&&q(B)||g?.cities||fM({count:j||M,participantsCount:M}).cities,states:V&&q(V)||g?.states||hM({count:G||M,participantsCount:M}).states,postalCodes:_&&q(_)||g?.postalCodes||gM({count:L||M,participantsCount:M}).postalCodes},W=function(e){let t=Math.ceil(M/e);return n&&t>n?Math.ceil(M/n):e}(s),H=W?Qr(x).slice(0,s):u?x.filter((e=>u.includes(e.iso))):x,z=Qr(ai(0,Math.ceil(M/(W||1))).map((()=>H)).flat(1/0)),Y=PM({count:d}).names;return{participants:ai(0,d).map((e=>{let t=b?2:R?8:1,r=ai(0,t).map((r=>function(e){let t=E[e],{nationalityCode:r,participantExtensions:i,participantTimeItems:n,extensions:a,firstName:s,birthDate:u,lastName:d,personId:l,sex:h}=t||{},g=s||"GivenName",I=d||"FamilyName",U=`${g} ${I}`,v=z[e],y=A?.length&&r||v&&("IOC"===c?v.ioc||v.iso:v.iso||v.ioc)||r;z?.length&&!y&&!r&&console.log("%c Invalid Nationality Code",{participantIndex:e,country:v});let S=UM({...$,participantIndex:e,nationalityCode:y}),w=Zi({participantId:IM({participantType:Tu,index:e,idPrefix:m,uuids:f}),extensions:i,timeItems:n,participantRole:hf,participantType:Tu,participantName:U,person:{addresses:[S],personId:l||p?.length&&p[e]||Jl(),standardFamilyName:I,standardGivenName:g,nationalityCode:y,extensions:a,birthDate:Zn(u)?u:void 0,sex:h}});if(D&&y){let e=Cu.find((({iso:e})=>e===y));e?.ioc&&(w.person.iocNationalityCode=e.ioc),e?.label&&(w.person.countryName=e.label)}if(P&&y){let e=Cu.find((({iso:e})=>e===y));e?.iso2&&(w.person.iso2NationalityCode=e.iso2),e?.label&&(w.person.countryName=e.label)}if(o){let t=O[e],r=C[e];TM({scaleValue:t,eventType:Cl,scaleType:Vn,participant:w,category:o}),TM({scaleValue:r,eventType:Fl,scaleType:Vn,participant:w,category:o});let i=F[e],n=k[e];TM({scaleValue:i,eventType:Cl,scaleType:Bn,participant:w,category:o}),TM({scaleValue:n,eventType:Fl,scaleType:Bn,participant:w,category:o})}return w}(e*t+r))),i=r.map((e=>e.participantId)),n=r.map((e=>e.person.standardFamilyName)).join("/"),a=b?Ru:Mu,s={participantId:IM({participantType:a,idPrefix:m,index:e,uuids:f}),participantRole:hf,participantName:b?n:Y[e],individualParticipantIds:i,participantType:a};return w&&(s.individualParticipants=r),b||R?[s,...r]:r})).flat(),...I}}function TM({scaleValue:e,participant:t,eventType:r,scaleType:i,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,o={itemValue:e,itemType:[jn,i,r,a].join(".")};a&&e&&(t.timeItems||(t.timeItems=[]),t.timeItems.push(o))}function bM(e){let{alternatesCount:t=0,tieFormatName:r,drawSize:i}=e,n=0,a=0,o=0,s=0,c={},u={[$p]:0,[zp]:0,[Wp]:0,[Hp]:0,[qp]:0};(d(e.tieFormat)?e.tieFormat:Jw({namedFormat:r}))?.collectionDefinitions?.filter(Boolean).forEach((e=>{let{category:t,collectionId:r,matchUpType:i,matchUpCount:d,gender:l}=e;if([$p,zp].includes(l)){let e=d*(i===hu?2:1);u[l]<e&&(u[l]=e)}else l===Wp&&(u[$p]<d&&(u[$p]=d),u[zp]<d&&(u[zp]=d));if(t){let e=JSON.stringify(t);c[e]=t}if(r||(e.collectionId=Jl()),hl(hu)(i)){let e=d;s+=d,n=Math.max(n,e)}if(hl(mu)(i)){let e=d;o+=d,a=Math.max(a,e)}}));let l=Object.keys(c).length?Math.max(o,2*s):Math.max(a,2*n);return{maxDoublesDraw:n*(i+t),maxSinglesDraw:a*(i+t),teamSize:l,genders:u}}function RM({participantsProfile:e,tournamentRecord:t,eventProfiles:r,drawProfiles:i,startDate:n,uuids:a}){let{participantsCount:o,participantType:s,largestTeamDraw:c,largestTeamSize:u,gendersCount:d}=function({participantsProfile:e,eventProfiles:t,drawProfiles:r}){let{participantsCount:i,participantType:n=Tu}=e||{},a=i||0,o={[zp]:0,[Wp]:0,[Hp]:0,[$p]:0,[qp]:0},s=0,c=0,u=0,d=0,l=0,p=({alternatesCount:e=0,uniqueParticipants:t,tieFormatName:r,drawSize:i=0,eventType:n,tieFormat:a,category:p,gender:m,stage:f})=>{let h=n===Ol,g=!!(t||f===Us||p||m);if(n===kl){d=Math.max(d,i+e),a="object"==typeof a?a:Jw({namedFormat:r});let{teamSize:t,maxDoublesDraw:n,maxSinglesDraw:l,genders:p}=bM({alternatesCount:e,tieFormatName:r,tieFormat:a,drawSize:i});u=Math.max(u,t),c=Math.max(c,l),g||(s=Math.max(s,n)),Object.keys(p).forEach((e=>o[e]+=p[e]))}else if(h)if(g){let t=2*(i+e);l+=t,m&&(o[m]+=t)}else i+e&&i+e>s&&(s=i+e);else if(g){let t=i+e;m&&(o[m]+=t),l+=t}else i&&i>c&&(c=i+e)};if(t?.forEach((e=>{let{tieFormatName:t,tieFormat:r,drawProfiles:i,eventType:n,category:a,gender:o}=e;if(i)for(let s of i){let{tieFormatName:e,tieFormat:i}=s;p({...s,tieFormatName:e||t,tieFormat:i||r,eventType:n,category:a,gender:o})}})),Array.isArray(r))for(let f of r)p(f);let m=Math.max(d*u,2*s,c);return s&&(n=Ru),(i||a)<m&&(i=m),i&&s&&[Ru,kl].includes(n)&&(c&&Math.floor(c/2)>s?i=Math.floor(c/2):(!c||2*s>=c)&&(i=Math.ceil(i/2))),void 0===i&&(i=t?.length||r?.length?0:32),i<a&&(i=a),{uniqueParticipantsCount:l,participantsCount:i,largestTeamDraw:d,largestTeamSize:u,participantType:n,gendersCount:o}}({participantsProfile:e,eventProfiles:r,drawProfiles:i}),l=e?.teamKey,p=DM({consideredDate:n,...e,participantsCount:o,participantType:s,gendersCount:d,uuids:a}).participants,m=0,f=vT({tournamentRecord:t,participants:p});if(f.error)return f;if(m+=f.addedCount,l){let e=lM({tournamentRecord:t,...l});if(e.error)return e}let h=p.filter((({participantType:e})=>e===Tu)).map(Go),g=e?.idPrefix?`${Mu}-${e.idPrefix}`:void 0;return f=vT({participants:ai(0,c).map((e=>{let t=h.slice(e*u,(e+1)*u),r=IM({index:e,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${e+1}`,participantRole:hf,individualParticipantIds:t,participantType:Mu,participantId:r}})),tournamentRecord:t}),f.error?f:(m+=f.addedCount,{addedCount:m,...I})}function MM({drawProfiles:e,category:t,gender:r}){let i={},n=e?.reduce(((e,n)=>{let{qualifyingPositions:a=0,participantsCount:o=0,uniqueParticipants:s,stage:c=Is,drawSize:u=0}=n||{};Object.keys(e).includes(c)||(e[c]=0);let d=(o||u)-a;return s||r||t||c===Us?(Object.keys(i).includes(c)||(i[c]=0),i[c]+=d):e[c]=Math.max(e[c],d),e}),{}),a=Object.keys(i);return a.forEach((e=>n[e]+=i[e])),{stageParticipantsCount:n,uniqueParticipantsCount:i,uniqueParticipantStages:a}}function NM({allUniqueParticipantIds:e,stageParticipantsCount:t,eventParticipantType:r,targetParticipants:i}){let n=t[Is]||0,a=t[Us]||0;return{stageParticipants:{QUALIFYING:i.filter((({participantType:e})=>e===r)).filter((({participantId:t})=>!e.includes(t))).slice(0,a),MAIN:i.filter((({participantType:e})=>e===r)).filter((({participantId:t})=>!e.includes(t))).slice(a,a+n)}}}var AM={[ss]:2,[es]:1,[Zo]:1,[ns]:1,[Xo]:4};function EM(e){let{defaultWithScorePercent:t=2,winningSide:r}=e,{matchUpStatusProfile:i=AM,matchUpFormat:n=eI,pointsPerMinute:a=1,sideWeight:o=4}=e;if(!qI({matchUpFormat:n}))return{error:be};if("object"!=typeof i)return{error:mr};if(t>100&&(t=100),isNaN(t)||isNaN(a)||isNaN(o))return{error:mr};let s=Object.keys(i).filter((e=>Object.keys(gs).includes(e)&&e!==Qo));if(Object.keys(s).reduce(((e,t)=>e+i[t]),0)>100)return{error:mr,matchUpStatusProfile:i};let c=s.reduce(((e,t)=>(e.pointer=e.pointer+i[t],e.valueMap.push([e.pointer,t]),e)),{pointer:0,valueMap:[]}),u=$r(1,100),d=(c.valueMap.find((e=>u<=e[0]))??[100,Qo])[1],l={sets:[],scoreStringSide1:"",side2ScoreString:""};if([ss,Xo].includes(d)){r=r||$r(1,2);let e={score:l,winningSide:r,matchUpStatus:d};if(!(d===Xo&&$r(1,100)>100-t))return{outcome:e}}else if([es,Zo].includes(d))return{outcome:{score:l,matchUpStatus:d}};let p,m=Op(n),{bestOf:f,setFormat:h,finalSetFormat:g}=m??{},I=[],U=$r(0,1),v=r?[r-1]:[...ai(0,o).map((()=>U)),1-U],y=[ns,Xo,rs,as].includes(d)&&(ii(ai(1,f))||1);for(let D of ai(1,(f??0)+1)){let e=D===f,{set:t,incomplete:r,winningSideNumber:i}=CM({incomplete:y===D,matchUpStatus:d,pointsPerMinute:a,setFormat:e&&g||h,setNumber:D,weightedRange:v});if(I.push(t),r){p=i;break}if(JD({matchUp:{score:{sets:I},matchUpFormat:n}}).calculatedWinningSide)break}let S=JD({matchUp:{score:{sets:I},matchUpFormat:n}}),w=p?r||p:S.calculatedWinningSide,{score:P}=RR({score:{sets:I},winningSide:w,matchUpStatus:d});return{outcome:{score:P,winningSide:w,matchUpStatus:d}}}function CM({weightedRange:e=[0,1],pointsPerMinute:t,matchUpStatus:r,incomplete:i,setFormat:n,setNumber:a}){let o,s={setNumber:a},{setTo:c,tiebreakFormat:u,tiebreakAt:d,tiebreakSet:l,timed:p,minutes:m}=n,f=$r(0,e.length-1),h=e[f];if(p){let n=m*t,a=Math.round(.2*n),c=n+ii([1,-1])*a,u=function(e=1,t=3,r=!0){let i=0;for(let n=0;n<t;n++)i+=Math.random()*(e/t);return r&&e>1?Math.round(i):i}(c,2),d=[u,c-u];h&&d.reverse(),o=e[f]+1;let l=(d[0]>d[1]?1:d[1]>d[0]&&2)||0;if(i){let[e,t]=d;return Object.assign(s,{side1Score:e,side2Score:t}),ms.includes(r)?{set:s,incomplete:i,winningSideNumber:o}:{set:s,incomplete:i}}l||(d[$r(0,1)]+=1),l=d[0]>d[1]?1:2,l!==o&&d.reverse();let[p,g]=d;return Object.assign(s,{side1Score:p,side2Score:g,winningSide:o}),{set:s}}if(i)return s.side1Score=$r(0,d),s.side2Score=$r(0,d),ms.includes(r)&&(o=e[f]+1),{set:s,incomplete:i,winningSideNumber:o};{let t=ai(1,c+1).map((e=>ai(0,c+2-e).map((()=>e)))).flat(),r=t[$r(0,t.length-1)],i=c&&sw({isSide1:!0,tiebreakAt:d,lowValue:r,setTo:c}),a=!i,o=1===e.length&&e[f]+1;if(!a){o?(i[0]>i[1]?1:2)!==o&&i.reverse():h&&i.reverse();let[e,t]=i;Object.assign(s,{side1Score:e,side2Score:t})}let p,m=dw({matchUpScoringFormat:{setFormat:n},setObject:s});if(m.hasTiebreakCondition||a){let{NoAD:e,tiebreakTo:t}=u||l||{},r=ai(1,t+1).map((e=>ai(0,t+2-e).map((()=>e)))).flat(),i=r[$r(0,r.length-1)],n=cw({isSide1:!0,tiebreakNoAd:e,tiebreakTo:t,lowValue:i});if(n)if(a){let e=n[0]>n[1]?1:2;o?e!==o&&n.reverse():h&&n.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=n,p=(n[0]>n[1]?1:n[1]>n[0]&&2)||void 0}else 2===m.leadingSide?[s.side1TiebreakScore,s.side2TiebreakScore]=n:[s.side2TiebreakScore,s.side1TiebreakScore]=n}s.winningSide=m.winningSide||m.leadingSide||o||p}return{set:s}}function OM(e){let{matchUpStatusProfile:t,completeAllMatchUps:r,randomWinningSide:i,tournamentRecord:n,completionGoal:a,drawDefinition:o,event:s}=e;if(!o)return{error:M};let c=e.matchUpFormat||o.matchUpFormat||s?.matchUpFormat,u=o.structures.slice().sort(Uc),d=0,{matchUps:l,matchUpsMap:p}=am({contextFilters:{stages:[Is,Us]},matchUpFilters:{matchUpTypes:[Iu],roundNumbers:[1]},inContext:!0,drawDefinition:o});if(l?.length){let e=s?.category?.ageCategoryCode||s?.category?.categoryName;if(e){let t=lb({singlesOnly:!0,tournamentRecord:n,drawDefinition:o,scaleAccessor:{scaleName:e,sortOrder:cb,scaleType:Vn},event:s});if(t.error)return t;let{lineUps:r,participantsToAdd:i}=t;vT({tournamentRecord:n,participants:i}),za({element:o,extension:{name:Io,value:r}})}else{let e=l[0]?.structureId,{positionAssignments:t}=Pc({drawDefinition:o,structureId:e});if(t?.length){let{participants:e}=ef({participantFilters:{participantTypes:[Iu]},tournamentRecord:n}),r=r=>{let i=r.tieMatchUps.filter(hl(mu)),a=r.tieMatchUps.filter(hl(hu));i.forEach(((r,i)=>{let a=r.matchUpId;r.sides.forEach((r=>{let{drawPosition:c}=r,u=e?.find((e=>{let{participantId:r}=e;return t.find((e=>e.participantId===r))?.drawPosition===c}));if(u){let e=u.individualParticipantIds?.[i];e&&_b({teamParticipantId:u.participantId,participantId:e,tournamentRecord:n,drawDefinition:o,tieMatchUpId:a,event:s})}}))})),a.forEach(((r,i)=>{let a=r.matchUpId;r.sides.forEach((r=>{let{drawPosition:c}=r,u=e?.find((e=>{let{participantId:r}=e;return t.find((e=>e.participantId===r))?.drawPosition===c}));u&&u.individualParticipantIds?.slice(2*i,2*i+2)?.forEach((e=>{_b({teamParticipantId:u.participantId,participantId:e,tournamentRecord:n,drawDefinition:o,tieMatchUpId:a,event:s})}))}))}))};l.forEach(r)}}}let m="string"==typeof r&&r,f=m&&Qo;for(let h of u){if(d>=a)break;let{matchUps:e}=Kp({matchUpFilters:{matchUpTypes:[hu,mu]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:h,event:s}),r=e.filter((({winningSide:e})=>!e)).sort(dm).map(qo);for(let u of r){if(!isNaN(a)&&d>=a)break;let{matchUps:e}=Kp({matchUpFilters:{matchUpTypes:[hu,mu]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:h,event:s}),r=e.find((e=>e.matchUpId===u)),l=[es,Zo].includes(r.matchUpStatus);if(r?.readyToScore&&!l){let e=kM({winningSide:!i&&1,matchUpStatusProfile:t,tournamentRecord:n,drawDefinition:o,targetMatchUp:r,matchUpFormat:c,matchUpStatus:f,scoreString:m,event:s});if(e?.error)return e;d+=1}}}return{...I,completedCount:d}}function FM(e){let{matchUpStatusCodes:t,policyDefinitions:r,tournamentRecord:i,drawDefinition:n,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:c,winningSide:u,event:d}=e;if(!a||a.matchUpStatus===Yo)return;let{matchUpId:l}=a||{},{outcome:p}=VR({matchUpFormat:s,matchUpStatus:o,scoreString:c,winningSide:u});return t&&(p.matchUpStatusCodes=t),MR({tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpFormat:s,matchUpId:l,outcome:p,event:d})}function kM(e){let{matchUpStatusProfile:t={},tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:c,winningSide:u,event:d}=e;if(c||a)return FM(e);let{matchUpId:l}=s||{},{outcome:p}=EM({matchUpStatusProfile:t,matchUpFormat:o,winningSide:u});return MR({policyDefinitions:i,tournamentRecord:r,drawDefinition:n,matchUpFormat:o,matchUpId:l,outcome:p,event:d})}function xM({matchUpStatusProfile:e,completeAllMatchUps:t,randomWinningSide:r,tournamentRecord:i,drawProfiles:n,event:a}){let o=op({event:a}).flightProfile,{eventName:s,eventType:c,category:u}=a,{startDate:d}=i,l=[],p=u?.categoryName||u?.ageCategoryCode||u?.ratingType,m=a.drawDefinitions?.map((({drawId:e})=>e));if(Array.isArray(o?.flights))for(let[f,h]of o.flights.entries()){let{drawId:o,stage:u,drawName:g,drawEntries:I}=h;l.push(h.drawId);let U=n[f],{seedsCount:v,generate:y=!0}=U||{};if(y){let l=I.filter(fm(sn)).map(fm(sn)),h=p||s;if(i&&v&&v<=l.length&&ai(1,v+1).forEach(((e,t)=>{let r={scaleValue:e,scaleName:h,scaleType:Gn,eventType:c,scaleDate:d},n=l[t];Qv({tournamentRecord:i,participantId:n,scaleItem:r})})),m?.includes(o))break;let y=sT({...U,matchUpType:c,seedingScaleName:h,tournamentRecord:i,isMock:!0,drawEntries:I,drawName:g,drawId:o,event:a,stage:u});if(y.error)return{error:y.error,drawIds:[]};let{drawDefinition:S}=y;if(!S)return{error:A};let w=n[f]?.drawExtensions;if(Array.isArray(w)&&w.filter(Ha).forEach((e=>za({element:S,extension:e}))),y=HT({suppressNotifications:!0,tournamentRecord:i,drawDefinition:S,event:a}),y.error)return{error:y.error,drawIds:[]};if(U?.withPlayoffs){let e=S.structures?.[0].structureId,t=cU({idPrefix:U.idPrefix,...U.withPlayoffs,tournamentRecord:i,drawDefinition:S,isMock:!0,structureId:e,event:a});if(t?.error)return t}let P=U?.completionGoal;if(!1!==U?.automated&&(t||P)){let n=U?.matchUpFormat,o=OM({completeAllMatchUps:!P&&t,matchUpStatusProfile:e,randomWinningSide:r,tournamentRecord:i,completionGoal:P,drawDefinition:S,matchUpFormat:n,event:a});if(o.error)return{error:o.error,drawIds:[]};let s=o.completedCount;if(U?.drawType===cc){let o=S.structures?.find((e=>e.stage===Is));if(!o)return{error:ae};let c=tg({structureId:o.structureId,tournamentRecord:i,drawDefinition:S,event:a});if(c.error)return{error:c.error,drawIds:[]};if(c=OM({completeAllMatchUps:!P&&t,completionGoal:P?P?P-(s??0):void 0:void 0,matchUpStatusProfile:e,randomWinningSide:r,tournamentRecord:i,drawDefinition:S,matchUpFormat:n,event:a}),c.error)return{error:c.error,drawIds:[]}}}}}return{...I,drawIds:l}}function _M(e){let{participantsProfile:t={},uniqueParticipantsCount:r,ratingsParameters:i,tournamentRecord:n,eventProfile:a,eventIndex:o,event:s,uuids:c}=e,{category:u,gender:d,eventType:l}=s,p=hl(El)(l)&&Tu||hl(Ol)(l)&&Ru||l,m=r[Is]||0,f=r[Us]||0,h=a.drawProfiles?.length?m+f:a.participantsProfile?.participantsCount??0,g=[$p,zp].includes(d)?d:void 0,I=t?.idPrefix?`E-${o}-${t?.idPrefix}`:void 0,{participants:U}=DM({uuids:a.uuids||c,...t,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:h,ratingsParameters:i,category:u,idPrefix:I,sex:g}),v=vT({tournamentRecord:n,participants:U});if(v.error)return v;let y=U?.filter((({participantType:e})=>e===p)),S=U?.map(Go);return{uniqueDrawParticipants:y,uniqueParticipantIds:S}}function LM({autoEntryPositions:e,tournamentRecord:t,drawParticipants:r,drawProfile:i,event:n}){let{drawType:a=$s,qualifyingPositions:o=0,stage:s=Is,drawSize:c=0,drawName:u,drawId:d}=i,l=c-o,p=r.slice(0,l).map(Go);if(p.length){let r=mf({participantIds:p,autoEntryPositions:e,entryStage:s,tournamentRecord:t,event:n});if(r.error)return r}let m=eb({drawName:u||a,qualifyingPositions:o,drawEntries:p.map((e=>({entryStatus:dd,entryStage:s,participantId:e}))),drawId:d,event:n,stage:s});return m.error?m:{...I}}function VM({uniqueDrawParticipants:e,autoEntryPositions:t,stageParticipants:r,tournamentRecord:i,drawProfiles:n,category:a,gender:o,event:s}){let c=0;for(let u of n){let{qualifyingPositions:n=0,uniqueParticipants:d,stage:l=Is,drawSize:p=0}=u,m=p-n,f=d||o||a||l===Us,h=f?e.slice(c,c+m):r[l||Is]||[];f&&(c+=m);let g=LM({autoEntryPositions:t,drawParticipants:h,tournamentRecord:i,drawProfile:u,event:s});if(g.error)return g}return{...I}}function BM(e){let{allUniqueParticipantIds:t,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:l,publish:p,isMock:m,uuids:f}=e,h=d.gender,g=d.eventName,{eventType:I=El,policyDefinitions:U,drawProfiles:v=[],eventExtensions:y,surfaceCategory:S,tieFormatName:w,processCodes:P,discipline:D,eventLevel:T,timeItems:b,ballType:R,category:M}=d,N=d.eventId||Jl(),A=d.tieFormat||(I===kl?Jw({namedFormat:w,event:{eventId:N,category:M,gender:h},hydrateCollections:o,isMock:m}):void 0),E=u.participants;for(let W of v)!h&&W.gender&&(h=W?.gender);let{stageParticipantsCount:C,uniqueParticipantsCount:O,uniqueParticipantStages:F}=MM({drawProfiles:v,category:M,gender:h}),k=hl(El)(I)&&Tu||hl(Ol)(I)&&Ru||I,{uniqueDrawParticipants:x=[],uniqueParticipantIds:_=[]}=F?_M({event:{eventType:I,category:M,gender:h},uniqueParticipantsCount:O,participantsProfile:i,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:l,uuids:f}):{},{eventAttributes:L}=d;"object"!=typeof L&&(L={});let V=M?.categoryName||M?.ageCategoryCode||M?.ratingType;g=g||V||"Generated Event";let B={...L,surfaceCategory:S,processCodes:P,discipline:D,eventLevel:T,eventName:g,eventType:I,tieFormat:A,ballType:R,category:M,eventId:N,gender:h};if(y?.length&&Array.isArray(y)){let e=y.filter(Ha);e?.length&&Object.assign(B,{extensions:e})}if(Array.isArray(b)&&b.forEach((e=>cg({event:q,timeItem:e}))),"object"==typeof U)for(let W of Object.keys(U))uU({policyDefinitions:{[W]:U[W]},event:B});B.category&&(B.category.categoryName=V);let j,G=rb({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:B});if(G.error)return G;let q=G?.event,{stageParticipants:$}=NM({allUniqueParticipantIds:t,stageParticipantsCount:C,eventParticipantType:k,targetParticipants:E});if(v?.length){let e=VM({uniqueDrawParticipants:x,autoEntryPositions:a,stageParticipants:$,tournamentRecord:u,drawProfiles:v,category:M,gender:h,event:q});if(e.error)return e;let t=xM({matchUpStatusProfile:r,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:u,drawProfiles:v,event:q});if(t.error)return t;j=t.drawIds}else if(d?.participantsProfile?.participantsCount){let e=x.map(Go);if(e.length){let t=mf({participantIds:e,autoEntryPositions:a,tournamentRecord:u,entryStage:Is,event:q});if(t.error)return t}}return p&&TT({tournamentRecord:u,event:q}),{drawIds:j,eventId:N,uniqueParticipantIds:_}}function jM({tournamentRecords:e,scheduleDate:t,venueId:r,round:i}){if(!Zn(t))return{error:Xe};let{extension:n}=no({name:bo,tournamentRecords:e,discover:!0}),a=n?.value||[],o=a.find((e=>wa(t,e.scheduleDate)));if(!o){let{startDate:r,endDate:i}=kP({tournamentRecords:e}),n=new Date(t);if(r&&n<new Date(r)||i&&n>new Date(i))return{error:Xe};o={scheduleDate:t,venues:[]},a.push(o)}let s=o.venues.find((e=>e.venueId===r));s||(s={venueId:r,rounds:[]},o.venues.push(s));let c=["notBeforeTime"],u=e=>Object.keys(e).filter((e=>!c.includes(e))).sort().map((t=>d(e[t])?u(e[t]):e[t])).flat().join("|");if(s.rounds.find((e=>u(e)===u(i))))return en({result:{error:ie},stack:"addSchedulingProfileRound"});s.rounds.push(i);let l=cD({tournamentRecords:e,schedulingProfile:a});return l.error?l:{...I}}function GM(e){let t=xn(e,[{drawProfile:!0,_ofType:bn}]);if(t.error)return t;let{allUniqueParticipantIds:r=[],participantsProfile:i={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:c,ratingsParameters:u,tournamentRecord:l,isMock:p=!0,drawProfile:m,startDate:f,drawIndex:h,uuids:g}=e,U=Da(m,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=eI,drawType:S=$s,tournamentAlternates:w=0,alternatesCount:P=0,qualifyingPositions:D,qualifyingProfiles:T,generate:b=!0,eventExtensions:R,drawExtensions:M,completionGoal:N,tieFormatName:E,seedsCount:C,timeItems:O,drawName:F,category:k,idPrefix:x,publish:_,gender:L,stage:V}=U,B=U.drawSize||(U.ignoreDefaults?void 0:32),j=U.eventId||Jl(),G=m.eventType||m.matchUpType||El,q=G===Ol?Ru:Tu,$=d(m.tieFormat)&&m.tieFormat||G===Mu&&Jw({event:{eventId:j,category:k,gender:L},namedFormat:E,hydrateCollections:s,isMock:p})||void 0,W=k?.categoryName||k?.ageCategoryCode||k?.ratingType,H=m.eventName||W||`Generated ${G}`,z=l?.participants||[],Y=(T?.map((e=>e.structureProfiles||[])).flat().reduce(((e,t)=>e+(!t.participantsCount||t.participantsCount>t.drawSize?t.drawSize:t.participantsCount||0)),0)||0)*(q===Ru?2:1),K=(!m.participantsCount||m.participantsCount>B?B:m.participantsCount)||0,Q={eventName:H,eventType:G,tieFormat:$,category:k,eventId:j,gender:L};Array.isArray(O)&&O.forEach((e=>cg({event:Q,timeItem:e})));let{eventAttributes:J}=m;if("object"!=typeof J&&(J={}),Object.assign(Q,J),R?.length&&Array.isArray(R)){let e=R.filter(Ha);e?.length&&Object.assign(Q,{extensions:e})}let X=[];if(Y||m.uniqueParticipants||!l||L||k){let e,t,r=(K||0)+P+Y,n=r,a={[$p]:0,[zp]:0};G===Mu&&(({teamSize:e,genders:t}=bM({alternatesCount:P,tieFormatName:E,tieFormat:$,drawSize:B})),Object.keys(t).forEach((e=>{[$p,zp].includes(e)&&t[e]&&(a[e]=B*t[e])})),n=e*((B||0)+Y));let o=i?.idPrefix?`D-${h}-${i?.idPrefix}`:void 0,s=DM({...i,scaledParticipantsCount:m.scaledParticipantsCount||i.scaledParticipantsCount,participantsCount:n,consideredDate:l?.startDate,sex:L||i?.sex,rankingRange:m.rankingRange,uuids:m.uuids||g,ratingsParameters:u,participantType:q,gendersCount:a,idPrefix:o,category:k}).participants;if(Q.category&&(Q.category.categoryName=W),l){let e=vT({participants:s,tournamentRecord:l});if(e.error)return e}if(s.forEach((({participantId:e})=>X.push(e))),z=s,G===Mu){let i=t[$p]?s.filter((({participantType:e,person:t})=>e===Tu&&t?.sex===$p)).map(Go):[],n=t[zp]?s.filter((({participantType:e,person:t})=>e===Tu&&t?.sex===zp)).map(Go):[],a=s.filter((({participantType:e})=>e===Tu)).map(Go).filter((e=>!i.includes(e)&&!n.includes(e))),o=e-(t[$p]+t[zp]),c=0,u=0,d=0,p=ai(0,r).map((e=>{let r=n.slice(c,c+t[zp]),s=i.slice(u,u+t[$p]),l=a.slice(d,d+o);return c+=t[zp],u+=t[$p],d+=o,{individualParticipantIds:[...r,...s,...l],participantOtherName:`TM${e+1}`,participantName:`Team ${e+1}`,participantRole:hf,participantType:Mu,participantId:Jl()}})),m=vT({participants:p,tournamentRecord:l});if(!m.success)return m;z=p}}let Z=e=>{let{participantType:t}=e;return!!(hl(El)(G)&&t===Tu||hl(Ol)(G)&&t===Ru)||G===Mu&&t===Mu},ee=e=>!m.gender||e.person?.sex===m.gender||e.individualParticipantIds?.some((e=>{let t=z.find((t=>t.participantId===e));return t&&ee(t)})),te=z.filter(Z).filter(ee).filter((({participantId:e})=>!r.includes(e))),re=te.slice(0,K).map((e=>e.participantId));if(p&&re?.length){let e=mf({autoEntryPositions:o,entryStage:V,tournamentRecord:l,participantIds:re,event:Q});if(e.error)return e}let ie=Y?te.slice(K,K+Y).map((e=>e.participantId)):0;if(p&&ie?.length){let e=0,t=1,r=(e,t)=>e.stageSequence-t.stageSequence,i=(e,t)=>e.roundTarget-t.roundTarget;for(let n of T.sort(i)){t=n.roundTarget||t;let i,a=1;for(let s of n.structureProfiles.sort(r)){let r=(s.drawSize||Vr(s.participantsCount))-(i||0),n=ie.slice(e,e+r),c=mf({entryStage:Us,entryStageSequence:a,autoEntryPositions:o,tournamentRecord:l,participantIds:n,roundTarget:t,event:Q});if(c.error)return c;i=s.qualifyingPositions,e+=r,a+=1}t+=1}}let ne=v&&l?.participants?.filter((({participantId:e})=>!re.includes(e))).filter(Z).filter(ee).slice(0,P||B-K||w).map((e=>e.participantId));if(p&&ne?.length){let e=mf({participantIds:ne,autoEntryPositions:!1,entryStatus:cd,tournamentRecord:l,event:Q});if(e.error)return e.error}let oe=W||H;l&&C&&C<=re.length&&ai(1,C+1).forEach(((e,t)=>{let r={scaleName:oe,scaleDate:f,scaleType:cl,scaleValue:e,eventType:G},i=re[t];Qv({tournamentRecord:l,participantId:i,scaleItem:r})}));let se=sT({...Da(m,!1,!0),tournamentRecord:l,seedingScaleName:oe,matchUpFormat:y,eventId:j,isMock:p,event:Q});if(se.error)return se;if(!se.drawDefinition)return{error:A};let{drawDefinition:ce}=se,ue=ce.drawId;if(Array.isArray(M)&&M.filter(Ha).forEach((e=>za({element:ce,extension:e}))),b){if(HT({drawDefinition:ce,event:Q,suppressNotifications:!0}),m.withPlayoffs){let e=ce.structures?.[0].structureId,t=cU({...m.withPlayoffs,tournamentRecord:l,drawDefinition:ce,structureId:e,idPrefix:x,isMock:p,event:Q});if(t?.error)return t}let e=!1===m.automated;if(p&&!e){let e=e=>{let t=OM({completeAllMatchUps:e.completeAllMatchUps,completionGoal:e.completionGoal,matchUpStatusProfile:n,randomWinningSide:c,tournamentRecord:l,drawDefinition:ce,matchUpFormat:y,event:Q});if(t.error)return t;let r=t.completedCount;if(S===cc){let e=ce.structures?.find((e=>e.stage===Is));if(!e)return{error:ae};tg({structureId:e.structureId,tournamentRecord:l,drawDefinition:ce,event:Q});let t=OM({completionGoal:N?N?N-(r??0):void 0:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:c,tournamentRecord:l,drawDefinition:ce,matchUpFormat:y,event:Q});if(t.error)return t}};if(N&&e({completionGoal:N}),m.outcomes){let{matchUps:e}=lm({inContext:!0,drawDefinition:ce,event:Q});for(let t of m.outcomes){let{matchUpStatus:r=Qo,matchUpStatusCodes:i,stageSequence:n=1,matchUpIndex:a=0,structureOrder:o,matchUpFormat:s,drawPositions:c,roundPosition:u,stage:d=Is,roundNumber:p,winningSide:m,scoreString:f}=t,h=e?.reduce(((e,t)=>{let{structureId:r,matchUpId:i}=t;return e[r]?e[r].push(i):e[r]=[i],e}),{})??[],g=Object.assign({},...Object.keys(h).map(((e,t)=>({[e]:t+1})))),I=e?.filter((e=>!(d&&e.stage!==d||n&&e.stageSequence!==n||p&&e.roundNumber!==p||u&&e.roundPosition!==u||o&&g[e.structureId]!==o||c&&2!==si(c,e.drawPositions).length)))?.[a],U=FM({matchUpStatusCodes:i,tournamentRecord:l,drawDefinition:ce,targetMatchUp:I,matchUpFormat:s,matchUpStatus:r,scoreString:f,winningSide:m});if(U?.error)return U}}a&&e({completeAllMatchUps:a})}_&&TT({tournamentRecord:l,event:Q})}else{let e=eb({drawEntries:ce.entries,drawName:F||S,qualifyingPositions:D,drawId:ue,event:Q,stage:V});if(e.error)return e}return{...I,event:Zi(Q),uniqueParticipantIds:X,targetParticipants:z,drawDefinition:ce,eventId:j,drawId:ue}}var qM=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),$M=qM;function WM(e){return parseInt(e)}function HM({startTime:e="",endTime:t=""}={}){if(!(e&&t&&Kn.test(e)&&Kn.test(t)))return!1;let[r,i]=e.split(":").map(WM),[n,a]=t.split(":").map(WM);return!(n<r)&&!(r===n&&a<i)}function zM(e,t){let[r,i]=e.startTime.split(":").map(WM),[n,a]=t.startTime.split(":").map(WM);return r<n?-1:r>n?1:i<a?-1:i>a?1:0}function YM({dateAvailability:e}){if(!e)return{error:Je};if(!Array.isArray(e))return{error:Qe};let t="Times must be 24 hour => 00:00";for(let r of e){if("object"!=typeof r)return{error:Qe};let{date:e,startTime:i,endTime:n,bookings:a=[]}=r;if(!i||!n)return{error:Qe};if(e&&!Yn.test(e))return{error:Xe,dateAvailability:{date:e},info:"Dates must be formated => YYYY-MM-DD"};if(!Kn.test(i))return{error:Ze,dateAvailability:{startTime:i},info:t};if(!Kn.test(n))return{error:Ze,dateAvailability:{endTime:n},info:t};if(i===n)return{error:Ze,dateAvailability:{startTime:i,endTime:n},info:"startTime and endTime are equivalent"};if(!HM({startTime:i,endTime:n}))return{error:Ze,dateAvailability:{startTime:i,endTime:n},info:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:Ke};for(let e of a){if("object"!=typeof e)return{error:Ke};let{startTime:r,endTime:i}=e;if(!Kn.test(r))return{error:Ze,booking:{startTime:r},info:t};if(!Kn.test(i))return{error:Ze,booking:{endTime:i},info:t};if(r===i)return{error:Ze,dateAvailability:{startTime:r,endTime:i},info:"startTime and endTime are equivalent"};if(!HM({startTime:r,endTime:i}))return{error:Ze,dateAvailability:{startTime:r,endTime:i},info:"endTime must be after startTime"}}}}return{valid:!0}}function KM({tournamentRecord:e,disableNotice:t,venueId:r,courtId:i,court:n}){let{venue:a}=ep({tournamentRecord:e,venueId:r});if(!a)return{error:$t};a.courts||(a.courts=[]);let o={...qM(),venueId:r,courtId:i};if(o.courtId||(o.courtId=Jl()),a.courts.some((e=>e.courtId===o.courtId)))return{error:Gt};{let i=(n?.dateAvailability||[]).map((e=>({...e,date:la(e.date),startTime:da(e.startTime),endTime:da(e.endTime),bookings:e.bookings?.map((({startTime:e,endTime:t,bookingType:r})=>({startTime:da(e),endTime:da(t),bookingType:r})))}))),s=Object.keys(o);for(let e of s)if(n?.[e])if("dateAvailability"===e){let e=YM({dateAvailability:i});if(!e.valid&&e.error)return e;o.dateAvailability=i}else o[e]=n[e];let c=o;return a.courts.push(c),t||ki({payload:{venue:a,tournamentId:e.tournamentId},topic:$c,key:a.venueId}),{...I,court:Da(o),venueId:r}}}function QM(e){let{tournamentRecord:t,venueId:r}=e;if("string"!=typeof r||!r)return{error:Wt};let i,n=e.tournamentRecords??(t&&{[t.tournamentId]:t})??{},a=[];for(let o of Object.values(n)){let{venue:t}=ep({tournamentRecord:o,venueId:r});if(t){let t=JM({...e,tournamentRecord:o});for(let e of t?.courts??[])a.push(e?.courtId);if(t.error)return t;i=!0}}return i?{...I,courtIds:a}:{error:$t}}function JM({courtNameRoot:e="Court",dateAvailability:t=[],venueAbbreviationRoot:r,tournamentRecord:i,courtNames:n=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:c,endTime:u,idPrefix:d,venueId:l,dates:p}){if(!l)return{error:Wt};let m=ep({tournamentRecord:i,venueId:l});if(m.error)return m;let{venue:f}=m;if(!jr(o)||!n)return{error:Bt};let h=ai(0,o=o??n.length).map((i=>{let o=a?.[i],c=o?p.map((e=>({date:ta(e),startTime:s,endTime:u,...o}))):t;return o&&s&&u&&c.push({startTime:s,endTime:u}),{courtName:n[i]||r&&f?.venueAbbreviation&&`${f?.venueAbbreviation} ${i+1}`||`${e} ${i+1}`,dateAvailability:c}})).map(((e,t)=>{let r=c?.pop()||d&&`${d}-${t+1}`;return KM({disableNotice:!0,tournamentRecord:i,courtId:r,venueId:l,court:e})})).map((e=>e.court)).filter(Boolean);return h.length!==o?en({info:"not all courts could be generated",result:{error:mr}}):(f&&ki({payload:{venue:f,tournamentId:i.tournamentId},topic:$c,key:f.venueId}),{...I,courts:Da(h)})}function XM({tournamentRecord:e,ignoreExistingVenues:t,venueProfiles:r,uuids:i}){let{startDate:n,endDate:a}=e,o=[];for(let[s,c]of r.entries()){let{venueAbbreviation:r,venueId:u=i?.pop()??Jl(),dateAvailability:d,startTime:l="07:00",endTime:p="19:00",courtTimings:m,courtsCount:f,courtNames:h,venueName:g,idPrefix:I,courtIds:U}=c,v=Xl({tournamentRecord:e,venue:{venueName:g||`Venue ${s+1}`,venueAbbreviation:r,venueId:u}});if(v.error){if(t)continue;return v}o.push(u);let y=na(n,a),S=!Array.isArray(d)&&[{startTime:l,endTime:p}].concat(y.map((e=>({date:ta(e),startTime:l,endTime:p}))));if(f||h){let t=QM({dateAvailability:d||S,tournamentRecord:e,courtTimings:m,courtsCount:f,courtNames:h,startTime:l,idPrefix:I,courtIds:U,endTime:p,venueId:u,dates:y});if(t.error)return t}}return o}var ZM=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function eN(e){let{startDate:t,endDate:r}=e??{},{tournamentName:i=ii(ZM),ratingsParameters:n=Qg,tournamentExtensions:a,policyDefinitions:o,schedulingProfile:s,venueProfiles:c,uuids:u}=e??{};if(t&&!Zn(t)||r&&!Zn(r))return{error:Xe};if(e.leagueProfiles&&!Array.isArray(e.leagueProfiles)||e.eventProfiles&&!Array.isArray(e.eventProfiles)||e.drawProfiles&&!Array.isArray(e.drawProfiles))return{error:mr};if(!t){let e=new Date;t=ta(r??e),r=ta(e.setDate(e.getDate()+7))}if(!r){let e=new Date(t);r=ta(e.setDate(e.getDate()+7))}let l=dM({...e.tournamentAttributes??{},tournamentName:i,isMock:!0,startDate:t,endDate:r}),p=c?.length?XM({tournamentRecord:l,venueProfiles:c,uuids:u}):[];if(a?.length&&Array.isArray(a)){let e=a.filter((e=>Ha({extension:e})));e?.length&&Object.assign(l,{extensions:e,isMock:!0})}if("object"==typeof o)for(let d of Object.keys(o))uU({policyDefinitions:{[d]:o[d]},tournamentRecord:l});if(!e?.leagueProfiles?.length||e.eventProfiles?.length||e.drawProfiles?.length||e.participantsProfile){let t=RM({tournamentRecord:l,...e});if(!t.success)return t}let m=[],f=[],h=[];if(e.leagueProfiles){let t=function(e){let{tournamentRecord:t,leagueProfiles:r,eventIds:i,venueIds:n,drawIds:a,allUniqueParticipantIds:o,uuids:s}=e,c=0;for(let u of r){let r=[],{tieFormatName:l=Mw,teamProfiles:p=[],teamsCount:m=0,category:f,idPrefix:h,gender:g}=u,I=u.leagueName??u.eventName??`League ${c+1}`,U=u.leagueId??u.eventId??s?.pop()??Jl();i.push(U);let v=d(u.tieFormat)&&u.tieFormat||Jw({event:{eventId:U,category:f,gender:g},namedFormat:l,isMock:e.isMock})||void 0;if(!v)return{error:Ne};let y=Math.max(m,p.length),S=ai(0,y),{genders:w,teamSize:P}=bM({tieFormat:v,drawSize:y}),D={[zp]:0,[Wp]:0,[Hp]:0,[$p]:0,[qp]:0};Object.keys(w).forEach((e=>D[e]+=w[e]));for(let i of S){let a=p?.[i]?.teamName??`Team ${i+1}`,c=p?.[i]?.teamId||s?.pop()||Jl(),d=u.startDate??e.startDate,l=DM({...u?.participantsProfile,participantsCount:P,consideredDate:d,gendersCount:D,category:f,gender:g,uuids:s}).participants,m=l.map((e=>e.participantId)),I=Mu,U=c??IM({participantType:I,idPrefix:h,index:i,uuids:s});r.push({participantId:U,entryStatus:dd,entryStage:Is});let v=p?.[i]?.venueIds??[],y={participantId:U,participantRole:hf,participantName:a,individualParticipantIds:m,participantType:I,homeVenueIds:v};v.forEach((e=>!n.includes(e)&&n.push(e))),o.push(...m),o.push(U);let S=vT({participants:[y,...l],tournamentRecord:t});if(S.error)return S}let T={eventName:I,entries:r,eventType:Mu,tieFormat:v,category:f,eventId:U,gender:g};if(t.events||(t.events=[]),t.events.push(T),r.length){let e=jr(u.roundsCount)?u.roundsCount:u.roundsCount===oc?2*(y-1):y-1,r=sT({automated:u.automated,tournamentRecord:t,drawType:Bs,roundsCount:e,drawSize:y,event:T});if(r.error)return r;let{drawDefinition:i}=r;if(i){let e=i?.drawId;HT({drawDefinition:i,event:T,suppressNotifications:!0}),a.push(e)}}c++}XM({tournamentRecord:t,ignoreExistingVenues:!0,venueProfiles:n.map((e=>({venueId:e}))),uuids:s})}({allUniqueParticipantIds:m,tournamentRecord:l,...e,eventIds:f,venueIds:p,drawIds:h});if(t?.error)return t}if(e.drawProfiles){let t=function(e){let{tournamentRecord:t,drawProfiles:r,allUniqueParticipantIds:i,eventIds:n,drawIds:a}=e,o=0;for(let s of r){let r=GM({allUniqueParticipantIds:i,tournamentRecord:t,drawProfile:s,drawIndex:o,...e});if(r.error)return r;let{drawId:c,eventId:u,event:d,uniqueParticipantIds:l}=r;if(r=rb({suppressNotifications:!1,internalUse:!0,tournamentRecord:t,event:d}),r.error)return r;c&&a.push(c),n.push(u),l?.length&&i.push(...l),o+=1}}({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:l,...e,eventIds:f,drawIds:h});if(t?.error)return t}if(e.eventProfiles){let t=function(e){let{eventProfiles:t,allUniqueParticipantIds:r,eventIds:i,drawIds:n}=e,a=0;for(let o of t){let t=BM({...e,eventIndex:a,eventProfile:o});if(t.error)return t;let{eventId:s,drawIds:c,uniqueParticipantIds:u}=t;c&&n.push(...c),i.push(s),u?.length&&r.push(...u),a+=1}}({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:l,...e,eventIds:f,drawIds:h});if(t?.error)return t}let{scheduledRounds:g,schedulerResult:U={}}=s?function(e){let{schedulingProfile:t,tournamentRecord:r,autoSchedule:i,periodLength:n,scheduleCompletedMatchUps:a}=e,o=function({schedulingProfile:e,tournamentRecord:t}){if("object"!=typeof e)return{error:mr};let r=lu({tournamentRecord:t}).containedStructures,i=cm({tournamentRecord:t}).matchUps??[],{tournamentId:n}=t,a=[];for(let o of e){let{scheduleDate:e,venues:s=[]}=o;for(let o of s){let{rounds:s,venueId:c}=o;for(let o of s){let{drawId:s,winnerFinishingPositionRange:u,roundSegment:d}=o,l=i.filter((e=>{let t=u?.indexOf("-")>0&&u.split("-").map((e=>+e)),r=e.finishingPositionRange?.winner;return!(e.drawId!==s||o.roundNumber&&e.roundNumber!==o.roundNumber||r&&t&&2!==si(r,t).length&&(Yr(r).length!==Yr(t).length||si(r,t).length!==Yr(r).length))}))[0];if(l){let{eventId:i,roundNumber:o,drawName:p,structureName:m,roundName:f}=l,h=l.structureId;o&&!u&&(h=Object.keys(r).find((e=>r[e].includes(h)))??h);let g={tournamentId:n,structureId:h,roundNumber:o,roundSegment:d,eventId:i,drawId:s},I=jM({tournamentRecords:{[n]:t},round:g,scheduleDate:e,venueId:c});if(I.error)return I;a.push({structureName:m,roundName:f,drawName:p,...g})}}}}return{scheduledRounds:a}}({schedulingProfile:t,tournamentRecord:r});if(o.error)return o;let s=o.scheduledRounds;if(i){let{tournamentId:e}=r;return{schedulerResult:uM({scheduleCompletedMatchUps:a,tournamentRecords:{[e]:r},periodLength:n}),scheduledRounds:s}}return{scheduledRounds:s}}({...e,tournamentRecord:l}):{};return Fi(),Zi({...I,tournamentRecord:l,scheduledRounds:g,schedulerResult:U,eventIds:f,venueIds:p,drawIds:h})}var tN={};function rN({keepExtensions:e=[],anonymizeParticipantNames:t=!0,tournamentRecord:r,tournamentName:i,personIds:n=[],tournamentId:a}){if(!r)return{error:D};let o=Array.isArray(e)?Eo.concat(...e):Eo,s=t=>Array.isArray(e)?t?.extensions?.filter((e=>o.includes(e.name))):t?.extensions,c={};r.extensions=s(r);let u=a||Jl();c[r.tournamentId]=u,r.tournamentId=u,r.createdAt=(new Date).toISOString(),r.tournamentName=i||`Anonymized: ${ta(new Date)}`,r.isMock=!0,delete r.parentOrganisation;for(let I of r.participants||[]){let e=Jl();c[I.participantId]=e,I.participantId=e}for(let I of r.participants||[])Array.isArray(I.individualParticipantIds)&&(I.individualParticipantIds=I.individualParticipantIds.map((e=>c[e])));let d=0;for(let I of r.venues||[]){I.extensions=s(I),I.venueName=`Venue #${d}`,I.venueAbbreviation=`V${d}`;let e=Jl();c[I.venueId]=e,I.isMock=!0,d+=1}let l=1;for(let I of r.events||[]){I.extensions=s(I),I.isMock=!0;let e=Jl();c[I.eventId]=e,I.eventId=e;let t=I.category?.categoryName||I.category?.ageCategoryCode||I.category?.ratingType||I.gender;if(I.eventName=`Event ${l} ${t}`,Array.isArray(I.entries))for(let i of I.entries)i.participantId=c[i.participantId];for(let i of I.drawDefinitions||[]){i.extensions=s(i);let e=Jl();if(c[i.drawId]=e,i.drawId=e,i.isMock=!0,Array.isArray(i.entries))for(let r of i.entries)r.participantId=c[r.participantId];let t=e=>{e.extensions=s(e);let t=Jl();c[e.structureId]=t,e.structureId=t;for(let r of e.positionAssignments||[])r.participantId&&(r.participantId=c[r.participantId]);for(let r of e.seedAssignments||[])r.participantId&&(r.participantId=c[r.participantId]);for(let r of e.matchUps||[]){r.isMock=!0;for(let e of r.sides||[])e.lineUp&&(e.lineUp=e.lineUp.map((({participantId:e,collectionAssignments:t})=>({participantId:c[e],collectionAssignments:t}))))}};for(let r of i.structures||[])if(t(r),Array.isArray(r.structures))for(let e of r.structures)t(e);for(let r of i.links||[])r.source.structureId=c[r.source.structureId],r.target.structureId=c[r.target.structureId]}let{extension:r}=no({name:ho,element:I});Array.isArray(r?.value?.flights)&&r?.value.flights?.forEach((e=>{if(e.drawId=c[e.drawId],Array.isArray(e.drawEntries))for(let t of e.drawEntries)t.participantId=c[t.participantId]})),l+=1}let p=r.startDate||ta(new Date),m=(r.participants||[]).filter((({participantType:e})=>e===Tu)),f=m.reduce(((e,t)=>{let r=t.person?.sex;return[$p,zp].includes(r)?e[r]+=1:e[Hp]+=1,e}),{[$p]:0,[zp]:0,[Hp]:0}),h=Object.assign({},...Object.keys(f).map((e=>({[e]:SM({category:{ageCategoryCode:"O18"},count:f[e],addressProps:{citiesCount:10},personExtensions:[],consideredDate:p,sex:e})?.persons||[]})))),g={[$p]:0,[zp]:0,[Hp]:0},U=m.length,v=m.reduce(((e,t)=>{let r=t.person?.addresses?.[0]||{},{city:i,state:n,postalCode:a}=r;return e.cities.includes(i)||e.cities.push(i),e.states.includes(n)||e.states.push(n),e.postalCodes.includes(a)||e.postalCodes.push(a),e}),{cities:[],postalCodes:[],states:[]}),y=v.postalCodes.length,S=v.cities.length,w=v.states.length,{cities:P}=fM({count:S||U,participantsCount:U}),{states:T}=hM({count:w||U,participantsCount:U}),{postalCodes:b}=gM({count:y||U,participantsCount:U}),R={cities:P,states:T,postalCodes:b};m.forEach(((e,r)=>{let i=e?.person,a=i?.sex||Hp,o=la(i?.birthDate)?.split("-")[0],u=g[a],d=h[a][u];if(g[a]+=1,o){let[,e,t]=d?.birthDate?.split("-")||[],r=[o,e,t].join("-");d.birthDate=r}if(i?.addresses){let e=UM({...R,participantIndex:r,nationalityCode:d.nationalityCode});d.addresses=[e]}d.personId=n?.[r]||Jl(),t?(d.standardFamilyName=d.lastName,d.standardGivenName=d.firstName,e.participantName=`${d.standardGivenName} ${d.standardFamilyName}`):(d.standardFamilyName=i?.standardFamilyName,d.standardGivenName=i?.standardGivenName),delete d.firstName,delete d.lastName,d.extensions=s(i),e.person=d,c[i?.personId]=d.personId})),(r.participants||[]).filter((({participantType:e})=>e===Ru)).forEach((e=>{let{individualParticipantIds:t}=e;e.participantName=function({individualParticipantIds:e,individualParticipants:t}){let r=t.filter((({participantId:t})=>e.includes(t))).map((({person:e})=>e?.standardFamilyName)).filter(Boolean).sort().join("/");return 1===e.length&&(r+="/Unknown"),r}({individualParticipantIds:t,individualParticipants:m})}));let M=(r.participants||[]).filter((({participantType:e})=>e===Mu)),N=PM({count:M.length}).names;M.forEach(((e,t)=>{e.participantName=N[t]}));let A=(r.participants||[]).filter((({participantType:e})=>e===bu)),E=PM({count:A.length,nameRoot:"Group"}).names;A.forEach(((e,t)=>{e.participantName=E[t]}));let{extension:C}=no({element:r,name:bo});Array.isArray(C?.value)&&C?.value.forEach((e=>{e.tournamentId=c[e.tournamentId],e.structureId=c[e.structureId],e.eventId=c[e.eventId],e.drawId=c[e.drawId]}));let{extension:O}=no({element:r,name:So});return Array.isArray(O?.value)&&O?.value.forEach((e=>{e.personId=c[e.personId]})),{...I}}function iN(e){let{ratingsParameters:t=Qg,participantsProfile:r={},matchUpStatusProfile:i,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,schedulingProfile:c,tournamentRecord:u,eventProfiles:d,periodLength:l,venueProfiles:p,autoSchedule:m,drawProfiles:f,uuids:h}=e;if(!u)return{error:D};let g=[],U=[],v=[];d?.forEach((e=>{let t=u.events?.find(((t,r)=>void 0!==e.eventIndex&&r===e.eventIndex||e.eventName&&t.eventName===e.eventName||e.eventId&&t.eventId===e.eventId));t?.gender&&(e.gender=t.gender)}));let y=u.participants?.length||void 0;y&&r?.idPrefix&&(r.idPrefix=`${r.idPrefix}-${y}`);let S=RM({startDate:u.startDate,participantsProfile:r,tournamentRecord:u,eventProfiles:d,drawProfiles:f,uuids:h});if(!S.success)return S;if(d){let e=u.events?.length||0;for(let t of d){let{ratingsParameters:o}=t,c=u.events?.find(((e,r)=>void 0!==t.eventIndex&&r===t.eventIndex||t.eventName&&e.eventName===t.eventName||t.eventId&&e.eventId===t.eventId));if(c){let{gender:e,category:d,eventType:l}=c,{drawProfiles:p,publish:m}=t,f=hl(El)(l)&&Tu||hl(Ol)(l)&&Ru||l;if(p){let{stageParticipantsCount:m,uniqueParticipantsCount:I,uniqueParticipantStages:U}=MM({drawProfiles:p,category:d,gender:e}),{uniqueDrawParticipants:y=[],uniqueParticipantIds:S=[]}=U?_M({event:{eventType:l,category:d,gender:e},uniqueParticipantsCount:I,participantsProfile:r,ratingsParameters:o,tournamentRecord:u,eventProfile:t,uuids:h}):{};g.push(...S);let{stageParticipants:w}=NM({targetParticipants:u.participants||[],allUniqueParticipantIds:g,stageParticipantsCount:m,eventParticipantType:f}),P=VM({uniqueDrawParticipants:y,autoEntryPositions:a,stageParticipants:w,tournamentRecord:u,drawProfiles:p,category:d,gender:e,event:c});if(P.error||(P=xM({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:u,drawProfiles:p,event:c}),P.error))return P;v.push(...P.drawIds)}m&&TT({tournamentRecord:u,event:c})}else{let c=BM({startDate:u.startDate,allUniqueParticipantIds:g,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,randomWinningSide:s,ratingsParameters:o,tournamentRecord:u,eventProfile:t,eventIndex:e,uuids:h});if(c.error)return c;let{eventId:d,drawIds:l,uniqueParticipantIds:p}=c;l&&v.push(...l),U.push(d),p?.length&&g.push(...p),e+=1}}}if(f){let e=(u.events||[]).map((e=>e.drawDefinitions?.map((()=>1))||[])).flat().reduce(((e,t)=>e+t),0);for(let c of f){let d=GM({startDate:u.startDate,allUniqueParticipantIds:g,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:t,tournamentRecord:u,drawProfile:c,drawIndex:e,uuids:h});if(d.error)return d;let{drawId:l,eventId:p,event:m,uniqueParticipantIds:f}=d;if(d=rb({tournamentRecord:u,event:m,internalUse:!0}),d.error)return d;l&&v.push(l),U.push(p),f?.length&&g.push(...f),e+=1}}let w=p?.length?XM({tournamentRecord:u,venueProfiles:p}):[],P={};if(c?.length){let e=cD({tournamentRecords:{[u.tournamentId]:u},schedulingProfile:c});if(e.error)return e;if(m){let{tournamentId:e}=u;P=uM({tournamentRecords:{[e]:u},periodLength:l})}}return{totalParticipantsCount:u.participants.length,scheduledRounds:undefined,schedulerResult:P,...I,eventIds:U,venueIds:w,drawIds:v}}n(tN,{anonymizeTournamentRecord:()=>rN,modifyTournamentRecord:()=>iN});var nN={};n(nN,{addIndividualParticipantIds:()=>kb,addParticipant:()=>UT,addParticipants:()=>vT,addPenalty:()=>NN,addPersonRequests:()=>lN,addPersons:()=>EN,createGroupParticipant:()=>vN,createTeamsFromParticipantAttributes:()=>lM,deleteParticipants:()=>Tf,filterParticipants:()=>Xm,findParticipant:()=>UN,getCompetitionParticipants:()=>wP,getPairedParticipant:()=>Sp,getParticipantEventDetails:()=>PP,getParticipantMembership:()=>DP,getParticipantScaleItem:()=>Kv,getParticipantSchedules:()=>TP,getParticipantSignInStatus:()=>bP,getParticipantTimeItem:()=>Bu,getParticipants:()=>ef,getScaleValues:()=>$n,mergeParticipants:()=>MN,modifyIndividualParticipantIds:()=>pN,modifyParticipant:()=>xb,modifyParticipantName:()=>yN,modifyParticipantOtherName:()=>fN,modifyParticipantsSignInStatus:()=>mN,modifyPenalty:()=>TN,modifyPersonRequests:()=>uN,mutate:()=>aN,participantScaleItem:()=>jm,query:()=>SP,regenerateParticipantNames:()=>IN,removeIndividualParticipantIds:()=>wf,removeParticipantIdsFromAllTeams:()=>Df,removePenalty:()=>wN,removePersonRequests:()=>dN,scaledTeamAssignment:()=>SN,setParticipantScaleItem:()=>Qv,setParticipantScaleItems:()=>Jv,validateLineUp:()=>uh});var aN={};function oN(e=0){("number"!=typeof e||isNaN(e))&&(e=0);let t=new Date;return t.setHours(t.getHours()+e),t.getTime().toString(36).slice(-6).toUpperCase()}function sN({personRequests:e,personId:t,requests:r}){e[t]||(e[t]=[]);let i=r.filter((({requestType:e})=>e)).map((e=>{let{date:t,startTime:r,endTime:i}=e;return e.requestType===WR&&(t=la(t),r=da(r),i=da(i),t&&r&&i)?{date:t,startTime:r,endTime:i,requestType:e.requestType}:e})).filter(Boolean);for(let n of i)n.requestId=oN(),e[t].push(n);return{mergeCount:i.length}}function cN(e){let{tournamentRecords:t,personRequests:r}=e,i=xn(e,[{[tn]:!0}]);if(i.error)return i;if(!r)return{...I};let n=Object.values(t);for(let a of n){let e=a.participants??[],t=[];for(let i of Object.keys(r))if(Ga({tournamentParticipants:e,personId:i})){let e=r[i];e.length&&t.push({personId:i,requests:e})}Object.keys(t).length&&za({element:a,extension:{value:t,name:So}})}return{...I}}function uN(e){let{tournamentRecords:t,requests:r,personId:i}=e,n=xn(e,[{[tn]:!0},{requests:!0,[En]:Rn,[An]:mr}]);if(n.error)return n;let a=r.map((({requestId:e})=>e)).filter(Boolean),{personRequests:o}=lD({tournamentRecords:t}),s=e=>{o&&(o[e]=o[e].map((e=>{if(!a.includes(e.requestId))return e;let t=r.find((t=>t.requestId===e.requestId));return t.requestType?Object.assign(e,t):void 0})).filter(Boolean))};if(i&&o?.[i])s(i);else if(o)for(let u of Object.keys(o))s(u);let c=r.filter((e=>!e.requestId));return c.length&&sN({personRequests:o,personId:i,requests:c}),cN({tournamentRecords:t,personRequests:o})}function dN(e){let{tournamentRecords:t,requestType:r,requestId:i,personId:n,date:a}=e,o=xn(e,[{[tn]:!0}]);if(o.error)return o;let{personRequests:s}=lD({tournamentRecords:t}),c=e=>{s&&(s[e]=s[e].filter((e=>!(r&&e.requestType===r||i&&e.requestId===i||a&&e.date===a))),s?.[e]?.length||delete s[e])},u=!(r||i||n||a);if(!u)if(n&&s?.[n])c(n);else if(s)for(let d of Object.keys(s))c(d);return!u&&s&&Object.keys(s).length?cN({tournamentRecords:t,personRequests:s}):Wa({name:So,tournamentRecords:t,discover:!0})}function lN(e){let{tournamentRecords:t,personId:r,requests:i}=e,n=xn(e,[{[tn]:!0,personId:!0},{requests:!0,[En]:Rn,[An]:mr}]);if(n.error)return n;let{personRequests:a}=lD({tournamentRecords:t}),{mergeCount:o}=sN({personRequests:a,personId:r,requests:i});return o&&a?cN({tournamentRecords:t,personRequests:a}):{error:mr}}function pN({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:r}){let i="modifyIndividualParticipantIds";if(!r)return en({result:{error:D},stack:i});if(!t||!e)return en({result:{error:He},stack:i});let n=r.participants||[],a=n.find((e=>e.participantId===t));if(!a)return en({result:{error:Ut},stack:i});if(![Mu,bu].includes(a.participantType))return en({result:{error:mt},context:{participantType:a.participantType},stack:i});let o=e.filter((e=>n.find((t=>t.participantId===e))?.participantType!==Tu));if(o.length)return en({result:{error:lt,invalidParticipantIds:o},stack:i});let s=a.individualParticipantIds||[],c=e.filter((e=>!s.includes(e))),u=s.filter((t=>!e.includes(t))),d=kb({individualParticipantIds:c,groupingParticipantId:t,tournamentRecord:r});if(d.error)return en({result:d,stack:i});let l=wf({individualParticipantIds:u,groupingParticipantId:t,tournamentRecord:r});if(l.error)return en({result:l,stack:i});let{topics:p}=Bi();if(p.includes(Bc)){let e=n.find((({participantId:e})=>e===t));ki({topic:Bc,payload:{tournamentId:r.tournamentId,participants:[e]}})}return{...d,...l}}function mN({tournamentRecord:e,participantIds:t,signInState:r}){if(!e)return{error:D};if(!Array.isArray(t))return{error:He};if(![Pu,wu].includes(r))return{error:mr,signInState:r};let i=e.participants||[];if(!i.length)return{error:gt};let n=i.map(Go),a=t.filter((e=>!n.includes(e)));if(a.length)return{error:mr,context:{invalidParticipantIds:a}};let o=[],s=(new Date).toISOString();for(let u of i){let{participantId:i}=u;if(t.includes(i)){let t=og({duplicateValues:!1,tournamentRecord:e,participantId:i,timeItem:{itemType:Su,itemValue:r,createdAt:s}});if(t.error)return t;o.push(u)}}let{topics:c}=Bi();return o.length&&c.includes(Bc)&&ki({topic:Bc,payload:{tournamentId:e.tournamentId,participants:o}}),{...I}}function fN({tournamentRecord:e,participantId:t,participantOtherName:r}){if(!e)return{error:D};if(!t)return{error:It};let{participant:i}=Fu({tournamentRecord:e,participantId:t});if(!i)return{error:Ut};i.participantOtherName=r;let{topics:n}=Bi();return n.includes(Bc)&&ki({topic:Bc,payload:{tournamentId:e.tournamentId,participants:[i]}}),{...I}}function hN({personFormat:e,person:t}){let r=e=>e.replace(/\W/g,""),i=e=>e.toLowerCase().indexOf("l")<e.toLowerCase().indexOf("f"),n=e=>e.indexOf(",")>=0;if(!t)return;let a=e.indexOf(" ")>0?" ":"",o=Cf(t?.standardGivenName??""),s=Cf(t?.standardFamilyName??"");if(!e)return`${o}${a}${s}`;(e=>e.toLowerCase().indexOf("f.")>=0)(e)&&!n(e)&&!i(e)&&(o=`${o[0]}.`),(e=>/^[a-z]*$/.test(r(e)))(e)?(o=o.toLowerCase(),s=s.toLowerCase()):(e=>/^[A-Z]*$/.test(r(e)))(e)?(o=o.toUpperCase(),s=s.toUpperCase()):(e=>/^[LAST]{4}/.test(r(e)))(e)&&(s=s.toUpperCase());let c=`${o}${a}${s}`;return(e=>e.toLowerCase().indexOf("f")<0)(e)?c=s:i(e)&&(c=n(e)?`${s},${a}${o}`:`${s}${a}${o}`),c}function gN({participantMap:e,participant:t,formats:r}){let{participantType:i,individualParticipantIds:n,person:a}=t,o=i&&r[i];if(i!==Du&&o){let{personFormat:r,doublesJoiner:s}=o;i===Tu&&(t.participantName=hN({person:a,personFormat:r})),i===Ru&&(t.participantName=n?.map((t=>{let i=e[t]?.person;return hN({person:i,personFormat:r})})).filter(Boolean).join(s??"/"))}}function IN({tournamentRecord:e,formats:t}){if(!e)return{error:D};if(!d(t))return{error:He};let r=e.participants??[],i=p(r,"participantId");for(let n of r)gN({participant:n,participantMap:i,formats:t});return{...I}}function UN(e){let t,r,{tournamentRecord:i,policyDefinitions:n,contextProfile:a,participantId:o,personId:s}=e,c=e.tournamentRecords||i&&{[i.tournamentId]:i}||{};if("string"!=typeof o&&"string"!=typeof s)return{error:He,stack:"publicFindParticipant"};for(let u of Object.values(c)){if(r=u.tournamentId,t=Ga({tournamentParticipants:u.participants||[],internalUse:!0,policyDefinitions:n,contextProfile:a,participantId:o,personId:s}),t)break}return{participant:t,tournamentId:r,...I}}function vN({individualParticipantIds:e=[],participantRoleResponsibilities:t,participantRole:r=vf,tournamentRecord:i,participantId:n,groupName:a}){if(!i)return{error:D};if(!a)return{error:He,info:"Missing groupName"};if(!Array.isArray(e))return{info:"Invalid individualParticipantIds",error:mr};let o=(ef({participantFilters:{participantTypes:[Tu]},tournamentRecord:i}).participants??[]).map((e=>e.participantId));for(let d of e)if(!o.includes(d))return{error:mt,participantId:d};let s=Zi({participantId:n||Jl(),participantRoleResponsibilities:t,participantName:a,individualParticipantIds:e,participantType:bu,participantRole:r}),c=UT({participant:s,tournamentRecord:i});if(c.error)return c;let{topics:u}=Bi();return u.includes(Rc)&&ki({topic:Rc,payload:{tournamentId:i.tournamentId,participants:[s]}}),{...I,participant:Da(s)}}function yN({tournamentRecord:e,participantName:t,participantId:r}){if(!e)return{error:D};if(!r)return{error:It};if(!t)return{error:He,info:"Missing participantName"};let{participant:i}=Fu({tournamentRecord:e,participantId:r});if(!i)return{error:Ut};i.participantName=t;let{topics:n}=Bi();return n.includes(Bc)&&ki({topic:Bc,payload:{tournamentId:e.tournamentId,participants:[i]}}),{...I}}function SN({clearExistingAssignments:e=!0,individualParticipantIds:t,reverseAssignmentOrder:r,initialTeamIndex:i=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:c,teamsCount:u,eventId:d,event:l}){if(!o)return{error:D};if(!Array.isArray(a)&&!Wr(u)&&!d||!Wr(i)||n&&!Array.isArray(n)||s&&("object"!=typeof s||!Object.keys(s).length))return{error:mr};if(!s&&!n.length||!n&&(!t||!s))return{error:He,info:"Missing scaling details"};if(d&&!a){if(l?.eventType!==xl)return{error:ue};a=l?.entries?.filter((({entryStatus:e})=>e===dd)).map(Go)}if(!a?.length&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:He};let p=t??n.map((({participantId:e})=>e));r&&(a?.reverse(),i+=1),i>(a?.length||0)-1&&(i=0);let m=a?.slice(i).concat(...a.slice(0,i))??[],f=[];for(let I of o.participants??[]){let{participantId:e,participantType:t}=I;if(m.includes(e)){if(t!==Du)return{error:mt,participant:I};f.push(I)}}if(u&&f.length<u){let e=c??"Team",t=ai(0,u-(f?.length||0)).map((t=>({participantName:`${e} ${t+1}`,participantType:Du,participantRole:hf}))),{participants:r=[]}=vT({participants:t,returnParticipants:!0,tournamentRecord:o}),i=r.map(Go),n=o.participants?.filter((({participantId:e})=>i.includes(e)))??[];f.push(...n)}if(!f.length)return{error:hr};if(e)for(let I of f)I.individualParticipantIds=[];else{let e=f.map((e=>e)).flat();t?.length?p=p.filter((t=>!e.includes(t))):n=n?.filter((({participantId:t})=>!e.includes(t)))}if(!t?.length&&!n?.length)return{error:sr,info:"Nothing to be done"};if(!n.length){for(let e of o.participants??[]){let{participantId:t,participantType:r}=e;if(!p.includes(t))continue;if(r!==Tu)return{error:mt,participant:e};let i=jm({scaleAttributes:s,participant:e})?.scaleItem,a={participantId:t,scaleValue:s?.accessor?i?.scaleValue?.[s?.accessor]:i?.scaleValue};n.push(a)}if(!n.length)return{error:Ut}}n.sort(((e,t)=>s?.sortOrder?(t?.scaleValue||0)-(e?.scaleValue||0):(e?.scaleValue||1/0)-(t?.scaleValue||1/0)));for(let I of n)if(!I.participantId)return{error:mr,scaledParticipant:I};let h=0;for(;h<n.length;){for(let e of f){if(h+1>n.length)break;let t=n[h];e.individualParticipantIds.push(t.participantId),h++}f.reverse()}let g=f.map(Go);for(let I of o.events??[]){if(I.eventType!==xl)continue;let e=(I.entries??[]).filter((e=>g.includes(e.participantId)));for(let t of e){let e=t.participantId,r=f.find((t=>t.participantId===e))?.individualParticipantIds;I.entries=(I.entries??[]).filter((e=>!r.includes(e.participantId))),(I.drawDefinitions??[]).forEach((e=>{e.entries=(e.entries??[]).filter((e=>!r.includes(e.participantId)))}));let{flightProfile:i}=op({event:I});(i?.flights||[]).forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!r.includes(e.participantId)))}))}}return{...I,scaledParticipants:n}}function wN(e){let{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:P};for(let r of Object.values(t)){let t=PN({...e,tournamentRecord:r});if(t.error&&t.error!==Vt)return t}return{...I}}function PN({tournamentRecord:e,penaltyId:t}){if(!e)return{error:D};if(!t)return{error:Lt};let r,i=[],n=!1;return(e?.participants??[]).forEach((e=>{let a=!1;e.penalties=(e.penalties??[]).filter((o=>(o.penaltyId===t&&(a=!0,n||(r=o,n=!0)),a&&i.push(e),o.penaltyId!==t)))})),r&&ki({topic:Bc,payload:{tournamentId:e.tournamentId,participants:i}}),r?{...I,penalty:r}:{error:Vt}}n(aN,{addIndividualParticipantIds:()=>kb,addParticipant:()=>UT,addParticipants:()=>vT,addPenalty:()=>NN,addPersonRequests:()=>lN,addPersons:()=>EN,createGroupParticipant:()=>vN,createTeamsFromParticipantAttributes:()=>lM,deleteParticipants:()=>Tf,findParticipant:()=>UN,mergeParticipants:()=>MN,modifyIndividualParticipantIds:()=>pN,modifyParticipant:()=>xb,modifyParticipantName:()=>yN,modifyParticipantOtherName:()=>fN,modifyParticipantsSignInStatus:()=>mN,modifyPenalty:()=>TN,modifyPersonRequests:()=>uN,regenerateParticipantNames:()=>IN,removeIndividualParticipantIds:()=>wf,removeParticipantIdsFromAllTeams:()=>Df,removePenalty:()=>wN,removePersonRequests:()=>dN,scaledTeamAssignment:()=>SN,setParticipantScaleItem:()=>Qv,setParticipantScaleItems:()=>Jv});var DN=({penaltyId:e=Jl()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:e});function TN(e){let{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:P};for(let r of Object.values(t)){let t=bN({...e,tournamentRecord:r});if(t.error&&t.error!==Vt||t.success)return t}return{error:Vt}}function bN({tournamentRecord:e,modifications:t,penaltyId:r}){if(!e)return{error:D};if(!t)return{error:mr,modifications:t};if(!r)return{error:Lt};let i=e?.participants??[],n=Object.keys(DN()).filter((e=>"penaltyId"!==e)),a=Object.keys(t).filter((e=>n.includes(e)));if(!a.length)return{error:Ir};let o,s=[];return i.forEach((e=>{let i=!1;e.penalties=(e.penalties??[]).map((e=>(e.penaltyId===r&&(i=!0,a.forEach((r=>Object.assign(e,{[r]:t[r]}))),o||(o=e)),e))),i&&s.push(e)})),o&&ki({topic:Bc,payload:{tournamentId:e.tournamentId,participants:s}}),o?{...I,penalty:o}:{error:Vt}}function RN(e,t,r){return!e&&t?t:e&&!t||"object"!=typeof e||"object"!=typeof t?e:Yr(Object.keys(e).concat(Object.keys(t))).reduce(((i,n)=>{if(t[n])if(e[n])if(typeof e[n]!=typeof t[n])i[n]=t[n];else if(Array.isArray(e[n]))if(!0===r||Array.isArray(r)&&r.includes(n)){let r=Yr(e[n].map((e=>JSON.stringify(e))).concat(t[n].map((e=>JSON.stringify(e))))).map((e=>JSON.parse(e)));i[n]=r}else i[n]=t[n];else"object"==typeof e[n]?i[n]=RN(e[n],t[n],r):i[n]=t[n];else i[n]=t[n];else i[n]=e[n];return i}),{})}function MN({participants:e=[],tournamentRecord:t,arraysToMerge:r}){if(!t)return{error:D};t.participants||(t.participants=[]);let i=e.filter(fm(sn)).map((e=>({[e.participantId]:e}))),n=Object.assign({},...i),a=[];t.participants=t.participants.map((e=>{if(n[e.participantId]){let t=RN(e,n[e.participantId],r);return a.push(t),t}return e}));let o=t.participants.map(fm(sn))||[],s=e.filter((({participantId:e})=>!o.includes(e))),{topics:c}=Bi();return s.length&&(t.participants=t.participants.concat(...s),c.includes(Rc)&&ki({topic:Rc,payload:{participants:s}})),a.length&&c.includes(Bc)&&ki({topic:Bc,payload:{tournamentId:t.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...I}}function NN(e){let t,{tournamentRecord:r,participantIds:i}=e,n=e.tournamentRecords??(r&&{[r.tournamentId]:r})??{};for(let a of Object.values(n)){let r=(ef({tournamentRecord:a}).participants??[])?.map(Go).filter((e=>i.includes(e)));r.length&&(t=AN({...e,penaltyId:e.penaltyId??t,tournamentRecord:a,participantIds:r}).penaltyId)}return t?{...I,penaltyId:t}:{error:Ut}}function AN({refereeParticipantId:e,tournamentRecord:t,participantIds:r,penaltyCode:i,penaltyType:n,extensions:a,penaltyId:o,matchUpId:s,issuedAt:c,notes:u}){if(!t)return{error:D};if(!r)return{error:It};if(!n)return{error:_t};let d=(t?.participants??[]).filter((e=>r.includes(e.participantId)));if(!d.length)return{error:Ut};let l=(new Date).toISOString(),p=Object.assign(DN({penaltyId:o}),{refereeParticipantId:e,penaltyCode:i,penaltyType:n,matchUpId:s,createdAt:l,issuedAt:c,notes:u});return Array.isArray(a)&&a.forEach((e=>za({element:p,extension:e}))),d.forEach((e=>{e.penalties||(e.penalties=[]),e.penalties.push(p)})),ki({topic:Bc,payload:{tournamentId:t.tournamentId,participants:d}}),{...I,penaltyId:p.penaltyId}}function EN({participantRole:e=hf,tournamentRecord:t,persons:r}){if(!t)return{error:D};if(!Array.isArray(r))return{error:mr};if(!Object.keys(Sf).includes(e))return{error:pt};let i=(t.participants||[]).map((({person:e})=>e?.personId)).filter(Boolean),n=[],a=r.filter((e=>e&&(!e.personId||!i.includes(e.personId)))).map((e=>(e.personId||(e.personId=Jl()),n.push(e.personId),e))),o=(e,t)=>Object.assign({},...Object.keys(e).filter((e=>!t.includes(e))).map((t=>({[t]:e[t]})))),s=0,c=0,u=vT({participants:a.map((t=>Zi({extensions:t.participantExtensions,timeItems:t.participantTimeItems,participantType:Tu,participantRole:e,person:o(t,["participantExtensions","participantTimeItems","pairedPersons"])}))),tournamentRecord:t});if(u.error)return u;c=u.addedCount||0;let d=[],l=ef({participantFilters:{participantTypes:[Tu]},tournamentRecord:t})?.participants??[];if(e===hf&&r.filter((({pairedPersons:e})=>e)).forEach((({personId:e,pairedPersons:t})=>{Array.isArray(t)&&t.forEach((t=>{let r=[e,t.personId].map((e=>Ga({tournamentParticipants:l,personId:e}))).filter(Boolean);if(2===r.length){let e=r.map(Go);d.push(Zi({extensions:t.participantExtensions,timeItems:t.timeItems,participantRole:hf,individualParticipantIds:e,participantType:Ru}))}}))})),d.length){if(u=vT({participants:d,tournamentRecord:t}),u.error)return u;s=u.addedCount||0}let p=c+s;return{...I,addedCount:p,newPersonIds:n}}var CN={};n(CN,{bulkUpdatePublishedEventIds:()=>zP,getAllEventData:()=>XP,getCourtInfo:()=>np,getDrawData:()=>eD,getEventData:()=>tD,getEventPublishStatus:()=>Wm,getPublishState:()=>zm,getVenueData:()=>ap,mutate:()=>ON,publishEvent:()=>TT,publishEventSeeding:()=>FN,publishOrderOfPlay:()=>LN,query:()=>HP,setEventDisplay:()=>QT,unPublishEvent:()=>BN,unPublishEventSeeding:()=>kN,unPublishOrderOfPlay:()=>xN});var ON={};function FN({removePriorValues:e=!0,stageSeedingScaleNames:t,seedingScaleNames:r,tournamentRecord:i,status:n=dl,drawIds:a=[],event:o}){if(!i)return{error:D};if(!o)return{error:de};let s=Wm({event:o,status:n}),c=(s?.seeding?.seedingScaleNames||r)&&{...s?.seeding?.seedingScaleNames,...r};return DT({statusObject:{seeding:Zi({stageSeedingScaleNames:(s?.seeding?.stageSeedingScaleNames||t)&&{...s?.seeding?.stageSeedingScaleNames,...t},seedingScaleNames:c,published:!0,drawIds:a})},removePriorValues:e,status:n,event:o}),ki({topic:zc,payload:{tournamentId:i.tournamentId,eventId:o.eventId,drawIds:a}}),{...I}}function kN({removePriorValues:e=!0,seedingScaleNames:t,tournamentRecord:r,status:i=dl,drawIds:n,stages:a,event:o}){if(!r)return{error:D};if(!o)return{error:de};let s=Wm({event:o});if(s){let r=s.seeding;if(Array.isArray(a)&&r.stageSeedingScaleNames)for(let e of a)r.stageSeedingScaleNames[e]&&delete r.stageSeedingScaleNames[e];Array.isArray(t)&&r?.seedingScaleNames&&(r.seedingScaleNames=r.seedingScaleNames.filter((e=>!t.includes(e)))),Array.isArray(n)&&r?.drawIds&&(r.drawIds=r.drawIds.filter((e=>!n.includes(e)))),(!Object.values(r.stageSeedingScaleNames??{}).length&&!r.seedingScaleNames?.length&&!r.drawIds?.length||!a&&!t&&!n?.length)&&(delete r.stageSeedingScaleNames,delete r.seedingScaleNames,delete r.drawIds,r.published=!1),DT({statusObject:{seeding:r},removePriorValues:e,status:i,event:o})}return ki({topic:Qc,payload:{tournamentId:r.tournamentId,eventId:o.eventId}}),{...I}}function xN(e){let t=e?.tournamentRecords??(e?.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{};if(!Object.keys(t).length)return{error:P};for(let r of Object.values(t)){let t=_N({tournamentRecord:r,...e});if(t.error)return t}return{...I}}function _N({removePriorValues:e=!0,tournamentRecord:t,status:r=dl}){if(!t)return{error:D};let i=`${ul}.${ll}`,{timeItem:n}=xu({element:t,itemType:i}),a=n?.itemValue||{[r]:{}};return a[r]&&delete a[r].orderOfPlay,ag({timeItem:{itemValue:a,itemType:i},element:t,removePriorValues:e}),ki({topic:Jc,payload:{tournamentId:t.tournamentId}}),{...I}}function LN(e){let t=yu(e);if(!Object.keys(t).length)return{error:P};for(let r of Object.values(t)){let t=VN({tournamentRecord:r,...e});if(t.error)return t}return{...I}}function VN({scheduledDates:e=[],removePriorValues:t,tournamentRecord:r,status:i=dl,eventIds:n=[]}){if(!r)return{error:D};let a=`${ul}.${ll}`,{timeItem:o}=xu({element:r,itemType:a}),s=o?.itemValue||{[i]:{}};return s[i].orderOfPlay={published:!0,scheduledDates:e,eventIds:n},ag({timeItem:{itemValue:s,itemType:a},element:r,removePriorValues:t}),ki({topic:Yc,payload:{tournamentId:r.tournamentId,scheduledDates:e,eventIds:n}}),{...I}}function BN({removePriorValues:e=!0,tournamentRecord:t,status:r=dl,event:i}){if(!t)return{error:D};if(!i)return{error:de};let n=`${ul}.${ll}`,{timeItem:a}=Lu({itemType:n,event:i}),o=a?.itemValue||{[r]:{}};return delete o[r].structureIds,delete o[r].drawDetails,delete o[r].drawIds,cg({event:i,timeItem:{itemValue:o,itemType:n},removePriorValues:e}),DT({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:e,status:r,event:i}),ki({topic:Kc,payload:{tournamentId:t.tournamentId,eventId:i.eventId}}),{eventId:i.eventId,...I}}n(ON,{publishEvent:()=>TT,publishEventSeeding:()=>FN,publishOrderOfPlay:()=>LN,setEventDisplay:()=>QT,unPublishEvent:()=>BN,unPublishEventSeeding:()=>kN,unPublishOrderOfPlay:()=>xN});var jN={};function GN({withCompetitiveProfiles:e,opponentParticipantId:t,withIndividualStats:r,teamParticipantId:i,tournamentRecord:n,withScaleValues:a,tallyPolicy:o,matchUps:s}){if(!n)return{error:D};if(s&&!Array.isArray(s))return{error:ke};if(s=s??cm({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!s?.length)return{error:Oe};let c=[];t&&c.push(t),i&&c.push(i);let u=ef({participantFilters:c.length?{participantIds:c}:{participantTypes:[Du]},tournamentRecord:n}).participants??[];if(!u.every((({participantType:e})=>e===Du)))return{error:lt};c.length||c.push(...u.map(Go));let l=new Map,p=new Map,m=new Map,f=new Map,h=(e,t="")=>p.get(e)||p.set(e,{participantName:t,participantId:e,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(e);for(let d of u){let{participantId:e,individualParticipantIds:t}=d;f.set(e,t??[]),h(e,d.participantName)}if(i&&!f.get(i))return en({result:{error:Ut},context:{teamParticipantId:i}});if(t&&!f.get(t))return en({result:{error:Ut},context:{opponentParticipantId:t}});let g=[],U=e=>{let n=[[],[]];for(let t of e){let e=t.participant;if(e?.participantName){l.set(e.participantId,{participantName:e.participantName,ratings:e.ratings});let t=p.get(e.participantId);t&&(t.participantName=e.participantName)}}let a=({side:e,individualParticipantIds:t})=>e.participantId&&(!t?.length||t.includes(e.participantId))&&[e.participantId]||e.participant?.individualParticipantIds?.length&&(!t?.length||si(t,e.participant?.individualParticipantIds).length===e.participant?.individualParticipantIds?.length)&&e.participant.individualParticipantIds;if(f.size){let o=(t,i)=>{for(let o of e){if(!o.participant)continue;let e=a({individualParticipantIds:i,side:o});if(e?.length){let i=o.sideNumber;if(!i)continue;let a=[t];r&&a.push(...e),n[i-1]=a;let s=p.get(t);for(let t of e.filter(Boolean))s&&!s.competitorIds.includes(t)&&s.competitorIds.push(t)}}};if(i)(!t||e.every((e=>e.participant&&(a({individualParticipantIds:f.get(i),side:e})||a({individualParticipantIds:f.get(t),side:e})))))&&o(i,f.get(i));else for(let[e,t]of f)o(e,t)}else if(r)for(let t of e){if(!t.participant)continue;let e=a({individualParticipantIds:[],side:t}),r=t.sideNumber;r&&(n[r-1]=e)}return n};for(let I of s){if(!d(I))return{error:ke};let{matchUpStatus:t,matchUpFormat:r,matchUpType:i,winningSide:n,score:a,sides:s}=I;if(!s||!a||i===gu||t===Yo)continue;let c=U(s);if(!c.filter(Boolean).length)continue;let u=e&&n&&xd({matchUp:I})?.competitiveness;g.push(I);let p=rI({matchUpStatus:t,matchUpFormat:r,tallyPolicy:o,winningSide:n,score:a}),m=iI({matchUpStatus:t,matchUpFormat:r,tallyPolicy:o,winningSide:n,score:a}),{pointsTally:f,tiebreaksTally:v}=nI({matchUpFormat:r,score:a});c.forEach(((e,r)=>{for(let i of e){let e=l.get(i)?.participantName,a=h(i,e);if(a){let e=(e,t)=>t.forEach(((t,r)=>a[e][r]+=t)),i=r?[...v].reverse():v,o=r?[...f].reverse():f,s=r?[...m].reverse():m,c=r?[...p].reverse():p;if(e("tiebreaks",i),e("points",o),e("games",s),e("sets",c),n){let e=n-1===r?0:1;a.matchUps[e]+=1}if(u){let e=u.toLowerCase();a.competitiveness[e]||(a.competitiveness[e]=[0,0]),a.competitiveness[e][r]+=1}if(t){let e=t.toLowerCase();a.matchUpStatuses[e]||(a.matchUpStatuses[e]=0),a.matchUpStatuses[e]+=1}}}}))}let v=["tiebreaks","matchUps","points","games","sets"],y=["competitive","routine","decisive"],S=new Map,w=(e,t)=>(e??0)+(t??0);for(let[d,I]of p.entries()){for(let e of v){let t=I[e].reduce(w);if(t){let r=I[e][0]/t,i=`${e}Ratio`,n=parseFloat(r.toFixed(2));I[i]=n,m.set(d,!0),S.has(i)||S.set(i,[]),S.get(i)?.push(n)}}for(let e of y){let t=I.competitiveness?.[e]?.reduce(w);if(t){let r=I.competitiveness[e][0]/t,i=`${e}Ratio`,n=parseFloat(r.toFixed(2));I[i]=n}}}if(!i){let e=(e,t)=>t-e;for(let t of p.values())for(let r of v){let i=`${r}Ratio`;if("number"==typeof t[i]){let n=S.get(i)?.sort(e).indexOf(t[i]);if("number"==typeof n&&n>=0){t[`${r}Rank`]=n+1}}}}let P={relevantMatchUps:g,...I};return i?(P.teamStats=p.get(i),t&&(P.opponentStats=p.get(t))):P.participatingTeamsCount=m.size,P.allParticipantStats=[...p.values()],P}function qN({participant:e,eventType:t}){let r=e?.person?.personId,i=e?.person?.personOtherIds?.[0],n=e?.person?.tennisId,a=e?.ratings?.[t]?.find((({scaleName:e})=>e===Yg)),o=a?.scaleValue,{wtnRating:s,confidence:c}=o||{};return{timeStamp:a?.scaleDate,personOtherId:i,confidence:c,wtnRating:s,personId:r,tennisId:n}}function $N({tournamentRecord:e}){if(!e)return{error:D};let t=e.tournamentId,{participantMap:r}=ef({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:e,withDraws:!0}),i=(cm({matchUpFilters:{matchUpTypes:[pu,fu]},tournamentRecord:e}).matchUps??[]).flatMap((({sides:e,matchUpType:t})=>e?.flatMap((e=>t===fu?e?.participant?.individualParticipantIds:e?.participant?.participantId||e.participantId)).filter(Boolean))).filter(Boolean),n=[],a={},o={},s={},c=0,u=({id:e,entry:i,eventId:o,eventType:s})=>{let{qualifyingSeeding:c,mainSeeding:u,entryStatus:d,entryStage:l,drawId:p}=i;a[e]||(a[e]=[]);let{participant:m,events:f}=r?.[e]??{},h=qN({participant:m,eventType:s}),g=f?.[o]?.ranking;d===HU&&n.push(e),a[e].push({participantType:m?.participantType,participantId:e,tournamentId:t,eventType:s,eventId:o,drawId:p,entryStatus:d,entryStage:l,...h,ranking:g,mainSeeding:u,qualifyingSeeding:c})};for(let m of e.events??[]){let e={},n=t=>{e[t]||(e[t]={count:0}),e[t].count+=1},{drawDefinitions:a=[],eventType:d,eventId:l}=m,p=a.flatMap((e=>{let{drawId:t,entries:i}=e;c+=1;let a=(e.structures??[]).filter((({stage:e,stageSequence:t})=>e===Is&&1===t||e===Us)).flatMap((({positionAssignments:e})=>e)).filter(Boolean).map((({participantId:e})=>e));return i?.filter((({participantId:e})=>a.includes(e))).map((e=>{let{participantId:i,entryStatus:a,entryStage:o}=e;n(a);let s=r?.[i]?.draws?.[t]?.seedAssignments?.[Is];return{qualifyingSeeding:r?.[i]?.draws?.[t]?.seedAssignments?.[Us],participantId:i,mainSeeding:s,entryStatus:a,entryStage:o,drawId:t}}))})),f=e=>{let t=e.participantId,n=r?.[t].participant.individualParticipantIds?.filter((e=>i.includes(e)));return t&&{[t]:{individualParticipantIds:n}}};d===Fl?(()=>{let e=Object.assign({},...p.map(f).filter(Boolean));p.forEach((t=>{e[t.participantId].individualParticipantIds.forEach((e=>{u({id:e,eventType:d,eventId:l,entry:t})}))}))})():p.forEach((e=>{u({id:e?.participantId,eventType:d,eventId:l,entry:e})}));let h=Object.values(e).reduce(((e,t)=>e+t.count),0);Object.keys(e).forEach((t=>{e[t].pct=e[t].count/h*100})),s[l]={tournamentId:t,eventId:l,entries:p,entryStatuses:e};let g=Object.assign({},...Dd.flatMap((t=>[{[t+"_count"]:e[t]?.count},{[t+"_pct"]:e[t]?.pct}])));o[l]={tournamentId:t,eventId:l,...g}}let d=Object.values(r??{}).filter((({participant:{participantType:e,participantRole:t}})=>e===Tu&&t===hf)),l=d.filter((({participant:e})=>!i.includes(e.participantId))).map((({participant:e})=>e.participantId)),p={nonParticipatingEntriesCount:l.length,individualParticipantsCount:d.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:l,drawDefinitionsCount:c,tournamentId:t};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function WN({eventType:e,matchUps:t,eventId:r,drawId:i}){let n={},a=t.filter((e=>r?e.eventId===r:e.drawId===i)).reduce(((e,t)=>((e=>{let t=e?.matchUpFormat;t&&(n[t]||(n[t]=0),n[t]+=1)})(t),(t.sides??[]).flatMap((e=>(e?.participant?.individualParticipants||[e?.participant]).filter(Boolean))).forEach((t=>e[t.participantId]=t)),e)),{}),o=Object.values(a),s=o.map((t=>qN({participant:t,eventType:e}))).filter((({wtnRating:e})=>e)),c=(o.length-s.length)/o.length*100,u=s.reduce(((e,t)=>{let{wtnRating:r,confidence:i}=t;return e.totalWTN+=r,e.totalConfidence+=i,e}),{totalWTN:0,totalConfidence:0}),d=s?.length?u.totalWTN/s.length:0,l=s?.length?u.totalConfidence/s.length:0,p=Object.values(n).reduce(((e,t)=>e+(t||0)),0);return{matchUpFormatCounts:n,matchUpsCount:p,avgConfidence:l,pctNoRating:c,avgWTN:d}}function HN({firstFlightOnly:e=!0,extensionProfiles:t,tournamentRecord:r}){if(!r)return{error:b};let i={},n=Object.assign({},...(t??[]).map((({name:e,label:t,accessor:i})=>{let n=no({element:r,name:e})?.extension?.value;return{[t||e]:i?pm({element:n,accessor:i})?.value:n}}))),a=r?.tournamentId,o=cm({participantsProfile:{withScaleValues:!0},tournamentRecord:r}).matchUps??[],s=e=>xu({itemType:Mc,itemSubTypes:[Gn],element:{timeItems:e}})?.timeItem?.itemValue?.scaleBasis,c=r?.events?.flatMap((({timeItems:t,drawDefinitions:r=[],extensions:c,eventType:u,eventId:d,category:l})=>{let p=c?.find((e=>e.name===ho))?.value?.flights?.map((e=>({[e.drawId]:e.flightNumber}))),m=p&&Object.assign({},...p),f=c?.find((e=>e.name===mo))?.value?.length||0,h=Object.values(m),g=m&&Math.min(...h),I=s(t);return i[d]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:f,seedingBasis:I?JSON.stringify(I):void 0,tournamentId:a,eventId:d},r.filter((t=>!e||!p||m[t.drawId]===g)).flatMap((e=>{let{matchUpFormat:t,tieFormat:r,timeItems:c,extensions:p,structures:f,drawType:h,drawId:g}=e,{matchUpFormatCounts:U,matchUpsCount:v,avgConfidence:y,pctNoRating:S,avgWTN:w}=WN({eventType:u,matchUps:o,drawId:g}),P=s(c)||I,D=function({extensions:e}){return e?.find((({name:e})=>e===wo))?.value?.slice(1)}({extensions:p}),T=D?.length||0;return i[d].totalPositionManipulations+=T,i[d].generatedDrawsCount+=1,T>i[d].maxPositionManipulations&&(i[d].maxPositionManipulations=T),f?.filter((e=>1===e.stageSequence&&[Us,Is,vs,Ss].includes(e.stage))).map((e=>{let i=[Is,Ss].includes(e.stage)?o.find((t=>t.structureId===e.structureId&&1===t.finishingRound&&t.winningSide)):void 0,s=i?.sides?.find((e=>e.sideNumber===i.winningSide))?.participant,c=s?.participantType===Du&&s.participantId,p=s?.participantType===Ru?s.individualParticipants:[],f=qN({participant:p?.[0]||s,eventType:u}),{personId:I,personOtherId:T,tennisId:b,confidence:R,wtnRating:M}=f||{},N=qN({participant:p?.[1],eventType:u}),{personId:A,personOtherId:E,tennisId:C,confidence:O,wtnRating:F}=N||{},{ageCategoryCode:k,categoryName:x,subType:_}=l??{},L=e.matchUpFormat||t,V=(U[L]||0)/v*100,{tieFormatName:B,tieFormatDesc:j}=BP(r),{tieFormatName:G,tieFormatDesc:q}=BP(e.tieFormat),$=j===q,W=!$&&G,H=e.tieFormat&&!$&&q,z=D?.filter((t=>t.structureId===e.structureId))?.length||0;return{...n,tournamentId:a,eventId:d,structureId:e.structureId,drawId:g,eventType:u,category:_,categoryName:x,ageCategoryCode:k,flightNumber:m[g],drawType:h,stage:e.stage,seedingBasis:P?JSON.stringify(P):void 0,winningPersonId:I,winningPersonOtherId:T,winningPersonTennisId:b,winningPersonWTNrating:M,winningPersonWTNconfidence:R,winningPerson2Id:A,winningPerson2OtherId:E,winningPerson2TennisId:C,winningPerson2WTNrating:F,winningPerson2WTNconfidence:O,winningTeamId:c,positionManipulations:z,pctNoRating:S,matchUpFormat:L,pctInitialMatchUpFormat:V,matchUpsCount:v,drawTieFormatName:B,drawTieFormatDesc:j,tieFormatName:W,tieFormatDesc:H,avgConfidence:y,avgWTN:w}}))}))}));return{eventStructureReports:Object.values(i),structureReports:c}}function zN({ignoreDisabled:e=!0,tournamentRecords:t,tournamentId:r,venueIds:i=[],dates:n=[]}){if(!Array.isArray(n))return{error:mr,dates:n};if(!Array.isArray(i))return{error:mr,venueIds:i};if(!(t&&Object.keys(t).filter((e=>!r||e===r))||[]).length)return{error:P};if(!n.every(Zn))return{error:Xe};let a=QP({tournamentRecords:t,ignoreDisabled:e,dates:n});if(a.error)return a;let o=a?.venues?.filter((({venueId:e})=>!i?.length||i.includes(e))),s=a.courts?.reduce(((e,t)=>(t.dateAvailability?.forEach((t=>{let r=t.date;e.includes(r)||e.push(r)})),e)),[]).filter((e=>!n.length||n.includes(e))),c={venueIds:o?.map((({venueId:e})=>e))},{matchUps:u}=um({afterRecoveryTimes:!0,tournamentRecords:t,matchUpFilters:c});return{venuesReport:o?.map((e=>function(e,t,r){let{venueId:i,courts:n,venueName:a}=t,o={};return e.forEach((e=>{let t=0,a=0,s=0;for(let r of n){let i=r.dateAvailability.find((t=>t.date===e)),n=(i&&hb({courtDate:i}).timeSlots)?.reduce(((e,t)=>{let{startTime:r,endTime:i}=t;return e+(ca(i)-ca(r))}),0);n&&(s+=1),t+=n}let c=r.filter((({schedule:t})=>t.venueId===i&&wa(e,t.scheduledDate)));c.forEach((({schedule:e})=>{let t=da(e.scheduledTime),r=ca(va(t,e.averageMinutes))-ca(t);a+=r}));let u=t?(a/t*100).toFixed(2):"100";o[e]={scheduledMatchUpsCount:c.length,availableCourts:s,availableMinutes:t,scheduledMinutes:a,percentUtilization:u}})),{venueId:i,venueName:a,venueReport:o}}(s,e,u)))}}n(jN,{getEntryStatusReports:()=>$N,getParticipantStats:()=>GN,getStructureReports:()=>HN,getVenuesReport:()=>zN});var YN={};n(YN,{addMatchUpCourtOrder:()=>mR,addMatchUpEndTime:()=>gR,addMatchUpOfficial:()=>fR,addMatchUpResumeTime:()=>UR,addMatchUpScheduleItems:()=>pR,addMatchUpScheduledDate:()=>sR,addMatchUpScheduledTime:()=>aR,addMatchUpStartTime:()=>hR,addMatchUpStopTime:()=>IR,addSchedulingProfileRound:()=>jM,allocateTeamMatchUpCourts:()=>cR,assignMatchUpCourt:()=>dR,assignMatchUpVenue:()=>uR,bulkRescheduleMatchUps:()=>iA,bulkScheduleMatchUps:()=>nM,bulkScheduleTournamentMatchUps:()=>iM,bulkUpdateCourtAssignments:()=>ZN,calculateScheduleTimes:()=>QN,clearMatchUpSchedule:()=>oA,clearScheduledMatchUps:()=>sM,courtGridRows:()=>OD,findMatchUpFormatTiming:()=>iD,findVenue:()=>ep,generateBookings:()=>JR,generateVirtualCourts:()=>Ib,getPersonRequests:()=>lD,getProfileRounds:()=>hD,getScheduledRoundsDetails:()=>nD,getSchedulingProfile:()=>sD,getSchedulingProfileIssues:()=>dD,matchUpScheduleChange:()=>aA,modifyMatchUpFormatTiming:()=>CT,mutate:()=>KN,proAutoSchedule:()=>XN,proConflicts:()=>tA,publicFindCourt:()=>ip,query:()=>rD,removeEventMatchUpFormatTiming:()=>xT,removeMatchUpCourtAssignment:()=>JN,reorderUpcomingMatchUps:()=>rA,scheduleMatchUps:()=>eA,scheduleProfileRounds:()=>uM,setMatchUpDailyLimits:()=>sA,setMatchUpHomeParticipantId:()=>nR,setSchedulingProfile:()=>cD,toggleParticipantCheckInState:()=>Eb,validateSchedulingProfile:()=>oD});var KN={};function QN({calculateStartTimeFromCourts:e=!0,defaultRecoveryMinutes:t=0,averageMatchUpMinutes:r=90,remainingScheduleTimes:i,clearScheduleDates:n,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:c,venueIds:u,endTime:d}){if("object"!=typeof a||!Object.keys(a).length)return{error:P};o=o??Ub({recoveryMinutes:t,averageMatchUpMinutes:r});let{courts:l,venues:p}=QP({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=l?.filter((e=>!u||u.includes(e.venueId)));c||(c=m?.reduce(((e,t)=>{let r=t.dateAvailability?.find((e=>!e.date||wa(s,e.date)))?.startTime??t.startTime;return r&&(!e||ca(r)<ca(e))?r:e}),void 0)),d||(d=m?.reduce(((e,t)=>{let r=t.dateAvailability?.find((e=>!e.date||wa(s,e.date)))?.endTime??t.endTime;return r&&(!e||ca(r)>ca(e))?r:e}),void 0));let f=Object.values(a),h=Object.assign({},...f.map((e=>(e.events??[]).map((t=>{let{scheduleTiming:r}=ad({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:r}}})))).flat()),g=_D({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),I=g?.dateMatchUps??[],U=g?.completedMatchUps??[],v=[];v.push(...I),v.push(...U);let y={averageTimes:[{minutes:{default:r}}],recoveryTimes:[{minutes:{default:t}}]},S=v?.map((({eventId:e,schedule:t,matchUpFormat:r})=>{let{event:i,scheduleTiming:n}=h[e],a=i?.eventType,s={...n,defaultTiming:y,matchUpFormat:r},{averageMinutes:c,recoveryMinutes:u}=Vl({eventType:a,timingDetails:s}),{courtId:d,venueId:l}=t,p=da(t.scheduledTime),m=va(p,c);return{recoveryMinutes:u,averageMinutes:c,periodLength:o,startTime:p,endTime:m,courtId:d,venueId:l}})),w={calculateStartTimeFromCourts:e,remainingScheduleTimes:i,averageMatchUpMinutes:r,date:s,clearScheduleDates:n,periodLength:o,startTime:c,endTime:d,bookings:S,courts:m},{scheduleTimes:D}=Sb(w);return{venueId:1===u?.length&&u[0]||1===p?.length&&p[0].venueId||void 0,scheduleTimes:D,dateScheduledMatchUpIds:v.map(qo)}}function JN(e){let t=xn(e,[{[tn]:!0}]);if(t.error)return t;let{removePriorValues:r,tournamentRecords:i,tournamentId:n,courtDayDate:a,matchUpId:o,courtId:s,drawId:c}=e,u=i[n];if(!u)return{error:D};let{drawDefinition:d,event:l}=RU({tournamentRecord:u,drawId:c});if(!d)return{error:M};let p=bI({drawDefinition:d,event:l,matchUpId:o});if(p.error)return p;if(p?.matchUp?.matchUpType===gu){let{itemValue:e}=jl({timeItems:p.matchUp.timeItems??[],itemType:jd}),t=s&&e.filter((e=>e.courtId!==s));return Mb({duplicateValues:!1,removePriorValues:r,tournamentRecord:u,drawDefinition:d,matchUpId:o,timeItem:{itemType:jd,itemValue:t}})}return dR({tournamentRecord:u,drawDefinition:d,courtDayDate:a,courtId:"",matchUpId:o})}function XN({scheduleCompletedMatchUps:e,tournamentRecords:t,scheduledDate:r,matchUps:i}){if(!Ip(i))return{error:mr};if(i.some((({hasContext:e})=>!e)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:tr};let n=_D({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:t,matchUpFilters:{localPerspective:!0,scheduledDate:r}});if(n.error)return n;let{rows:a}=n,o=[],s=e=>[(e.sides||[]).map((e=>[e.participantId,e.participant?.individualParticipantIds])),(e.potentialParticipants||[]).flat().map((e=>[e.participantId,e.individualParticipantIds]))].flat(1/0).filter(Boolean),c=a?.reduce(((e,t)=>{let r=[],i=[];Object.values(t).forEach((e=>{if(d(e)&&(e.matchUpId&&(r.push(e.matchUpId),o.push(e)),e.sides)){let t=s(e);i.push(...t)}}));let n=Object.values(t).filter((e=>d(e)&&!e.matchUpId));return e.concat({matchUpIds:r,availableCourts:n,rowId:t.rowId,participantIds:i})}),[]);i.filter((({matchUpStatus:t})=>t&&t!==Yo&&(e||!ms.includes(t)))).sort(dm);let u=Im({matchUps:i.concat(o),includeParticipantDependencies:!0,tournamentRecords:t}).matchUpDependencies,l=[],p=[];for(;i.length&&c.length;){let e=c.shift(),t=[];for(;i.length&&e.availableCourts.length;){let r=i.concat(t).map((e=>e.matchUpId)),n=i.shift(),a=n?.matchUpId,o=a&&u[a].matchUpIds.concat(u[a].dependentMatchUpIds),c=a&&r.some((e=>u[a].matchUpIds.includes(e))),d=a&&p.some((e=>u[a].dependentMatchUpIds.includes(e))),m=e.matchUpIds.some((e=>o.includes(e))),f=s(n),h=e.participantIds.some((e=>f.includes(e)));if(!n||m||c||h||d)n&&t.push(n);else{let t=e.availableCourts.shift();Object.assign(n.schedule,t.schedule),Object.assign(t,n),l.push(n),e.participantIds.push(...f),e.matchUpIds.push(a)}}i.push(...t),p.push(...e.matchUpIds)}return n=nM({tournamentRecords:t,matchUpDetails:l.map((({matchUpId:e,tournamentId:t,schedule:i,drawId:n})=>({tournamentId:t,matchUpId:e,drawId:n,schedule:{...i,scheduledDate:r}})))}),{...n,scheduled:l,notScheduled:i}}function ZN(e){let{courtDayDate:t}=e,r=xn(e,[{courtAssignments:!0,[En]:Rn,[An]:He},{[tn]:!0}]);if(r.error)return r;let i,n=e.courtAssignments.reduce(((e,t)=>{let{tournamentId:r}=t;return e[r]||(e[r]=[]),e[r].push(t),e}),{});return Object.keys(n).every((r=>{let a=e[tn][r];if(!a)return i={error:D},!1;let o=n[r].reduce(((e,t)=>{let{drawId:r}=t;return e[r]||(e[r]=[]),e[r].push(t),e}),{});Object.keys(o).every((e=>{let{drawDefinition:r}=sp({tournamentRecord:a,drawId:e});return r?(o[e].every((e=>{let{matchUpId:n,courtId:o}=e,s=dR({tournamentRecord:a,drawDefinition:r,courtDayDate:t,matchUpId:n,courtId:o});if(s.success)return s?.success;i={error:or}})),!0):(i={error:M},!1)}))})),i||I}function eA(e){let{tournamentRecords:t,allDateMatchUpIds:r=[],averageMatchUpMinutes:i=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:c={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:d=!0,remainingScheduleTimes:l,clearScheduleDates:p,periodLength:m=30,scheduleDate:f,matchUpIds:h,venueIds:g,startTime:U,endTime:v,dryRun:y}=e,S=xn(e,[{[tn]:!0,[ln]:!0},{[Mn]:Zn,[An]:Xe,scheduleDate:!0},{[Mn]:e=>!e||!isNaN(e),averageMatchUpMinutes:!1,[An]:mr,recoveryMinutes:!1,periodLength:!1}]);if(S.error)return S;let w=e.competitionMatchUps??um({nextMatchUps:!0,tournamentRecords:t}).matchUps??[],P=e.matchUpDependencies??Im({includeParticipantDependencies:!0,matchUps:w,tournamentRecords:t}).matchUpDependencies;w.forEach((e=>{e.schedule?.scheduledDate&&wa(f,la(e.schedule.scheduledDate))&&jR({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:c,matchUp:e})}));let D=h.map((e=>w.find((t=>t.matchUpId===e)))).filter(Boolean),{venueId:T,scheduleTimes:b,dateScheduledMatchUpIds:R}=QN({tournamentRecords:t,remainingScheduleTimes:l,startTime:da(U),endTime:da(v),scheduleDate:la(f),averageMatchUpMinutes:i,clearScheduleDates:p,periodLength:m,venueIds:g}),M={},N=[],A={},E={},C={};w.filter((({matchUpId:e})=>R?.includes(e))).forEach((e=>{YR({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:e,value:1});let t=e.schedule?.scheduledTime;if(t){A[e.matchUpId]=t;let r=a?.[e.matchUpId];qR({recoveryMinutes:r||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:c,averageMatchUpMinutes:i,matchUpDependencies:P,scheduleTime:t,matchUp:e})}}));let O=D.filter((e=>{let t=R?.includes(e.matchUpId),r=[Yo,Xo,Qo,Ho,ns,ss].includes(e?.matchUpStatus);return!t&&!e.winningSide&&!r})),{matchUpMap:F,overLimitMatchUpIds:k,participantIdsAtLimit:x}=O.reduce(((e,t)=>{let{drawId:r,tournamentId:i,matchUpType:n}=t,{participantIdsAtLimit:a,relevantParticipantIds:d}=rM({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:t});return a?.length?(e.overLimitMatchUpIds.push(t.matchUpId),e.participantIdsAtLimit.push(...a),e):(d.forEach((e=>{GR({individualParticipantProfiles:s,participantId:e});let t=s[e].counters;t[n]?t[n]+=1:t[n]=1,t[Sl]?t[Sl]+=1:t[Sl]=1})),e.matchUpMap[i]||(e.matchUpMap[i]={}),e.matchUpMap[i][r]?e.matchUpMap[i][r].push(t):e.matchUpMap[i][r]=[t],jR({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:c,matchUp:t}),e)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});O=O.filter((({matchUpId:e})=>!k.includes(e)));let _=0,L=b?.length??0,{personRequests:V}=lD({tournamentRecords:t,requestType:WR});for(;b?.length&&O.length&&_<=L;){_++;let{scheduleTime:e}=b.shift(),t=O.find((t=>{let{matchUpId:u}=t,{dependenciesScheduled:l,remainingDependencies:p}=BR({matchUpScheduleTimes:A,matchUpDependencies:P,allDateMatchUpIds:r,matchUp:t});if(!l)return C[u]||(C[u]=[]),C[u].push({scheduleTime:e,remainingDependencies:p}),!1;let{enoughTime:m}=tM({individualParticipantProfiles:s,matchUpNotBeforeTimes:c,matchUpDependencies:P,scheduleTime:e,matchUp:t});if(!m)return E[u]||(E[u]=[]),E[u].push({scheduleTime:e}),!1;let{conflicts:h}=zR({potentials:d,averageMatchUpMinutes:i,requestConflicts:M,personRequests:V,scheduleTime:e,scheduleDate:f,matchUp:t});if(h?.length)return!1;let g=a?.[t.matchUpId];return qR({recoveryMinutes:g||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:c,averageMatchUpMinutes:i,matchUpDependencies:P,scheduleTime:e,matchUp:t}),A[t.matchUpId]=e,!0}));O=O.filter((({matchUpId:e})=>e!==t?.matchUpId)),t||N.push(e)}O.forEach((e=>{YR({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:e})}));let B=[];Object.keys(F).forEach((e=>{let r=t[e];r&&Object.keys(F[e]).forEach((i=>{let{drawDefinition:n}=RU({tournamentRecord:r,drawId:i});n&&F[e][i].forEach((({matchUpId:e})=>{let i=A[e];if(i){let a=i.split(":").map(Sa).join(":"),o=`${la(f)}T${a}`;y?B.push(e):(aR({drawDefinition:n,matchUpId:e,scheduledTime:o}).success&&B.push(e),T&&uR({tournamentRecords:t,tournamentRecord:r,drawDefinition:n,matchUpId:e,venueId:T}))}}))}))}));let j=Bo(O);return{...I,requestConflicts:Object.values(M),remainingScheduleTimes:b?.map((({scheduleTime:e})=>e)),individualParticipantProfiles:s,matchUpNotBeforeTimes:c,participantIdsAtLimit:x,skippedScheduleTimes:N,overLimitMatchUpIds:k,scheduledMatchUpIds:B,noTimeMatchUpIds:j,recoveryTimeDeferred:E,dependencyDeferred:C}}function tA({tournamentRecords:e,matchUps:t}){if(!Ip(t))return{error:Oe};if(t.some((({matchUpId:e,hasContext:t})=>e&&!t)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:tr};let r=ai(1,Math.max(...t.map((({schedule:e})=>e?.courtOrder||1)).map((e=>xr(e))))+1).map((e=>t.filter((t=>xr(t.schedule?.courtOrder)===e)))),i={},n={},a={};r.flat().filter(Boolean).sort(dm).forEach((({schedule:e})=>delete e[Nl]));let o=Im({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:Yr(t.map((({drawId:e})=>e)))}).matchUpDependencies,s=r.map(((e,t)=>e.reduce(((e,r)=>{if(!r.matchUpId)return e;let{matchUpId:s,winnerMatchUpId:c,loserMatchUpId:u,schedule:d,sides:l,potentialParticipants:p}=r,m=d?.courtId;i[s]=t,n[m]=[],e.matchUpIds.push(s),a[s]=r;let f=o[s].matchUpIds;f.length&&e.sourceMatchUpIds.push(...f);let h=l?.map((e=>[e.participant?.individualParticipantIds,e.participantId])).flat().filter(Boolean)??[],g=p?.flat().map((({individualParticipantIds:e,participantId:t})=>[e,t])).flat().filter(Boolean)||[];return e.participantIds.push(...g,...h),c&&e.targetMatchUpIds.push(c),u&&e.targetMatchUpIds.push(u),e}),{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]}))),c=s.map((()=>[])),u=(e,t,r,o)=>{if(!a[e].schedule[Nl]){a[e].schedule[Nl]=t,a[e].schedule[Dl]=o,c[i[e]].push({matchUpId:e,issueType:r,issueIds:o,issue:t});let s=a[e].schedule.courtId;n[s]||(n[s]=[]),n[s].push({matchUpId:e,issue:t,issueType:r,issueIds:o})}};return s.forEach(((e,t)=>{let r=t?s[t-1]:void 0,i=s.slice(t+1),n={},c=Xr(e.participantIds),d=Object.keys(c).filter((e=>c[e]>1)),l=e.matchUpIds.filter((e=>o[e].participantIds.some((e=>d.includes(e)))));l.forEach((e=>{n[e]||(n[e]={}),n[e][Tl]||(n[e][Tl]=l.filter((t=>t!==e)))}));let p=r&&e.participantIds.filter((e=>r.participantIds.includes(e)));p&&p.forEach((t=>{let i=e.matchUpIds.concat(r.matchUpIds).filter((e=>o[e].participantIds.includes(t)));i.forEach((e=>{n[e]||(n[e]={}),n[e][bl]||(n[e][bl]=i.filter((t=>t!==e)))}))})),e.matchUpIds.forEach((t=>{let s=o[t].matchUpIds;for(let e of i){let r=e.matchUpIds.filter((e=>s.includes(e)));r?.length&&(r.forEach((e=>u(e,Rl,Pl,[t]))),u(t,Rl,Pl,r))}if(n[t]?.[Tl]&&u(t,Tl,wl,n[t][Tl]),e.sourceMatchUpIds.includes(t)){let r=e.matchUpIds.filter((e=>o[e].matchUpIds.includes(t)));u(t,Tl,Pl,r),e.matchUpIds.filter((e=>o[e].matchUpIds.includes(t))).forEach((e=>u(e,Tl,Pl,[t])))}let c=r?.matchUpIds?.filter((e=>((e,t)=>o[e].sources.reduce(((e,r,i)=>r.includes(t)&&i+1||e),0))(t,e)>1));if(c?.length&&(u(t,Ml,Pl,c),c.forEach((e=>u(e,Ml,Pl,[t])))),n[t]?.[bl]&&u(t,bl,wl,n[t][bl]),r?.targetMatchUpIds?.includes(t)){let e=a[t].schedule.courtId,i=s.filter((e=>r.matchUpIds.includes(e)));i.some((t=>a[t].schedule.courtId===e))||(i.forEach((e=>u(e,bl,Pl,[t]))),u(t,bl,Pl,i))}}))})),{courtIssues:n,rowIssues:c}}function rA(e){let t="reorderUpcomingMatchUps",{tournamentRecords:r}=e;if("object"!=typeof r||!Object.keys(r).length)return en({result:{error:P},stack:t});let{matchUpsContextIds:i,firstToLast:n}=e;if(!i)return en({result:{error:He},stack:t});let a=i?.length;if(!a)return{...I};let o=0;return i.forEach(((e,t)=>{let{tournamentId:s,drawId:c,matchUpId:u}=e,d=t+(n?-1:1);d<0&&(d=a-1),d===a&&(d=0);let l=function({tournamentId:e,scheduledTime:t,matchUpId:i,drawId:n}){let a=r[e],{drawDefinition:o}=RU({tournamentRecord:a,drawId:n});return o?aR({drawDefinition:o,scheduledTime:t,matchUpId:i}):{error:A}}({tournamentId:s,scheduledTime:i[d].schedule.scheduledTime,matchUpId:u,drawId:c});if(!l.success)return l;o++})),o===a?I:en({result:{error:nr},stack:t})}function iA(e){let{scheduleChange:t,matchUpIds:r,dryRun:i}=e;if(!r||!Array.isArray(r))return{error:Ee};if("object"!=typeof t)return{error:mr};let n=yu(e),a=[],o=[];for(let c of Object.values(n)){let e=nA({tournamentRecord:c,scheduleChange:t,matchUpIds:r,dryRun:i});if(e.error)return e;Array.isArray(e.notRescheduled)&&o.push(...e.notRescheduled);let n=Bo(e.notRescheduled),s=[];e.rescheduled?.forEach((e=>{let{matchUpId:t}=e;n.includes(t)&&s.push(t),a.push(e)})),s.length&&(o=e?.notRescheduled?.filter((({matchUpId:e})=>!s.includes(e)))||[])}let s=!(!a.length||o.length);return{...I,rescheduled:a,notRescheduled:o,allRescheduled:s}}function nA({tournamentRecord:e,scheduleChange:t,matchUpIds:r,dryRun:i}){if(!e)return{error:D};if(!r||!Array.isArray(r))return{error:Ee};if("object"!=typeof t)return{error:mr};let n=[],a=[],{minutesChange:o,daysChange:s}=t;if(!o&&!s)return{...I};if(o&&isNaN(o))return{error:mr};if(s&&isNaN(s))return{error:mr};let{matchUps:c}=cm({matchUpFilters:{matchUpIds:r},tournamentRecord:e}),u=c?.filter((e=>AD({schedule:e.schedule}))).filter((e=>(({matchUpStatus:e})=>!ms.includes(e))({matchUpStatus:e.matchUpStatus})));if(!u?.length)return{...I};let{tournamentInfo:d}=FP({tournamentRecord:e}),{startDate:l,endDate:p}=d,m=u?.reduce(((e,t)=>{let{matchUpId:r,drawId:i}=t;return e[i]?e[i].push(r):e[i]=[r],e}),{});for(let I of Object.keys(m)){let t=RU({tournamentRecord:e,drawId:I});if(t.error)return t;let c=t.drawDefinition,d=m[I].filter((e=>r.includes(e)));for(let e of d)if(e&&c){let t,r,d,m=u.find((t=>t.matchUpId===e))?.schedule,{scheduledTime:f,scheduledDate:h}=m;if(!t&&s&&h){d=pa(la(h),s),t=new Date(d)<new Date(l)||new Date(d)>new Date(p)}if(o&&f){let e=la(f),i=ca(da(f))+o;if(t=i<0||i>1440,!t){let t=va(f,o),i=e&&d||h===e&&e;r=i?`${i}T${t}`:t}}if(t)a.push(e);else{if(!i){if(r){let t=aR({scheduledTime:r,drawDefinition:c,matchUpId:e});if(t.error)return t}if(d){let t=sR({scheduledDate:d,drawDefinition:c,matchUpId:e});if(t.error)return t}}(r||d)&&n.push(e)}}}let f=cm({matchUpFilters:{matchUpIds:r},tournamentRecord:e}).matchUps??[],h=f.filter((({matchUpId:e})=>n.includes(e))),g=f.filter((({matchUpId:e})=>a.includes(e))),U=h.length&&!g.length;return{...I,rescheduled:h,notRescheduled:g,allRescheduled:U}}function aA(e){let t="matchUpScheduleChange",{tournamentRecords:r}=e;if("object"!=typeof r||!Object.keys(r).length)return{error:P};let{sourceMatchUpContextIds:i,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=e||{},{drawId:c,matchUpId:u,tournamentId:d}=i||{},{drawId:l,matchUpId:p,tournamentId:m}=n||{};if(!u&&!p)return en({result:{error:He},stack:t});let{matchUps:f}=um({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[c,l].filter(Boolean)},tournamentRecords:e.tournamentRecords}),h=f?.find((({matchUpId:e})=>e===u)),g=f?.find((({matchUpId:e})=>e===p)),U=0;if(o&&u&&!p){let e=v({tournamentId:d,matchUpId:u,courtId:o,matchUp:h,drawId:c,tournamentRecords:r,sourceCourtId:a,courtDayDate:s});if(e?.success&&U++,e.error)return en({result:e,stack:t})}else{if(!(a&&o&&u&&p))return{error:He};{let e=v({tournamentId:d,matchUpId:u,courtId:o,matchUp:h,drawId:c,tournamentRecords:r,sourceCourtId:a,courtDayDate:s});if(e.success&&U++,e.error)return en({result:e,stack:t,info:"source"});let i=v({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:l,tournamentRecords:r,courtDayDate:s});if(i.success&&U++,i.error)return en({result:i,stack:t,info:"target"})}}return U?I:en({result:{error:ar},stack:t});function v(e){let{tournamentRecords:t,tournamentId:r,matchUp:i,drawId:n}=e,a=t[r],{drawDefinition:o}=RU({tournamentRecord:a,drawId:n});return i.matchUpType===Iu?function({removePriorValues:e,tournamentRecords:t,tournamentRecord:r,drawDefinition:i,sourceCourtId:n,courtDayDate:a,matchUpId:o,matchUp:s,courtId:c}){let u=[c].concat(s.schedule.allocatedCourts.map((({courtId:e})=>e)).filter((e=>e!==n)));return cR({removePriorValues:e,tournamentRecords:t,tournamentRecord:r,drawDefinition:i,courtDayDate:a,matchUpId:o,courtIds:u})}({...e,tournamentRecord:a,drawDefinition:o}):dR({...e,tournamentRecord:a,drawDefinition:o})}}function oA({scheduleAttributes:e=[jd,Gd,Bd,$d,zd,Yd,Jd,Qd,Kd],tournamentRecord:t,drawDefinition:r,matchUpId:i}){let n=r?lm({matchUpFilters:{matchUpIds:[i]},inContext:!1,drawDefinition:r}).matchUps?.[0]:cm({matchUpFilters:{matchUpIds:[i]},tournamentRecord:t,inContext:!1}).matchUps?.[0];if(!n)return{error:Ce};let a=(n.timeItems??[]).filter((t=>t?.itemType&&!e.includes(t?.itemType)));return n.timeItems=a,iu({tournamentId:t.tournamentId,context:"clearMatchUpSchedule",drawDefinition:r,matchUp:n}),{...I}}function sA(e){let{tournamentRecord:t,tournamentId:r,dailyLimits:i}=e,n=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if("object"!=typeof n||!Object.keys(n).length)return{error:P};if("object"!=typeof i)return{error:dr};let a=Object.keys(n).filter((e=>!r||r===e));if(r&&!a.includes(r))return{error:mr};for(let o of a){let e=n[o],t=za({extension:{name:Do,value:{dailyLimits:i}},element:e});if(t.error)return t}return{...I}}n(KN,{addMatchUpCourtOrder:()=>mR,addMatchUpEndTime:()=>gR,addMatchUpOfficial:()=>fR,addMatchUpResumeTime:()=>UR,addMatchUpScheduleItems:()=>pR,addMatchUpScheduledDate:()=>sR,addMatchUpScheduledTime:()=>aR,addMatchUpStartTime:()=>hR,addMatchUpStopTime:()=>IR,addSchedulingProfileRound:()=>jM,allocateTeamMatchUpCourts:()=>cR,assignMatchUpCourt:()=>dR,assignMatchUpVenue:()=>uR,bulkRescheduleMatchUps:()=>iA,bulkScheduleMatchUps:()=>nM,bulkScheduleTournamentMatchUps:()=>iM,bulkUpdateCourtAssignments:()=>ZN,calculateScheduleTimes:()=>QN,clearMatchUpSchedule:()=>oA,clearScheduledMatchUps:()=>sM,courtGridRows:()=>OD,findMatchUpFormatTiming:()=>iD,findVenue:()=>ep,generateBookings:()=>JR,generateVirtualCourts:()=>Ib,matchUpScheduleChange:()=>aA,modifyMatchUpFormatTiming:()=>CT,proAutoSchedule:()=>XN,proConflicts:()=>tA,publicFindCourt:()=>ip,removeEventMatchUpFormatTiming:()=>xT,removeMatchUpCourtAssignment:()=>JN,reorderUpcomingMatchUps:()=>rA,scheduleMatchUps:()=>eA,scheduleProfileRounds:()=>uM,setMatchUpDailyLimits:()=>sA,setMatchUpHomeParticipantId:()=>nR,setSchedulingProfile:()=>cD,toggleParticipantCheckInState:()=>Eb,validateSchedulingProfile:()=>oD});var cA={};n(cA,{addCollectionDefinition:()=>TA,addCollectionGroup:()=>DA,aggregateTieFormats:()=>NA,compareTieFormats:()=>jP,getTieFormat:()=>WP,modifyCollectionDefinition:()=>hA,modifyTieFormat:()=>MA,mutate:()=>uA,orderCollectionDefinitions:()=>vA,query:()=>VP,removeCollectionDefinition:()=>PA,removeCollectionGroup:()=>IA,tieFormatGenderValidityCheck:()=>_I,validateCollectionDefinition:()=>KI});var uA={};function dA({drawDefinition:e,structureId:t,matchUpId:r,structure:i,matchUp:n,eventId:a,event:o}){let s,c="getTieFormat";if(t=i?.structureId??t,((r=n?.matchUpId??r)||t)&&!e)return{error:M};if(a&&o)s=dp(o);else if(r){if(e&&(!n||!i)){let t=bI({drawDefinition:e,matchUpId:r});if(t.error)return t;if(t.matchUp?.matchUpType!==gu)return en({result:{error:ke},stack:c});i||(i=t.structure),n||(n=t.matchUp)}s=lp({item:n,drawDefinition:e,structure:i,event:o})||lp({item:i,drawDefinition:e,structure:i,event:o})||dp(e)||dp(o)}else if(e&&t){if(!i){let r=yc({drawDefinition:e,structureId:t});if(r.error)return r;i=r?.structure}s=lp({item:i,drawDefinition:e,structure:i,event:o})||dp(e)||dp(o)}else s=dp(e)||dp(o);return s?{...I,structure:i,tieFormat:s,matchUp:n}:en({result:{error:Ne},stack:c})}function lA({matchUp:e,updateInProgressMatchUps:t}){return!e.winningSide&&![ms].includes(e.matchUpStatus)&&(t||e.matchUpStatus!==ts&&!Um(e))}function pA({from:e,to:t}){let r=Object.keys(e),i=si(r,Object.keys(t)).length===r.length,n=r.filter((r=>e[r]!==t[r])).map((r=>({countChange:t[r]-e[r],collectionId:r}))),a=r.every((r=>e[r]===t[r]));return{equivalent:i&&a,matchUpsCountChanges:n}}function mA({check:e,matchUp:t}){let r="",i=[];return{changesArePossible:e.matchUpsCountChanges.every((({collectionId:e,countChange:n})=>{let a=t.tieMatchUps.filter((t=>t.collectionId===e&&t.matchUpStatus===os)).map(fm("matchUpId")),o=a.length+n>=0||n>0;return!o&&n<0&&(r="Insufficient TO_BE_PLAYED matchUps"),i.push({toBePlayedTieMatchUpIds:a,collectionId:e,countChange:n}),o})),changes:i,cannotChangeReaon:r}}function fA({appliedPolicies:e,drawDefinition:t,auditData:r}){if(!e?.audit?.[No])return;let{extension:i}=no({name:No,element:t});za({element:t,extension:{value:Array.isArray(i?.value)?i?.value.concat(r):[r],name:No}})}function hA({updateInProgressMatchUps:e=!1,tournamentRecord:t,collectionOrder:r,collectionName:i,tieFormatName:n,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:c,matchUpType:u,structureId:d,matchUpId:l,category:p,eventId:m,gender:f,event:h,collectionValueProfiles:g,collectionValue:U,matchUpValue:v,scoreValue:y,setValue:S}){let w="modifyCollectionDefinition";if(o&&!qI({matchUpFormat:o}))return en({result:{error:mr},context:{matchUpFormat:o},stack:w});if(i&&"string"!=typeof i)return en({result:{error:mr},context:{collectionName:i},stack:w});if(f&&!Object.values(Yp).includes(f))return en({result:{error:mr},context:{gender:f},stack:w});if(p&&"object"!=typeof p)return en({result:{error:mr},context:{category:p},stack:w});let P={collectionValueProfiles:g,collectionValue:U,matchUpValue:v,scoreValue:y,setValue:S};if(!(Object.values(P).filter(Boolean).length||r||i||o||s||u))return en({result:{error:He},stack:w});if(Object.values(P).filter(Boolean).length>1)return en({info:"Only one value assignment allowed per collectionDefinition",result:{error:mr},stack:w});let D=dA({drawDefinition:a,structureId:d,matchUpId:l,eventId:m,event:h});if(D.error)return en({result:D,stack:w});let{matchUp:T,structure:b,tieFormat:R}=D,N=ZI(R),A=R?.collectionDefinitions.find((e=>e.collectionId===c)),E=N?.collectionDefinitions.find((e=>e.collectionId===c));if(!A)return en({info:"source collectionDefinition",result:{error:vr},context:{collectionId:c},stack:w});let C=U??v??y??S;if(g?.length){let e=FI({matchUpCount:s??A?.matchUpCount??0,collectionValueProfiles:g});if(e.errors)return en({result:{error:mr},info:e.errors,stack:w})}else if(C&&!Wr(C))return en({result:{error:mr},info:"value is not an integer",context:{value:C},stack:w});let O=g&&(!A.collectionValueProfiles||(k=A.collectionValueProfiles,x=g,!(si(Object.keys(k),Object.keys(x)).length===Object.keys(k).length&&si(Object.values(k),Object.values(x)).length===Object.values(k).length))),F=[];var k,x;if((Wr(U)&&A.collectionValue!==U||Wr(v)&&A.matchUpValue!==v||Wr(y)&&A.scoreValue!==y||Wr(S)&&A.setValue!==S||O)&&(E.collectionValueProfiles=void 0,E.collectionValue=void 0,E.matchUpValue=void 0,E.scoreValue=void 0,E.setValue=void 0,Object.assign(E,P),F.push({collectionId:c,...Zi(P)})),(Wr(y)||Wr(S))&&E.collectionGroupNumber){let e=E.collectionGroupNumber;N.collectionDefinitions=N.collectionDefinitions.map((t=>{let{collectionGroupNumber:r,...i}=t;return r===e?i:t})),N.collectionGroups=N.collectionGroups.filter((({groupNumber:t})=>t!==e)),F.push({collectionId:c,change:"collectionGroupNumber removed"})}let{aggregateValue:_,valueGoal:L}=GD(N),V=Zi({aggregateValue:_,valueGoal:L});if((V.aggregateValue!==R?.winCriteria.aggregateValue||V.valueGoal!==R?.winCriteria.valueGoal)&&(N.winCriteria=V,F.push({collectionId:c,winCriteria:V})),Wr(r)&&A.collectionOrder!==r&&(E.collectionOrder=r,F.push({collectionId:c,collectionOrder:r})),i&&A.collectionName!==i&&(E.collectionName=i,F.push({collectionId:c,collectionName:i})),o&&A.matchUpFormat!==o&&(E.matchUpFormat=o,F.push({collectionId:c,matchUpFormat:o})),Wr(s)&&A.matchUpCount!==s&&(E.matchUpCount=s,F.push({collectionId:c,matchUpCount:s})),u&&A.matchUpType!==u)return en({result:{error:yr},context:{matchUpType:u},stack:w});p&&A.category!==p&&(E.category=p,F.push({collectionId:c,category:p})),f&&A.gender!==f&&(E.gender=f,F.push({collectionId:c,gender:f}));let B=Zi(N);if(D=QI({tieFormat:B}),D.error)return en({result:D,stack:w});if(!F.length)return en({result:{...I,modifications:F}});if(R?.tieFormatName!==n?(B.tieFormatName=n,F.push({tieFormatName:n})):F.length&&(delete B.tieFormatName,F.push("tieFormatName removed: modifications without new tieFormatName")),D=function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:r,structure:i,tieFormat:n,eventId:a,matchUp:o,event:s,uuids:c}){let u="updateTieFormat",d=t?.tournamentId,l=0,p=0,m=0,f=0,h=n?.collectionDefinitions.reduce(((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e)),{}),g=({tieFormat:e})=>{let t=e?.collectionDefinitions.reduce(((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e)),{});return pA({from:t,to:h}).equivalent},U=dA({drawDefinition:r})?.tieFormat,v=dA({event:s})?.tieFormat;if(s&&a){for(let e of s.drawDefinitions??[])y({drawDefinition:e});s.tieFormat=ZI(n),f+=1}else if(o){if(!o.tieMatchUps)return en({result:{error:ke},stack:u});let t=Xr(o.tieMatchUps?.map((({collectionId:e})=>e))),i=pA({to:h,from:t}),{changes:a,changesArePossible:l,cannotChangeReaon:m}=mA({matchUp:o,check:i});if(i.equivalent){if(!lA({matchUp:o,updateInProgressMatchUps:e}))return en({result:{error:at},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});o.tieFormat=ZI(n),f+=1}else{if(!l)return en({context:{collectionMap:h,matchUpMap:t},result:{error:Te},info:m||"specified changes not possible",stack:u});w({tieFormat:n,matchUp:o,changes:a,uuids:c})}p+=1,iu({eventId:s?.eventId,context:u,drawDefinition:r,tournamentId:d,matchUp:o})}else if(i){let e=S({inheritedTieFormat:U??v,structure:i})?.modifiedMatchUpsCount;e&&(p+=e,l+=1,f+=1);let t=!i.tieFormat||jP({ancestor:i.tieFormat,descendant:n}).different;t&&(i.tieFormat=ZI(n),l+=1,f+=1),(e||t)&&r&&au({structureIds:[i.structureId],eventId:s?.eventId,drawDefinition:r})}else{if(!r)return{error:M};y({drawDefinition:r}),r.tieFormat=ZI(n),f+=1}return{modifiedStructuresCount:l,modifiedMatchUpsCount:p,addedMatchUpsCount:m,modifiedCount:f,...I,tieFormat:n};function y({drawDefinition:e}){let t=e.structures||[],r=[];for(let i of t){if(i.tieFormat)continue;let e=S({inheritedTieFormat:v,structure:i})?.modifiedMatchUpsCount;if(e){l+=1,p+=e;let t=i.structureId;r.push(t)}}return au({structureIds:r,eventId:s?.eventId,drawDefinition:e}),r.length}function S({inheritedTieFormat:i,structure:o}){let s=0,d=Kp({matchUpFilters:{matchUpTypes:[Iu]},structure:o})?.matchUps||[];for(let l of d){let o=lA({matchUp:l,updateInProgressMatchUps:e}),d=!1,p=pA({from:Xr(l.tieMatchUps?.map((({collectionId:e})=>e))),to:h});if(p.equivalent)l.tieFormat&&g(l)&&o&&(l.tieFormat=ZI(n),d=!0);else{let{changes:e,changesArePossible:t}=mA({matchUp:l,check:p});if(t&&!l.tieFormat)w({changes:e,matchUp:l,tieFormat:n,uuids:c});else{if(!i)return en({result:{error:Ne},stack:u});(!l.tieFormat||jP({ancestor:i,descendant:l.tieFormat}).different)&&(l.tieFormat=i,d=!0)}}d&&(s+=1,iu({tournamentId:t?.tournamentId,drawDefinition:r,context:u,eventId:a,matchUp:l}))}return{modifiedMatchUpsCount:s}}function w({uuids:e,matchUp:t,tieFormat:i,changes:n}){t.tieFormat=ZI(i);let o=[],s=[];return n.forEach((r=>{if(r.countChange>0){let n=Math.max(0,...t.tieMatchUps.filter((e=>e.collectionId===r.collectionId)).map(fm("collectionPosition"))),a=i.collectionDefinitions.find((e=>e.collectionId===r.collectionId)),o=$g({matchUpsLimit:r.countChange,collectionPositionOffset:n,collectionDefinition:a,matchUp:t,uuids:e});s.push(...Da(o,!1,!0)),m+=s.length,t.tieMatchUps.push(...o)}else{let e=r.toBePlayedTieMatchUpIds.slice(0,Math.abs(r.countChange));console.log("remove",e.length),o.push(...e),t.tieMatchUps=t.tieMatchUps.filter((({matchUpId:t})=>!e.includes(t)))}})),s.length&&tu({matchUps:s,drawDefinition:r,tournamentId:d,eventId:a}),o.length&&ru({matchUpIds:o,action:"updateTieFormat",drawDefinition:r,tournamentId:d,eventId:a}),{matchUpIdsRemoved:o,matchUpsAdded:s}}}({tieFormat:B,updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:a,structure:b,eventId:m,matchUp:T,event:h}),!D.error){let{appliedPolicies:e}=Yu({tournamentRecord:t});fA({appliedPolicies:e,drawDefinition:a,auditData:Zi({collectionDefinition:E,drawId:a?.drawId,action:w,structureId:d,matchUpId:l,eventId:m})})}return en({result:{...D,modifications:F},stack:w})}function gA({updateInProgressMatchUps:e,originalValueGoal:t,tournamentRecord:r,wasAggregateValue:i,tieFormatName:n,drawDefinition:a,structureId:o,structure:s,tieFormat:c,matchUpId:u,matchUp:d,eventId:l,event:p}){let{aggregateValue:m,valueGoal:f}=GD(c);c.winCriteria=Zi({aggregateValue:m,valueGoal:f}),(t&&t!==f||m&&!i)&&(n?c.tieFormatName=n:delete c.tieFormatName);let{targetMatchUps:h}=function({updateInProgressMatchUps:e,drawDefinition:t,structureId:r,structure:i,matchUpId:n,matchUp:a}){let o=[];return n&&a?o=[a]:r&&i?o=Kp({matchUpFilters:{matchUpTypes:[Iu]},structure:i})?.matchUps??[]:t&&(o=lm({matchUpFilters:{matchUpTypes:[Iu]},drawDefinition:t})?.matchUps??[]),{targetMatchUps:o.filter((t=>!t.winningSide&&t.matchUpStatus!==Qo&&(e||t.matchUpStatus!==ts&&!Um(t))))}}({updateInProgressMatchUps:e,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:d});!function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:r,targetMatchUps:i,tieFormat:n,event:a}){for(let o of i){let i,s=!!o.tieFormat;if(s&&(o.tieFormat=ZI(n)),e){let e=Yu({tournamentRecord:t,drawDefinition:r,event:a}).appliedPolicies,n=rU({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:t,appliedPolicies:e,drawDefinition:r,event:a});if(n.error)return n;i=n.score}s&&!i&&iu({tournamentId:t?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:o,drawDefinition:r})}}({updateInProgressMatchUps:e,tournamentRecord:r,targetMatchUps:h,drawDefinition:a,tieFormat:c,event:p});let g=Zi(c),U=QI({tieFormat:g});if(U.error)return U;if(l&&p)p.tieFormat=g;else if(u&&d)d.tieFormat=c;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!d||!a)return{error:M};return au({drawDefinition:a,eventId:p?.eventId}),{...I}}function IA({updateInProgressMatchUps:e=!0,collectionGroupNumber:t,tournamentRecord:r,drawDefinition:i,tieFormatName:n,structureId:a,matchUpId:o,matchUp:s,eventId:c,event:u}){if(!t)return{error:He};if(isNaN(t))return{error:mr};let d="removeCollectionGroup",l=s?void 0:dA({drawDefinition:i,structureId:a,matchUpId:o,eventId:c,event:u});if(l?.error)return en({result:l,stack:d});let p=l?.structure;s=s??l?.matchUp;let m=l?.tieFormat,f=m?.winCriteria.valueGoal,h=m?.winCriteria.aggregateValue,g=ZI(m);if(l=QI({tieFormat:g}),l.error)return en({result:l,stack:d});let I=[];if(g.collectionDefinitions=g.collectionDefinitions.map((e=>{let{collectionGroupNumber:r,...i}=e;return r!==t?e:(I.push(e.collectionId),i)})),g.collectionGroups=g.collectionGroups.filter((({groupNumber:e})=>e!==t)),l=gA({updateInProgressMatchUps:e,originalValueGoal:f,wasAggregateValue:h,tournamentRecord:r,drawDefinition:i,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:c,event:u}),!l.error){let{appliedPolicies:e}=Yu({tournamentRecord:r});fA({appliedPolicies:e,drawDefinition:i,auditData:Zi({drawId:i?.drawId,collectionGroupNumber:t,action:d,structureId:a,matchUpId:o,eventId:c})})}return en({result:{...l,modifiedCollectionIds:I},stack:d})}function UA({tieFormat:e,orderMap:t}){let r=ZI(e);return r.collectionDefinitions.forEach((e=>{let r=t[e.collectionId];r&&(e.collectionOrder=r)})),r.collectionDefinitions?.sort(((e,t)=>Jr(e.collectionOrder)-Jr(t.collectionOrder))),r}function vA({tournamentRecord:e,drawDefinition:t,structureId:r,matchUpId:i,orderMap:n,eventId:a,matchUp:o,event:s}){if("object"!=typeof n||!Object.values(n).every((e=>Wr(e))))return en({result:{error:mr},context:{orderMap:n}});if(a&&s?.tieFormat)yA({tournamentRecord:e,event:s,orderMap:n});else if(i){let r=t&&bI({drawDefinition:t,matchUpId:i});if(r?.error)return r;if(!(o=r.matchUp))return{error:Fe};o?.tieFormat&&(o.tieFormat=UA({tieFormat:o.tieFormat,orderMap:n}),iu({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:t,matchUp:o}))}else if(r){let i=yc({drawDefinition:t,structureId:r});if(i.error)return i;let a=i.structure;if(a?.tieFormat)a.tieFormat=UA({tieFormat:a.tieFormat,orderMap:n}),wA({eventId:s?.eventId,tournamentRecord:e,drawDefinition:t,structure:a,orderMap:n}),au({drawDefinition:t,structureIds:[a.structureId]});else if(t.tieFormat)SA({structureIds:[r],tournamentRecord:e,drawDefinition:t,orderMap:n,event:s});else{if(!s?.tieFormat)return{error:vr};yA({structureIds:[r],tournamentRecord:e,orderMap:n,event:s})}}else{if(!t?.tieFormat)return{error:vr};SA({tournamentRecord:e,drawDefinition:t,orderMap:n,event:s})}return{...I}}function yA({tournamentRecord:e,structureIds:t,orderMap:r,event:i}){let n=UA({tieFormat:i.tieFormat,orderMap:r});t?.length||(i.tieFormat=n);for(let a of i.drawDefinitions??[])SA({tournamentRecord:e,drawDefinition:a,structureIds:t,orderMap:r,event:i})}function SA({tournamentRecord:e,drawDefinition:t,structureIds:r,orderMap:i,event:n}){let a=UA({tieFormat:t.tieFormat??n?.tieFormat,orderMap:i});r?.length||(t.tieFormat=a);let o=[];for(let s of t.structures??[])r?.length&&!r.includes(s.structureId)||((s.tieFormat||r?.includes(s.structureId))&&(s.tieFormat=UA({tieFormat:s.tieFormat??t.tieFormat??n?.tieFormat,orderMap:i})),wA({eventId:n?.eventId,tournamentRecord:e,drawDefinition:t,structure:s,orderMap:i}),o.push(s.structureId));au({drawDefinition:t,structureIds:o})}function wA({tournamentRecord:e,drawDefinition:t,structure:r,orderMap:i,eventId:n}){let a=Kp({matchUpFilters:{matchUpTypes:[Iu]},structure:r})?.matchUps;for(let o of a)o.tieFormat&&(o.tieFormat=UA({tieFormat:o.tieFormat,orderMap:i}),iu({tournamentId:e?.tournamentId,drawDefinition:t,eventId:n,matchUp:o}))}function PA({updateInProgressMatchUps:e=!0,tieFormatComparison:t,tournamentRecord:r,drawDefinition:i,tieFormatName:n,collectionId:a,structureId:o,matchUpId:s,eventId:c,matchUp:u,event:d}){let l="removeCollectionDefinition",p=u?void 0:dA({drawDefinition:i,structureId:o,matchUpId:s,eventId:c,event:d});if(p?.error)return en({result:p,stack:l});let m=p?.structure;u=u??p?.matchUp;let f=p?.tieFormat,h=ZI(f);if(p=QI({tieFormat:h}),p.error)return en({result:p,stack:l});let g=h?.collectionDefinitions?.find((e=>e.collectionId===a));if(!g)return en({result:{error:vr,collectionId:a}});h.collectionDefinitions=h.collectionDefinitions.filter((e=>e.collectionId!==a)),g.collectionGroupNumber&&(h.collectionDefinitions=h.collectionDefinitions.map((e=>{let{collectionGroupNumber:t,...r}=e;return r})),h.collectionGroups=h.collectionGroups.filter((({groupNumber:e})=>e!==g.collectionGroupNumber)));let{aggregateValue:U,valueGoal:v}=GD(h);h.winCriteria=Zi({aggregateValue:U,valueGoal:v});let y=f?.winCriteria.valueGoal,S=f?.winCriteria.aggregateValue;(y&&y!==v||U&&!S)&&(n?h.tieFormatName=n:delete h.tieFormatName);let w=[];s&&u?w=[u]:o&&m?w=Kp({matchUpFilters:{matchUpTypes:[Iu]},structure:m})?.matchUps??[]:i?w=lm({matchUpFilters:{matchUpTypes:[Iu]},drawDefinition:i})?.matchUps??[]:d&&(w=sm({matchUpFilters:{matchUpTypes:[Iu]},drawDefinition:i})?.matchUps??[]);let P=(w||[]).filter((r=>{let i=r.tieMatchUps?.filter((e=>e.collectionId===a))?.some(Um),n=!(!t||!r.tieFormat)&&jP({descendant:r.tieFormat,ancestor:h})?.different;return e&&!i||!r.winningSide&&r.matchUpStatus!==Qo&&(e||r.matchUpStatus!==ts&&!Um(r)&&!n)}));if(!P.length)return{error:ar};let{appliedPolicies:D}=Yu({tournamentRecord:r});if(s&&u&&e){let e=u.tieMatchUps?.filter((e=>e.collectionId===a));for(let t of e??[]){let e=vR({matchUpId:t.matchUpId,tieMatchUpId:u?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:r,appliedPolicies:D,drawDefinition:i,event:d});if(e.error||(e=bI({drawDefinition:i,matchUpId:s}),e.error))return e;u=e?.matchUp}}let T=[];for(let I of P){for(let e of I?.sides??[])e.lineUp=(e.lineUp??[]).map((e=>({participantId:e.participantId,collectionAssignments:(e?.collectionAssignments??[]).filter((e=>e.collectionId!==a))})));if(I.tieMatchUps=(I.tieMatchUps??[]).filter((e=>{let t=e.collectionId===a;return t&&T.push(e.matchUpId),!t})),I.tieFormat&&(I.tieFormat=ZI(h)),e){let e=rU({matchUpId:I.matchUpId,exitWhenNoValues:!0,tournamentRecord:r,appliedPolicies:D,drawDefinition:i,event:d});if(e.error)return e}iu({tournamentId:r?.tournamentId,eventId:d?.eventId,drawDefinition:i,context:l,matchUp:I})}T.length&&ru({tournamentId:r?.tournamentId,matchUpIds:T,eventId:d?.eventId,drawDefinition:i});let b=Zi(h);if(p=QI({tieFormat:b}),p.error)return en({result:p,stack:l});if(c&&d)d.tieFormat=b;else if(s&&u)u.tieFormat=b;else if(m)m.tieFormat=b;else if(i)i.tieFormat=b;else if(!u||!i)return{error:M};return au({drawDefinition:i,eventId:d?.eventId}),fA({appliedPolicies:D,drawDefinition:i,auditData:Zi({drawId:i?.drawId,action:l,collectionId:a,structureId:o,matchUpId:s,eventId:c})}),{tieFormat:b,deletedMatchUpIds:T,targetMatchUps:P,...I}}function DA({updateInProgressMatchUps:e=!0,tournamentRecord:t,groupDefinition:r,drawDefinition:i,collectionIds:n,tieFormatName:a,structureId:o,matchUpId:s,matchUp:c,eventId:u,event:d}){let l="addCollectionGroup";if(!Array.isArray(n))return en({result:{error:He},stack:l});let p=c?void 0:dA({drawDefinition:i,structureId:o,matchUpId:s,eventId:u,event:d});if(p?.error)return en({result:p,stack:l});let m=p?.structure;c=c||p?.matchUp;let f=p?.tieFormat,h=f?.winCriteria.valueGoal,g=ZI(f);if(p=QI({tieFormat:g}),p.error)return en({result:p,stack:l});for(let U of g.collectionDefinitions){let{collectionId:e,collectionGroupNumber:t}=U;if(t&&n.includes(e))return en({info:"collectionIds cannot be part of other collectionGroups",result:{error:mr},stack:l})}let I=(g.collectionGroups||[]).reduce(((e,t)=>t.groupNumber>e?t.groupNumber:e),0)+1;return r.groupNumber=I,g.collectionDefinitions=g.collectionDefinitions.map((e=>n.includes(e.collectionId)?{...e,collectionGroupNumber:I}:e)),g.collectionGroups=[...g.collecitonGroups||[],r],gA({updateInProgressMatchUps:e,originalValueGoal:h,tournamentRecord:t,drawDefinition:i,tieFormatName:a,structureId:o,structure:m,tieFormat:g,matchUpId:s,matchUp:c,eventId:u,event:d})}function TA({updateInProgressMatchUps:e=!0,collectionDefinition:t,referenceCategory:r,tournamentRecord:i,policyDefinitions:n,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:c,enforceGender:u,structureId:d,matchUpId:l,matchUp:p,eventId:m,uuids:f,event:h}){let g="addCollectionDefinition",U=Yu({tournamentRecord:i,drawDefinition:s,event:h}).appliedPolicies??{},v=n?.[Aa]??U?.[Aa];a=a??v?.participants?.enforceCategory;let y=!1!==(u??v?.participants?.enforceGender),S=!(!(r??h?.category)||!1===a),w=!(!(o??h?.gender)||!y),P=KI({referenceCategory:r??h?.category,collectionDefinition:t,referenceGender:o,checkCategory:S,checkGender:w,event:h});if(P.error)return en({result:P,stack:g});let D=p?.tieFormat?void 0:dA({drawDefinition:s,structureId:d,matchUpId:l,eventId:m,event:h});if(D?.error)return en({result:{error:D.error},stack:g});let T=D?.structure;p=p??D?.matchUp;let b=p?.tieFormat??D?.tieFormat,R=ZI(b);if(D=QI({tieFormat:R}),D?.error)return en({result:{error:D.error},stack:g});if(t.collectionId){if(R.collectionDefinitions.map((({collectionId:e})=>e)).includes(t.collectionId))return en({context:{collectionId:t.collectionId},result:{error:fr}})}else t.collectionId=Jl();R.collectionDefinitions.push(t),R.collectionDefinitions.sort(((e,t)=>(e.collectionOrder||0)-(t.collectionOrder||0))).forEach(((e,t)=>e.collectionOrder=t+1));let{aggregateValue:N,valueGoal:A}=GD(R);R.winCriteria=Zi({aggregateValue:N,valueGoal:A});let E=b?.winCriteria.valueGoal,C=b?.winCriteria.aggregateValue;(E&&E!==A||N&&!C)&&(c?R.tieFormatName=c:delete R.tieFormatName);let O=[],F=[],k=[],x=Zi(R);if(D=QI({tieFormat:x}),D?.error)return en({result:{error:D.error},stack:g});if(m&&h){h.tieFormat=x;for(let r of h.drawDefinitions??[])if(!r.tieFormat)for(let i of r.structures??[]){if(i.tieFormat)continue;let r=bA({updateInProgressMatchUps:e,collectionDefinition:t,structure:i,uuids:f});F.push(...r.newMatchUps),k.push(...r.targetMatchUps),O.push(i.structureId)}RA({modifiedMatchUps:k,eventId:h?.eventId,modifiedStructureIds:O,tournamentRecord:i,drawDefinition:s,addedMatchUps:F,stack:g})}else if(d&&T){T.tieFormat=x;let r=bA({updateInProgressMatchUps:e,collectionDefinition:t,structure:T,uuids:f});F.push(...r.newMatchUps),k=r.targetMatchUps,RA({modifiedMatchUps:k,eventId:h?.eventId,modifiedStructureIds:O,tournamentRecord:i,drawDefinition:s,addedMatchUps:F,stack:g})}else if(l&&p){if(!lA({matchUp:p,updateInProgressMatchUps:e}))return en({result:{error:at},stack:g});p.tieFormat=x;let r=$g({collectionDefinition:t,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...r),F.push(...r),RA({modifiedMatchUps:[p],eventId:h?.eventId,modifiedStructureIds:O,tournamentRecord:i,drawDefinition:s,addedMatchUps:F,stack:g})}else{if(!s)return{error:M};s.tieFormat=x;for(let r of s.structures??[]){let i=bA({updateInProgressMatchUps:e,collectionDefinition:t,structure:r,uuids:f});O.push(r.structureId),F.push(...i.newMatchUps),k.push(...i.targetMatchUps)}RA({modifiedMatchUps:k,eventId:h?.eventId,tournamentRecord:i,drawDefinition:s,addedMatchUps:F,stack:g})}return fA({appliedPolicies:U,drawDefinition:s,auditData:Zi({drawId:s?.drawId,collectionDefinition:t,action:g,structureId:d,matchUpId:l,eventId:m})}),{tieFormat:x,targetMatchUps:k,addedMatchUps:F,...I}}function bA({updateInProgressMatchUps:e,collectionDefinition:t,structure:r,uuids:i}){let n=[],a=(Kp({matchUpFilters:{matchUpTypes:[Iu]},structure:r})?.matchUps).filter((t=>lA({matchUp:t,updateInProgressMatchUps:e})&&!t.tieFormat));for(let o of a){let e=$g({collectionDefinition:t,matchUp:o,uuids:i});Array.isArray(o.tieMatchUps)||(o.tieMatchUps=[]),o.tieMatchUps.push(...e),n.push(...e)}return{newMatchUps:n,targetMatchUps:a}}function RA({modifiedStructureIds:e,tournamentRecord:t,modifiedMatchUps:r,drawDefinition:i,addedMatchUps:n,eventId:a,stack:o}){tu({tournamentId:t?.tournamentId,matchUps:n,drawDefinition:i,eventId:a}),r?.forEach((e=>{iu({tournamentId:t?.tournamentId,drawDefinition:i,context:o,matchUp:e,eventId:a})})),au({structureIds:e,drawDefinition:i,eventId:a})}function MA({updateInProgressMatchUps:e=!1,tieFormatComparison:t,modifiedTieFormat:r,tournamentRecord:i,considerations:n,drawDefinition:a,structureId:o,matchUpId:s,eventId:c,uuids:u,event:d}){let l="modifyTieFormat";if(!QI({tieFormat:r}).valid)return en({result:{error:Te},info:"falied validation",stack:l});let p=dA({drawDefinition:a,structureId:o,matchUpId:s,eventId:c,event:d});if(p.error)return en({result:p,stack:l});let{matchUp:m,tieFormat:f}=p,h=ZI(f),g=jP({descendant:r,ancestor:h,considerations:n});if(g.invalid)return en({context:{invalid:g.invalid},result:{error:Te},stack:l});if(!g?.different)return en({result:{...I},info:"Nothing to do",stack:l});let U,v=h.collectionDefinitions.map((({collectionId:e})=>e)),y=r.collectionDefinitions.map((({collectionId:e})=>e)),S=v.filter((e=>!y.includes(e))),w=r.collectionDefinitions.filter((({collectionId:e})=>!v.includes(e))),P=w.map(fm("collectionId")),D=[],T=r.tieFormatName;for(let I of r.collectionDefinitions){if(P.includes(I.collectionId))continue;let t=hA({updateInProgressMatchUps:e,...I,tournamentRecord:i,tieFormatName:T,drawDefinition:a,structureId:o,matchUpId:s,eventId:c,event:d});if(t.modifications&&D.push(...t.modifications),t.error)return en({result:t,stack:l});t.tieFormat&&(U=t.tieFormat)}for(let I of w){let t=TA({updateInProgressMatchUps:e,collectionDefinition:I,tournamentRecord:i,drawDefinition:a,tieFormatName:T,structureId:o,matchUpId:s,matchUp:m,eventId:c,uuids:u,event:d});if(t.error)return en({result:t,stack:l});t.tieFormat&&(U=t.tieFormat)}for(let I of S){let r=PA({updateInProgressMatchUps:e,tieFormatComparison:t,tournamentRecord:i,drawDefinition:a,tieFormatName:T,collectionId:I,structureId:o,matchUpId:s,eventId:c,matchUp:m,event:d});if(r.error)return en({result:r,stack:l});r.tieFormat&&(U=r.tieFormat)}return f?.tieFormatName!==T?(U.tieFormatName=T,D.push({tieFormatName:T})):(D.length||P.length||S.length)&&(delete U.tieFormatName,D.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort(((e,t)=>Jr(e.collectionOrder)-Jr(t.collectionOrder))).map(((e,t)=>({...e,collectionOrder:t+1}))),{processedTieFormat:ZI(U),modifications:D,...I}}function NA({tournamentRecord:e}){if(!e)return{error:D};let t=0;for(let r of e.events??[]){let i=r.tieFormats??[],n=e=>{if(!e.tieFormat)return;let r;for(let t of i)jP({descendant:e.tieFormat,ancestor:t}).different||(r=t.tieFormatId);if(r)e.tieFormatId=r,delete e.tieFormat;else{let r=Da(e.tieFormat,void 0,!0);r.tieFormatId||(r.tieFormatId=Jl()),e.tieFormatId=r.tieFormatId,delete e.tieFormat,i.push(r),t+=1}},a=r.eventType;n({tieFormat:r.tieFormat,eventType:a});for(let e of r.drawDefinitions??[]){n({tieFormat:e.tieFormat,eventType:a});for(let t of e.structures??[])n({tieFormat:t.tieFormat,eventType:a})}let o=(t,i)=>{let n=c.matchUps?.find((e=>e.matchUpId===t));n&&(n.tieFormatId=i,delete n.tieFormat,iu({tournamentId:e?.tournamentId,eventId:r.eventId,matchUp:n}))},s=e=>{let r=Da(e.tieFormat,void 0,!0);r.tieFormatId||(r.tieFormatId=Jl()),i.push(r),t+=1,o(e.matchUpId,r.tieFormatId)},c=sm({matchUpFilters:{matchUpTypes:[gu]},event:r}),u=c.matchUps??[];for(let e of u){let t;for(let r of i)e.tieFormat&&jP({descendant:e.tieFormat,ancestor:r}).different||(t=r.tieFormatId);t?o(e.matchUpId,t):s(e)}i.length&&(r.tieFormats=i)}return{...I,addedCount:t}}n(uA,{addCollectionDefinition:()=>TA,addCollectionGroup:()=>DA,aggregateTieFormats:()=>NA,modifyCollectionDefinition:()=>hA,modifyTieFormat:()=>MA,orderCollectionDefinitions:()=>vA,removeCollectionDefinition:()=>PA,removeCollectionGroup:()=>IA});var AA={};n(AA,{addDrawDefinitionExtension:()=>Ka,addEventExtension:()=>Qa,addEventTimeItem:()=>cg,addExtension:()=>za,addNotes:()=>RI,addOnlineResource:()=>FA,addParticipantExtension:()=>Ja,addParticipantTimeItem:()=>og,addTimeItem:()=>ag,addTournamentExtension:()=>Ya,addTournamentTimeItem:()=>sg,analyzeDraws:()=>fU,analyzeTournament:()=>LP,getAllowedDrawTypes:()=>NP,getAllowedMatchUpFormats:()=>MP,getAppliedPolicies:()=>Yu,getCompetitionDateRange:()=>kP,getCompetitionPenalties:()=>EP,getPolicyDefinitions:()=>Ku,getTournamentInfo:()=>FP,getTournamentPenalties:()=>AP,getTournamentPersons:()=>xP,getTournamentStructures:()=>Mh,getTournamentTimeItem:()=>Vu,mutate:()=>EA,query:()=>RP,removeDrawDefinitionExtension:()=>Za,removeEventExtension:()=>eo,removeExtension:()=>Wa,removeNotes:()=>MI,removeParticipantExtension:()=>to,removeTournamentExtension:()=>Xa,setTournamentCategories:()=>_A,setTournamentDates:()=>LA,setTournamentEndDate:()=>BA,setTournamentName:()=>kA,setTournamentNotes:()=>xA,setTournamentStartDate:()=>VA,setTournamentStatus:()=>OA});var EA={};n(EA,{addDrawDefinitionExtension:()=>Ka,addEventExtension:()=>Qa,addEventTimeItem:()=>cg,addExtension:()=>za,addNotes:()=>RI,addOnlineResource:()=>FA,addParticipantExtension:()=>Ja,addParticipantTimeItem:()=>og,addTimeItem:()=>ag,addTournamentExtension:()=>Ya,addTournamentTimeItem:()=>sg,removeDrawDefinitionExtension:()=>Za,removeEventExtension:()=>eo,removeExtension:()=>Wa,removeNotes:()=>MI,removeParticipantExtension:()=>to,removeTournamentExtension:()=>Xa,setTournamentCategories:()=>_A,setTournamentDates:()=>LA,setTournamentEndDate:()=>BA,setTournamentName:()=>kA,setTournamentNotes:()=>xA,setTournamentStartDate:()=>VA,setTournamentStatus:()=>OA});var CA={ABANDONED:"ABANDONED",ACTIVE:"ACTIVE",CANCELLED:"CANCELLED",COMPLETED:"COMPLETED",IN_PROGRESS:"IN_PROGRESS"};function OA({tournamentRecord:e,status:t}){return e?t&&!Object.keys(CA).includes(t)?{error:mr,info:"Unknown status"}:(e.tournamentStatus=t,{...I}):{error:D}}function FA({tournamentRecord:e,onlineResource:t,organisationId:r,participantId:i,personId:n,courtId:a,venueId:o}){if(!e)return{error:D};if(!d(t))return{error:He};if(3!==si(Object.keys(t),["resourceSubType","resourceType","identifier"]).length)return en({result:{error:dr},context:{onlineResource:t}});if(r){if(e.parentOrganisation?.parentOrganisationId!==r)return en({result:{error:vr}});e.parentOrganisation.onlineResources||(e.parentOrganisation.onlineResources=[]),e.parentOrganisation.onlineResources.push(t)}else if(i||n){let r=(e.participants??[]).find((e=>n&&e.person?.personId===n||e.participantId===i));if(!r)return en(n?{result:{error:vr}}:{result:{error:Ut}});if(n){if(r.person?.personId!==n)return en({result:{error:ut}});r.person.onlineResources||(r.person.onlineResources=[]),r.person.onlineResources.push(t)}else r.onlineResources||(r.onlineResources=[]),r.onlineResources.push(t)}else if(a){let r=(e.venues??[]).filter((e=>!o||e.venueId===o)).flatMap((e=>(e.courts??[]).filter((e=>e.courtId===a))))?.[0];if(!r)return en({result:{error:jt}});r.onlineResources||(r.onlineResources=[]),r.onlineResources.push(t)}else if(o){let r=(e.venues??[]).find((e=>e.venueId===o));if(!r)return en({result:{error:$t}});r.onlineResources||(r.onlineResources=[]),r.onlineResources.push(t)}else e.onlineResources||(e.onlineResources=[]),e.onlineResources.push(t);return{...I}}function kA({tournamentRecord:e,promotionalName:t,tournamentName:r,formalName:i}){return e?(r&&(e.tournamentName=r),t&&(e.promotionalName=t),i&&(e.formalName=i),e.promotionalName===e.tournamentName&&delete e.promotionalName,e.formalName===e.tournamentName&&delete e.formalName,{...I}):{error:D}}function xA({tournamentRecord:e,notes:t}){return e?RI({element:e,notes:t}):{error:D}}function _A({tournamentRecord:e,categories:t}){return e?(t=(t||[]).filter((e=>e.categoryName&&e.type)),e.tournamentCategories=t,{...I}):{error:D}}function LA(e){let t,{tournamentRecord:r,startDate:i,endDate:n}=e,a=xn(e,[{tournamentRecord:!0},{[Mn]:e=>Yn.test(e),[Cn]:{startDate:!1,endDate:!1},[An]:Xe}]);if(a.error)return a;if(n&&i&&new Date(n)<new Date(i))return{error:mr};(i&&r.startDate&&new Date(i)>new Date(r.startDate)||n&&r.endDate&&new Date(n)<new Date(r.endDate))&&(t=!0);let o=na(r.startDate,r.endDate);i&&(r.startDate=i),n&&(r.endDate=n);let s=na(r.startDate,r.endDate),c=o.filter((e=>!s.includes(e))),u=s.filter((e=>!o.includes(e)));for(let l of r.events??[])i&&l.startDate&&new Date(l.startDate)<new Date(i)&&(l.startDate=i),n&&l.startDate&&new Date(l.startDate)>new Date(n)&&(l.startDate=i??n),n&&l.endDate&&new Date(l.endDate)>new Date(n)&&(l.endDate=n),i&&l.endDate&&new Date(l.endDate)<new Date(i)&&(l.endDate=n??i);i&&r.endDate&&new Date(i)>new Date(r.endDate)&&(r.endDate=i),n&&r.startDate&&new Date(n)<new Date(r.startDate)&&(r.startDate=n);let d=t&&function({tournamentRecord:e}){let t=cm({tournamentRecord:e}).matchUps??[],r=e.startDate&&new Date(e.startDate),i=e.endDate&&new Date(e.endDate),n=[],a=[];for(let o of t){let{schedule:e,matchUpId:t}=o;if(e&&e.scheduledDate){let o=new Date(e.scheduledDate);(r&&o<r||i&&o>i)&&(a.push(t),n.includes(e.scheduledDate)||n.push(e.scheduledDate))}}return n.length&&!sM({scheduledDates:n,tournamentRecord:e}).clearedScheduleCount?{error:k}:{unscheduledMatchUpIds:a}}({tournamentRecord:r})?.unscheduledMatchUpIds;return function({tournamentRecord:e}){if(!e)return{error:D};let{startDate:t,endDate:r}=e,i=na(t,r),n=[];for(let a of e.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:e,endTime:t}=(a.dateAvailability??[]).reduce(((e,t)=>{let r=ca(e.startTime),i=ca(e.endTime);return t.startTime&&ca(t.startTime)<r&&(e.startTime=t.startTime),t.endTime&&ca(t.endTime)>i&&(e.endTime=t.endTime),e}),{startTime:"08:00",endTime:"18:00"}),r=i.map((r=>a.dateAvailability?.find((e=>e.date===r))??{date:r,startTime:e,endTime:t})),n=a.dateAvailability?.find((e=>!e.date));n&&r.unshift(n),a.dateAvailability=r}}({tournamentRecord:r}),ki({topic:qc,payload:{startDate:i,endDate:n}}),{...I,unscheduledMatchUpIds:d,datesAdded:u,datesRemoved:c}}function VA({tournamentRecord:e,startDate:t}){return LA({tournamentRecord:e,startDate:t})}function BA({tournamentRecord:e,endDate:t}){return LA({tournamentRecord:e,endDate:t})}var jA={};n(jA,{addCourt:()=>KM,addCourts:()=>QM,addVenue:()=>Xl,deleteCourt:()=>iE,deleteVenue:()=>YA,deleteVenues:()=>KA,disableCourts:()=>QA,disableVenues:()=>XA,enableCourts:()=>eE,enableVenues:()=>rE,generate:()=>GA,generateCourts:()=>pb,getCompetitionVenues:()=>JP,getCourts:()=>eT,getVenuesAndCourts:()=>QP,modifyCourt:()=>aE,modifyCourtAvailability:()=>WA,modifyVenue:()=>cE,mutate:()=>qA,publicFindVenue:()=>tp,query:()=>ZD});var GA={};n(GA,{generateCourts:()=>pb});var qA={};function $A(e){if(!e?.tournamentRecord&&!Array.isArray(e?.venueMatchUps))return{error:D};if(!e?.courtId)return{error:We};let{scheduleVisibilityFilters:t,tournamentRecord:r,matchUpFilters:i,venueMatchUps:n,courtId:a}=e,{schedulingProfile:o}=sD({tournamentRecord:r});if(Array.isArray(n))return{matchUps:c({matchUps:n,courtId:a})};let{matchUps:s}=cm({scheduleVisibilityFilters:t,tournamentRecord:r,matchUpFilters:i});return{matchUps:c({matchUps:s,courtId:a})};function c({matchUps:e,courtId:t}){return CD({matchUps:e.filter((e=>{let r=e.schedule?.allocatedCourts?.map((({courtId:e})=>e));return e.schedule?.courtId===t||r?.includes(t)})),schedulingProfile:o})}}function WA({tournamentRecord:e,dateAvailability:t,disableNotice:r,venueMatchUps:i,courtId:n,force:a}){if(!e)return{error:D};if(!n)return{error:We};let o=YM({dateAvailability:t});if(o.error)return o;let{updatedDateAvailability:s,totalMergeCount:c}=function(e){let t=0,r=e.reduce(((e,t)=>{let{date:r,startTime:i,endTime:n,bookings:a}=t;return e[r]||(e[r]=[]),e[r].push({startTime:i,endTime:n,bookings:a}),e}),{}),i=[];return Object.keys(r).forEach((e=>{r[e].sort(zM);let{mergedAvailability:n,mergeCount:a}=function(e){let t,r,i,n=e.length,a=0,o=[];for(;e.length&&n;){let s=e.shift(),{startTime:c,endTime:u,bookings:d}=s;if(n-=1,t)if(Ua(Ia(r),Ia(c),!1)>0){let e={startTime:t,endTime:r};i?.length&&(e.bookings=i),o.push(e),t=c,i=d,r=u}else d&&(i?i.push(d):i=d),r=u,a+=1;else t=c,i=d,r=u}let s={startTime:t,endTime:r};return i?.length&&(s.bookings=i),o.push(s),{mergedAvailability:o,mergeCount:a}}(r[e]);i.push(...n.map((t=>({date:e,...t})))),t+=a})),{updatedDateAvailability:i,totalMergeCount:t}}(t);t=s;let u=rp({tournamentRecord:e,courtId:n});if(u.error)return u;let{court:d,venue:l}=u,{matchUps:p}=$A({tournamentRecord:e,venueMatchUps:i,courtId:n});if(p?.length){let t=Yu({tournamentRecord:e})?.appliedPolicies,r=a??t?.[ka]?.allowDeletionWithScoresPresent?.courts,i=[];i.length&&(r||console.log("throw error: scheduled court matchUps",i.length))}return d&&(d.dateAvailability=t,!r&&l&&ki({payload:{venue:l,tournamentId:e.tournamentId},topic:$c,key:l.venueId})),{...I,totalMergeCount:c}}function HA({matchUpsCount:e=0}){return{error:Mr,info:`Schedule would be deleted from ${e} ${1===e?"matchUp":"matchUps"}; use { force: true }`}}function zA({tournamentRecord:e,drawDefinition:t,matchUpId:r,drawId:i}){let n;if(!r)return{error:Ae};if(!t&&!i)return{error:H};if(!t){if(!e)return{error:D};({drawDefinition:t}=sp({tournamentRecord:e,drawId:i}))}if(t)({matchUp:n}=bI({drawDefinition:t,matchUpId:r}));else{if(!e)return{error:D};let t=cm({tournamentRecord:e,inContext:!1}).matchUps??[];({matchUp:n}=TI({matchUps:t,matchUpId:r}))}return n?(n.timeItems&&n.timeItems.find((e=>[Gd,jd].includes(e.itemType)))&&(n.timeItems=n.timeItems.filter((({itemType:e})=>![Gd,jd].includes(e))),iu({tournamentId:e?.tournamentId,context:"removeCourtAssignment",drawDefinition:t,matchUp:n})),{...I}):{error:Ce}}function YA(e){if("string"!=typeof e?.venueId)return{error:Wt};let{tournamentRecord:t,venueId:r,force:i}=e,n=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!Object.keys(n).length)return{error:D};let a=um({tournamentRecords:n,contextFilters:{venueIds:[r]}}).matchUps??[],o=Yu({tournamentRecord:t})?.appliedPolicies,s=i??o?.[ka]?.allowDeletionWithScoresPresent?.venues;if(a.length&&!s)return HA({matchUpsCount:a.length});for(let c of Object.values(n)){for(let t of a){let e=zA({matchUpId:t.matchUpId,drawId:t.drawId,tournamentRecord:c});if(e.error)return e}let e;c.venues=(c.venues??[]).filter((t=>t?.venueId!==r||(e=!0,!1))),e&&ki({payload:{venueId:r,tournamentId:c.tournamentId},topic:Oc,key:r})}return uD({tournamentRecords:n}),{...I}}function KA({tournamentRecord:e,venueIds:t,force:r}){if(!e)return{error:D};if(!Array.isArray(t))return{error:mr};for(let i of e.venues||[]){let{venueId:n}=i;if(t.includes(n)){let{venueId:t}=i,n=YA({tournamentRecord:e,venueId:t,force:r});if(n.error)return n}}return{...I}}function QA(e){let{courtIds:t,dates:r}=e,i=yu(e),n=xn(e,[{[tn]:!0,[gn]:!0}]);if(n.error)return n;for(let a of Object.values(i))JA({tournamentRecord:a,courtIds:t,dates:r});return{...I}}function JA({tournamentRecord:e,courtIds:t,dates:r}){let i=!Array.isArray(r)||!r.length||{dates:r},n=e=>za({extension:{value:i,name:co},creationTime:!1,element:e});for(let a of e.venues||[])for(let e of a.courts||[])if(t?.includes(e.courtId)){let t=n(e);if(t.error)return t}return{...I}}function XA(e){let{tournamentRecords:t,tournamentId:r,venueIds:i}=e,n=xn(e,[{[tn]:!0,[In]:!0}]);if(n.error)return n;let a=Object.keys(t).filter((e=>!r||e===r));for(let o of a){ZA({tournamentRecord:t[o],venueIds:i})}return{...I}}function ZA({tournamentRecord:e,venueIds:t}){for(let r of e.venues||[])if(t?.includes(r.venueId)){let e=za({creationTime:!1,element:r,extension:{name:co,value:!0}});if(e.error)return e}return{...I}}function eE(e){let t=yu(e),r=[{[tn]:!0}];!e.enableAll&&r.push({[gn]:!0});let i=xn(e,r);if(i.error)return i;let{enableAll:n,courtIds:a,dates:o}=e;for(let s of Object.values(t))tE({tournamentRecord:s,courtIds:a,enableAll:n,dates:o});return{...I}}function tE({tournamentRecord:e,courtIds:t,enableAll:r,dates:i}){for(let n of e.venues||[])for(let e of n.courts||[])if(r||t?.includes(e.courtId))if(Array.isArray(i)){let{extension:t}=no({element:e,name:co});if(t){let r=t.value;Array.isArray(r.dates)&&(r.dates=r.dates.filter((e=>!i.includes(e)))),za({extension:{name:co,value:r},creationTime:!1,element:e})}}else Wa({element:e,name:co});return{...I}}function rE(e){let t=yu(e),r=[{[tn]:!0}];!e.enableAll&&r.push({[In]:!0});let i=xn(e,r);if(i.error)return i;let{venueIds:n,enableAll:a}=e;for(let o of Object.values(t))for(let e of o.venues||[])(a||n?.includes(e.venueId))&&Wa({element:e,name:co});return{...I}}function iE(e){let t,r,{courtId:i,disableNotice:n,force:a}=e,o=yu(e),s=xn(e,[{[tn]:!0,[vn]:!0}]);if(s.error)return s;for(let c of Object.values(o)){if(r=nE({tournamentRecord:c,disableNotice:n,courtId:i,force:a}),r.error&&r.error!==jt)return r;r.success&&(t=!0)}return t?{...I}:r}function nE({tournamentRecord:e,disableNotice:t,courtId:r,force:i}){let n=rp({tournamentRecord:e,courtId:r});if(n.error)return n;let a=n.venue,{matchUps:o}=$A({tournamentRecord:e,courtId:r}),s=Yu({tournamentRecord:e})?.appliedPolicies,c=i??s?.[ka]?.allowDeletionWithScoresPresent?.courts;if(o?.length&&!c)return HA({matchUpsCount:o.length});for(let u of o??[]){let t=zA({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:e});if(t.error)return t}return a&&(a.courts=(a.courts??[]).filter((e=>e.courtId!==r)),t||ki({payload:{venue:a,tournamentId:e.tournamentId},topic:$c,key:a.venueId})),{...I}}function aE(e){let t,{disableNotice:r,modifications:i,courtId:n,force:a,venueMatchUps:o}=e,s=yu(e);if(!Object.keys(s).length)return{error:P};for(let c of Object.values(s)){let e=oE({tournamentRecord:c,disableNotice:r,venueMatchUps:o,modifications:i,courtId:n,force:a});if(e?.error)return e;t=!0}return t?{...I}:undefined}function oE({tournamentRecord:e,disableNotice:t,venueMatchUps:r,modifications:i,courtId:n,force:a}){if(!e)return{error:D};if(!n)return{error:We};if(!i||"object"!=typeof i)return{error:dr};let o=rp({tournamentRecord:e,courtId:n});if(o.error)return o;let{venue:s,court:c}=o,u=Object.keys($M()).filter((e=>"courtId"!==e));if(!Object.keys(i).filter((e=>u.includes(e))).length)return{error:Ir};let d=u.filter((e=>!["dateAvailability"].includes(e))),l=Object.keys(i).filter((e=>d.includes(e)));if(c&&l.forEach((e=>Object.assign(c,{[e]:i[e]}))),i.dateAvailability){let o=WA({dateAvailability:i.dateAvailability,tournamentRecord:e,venueMatchUps:r,disableNotice:t,courtId:n,force:a});if(o.error)return o}return t||ki({payload:{venue:s,tournamentId:e.tournamentId},topic:$c,key:s?.venueId}),{...I,court:Da(c)}}n(qA,{addCourt:()=>KM,addCourts:()=>QM,addVenue:()=>Xl,deleteCourt:()=>iE,deleteVenue:()=>YA,deleteVenues:()=>KA,disableCourts:()=>QA,disableVenues:()=>XA,enableCourts:()=>eE,enableVenues:()=>rE,modifyCourt:()=>aE,modifyCourtAvailability:()=>WA,modifyVenue:()=>cE});var sE=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]});function cE(e){let t,r,{modifications:i,venueId:n,force:a}=e,o=yu(e);if(!Object.keys(o).length)return{error:P};if("string"!=typeof n)return{error:Wt};for(let s of Object.values(o)){let e=uE({tournamentRecord:s,modifications:i,venueId:n,force:a});if(e.success&&(r=!0),e.error&&(t=e.error),e.error&&e.error!==$t)return e}return uD({tournamentRecords:o}),r?{...I}:{error:t}}function uE({tournamentRecord:e,modifications:t,venueId:r,force:i}){if(!e)return{error:D};if(!t||"object"!=typeof t)return{error:dr};if(!r)return{error:Wt};let n=Yu({tournamentRecord:e})?.appliedPolicies,a=i??n?.[ka]?.allowDeletionWithScoresPresent?.venues,{matchUps:o}=function({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:r,venueId:i}){if(!t)return{error:D};if(!i)return{error:Wt};let{schedulingProfile:n}=sD({tournamentRecord:t}),{matchUps:a}=cm({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:r});return{matchUps:function({matchUps:e,venueId:t}){return CD({matchUps:e.filter((e=>{let r=e.schedule?.allocatedCourts?.map((({venueId:e})=>e));return e.schedule?.venueId===t||r?.includes(t)})),schedulingProfile:n})}({matchUps:a,venueId:i})}}({tournamentRecord:e,venueId:r}),s=ep({tournamentRecord:e,venueId:r});if(s.error)return s;let c=s.venue,u=Object.keys(sE()).filter((e=>"venueId"!==e));if(!Object.keys(t).filter((e=>u.includes(e))).length)return{error:Ir};let d=u.filter((e=>!["courts","onlineResources"].includes(e))),l=Object.keys(t).filter((e=>d.includes(e)));c&&l.forEach((e=>Object.assign(c,{[e]:t[e]})));let p=c?.courts?.map((e=>e.courtId))??[],m=t.courts?.map((e=>e.courtId))||[],f=m.length?p.filter((e=>!m.includes(e))):t?.courts&&p,h=[];if(f?.length){let t=c?.courts?.filter((e=>f.includes(e.courtId)))?.map((t=>{let r=$A({courtId:t.courtId,tournamentRecord:e,venueMatchUps:o});for(let e of r.matchUps??[])h.push({matchUpId:e.matchUpId,drawId:e.drawId});return r.matchUps?.length??0})).reduce(((e,t)=>e+t));if(!c||t&&!a)return HA({matchUpsCount:t});c.courts=c.courts?.filter((e=>m.includes(e.courtId))),iM({schedule:{courtId:"",scheduledDate:""},matchUpDetails:h,removePriorValues:!0,tournamentRecord:e})}if(t.courts)for(let g of t.courts){let{courtId:t}=g||{},n=aE({modifications:g,disableNotice:!0,tournamentRecord:e,venueMatchUps:o,courtId:t,force:i});if(n.error===jt&&(n=KM({disableNotice:!0,tournamentRecord:e,venueId:r,court:g})),n.error)return n}return uD({tournamentRecord:e}),c&&ki({payload:{venue:c,tournamentId:e.tournamentId},topic:$c,key:c?.venueId}),{...I,venue:Da(c)}}var dE={};function lE({scheduledMatchUps:e,showGlobalLog:t}){Tm.length=0;let r=e?.reduce(((e,{structureId:t})=>e.includes(t)?e:e.concat(t)),[]),i=Array.isArray(r)&&{...r.map((t=>{let{structureName:r,matchUpType:i}=e.find((e=>e.structureId===t));return{[t]:`${r} ${i}`}}))};r?.forEach((t=>{bm({color:"blue",method:"draw",structure:i[t],keyColors:{structure:"magenta"}},!0);let r=e.filter((e=>e.structureId===t)),n=Up({matchUps:r})?.roundMatchUps||[];Object.keys(n).forEach((e=>{bm({roundNumber:e,keyColors:{roundNumber:"brightcyan"}},!0),n[e].forEach((({matchUpId:e,schedule:t})=>{bm({matchUpId:e,time:da(t.scheduledTime),date:t.scheduledDate,venue:t.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)}))}))})),t&&Rm()}function pE({tournamentRecord:e}){if(!e)return{error:D};if("object"!=typeof e||!e.tournamentId)return{error:mr};let{matchUps:t}=cm({tournamentRecord:e,inContext:!1});if(t?.length){let r=function({tournamentRecord:e}){let t={};for(let r of e.events||[]){r.matchUpFormat&&(t[r.eventId]=r.matchUpFormat);for(let e of r.drawDefinitions||[]){e.matchUpFormat&&(t[e.drawId]=e.matchUpFormat);for(let r of e.structures||[]){r.matchUpFormat&&(t[r.structureId]=r.matchUpFormat);for(let e of r.structures||[])e.matchUpFormat&&(t[e.structureId]=e.matchUpFormat)}}}return t}({tournamentRecord:e});!function(e,t={}){for(let r of e){let{structureId:e,drawId:i,eventId:n}=r,a=t[e]||t[i]||t[n],o=r.matchUpFormat===a?void 0:r.matchUpFormat;for(let t of Object.keys(r))mE.includes(t)||delete r[t];r.sides&&r.drawPositions&&!r.tieMatchUps&&delete r.sides,o&&(r.matchUpFormat=o)}}(t,r)}return{...I}}n(dE,{JSON2CSV:()=>fE,UUID:()=>Jl,UUIDS:()=>Ql,allNumeric:()=>fi,attributeFilter:()=>Wn,chunkArray:()=>pi,chunkByNth:()=>gi,chunkSizeProfile:()=>mi,constantToString:()=>Of,countValues:()=>Zr,createMap:()=>p,dateTime:()=>Pa,definedAttributes:()=>Zi,dehydrateMatchUps:()=>pE,extractAttributes:()=>mm,flattenJSON:()=>hE,generateDateRange:()=>na,generateHashCode:()=>g,generateRange:()=>ai,generateTimeCode:()=>oN,groupValues:()=>ei,hasAttributeValues:()=>m,instanceCount:()=>Xr,intersection:()=>si,isConvertableInteger:()=>Wr,isNumeric:()=>jr,isOdd:()=>Gr,isPowerOf2:()=>_r,makeDeepCopy:()=>Da,matchUpSort:()=>dm,nearestPowerOf2:()=>Br,nextPowerOf2:()=>qr,noNulls:()=>Kr,noNumeric:()=>hi,numericSort:()=>kr,occurrences:()=>di,overlap:()=>ui,randomMember:()=>ni,randomPop:()=>ii,shuffleArray:()=>Qr,structureSort:()=>Uc,subSort:()=>li,undefinedToNull:()=>f,unique:()=>Yr,visualizeScheduledMatchUps:()=>lE});var mE=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function fE(e,t){if(t&&"object"!=typeof t)return{error:mr};let{columnTransform:r={}}=t||{},{includeTransformAccessors:i,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:u=[],functionMap:d={},columnMap:l={},valuesMap:p={},context:m={},delimiter:f='"',columnJoiner:h=",",rowJoiner:g="\r\n",keyJoiner:I="."}=t||{};if(!Array.isArray(e)||!Array.isArray(u)||"object"!=typeof m||"object"!=typeof l||"object"!=typeof r||"object"!=typeof d||"object"!=typeof p||"string"!=typeof h||"string"!=typeof g||"string"!=typeof I||"string"!=typeof f)return{error:mr};r=Object.assign({},...Object.keys(r).reverse().map((e=>({[e]:Array.isArray(r[e])?r[e]:["string"==typeof r[e]&&r[e]].filter(Boolean)}))));let U=e.filter(Boolean).map((e=>hE(e,I))),v=Object.values(r).flat();i&&u.push(...v);let y=U.reduce(((e,t)=>Object.keys(t).every((t=>!e.includes(t)&&e.push(t)||!0))&&e),[]).filter((e=>!u?.length||u.includes(e))),S=Object.assign({},...Object.keys(r).reverse().map((e=>r[e].map((t=>({[t]:e}))).flat())).flat()),w=y.reduce(((e,t)=>{let r=S[t];return r?e.includes(r)||e.push(r):e.push(t),e}),[]).sort(((e,r)=>t?.sortOrder?t.sortOrder.includes(e)&&t.sortOrder.includes(r)&&t.sortOrder.indexOf(e)-t.sortOrder.indexOf(r)||!t.sortOrder.includes(r)&&-1:0));Object.keys(l).forEach((e=>!w.includes(e)&&w.unshift(e))),Object.keys(r).forEach((e=>!w.includes(e)&&w.unshift(e))),"object"==typeof m&&Object.keys(m).forEach((e=>!w.includes(e)&&w.unshift(e)));let P=w.map((e=>l[e]||e));if(s)return[P];let D=e=>`${f}${e}${f}`,T=[],b=U.map((e=>Object.values(w.reduce(((t,i,n)=>{let a=r[i],o=(a?.length?e[a.find((t=>e[t]))]:e[i])||m?.[i]||"",s=p[i]?.[o]||o,u=c(d[i])?d[i](s):s;return t[i]=D(u),u&&(T[n]=(T[n]||0)+1),t}),{})))),R=o&&[...T].map(((e,t)=>!e&&t)).filter(jr).reverse();if(R){let e=e=>e.filter(((e,t)=>!R.includes(t)));b=b.map(e),P=e(P)}let M=b.map((e=>e.join(h)));return a?M.map((e=>{let t=e.split(h);return Object.assign({},...t.map(((e,t)=>({[P[t]]:e}))))})):n?[P.map(D).join(h),...M].join(g):M.join(g)}function hE(e,t=".",r=[]){return"object"==typeof e&&Object.keys(e).reduce(((i,n)=>"object"!=typeof e[n]?(i[r.concat(n).join(t)]=e[n],i):Object.assign(i,hE(e[n],t,r.concat(n)))),{})}var{FACTORY:gE}=Ao;function IE({timeStamp:e}){let t=$i(),r=Fi();return r&&Object.values(t).forEach((t=>{!function({tournamentRecord:e,value:t}){let{extension:r}=no({element:e,name:gE});za({element:e,extension:{name:gE,value:{...r?.value,...t}}})}({tournamentRecord:t,value:{version:"2.0.43",timeStamp:e}})})),r}function UE({engineType:e,methodName:t,elapsed:r,params:i,result:n}){let a=wi();if("object"!=typeof a)return;let o={method:t},s=n?.error&&(!0===a.errors||Array.isArray(a.errors)&&a.errors.includes(t)),c=Array.isArray(a.params)&&a.params?.includes(t),u=a.params&&!Array.isArray(a.params)||c,d=Array.isArray(a.exclude)&&a.exclude.includes(t);!d&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&r>=a.perf&&(o.elapsed=r),!d&&(s||u)&&(o.params=i),!d&&(s||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||c)||Array.isArray(a.result)&&a.result?.includes(t))&&(o.result=n),Object.keys(o).length>1&&Ji(o,e)}function vE({methodName:e,params:t,start:r}){let i={error:Rr,methodName:e};return UE({result:i,methodName:e,elapsed:r?Date.now()-r:0,params:t,engineType:"sync"}),i}function yE(e,t,r,i,n){delete e.success,delete e.error;let a=Date.now(),o=Gi();r&&(r.activeTournamentId=o);let s=r?.tournamentRecord||qi(o),c="object"==typeof r?.tournamentRecord&&{[r?.tournamentRecord.tournamentId]:r.tournamentRecord}||$i(),u=r?Da(r,void 0,!0):void 0,d=r?function(e,t){if(!1===t._middleware)return t;if(t.tournamentId&&!e[t.tournamentId])return{error:D};let r=t.drawId||t.matchUp?.drawId;if(r){let{event:i,drawDefinition:n,tournamentId:a}=sp({tournamentRecords:e,drawId:r});n&&(t.drawDefinition=n),a&&(t.tournamentId=a),i&&(t.event=i)}if(t.eventId&&!t.event){let{event:r,tournamentId:i}=sp({eventId:t.eventId,tournamentRecords:e});if(!r)return{error:le};t.tournamentId=i,t.event=r}let i=t.tournamentId??Gi();if(!i&&t)return t;let n=e[i];return i&&!n?{error:D}:(n&&(t.tournamentRecord=n),t)}(c,r):void 0;if(d?.error)return d;let l=function({tournamentRecords:e,tournamentRecord:t,params:r,methodName:i,method:n}){if(wi())return n({tournamentRecords:e,tournamentRecord:t,...r});try{return n({tournamentRecords:e,tournamentRecord:t,...r})}catch(a){return Qi({engineName:"engine",methodName:i,params:r,err:a})}}({params:d,tournamentRecords:c,tournamentRecord:s,methodName:i,method:t});return UE({result:l,methodName:i,elapsed:Date.now()-a,params:u,engineType:n}),l}function SE(e){let{mutationStatus:t,tournamentId:r,directives:i,timeStamp:n}=e||{},{topics:a}=Bi();for(let o of[...a].sort(PE)){let e=_i({topic:o});e?.length&&ji({topic:o,notices:e})}t&&n&&a.includes(Wc)&&ji({notices:[{tournamentId:r,directives:i,timeStamp:n}],topic:Wc})}var wE={[Qc]:5,[Kc]:5,[Jc]:5,[Gc]:5,[jc]:5,[xc]:5,[_c]:5,[Lc]:5,[Vc]:1,[Xc]:1,[Bc]:5,[$c]:5,[kc]:4,[Cc]:4,[Oc]:4,[Fc]:4,[bc]:3,[Tc]:2};function PE(e,t){return(wE[t]||0)-(wE[e]||0)}function DE(e,t=!0){return"object"!=typeof e||Array.isArray(e)?{error:dr}:e?.tournamentId?Wi(t?Da(e):e):{error:mr}}function TE(e,t=!0){if("object"!=typeof e)return{error:dr};if(zi(),Array.isArray(e)){if(e.filter((e=>e?.tournamentId)).length!==e.length)return{error:w};e=Object.assign({},...e.map((e=>({[e.tournamentId]:e}))))}else if(e?.tournamentId)zi((e={[e.tournamentId]:e}).tournamentId);else if(!Object.keys(e).every((t=>e[t].tournamentId===t)))return{error:w};return Hi(t?Da(e):e)}function bE(e,t){return t?.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}function RE(e,t){e.importMethods=(r,i,n,a)=>function(e,t,r,i,n,a){let o=Xi(r,i,n,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter((e=>c(s[e]))).forEach((r=>{e[r]=i=>{let n=()=>t(e,{[r]:s[r],...i});if(wi())return n();try{return n()}catch(a){Qi({engineName:"engine",methodName:r,params:i,err:a})}}})),{...I,...e}}(e,t,r,i,n,a),e.getTournament=e=>function(e){let{convertExtensions:t=!1,removeExtensions:r=!1}=e??{},i=e?.tournamentId??Gi();return"string"!=typeof i?{}:{tournamentRecord:Da(qi(i),t,!1,r)}}(e),e.getState=e=>function({convertExtensions:e,removeExtensions:t}){let r=$i();return{tournamentId:Gi(),tournamentRecords:Da(r,e,!1,t)}}({convertExtensions:e?.convertExtensions,removeExtensions:e?.removeExtensions}),e.version=()=>"2.0.43",e.reset=()=>(Hi({}),bE(e)),e.devContext=t=>(Ti(t),bE(e)),e.getDevContext=e=>wi(e),e.newTournamentRecord=(e={})=>{let t=dM(e),r=t.tournamentId;return t.error?t:(DE(t),zi(r),{...I,tournamentId:r})},e.setState=(t,r,i)=>{Mi(r,i);let n=TE(t,r);return bE(e,n)},e.setTournamentId=e=>zi(e),e.getTournamentId=()=>Gi(),e.setTournamentRecord=(t,r,i)=>{Mi(r,i);let n=DE(t,r);return bE(e,n)},e.removeTournamentRecord=t=>{let r=Yi(t);return bE(e,r)},e.removeUnlinkedTournamentRecords=()=>{let t=function(){let e=$i(),{extension:t}=no({name:Uo,tournamentRecords:e,discover:!0}),r=t?.value?.tournamentIds||[];return Object.keys(e).forEach((t=>{r.includes(t)||delete e[t]})),Hi(e)}();return bE(e,t)}}function ME(e,t){if(!d(t))return{error:mr,message:"args must be an object"};let r=Object.values(t).filter(c).length;if(r>1)return{message:"there must be only one arg with typeof function",error:mr};let i=r?Object.keys(t).find((e=>c(t[e]))):u(t.method)&&t.method;if(!i)return{error:Rr};let{[i]:n,...a}=t,o=t?.params?{...t.params}:{...a},s=o.rollbackOnError&&Da($i(),!1,!0),l=n||e[i]||Fr()[i];if(!l)return vE({methodName:i,params:o});let p=yE(e,l,o,i,"sync")??{};p?.error&&s&&TE(s);let m=Date.now(),f=IE({timeStamp:m}),h=p?.success&&!0!==o?.delayNotify&&!0!==o?.doNotNotify;return h&&SE({directives:[{method:l,params:o}],mutationStatus:f,timeStamp:m}),(h||!p?.success||o?.doNotNotify)&&Vi(),p}var NE=(()=>{let e={executionQueue:(t,r)=>function(e,t,r){if(!Array.isArray(t))return{error:mr,message:"directives must be an array"};let i=xi(),n=Date.now(),a=r&&Da($i(),!1,!0),o=[];for(let c of t){if("object"!=typeof c)return{error:mr,message:"directive must be an object"};if(c.params&&"object"!=typeof c.params)return{error:mr,message:"params must be an object"};let{method:t,pipe:r}=c,s=c.params?{...c.params}:{};if(!i[t])return vE({methodName:t,start:n,params:s});if(r){let e=o[o.length-1],t=Object.keys(r);for(let r of t)e[r]&&(s[r]=e[r])}let u=yE(e,i[t],s,t,"sync");if(u?.error)return a&&TE(a),{...u,rolledBack:!!a};o.push({...u,methodName:t})}let s=Date.now();return SE({directives:t,mutationStatus:IE({timeStamp:s}),timeStamp:s}),Vi(),{success:o.every((e=>e.success)),results:o}}(e,t,r),execute:t=>ME(e,t)};return RE(e,ME),e})();function AE(e,t){if(!d(t))return{error:mr,message:"args must be an object"};let r=Object.values(t).filter(c).length;if(r>1)return{message:"there must be only one arg with typeof function",error:mr};let i=r?Object.keys(t).find((e=>c(t[e]))):u(t.method)&&t.method;if(!i)return{error:Rr};let{[i]:n,...a}=t,o=t?.params?{...t.params}:{...a},s=n||e[i]||Fr()[i];return s?yE(e,s,o,i,"ask"):vE({methodName:i,params:o})}var EE,CE=(()=>{let e={execute:t=>AE(e,t)};return RE(e,AE),e})(),OE={};function FE(e,t=!0){if(!e)return{error:He};if("object"!=typeof e)return{error:dr};if(e.matchUpId)EE=e.matchUpId,OE[EE]=t?Da(e):e;else if(Array.isArray(e))for(let r of e.reverse())r.matchUpId&&(OE[r.matchUpId]=t?Da(r):r,EE||(EE=r.matchUpId));else for(let r of Object.values(e))r.matchUpId&&(OE[r.matchUpId]=t?Da(r):r,EE||(EE=r.matchUpId));return t?Da(e):e}(()=>{let e={getState:e=>function(e){return Da(OE[EE],e?.convertExtensions,!1,e?.removeExtensions)}(e),version:()=>"2.0.43",reset:()=>(EE=void 0,OE={},{...I}),drawId:void 0,error:void 0,success:!1,devContext:t=>(Ti(t),e),setState:(t,r,i)=>(Mi(r,i),function(t){return t?.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0,e.drawId=t.drawId),e}(FE(t)))};return[gy].forEach((r=>{Object.keys(r).forEach((i=>{e[i]=e=>{if(wi())return t({params:e,governor:r,methodName:i});try{return t({params:e,governor:r,methodName:i})}catch(n){Qi({engineName:"matchUpEngine",methodName:i,params:e,err:n})}}}))})),e;function t({params:t,governor:r,methodName:i}){e.error=void 0,e.success=!1;let n=t?.matchUp||OE[EE],a=t?.matchUps||Object.values(OE),o=t?.rollbackOnError&&Da(n,!1,!0);t={...t,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let s=r[i](t);if(s?.error)return o&&FE(o),{...s,rolledBack:!!o};let c=s?.success&&!0!==t?.delayNotify&&!0!==t?.doNotNotify;return c&&SE(),(c||!s?.success||t?.doNotNotify)&&Vi(),s}})();var kE=!1,xE=(()=>{let e={version:()=>"2.0.43",setDeepCopy:(t,r)=>(Mi(t,r),e),devContext:t=>(Ti(t),kE=!0,e)};return[_R].forEach((t=>{Object.keys(t).forEach((r=>{e[r]=e=>{try{let i=function(e,t){let r=e({...t});return r?.error||SE(),Vi(),kE&&(Ti(!1),kE=!1),r}(t[r],e);return!i?.error&&e?.setState&&i?.tournamentRecord&&TE(i.tournamentRecord),i}catch(i){let t;"string"==typeof i?t=i.toUpperCase():i instanceof Error&&(t=i.message),console.log("ERROR",{params:JSON.stringify(e),method:r,error:t})}}}))})),e})();NE.importMethods(a,!0,1);var _E=NE;function LE(e,t){return e&&t&&Array.isArray(t)&&t[e-1]||"object"==typeof t&&t[e]}function VE(e){let{participation:t={},awardProfiles:r,startDate:i,eventType:n,drawSize:a,drawType:o,category:s,endDate:c,level:u}=e,{participationOrder:d,flightNumber:l,rankingStage:p}=t;return{awardProfile:r.find((e=>(e=>!i&&!c||!e.dateRanges||e.dateRanges.some((e=>{let t=!i||!e.startDate||new Date(i)>new Date(e.startDate),r=!c||!e.endDate||new Date(c)<=new Date(e.endDate);return t&&r})))(e)&&(!e.maxFlightNumber||l<=e.maxFlightNumber)&&(!e.drawTypes?.length||e.drawTypes?.includes(o))&&(!e.drawSizes?.length||e.drawSizes.includes(a))&&(!e.stages?.length||e.stages.includes(p))&&(!e.levels?.length||e.levels.includes(u))&&(!e.maxDrawSize||a<=e.maxDrawSize)&&(!e.drawSize||e.drawSize===a)&&(!e.maxLevel||u<=e.maxLevel)&&(!l||!e.flights?.flightNumbers?.length||e.flights.flightNumbers.includes(l))&&(!e.participationOrder||e.participationOrder===d)&&(!e.category?.ageCategoryCodes||e.category.ageCategoryCodes.includes(s?.ageCategoryCode))&&(!e.eventTypes?.length||e.eventTypes?.includes(n))))}}function BE({participantWon:e,flightNumber:t,valueObj:r,drawSize:i,flights:n,level:a}){let o,s,c,u,d=(e,t)=>{if(e){if(Array.isArray(t)){let r=t.find((t=>t.flight===e||t.f===e));return r.value||r.v}if("object"==typeof t){let r=t.flights||t.f;if(Array.isArray(r))return r[e-1]}}},l=(e,t)=>{let r=e?.value||e?.v||(Wr(e)?e:0),i=LE(a,e?.level);return{value:d(t,i)||Wr(i)&&i||r}},p=0,m=(e?"won":!1===e&&"lost")||void 0;if(Array.isArray(r)){let e=r.find((e=>e.drawSize===i||e.drawSizes?.includes(i))),n=r.find((e=>e.drawSize&&e.threshold&&i>e.drawSize)),a=r.find((e=>!e.drawSize&&!e.drawSizes?.length));void 0!==m&&(e=e?.[m],n=n?.[m],a=a?.[m]),s=l(e,t).value,c=l(n,t).value,u=l(a,t).value,p=s||c||u,o=s&&e.requireWin||c&&n.requireWin||a?.requireWin}else if("object"==typeof r){let e=r?.drawSizes?.[i],n=r;void 0!==m&&(e=e?.[m],n=n?.[m]),s=l(e,t).value,u=l(n,t).value,p=s||u,o=s?e.requireWin:n?.requireWin}else Wr(r)&&void 0===m&&(p=r);return t&&n?.pct?.[t]&&(p=Math.round(p*n.pct[t])),{awardPoints:p,requireWin:o}}var jE={...{getTournamentPoints:function({participantFilters:e,policyDefinitions:t,tournamentRecord:r,level:i}){if(!r)return{error:D};let{policyDefinitions:n}=Ku({policyTypes:[Ea],tournamentRecord:r}),a=t?.[Ea]??n?.[Ea];if(!a)return{error:_e};let o=a.awardProfiles,s=a.requireWinFirstRound,c=a.requireWinForPoints,{participants:u,derivedEventInfo:d,derivedDrawInfo:l,mappedMatchUps:p}=ef({withRankingProfile:!0,participantFilters:e,tournamentRecord:r}),m=u?.filter((e=>e.draws?.length)),f={},h={},g={};for(let I of m??[]){let{participantType:e,participantId:t,person:n,draws:a}=I;for(let u of a){let a,{drawId:m,structureParticipation:U,eventId:v}=u,y=d[v],S=l[m],w=S?.drawType,{category:P,eventType:D}=y||{},T=u.startDate||y.startDate||r.startDate,b=u.endDate||y.endDate||r.endDate;if((D!==xl||t===Du)&&o){let r,u=c,d=0,l=0,v=0;for(let n of U){let{finishingPositionRange:c,participationOrder:m,participantWon:f,flightNumber:h,rankingStage:g,winCount:U}=n;d+=U||0;let y=S?.drawSize,{awardProfile:R}=VE({awardProfiles:o,participation:n,eventType:D,startDate:T,category:P,drawSize:y,drawType:w,endDate:b,level:i});if(R){if(!y)continue;let e=Array.isArray(c)&&Math.max(...c),t=Yr(c||[]).join("-"),n=e&&g!==Us&&c?.includes(y);void 0!==R.requireWinForPoints&&(u=R.requireWinForPoints),void 0!==R.requireWinFirstRound&&(s=R.requireWinFirstRound);let a,{finishingPositionPoints:o={},finishingPositionRanges:d,finishingRound:p,pointsPerWin:I,flights:S}=R,w=Array.isArray(R.perWinPoints)?R.perWinPoints?.find((e=>e.participationOrders?.includes(m))):R.perWinPoints,P=o.participationOrders,D=0;if((!P||P.includes(m))&&d&&e){let t=d[e];t&&({awardPoints:D,requireWin:a}=BE({flightNumber:h,valueObj:t,drawSize:y,flights:S,level:i}))}if(!D&&p&&1===m&&e){let t=p[e];t&&({awardPoints:D,requireWin:a}=BE({participantWon:f,flightNumber:h,valueObj:t,drawSize:y,flights:S,level:i}))}if(n&&void 0!==s&&(u=s),void 0!==a&&(u=a),D>l&&(!u||U)&&(l=D,r=e),!D&&I&&U&&(v+=U*I,r=t),!D&&U&&w){let e=LE(i,w?.level);e?v+=U*e:w.value&&(v+=U*w.value)}}if(a=l+v,e===Du){let e=(I.matchUps||[]).filter((({structureId:e})=>e===n.structureId));for(let{matchUpId:r}of e){let e=p[r],i=e.sides.find((e=>e.participantId===t)).sideNumber;if(e.winningSice===i)for(let t of e.tieMatchUps)t.winningSide}}}if(v||l){let i={winCount:d,positionPoints:l,rangeAccessor:r,perWinPoints:v,eventType:D,drawId:m,points:a},o=n?.personId;o?(f[o]||(f[o]=[]),f[o].push(i)):e===Ru?(g[t]||(g[t]=[]),g[t].push(i)):e===Du&&(h[t]||(h[t]=[]),h[t].push(i))}}}}return{participantsWithOutcomes:m,personPoints:f,pairPoints:g,teamPoints:h,...I}}},...{calculateNewRatings:ty,generateDynamicRatings:iy}};NE.importMethods(jE);var GE={};n(GE,{activeMatchUpStatuses:()=>fs,auditConstants:()=>NT,completedMatchUpStatuses:()=>ms,directingMatchUpStatuses:()=>ls,drawDefinitionConstants:()=>gc,entryStatusConstants:()=>bd,errorConditionConstants:()=>Ar,eventConstants:()=>_l,extensionConstants:()=>Ao,flightConstants:()=>ob,genderConstants:()=>Yp,keyValueConstants:()=>SS,matchUpActionConstants:()=>Mv,matchUpStatusConstants:()=>gs,matchUpTypes:()=>Uu,nonDirectingMatchUpStatuses:()=>ps,particicipantsRequiredMatchUpStatuses:()=>us,participantConstants:()=>Au,participantRoles:()=>Sf,participantTypes:()=>Nu,penaltyConstants:()=>qE,policyConstants:()=>ja,positionActionConstants:()=>rv,ratingConstants:()=>Kg,recoveryTimeRequiredMatchUpStatuses:()=>cs,requestConstants:()=>HR,resultConstants:()=>U,scaleConstants:()=>qn,scheduleConstants:()=>Al,sortingConstants:()=>db,surfaceConstants:()=>$E,tieFormatConstants:()=>Yw,timeItemConstants:()=>pl,topicConstants:()=>Zc,tournamentConstants:()=>CA,upcomingMatchUpStatuses:()=>hs,validMatchUpStatuses:()=>ds,venueConstants:()=>WE});var qE={COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},$E={CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},WE={INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"}}}]);